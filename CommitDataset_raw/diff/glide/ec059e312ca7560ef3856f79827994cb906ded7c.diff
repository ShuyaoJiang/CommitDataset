[+++ b/library/src/main/java/com/bumptech/glide/load/engine/cache/DiskLruCacheWrapper.java, +                try {, +                } finally {, +                    editor.abortUnlessCommitted();, +                }, +++ b/library/src/main/java/com/bumptech/glide/load/engine/cache/DiskLruCacheWrapper.java, +                try {, +                } finally {, +                    editor.abortUnlessCommitted();, +                }, +++ b/library/src/test/java/com/bumptech/glide/load/engine/cache/DiskLruCacheWrapperTest.java, +        File dir = Robolectric.application.getCacheDir();, +    @Test, +    public void testEditIsAbortedIfWriterThrows() throws FileNotFoundException {, +        try {, +            cache.put(key, new DiskCache.Writer() {, +                @Override, +                public boolean write(File file) {, +                    throw new RuntimeException("test");, +                }, +            });, +        } catch (RuntimeException e) {, +            // Expected., +        }, +, +        cache.put(key, new DiskCache.Writer() {, +            @Override, +            public boolean write(File file) {, +                try {, +                    new FileOutputStream(file).write(data);, +                } catch (IOException e) {, +                    e.printStackTrace();, +                }, +                return true ;, +            }, +        });, +, +        byte[] received = isToBytes(new FileInputStream(cache.get(key)), data.length);, +, +        assertTrue(Arrays.equals(data, received));, +    }, +]