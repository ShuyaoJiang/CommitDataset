[+++ b/library/src/androidTest/java/com/bumptech/glide/load/engine/prefill/PreFillerHandlerTest.java, +import org.mockito.InOrder;, +import static org.mockito.Mockito.inOrder;, +import static org.mockito.Mockito.times;, +        getHandler(allocationOrder).queueIdle();, +        getHandler(allocationOrder).queueIdle();, +        getHandler(allocationOrder).queueIdle();, +    @Test, +    public void testDoesAGetFromPoolBeforeAddingForEachSize() {, +        Bitmap first = Bitmap.createBitmap(100, 100, Bitmap.Config.ARGB_4444);, +        PreFillBitmapAttribute firstSize = new PreFillBitmapAttribute(first.getWidth(), first.getHeight(),, +                first.getConfig(), 1);, +, +        Bitmap second = Bitmap.createBitmap(200, 200, Bitmap.Config.RGB_565);, +        PreFillBitmapAttribute secondSize = new PreFillBitmapAttribute(second.getWidth(), second.getHeight(),, +                second.getConfig(), 1);, +, +        Map<PreFillBitmapAttribute, Integer> allocationOrder = new HashMap<PreFillBitmapAttribute, Integer>();, +        allocationOrder.put(firstSize, 1);, +        allocationOrder.put(secondSize, 1);, +, +        getHandler(allocationOrder).queueIdle();, +, +        InOrder firstOrder = inOrder(pool);, +        firstOrder.verify(pool).get(eq(first.getWidth()), eq(first.getHeight()), eq(first.getConfig()));, +        firstOrder.verify(pool).put(eq(first));, +, +        InOrder secondOrder = inOrder(pool);, +        secondOrder.verify(pool).get(eq(second.getWidth()), eq(second.getHeight()), eq(second.getConfig()));, +        secondOrder.verify(pool).put(eq(second));, +    }, +, +    @Test, +    public void testDoesNotGetMoreThanOncePerSize() {, +        Bitmap bitmap = Bitmap.createBitmap(100, 100, Bitmap.Config.ARGB_4444);, +        PreFillBitmapAttribute size = new PreFillBitmapAttribute(bitmap.getWidth(), bitmap.getHeight(),, +                bitmap.getConfig(), 1);, +, +        final int numBitmaps = 5;, +        Map<PreFillBitmapAttribute, Integer> allocationOrder = new HashMap<PreFillBitmapAttribute, Integer>();, +        allocationOrder.put(size, numBitmaps);, +, +        getHandler(allocationOrder).queueIdle();, +, +        InOrder order = inOrder(pool);, +        order.verify(pool).get(eq(bitmap.getWidth()), eq(bitmap.getHeight()), eq(bitmap.getConfig()));, +        order.verify(pool, times(numBitmaps)).put(eq(bitmap));, +    }, +, +++ b/library/src/androidTest/java/com/bumptech/glide/load/engine/prefill/PreFillerHandlerTest.java, +import org.mockito.InOrder;, +import static org.mockito.Mockito.inOrder;, +import static org.mockito.Mockito.times;, +        getHandler(allocationOrder).queueIdle();, +        getHandler(allocationOrder).queueIdle();, +        getHandler(allocationOrder).queueIdle();, +    @Test, +    public void testDoesAGetFromPoolBeforeAddingForEachSize() {, +        Bitmap first = Bitmap.createBitmap(100, 100, Bitmap.Config.ARGB_4444);, +        PreFillBitmapAttribute firstSize = new PreFillBitmapAttribute(first.getWidth(), first.getHeight(),, +                first.getConfig(), 1);, +, +        Bitmap second = Bitmap.createBitmap(200, 200, Bitmap.Config.RGB_565);, +        PreFillBitmapAttribute secondSize = new PreFillBitmapAttribute(second.getWidth(), second.getHeight(),, +                second.getConfig(), 1);, +, +        Map<PreFillBitmapAttribute, Integer> allocationOrder = new HashMap<PreFillBitmapAttribute, Integer>();, +        allocationOrder.put(firstSize, 1);, +        allocationOrder.put(secondSize, 1);, +, +        getHandler(allocationOrder).queueIdle();, +, +        InOrder firstOrder = inOrder(pool);, +        firstOrder.verify(pool).get(eq(first.getWidth()), eq(first.getHeight()), eq(first.getConfig()));, +        firstOrder.verify(pool).put(eq(first));, +, +        InOrder secondOrder = inOrder(pool);, +        secondOrder.verify(pool).get(eq(second.getWidth()), eq(second.getHeight()), eq(second.getConfig()));, +        secondOrder.verify(pool).put(eq(second));, +    }, +, +    @Test, +    public void testDoesNotGetMoreThanOncePerSize() {, +        Bitmap bitmap = Bitmap.createBitmap(100, 100, Bitmap.Config.ARGB_4444);, +        PreFillBitmapAttribute size = new PreFillBitmapAttribute(bitmap.getWidth(), bitmap.getHeight(),, +                bitmap.getConfig(), 1);, +, +        final int numBitmaps = 5;, +        Map<PreFillBitmapAttribute, Integer> allocationOrder = new HashMap<PreFillBitmapAttribute, Integer>();, +        allocationOrder.put(size, numBitmaps);, +, +        getHandler(allocationOrder).queueIdle();, +, +        InOrder order = inOrder(pool);, +        order.verify(pool).get(eq(bitmap.getWidth()), eq(bitmap.getHeight()), eq(bitmap.getConfig()));, +        order.verify(pool, times(numBitmaps)).put(eq(bitmap));, +    }, +, +++ b/library/src/main/java/com/bumptech/glide/load/engine/prefill/BitmapPreFillIdleHandler.java, +import java.util.HashSet;]