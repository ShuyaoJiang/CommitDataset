[+++ b/integration/gifencoder/src/main/java/com/bumptech/glide/integration/gifencoder/ReEncodingGifResourceEncoder.java, +import android.content.Context;, +  private Context context;, +  public ReEncodingGifResourceEncoder(Context context, BitmapPool bitmapPool) {, +    this(context, bitmapPool, FACTORY);, +  ReEncodingGifResourceEncoder(Context context, BitmapPool bitmapPool, Factory factory) {, +    this.context = context;, +    Resource<Bitmap> transformedResource =, +        transformation.transform(, +            context, bitmapResource, drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight());, +++ b/integration/gifencoder/src/main/java/com/bumptech/glide/integration/gifencoder/ReEncodingGifResourceEncoder.java, +import android.content.Context;, +  private Context context;, +  public ReEncodingGifResourceEncoder(Context context, BitmapPool bitmapPool) {, +    this(context, bitmapPool, FACTORY);, +  ReEncodingGifResourceEncoder(Context context, BitmapPool bitmapPool, Factory factory) {, +    this.context = context;, +    Resource<Bitmap> transformedResource =, +        transformation.transform(, +            context, bitmapResource, drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight());, +++ b/integration/gifencoder/src/test/java/com/bumptech/glide/integration/gifencoder/ReEncodingGifResourceEncoderTest.java, +import android.app.Application;, +import android.content.Context;, +    Application context = RuntimeEnvironment.application;, +, +    when(frameTransformation.transform(anyContext(), any(Resource.class), anyInt(), anyInt())), +    encoder = new ReEncodingGifResourceEncoder(context, mock(BitmapPool.class), factory);, +    file = new File(context.getCacheDir(), "test");, +    when(frameTransformation.transform(, +        anyContext(), eq(frameResource), eq(expectedWidth), eq(expectedHeight))), +    when(frameTransformation.transform(anyContext(), eq(frameResource), anyInt(), anyInt())), +    when(frameTransformation.transform(anyContext(), eq(frameResource), anyInt(), anyInt())), +    when(frameTransformation.transform(anyContext(), eq(frameResource), anyInt(), anyInt())), +, +  private static Context anyContext() {, +    return any(Context.class);, +  }, +++ b/integration/gifencoder/src/main/java/com/bumptech/glide/integration/gifencoder/ReEncodingGifResourceEncoder.java, +import android.content.Context;, +  private Context context;, +  public ReEncodingGifResourceEncoder(Context context, BitmapPool bitmapPool) {, +    this(context, bitmapPool, FACTORY);, +  ReEncodingGifResourceEncoder(Context context, BitmapPool bitmapPool, Factory factory) {, +    this.context = context;, +    Resource<Bitmap> transformedResource =, +        transformation.transform(, +            context, bitmapResource, drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight());, +++ b/integration/gifencoder/src/test/java/com/bumptech/glide/integration/gifencoder/ReEncodingGifResourceEncoderTest.java, +import android.app.Application;, +import android.content.Context;, +    Application context = RuntimeEnvironment.application;, +, +    when(frameTransformation.transform(anyContext(), any(Resource.class), anyInt(), anyInt())), +    encoder = new ReEncodingGifResourceEncoder(context, mock(BitmapPool.class), factory);, +    file = new File(context.getCacheDir(), "test");, +    when(frameTransformation.transform(, +        anyContext(), eq(frameResource), eq(expectedWidth), eq(expectedHeight))), +    when(frameTransformation.transform(anyContext(), eq(frameResource), anyInt(), anyInt())), +    when(frameTransformation.transform(anyContext(), eq(frameResource), anyInt(), anyInt())), +    when(frameTransformation.transform(anyContext(), eq(frameResource), anyInt(), anyInt())), +, +  private static Context anyContext() {, +    return any(Context.class);, +  }, +++ b/library/src/main/java/com/bumptech/glide/Glide.java, +  @VisibleForTesting, +  public static void init(Glide glide) {, +    Glide.glide = glide;, +  }, +, +  @VisibleForTesting, +  public static void tearDown() {, +    glide = null;, +  }, +, +    glide = builder.build(applicationContext);, +++ b/integration/gifencoder/src/main/java/com/bumptech/glide/integration/gifencoder/ReEncodingGifResourceEncoder.java, +import android.content.Context;, +  private Context context;, +  public ReEncodingGifResourceEncoder(Context context, BitmapPool bitmapPool) {, +    this(context, bitmapPool, FACTORY);, +  ReEncodingGifResourceEncoder(Context context, BitmapPool bitmapPool, Factory factory) {, +    this.context = context;, +    Resource<Bitmap> transformedResource =, +        transformation.transform(, +            context, bitmapResource, drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight());, +++ b/integration/gifencoder/src/test/java/com/bumptech/glide/integration/gifencoder/ReEncodingGifResourceEncoderTest.java, +import android.app.Application;, +import android.content.Context;, +    Application context = RuntimeEnvironment.application;, +, +    when(frameTransformation.transform(anyContext(), any(Resource.class), anyInt(), anyInt())), +    encoder = new ReEncodingGifResourceEncoder(context, mock(BitmapPool.class), factory);, +    file = new File(context.getCacheDir(), "test");, +    when(frameTransformation.transform(, +        anyContext(), eq(frameResource), eq(expectedWidth), eq(expectedHeight))), +    when(frameTransformation.transform(anyContext(), eq(frameResource), anyInt(), anyInt())), +    when(frameTransformation.transform(anyContext(), eq(frameResource), anyInt(), anyInt())), +    when(frameTransformation.transform(anyContext(), eq(frameResource), anyInt(), anyInt())), +]