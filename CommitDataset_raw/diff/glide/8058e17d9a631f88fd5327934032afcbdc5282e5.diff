[+++ b/annotation/compiler/build.gradle, +import proguard.gradle.ProGuardTask, +def repackagedJar = file("$buildDir/intermediates/repackaged.jar"), +def proguardedJar = file("$buildDir/intermediates/proguarded.jar"), +task compiledJar(type: Jar, dependsOn: classes) {, +    from sourceSets.main.output, +// Repackage compileOnly dependencies to avoid namespace collisions., +task jarjar(dependsOn: [tasks.compiledJar, configurations.compileOnly]) {, +    inputs.file compiledJar, +    outputs.file repackagedJar, +, +            jarjar(jarfile: repackagedJar) {, +// Proguard repackaged dependencies to reduce the binary size., +task proguard(type: ProGuardTask, dependsOn: tasks.jarjar) {, +    injars repackagedJar, +    outjars proguardedJar, +}, +// Create the standard jar artifact based on our repackaged and proguarded jar., +jar {, +    dependsOn proguard, +    from zipTree(proguardedJar)]