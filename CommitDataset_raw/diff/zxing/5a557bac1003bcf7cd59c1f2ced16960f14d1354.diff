[+++ b/core/src/com/google/zxing/qrcode/encoder/Encoder.java, +    // bits it takes to know version. First we take a guess at version by assuming version will be, +    // the minimum, 1:, +, +    int provisionalBitsNeeded = headerBits.getSize(), +        + mode.getCharacterCountBits(Version.getVersionForNumber(1)), +        + dataBits.getSize();, +    Version provisionalVersion = chooseVersion(provisionalBitsNeeded, ecLevel);, +, +    // Use that guess to calculate the right version. I am still not sure this works in 100% of cases., +, +        + mode.getCharacterCountBits(provisionalVersion)]