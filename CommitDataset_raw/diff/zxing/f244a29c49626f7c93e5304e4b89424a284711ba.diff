[+++ b/android/src/com/google/zxing/client/android/CaptureActivity.java, +    // historyManager must be initialized here to update the history preference, +    historyManager = new HistoryManager(this);, +    historyManager.trimHistory();, +, +    historyManager = null;, +++ b/android/src/com/google/zxing/client/android/CaptureActivity.java, +    // historyManager must be initialized here to update the history preference, +    historyManager = new HistoryManager(this);, +    historyManager.trimHistory();, +, +    historyManager = null;, +++ b/android/src/com/google/zxing/client/android/history/HistoryManager.java, +  private final boolean enableHistory;, +    SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(activity);, +    enableHistory = prefs.getBoolean(PreferencesActivity.KEY_ENABLE_HISTORY, true);, +        handler.areContentsSecure() || !enableHistory) {]