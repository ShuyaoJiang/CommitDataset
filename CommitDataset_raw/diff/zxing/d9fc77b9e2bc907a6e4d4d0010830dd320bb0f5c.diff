[+++ b/android-m3/src/com/google/zxing/client/android/CameraThread.java, +  private State state;, +, +  private enum State {, +    PREVIEW,, +    DECODE,, +    SAVE,, +    DONE, +  }, +    state = State.DONE;, +            if (state == State.PREVIEW) {, +            state = State.SAVE;, +            break;, +            state = State.DONE;, +            state = State.PREVIEW;, +            state = State.DONE;, +            startDecode();, +            break;, +        if (state == State.PREVIEW) {, +    restartPreviewAndDecode();, +   * Start a decode if possible, but not now if the DecodeThread is in the middle of saving., +   */, +  private void startDecode() {, +    if (state != State.SAVE) {, +      state = State.DECODE;, +      Message decode = Message.obtain(decodeThread.handler, R.id.decode);, +      decode.sendToTarget();, +    }, +  }, +, +  /**, +    state = State.PREVIEW;, +    surfaceView.capturePreviewAndDraw();, +    startDecode();]