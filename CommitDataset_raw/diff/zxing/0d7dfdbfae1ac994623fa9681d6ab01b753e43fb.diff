[+++ b/android/src/com/android/barcodes/AndroidHttpClient.java, +/*, + * Copyright (C) 2007 The Android Open Source Project, + *, + * Licensed under the Apache License, Version 2.0 (the "License");, + * you may not use this file except in compliance with the License., + * You may obtain a copy of the License at, + *, + *      http://www.apache.org/licenses/LICENSE-2.0, + *, + * Unless required by applicable law or agreed to in writing, software, + * distributed under the License is distributed on an "AS IS" BASIS,, + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied., + * See the License for the specific language governing permissions and, + * limitations under the License., + */, +, +package com.android.barcodes;, +, +import android.content.ContentResolver;, +import android.util.Log;, +import org.apache.http.Header;, +import org.apache.http.HttpEntity;, +import org.apache.http.HttpEntityEnclosingRequest;, +import org.apache.http.HttpException;, +import org.apache.http.HttpHost;, +import org.apache.http.HttpRequest;, +import org.apache.http.HttpRequestInterceptor;, +import org.apache.http.HttpResponse;, +import org.apache.http.client.ClientProtocolException;, +import org.apache.http.client.HttpClient;, +import org.apache.http.client.ResponseHandler;, +import org.apache.http.client.methods.HttpUriRequest;, +import org.apache.http.client.params.HttpClientParams;, +import org.apache.http.client.protocol.ClientContext;, +import org.apache.http.conn.ClientConnectionManager;, +import org.apache.http.conn.scheme.PlainSocketFactory;, +import org.apache.http.conn.scheme.Scheme;, +import org.apache.http.conn.scheme.SchemeRegistry;, +import org.apache.http.conn.ssl.SSLSocketFactory;, +import org.apache.http.entity.AbstractHttpEntity;, +import org.apache.http.entity.ByteArrayEntity;, +import org.apache.http.impl.client.DefaultHttpClient;, +import org.apache.http.impl.client.RequestWrapper;, +import org.apache.http.impl.conn.tsccm.ThreadSafeClientConnManager;, +import org.apache.http.params.BasicHttpParams;, +import org.apache.http.params.HttpConnectionParams;, +import org.apache.http.params.HttpParams;, +import org.apache.http.params.HttpProtocolParams;, +import org.apache.http.protocol.BasicHttpContext;, +import org.apache.http.protocol.BasicHttpProcessor;, +import org.apache.http.protocol.HttpContext;, +, +import java.io.ByteArrayOutputStream;, +import java.io.IOException;, +import java.io.InputStream;, +import java.io.OutputStream;, +import java.net.URI;, +import java.util.zip.GZIPInputStream;, +import java.util.zip.GZIPOutputStream;, +, +/**, + * Subclass of the Apache {@link DefaultHttpClient} that is configured with, + * reasonable default settings and registered schemes for Android, and, + * also lets the user add {@link HttpRequestInterceptor} classes., + * Don't create this directly, use the {@link #newInstance} factory method., + *, + * <p>This client processes cookies but does not retain them by default., + * To retain cookies, simply add a cookie store to the HttpContext:</p>, + *, + * <pre>context.setAttribute(ClientContext.COOKIE_STORE, cookieStore);</pre>, + * , + * {@hide}, + */, +public final class AndroidHttpClient implements HttpClient {, +        , +    // Gzip of data shorter than this probably won't be worthwhile, +    public static long DEFAULT_SYNC_MIN_GZIP_BYTES = 256;, +, +    private static final String TAG = "AndroidHttpClient";, +, +, +    /** Set if HTTP requests are blocked from being executed on this thread */, +    private static final ThreadLocal<Boolean> sThreadBlocked =, +            new ThreadLocal<Boolean>();, +, +    /** Interceptor throws an exception if the executing thread is blocked */, +    private static final HttpRequestInterceptor sThreadCheckInterceptor =, +            new HttpRequestInterceptor() {, +        public void process(HttpRequest request, HttpContext context) {, +            if (sThreadBlocked.get() != null && sThreadBlocked.get()) {, +                throw new RuntimeException("This thread forbids HTTP requests");, +            }, +        }, +    };, +, +    /**, +     * Create a new HttpClient with reasonable defaults (which you can update)., +     * @param userAgent to report in your HTTP requests., +     * @return AndroidHttpClient for you to use for all your requests.]