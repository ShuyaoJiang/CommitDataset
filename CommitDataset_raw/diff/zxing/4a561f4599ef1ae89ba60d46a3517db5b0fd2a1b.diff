[+++ b/iphone/ZXingWidget/Classes/ZXingWidgetController.m, +// -*- mode:objc; c-basic-offset:2; indent-tabs-mode:nil -*-, +#include <sys/types.h>, +#include <sys/sysctl.h>, +, +// Gross, I know, but ..., +static bool isIPad() {, +  static int is_ipad = -1;, +  if (is_ipad < 0) {, +    size_t size;, +    sysctlbyname("hw.machine", NULL, &size, NULL, 0); // Get size of data to be returned., +    char *name = malloc(size);, +    sysctlbyname("hw.machine", name, &size, NULL, 0);, +    NSString *machine = [NSString stringWithCString:name encoding:NSASCIIStringEncoding];, +    free(name);, +    is_ipad = [machine hasPrefix:@"iPad"];, +  }, +  return !!is_ipad;, +}, +    , +  AVCaptureDevice* inputDevice =, +    [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];, +    [AVCaptureDeviceInput deviceInputWithDevice:inputDevice error:nil];, +, +  NSString* preset = 0;, +  if (NSClassFromString(@"NSOrderedSet") && // Proxy for "is this iOS 5" ..., +      [UIScreen mainScreen].scale > 1 &&, +      isIPad() && , +      [inputDevice, +        supportsAVCaptureSessionPreset:AVCaptureSessionPresetiFrame960x540]) {, +    NSLog(@"960");, +    preset = AVCaptureSessionPresetiFrame960x540;, +  }, +  if (!preset) {, +    NSLog(@"MED");, +    preset = AVCaptureSessionPresetMedium;, +  }, +  self.captureSession.sessionPreset = preset;, +++ b/iphone/ZXingWidget/Classes/ZXingWidgetController.m, +// -*- mode:objc; c-basic-offset:2; indent-tabs-mode:nil -*-, +#include <sys/types.h>, +#include <sys/sysctl.h>, +, +// Gross, I know, but ..., +static bool isIPad() {, +  static int is_ipad = -1;, +  if (is_ipad < 0) {, +    size_t size;, +    sysctlbyname("hw.machine", NULL, &size, NULL, 0); // Get size of data to be returned., +    char *name = malloc(size);, +    sysctlbyname("hw.machine", name, &size, NULL, 0);, +    NSString *machine = [NSString stringWithCString:name encoding:NSASCIIStringEncoding];, +    free(name);, +    is_ipad = [machine hasPrefix:@"iPad"];, +  }, +  return !!is_ipad;, +}, +    , +  AVCaptureDevice* inputDevice =, +    [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];, +    [AVCaptureDeviceInput deviceInputWithDevice:inputDevice error:nil];, +, +  NSString* preset = 0;, +  if (NSClassFromString(@"NSOrderedSet") && // Proxy for "is this iOS 5" ..., +      [UIScreen mainScreen].scale > 1 &&, +      isIPad() && , +      [inputDevice, +        supportsAVCaptureSessionPreset:AVCaptureSessionPresetiFrame960x540]) {, +    NSLog(@"960");, +    preset = AVCaptureSessionPresetiFrame960x540;, +  }, +  if (!preset) {, +    NSLog(@"MED");, +    preset = AVCaptureSessionPresetMedium;, +  }, +  self.captureSession.sessionPreset = preset;, +++ b/objc/src/ZXing/ZXCapture.mm, +#if ZXAV(1)+0, +static bool isIPad();, +#endif, +, +    ZXAV({, +        NSString* preset = 0;, +        if (NSClassFromString(@"NSOrderedSet") && // Proxy for "is this iOS 5" ..., +            [UIScreen mainScreen].scale > 1 &&, +            isIPad() && , +            [zxd supportsAVCaptureSessionPreset:AVCaptureSessionPresetiFrame960x540]) {, +          // NSLog(@"960");, +          preset = AVCaptureSessionPresetiFrame960x540;, +        }, +        if (!preset) {, +          // NSLog(@"MED");, +          preset = AVCaptureSessionPresetMedium;, +        }, +        session.sessionPreset = preset;, +      });, +// If you try to define this higher, there (seem to be) clashes with something(s) defined, +// in the includes ..., +, +#if ZXAV(1)+0]