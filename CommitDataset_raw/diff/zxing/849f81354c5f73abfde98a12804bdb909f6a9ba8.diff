[+++ b/core/src/main/java/com/google/zxing/pdf417/encoder/PDF417HighLevelEncoder.java, +import java.nio.charset.CharsetEncoder;, +      byte[] bytes = msg.getBytes(encoding);, +            int b = determineConsecutiveBinaryCount(msg, p, encoding);, +            byte[] bytes = msg.substring(p, b).getBytes(encoding);, +            if (bytes.length == 1 && encodingMode == TEXT_COMPACTION) {, +              encodeBinary(bytes, 0, 1, TEXT_COMPACTION, sb);, +              encodeBinary(bytes, 0, bytes.length, encodingMode, sb);, +   * @param encoding the charset used to convert the message to a byte array, +  private static int determineConsecutiveBinaryCount(String msg, int startpos, Charset encoding), +    final CharsetEncoder encoder = encoding.newEncoder();, +      if (!encoder.canEncode(ch)) {]