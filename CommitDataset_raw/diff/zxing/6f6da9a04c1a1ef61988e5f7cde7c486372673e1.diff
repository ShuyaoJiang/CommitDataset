[+++ b/android/build.xml, +<?xml version="1.0" encoding="UTF-8"?>, +  <target name="compile-release" depends="dirs, resource-src, aidl">, +    <javac encoding="ascii" target="1.5" debug="off" extdirs="", +           srcdir=".", +           destdir="${outdir-classes}", +           bootclasspath="${android-jar}">, +      <classpath>, +        <fileset dir="${external-libs}" includes="*.jar"/>, +      </classpath>, +    </javac>, +  </target>, +, +  <target name="optimize" depends="compile-release">, +    <fail message="Please put proguard.jar in 'bin' under the WTK install directory">, +      <condition>, +        <not>, +          <available file="${WTK-home}/bin/proguard.jar" type="file"/>, +        </not>, +      </condition>, +    </fail>, +    <unzip src="../core/core.jar" dest="${outdir-classes}" overwrite="true"/>, +    <jar jarfile="temp.jar" basedir="${outdir-classes}"/>, +    <delete dir="${outdir-classes}"/>, +    <mkdir dir="${outdir-classes}"/>, +    <java jar="${WTK-home}/bin/proguard.jar" fork="true" failonerror="true">, +      <jvmarg value="-Dmaximum.inlined.code.length=32"/>, +      <arg value="-injars temp.jar"/>, +      <arg value="-outjars temp-optimized.jar"/>, +      <arg value="-libraryjars ${android-jar}"/>, +      <arg value="-keepattributes Exceptions,InnerClasses,Signature,!LocalVariableTable,!LocalVariableTypeTable"/>, +      <arg value="-keep class com.google.zxing.client.android.*Activity"/>, +      <arg value="-target 5"/>, +      <arg value="-optimizationpasses 7"/>, +      <arg value="-allowaccessmodification"/>, +      <arg value="-dontshrink"/>, +      <arg value="-dontobfuscate"/>, +      <arg value="-dontskipnonpubliclibraryclasses"/>, +      <arg value="-verbose"/>, +      <arg value="-dump proguard-dump.txt"/>, +    </java>, +    <delete file="temp.jar"/>, +    <unzip src="temp-optimized.jar" dest="${outdir-classes}" overwrite="true"/>, +    <delete file="temp-optimized.jar"/>, +  </target>, +, +  <target name="dex-optimized" depends="compile-release,optimize">, +    <echo>Converting compiled files and external libraries into ${outdir}/${dex-file}...</echo>, +    <apply executable="${dx}" failonerror="true" parallel="true">, +      <arg value="--dex" />, +      <arg value="--output=${intermediate-dex-ospath}" />, +      <arg path="${outdir-classes-ospath}" />, +      <!-- workaround to appease 'apply'. Not really the right Ant task to use here. -->, +      <fileset dir="." includes="nosuchfile.jar"/>, +    </apply>, +  </target>, +, +  <target name="release" depends="dex-optimized, package-res">, +    <delete file="proguard-dump.txt"/>, +++ b/android/build.xml, +<?xml version="1.0" encoding="UTF-8"?>, +  <target name="compile-release" depends="dirs, resource-src, aidl">, +    <javac encoding="ascii" target="1.5" debug="off" extdirs="", +           srcdir=".", +           destdir="${outdir-classes}", +           bootclasspath="${android-jar}">, +      <classpath>, +        <fileset dir="${external-libs}" includes="*.jar"/>, +      </classpath>, +    </javac>, +  </target>, +, +  <target name="optimize" depends="compile-release">, +    <fail message="Please put proguard.jar in 'bin' under the WTK install directory">, +      <condition>, +        <not>, +          <available file="${WTK-home}/bin/proguard.jar" type="file"/>, +        </not>, +      </condition>, +    </fail>, +    <unzip src="../core/core.jar" dest="${outdir-classes}" overwrite="true"/>, +    <jar jarfile="temp.jar" basedir="${outdir-classes}"/>, +    <delete dir="${outdir-classes}"/>, +    <mkdir dir="${outdir-classes}"/>, +    <java jar="${WTK-home}/bin/proguard.jar" fork="true" failonerror="true">, +      <jvmarg value="-Dmaximum.inlined.code.length=32"/>, +      <arg value="-injars temp.jar"/>, +      <arg value="-outjars temp-optimized.jar"/>, +      <arg value="-libraryjars ${android-jar}"/>, +      <arg value="-keepattributes Exceptions,InnerClasses,Signature,!LocalVariableTable,!LocalVariableTypeTable"/>, +      <arg value="-keep class com.google.zxing.client.android.*Activity"/>, +      <arg value="-target 5"/>, +      <arg value="-optimizationpasses 7"/>, +      <arg value="-allowaccessmodification"/>, +      <arg value="-dontshrink"/>, +      <arg value="-dontobfuscate"/>, +      <arg value="-dontskipnonpubliclibraryclasses"/>, +      <arg value="-verbose"/>, +      <arg value="-dump proguard-dump.txt"/>, +    </java>]