[+++ b/iphone/Classes/Decoder.h, +	CGRect cropRect;, +@property(nonatomic, assign) CGRect cropRect;, +- (void) decodeImage:(UIImage *)image cropRect:(CGRect)cropRect;, +++ b/iphone/Classes/Decoder.h, +	CGRect cropRect;, +@property(nonatomic, assign) CGRect cropRect;, +- (void) decodeImage:(UIImage *)image cropRect:(CGRect)cropRect;, +++ b/iphone/Classes/Decoder.m, +@synthesize cropRect;, +  [self.delegate decoder:self willDecodeImage:self.image usingSubset:self.subsetImage];, +  CGSize size = [image size];, +  NSLog(@"decoding: image is (%.1f x %.1f), cropRect is (%.1f,%.1f)x(%.1f,%.1f)", size.width, size.height,, +				cropRect.origin.x, cropRect.origin.y, cropRect.size.width, cropRect.size.height);, +  float scale = fminf(1.0f, fmaxf(SUBSET_SIZE / cropRect.size.width, SUBSET_SIZE / cropRect.size.height));, +	CGPoint offset = CGPointMake(-cropRect.origin.x, -cropRect.origin.y);, +#ifdef DEBUG, +	NSLog(@"  offset = (%.1f, %.1f), scale = %.3f", offset.x, offset.y, scale);, +#endif, +	, +  subsetWidth = cropRect.size.width * scale;, +  subsetHeight = cropRect.size.height * scale;, +	// adjust the coordinate system, +	CGContextTranslateCTM(ctx, 0.0, subsetHeight);, +	CGContextScaleCTM(ctx, 1.0, -1.0);	, +	UIGraphicsPushContext(ctx);, +	CGRect rect = CGRectMake(offset.x * scale, offset.y * scale, scale * size.width, scale * size.height);, +#ifdef DEBUG, +	NSLog(@"rect for image = (%.1f,%.1f)x(%.1f,%.1f)", rect.origin.x, rect.origin.y, rect.size.width, rect.size.height);, +#endif, +	[image drawInRect:rect];, +	UIGraphicsPopContext();, +  , +  [self decodeImage:i cropRect:CGRectMake(0.0f, 0.0f, image.size.width, image.size.height)];, +- (void) decodeImage:(UIImage *)i cropRect:(CGRect)cr {, +	self.cropRect = cr;, +	[self.delegate decoder:self willDecodeImage:i usingSubset:self.subsetImage];, +, +++ b/iphone/Classes/Decoder.h, +	CGRect cropRect;, +@property(nonatomic, assign) CGRect cropRect;, +- (void) decodeImage:(UIImage *)image cropRect:(CGRect)cropRect;, +++ b/iphone/Classes/Decoder.m, +@synthesize cropRect;, +  [self.delegate decoder:self willDecodeImage:self.image usingSubset:self.subsetImage];, +  CGSize size = [image size];, +  NSLog(@"decoding: image is (%.1f x %.1f), cropRect is (%.1f,%.1f)x(%.1f,%.1f)", size.width, size.height,, +				cropRect.origin.x, cropRect.origin.y, cropRect.size.width, cropRect.size.height);, +  float scale = fminf(1.0f, fmaxf(SUBSET_SIZE / cropRect.size.width, SUBSET_SIZE / cropRect.size.height));, +	CGPoint offset = CGPointMake(-cropRect.origin.x, -cropRect.origin.y);, +#ifdef DEBUG, +	NSLog(@"  offset = (%.1f, %.1f), scale = %.3f", offset.x, offset.y, scale);, +#endif, +	, +  subsetWidth = cropRect.size.width * scale;, +  subsetHeight = cropRect.size.height * scale;, +	// adjust the coordinate system, +	CGContextTranslateCTM(ctx, 0.0, subsetHeight);, +	CGContextScaleCTM(ctx, 1.0, -1.0);	, +	UIGraphicsPushContext(ctx);, +	CGRect rect = CGRectMake(offset.x * scale, offset.y * scale, scale * size.width, scale * size.height);, +#ifdef DEBUG, +	NSLog(@"rect for image = (%.1f,%.1f)x(%.1f,%.1f)", rect.origin.x, rect.origin.y, rect.size.width, rect.size.height);, +#endif, +	[image drawInRect:rect];, +	UIGraphicsPopContext();, +  , +  [self decodeImage:i cropRect:CGRectMake(0.0f, 0.0f, image.size.width, image.size.height)];, +- (void) decodeImage:(UIImage *)i cropRect:(CGRect)cr {, +	self.cropRect = cr;, +	[self.delegate decoder:self willDecodeImage:i usingSubset:self.subsetImage];, +, +++ b/iphone/Classes/DecoderDelegate.h, +- (void)decoder:(Decoder *)decoder willDecodeImage:(UIImage *)image usingSubset:(UIImage *)subset;, +++ b/iphone/Classes/Decoder.h, +	CGRect cropRect;, +@property(nonatomic, assign) CGRect cropRect;, +- (void) decodeImage:(UIImage *)image cropRect:(CGRect)cropRect;, +++ b/iphone/Classes/Decoder.m, +@synthesize cropRect;, +  [self.delegate decoder:self willDecodeImage:self.image usingSubset:self.subsetImage];, +  CGSize size = [image size];, +  NSLog(@"decoding: image is (%.1f x %.1f), cropRect is (%.1f,%.1f)x(%.1f,%.1f)", size.width, size.height,, +				cropRect.origin.x, cropRect.origin.y, cropRect.size.width, cropRect.size.height);, +  float scale = fminf(1.0f, fmaxf(SUBSET_SIZE / cropRect.size.width, SUBSET_SIZE / cropRect.size.height));, +	CGPoint offset = CGPointMake(-cropRect.origin.x, -cropRect.origin.y);, +#ifdef DEBUG, +	NSLog(@"  offset = (%.1f, %.1f), scale = %.3f", offset.x, offset.y, scale);, +#endif, +	, +  subsetWidth = cropRect.size.width * scale;, +  subsetHeight = cropRect.size.height * scale;, +	// adjust the coordinate system, +	CGContextTranslateCTM(ctx, 0.0, subsetHeight);, +	CGContextScaleCTM(ctx, 1.0, -1.0);	, +	UIGraphicsPushContext(ctx);, +	CGRect rect = CGRectMake(offset.x * scale, offset.y * scale, scale * size.width, scale * size.height);, +#ifdef DEBUG, +	NSLog(@"rect for image = (%.1f,%.1f)x(%.1f,%.1f)", rect.origin.x, rect.origin.y, rect.size.width, rect.size.height);, +#endif]