[+++ b/iphone/Barcodes/Classes/BarcodesAppDelegate.h, +#import "ZXMainViewController.h", +  ZXMainViewController *viewController;, +@property (nonatomic, retain) IBOutlet ZXMainViewController *viewController;, +, +- (void)registerView:(ZXMainViewController*)controller;, +, +++ b/iphone/Barcodes/Classes/BarcodesAppDelegate.h, +#import "ZXMainViewController.h", +  ZXMainViewController *viewController;, +@property (nonatomic, retain) IBOutlet ZXMainViewController *viewController;, +, +- (void)registerView:(ZXMainViewController*)controller;, +, +++ b/iphone/Barcodes/Classes/BarcodesAppDelegate.m, +@synthesize viewController;, +- (BOOL)myOpenURL:(NSURL*)url {, +    if (!url) return NO;, +    if ([[url scheme] isEqualToString:@"zxing"]) {, +        if ([[url host] isEqualToString:@"scan"]) {, +            NSArray *pairs = [[url query] componentsSeparatedByString:@"&amp;"];, +        , +            for (NSString *pair in pairs) {, +                NSArray *elements = [pair componentsSeparatedByString:@"="];, +                NSString *key = [[elements objectAtIndex:0] stringByReplacingPercentEscapesUsingEncoding:NSUTF8StringEncoding];, +                NSString *val = [[elements objectAtIndex:1] stringByReplacingPercentEscapesUsingEncoding:NSUTF8StringEncoding];, +            , +                if ([key isEqualToString:@"ret"]) {, +                    [[NSUserDefaults standardUserDefaults] setObject:val forKey:@"returnURL"];, +                    [[NSUserDefaults standardUserDefaults] synchronize];, +                    [[self viewController] scan:nil];, +                }, +                if ([key isEqualToString:@"SCAN_FORMATS"]) {, +                    // Storing these, but they effect nothing yet., +                    NSArray *formats = [val componentsSeparatedByString:@","];, +                    [[NSUserDefaults standardUserDefaults] setObject:formats forKey:@"scanFormats"];, +                    [[NSUserDefaults standardUserDefaults] synchronize];, +                }, +            }, +        }, +        return YES;, +    } else {, +        return NO;, +    }, +}, +, +- (void)registerView:(ZXMainViewController*)controller {, +    [self setViewController:controller];, +}, +, +  // Check if launching from URL, +  NSURL *url = [launchOptions objectForKey: UIApplicationLaunchOptionsURLKey];, +  if ([url isMemberOfClass: [NSURL class]]) {, +    return [self myOpenURL: url];, +  } else {, +    // Clear the return URL so the application goes back to working as normal..., +    [[NSUserDefaults standardUserDefaults] removeObjectForKey:@"returnURL"];, +    [[NSUserDefaults standardUserDefaults] removeObjectForKey:@"scanFormats"];, +    [[NSUserDefaults standardUserDefaults] synchronize];, +  }, +    , +- (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url , +{, +    return [self myOpenURL: url];, +}, +    , +    // Clear the return URL so the application goes back to working as normal..., +    [[NSUserDefaults standardUserDefaults] removeObjectForKey:@"returnURL"];, +    [[NSUserDefaults standardUserDefaults] removeObjectForKey:@"scanFormats"];, +    [[NSUserDefaults standardUserDefaults] synchronize];, +++ b/iphone/Barcodes/Classes/BarcodesAppDelegate.h, +#import "ZXMainViewController.h", +  ZXMainViewController *viewController;, +@property (nonatomic, retain) IBOutlet ZXMainViewController *viewController;, +, +- (void)registerView:(ZXMainViewController*)controller;, +, +++ b/iphone/Barcodes/Classes/BarcodesAppDelegate.m, +@synthesize viewController;, +- (BOOL)myOpenURL:(NSURL*)url {, +    if (!url) return NO;, +    if ([[url scheme] isEqualToString:@"zxing"]) {, +        if ([[url host] isEqualToString:@"scan"]) {, +            NSArray *pairs = [[url query] componentsSeparatedByString:@"&amp;"];, +        , +            for (NSString *pair in pairs) {, +                NSArray *elements = [pair componentsSeparatedByString:@"="];, +                NSString *key = [[elements objectAtIndex:0] stringByReplacingPercentEscapesUsingEncoding:NSUTF8StringEncoding];, +                NSString *val = [[elements objectAtIndex:1] stringByReplacingPercentEscapesUsingEncoding:NSUTF8StringEncoding];, +            , +                if ([key isEqualToString:@"ret"]) {, +                    [[NSUserDefaults standardUserDefaults] setObject:val forKey:@"returnURL"];, +                    [[NSUserDefaults standardUserDefaults] synchronize];, +                    [[self viewController] scan:nil];, +                }, +                if ([key isEqualToString:@"SCAN_FORMATS"]) {, +                    // Storing these, but they effect nothing yet., +                    NSArray *formats = [val componentsSeparatedByString:@","];, +                    [[NSUserDefaults standardUserDefaults] setObject:formats forKey:@"scanFormats"];, +                    [[NSUserDefaults standardUserDefaults] synchronize];]