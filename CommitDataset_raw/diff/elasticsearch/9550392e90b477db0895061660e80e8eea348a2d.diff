[+++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +     * Should the source be transformed using the script to used at index time, +     * (if any)? Note that calling this without having called setFetchSource, +     * will automatically turn on source fetching., +     *, +     * @return this for chaining, +     */, +    public GetRequestBuilder setTransformSource(boolean transform) {, +        FetchSourceContext context = request.fetchSourceContext();, +        if (context == null) {, +            context = new FetchSourceContext(true);, +            request.fetchSourceContext(context);, +        }, +        context.transformSource(transform);, +        return this;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +     * Should the source be transformed using the script to used at index time, +     * (if any)? Note that calling this without having called setFetchSource, +     * will automatically turn on source fetching., +     *, +     * @return this for chaining, +     */, +    public GetRequestBuilder setTransformSource(boolean transform) {, +        FetchSourceContext context = request.fetchSourceContext();, +        if (context == null) {, +            context = new FetchSourceContext(true);, +            request.fetchSourceContext(context);, +        }, +        context.transformSource(transform);, +        return this;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +import org.elasticsearch.script.ScriptService;, +, +    private final ScriptService scriptService;, +, +    public MetaDataIndexUpgradeService(Settings settings, ScriptService scriptService) {, +        this.scriptService = scriptService;, +, +                try (MapperService mapperService = new MapperService(indexSettings, analysisService, similarityService, scriptService)) {, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +     * Should the source be transformed using the script to used at index time, +     * (if any)? Note that calling this without having called setFetchSource, +     * will automatically turn on source fetching., +     *, +     * @return this for chaining, +     */, +    public GetRequestBuilder setTransformSource(boolean transform) {, +        FetchSourceContext context = request.fetchSourceContext();, +        if (context == null) {, +            context = new FetchSourceContext(true);, +            request.fetchSourceContext(context);, +        }, +        context.transformSource(transform);, +        return this;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +import org.elasticsearch.script.ScriptService;, +, +    private final ScriptService scriptService;, +, +    public MetaDataIndexUpgradeService(Settings settings, ScriptService scriptService) {, +        this.scriptService = scriptService;, +, +                try (MapperService mapperService = new MapperService(indexSettings, analysisService, similarityService, scriptService)) {, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (fetchSourceContext.transformSource() || sourceFieldFiltering || sourceFetchFiltering) {, +                        if (fetchSourceContext.transformSource()) {, +                            sourceAsMap = docMapper.transformSourceAsMap(sourceAsMap);, +                        }, +        } else if (fetchSourceContext.transformSource() || fetchSourceContext.includes().length > 0 || fetchSourceContext.excludes().length > 0) {, +            if (fetchSourceContext.transformSource()) {, +                sourceAsMap = docMapper.transformSourceAsMap(sourceAsMap);, +            }, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +     * Should the source be transformed using the script to used at index time, +     * (if any)? Note that calling this without having called setFetchSource, +     * will automatically turn on source fetching., +     *, +     * @return this for chaining, +     */, +    public GetRequestBuilder setTransformSource(boolean transform) {, +        FetchSourceContext context = request.fetchSourceContext();, +        if (context == null) {, +            context = new FetchSourceContext(true);, +            request.fetchSourceContext(context);, +        }, +        context.transformSource(transform);, +        return this;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java]