[+++ b/src/main/java/org/elasticsearch/index/analysis/AbstractTokenizerFactory.java, +, +++ b/src/main/java/org/elasticsearch/index/analysis/AbstractTokenizerFactory.java, +, +++ b/src/main/java/org/elasticsearch/index/analysis/EdgeNGramTokenFilterFactory.java, +import org.apache.lucene.analysis.ngram.EdgeNGramTokenFilter;, +import org.apache.lucene.analysis.ngram.Lucene43EdgeNGramTokenizer;, +import org.apache.lucene.analysis.ngram.NGramTokenFilter;, +import org.elasticsearch.cluster.metadata.IndexMetaData;, +    private org.elasticsearch.Version esVersion;, +, +        this.esVersion = indexSettings.getAsVersion(IndexMetaData.SETTING_VERSION_CREATED, org.elasticsearch.Version.CURRENT);, +        if (version.onOrAfter(Version.LUCENE_43) && esVersion.onOrAfter(org.elasticsearch.Version.V_0_90_2)) {, +            /*, +             * We added this in 0.90.2 but 0.90.1 used LUCENE_43 already so we can not rely on the lucene version., +             * Yet if somebody uses 0.90.2 or higher with a prev. lucene version we should also use the deprecated version., +             */, +            final Version version = this.version == Version.LUCENE_43 ? Version.LUCENE_44 : this.version; // always use 4.4 or higher, +++ b/src/main/java/org/elasticsearch/index/analysis/AbstractTokenizerFactory.java, +, +++ b/src/main/java/org/elasticsearch/index/analysis/EdgeNGramTokenFilterFactory.java, +import org.apache.lucene.analysis.ngram.EdgeNGramTokenFilter;, +import org.apache.lucene.analysis.ngram.Lucene43EdgeNGramTokenizer;, +import org.apache.lucene.analysis.ngram.NGramTokenFilter;, +import org.elasticsearch.cluster.metadata.IndexMetaData;, +    private org.elasticsearch.Version esVersion;, +, +        this.esVersion = indexSettings.getAsVersion(IndexMetaData.SETTING_VERSION_CREATED, org.elasticsearch.Version.CURRENT);, +        if (version.onOrAfter(Version.LUCENE_43) && esVersion.onOrAfter(org.elasticsearch.Version.V_0_90_2)) {, +            /*, +             * We added this in 0.90.2 but 0.90.1 used LUCENE_43 already so we can not rely on the lucene version., +             * Yet if somebody uses 0.90.2 or higher with a prev. lucene version we should also use the deprecated version., +             */, +            final Version version = this.version == Version.LUCENE_43 ? Version.LUCENE_44 : this.version; // always use 4.4 or higher, +++ b/src/main/java/org/elasticsearch/index/analysis/EdgeNGramTokenizerFactory.java, +import org.elasticsearch.cluster.metadata.IndexMetaData;, +    protected org.elasticsearch.Version esVersion;, +, +, +        this.esVersion = indexSettings.getAsVersion(IndexMetaData.SETTING_VERSION_CREATED, org.elasticsearch.Version.CURRENT);, +        if (version.onOrAfter(Version.LUCENE_43) && esVersion.onOrAfter(org.elasticsearch.Version.V_0_90_2)) {, +            /*, +             * We added this in 0.90.2 but 0.90.1 used LUCENE_43 already so we can not rely on the lucene version., +             * Yet if somebody uses 0.90.2 or higher with a prev. lucene version we should also use the deprecated version., +             */, +                throw new ElasticSearchIllegalArgumentException("side=back is not supported anymore. Please fix your analysis chain or use", +                        + " an older compatibility version (<=4.2) but beware that it might cause highlighting bugs." , +                        + " To obtain the same behavior as the previous version please use \"edgeNGram\" filter which still supports side=back" , +                        + " in combination with a \"keyword\" tokenizer");, +            final Version version = this.version == Version.LUCENE_43 ? Version.LUCENE_44 : this.version; // always use 4.4 or higher, +++ b/src/main/java/org/elasticsearch/index/analysis/AbstractTokenizerFactory.java, +, +++ b/src/main/java/org/elasticsearch/index/analysis/EdgeNGramTokenFilterFactory.java, +import org.apache.lucene.analysis.ngram.EdgeNGramTokenFilter;, +import org.apache.lucene.analysis.ngram.Lucene43EdgeNGramTokenizer;, +import org.apache.lucene.analysis.ngram.NGramTokenFilter;, +import org.elasticsearch.cluster.metadata.IndexMetaData;, +    private org.elasticsearch.Version esVersion;, +, +        this.esVersion = indexSettings.getAsVersion(IndexMetaData.SETTING_VERSION_CREATED, org.elasticsearch.Version.CURRENT);, +        if (version.onOrAfter(Version.LUCENE_43) && esVersion.onOrAfter(org.elasticsearch.Version.V_0_90_2)) {, +            /*, +             * We added this in 0.90.2 but 0.90.1 used LUCENE_43 already so we can not rely on the lucene version., +             * Yet if somebody uses 0.90.2 or higher with a prev. lucene version we should also use the deprecated version., +             */, +            final Version version = this.version == Version.LUCENE_43 ? Version.LUCENE_44 : this.version; // always use 4.4 or higher, +++ b/src/main/java/org/elasticsearch/index/analysis/EdgeNGramTokenizerFactory.java, +import org.elasticsearch.cluster.metadata.IndexMetaData;, +    protected org.elasticsearch.Version esVersion;, +, +, +        this.esVersion = indexSettings.getAsVersion(IndexMetaData.SETTING_VERSION_CREATED, org.elasticsearch.Version.CURRENT);, +        if (version.onOrAfter(Version.LUCENE_43) && esVersion.onOrAfter(org.elasticsearch.Version.V_0_90_2)) {, +            /*, +             * We added this in 0.90.2 but 0.90.1 used LUCENE_43 already so we can not rely on the lucene version., +             * Yet if somebody uses 0.90.2 or higher with a prev. lucene version we should also use the deprecated version., +             */, +                throw new ElasticSearchIllegalArgumentException("side=back is not supported anymore. Please fix your analysis chain or use", +                        + " an older compatibility version (<=4.2) but beware that it might cause highlighting bugs." , +                        + " To obtain the same behavior as the previous version please use \"edgeNGram\" filter which still supports side=back" , +                        + " in combination with a \"keyword\" tokenizer");, +            final Version version = this.version == Version.LUCENE_43 ? Version.LUCENE_44 : this.version; // always use 4.4 or higher, +++ b/src/main/java/org/elasticsearch/index/analysis/NGramTokenizerFactory.java, +import org.elasticsearch.cluster.metadata.IndexMetaData;, +    private org.elasticsearch.Version esVersion;, +        this.esVersion = indexSettings.getAsVersion(IndexMetaData.SETTING_VERSION_CREATED, org.elasticsearch.Version.CURRENT);, +        if (version.onOrAfter(Version.LUCENE_43) && esVersion.onOrAfter(org.elasticsearch.Version.V_0_90_2)) {, +            /*, +             * We added this in 0.90.2 but 0.90.1 used LUCENE_43 already so we can not rely on the lucene version., +             * Yet if somebody uses 0.90.2 or higher with a prev. lucene version we should also use the deprecated version., +             */, +            final Version version = this.version == Version.LUCENE_43 ? Version.LUCENE_44 : this.version; // always use 4.4 or higher, +++ b/src/main/java/org/elasticsearch/index/analysis/AbstractTokenizerFactory.java, +, +++ b/src/main/java/org/elasticsearch/index/analysis/EdgeNGramTokenFilterFactory.java, +import org.apache.lucene.analysis.ngram.EdgeNGramTokenFilter;, +import org.apache.lucene.analysis.ngram.Lucene43EdgeNGramTokenizer;, +import org.apache.lucene.analysis.ngram.NGramTokenFilter;, +import org.elasticsearch.cluster.metadata.IndexMetaData;, +    private org.elasticsearch.Version esVersion;]