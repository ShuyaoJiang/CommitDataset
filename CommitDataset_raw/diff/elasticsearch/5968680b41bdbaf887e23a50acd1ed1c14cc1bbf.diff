[+++ b/src/test/java/org/elasticsearch/search/aggregations/bucket/NestedTests.java, +import org.elasticsearch.search.aggregations.bucket.nested.Nested;, +        int totalChildren = 0;, +            if (i == numParents - 1 && totalChildren == 0) {, +                // we need at least one child overall, +                numChildren[i] = randomIntBetween(1, 5);, +            } else {, +            totalChildren += numChildren[i];, +        }, +        assert totalChildren > 0;]