[+++ b/src/test/java/org/elasticsearch/test/integration/percolator/SimplePercolatorTests.java, +import org.elasticsearch.action.admin.indices.exists.types.TypesExistsResponse;, +import org.elasticsearch.client.Client;, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertNoFailures;, +        percolatorTypeRemoved("test1");, +        assertNoFailures(response);, +        percolatorTypeRemoved("test2");, +        assertNoFailures(response);, +    private void percolatorTypeRemoved(String index) {, +        my_goto: while (true) {, +            for (Client client : clients()) {, +                TypesExistsResponse existsResponse =, +                        client.admin().indices().prepareTypesExists(index).setTypes("_percolator").execute().actionGet();, +                if (existsResponse.isExists()) {, +                    continue my_goto;, +                }, +            }, +            break;, +        }, +    }, +]