[+++ b/modules/elasticsearch/src/main/java/org/apache/lucene/search/DeletionAwareConstantScoreQuery.java, +        if (!(o instanceof DeletionAwareConstantScoreQuery)) return false;, +        DeletionAwareConstantScoreQuery other = (DeletionAwareConstantScoreQuery) o;, +++ b/modules/elasticsearch/src/main/java/org/apache/lucene/search/DeletionAwareConstantScoreQuery.java, +        if (!(o instanceof DeletionAwareConstantScoreQuery)) return false;, +        DeletionAwareConstantScoreQuery other = (DeletionAwareConstantScoreQuery) o;, +++ b/modules/elasticsearch/src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java, +        } else if (sourceQuery instanceof DeletionAwareConstantScoreQuery) {, +            flatten(((DeletionAwareConstantScoreQuery) sourceQuery).getFilter(), flatQueries);, +++ b/modules/elasticsearch/src/main/java/org/apache/lucene/search/DeletionAwareConstantScoreQuery.java, +        if (!(o instanceof DeletionAwareConstantScoreQuery)) return false;, +        DeletionAwareConstantScoreQuery other = (DeletionAwareConstantScoreQuery) o;, +++ b/modules/elasticsearch/src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java, +        } else if (sourceQuery instanceof DeletionAwareConstantScoreQuery) {, +            flatten(((DeletionAwareConstantScoreQuery) sourceQuery).getFilter(), flatQueries);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facets/FacetsPhase.java, +            Query query = new DeletionAwareConstantScoreQuery(context.filterCache().cache(Queries.MATCH_ALL_FILTER));]