[+++ b/core/src/main/java/org/elasticsearch/threadpool/ThreadPool.java, +            if (awaitTermination(service, timeout, timeUnit)) return true;, +            service.shutdownNow();, +            return awaitTermination(service, timeout, timeUnit);, +        }, +        return false;, +    }, +, +    private static boolean awaitTermination(, +            final ExecutorService service,, +            final long timeout,, +            final TimeUnit timeUnit) {, +        } catch (final InterruptedException e) {, +                if (awaitTermination(pool, timeout, timeUnit)) return true;, +                // last resort, +                pool.shutdownNow();, +                return awaitTermination(pool, timeout, timeUnit);, +            } finally {, +                IOUtils.closeWhileHandlingException(pool);, +            }, +        }, +        return false;, +    }, +, +    private static boolean awaitTermination(, +            final ThreadPool pool,, +            final long timeout,, +            final TimeUnit timeUnit) {]