[+++ b/x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/action/TransportOpenJobActionTests.java, +import org.elasticsearch.action.support.IndicesOptions;, +import org.elasticsearch.cluster.metadata.IndexNameExpressionResolver;, +        IndexNameExpressionResolver indexNameExpressionResolver = new IndexNameExpressionResolver();, +        String indexToRemove = randomFrom(indexNameExpressionResolver.concreteIndexNames(cs, IndicesOptions.lenientExpandOpen(),, +            TransportOpenJobAction.indicesOfInterest(".ml-anomalies-shared")));, +++ b/x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/action/TransportOpenJobActionTests.java, +import org.elasticsearch.action.support.IndicesOptions;, +import org.elasticsearch.cluster.metadata.IndexNameExpressionResolver;, +        IndexNameExpressionResolver indexNameExpressionResolver = new IndexNameExpressionResolver();, +        String indexToRemove = randomFrom(indexNameExpressionResolver.concreteIndexNames(cs, IndicesOptions.lenientExpandOpen(),, +            TransportOpenJobAction.indicesOfInterest(".ml-anomalies-shared")));, +++ b/x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/integration/BasicDistributedJobsIT.java, +import static org.hamcrest.Matchers.containsString;, +        assertThat(detailedMessage, containsString("because not all primary shards are active for the following indices"));, +        assertThat(detailedMessage, containsString(".ml-state"));, +        assertThat(detailedMessage, containsString(".ml-anomalies-shared"));, +++ b/x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/action/TransportOpenJobActionTests.java, +import org.elasticsearch.action.support.IndicesOptions;, +import org.elasticsearch.cluster.metadata.IndexNameExpressionResolver;, +        IndexNameExpressionResolver indexNameExpressionResolver = new IndexNameExpressionResolver();, +        String indexToRemove = randomFrom(indexNameExpressionResolver.concreteIndexNames(cs, IndicesOptions.lenientExpandOpen(),, +            TransportOpenJobAction.indicesOfInterest(".ml-anomalies-shared")));, +++ b/x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/integration/BasicDistributedJobsIT.java, +import static org.hamcrest.Matchers.containsString;, +        assertThat(detailedMessage, containsString("because not all primary shards are active for the following indices"));, +        assertThat(detailedMessage, containsString(".ml-state"));, +        assertThat(detailedMessage, containsString(".ml-anomalies-shared"));, +++ b/x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/integration/MlConfigMigratorIT.java, +        client().admin().indices().prepareRefresh(AnomalyDetectorsIndex.jobStateIndexPattern()).get();]