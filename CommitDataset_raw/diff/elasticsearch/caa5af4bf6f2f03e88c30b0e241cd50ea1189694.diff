[+++ b/src/test/java/org/elasticsearch/indices/mapping/ConcurrentDynamicTemplateTests.java, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.common.xcontent.XContentFactory;, +import org.elasticsearch.index.fielddata.FieldDataType;, +import org.elasticsearch.index.mapper.FieldMapper;, +        int numberOfFields = scaledRandomIntBetween(1, 50);, +, +        XContentBuilder mappings = XContentFactory.jsonBuilder().startObject().startObject("_default_");, +        mappings.startArray("dynamic_templates"), +                .startObject(), +                .startObject("template-strings"), +                .field("match_mapping_type", "string"), +                .startObject("mapping"), +                .startObject("fielddata"), +                .field(FieldDataType.FORMAT_KEY, randomFrom("paged_bytes", "fst")), +                .field(FieldMapper.Loading.KEY, FieldMapper.Loading.LAZY) // always use lazy loading, +                .endObject(), +                .endObject(), +                .endObject(), +                .endObject(), +                .startObject(), +                .startObject("template-longs"), +                .field("match_mapping_type", "long"), +                .startObject("mapping"), +                .startObject("fielddata"), +                .field(FieldDataType.FORMAT_KEY, randomFrom("array", "doc_values")), +                .field(FieldMapper.Loading.KEY, FieldMapper.Loading.LAZY), +                .endObject(), +                .endObject(), +                .endObject(), +                .endObject(), +                .startObject(), +                .startObject("template-doubles"), +                .field("match_mapping_type", "double"), +                .startObject("mapping"), +                .startObject("fielddata"), +                .field(FieldDataType.FORMAT_KEY, randomFrom("array", "doc_values")), +                .field(FieldMapper.Loading.KEY, FieldMapper.Loading.LAZY), +                .endObject(), +                .endObject(), +                .endObject(), +                .endObject(), +                .endArray();, +        mappings.endObject().endObject();, +, +        assertAcked(client().admin().indices().prepareCreate("idx").addMapping("_default_", mappings));, +        ensureGreen("idx");, +                    .field("d_value_" + fieldIdx, (double)i + 0.01)]