[+++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +    final String cause;, +    final String index;, +    CreateIndexClusterStateUpdateRequest(String cause, String index) {, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +    final String cause;, +    final String index;, +    CreateIndexClusterStateUpdateRequest(String cause, String index) {, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +        CreateIndexClusterStateUpdateRequest updateRequest = new CreateIndexClusterStateUpdateRequest(cause, request.index()), +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +    final String cause;, +    final String index;, +    CreateIndexClusterStateUpdateRequest(String cause, String index) {, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +        CreateIndexClusterStateUpdateRequest updateRequest = new CreateIndexClusterStateUpdateRequest(cause, request.index()), +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +    final String cause;, +    final String index;, +    CreateIndexClusterStateUpdateRequest(String cause, String index) {, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +        CreateIndexClusterStateUpdateRequest updateRequest = new CreateIndexClusterStateUpdateRequest(cause, request.index()), +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +    final String cause;, +    final String index;, +    CreateIndexClusterStateUpdateRequest(String cause, String index) {, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +        CreateIndexClusterStateUpdateRequest updateRequest = new CreateIndexClusterStateUpdateRequest(cause, request.index()), +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java, +++ b/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +import org.elasticsearch.cluster.action.index.*;, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +    final String cause;, +    final String index;, +    CreateIndexClusterStateUpdateRequest(String cause, String index) {, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +        CreateIndexClusterStateUpdateRequest updateRequest = new CreateIndexClusterStateUpdateRequest(cause, request.index()), +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java, +++ b/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +import org.elasticsearch.cluster.action.index.*;, +++ /dev/null, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +    final String cause;, +    final String index;, +    CreateIndexClusterStateUpdateRequest(String cause, String index) {, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +        CreateIndexClusterStateUpdateRequest updateRequest = new CreateIndexClusterStateUpdateRequest(cause, request.index()), +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java, +++ b/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +import org.elasticsearch.cluster.action.index.*;, +++ /dev/null, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import java.util.Comparator;, +import java.util.List;, +import java.util.Locale;, +import java.util.Map;, +                                      AliasValidator aliasValidator) {, +        ImmutableSettings.Builder updatedSettingsBuilder = ImmutableSettings.settingsBuilder();, +        for (Map.Entry<String, String> entry : request.settings().getAsMap().entrySet()) {, +            if (!entry.getKey().startsWith("index.")) {, +                updatedSettingsBuilder.put("index." + entry.getKey(), entry.getValue());, +            } else {, +                updatedSettingsBuilder.put(entry.getKey(), entry.getValue());, +            }, +        }, +        request.settings(updatedSettingsBuilder.build());, +                    List<IndexTemplateMetaData> templates = findTemplates(request, currentState);, +    private List<IndexTemplateMetaData> findTemplates(CreateIndexClusterStateUpdateRequest request, ClusterState state) {, +            if (Regex.simpleMatch(template.template(), request.index())) {, +                        if (Regex.simpleMatch(template.template(), request.index())) {, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +    final String cause;, +    final String index;, +    CreateIndexClusterStateUpdateRequest(String cause, String index) {, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +        CreateIndexClusterStateUpdateRequest updateRequest = new CreateIndexClusterStateUpdateRequest(cause, request.index()), +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java, +++ b/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +import org.elasticsearch.cluster.action.index.*;, +++ /dev/null, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import java.util.Comparator;, +import java.util.List;, +import java.util.Locale;, +import java.util.Map;, +                                      AliasValidator aliasValidator) {, +        ImmutableSettings.Builder updatedSettingsBuilder = ImmutableSettings.settingsBuilder();, +        for (Map.Entry<String, String> entry : request.settings().getAsMap().entrySet()) {, +            if (!entry.getKey().startsWith("index.")) {, +                updatedSettingsBuilder.put("index." + entry.getKey(), entry.getValue());, +            } else {, +                updatedSettingsBuilder.put(entry.getKey(), entry.getValue());, +            }]