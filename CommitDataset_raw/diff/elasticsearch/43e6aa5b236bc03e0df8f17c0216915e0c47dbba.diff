[+++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionEntry.java, +    private AlertActionState state;, +        this.state = state;, +    public AlertActionState getState() {, +        return state;, +    public void setState(AlertActionState state) {, +        this.state = state;, +        historyEntry.field(AlertActionManager.STATE, state.toString());, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionEntry.java, +    private AlertActionState state;, +        this.state = state;, +    public AlertActionState getState() {, +        return state;, +    public void setState(AlertActionState state) {, +        this.state = state;, +        historyEntry.field(AlertActionManager.STATE, state.toString());, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionManager.java, +    public static final String STATE = "state";, +                .setQuery(QueryBuilders.termQuery(STATE, AlertActionState.SEARCH_NEEDED.toString())), +                        assert historyEntry.getState() == AlertActionState.SEARCH_NEEDED;, +                        case STATE:, +                            entry.setState(AlertActionState.fromString(parser.text()));, +        entry.setState(actionPerformed);, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionEntry.java, +    private AlertActionState state;, +        this.state = state;, +    public AlertActionState getState() {, +        return state;, +    public void setState(AlertActionState state) {, +        this.state = state;, +        historyEntry.field(AlertActionManager.STATE, state.toString());, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionManager.java, +    public static final String STATE = "state";, +                .setQuery(QueryBuilders.termQuery(STATE, AlertActionState.SEARCH_NEEDED.toString())), +                        assert historyEntry.getState() == AlertActionState.SEARCH_NEEDED;, +                        case STATE:, +                            entry.setState(AlertActionState.fromString(parser.text()));, +        entry.setState(actionPerformed);, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionState.java, +public enum AlertActionState {, +, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionEntry.java, +    private AlertActionState state;, +        this.state = state;, +    public AlertActionState getState() {, +        return state;, +    public void setState(AlertActionState state) {, +        this.state = state;, +        historyEntry.field(AlertActionManager.STATE, state.toString());, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionManager.java, +    public static final String STATE = "state";, +                .setQuery(QueryBuilders.termQuery(STATE, AlertActionState.SEARCH_NEEDED.toString())), +                        assert historyEntry.getState() == AlertActionState.SEARCH_NEEDED;, +                        case STATE:, +                            entry.setState(AlertActionState.fromString(parser.text()));, +        entry.setState(actionPerformed);, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionState.java, +public enum AlertActionState {, +, +++ b/src/test/java/org/elasticsearch/alerts/actions/AlertActionsTest.java, +        builder.field(AlertActionManager.STATE, AlertActionState.SEARCH_NEEDED.toString());, +        assertEquals(actionEntry.getState(), AlertActionState.SEARCH_NEEDED);]