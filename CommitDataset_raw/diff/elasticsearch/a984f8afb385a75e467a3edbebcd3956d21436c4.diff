[+++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/build.gradle, +    extraConfigFile 'roles.yml', 'leader-roles.yml', +    extraConfigFile 'roles.yml', 'follower-roles.yml', +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/build.gradle, +    extraConfigFile 'roles.yml', 'leader-roles.yml', +    extraConfigFile 'roles.yml', 'follower-roles.yml', +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/follower-roles.yml, +ccruser:, +  cluster:, +    - manage_ccr, +  indices:, +    - names: [ 'allowed-index', 'logs-eu-*' ], +      privileges:, +        - monitor, +        - read, +        - write, +        - create_follow_index, +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/build.gradle, +    extraConfigFile 'roles.yml', 'leader-roles.yml', +    extraConfigFile 'roles.yml', 'follower-roles.yml', +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/follower-roles.yml, +ccruser:, +  cluster:, +    - manage_ccr, +  indices:, +    - names: [ 'allowed-index', 'logs-eu-*' ], +      privileges:, +        - monitor, +        - read, +        - write, +        - create_follow_index, +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/leader-roles.yml, +ccruser:, +  cluster:, +    - read_ccr, +  indices:, +    - names: [ 'allowed-index', 'logs-eu-*' ], +      privileges:, +        - monitor, +        - read, +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/build.gradle, +    extraConfigFile 'roles.yml', 'leader-roles.yml', +    extraConfigFile 'roles.yml', 'follower-roles.yml', +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/follower-roles.yml, +ccruser:, +  cluster:, +    - manage_ccr, +  indices:, +    - names: [ 'allowed-index', 'logs-eu-*' ], +      privileges:, +        - monitor, +        - read, +        - write, +        - create_follow_index, +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/leader-roles.yml, +ccruser:, +  cluster:, +    - read_ccr, +  indices:, +    - names: [ 'allowed-index', 'logs-eu-*' ], +      privileges:, +        - monitor, +        - read, +++ /dev/null, +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/build.gradle, +    extraConfigFile 'roles.yml', 'leader-roles.yml', +    extraConfigFile 'roles.yml', 'follower-roles.yml', +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/follower-roles.yml, +ccruser:, +  cluster:, +    - manage_ccr, +  indices:, +    - names: [ 'allowed-index', 'logs-eu-*' ], +      privileges:, +        - monitor, +        - read, +        - write, +        - create_follow_index, +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/leader-roles.yml, +ccruser:, +  cluster:, +    - read_ccr, +  indices:, +    - names: [ 'allowed-index', 'logs-eu-*' ], +      privileges:, +        - monitor, +        - read, +++ /dev/null, +++ b/x-pack/plugin/ccr/qa/multi-cluster-with-security/src/test/java/org/elasticsearch/xpack/ccr/FollowIndexSecurityIT.java, +            // User does not have create_follow_index index privilege for 'unallowedIndex':, +            // User does have create_follow_index index privilege on 'allowed' index,, +            // but not read / monitor roles on 'disallowed' index:, +            e = expectThrows(ResponseException.class,, +                () -> follow("leader_cluster:" + unallowedIndex, allowedIndex));, +            assertThat(e.getMessage(), containsString("insufficient privileges to follow index [unallowed-index], " +, +                "privilege for action [indices:monitor/stats] is missing, " +, +                "privilege for action [indices:data/read/xpack/ccr/shard_changes] is missing"));, +            // Verify that the follow index has not been created and no node tasks are running, +            assertThat(indexExists(adminClient(), unallowedIndex), is(false));, +            assertBusy(() -> assertThat(countCcrNodeTasks(), equalTo(0)));]