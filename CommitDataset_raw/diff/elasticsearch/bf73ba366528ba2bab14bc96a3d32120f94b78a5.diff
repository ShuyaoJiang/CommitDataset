[+++ b/src/main/java/org/elasticsearch/shield/authc/support/UsernamePasswordToken.java, +    private static final String TOKEN_KEY = "X-ES-UsernamePasswordToken";, +, +        UsernamePasswordToken token = (UsernamePasswordToken) request.context().get(TOKEN_KEY);, +        String authStr = request.getHeader(BASIC_AUTH_HEADER);, +            request.context().put(TOKEN_KEY, defaultToken);, +        request.context().put(TOKEN_KEY, token);, +++ b/src/main/java/org/elasticsearch/shield/authc/support/UsernamePasswordToken.java, +    private static final String TOKEN_KEY = "X-ES-UsernamePasswordToken";, +, +        UsernamePasswordToken token = (UsernamePasswordToken) request.context().get(TOKEN_KEY);, +        String authStr = request.getHeader(BASIC_AUTH_HEADER);, +            request.context().put(TOKEN_KEY, defaultToken);, +        request.context().put(TOKEN_KEY, token);, +++ b/src/test/java/org/elasticsearch/shield/authc/support/UsernamePasswordTokenTests.java, +, +        // making sure that indeed, once resolved the instance is reused across multiple resolve calls, +        UsernamePasswordToken token2 = UsernamePasswordToken.extractToken(request, null);, +        assertThat(token, is(token2));]