[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/RealmConfig.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/RealmConfig.java, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/InternalRealmsTests.java, +import org.elasticsearch.env.Environment;, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier(NativeRealmSettings.TYPE, "test");, +        final Environment env = TestEnvironment.newEnvironment(settings);, +        final ThreadContext threadContext = new ThreadContext(settings);, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/RealmConfig.java, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/InternalRealmsTests.java, +import org.elasticsearch.env.Environment;, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier(NativeRealmSettings.TYPE, "test");, +        final Environment env = TestEnvironment.newEnvironment(settings);, +        final ThreadContext threadContext = new ThreadContext(settings);, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/esnative/NativeRealmTests.java, +        RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("native", "native");, +        RealmConfig config = new RealmConfig(realmId, settings, TestEnvironment.newEnvironment(settings), new ThreadContext(settings));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/RealmConfig.java, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/InternalRealmsTests.java, +import org.elasticsearch.env.Environment;, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier(NativeRealmSettings.TYPE, "test");, +        final Environment env = TestEnvironment.newEnvironment(settings);, +        final ThreadContext threadContext = new ThreadContext(settings);, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/esnative/NativeRealmTests.java, +        RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("native", "native");, +        RealmConfig config = new RealmConfig(realmId, settings, TestEnvironment.newEnvironment(settings), new ThreadContext(settings));, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/file/FileUserPasswdStoreTests.java, +        return new RealmConfig(identifier, settings, env, threadPool.getThreadContext());, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/RealmConfig.java, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/InternalRealmsTests.java, +import org.elasticsearch.env.Environment;, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier(NativeRealmSettings.TYPE, "test");, +        final Environment env = TestEnvironment.newEnvironment(settings);, +        final ThreadContext threadContext = new ThreadContext(settings);, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/esnative/NativeRealmTests.java, +        RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("native", "native");, +        RealmConfig config = new RealmConfig(realmId, settings, TestEnvironment.newEnvironment(settings), new ThreadContext(settings));, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/file/FileUserPasswdStoreTests.java, +        return new RealmConfig(identifier, settings, env, threadPool.getThreadContext());, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/file/FileUserRolesStoreTests.java, +        RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +        RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +        RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +        RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +            final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +            RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/RealmConfig.java, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/InternalRealmsTests.java, +import org.elasticsearch.env.Environment;, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier(NativeRealmSettings.TYPE, "test");, +        final Environment env = TestEnvironment.newEnvironment(settings);, +        final ThreadContext threadContext = new ThreadContext(settings);, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/esnative/NativeRealmTests.java, +        RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("native", "native");, +        RealmConfig config = new RealmConfig(realmId, settings, TestEnvironment.newEnvironment(settings), new ThreadContext(settings));, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/file/FileUserPasswdStoreTests.java, +        return new RealmConfig(identifier, settings, env, threadPool.getThreadContext());, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/file/FileUserRolesStoreTests.java, +        RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +        RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +        RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +        RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +            final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +            RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/kerberos/KerberosRealmAuthenticateFailedTests.java, +            globalSettings, TestEnvironment.newEnvironment(globalSettings), new ThreadContext(globalSettings)));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/RealmConfig.java, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/InternalRealmsTests.java, +import org.elasticsearch.env.Environment;, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier(NativeRealmSettings.TYPE, "test");, +        final Environment env = TestEnvironment.newEnvironment(settings);, +        final ThreadContext threadContext = new ThreadContext(settings);, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +        factories.get(NativeRealmSettings.TYPE).create(new RealmConfig(realmId, settings, env, threadContext));, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/esnative/NativeRealmTests.java, +        RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("native", "native");, +        RealmConfig config = new RealmConfig(realmId, settings, TestEnvironment.newEnvironment(settings), new ThreadContext(settings));, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/file/FileUserPasswdStoreTests.java, +        return new RealmConfig(identifier, settings, env, threadPool.getThreadContext());, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/file/FileUserRolesStoreTests.java, +        RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +        RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +        RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +        final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");, +        RealmConfig config = new RealmConfig(realmId, settings, env, new ThreadContext(Settings.EMPTY));, +            final RealmConfig.RealmIdentifier realmId = new RealmConfig.RealmIdentifier("file", "file-test");]