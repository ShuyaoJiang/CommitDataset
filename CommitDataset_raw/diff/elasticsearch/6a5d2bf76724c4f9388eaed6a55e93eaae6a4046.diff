[+++ b/src/main/java/org/elasticsearch/cluster/ClusterState.java, +import org.elasticsearch.common.io.stream.BytesStreamInput;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +import org.elasticsearch.common.io.stream.StreamInput;, +import org.elasticsearch.common.io.stream.StreamOutput;, +            BytesStreamOutput os = new BytesStreamOutput();, +            return os.bytes().toBytes();, +++ b/src/main/java/org/elasticsearch/cluster/ClusterState.java, +import org.elasticsearch.common.io.stream.BytesStreamInput;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +import org.elasticsearch.common.io.stream.StreamInput;, +import org.elasticsearch.common.io.stream.StreamOutput;, +            BytesStreamOutput os = new BytesStreamOutput();, +            return os.bytes().toBytes();, +++ b/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +            BytesStreamOutput bStream = new BytesStreamOutput();, +            Streams.copy(compressed, bStream);, +            return bStream.bytes();, +++ b/src/main/java/org/elasticsearch/cluster/ClusterState.java, +import org.elasticsearch.common.io.stream.BytesStreamInput;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +import org.elasticsearch.common.io.stream.StreamInput;, +import org.elasticsearch.common.io.stream.StreamOutput;, +            BytesStreamOutput os = new BytesStreamOutput();, +            return os.bytes().toBytes();, +++ b/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +            BytesStreamOutput bStream = new BytesStreamOutput();, +            Streams.copy(compressed, bStream);, +            return bStream.bytes();, +++ b/src/main/java/org/elasticsearch/common/io/CachedStreams.java, +++ b/src/main/java/org/elasticsearch/cluster/ClusterState.java, +import org.elasticsearch.common.io.stream.BytesStreamInput;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +import org.elasticsearch.common.io.stream.StreamInput;, +import org.elasticsearch.common.io.stream.StreamOutput;, +            BytesStreamOutput os = new BytesStreamOutput();, +            return os.bytes().toBytes();, +++ b/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +            BytesStreamOutput bStream = new BytesStreamOutput();, +            Streams.copy(compressed, bStream);, +            return bStream.bytes();, +++ b/src/main/java/org/elasticsearch/common/io/CachedStreams.java, +++ /dev/null, +++ b/src/main/java/org/elasticsearch/cluster/ClusterState.java, +import org.elasticsearch.common.io.stream.BytesStreamInput;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +import org.elasticsearch.common.io.stream.StreamInput;, +import org.elasticsearch.common.io.stream.StreamOutput;, +            BytesStreamOutput os = new BytesStreamOutput();, +            return os.bytes().toBytes();, +++ b/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +            BytesStreamOutput bStream = new BytesStreamOutput();, +            Streams.copy(compressed, bStream);, +            return bStream.bytes();, +++ b/src/main/java/org/elasticsearch/common/io/CachedStreams.java, +++ /dev/null, +++ /dev/null, +++ b/src/main/java/org/elasticsearch/cluster/ClusterState.java, +import org.elasticsearch.common.io.stream.BytesStreamInput;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +import org.elasticsearch.common.io.stream.StreamInput;, +import org.elasticsearch.common.io.stream.StreamOutput;, +            BytesStreamOutput os = new BytesStreamOutput();, +            return os.bytes().toBytes();, +++ b/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +            BytesStreamOutput bStream = new BytesStreamOutput();, +            Streams.copy(compressed, bStream);, +            return bStream.bytes();, +++ b/src/main/java/org/elasticsearch/common/io/CachedStreams.java, +++ /dev/null, +++ /dev/null, +++ b/src/main/java/org/elasticsearch/common/io/Streams.java, +        BytesStreamOutput out = new BytesStreamOutput();, +        return out.bytes().toBytes();, +++ b/src/main/java/org/elasticsearch/cluster/ClusterState.java, +import org.elasticsearch.common.io.stream.BytesStreamInput;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +import org.elasticsearch.common.io.stream.StreamInput;, +import org.elasticsearch.common.io.stream.StreamOutput;, +            BytesStreamOutput os = new BytesStreamOutput();, +            return os.bytes().toBytes();, +++ b/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +            BytesStreamOutput bStream = new BytesStreamOutput();, +            Streams.copy(compressed, bStream);, +            return bStream.bytes();, +++ b/src/main/java/org/elasticsearch/common/io/CachedStreams.java, +++ /dev/null, +++ /dev/null, +++ b/src/main/java/org/elasticsearch/common/io/Streams.java, +        BytesStreamOutput out = new BytesStreamOutput();, +        return out.bytes().toBytes();, +++ b/src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java, +    public static final int DEFAULT_SIZE = 32 * 1024;, +]