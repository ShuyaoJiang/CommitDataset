[+++ b/src/main/java/org/elasticsearch/action/search/type/TransportSearchTypeAction.java, +                final boolean lastShard = nextShard == null;, +                if (logger.isTraceEnabled() && t != null) {, +                    logger.trace(executionFailureMsg(shard, shardIt, request, lastShard), t);, +                if (!lastShard) {, +                    if (logger.isDebugEnabled() && !logger.isTraceEnabled()) { // do not double log this exception, +                            logger.debug(executionFailureMsg(shard, shardIt, request, lastShard), t);, +                        }, +                    }, +                }, +            }, +        }, +, +        private String executionFailureMsg(@Nullable ShardRouting shard, final ShardIterator shardIt, SearchRequest request, boolean lastShard) {, +                return shard.shortSummary() + ": Failed to execute [" + request + "] lastShard [" + lastShard + "]";, +                return shardIt.shardId() + ": Failed to execute [" + request + "] lastShard [" + lastShard + "]";]