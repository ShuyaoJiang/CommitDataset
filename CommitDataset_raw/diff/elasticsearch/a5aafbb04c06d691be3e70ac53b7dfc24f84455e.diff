[+++ b/src/test/java/org/elasticsearch/recovery/RelocationTests.java, +import com.carrotsearch.randomizedtesting.RandomizedTest;, +        try (BackgroundIndexer indexer = new BackgroundIndexer("test", "type1", client(), scaledRandomIntBetween(2, 5), true, numDocs * 2)) {, +++ b/src/test/java/org/elasticsearch/recovery/RelocationTests.java, +import com.carrotsearch.randomizedtesting.RandomizedTest;, +        try (BackgroundIndexer indexer = new BackgroundIndexer("test", "type1", client(), scaledRandomIntBetween(2, 5), true, numDocs * 2)) {, +++ b/src/test/java/org/elasticsearch/test/BackgroundIndexer.java, +        this(index, type, client, writerCount, true, Integer.MAX_VALUE);, +    public BackgroundIndexer(final String index, final String type, final Client client, final int writerCount, boolean autoStart, final int maxNumDocs) {, +                        while (!stop.get() && indexCounter.get() < maxNumDocs) {  // step out once we reach the hard limit, +                        logger.info("**** done indexing thread {}  stop: {} numDocsIndexed: {} maxNumDocs: {}", indexerId, stop.get(), indexCounter.get(), maxNumDocs);]