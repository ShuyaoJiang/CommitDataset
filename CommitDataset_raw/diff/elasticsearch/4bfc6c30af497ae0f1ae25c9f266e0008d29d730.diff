[+++ b/server/src/main/java/org/elasticsearch/search/SearchHits.java, +    private final TotalHits totalHits;, +        this.totalHits = totalHits;, +            totalHits = Lucene.readTotalHits(in);, +            Lucene.writeTotalHits(out, totalHits);, +    @Nullable, +        return totalHits;, +            long total = totalHits == null ? -1 : totalHits.value;, +            builder.field("value", totalHits.value);, +            builder.field("relation", totalHits.relation == Relation.EQUAL_TO ? "eq" : "gte");]