[+++ b/server/src/main/java/org/elasticsearch/node/Node.java, +, +            modules.add(new RepositoriesModule(this.environment, pluginsService.filterPlugins(RepositoryPlugin.class), transportService,, +                clusterService, threadPool, xContentRegistry));, +, +++ b/server/src/main/java/org/elasticsearch/node/Node.java, +, +            modules.add(new RepositoriesModule(this.environment, pluginsService.filterPlugins(RepositoryPlugin.class), transportService,, +                clusterService, threadPool, xContentRegistry));, +, +++ b/server/src/main/java/org/elasticsearch/repositories/RepositoriesModule.java, +import org.elasticsearch.cluster.service.ClusterService;, +import org.elasticsearch.threadpool.ThreadPool;, +import org.elasticsearch.transport.TransportService;, +    private final RepositoriesService repositoriesService;, +    public RepositoriesModule(Environment env, List<RepositoryPlugin> repoPlugins, TransportService transportService,, +                              ClusterService clusterService, ThreadPool threadPool, NamedXContentRegistry namedXContentRegistry) {, +, +        Map<String, Repository.Factory> repositoryTypes = Collections.unmodifiableMap(factories);, +        repositoriesService = new RepositoriesService(env.settings(), clusterService, transportService, repositoryTypes, threadPool);, +        bind(RepositoriesService.class).toInstance(repositoriesService);, +++ b/server/src/main/java/org/elasticsearch/node/Node.java, +, +            modules.add(new RepositoriesModule(this.environment, pluginsService.filterPlugins(RepositoryPlugin.class), transportService,, +                clusterService, threadPool, xContentRegistry));, +, +++ b/server/src/main/java/org/elasticsearch/repositories/RepositoriesModule.java, +import org.elasticsearch.cluster.service.ClusterService;, +import org.elasticsearch.threadpool.ThreadPool;, +import org.elasticsearch.transport.TransportService;, +    private final RepositoriesService repositoriesService;, +    public RepositoriesModule(Environment env, List<RepositoryPlugin> repoPlugins, TransportService transportService,, +                              ClusterService clusterService, ThreadPool threadPool, NamedXContentRegistry namedXContentRegistry) {, +, +        Map<String, Repository.Factory> repositoryTypes = Collections.unmodifiableMap(factories);, +        repositoriesService = new RepositoriesService(env.settings(), clusterService, transportService, repositoryTypes, threadPool);, +        bind(RepositoriesService.class).toInstance(repositoriesService);, +++ b/server/src/main/java/org/elasticsearch/repositories/RepositoriesService.java]