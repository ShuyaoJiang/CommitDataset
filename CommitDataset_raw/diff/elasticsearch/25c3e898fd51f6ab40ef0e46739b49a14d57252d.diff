[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java, +import org.elasticsearch.common.Nullable;, +        sendPings(timeout, null, sendPingsHandler);, +        threadPool.schedule(TimeValue.timeValueMillis(timeout.millis() / 2), ThreadPool.Names.CACHED, new Runnable() {, +                sendPings(timeout, null, sendPingsHandler);, +                threadPool.schedule(TimeValue.timeValueMillis(timeout.millis() / 2), ThreadPool.Names.CACHED, new Runnable() {, +                    @Override public void run() {, +                        sendPings(timeout, TimeValue.timeValueMillis(timeout.millis() / 2), sendPingsHandler);, +                        ConcurrentMap<DiscoveryNode, PingResponse> responses = receivedResponses.remove(sendPingsHandler.id());, +                        listener.onPing(responses.values().toArray(new PingResponse[responses.size()]));, +                    }, +                });, +    void sendPings(final TimeValue timeout, @Nullable TimeValue waitTime, final SendPingsHandler sendPingsHandler) {, +        if (waitTime != null) {, +                latch.await(waitTime.millis(), TimeUnit.MILLISECONDS);]