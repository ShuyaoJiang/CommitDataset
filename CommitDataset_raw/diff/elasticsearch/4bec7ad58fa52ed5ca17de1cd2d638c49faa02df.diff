[+++ b/core/src/test/java/org/elasticsearch/search/basic/SearchWhileRelocatingIT.java, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.formatShardStatus;, +    public void testSearchAndRelocateConcurrentlyRandomReplicas() throws Exception {, +            final List<String> nonCriticalExceptions = new CopyOnWriteArrayList<>();, +                                if (sr.getHits().totalHits() != numDocs) {, +                                    if (sr.getTotalShards() != sr.getSuccessfulShards() && sr.getFailedShards() == 0) {, +                                        nonCriticalExceptions.add("Count is " + sr.getHits().totalHits() + " but " + numDocs +, +                                            " was expected. " + formatShardStatus(sr));, +                                    } else {, +                                        assertHitCount(sr, numDocs);, +                                    }, +                                }, +, +                                throw ex;, +            // if we hit only non-critical exceptions we make sure that the post search works, +            if (!nonCriticalExceptions.isEmpty()) {, +                logger.info("non-critical exceptions: {}", nonCriticalExceptions);, +                    assertHitCount(client().prepareSearch().get(), numDocs);]