[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/annotations/Annotation.java, +    public Annotation(Annotation other) {, +        Objects.requireNonNull(other);, +        this.annotation = other.annotation;, +        this.createTime = new Date(other.createTime.getTime());, +        this.createUsername = other.createUsername;, +        this.timestamp = new Date(other.timestamp.getTime());, +        this.endTimestamp = other.endTimestamp == null ? null : new Date(other.endTimestamp.getTime());, +        this.jobId = other.jobId;, +        this.modifiedTime = other.modifiedTime == null ? null : new Date(other.modifiedTime.getTime());, +        this.modifiedUsername = other.modifiedUsername;, +        this.type = other.type;, +    }, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/annotations/Annotation.java, +    public Annotation(Annotation other) {, +        Objects.requireNonNull(other);, +        this.annotation = other.annotation;, +        this.createTime = new Date(other.createTime.getTime());, +        this.createUsername = other.createUsername;, +        this.timestamp = new Date(other.timestamp.getTime());, +        this.endTimestamp = other.endTimestamp == null ? null : new Date(other.endTimestamp.getTime());, +        this.jobId = other.jobId;, +        this.modifiedTime = other.modifiedTime == null ? null : new Date(other.modifiedTime.getTime());, +        this.modifiedUsername = other.modifiedUsername;, +        this.type = other.type;, +    }, +, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/annotations/AnnotationTests.java, +import static org.hamcrest.Matchers.equalTo;, +, +, +    public void testCopyConstructor() {, +        for (int i = 0; i < NUMBER_OF_TEST_RUNS; i++) {, +            Annotation testAnnotation = createTestInstance();, +            assertThat(testAnnotation, equalTo(new Annotation(testAnnotation)));, +        }, +    }, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/annotations/Annotation.java, +    public Annotation(Annotation other) {, +        Objects.requireNonNull(other);, +        this.annotation = other.annotation;, +        this.createTime = new Date(other.createTime.getTime());, +        this.createUsername = other.createUsername;, +        this.timestamp = new Date(other.timestamp.getTime());, +        this.endTimestamp = other.endTimestamp == null ? null : new Date(other.endTimestamp.getTime());, +        this.jobId = other.jobId;, +        this.modifiedTime = other.modifiedTime == null ? null : new Date(other.modifiedTime.getTime());, +        this.modifiedUsername = other.modifiedUsername;, +        this.type = other.type;, +    }, +, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/annotations/AnnotationTests.java, +import static org.hamcrest.Matchers.equalTo;, +, +, +    public void testCopyConstructor() {, +        for (int i = 0; i < NUMBER_OF_TEST_RUNS; i++) {, +            Annotation testAnnotation = createTestInstance();, +            assertThat(testAnnotation, equalTo(new Annotation(testAnnotation)));, +        }, +    }, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/DatafeedJob.java, +import org.elasticsearch.action.index.IndexRequest;, +import org.elasticsearch.action.index.IndexResponse;, +import org.elasticsearch.common.xcontent.ToXContent;, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.common.xcontent.XContentFactory;, +import org.elasticsearch.xpack.core.ml.annotations.Annotation;, +import org.elasticsearch.xpack.core.ml.annotations.AnnotationIndex;, +import org.elasticsearch.xpack.core.security.user.SystemUser;, +    private volatile String lastDataCheckAnnotationId;, +    private volatile Annotation lastDataCheckAnnotation;, +                Date endTime = missingDataBuckets.get(missingDataBuckets.size() - 1).getBucket().getTimestamp();, +                Annotation annotation = createAnnotation(missingDataBuckets.get(0).getBucket().getTimestamp(),, +                    endTime,, +                    totalRecordsMissing);, +, +                // Have we an annotation that covers the same area with the same message?, +                // Cannot use annotation.equals(other) as that checks createTime, +                if (lastDataCheckAnnotation != null, +                    && annotation.getAnnotation().equals(lastDataCheckAnnotation.getAnnotation()), +                    && annotation.getTimestamp().equals(lastDataCheckAnnotation.getTimestamp()), +                    && annotation.getEndTimestamp().equals(lastDataCheckAnnotation.getTimestamp())) {, +                    return;, +                }, +, +                // Creating a warning in addition to updating/creating our annotation. This allows the issue to be plainly visible, +                // in the job list page., +                auditor.warning(jobId, Messages.getMessage(Messages.JOB_AUDIT_DATAFEED_MISSING_DATA, totalRecordsMissing,, +                    XContentElasticsearchExtension.DEFAULT_DATE_PRINTER.print(endTime.getTime())));, +, +                if (lastDataCheckAnnotationId != null) {, +                    updateAnnotation(annotation);, +                } else {, +                    lastDataCheckAnnotationId = addAndSetDelayedDataAnnotation(annotation);, +    private Annotation createAnnotation(Date startTime, Date endTime, long recordsMissing) {, +       String msg = Messages.getMessage(Messages.JOB_AUDIT_DATAFEED_MISSING_DATA, recordsMissing,, +            XContentElasticsearchExtension.DEFAULT_DATE_PRINTER.print(endTime.getTime()));, +       return new Annotation(msg,]