[+++ b/core/src/main/java/org/elasticsearch/index/shard/SearchOperationListener.java, +import org.elasticsearch.transport.TransportRequest;, +     * @param transportRequest the request that is going to use the search context, +    default void validateSearchContext(SearchContext context, TransportRequest transportRequest) {}, +        public void validateSearchContext(SearchContext context, TransportRequest request) {, +                    listener.validateSearchContext(context, request);, +++ b/core/src/main/java/org/elasticsearch/index/shard/SearchOperationListener.java, +import org.elasticsearch.transport.TransportRequest;, +     * @param transportRequest the request that is going to use the search context, +    default void validateSearchContext(SearchContext context, TransportRequest transportRequest) {}, +        public void validateSearchContext(SearchContext context, TransportRequest request) {, +                    listener.validateSearchContext(context, request);, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +import org.elasticsearch.transport.TransportRequest;, +        final SearchContext context = findContext(request.id(), request);, +        final SearchContext context = findContext(request.id(), request);, +        final SearchContext context = findContext(request.id(), request);, +        final SearchContext context = findContext(request.id(), request);, +    private SearchContext findContext(long id, TransportRequest request) throws SearchContextMissingException {, +            operationListener.validateSearchContext(context, request);, +++ b/core/src/main/java/org/elasticsearch/index/shard/SearchOperationListener.java, +import org.elasticsearch.transport.TransportRequest;, +     * @param transportRequest the request that is going to use the search context, +    default void validateSearchContext(SearchContext context, TransportRequest transportRequest) {}, +        public void validateSearchContext(SearchContext context, TransportRequest request) {, +                    listener.validateSearchContext(context, request);, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +import org.elasticsearch.transport.TransportRequest;, +        final SearchContext context = findContext(request.id(), request);, +        final SearchContext context = findContext(request.id(), request);, +        final SearchContext context = findContext(request.id(), request);, +        final SearchContext context = findContext(request.id(), request);, +    private SearchContext findContext(long id, TransportRequest request) throws SearchContextMissingException {, +            operationListener.validateSearchContext(context, request);, +++ b/core/src/test/java/org/elasticsearch/index/shard/SearchOperationListenerTests.java, +import org.elasticsearch.transport.TransportRequest;, +import org.elasticsearch.transport.TransportRequest.Empty;, +            public void validateSearchContext(SearchContext context, TransportRequest request) {, +            compositeListener.validateSearchContext(ctx, Empty.INSTANCE);, +            RuntimeException expected =, +                expectThrows(RuntimeException.class, () -> compositeListener.validateSearchContext(ctx, Empty.INSTANCE));]