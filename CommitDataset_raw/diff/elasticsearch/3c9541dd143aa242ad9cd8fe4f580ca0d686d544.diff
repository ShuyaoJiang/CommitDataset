[+++ b/src/test/java/org/elasticsearch/test/integration/search/facet/SimpleFacetsTests.java, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        // We have to specify mapping explicitly because by the time search is performed dynamic mapping might not, +        // be propagated to all nodes yet and some facets fail when the facet field is not defined, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .startObject("multi_num").field("type", "float").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: Make sure facet doesn't fail in case of dynamic mapping, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .startObject("multi_num").field("type", "float").endObject(), +                .startObject("date").field("type", "date").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .startObject("multi_num").field("type", "float").endObject(), +                .startObject("value").field("type", "integer").endObject(), +                .startObject("multi_value").field("type", "float").endObject(), +                .startObject("date").field("type", "date").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .startObject("date").field("type", "date").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .startObject("date").field("type", "date").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("field").field("type", "string").endObject(), +                .startObject("num").field("type", "integer").endObject(), +                .startObject("multi_num").field("type", "float").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("lField").field("type", "long").endObject(), +                .startObject("dField").field("type", "double").endObject(), +                .startObject("num").field("type", "float").endObject(), +                .startObject("multi_num").field("type", "integer").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "float").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +++ b/src/test/java/org/elasticsearch/test/integration/search/facet/SimpleFacetsTests.java, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        // We have to specify mapping explicitly because by the time search is performed dynamic mapping might not, +        // be propagated to all nodes yet and some facets fail when the facet field is not defined, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .startObject("multi_num").field("type", "float").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: Make sure facet doesn't fail in case of dynamic mapping, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .startObject("multi_num").field("type", "float").endObject(), +                .startObject("date").field("type", "date").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .startObject("multi_num").field("type", "float").endObject(), +                .startObject("value").field("type", "integer").endObject(), +                .startObject("multi_value").field("type", "float").endObject(), +                .startObject("date").field("type", "date").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties"), +                .startObject("num").field("type", "integer").endObject(), +                .startObject("date").field("type", "date").endObject(), +                .endObject().endObject().endObject().string();, +        client.admin().indices().prepareCreate("test").addMapping("type1", mapping).execute().actionGet();, +        // TODO: facet shouldn't fail when faceted field is mapped dynamically, +        String mapping = jsonBuilder().startObject().startObject("type1").startObject("properties")]