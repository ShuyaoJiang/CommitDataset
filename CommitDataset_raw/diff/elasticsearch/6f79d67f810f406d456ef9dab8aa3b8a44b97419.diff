[+++ b/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +, +import org.elasticsearch.action.RoutingMissingException;, +                    } catch (ElasticsearchParseException | RoutingMissingException e) {, +                    BulkItemResponse.Failure failure = new BulkItemResponse.Failure(updateRequest.index(), updateRequest.type(),, +                            updateRequest.id(), "routing is required for this item", RestStatus.BAD_REQUEST);, +                    responses.set(i, new BulkItemResponse(i, updateRequest.type(), failure));, +                    continue;, +++ b/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +, +import org.elasticsearch.action.RoutingMissingException;, +                    } catch (ElasticsearchParseException | RoutingMissingException e) {, +                    BulkItemResponse.Failure failure = new BulkItemResponse.Failure(updateRequest.index(), updateRequest.type(),, +                            updateRequest.id(), "routing is required for this item", RestStatus.BAD_REQUEST);, +                    responses.set(i, new BulkItemResponse(i, updateRequest.type(), failure));, +                    continue;, +++ b/src/test/java/org/elasticsearch/document/BulkTests.java, +, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertAcked;, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertExists;, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertHitCount;, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertNoFailures;, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertSearchHits;, +import static org.hamcrest.Matchers.containsString;, +import static org.hamcrest.Matchers.equalTo;, +import static org.hamcrest.Matchers.is;, +import static org.hamcrest.Matchers.nullValue;, +    /*, +     * Test for https://github.com/elasticsearch/elasticsearch/issues/8365, +     */, +    @Test, +    public void testBulkUpdateChildMissingParentRouting() throws Exception {, +        assertAcked(prepareCreate("test").addMapping("parent", "{\"parent\":{}}").addMapping("child",, +                "{\"child\": {\"_parent\": {\"type\": \"parent\"}}}"));, +        ensureGreen();, +, +        BulkRequestBuilder builder = client().prepareBulk();, +, +        byte[] addParent = new BytesArray("{\"index\" : { \"_index\" : \"test\", \"_type\" : \"parent\", \"_id\" : \"parent1\"}}\n", +                + "{\"field1\" : \"value1\"}\n").array();, +, +        byte[] addChildOK = new BytesArray(, +                "{\"index\" : { \"_id\" : \"child1\", \"_type\" : \"child\", \"_index\" : \"test\", \"parent\" : \"parent1\"} }\n", +                        + "{ \"field1\" : \"value1\"}\n").array();, +        byte[] addChildMissingRouting = new BytesArray(, +                "{\"index\" : { \"_id\" : \"child2\", \"_type\" : \"child\", \"_index\" : \"test\"} }\n" + "{ \"field1\" : \"value1\"}\n"), +                .array();, +, +        builder.add(addParent, 0, addParent.length, false);, +        builder.add(addChildOK, 0, addChildOK.length, false);, +        builder.add(addChildMissingRouting, 0, addChildMissingRouting.length, false);, +        builder.add(addChildOK, 0, addChildOK.length, false);, +, +        BulkResponse bulkResponse = builder.get();, +        assertThat(bulkResponse.getItems().length, equalTo(4));, +        assertThat(bulkResponse.getItems()[0].isFailed(), equalTo(false));, +        assertThat(bulkResponse.getItems()[1].isFailed(), equalTo(false));, +        assertThat(bulkResponse.getItems()[2].isFailed(), equalTo(true));, +        assertThat(bulkResponse.getItems()[3].isFailed(), equalTo(false));, +    }, +]