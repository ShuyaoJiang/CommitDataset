[+++ b/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java, +        // make sure we don't ping again after the initial ping, +        NodesFaultDetection nodesFDA = new NodesFaultDetection(settings.build(), threadPool, serviceA, clusterState.getClusterName());, +        nodesFDA.setLocalNode(nodeA);, +        NodesFaultDetection nodesFDB = new NodesFaultDetection(settings.build(), threadPool, serviceB, clusterState.getClusterName());, +        nodesFDB.setLocalNode(nodeB);, +        final CountDownLatch pingSent = new CountDownLatch(1);, +        nodesFDB.addListener(new NodesFaultDetection.Listener() {, +            @Override, +            public void onPingReceived(NodesFaultDetection.PingRequest pingRequest) {, +                pingSent.countDown();, +            }, +        });, +        nodesFDA.updateNodesAndPing(clusterState);, +, +        // wait for the first ping to go out, so we will really respond to a disconnect event rather then, +        // the ping failing, +        pingSent.await(30, TimeUnit.SECONDS);, +, +        nodesFDA.addListener(new NodesFaultDetection.Listener() {]