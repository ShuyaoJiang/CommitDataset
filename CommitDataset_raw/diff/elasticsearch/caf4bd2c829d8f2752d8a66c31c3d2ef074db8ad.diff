[+++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/AbstractOldXPackIndicesBackwardsCompatibilityTestCase.java, +    /**, +     * Set to true when it is ok to start a node. We don't want to start nodes at unexpected times., +     */, +    private boolean okToStartNode = false;, +    private List<String> dataFiles;, +    @Override, +    protected boolean shouldAssertXPackIsInstalled() {, +        return false; // Skip asserting that the xpack is installed because it tries to start the cluter., +    }, +, +    @Override, +    protected void ensureClusterSizeConsistency() {, +        // We manage our nodes ourselves. At this point no node should be running anyway and this would start a new one!, +    }, +, +    @Override, +    protected void ensureClusterStateConsistency() throws IOException {, +        // We manage our nodes ourselves. At this point no node should be running anyway and this would start a new one!, +    }, +, +        if (false == okToStartNode) {, +            throw new IllegalStateException("Starting nodes must only happen in setupCluster");, +        }, +        okToStartNode = true;, +        okToStartNode = false;, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/AbstractOldXPackIndicesBackwardsCompatibilityTestCase.java, +    /**, +     * Set to true when it is ok to start a node. We don't want to start nodes at unexpected times., +     */, +    private boolean okToStartNode = false;, +    private List<String> dataFiles;, +    @Override, +    protected boolean shouldAssertXPackIsInstalled() {, +        return false; // Skip asserting that the xpack is installed because it tries to start the cluter., +    }, +, +    @Override, +    protected void ensureClusterSizeConsistency() {, +        // We manage our nodes ourselves. At this point no node should be running anyway and this would start a new one!, +    }, +, +    @Override, +    protected void ensureClusterStateConsistency() throws IOException {, +        // We manage our nodes ourselves. At this point no node should be running anyway and this would start a new one!, +    }, +, +        if (false == okToStartNode) {, +            throw new IllegalStateException("Starting nodes must only happen in setupCluster");, +        }, +        okToStartNode = true;, +        okToStartNode = false;, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/test/SecurityIntegTestCase.java, +import org.elasticsearch.AbstractOldXPackIndicesBackwardsCompatibilityTestCase;, +        if (false == shouldAssertXPackIsInstalled()) {, +            return;, +        }, +    /**, +     * Should this test assert that x-pack is installed? You might want to skip this assertion if the test itself validates the installation, +     * <strong>and</strong> running the assertion would significantly affect the performance or function of the test. For example, +     * {@link AbstractOldXPackIndicesBackwardsCompatibilityTestCase} disables the assertion because the assertion would force starting a, +     * node which it will then just shut down. That would slow the test down significantly and causes spurious failures because watcher, +     * needs to be shut down with kid gloves., +     */, +    protected boolean shouldAssertXPackIsInstalled() {, +        return true;, +    }, +, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/AbstractOldXPackIndicesBackwardsCompatibilityTestCase.java, +    /**, +     * Set to true when it is ok to start a node. We don't want to start nodes at unexpected times., +     */, +    private boolean okToStartNode = false;, +    private List<String> dataFiles;, +    @Override, +    protected boolean shouldAssertXPackIsInstalled() {, +        return false; // Skip asserting that the xpack is installed because it tries to start the cluter., +    }, +, +    @Override, +    protected void ensureClusterSizeConsistency() {, +        // We manage our nodes ourselves. At this point no node should be running anyway and this would start a new one!, +    }, +, +    @Override, +    protected void ensureClusterStateConsistency() throws IOException {, +        // We manage our nodes ourselves. At this point no node should be running anyway and this would start a new one!, +    }, +, +        if (false == okToStartNode) {, +            throw new IllegalStateException("Starting nodes must only happen in setupCluster");, +        }, +        okToStartNode = true;, +        okToStartNode = false;, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/test/SecurityIntegTestCase.java, +import org.elasticsearch.AbstractOldXPackIndicesBackwardsCompatibilityTestCase;, +        if (false == shouldAssertXPackIsInstalled()) {, +            return;, +        }, +    /**]