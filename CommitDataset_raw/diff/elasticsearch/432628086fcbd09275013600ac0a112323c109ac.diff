[+++ b/src/main/java/org/elasticsearch/common/io/Streams.java, +import com.google.common.base.Charsets;, +, +    public static int readFully(Reader reader, char[] dest) throws IOException {, +        return readFully(reader, dest, 0, dest.length);, +    }, +, +    public static int readFully(Reader reader, char[] dest, int offset, int len) throws IOException {, +        int read = 0;, +        while (read < len) {, +            final int r = reader.read(dest, offset + read, len - read);, +            if (r == -1) {, +                break;, +            }, +            read += r;, +        }, +        return read;, +    }, +, +    public static int readFully(InputStream reader, byte[] dest) throws IOException {, +        return readFully(reader, dest, 0, dest.length);, +    }, +, +    public static int readFully(InputStream reader, byte[] dest, int offset, int len) throws IOException {, +        int read = 0;, +        while (read < len) {, +            final int r = reader.read(dest, offset + read, len - read);, +            if (r == -1) {, +                break;, +            }, +            read += r;, +        }, +        return read;, +    }, +++ b/src/main/java/org/elasticsearch/common/io/Streams.java, +import com.google.common.base.Charsets;, +, +    public static int readFully(Reader reader, char[] dest) throws IOException {, +        return readFully(reader, dest, 0, dest.length);, +    }, +, +    public static int readFully(Reader reader, char[] dest, int offset, int len) throws IOException {, +        int read = 0;, +        while (read < len) {, +            final int r = reader.read(dest, offset + read, len - read);, +            if (r == -1) {, +                break;, +            }, +            read += r;, +        }, +        return read;, +    }, +, +    public static int readFully(InputStream reader, byte[] dest) throws IOException {, +        return readFully(reader, dest, 0, dest.length);, +    }, +, +    public static int readFully(InputStream reader, byte[] dest, int offset, int len) throws IOException {, +        int read = 0;, +        while (read < len) {, +            final int r = reader.read(dest, offset + read, len - read);, +            if (r == -1) {, +                break;, +            }, +            read += r;, +        }, +        return read;, +    }, +++ b/src/main/java/org/elasticsearch/common/io/stream/InputStreamStreamInput.java, +import org.elasticsearch.common.io.Streams;, +, +        final int read = Streams.readFully(is, b, offset, len);, +        if (read != len) {, +++ b/src/main/java/org/elasticsearch/common/io/Streams.java, +import com.google.common.base.Charsets;, +, +    public static int readFully(Reader reader, char[] dest) throws IOException {, +        return readFully(reader, dest, 0, dest.length);, +    }, +, +    public static int readFully(Reader reader, char[] dest, int offset, int len) throws IOException {, +        int read = 0;, +        while (read < len) {, +            final int r = reader.read(dest, offset + read, len - read);, +            if (r == -1) {, +                break;, +            }, +            read += r;, +        }, +        return read;, +    }, +, +    public static int readFully(InputStream reader, byte[] dest) throws IOException {, +        return readFully(reader, dest, 0, dest.length);, +    }, +, +    public static int readFully(InputStream reader, byte[] dest, int offset, int len) throws IOException {, +        int read = 0;, +        while (read < len) {, +            final int r = reader.read(dest, offset + read, len - read);]