[+++ b/docs/reference/migration/migrate_7_0/api.asciidoc, +, +==== The deprecated stored script contexts have now been removed, +When putting stored scripts, support for storing them with the deprecated `template` context or without a context is, +now removed. Scripts must be stored using the `script` context as mentioned in the documentation., +++ b/docs/reference/migration/migrate_7_0/api.asciidoc, +, +==== The deprecated stored script contexts have now been removed, +When putting stored scripts, support for storing them with the deprecated `template` context or without a context is, +now removed. Scripts must be stored using the `script` context as mentioned in the documentation., +++ b/modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java, +                .setContent(, +                    new BytesArray(, +                        "{" +, +                        "  \"script\": {" +, +                        "    \"lang\": \"mustache\"," +, +                        "    \"source\": {" +, +                        "            \"theField\": \"{{fieldParam}}\"" +, +                        "}", +                    ),, +                    XContentType.JSON));, +, +        String script =, +            "{" +, +            "  \"script\": {" +, +            "    \"lang\": \"mustache\"," +, +            "    \"source\": {" +, +            "            \"theField\": \"{{fieldParam}}\"" +, +            "    }" +, +            "  }" +, +            "}";, +, +        assertAcked(, +            client().admin().cluster().preparePutStoredScript().setId("1a").setContent(new BytesArray(script), XContentType.JSON), +        assertAcked(, +            client().admin().cluster().preparePutStoredScript().setId("2").setContent(new BytesArray(script), XContentType.JSON), +        assertAcked(, +            client().admin().cluster().preparePutStoredScript().setId("3").setContent(new BytesArray(script), XContentType.JSON), +        String query =, +            "{" +, +            "  \"script\": {" +, +            "    \"lang\": \"mustache\"," +, +            "    \"source\": {" +, +            "      \"query\": {" +, +            "        \"match_phrase_prefix\": {" +, +            "            \"searchtext\": {" +, +            "                \"query\": \"{{P_Keyword1}}\"," +, +            "                \"slop\": {{slop}}" +, +            "            }" +, +            "        }" +, +            "      }" +, +            "    }" +, +            "  }" +, +            "}";, +                    .setContent(new BytesArray(query.replace("{{slop}}", Integer.toString(-1))), XContentType.JSON), +            );, +                    .setContent(new BytesArray(query.replace("{{slop}}", Integer.toString(0))), XContentType.JSON), +            );, +        String multiQuery =, +            "{\n" +, +            "  \"script\": {\n" +, +            "    \"lang\": \"mustache\",\n" +, +            "    \"source\": {\n" +, +            "      \"query\": {\n" +, +            "        \"terms\": {\n" +, +            "            \"theField\": [\n" +, +            "                \"{{#fieldParam}}\",\n" +, +            "                \"{{.}}\",\n" +, +            "                \"{{/fieldParam}}\"\n" +, +            "            ]\n" +, +            "        }\n" +, +            "      }\n" +, +            "    }\n" +, +            "  }\n" +, +            "}";, +                        .setContent(new BytesArray(multiQuery), XContentType.JSON), +++ b/docs/reference/migration/migrate_7_0/api.asciidoc, +, +==== The deprecated stored script contexts have now been removed, +When putting stored scripts, support for storing them with the deprecated `template` context or without a context is, +now removed. Scripts must be stored using the `script` context as mentioned in the documentation., +++ b/modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java, +                .setContent(, +                    new BytesArray(, +                        "{" +, +                        "  \"script\": {" +, +                        "    \"lang\": \"mustache\"," +, +                        "    \"source\": {" +, +                        "            \"theField\": \"{{fieldParam}}\"" +, +                        "}", +                    ),, +                    XContentType.JSON));, +, +        String script =, +            "{" +, +            "  \"script\": {" +, +            "    \"lang\": \"mustache\"," +, +            "    \"source\": {" +, +            "            \"theField\": \"{{fieldParam}}\"" +, +            "    }" +]