[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/util/Strings.java, +        boolean changed = false;, +        for (int i = 0; i < value.length(); i++) {, +            char c = value.charAt(i);, +            if (c == '_') {, +                if (!changed) {, +                    // copy it over here, +                    for (int j = 0; j < i; j++) {, +                        sb.append(value.charAt(j));, +                    changed = true;, +                }, +                sb.append(Character.toUpperCase(value.charAt(++i)));, +            } else {, +                if (changed) {, +                    sb.append(c);, +                }, +            }, +        }, +        if (!changed) {, +            return value;, +        boolean changed = false;, +        for (int i = 0; i < value.length(); i++) {, +            char c = value.charAt(i);, +            if (Character.isUpperCase(c)) {, +                if (!changed) {, +                    // copy it over here, +                    for (int j = 0; j < i; j++) {, +                        sb.append(value.charAt(j));, +                    changed = true;, +                }, +                sb.append('_');, +                sb.append(Character.toLowerCase(c));, +            } else {, +                if (changed) {, +                    sb.append(c);, +                }, +            }, +        }, +        if (!changed) {, +            return value;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/util/Strings.java, +        boolean changed = false;, +        for (int i = 0; i < value.length(); i++) {, +            char c = value.charAt(i);, +            if (c == '_') {, +                if (!changed) {, +                    // copy it over here, +                    for (int j = 0; j < i; j++) {, +                        sb.append(value.charAt(j));, +                    changed = true;, +                }, +                sb.append(Character.toUpperCase(value.charAt(++i)));, +            } else {, +                if (changed) {, +                    sb.append(c);, +                }, +            }, +        }, +        if (!changed) {, +            return value;, +        boolean changed = false;, +        for (int i = 0; i < value.length(); i++) {, +            char c = value.charAt(i);, +            if (Character.isUpperCase(c)) {, +                if (!changed) {, +                    // copy it over here, +                    for (int j = 0; j < i; j++) {, +                        sb.append(value.charAt(j));, +                    changed = true;, +                }, +                sb.append('_');, +                sb.append(Character.toLowerCase(c));, +            } else {, +                if (changed) {, +                    sb.append(c);, +                }, +            }, +        }, +        if (!changed) {, +            return value;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/util/json/JsonBuilder.java, +        field(name);, +        field(name);, +        field(name);, +        field(name);, +        field(name);, +        field(name);, +        field(name);, +        field(name);, +        field(name);, +        field(name);, +        field(name);, +        field(name);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/util/Strings.java, +        boolean changed = false;, +        for (int i = 0; i < value.length(); i++) {, +            char c = value.charAt(i);, +            if (c == '_') {, +                if (!changed) {, +                    // copy it over here]