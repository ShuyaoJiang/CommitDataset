[+++ b/core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java, +        if (extBuilders != null && extBuilders.isEmpty() == false) {, +++ b/core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java, +        if (extBuilders != null && extBuilders.isEmpty() == false) {, +++ b/core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java, +import org.elasticsearch.common.xcontent.XContentHelper;, +import org.elasticsearch.index.query.RandomQueryBuilder;, +import java.util.Map;, +    public void testToXContent() throws  IOException {, +        //verify that only what is set gets printed out through toXContent, +        XContentType xContentType = randomFrom(XContentType.values());, +        {, +            SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();, +            XContentBuilder builder = XContentFactory.contentBuilder(xContentType);, +            searchSourceBuilder.toXContent(builder, ToXContent.EMPTY_PARAMS);, +            BytesReference source = builder.bytes();, +            Map<String, Object> sourceAsMap = XContentHelper.convertToMap(source, false).v2();, +            assertEquals(0, sourceAsMap.size());, +        }, +        {, +            SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();, +            searchSourceBuilder.query(RandomQueryBuilder.createQuery(random()));, +            XContentBuilder builder = XContentFactory.contentBuilder(xContentType);, +            searchSourceBuilder.toXContent(builder, ToXContent.EMPTY_PARAMS);, +            BytesReference source = builder.bytes();, +            Map<String, Object> sourceAsMap = XContentHelper.convertToMap(source, false).v2();, +            assertEquals(1, sourceAsMap.size());, +            assertEquals("query", sourceAsMap.keySet().iterator().next());, +        }, +    }, +]