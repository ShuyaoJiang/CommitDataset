[+++ b/core/src/main/java/org/elasticsearch/search/fetch/version/VersionFetchSubPhase.java, +import org.apache.lucene.index.NumericDocValues;, +import org.elasticsearch.index.mapper.VersionFieldMapper;, +        long version = Versions.NOT_FOUND;, +            NumericDocValues versions = hitContext.reader().getNumericDocValues(VersionFieldMapper.NAME);, +            if (versions != null) {, +                version = versions.get(hitContext.docId());, +            }, +            throw new ElasticsearchException("Could not retrieve version", e);]