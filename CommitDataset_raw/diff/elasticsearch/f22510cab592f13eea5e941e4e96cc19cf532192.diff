[+++ b/src/main/java/org/elasticsearch/common/lucene/search/XBooleanFilter.java, +import java.util.ArrayList;, +import java.util.Iterator;, +import java.util.List;, +        // now, go over the clauses and apply the "fast" ones first..., +        // But first we need to handle the "fast" should clauses, otherwise a should clause can unset docs, +        // that don't match with a must or must_not clause., +            }, +        }, +, +        // Now we safely handle the "fast" must and must_not clauses., +        for (int i = 0; i < results.size(); i++) {, +            ResultClause clause = results.get(i);, +            // we apply bits in based ones (slow) in the second run, +            if (clause.bits != null) {, +                hasBits = true;, +                continue;, +            }, +            if (clause.clause.getOccur() == Occur.MUST) {]