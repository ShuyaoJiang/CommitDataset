[+++ b/server/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java, +import org.elasticsearch.action.admin.cluster.configuration.AddVotingConfigExclusionsAction;, +import org.elasticsearch.action.admin.cluster.configuration.AddVotingConfigExclusionsRequest;, +import org.elasticsearch.action.admin.cluster.configuration.ClearVotingConfigExclusionsAction;, +import org.elasticsearch.action.admin.cluster.configuration.ClearVotingConfigExclusionsRequest;, +import static org.elasticsearch.cluster.coordination.ClusterBootstrapService.INITIAL_MASTER_NODES_SETTING;, +import static org.elasticsearch.gateway.GatewayService.RECOVER_AFTER_NODES_SETTING;, +        client().execute(AddVotingConfigExclusionsAction.INSTANCE, new AddVotingConfigExclusionsRequest(new String[]{firstNode})).get();, +, +            public Settings onNodeStopped(String nodeName) {, +                return Settings.builder(), +                    .put(RECOVER_AFTER_NODES_SETTING.getKey(), 2), +                    .putList(INITIAL_MASTER_NODES_SETTING.getKey()) // disable bootstrapping, +                    .build();, +, +        client().execute(ClearVotingConfigExclusionsAction.INSTANCE, new ClearVotingConfigExclusionsRequest()).get();, +                return Settings.builder().put(RECOVER_AFTER_NODES_SETTING.getKey(), 2).build();]