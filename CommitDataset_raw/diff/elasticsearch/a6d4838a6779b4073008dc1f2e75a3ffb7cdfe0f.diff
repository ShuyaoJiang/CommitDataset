[+++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java, +    public boolean allowPartialSearchResults() {, +        if (in.getVersion().onOrAfter(Version.V_7_0_0)) {, +            allowPartialSearchResults = in.readBoolean();, +        } else if (in.getVersion().onOrAfter(Version.V_6_3_0)) {, +        if (out.getVersion().onOrAfter(Version.V_7_0_0)) {, +            out.writeBoolean(allowPartialSearchResults);, +        } else if (out.getVersion().onOrAfter(Version.V_6_3_0)) {, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java, +    public boolean allowPartialSearchResults() {, +        if (in.getVersion().onOrAfter(Version.V_7_0_0)) {, +            allowPartialSearchResults = in.readBoolean();, +        } else if (in.getVersion().onOrAfter(Version.V_6_3_0)) {, +        if (out.getVersion().onOrAfter(Version.V_7_0_0)) {, +            out.writeBoolean(allowPartialSearchResults);, +        } else if (out.getVersion().onOrAfter(Version.V_6_3_0)) {, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java, +    boolean allowPartialSearchResults();, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java, +    public boolean allowPartialSearchResults() {, +        if (in.getVersion().onOrAfter(Version.V_7_0_0)) {, +            allowPartialSearchResults = in.readBoolean();, +        } else if (in.getVersion().onOrAfter(Version.V_6_3_0)) {, +        if (out.getVersion().onOrAfter(Version.V_7_0_0)) {, +            out.writeBoolean(allowPartialSearchResults);, +        } else if (out.getVersion().onOrAfter(Version.V_6_3_0)) {, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java, +    boolean allowPartialSearchResults();, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java, +    public boolean allowPartialSearchResults() {, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java, +    public boolean allowPartialSearchResults() {, +        if (in.getVersion().onOrAfter(Version.V_7_0_0)) {, +            allowPartialSearchResults = in.readBoolean();, +        } else if (in.getVersion().onOrAfter(Version.V_6_3_0)) {, +        if (out.getVersion().onOrAfter(Version.V_7_0_0)) {, +            out.writeBoolean(allowPartialSearchResults);, +        } else if (out.getVersion().onOrAfter(Version.V_6_3_0)) {, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java, +    boolean allowPartialSearchResults();, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java, +    public boolean allowPartialSearchResults() {, +++ b/server/src/test/java/org/elasticsearch/index/SearchSlowLogTests.java, +                public boolean allowPartialSearchResults() {, +                    return true;, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java, +    public boolean allowPartialSearchResults() {, +        if (in.getVersion().onOrAfter(Version.V_7_0_0)) {, +            allowPartialSearchResults = in.readBoolean();, +        } else if (in.getVersion().onOrAfter(Version.V_6_3_0)) {, +        if (out.getVersion().onOrAfter(Version.V_7_0_0)) {, +            out.writeBoolean(allowPartialSearchResults);, +        } else if (out.getVersion().onOrAfter(Version.V_6_3_0)) {, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java, +    boolean allowPartialSearchResults();, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java, +    public boolean allowPartialSearchResults() {, +++ b/server/src/test/java/org/elasticsearch/index/SearchSlowLogTests.java, +                public boolean allowPartialSearchResults() {, +                    return true;, +++ b/server/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java, +import org.elasticsearch.test.VersionUtils;, +        assertEquals(shardSearchTransportRequest.allowPartialSearchResults(), deserializedRequest.allowPartialSearchResults());, +    }, +, +    public void testAllowPartialResultsSerializationPre7_0_0() throws IOException {, +        Version version = VersionUtils.randomVersionBetween(random(), Version.V_6_0_0, VersionUtils.getPreviousVersion(Version.V_7_0_0));, +        ShardSearchTransportRequest shardSearchTransportRequest = createShardSearchTransportRequest();, +        ShardSearchTransportRequest deserializedRequest =, +            copyWriteable(shardSearchTransportRequest, namedWriteableRegistry, ShardSearchTransportRequest::new, version);, +        if (version.before(Version.V_6_3_0)) {, +            assertFalse(deserializedRequest.allowPartialSearchResults());, +        } else {, +            assertEquals(shardSearchTransportRequest.allowPartialSearchResults(), deserializedRequest.allowPartialSearchResults());, +        }, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java, +    public boolean allowPartialSearchResults() {, +        if (in.getVersion().onOrAfter(Version.V_7_0_0)) {, +            allowPartialSearchResults = in.readBoolean();, +        } else if (in.getVersion().onOrAfter(Version.V_6_3_0)) {, +        if (out.getVersion().onOrAfter(Version.V_7_0_0)) {, +            out.writeBoolean(allowPartialSearchResults);, +        } else if (out.getVersion().onOrAfter(Version.V_6_3_0)) {, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java, +    boolean allowPartialSearchResults();, +++ b/server/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java, +    public boolean allowPartialSearchResults() {, +++ b/server/src/test/java/org/elasticsearch/index/SearchSlowLogTests.java, +                public boolean allowPartialSearchResults() {, +                    return true;, +++ b/server/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java, +import org.elasticsearch.test.VersionUtils;, +        assertEquals(shardSearchTransportRequest.allowPartialSearchResults(), deserializedRequest.allowPartialSearchResults());, +    }, +, +    public void testAllowPartialResultsSerializationPre7_0_0() throws IOException {, +        Version version = VersionUtils.randomVersionBetween(random(), Version.V_6_0_0, VersionUtils.getPreviousVersion(Version.V_7_0_0));, +        ShardSearchTransportRequest shardSearchTransportRequest = createShardSearchTransportRequest();, +        ShardSearchTransportRequest deserializedRequest =, +            copyWriteable(shardSearchTransportRequest, namedWriteableRegistry, ShardSearchTransportRequest::new, version);]