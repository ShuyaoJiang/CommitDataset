[+++ b/src/main/java/org/elasticsearch/common/bytes/ByteBufferBytesReference.java, +    public int hashCode() {, +        return Helper.bytesHashCode(this);, +    }, +, +    @Override, +    public boolean equals(Object obj) {, +        return Helper.bytesEqual(this, (BytesReference) obj);, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/bytes/ByteBufferBytesReference.java, +    public int hashCode() {, +        return Helper.bytesHashCode(this);, +    }, +, +    @Override, +    public boolean equals(Object obj) {, +        return Helper.bytesEqual(this, (BytesReference) obj);, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/bytes/BytesArray.java, +    public int hashCode() {, +        return Helper.bytesHashCode(this);, +    public boolean equals(Object obj) {, +        return Helper.bytesEqual(this, (BytesReference) obj);, +++ b/src/main/java/org/elasticsearch/common/bytes/ByteBufferBytesReference.java, +    public int hashCode() {, +        return Helper.bytesHashCode(this);, +    }, +, +    @Override, +    public boolean equals(Object obj) {, +        return Helper.bytesEqual(this, (BytesReference) obj);, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/bytes/BytesArray.java, +    public int hashCode() {, +        return Helper.bytesHashCode(this);, +    public boolean equals(Object obj) {, +        return Helper.bytesEqual(this, (BytesReference) obj);, +++ b/src/main/java/org/elasticsearch/common/bytes/BytesReference.java, +    public static class Helper {, +, +        public static boolean bytesEqual(BytesReference a, BytesReference b) {, +            if (a == b) {, +                return true;, +            }, +            if (a.length() != b.length()) {, +                return false;, +            }, +            if (!a.hasArray()) {, +                a = a.toBytesArray();, +            }, +            if (!b.hasArray()) {, +                b = b.toBytesArray();, +            }, +            int bUpTo = b.arrayOffset();, +            final byte[] aArray = a.array();, +            final byte[] bArray = b.array();, +            final int end = a.arrayOffset() + a.length();, +            for (int aUpTo = a.arrayOffset(); aUpTo < end; aUpTo++, bUpTo++) {, +                if (aArray[aUpTo] != bArray[bUpTo]) {, +                    return false;, +                }, +            }, +            return true;, +        }, +, +        public static int bytesHashCode(BytesReference a) {, +            if (!a.hasArray()) {, +                a = a.toBytesArray();, +            }, +            int result = 0;, +            final int end = a.arrayOffset() + a.length();, +            for (int i = a.arrayOffset(); i < end; i++) {, +                result = 31 * result + a.array()[i];, +            }, +            return result;, +        }, +    }, +, +        private UTF8SortedAsUnicodeComparator() {, +        }, +++ b/src/main/java/org/elasticsearch/common/bytes/ByteBufferBytesReference.java, +    public int hashCode() {, +        return Helper.bytesHashCode(this);, +    }, +, +    @Override, +    public boolean equals(Object obj) {, +        return Helper.bytesEqual(this, (BytesReference) obj);, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/bytes/BytesArray.java, +    public int hashCode() {, +        return Helper.bytesHashCode(this);]