[+++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +import org.elasticsearch.ElasticSearchGenerationException;, +import org.elasticsearch.common.compress.CompressorFactory;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +    public CompressedString refreshSource() throws ElasticSearchGenerationException {, +            BytesStreamOutput bStream = new BytesStreamOutput();, +            XContentBuilder builder = XContentFactory.contentBuilder(XContentType.JSON, CompressorFactory.defaultCompressor().streamOutput(bStream));, +            builder.close();, +            return mappingSource = new CompressedString(bStream.bytes());, +            throw new ElasticSearchGenerationException("failed to serialize source for type [" + type + "]", e);, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +import org.elasticsearch.ElasticSearchGenerationException;, +import org.elasticsearch.common.compress.CompressorFactory;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +    public CompressedString refreshSource() throws ElasticSearchGenerationException {, +            BytesStreamOutput bStream = new BytesStreamOutput();, +            XContentBuilder builder = XContentFactory.contentBuilder(XContentType.JSON, CompressorFactory.defaultCompressor().streamOutput(bStream));, +            builder.close();, +            return mappingSource = new CompressedString(bStream.bytes());, +            throw new ElasticSearchGenerationException("failed to serialize source for type [" + type + "]", e);, +++ /dev/null]