[+++ b/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsTests.java, +import org.elasticsearch.action.search.ShardSearchFailure;, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +        assertShardExecutionState(searchResponse, 0);, +, +, +    private void assertShardExecutionState(SearchResponse response, int expectedFailures) throws Exception {, +        ShardSearchFailure[] failures = response.getShardFailures();, +        if (failures.length != expectedFailures) {, +            for (ShardSearchFailure failure : failures) {, +                logger.error("Shard Failure: {}", failure.failure(), failure.toString());, +            }, +            fail("Unexpected shard failures!");, +        }, +        int uninitializedShards = response.getTotalShards() - response.getSuccessfulShards();, +        if (uninitializedShards > 0) {, +            logger.warn("Uninitialized shards: " + uninitializedShards);, +        }, +    }]