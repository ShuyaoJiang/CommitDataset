[+++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java, +            if (node.node().getAttributes().containsKey(awarenessAttribute) == false) {, +                    if (node.nodeId().equals(nodeId) == false) {, +                    if (shardPerAttribute.containsKey(fullValue) == false) {, +            final int currentNodeCount = shardPerAttribute.get(node.node().getAttributes().get(awarenessAttribute));, +            final int maximumNodeCount = (shardCount + numberOfAttributes - 1) / numberOfAttributes; // ceil(shardCount/numberOfAttributes), +            if (currentNodeCount > maximumNodeCount) {, +                        maximumNodeCount);]