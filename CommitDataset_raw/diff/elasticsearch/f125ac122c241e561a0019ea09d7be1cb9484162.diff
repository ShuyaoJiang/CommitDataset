[+++ b/src/test/java/org/elasticsearch/test/integration/search/child/SimpleChildQuerySearchTests.java, +                .setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards", 1).put("index.number_of_replicas", 0)), +                .execute().actionGet();, +        client().admin(), +                .indices(), +                .preparePutMapping("test"), +                .setType("child"), +                .setSource(, +                        jsonBuilder().startObject().startObject("type").startObject("_parent").field("type", "parent").endObject(), +        client().admin(), +                .indices(), +                .preparePutMapping("test"), +                .setType("grandchild"), +                .setSource(, +                        jsonBuilder().startObject().startObject("type").startObject("_parent").field("type", "child").endObject(), +        client().prepareIndex("test", "grandchild", "gc1").setSource("gc_field", "gc_value1").setParent("c1").setRouting("gc1").execute(), +                .actionGet();, +        SearchResponse searchResponse = client(), +                .prepareSearch("test"), +                                        filteredQuery(termQuery("c_field", "c_value1"),, +                                                hasChildFilter("grandchild", termQuery("gc_field", "gc_value1")))))).execute().actionGet();, +                .setQuery(filteredQuery(matchAllQuery(), hasParentFilter("parent", termFilter("p_field", "p_value1")))).execute(), +                .actionGet();, +                .setQuery(filteredQuery(matchAllQuery(), hasParentFilter("child", termFilter("c_field", "c_value1")))).execute(), +                .actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(hasParentQuery("parent", termQuery("p_field", "p_value1"))).execute(), +                .actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(hasParentQuery("child", termQuery("c_field", "c_value1"))).execute(), +                .actionGet();, +    @Test, +    // see #2744, +                .setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards", 1).put("index.number_of_replicas", 0)), +                .execute().actionGet();, +        client().admin(), +                .indices(), +                .preparePutMapping("test"), +                .setType("test"), +                .setSource(, +                        jsonBuilder().startObject().startObject("type").startObject("_parent").field("type", "foo").endObject().endObject(), +                                .endObject()).execute().actionGet();, +        SearchResponse searchResponse = client().prepareSearch("test").setQuery(hasChildQuery("test", matchQuery("foo", 1))).execute(), +                .actionGet();, +                .setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards", 1).put("index.number_of_replicas", 0)), +                .execute().actionGet();, +        client().admin(), +                .indices(), +                .preparePutMapping("test"), +                .setType("child"), +                .setSource(, +                        jsonBuilder().startObject().startObject("type").startObject("_parent").field("type", "parent").endObject(), +        SearchResponse searchResponse = client().prepareSearch("test").setQuery(idsQuery("child").ids("c1")).addFields("_parent").execute(), +                .actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(termQuery("child._parent", "p1")).addFields("_parent").execute(), +                .actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(termQuery("_parent", "p1")).addFields("_parent").execute().actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(queryString("_parent:p1")).addFields("_parent").execute().actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(topChildrenQuery("child", termQuery("c_field", "yellow"))).execute(), +                .actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(topChildrenQuery("child", termQuery("c_field", "blue"))).execute(), +                .actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(topChildrenQuery("child", termQuery("c_field", "red"))).execute(), +                .actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(hasChildQuery("child", termQuery("c_field", "yellow"))).execute(), +                .actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(hasChildQuery("child", termQuery("c_field", "blue"))).execute(), +                .actionGet();, +        searchResponse = client().prepareSearch("test"), +                .setQuery(constantScoreQuery(hasChildFilter("child", termQuery("c_field", "yellow")))).execute().actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(constantScoreQuery(hasChildFilter("child", termQuery("c_field", "blue")))), +                .execute().actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(constantScoreQuery(hasChildFilter("child", termQuery("c_field", "red")))), +                .execute().actionGet();, +        searchResponse = client().prepareSearch("test"), +                .setQuery(constantScoreQuery(hasParentFilter("parent", termQuery("p_field", "p_value2")))).execute().actionGet();, +        searchResponse = client().prepareSearch("test"), +                .setQuery(constantScoreQuery(hasParentFilter("parent", termQuery("p_field", "p_value1")))).execute().actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(hasParentQuery("parent", termQuery("p_field", "p_value2"))).execute(), +                .actionGet();, +        searchResponse = client().prepareSearch("test").setQuery(hasParentQuery("parent", termQuery("p_field", "p_value1"))).execute(), +                .actionGet();, +                .setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards", 1).put("index.number_of_replicas", 0)), +                .execute().actionGet();, +        client().admin(), +                .indices(), +                .preparePutMapping("test"), +                .setType("child"), +                .setSource(, +                        jsonBuilder().startObject().startObject("type").startObject("_parent").field("type", "parent").endObject(), +            client().prepareIndex("test", "child", Integer.toString(i + 10)).setSource("c_field", i + 10).setParent(Integer.toString(i)), +                    .execute().actionGet();, +            SearchResponse searchResponse = client().prepareSearch("test"), +                    .setQuery(constantScoreQuery(queryFilter(topChildrenQuery("child", matchAllQuery())).cache(true))).execute(), +                    .actionGet();, +            assertNoFailures(searchResponse);, +            searchResponse = client().prepareSearch("test"), +                    .setQuery(constantScoreQuery(queryFilter(hasChildQuery("child", matchAllQuery()).scoreType("max")).cache(true))), +            searchResponse = client().prepareSearch("test"), +                    .setQuery(constantScoreQuery(queryFilter(hasParentQuery("parent", matchAllQuery()).scoreType("score")).cache(true))), +                .setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards", 1).put("index.number_of_replicas", 0)), +                .execute().actionGet();]