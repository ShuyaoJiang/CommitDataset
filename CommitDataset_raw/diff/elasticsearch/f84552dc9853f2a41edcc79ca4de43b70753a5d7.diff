[+++ b/.gitignore, +.vagrant/, +, +++ b/.gitignore, +.vagrant/, +, +++ b/TESTING.asciidoc, +The simplest way to test scripts and the packaged distributions is to use, +Vagrant. You can get started by following there five easy steps:, +. Install Virtual Box and Vagrant., +. (Optional) Install vagrant-cachier to squeeze a bit more performance out of, +the process:, +--------------------------------------, +vagrant plugin install vagrant-cachier, +--------------------------------------, +. Validate your installed dependencies:, +-------------------------------------, +mvn -Pvagrant -pl qa/vagrant validate, +-------------------------------------, +. Download the VMs. Since Maven or ant or something eats the progress reports, +from Vagrant when you run it inside mvn its probably best if you run this one, +time to setup all the VMs one at a time. Run this to download and setup the VMs, +we use for testing by default:, +--------------------------------------------------------, +vagrant up --provision trusty && vagrant halt trusty, +vagrant up --provision centos-7 && vagrant halt centos-7, +--------------------------------------------------------, +or run this to download and setup all the VMs:, +-------------------------------------------------------------------------------, +vagrant halt, +for box in $(vagrant status | grep 'poweroff\|not created' | cut -f1 -d' '); do, +  vagrant up --provision $box, +  vagrant halt $box, +done, +-------------------------------------------------------------------------------, +, +. Smoke test the maven/ant dance that we use to get vagrant involved in, +integration testing is working:, +---------------------------------------------, +mvn -Pvagrant,smoke-vms -pl qa/vagrant verify, +---------------------------------------------, +or this to validate all the VMs:, +-------------------------------------------------, +mvn -Pvagrant,smoke-vms,all -pl qa/vagrant verify, +-------------------------------------------------, +That will start up the VMs and then immediate quit., +, +. Finally run the tests. The fastest way to get this started is to run:, +-----------------------------------, +mvn clean install -DskipTests, +mvn -Pvagrant -pl qa/vagrant verify, +-----------------------------------, +You could just run:, +--------------------, +mvn -Pvagrant verify, +--------------------, +but that will run all the tests. Which is probably a good thing, but not always, +what you want., +, +Whichever snippet you run mvn will build the tar, zip and deb packages. If you, +have rpmbuild installed it'll build the rpm package as well. Then mvn will, +spin up trusty and verify the tar, zip, and deb package. If you have rpmbuild, +installed it'll spin up centos-7 and verify the tar, zip and rpm packages. We, +chose those two distributions as the default because they cover deb and rpm, +packaging and SyvVinit and systemd., +, +You can control the boxes that are used for testing like so. Run just, +fedora-22 with:, +--------------------------------------------, +mvn -Pvagrant -pl qa/vagrant verify -DboxesToTest=fedora-22, +--------------------------------------------, +or run wheezy and trusty:, +------------------------------------------------------------------, +mvn -Pvagrant -pl qa/vagrant verify -DboxesToTest='wheezy, trusty', +------------------------------------------------------------------, +or run all the boxes:, +---------------------------------------, +mvn -Pvagrant,all -pl qa/vagrant verify, +---------------------------------------, +, +Its important to know that if you ctrl-c any of these `mvn` runs that you'll, +probably leave a VM up. You can terminate it by running:, +------------, +vagrant halt, +------------, +, +This is just regular vagrant so you can run normal multi box vagrant commands, +to test things manually. Just run:, +---------------------------------------, +vagrant up trusty && vagrant ssh trusty, +---------------------------------------, +to get an Ubuntu or, +-------------------------------------------, +vagrant up centos-7 && vagrant ssh centos-7, +-------------------------------------------, +to get a CentOS. Once you are done with them you should halt them:, +-------------------, +vagrant halt trusty, +-------------------, +]