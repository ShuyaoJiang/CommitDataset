[+++ b/core/src/main/java/org/elasticsearch/action/support/ActiveShardCount.java, +        final int activeShardCount = shardRoutingTable.activeShards().size();, +            // adding 1 for the primary in addition to the total number of replicas,, +            // which gives us the total number of shard copies, +            return activeShardCount == shardRoutingTable.replicaShards().size() + 1;, +            return activeShardCount >= 1;, +            return activeShardCount >= value;, +++ b/core/src/main/java/org/elasticsearch/action/support/ActiveShardCount.java, +        final int activeShardCount = shardRoutingTable.activeShards().size();, +            // adding 1 for the primary in addition to the total number of replicas,, +            // which gives us the total number of shard copies, +            return activeShardCount == shardRoutingTable.replicaShards().size() + 1;, +            return activeShardCount >= 1;, +            return activeShardCount >= value;, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClient.java, +            NetworkModule networkModule = new NetworkModule(networkService, settings, true);, +            SearchModule searchModule = new SearchModule(settings, true, pluginsService.filterPlugins(SearchPlugin.class));, +            List<NamedWriteableRegistry.Entry> entries = new ArrayList<>();, +            entries.addAll(networkModule.getNamedWriteables());, +            entries.addAll(searchModule.getNamedWriteables());, +            NamedWriteableRegistry namedWriteableRegistry = new NamedWriteableRegistry(entries);, +, +            modules.add(networkModule);, +            modules.add(searchModule);, +                b.bind(NamedWriteableRegistry.class).toInstance(namedWriteableRegistry);, +++ b/core/src/main/java/org/elasticsearch/action/support/ActiveShardCount.java, +        final int activeShardCount = shardRoutingTable.activeShards().size();, +            // adding 1 for the primary in addition to the total number of replicas,, +            // which gives us the total number of shard copies, +            return activeShardCount == shardRoutingTable.replicaShards().size() + 1;, +            return activeShardCount >= 1;, +            return activeShardCount >= value;, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClient.java, +            NetworkModule networkModule = new NetworkModule(networkService, settings, true);, +            SearchModule searchModule = new SearchModule(settings, true, pluginsService.filterPlugins(SearchPlugin.class));, +            List<NamedWriteableRegistry.Entry> entries = new ArrayList<>();, +            entries.addAll(networkModule.getNamedWriteables());, +            entries.addAll(searchModule.getNamedWriteables());, +            NamedWriteableRegistry namedWriteableRegistry = new NamedWriteableRegistry(entries);, +, +            modules.add(networkModule);, +            modules.add(searchModule);, +                b.bind(NamedWriteableRegistry.class).toInstance(namedWriteableRegistry);, +++ b/core/src/main/java/org/elasticsearch/common/geo/builders/ShapeBuilders.java, +import com.vividsolutions.jts.geom.Coordinate;, +import org.elasticsearch.common.io.stream.NamedWriteableRegistry.Entry;, +, +    public static void register(List<Entry> namedWriteables) {, +        namedWriteables.add(new Entry(ShapeBuilder.class, PointBuilder.TYPE.shapeName(), PointBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, CircleBuilder.TYPE.shapeName(), CircleBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, EnvelopeBuilder.TYPE.shapeName(), EnvelopeBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, MultiPointBuilder.TYPE.shapeName(), MultiPointBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, LineStringBuilder.TYPE.shapeName(), LineStringBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, MultiLineStringBuilder.TYPE.shapeName(), MultiLineStringBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, PolygonBuilder.TYPE.shapeName(), PolygonBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, MultiPolygonBuilder.TYPE.shapeName(), MultiPolygonBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, GeometryCollectionBuilder.TYPE.shapeName(), GeometryCollectionBuilder::new));, +++ b/core/src/main/java/org/elasticsearch/action/support/ActiveShardCount.java, +        final int activeShardCount = shardRoutingTable.activeShards().size();, +            // adding 1 for the primary in addition to the total number of replicas,, +            // which gives us the total number of shard copies, +            return activeShardCount == shardRoutingTable.replicaShards().size() + 1;, +            return activeShardCount >= 1;, +            return activeShardCount >= value;, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClient.java, +            NetworkModule networkModule = new NetworkModule(networkService, settings, true);, +            SearchModule searchModule = new SearchModule(settings, true, pluginsService.filterPlugins(SearchPlugin.class));, +            List<NamedWriteableRegistry.Entry> entries = new ArrayList<>();, +            entries.addAll(networkModule.getNamedWriteables());, +            entries.addAll(searchModule.getNamedWriteables());, +            NamedWriteableRegistry namedWriteableRegistry = new NamedWriteableRegistry(entries);, +, +            modules.add(networkModule);, +            modules.add(searchModule);, +                b.bind(NamedWriteableRegistry.class).toInstance(namedWriteableRegistry);, +++ b/core/src/main/java/org/elasticsearch/common/geo/builders/ShapeBuilders.java, +import com.vividsolutions.jts.geom.Coordinate;, +import org.elasticsearch.common.io.stream.NamedWriteableRegistry.Entry;, +, +    public static void register(List<Entry> namedWriteables) {, +        namedWriteables.add(new Entry(ShapeBuilder.class, PointBuilder.TYPE.shapeName(), PointBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, CircleBuilder.TYPE.shapeName(), CircleBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, EnvelopeBuilder.TYPE.shapeName(), EnvelopeBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, MultiPointBuilder.TYPE.shapeName(), MultiPointBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, LineStringBuilder.TYPE.shapeName(), LineStringBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, MultiLineStringBuilder.TYPE.shapeName(), MultiLineStringBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, PolygonBuilder.TYPE.shapeName(), PolygonBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, MultiPolygonBuilder.TYPE.shapeName(), MultiPolygonBuilder::new));, +        namedWriteables.add(new Entry(ShapeBuilder.class, GeometryCollectionBuilder.TYPE.shapeName(), GeometryCollectionBuilder::new));, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableRegistry.java, +import java.util.ArrayList;, +import java.util.Collections;, +import java.util.List;, +import java.util.Objects;, +import java.util.stream.Collectors;, +import java.util.stream.Stream;, +, +import org.elasticsearch.plugins.Plugin;, + * A registry for {@link org.elasticsearch.common.io.stream.Writeable.Reader} readers of {@link NamedWriteable}., + *]