[+++ b/buildSrc/src/main/java/org/elasticsearch/gradle/testfixtures/TestFixturesPlugin.java, +            disableTaskByType(tasks, getTaskClass("org.elasticsearch.gradle.test.RestIntegTestTask"));, +                task.dependsOn(fixtureProject.getTasks().getByName("postProcessFixture"));, +++ b/buildSrc/src/main/java/org/elasticsearch/gradle/testfixtures/TestFixturesPlugin.java, +            disableTaskByType(tasks, getTaskClass("org.elasticsearch.gradle.test.RestIntegTestTask"));, +                task.dependsOn(fixtureProject.getTasks().getByName("postProcessFixture"));, +++ b/plugins/repository-hdfs/build.gradle, +apply plugin: 'elasticsearch.test.fixtures', +testFixtures.useFixture ":test:fixtures:krb5kdc-fixture", +, +    dependsOn project.configurations.hdfsFixture, project(':test:fixtures:krb5kdc-fixture').tasks.postProcessFixture, +      miniHDFSArgs.add("-Djava.security.krb5.conf=${project(':test:fixtures:krb5kdc-fixture').ext.krb5Conf("hdfs")}");, +      miniHDFSArgs.add(, +              project(':test:fixtures:krb5kdc-fixture'), +                      .ext.krb5Keytabs("hdfs", "hdfs_hdfs.build.elastic.co.keytab"), +      ), +      String krb5conf = project(':test:fixtures:krb5kdc-fixture').ext.krb5Conf("hdfs"), +      restIntegTestTask.clusterConfig.extraConfigFile(, +              "repository-hdfs/krb5.keytab",, +              "${project(':test:fixtures:krb5kdc-fixture').ext.krb5Keytabs("hdfs", "elasticsearch.keytab")}", +      ), +        restIntegTestTaskRunner.systemProperty (, +                "test.krb5.keytab.hdfs",, +                project(':test:fixtures:krb5kdc-fixture').ext.krb5Keytabs("hdfs","hdfs_hdfs.build.elastic.co.keytab"), +        ), +check.dependsOn(integTestSecure, integTestSecureHa), +integTestSecureCluster.dependsOn secureHdfsFixture, +integTestSecureHaCluster.dependsOn secureHaHdfsFixture, +  testRuntime fileTree(dir: project(':test:fixtures:krb5kdc-fixture').ext.krb5Keytabs("hdfs","hdfs_hdfs.build.elastic.co.keytab").parent, include: ['*.keytab']), +++ b/buildSrc/src/main/java/org/elasticsearch/gradle/testfixtures/TestFixturesPlugin.java, +            disableTaskByType(tasks, getTaskClass("org.elasticsearch.gradle.test.RestIntegTestTask"));, +                task.dependsOn(fixtureProject.getTasks().getByName("postProcessFixture"));, +++ b/plugins/repository-hdfs/build.gradle, +apply plugin: 'elasticsearch.test.fixtures', +testFixtures.useFixture ":test:fixtures:krb5kdc-fixture", +, +    dependsOn project.configurations.hdfsFixture, project(':test:fixtures:krb5kdc-fixture').tasks.postProcessFixture, +      miniHDFSArgs.add("-Djava.security.krb5.conf=${project(':test:fixtures:krb5kdc-fixture').ext.krb5Conf("hdfs")}");, +      miniHDFSArgs.add(, +              project(':test:fixtures:krb5kdc-fixture'), +                      .ext.krb5Keytabs("hdfs", "hdfs_hdfs.build.elastic.co.keytab"), +      ), +      String krb5conf = project(':test:fixtures:krb5kdc-fixture').ext.krb5Conf("hdfs"), +      restIntegTestTask.clusterConfig.extraConfigFile(, +              "repository-hdfs/krb5.keytab",, +              "${project(':test:fixtures:krb5kdc-fixture').ext.krb5Keytabs("hdfs", "elasticsearch.keytab")}", +      ), +        restIntegTestTaskRunner.systemProperty (, +                "test.krb5.keytab.hdfs",, +                project(':test:fixtures:krb5kdc-fixture').ext.krb5Keytabs("hdfs","hdfs_hdfs.build.elastic.co.keytab"), +        ), +check.dependsOn(integTestSecure, integTestSecureHa), +integTestSecureCluster.dependsOn secureHdfsFixture, +integTestSecureHaCluster.dependsOn secureHaHdfsFixture, +  testRuntime fileTree(dir: project(':test:fixtures:krb5kdc-fixture').ext.krb5Keytabs("hdfs","hdfs_hdfs.build.elastic.co.keytab").parent, include: ['*.keytab']), +++ b/test/fixtures/hdfs-fixture/Dockerfile, +FROM java:8-jre, +, +RUN apt-get update && apt-get install net-tools, +, +EXPOSE 9998, +EXPOSE 9999, +, +CMD java -cp "/fixture:/fixture/*" hdfs.MiniHDFS /data, +++ b/buildSrc/src/main/java/org/elasticsearch/gradle/testfixtures/TestFixturesPlugin.java, +            disableTaskByType(tasks, getTaskClass("org.elasticsearch.gradle.test.RestIntegTestTask"));, +                task.dependsOn(fixtureProject.getTasks().getByName("postProcessFixture"));, +++ b/plugins/repository-hdfs/build.gradle, +apply plugin: 'elasticsearch.test.fixtures', +testFixtures.useFixture ":test:fixtures:krb5kdc-fixture", +, +    dependsOn project.configurations.hdfsFixture, project(':test:fixtures:krb5kdc-fixture').tasks.postProcessFixture, +      miniHDFSArgs.add("-Djava.security.krb5.conf=${project(':test:fixtures:krb5kdc-fixture').ext.krb5Conf("hdfs")}");, +      miniHDFSArgs.add(, +              project(':test:fixtures:krb5kdc-fixture'), +                      .ext.krb5Keytabs("hdfs", "hdfs_hdfs.build.elastic.co.keytab"), +      ), +      String krb5conf = project(':test:fixtures:krb5kdc-fixture').ext.krb5Conf("hdfs"), +      restIntegTestTask.clusterConfig.extraConfigFile(, +              "repository-hdfs/krb5.keytab",, +              "${project(':test:fixtures:krb5kdc-fixture').ext.krb5Keytabs("hdfs", "elasticsearch.keytab")}", +      ), +        restIntegTestTaskRunner.systemProperty (, +                "test.krb5.keytab.hdfs",, +                project(':test:fixtures:krb5kdc-fixture').ext.krb5Keytabs("hdfs","hdfs_hdfs.build.elastic.co.keytab"), +        ), +check.dependsOn(integTestSecure, integTestSecureHa), +integTestSecureCluster.dependsOn secureHdfsFixture, +integTestSecureHaCluster.dependsOn secureHaHdfsFixture, +  testRuntime fileTree(dir: project(':test:fixtures:krb5kdc-fixture').ext.krb5Keytabs("hdfs","hdfs_hdfs.build.elastic.co.keytab").parent, include: ['*.keytab']), +++ b/test/fixtures/hdfs-fixture/Dockerfile, +FROM java:8-jre, +, +RUN apt-get update && apt-get install net-tools, +, +EXPOSE 9998, +EXPOSE 9999, +, +CMD java -cp "/fixture:/fixture/*" hdfs.MiniHDFS /data, +++ b/test/fixtures/hdfs-fixture/build.gradle]