[+++ b/src/test/java/org/elasticsearch/indexing/IndexActionTests.java, +import org.elasticsearch.action.index.IndexRequestBuilder;, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertHitCount;, +    /**, +     * This test tries to simulate load while creating an index and indexing documents, +     * while the index is being created., +     */, +    @Test, +    public void testAutoGenerateIdNoDuplicates() throws Exception {, +        int numberOfIterations = randomIntBetween(10, 50);, +        for (int i = 0; i < numberOfIterations; i++) {, +            createIndex("test");, +            int numOfDocs = randomIntBetween(10, 100);, +            List<IndexRequestBuilder> builders = new ArrayList<>(numOfDocs);, +            for (int j = 0; j < numOfDocs; j++) {, +                builders.add(client().prepareIndex("test", "type").setSource("field", "value"));, +            }, +            indexRandom(true, builders);, +            int numOfChecks = randomIntBetween(5, 10);, +            for (int j = 0; j < numOfChecks; j++) {, +                assertHitCount(client().prepareSearch("test").get(), numOfDocs);, +            }, +            cluster().wipeIndices("test");, +        }, +    }, +]