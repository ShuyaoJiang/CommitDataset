[+++ b/src/test/java/org/elasticsearch/gateway/local/QuorumLocalGatewayTests.java, +import static org.hamcrest.Matchers.is;, +        logger.info("--> restarting 1 nodes -- kill 2");, +                return nodeToRemove.equals(nodeName);, +        if (randomBoolean()) {, +            Thread.sleep(between(1, 400)); // wait a bit and give is a chance to try to allocate, +        clusterHealth = client().admin().cluster().health(clusterHealthRequest().waitForNodes("1")).actionGet();, +        assertThat(clusterHealth.isTimedOut(), equalTo(false));, +        assertThat(clusterHealth.getStatus(), equalTo(ClusterHealthStatus.RED));  // nothing allocated yet, +        ClusterStateResponse clusterStateResponse = cluster().smartClient().admin().cluster().prepareState().setMasterNodeTimeout("500ms").get();, +        assertThat(clusterStateResponse.getState().routingTable().index("test").allPrimaryShardsActive(), is(false));, +        logger.info("--> running cluster_health (wait for the shards to startup), 2 shards since we only have 1 node");, +        clusterHealth = client().admin().cluster().health(clusterHealthRequest().waitForYellowStatus().waitForActiveShards(2)).actionGet();]