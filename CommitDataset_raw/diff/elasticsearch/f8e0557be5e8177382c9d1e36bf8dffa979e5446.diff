[+++ b/core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java, +import java.util.Locale;, +            return String.join("-", sourceIndexName.substring(0, numberIndex), String.format(Locale.ROOT, "%06d", ++counter));, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java, +import java.util.Locale;, +            return String.join("-", sourceIndexName.substring(0, numberIndex), String.format(Locale.ROOT, "%06d", ++counter));, +++ b/core/src/main/java/org/elasticsearch/env/ESFileStore.java, +        return in.getTotalSpace();, +        return in.getUsableSpace();, +        return in.getUnallocatedSpace();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java, +import java.util.Locale;, +            return String.join("-", sourceIndexName.substring(0, numberIndex), String.format(Locale.ROOT, "%06d", ++counter));, +++ b/core/src/main/java/org/elasticsearch/env/ESFileStore.java, +        return in.getTotalSpace();, +        return in.getUsableSpace();, +        return in.getUnallocatedSpace();, +++ b/core/src/main/java/org/elasticsearch/index/shard/ShardPath.java, +            long totFreeSpace = 0;, +                totFreeSpace += nodePath.fileStore.getUsableSpace();, +            long estShardSizeInBytes = Math.max(avgShardSizeInBytes, (long) (totFreeSpace/20.0));, +            long maxUsableBytes = Long.MIN_VALUE;, +                long usableBytes = fileStore.getUsableSpace();, +                    usableBytes -= estShardSizeInBytes * count;, +                if (usableBytes > maxUsableBytes) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java, +import java.util.Locale;, +            return String.join("-", sourceIndexName.substring(0, numberIndex), String.format(Locale.ROOT, "%06d", ++counter));, +++ b/core/src/main/java/org/elasticsearch/env/ESFileStore.java, +        return in.getTotalSpace();, +        return in.getUsableSpace();, +        return in.getUnallocatedSpace();, +++ b/core/src/main/java/org/elasticsearch/index/shard/ShardPath.java, +            long totFreeSpace = 0;, +                totFreeSpace += nodePath.fileStore.getUsableSpace();, +            long estShardSizeInBytes = Math.max(avgShardSizeInBytes, (long) (totFreeSpace/20.0));, +            long maxUsableBytes = Long.MIN_VALUE;, +                long usableBytes = fileStore.getUsableSpace();, +                    usableBytes -= estShardSizeInBytes * count;, +                if (usableBytes > maxUsableBytes) {, +++ b/core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverIT.java, +        assertThat(response.getNewIndex(), equalTo("test_index-000002"));, +        final IndexMetaData newIndex = state.metaData().index("test_index-000002");, +        assertThat(response.getNewIndex(), equalTo("test_index-000003"));, +        final IndexMetaData newIndex = state.metaData().index("test_index-000003");, +        assertThat(response.getNewIndex(), equalTo("test_index-000003"));, +        final IndexMetaData newIndex = state.metaData().index("test_index-000003");, +        assertThat(response.getNewIndex(), equalTo("test_index-000002"));, +        final IndexMetaData newIndex = state.metaData().index("test_index-000002");, +        final IndexMetaData newIndex = state.metaData().index("test_index-000001");, +        assertAcked(prepareCreate("test_index-000001").get());, +        index("test_index-000001", "type1", "1", "field", "value");, +        flush("test_index-0", "test_index-000001");, +            assertThat(e.getIndex().getName(), equalTo("test_index-000001"));, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java, +import java.util.Locale;, +            return String.join("-", sourceIndexName.substring(0, numberIndex), String.format(Locale.ROOT, "%06d", ++counter));, +++ b/core/src/main/java/org/elasticsearch/env/ESFileStore.java, +        return in.getTotalSpace();, +        return in.getUsableSpace();, +        return in.getUnallocatedSpace();, +++ b/core/src/main/java/org/elasticsearch/index/shard/ShardPath.java, +            long totFreeSpace = 0;, +                totFreeSpace += nodePath.fileStore.getUsableSpace();, +            long estShardSizeInBytes = Math.max(avgShardSizeInBytes, (long) (totFreeSpace/20.0));, +            long maxUsableBytes = Long.MIN_VALUE;, +                long usableBytes = fileStore.getUsableSpace();, +                    usableBytes -= estShardSizeInBytes * count;, +                if (usableBytes > maxUsableBytes) {, +++ b/core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverIT.java, +        assertThat(response.getNewIndex(), equalTo("test_index-000002"));, +        final IndexMetaData newIndex = state.metaData().index("test_index-000002");, +        assertThat(response.getNewIndex(), equalTo("test_index-000003"));, +        final IndexMetaData newIndex = state.metaData().index("test_index-000003");, +        assertThat(response.getNewIndex(), equalTo("test_index-000003"));, +        final IndexMetaData newIndex = state.metaData().index("test_index-000003");, +        assertThat(response.getNewIndex(), equalTo("test_index-000002"));, +        final IndexMetaData newIndex = state.metaData().index("test_index-000002");, +        final IndexMetaData newIndex = state.metaData().index("test_index-000001");, +        assertAcked(prepareCreate("test_index-000001").get());, +        index("test_index-000001", "type1", "1", "field", "value");, +        flush("test_index-0", "test_index-000001");, +            assertThat(e.getIndex().getName(), equalTo("test_index-000001"));, +++ b/core/src/test/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverActionTests.java, +import java.util.Locale;, +            equalTo(indexPrefix + "-" + String.format(Locale.ROOT, "%06d", num + 1)));, +        assertThat(TransportRolloverAction.generateRolloverIndexName("index-name-1"), equalTo("index-name-000002"));, +        assertThat(TransportRolloverAction.generateRolloverIndexName("index-name-2"), equalTo("index-name-000003"));, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java, +import java.util.Locale;, +            return String.join("-", sourceIndexName.substring(0, numberIndex), String.format(Locale.ROOT, "%06d", ++counter));, +++ b/core/src/main/java/org/elasticsearch/env/ESFileStore.java, +        return in.getTotalSpace();, +        return in.getUsableSpace();, +        return in.getUnallocatedSpace();, +++ b/core/src/main/java/org/elasticsearch/index/shard/ShardPath.java, +            long totFreeSpace = 0;, +                totFreeSpace += nodePath.fileStore.getUsableSpace();, +            long estShardSizeInBytes = Math.max(avgShardSizeInBytes, (long) (totFreeSpace/20.0));, +            long maxUsableBytes = Long.MIN_VALUE;]