[+++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.persistent.CompletionPersistentTaskAction;, +import org.elasticsearch.persistent.PersistentTaskParams;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksNodeService;, +import org.elasticsearch.persistent.RemovePersistentTaskAction;, +import org.elasticsearch.persistent.StartPersistentTaskAction;, +import org.elasticsearch.persistent.UpdatePersistentTaskStatusAction;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.persistent.CompletionPersistentTaskAction;, +import org.elasticsearch.persistent.PersistentTaskParams;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksNodeService;, +import org.elasticsearch.persistent.RemovePersistentTaskAction;, +import org.elasticsearch.persistent.StartPersistentTaskAction;, +import org.elasticsearch.persistent.UpdatePersistentTaskStatusAction;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData.PersistentTask;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.persistent.CompletionPersistentTaskAction;, +import org.elasticsearch.persistent.PersistentTaskParams;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksNodeService;, +import org.elasticsearch.persistent.RemovePersistentTaskAction;, +import org.elasticsearch.persistent.StartPersistentTaskAction;, +import org.elasticsearch.persistent.UpdatePersistentTaskStatusAction;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData.PersistentTask;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +import org.elasticsearch.persistent.PersistentTaskParams;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.persistent.CompletionPersistentTaskAction;, +import org.elasticsearch.persistent.PersistentTaskParams;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksNodeService;, +import org.elasticsearch.persistent.RemovePersistentTaskAction;, +import org.elasticsearch.persistent.StartPersistentTaskAction;, +import org.elasticsearch.persistent.UpdatePersistentTaskStatusAction;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData.PersistentTask;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +import org.elasticsearch.persistent.PersistentTaskParams;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StartDatafeedAction.java, +import org.elasticsearch.persistent.PersistentTaskParams;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.persistent.CompletionPersistentTaskAction;, +import org.elasticsearch.persistent.PersistentTaskParams;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksNodeService;, +import org.elasticsearch.persistent.RemovePersistentTaskAction;, +import org.elasticsearch.persistent.StartPersistentTaskAction;, +import org.elasticsearch.persistent.UpdatePersistentTaskStatusAction;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData.PersistentTask;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +import org.elasticsearch.persistent.PersistentTaskParams;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StartDatafeedAction.java, +import org.elasticsearch.persistent.PersistentTaskParams;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/config/JobTaskStatus.java, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData.PersistentTask;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.persistent.CompletionPersistentTaskAction;, +import org.elasticsearch.persistent.PersistentTaskParams;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksNodeService;, +import org.elasticsearch.persistent.RemovePersistentTaskAction;, +import org.elasticsearch.persistent.StartPersistentTaskAction;, +import org.elasticsearch.persistent.UpdatePersistentTaskStatusAction;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData.PersistentTask;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +import org.elasticsearch.persistent.PersistentTaskParams;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StartDatafeedAction.java, +import org.elasticsearch.persistent.PersistentTaskParams;, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/config/JobTaskStatus.java, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData.PersistentTask;, +++ b/plugin/core/src/test/java/org/elasticsearch/xpack/core/LocalStateCompositeXPackPlugin.java, +import org.elasticsearch.plugins.PersistentTaskPlugin;, +import org.elasticsearch.persistent.PersistentTasksExecutor;, +import static java.util.stream.Collectors.toList;, +, +        ClusterPlugin, DiscoveryPlugin, MapperPlugin, AnalysisPlugin, PersistentTaskPlugin {, +    @Override, +    public List<PersistentTasksExecutor<?>> getPersistentTasksExecutor(ClusterService clusterService) {, +        return filterPlugins(PersistentTaskPlugin.class).stream(), +                .map(p -> p.getPersistentTasksExecutor(clusterService)), +                .flatMap(List::stream), +                .collect(toList());, +    }, +, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.persistent.CompletionPersistentTaskAction;, +import org.elasticsearch.persistent.PersistentTaskParams;, +import org.elasticsearch.persistent.PersistentTasksCustomMetaData;, +import org.elasticsearch.persistent.PersistentTasksNodeService;]