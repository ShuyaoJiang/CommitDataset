[+++ b/docs/reference/aggregations/pipeline.asciidoc, +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +include::pipeline/movfn-aggregation.asciidoc[], +++ b/docs/reference/aggregations/pipeline.asciidoc, +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +include::pipeline/movfn-aggregation.asciidoc[], +++ b/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc, +deprecated[6.4.0, The Moving Average aggregation has been deprecated in favor of the more general, +<<search-aggregations-pipeline-movfn-aggregation,Moving Function Aggregation>>.  The new Moving Function aggregation provides, +all the same functionality as the Moving Average aggregation, but also provides more flexibility.], +, +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +++ b/docs/reference/aggregations/pipeline.asciidoc, +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +include::pipeline/movfn-aggregation.asciidoc[], +++ b/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc, +deprecated[6.4.0, The Moving Average aggregation has been deprecated in favor of the more general, +<<search-aggregations-pipeline-movfn-aggregation,Moving Function Aggregation>>.  The new Moving Function aggregation provides, +all the same functionality as the Moving Average aggregation, but also provides more flexibility.], +, +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +// TEST[warning:The moving_avg aggregation has been deprecated in favor of the moving_fn aggregation.], +++ b/docs/reference/aggregations/pipeline/movfn-aggregation.asciidoc, +[[search-aggregations-pipeline-movfn-aggregation]], +=== Moving Function Aggregation, +, +Given an ordered series of data, the Moving Function aggregation will slide a window across the data and allow the user to specify a custom, +script that is executed on each window of data.  For convenience, a number of common functions are predefined such as min/max, moving averages,, +etc., +, +This is conceptually very similar to the <<search-aggregations-pipeline-movavg-aggregation, Moving Average>> pipeline aggregation, except, +it provides more functionality., +==== Syntax, +, +A `moving_fn` aggregation looks like this in isolation:, +, +[source,js], +--------------------------------------------------, +{, +    "moving_fn": {, +        "buckets_path": "the_sum",, +        "window": 10,, +        "script": "MovingFunctions.min(values)", +    }, +}, +--------------------------------------------------, +// NOTCONSOLE, +, +.`moving_avg` Parameters, +|===, +|Parameter Name |Description |Required |Default Value, +|`buckets_path` |Path to the metric of interest (see <<buckets-path-syntax, `buckets_path` Syntax>> for more details |Required |, +|`window` |The size of window to "slide" across the histogram. |Required |, +|`script` |The script that should be executed on each window of data |Required |, +|===, +, +`moving_fn` aggregations must be embedded inside of a `histogram` or `date_histogram` aggregation.  They can be, +embedded like any other metric aggregation:, +, +[source,js], +--------------------------------------------------, +POST /_search, +{, +    "size": 0,, +    "aggs": {, +        "my_date_histo":{                <1>, +            "date_histogram":{, +                "field":"date",, +                "interval":"1M", +            },, +            "aggs":{, +                "the_sum":{, +                    "sum":{ "field": "price" } <2>, +                },, +                "the_movfn": {, +                    "moving_fn": {, +                        "buckets_path": "the_sum", <3>, +                        "window": 10,, +                        "script": "MovingFunctions.unweightedAvg(values)", +                    }, +                }, +            }]