[+++ b/client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java, +import org.elasticsearch.common.SuppressForbidden;, +    static {, +        // initialize Netty system properties before triggering any Netty class loads, +        initializeNetty();, +    }, +, +    /**, +     * Netty wants to do some unsafe things like use unsafe and replace a private field. This method disables these things by default, but, +     * can be overridden by setting the corresponding system properties., +     */, +    @SuppressForbidden(reason = "set system properties to configure Netty"), +    private static void initializeNetty() {, +        final String noUnsafeKey = "io.netty.noUnsafe";, +        final String noUnsafe = System.getProperty(noUnsafeKey);, +        if (noUnsafe == null) {, +            // disable Netty from using unsafe, +            System.setProperty(noUnsafeKey, Boolean.toString(true));, +        }, +, +        final String noKeySetOptimizationKey = "io.netty.noKeySetOptimization";, +        final String noKeySetOptimization = System.getProperty(noKeySetOptimizationKey);, +        if (noKeySetOptimization == null) {, +            // disable Netty from replacing the selector key set, +            System.setProperty(noKeySetOptimizationKey, Boolean.toString(true));, +        }, +    }, +, +++ b/client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java, +import org.elasticsearch.common.SuppressForbidden;, +    static {, +        // initialize Netty system properties before triggering any Netty class loads, +        initializeNetty();, +    }, +, +    /**, +     * Netty wants to do some unsafe things like use unsafe and replace a private field. This method disables these things by default, but, +     * can be overridden by setting the corresponding system properties., +     */, +    @SuppressForbidden(reason = "set system properties to configure Netty"), +    private static void initializeNetty() {, +        final String noUnsafeKey = "io.netty.noUnsafe";, +        final String noUnsafe = System.getProperty(noUnsafeKey);, +        if (noUnsafe == null) {, +            // disable Netty from using unsafe, +            System.setProperty(noUnsafeKey, Boolean.toString(true));, +        }, +, +        final String noKeySetOptimizationKey = "io.netty.noKeySetOptimization";, +        final String noKeySetOptimization = System.getProperty(noKeySetOptimizationKey);, +        if (noKeySetOptimization == null) {, +            // disable Netty from replacing the selector key set, +            System.setProperty(noKeySetOptimizationKey, Boolean.toString(true));, +        }, +    }, +, +++ b/client/transport/src/test/java/org/elasticsearch/transport/client/PreBuiltTransportClientTests.java, +        // TODO: remove when Netty 4.1.6 is upgraded to Netty 4.1.7 including https://github.com/netty/netty/pull/6068]