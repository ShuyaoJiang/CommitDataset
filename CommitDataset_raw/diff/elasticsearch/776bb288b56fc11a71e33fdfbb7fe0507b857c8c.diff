[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/core/src/test/java/org/elasticsearch/ESExceptionTests.java, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/core/src/test/java/org/elasticsearch/ESExceptionTests.java, +++ b/core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/core/src/test/java/org/elasticsearch/ESExceptionTests.java, +++ b/core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java, +++ b/core/src/test/java/org/elasticsearch/index/store/StoreTests.java, +            assertArrayEquals(ex.getStackTrace(), e.getStackTrace());, +            assertArrayEquals(ioe.getStackTrace(), e.getCause().getStackTrace());, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/core/src/test/java/org/elasticsearch/ESExceptionTests.java, +++ b/core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java, +++ b/core/src/test/java/org/elasticsearch/index/store/StoreTests.java, +            assertArrayEquals(ex.getStackTrace(), e.getStackTrace());, +            assertArrayEquals(ioe.getStackTrace(), e.getCause().getStackTrace());, +++ b/qa/evil-tests/src/test/java/org/elasticsearch/plugins/PluginManagerTests.java, +        SelfSignedCertificate ssc = null;, +            try {, +                ssc = new SelfSignedCertificate("localhost");, +            } catch (Exception e) {, +                assumeNoException("self signing shenanigans not supported by this JDK", e);, +            }, +            if (ssc != null) {, +    }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/core/src/test/java/org/elasticsearch/ESExceptionTests.java, +++ b/core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java, +++ b/core/src/test/java/org/elasticsearch/index/store/StoreTests.java, +            assertArrayEquals(ex.getStackTrace(), e.getStackTrace());, +            assertArrayEquals(ioe.getStackTrace(), e.getCause().getStackTrace());, +++ b/qa/evil-tests/src/test/java/org/elasticsearch/plugins/PluginManagerTests.java, +        SelfSignedCertificate ssc = null;, +            try {, +                ssc = new SelfSignedCertificate("localhost");, +            } catch (Exception e) {, +                assumeNoException("self signing shenanigans not supported by this JDK", e);, +            }, +            if (ssc != null) {, +    }, +++ b/test-framework/src/main/java/org/elasticsearch/test/ESTestCase.java, +import org.elasticsearch.ExceptionsHelper;, +, +    /** Compares two stack traces, ignoring module (which is not yet serialized) */, +    public static void assertArrayEquals(StackTraceElement expected[], StackTraceElement actual[]) {, +        assertEquals(expected.length, actual.length);, +        for (int i = 0; i < expected.length; i++) {, +            assertEquals(expected[i], actual[i]);, +        }, +    }, +, +    /** Compares two stack trace elements, ignoring module (which is not yet serialized) */, +    public static void assertEquals(StackTraceElement expected, StackTraceElement actual) {, +        assertEquals(expected.getClassName(), actual.getClassName());, +        assertEquals(expected.getMethodName(), actual.getMethodName());, +        assertEquals(expected.getFileName(), actual.getFileName());, +        assertEquals(expected.getLineNumber(), actual.getLineNumber());, +        assertEquals(expected.isNativeMethod(), actual.isNativeMethod());, +    }]