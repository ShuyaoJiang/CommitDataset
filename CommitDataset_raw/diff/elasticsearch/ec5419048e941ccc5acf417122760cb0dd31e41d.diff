[+++ b/core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java, +            throw new IllegalArgumentException("unknown setting [" + key + "]");, +++ b/core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java, +            throw new IllegalArgumentException("unknown setting [" + key + "]");, +++ b/core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java, +            // since we upgraded the index folders already, write index state in the upgraded index folder, +            metaStateService.writeIndex("upgrade", indexMetaData);, +++ b/core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java, +            throw new IllegalArgumentException("unknown setting [" + key + "]");, +++ b/core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java, +            // since we upgraded the index folders already, write index state in the upgraded index folder, +            metaStateService.writeIndex("upgrade", indexMetaData);, +++ b/core/src/main/java/org/elasticsearch/gateway/MetaStateService.java, +            IndexMetaData.FORMAT.write(indexMetaData, indexMetaData.getVersion(),, +                nodeEnv.indexPaths(indexMetaData.getIndex()));, +++ b/core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java, +            throw new IllegalArgumentException("unknown setting [" + key + "]");, +++ b/core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java, +            // since we upgraded the index folders already, write index state in the upgraded index folder, +            metaStateService.writeIndex("upgrade", indexMetaData);, +++ b/core/src/main/java/org/elasticsearch/gateway/MetaStateService.java, +            IndexMetaData.FORMAT.write(indexMetaData, indexMetaData.getVersion(),, +                nodeEnv.indexPaths(indexMetaData.getIndex()));, +++ b/core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java]