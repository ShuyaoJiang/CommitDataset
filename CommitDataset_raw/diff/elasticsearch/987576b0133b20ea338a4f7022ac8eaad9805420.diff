[+++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/transport/ssl/SslMultiPortTests.java, +import org.elasticsearch.common.network.NetworkAddress;, +    private static InetAddress localAddress;, +        localAddress = InetAddress.getLoopbackAddress();, +            .put("transport.profiles.client.bind_host", NetworkAddress.format(localAddress)), +            .put("transport.profiles.no_client_auth.bind_host", NetworkAddress.format(localAddress)), +            transportClient.addTransportAddress(new TransportAddress(localAddress,, +            transportClient.addTransportAddress(new TransportAddress(localAddress, getProfilePort("client")));, +            transportClient.addTransportAddress(new TransportAddress(localAddress, getProfilePort("client")));, +            transportClient.addTransportAddress(new TransportAddress(localAddress,, +            transportClient.addTransportAddress(new TransportAddress(localAddress, getProfilePort("client")));, +            transportClient.addTransportAddress(new TransportAddress(localAddress,, +            transportClient.addTransportAddress(new TransportAddress(localAddress,, +            transportClient.addTransportAddress(new TransportAddress(localAddress, getProfilePort("client")));, +            transportClient.addTransportAddress(new TransportAddress(localAddress, getProfilePort("client")));, +            transportClient.addTransportAddress(new TransportAddress(localAddress,, +        TransportAddress[] transportAddresses =, +            internalCluster().getInstance(Transport.class).profileBoundAddresses().get(profile).boundAddresses();, +        for (TransportAddress address : transportAddresses) {, +            if (address.address().getAddress().equals(localAddress)) {, +                return address.address().getPort();, +            }, +        }, +        throw new IllegalStateException("failed to find transport address equal to [" + NetworkAddress.format(localAddress) + "] " +, +            " in the following bound addresses " + Arrays.toString(transportAddresses));]