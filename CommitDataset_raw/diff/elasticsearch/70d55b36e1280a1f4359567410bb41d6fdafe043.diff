[+++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +     * Reads an optional {@link NamedWriteable}., +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +     * Reads an optional {@link NamedWriteable}., +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +     * Write an optional {@link QueryBuilder} to the stream., +     */, +    public void writeOptionalNamedWriteable(@Nullable NamedWriteable<?> namedWriteable) throws IOException {, +        if (namedWriteable == null) {, +            writeBoolean(false);, +        } else {, +            writeBoolean(true);, +            writeNamedWriteable(namedWriteable);, +        }, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +     * Reads an optional {@link NamedWriteable}., +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +     * Write an optional {@link QueryBuilder} to the stream., +     */, +    public void writeOptionalNamedWriteable(@Nullable NamedWriteable<?> namedWriteable) throws IOException {, +        if (namedWriteable == null) {, +            writeBoolean(false);, +        } else {, +            writeBoolean(true);, +            writeNamedWriteable(namedWriteable);, +        }, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java, +        out.writeOptionalNamedWriteable(nestedFilter);, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +     * Reads an optional {@link NamedWriteable}., +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +     * Write an optional {@link QueryBuilder} to the stream., +     */, +    public void writeOptionalNamedWriteable(@Nullable NamedWriteable<?> namedWriteable) throws IOException {, +        if (namedWriteable == null) {, +            writeBoolean(false);, +        } else {, +            writeBoolean(true);, +            writeNamedWriteable(namedWriteable);, +        }, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java, +        out.writeOptionalNamedWriteable(nestedFilter);, +++ b/core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java, +        out.writeOptionalNamedWriteable(nestedFilter);, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +     * Reads an optional {@link NamedWriteable}., +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +     * Write an optional {@link QueryBuilder} to the stream., +     */, +    public void writeOptionalNamedWriteable(@Nullable NamedWriteable<?> namedWriteable) throws IOException {, +        if (namedWriteable == null) {, +            writeBoolean(false);, +        } else {, +            writeBoolean(true);, +            writeNamedWriteable(namedWriteable);, +        }, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java, +        out.writeOptionalNamedWriteable(nestedFilter);, +++ b/core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java, +        out.writeOptionalNamedWriteable(nestedFilter);, +++ b/core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java, +        out.writeOptionalNamedWriteable(nestedFilter);]