[+++ b/Vagrantfile, +export SYSTEM_JAVA_HOME=\\\$JAVA_HOME, +unset JAVA_HOME, +Defaults   env_keep += "SYSTEM_JAVA_HOME", +    $javaHome = [Environment]::GetEnvironmentVariable("JAVA_HOME", "Machine"), +    [Environment]::SetEnvironmentVariable("SYSTEM_JAVA_HOME", $javaHome, "Machine"), +    [Environment]::SetEnvironmentVariable("JAVA_HOME", $null, "Machine"), +++ b/Vagrantfile, +export SYSTEM_JAVA_HOME=\\\$JAVA_HOME, +unset JAVA_HOME, +Defaults   env_keep += "SYSTEM_JAVA_HOME", +    $javaHome = [Environment]::GetEnvironmentVariable("JAVA_HOME", "Machine"), +    [Environment]::SetEnvironmentVariable("SYSTEM_JAVA_HOME", $javaHome, "Machine"), +    [Environment]::SetEnvironmentVariable("JAVA_HOME", $null, "Machine"), +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            project.rootProject.ext.isRuntimeJavaHomeSet = compilerJavaHome.equals(runtimeJavaHome) == false, +        project.ext.isRuntimeJavaHomeSet = project.rootProject.ext.isRuntimeJavaHomeSet, +++ b/Vagrantfile, +export SYSTEM_JAVA_HOME=\\\$JAVA_HOME, +unset JAVA_HOME, +Defaults   env_keep += "SYSTEM_JAVA_HOME", +    $javaHome = [Environment]::GetEnvironmentVariable("JAVA_HOME", "Machine"), +    [Environment]::SetEnvironmentVariable("SYSTEM_JAVA_HOME", $javaHome, "Machine"), +    [Environment]::SetEnvironmentVariable("JAVA_HOME", $null, "Machine"), +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            project.rootProject.ext.isRuntimeJavaHomeSet = compilerJavaHome.equals(runtimeJavaHome) == false, +        project.ext.isRuntimeJavaHomeSet = project.rootProject.ext.isRuntimeJavaHomeSet, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +            // TODO: this must change to 7.0.0 after bundling java has been backported, +            if (project.isRuntimeJavaHomeSet || node.nodeVersion.before(Version.fromString("8.0.0"))) {, +                exec.environment.put('JAVA_HOME', project.runtimeJavaHome), +            } else {, +                // force JAVA_HOME to *not* be set, +                exec.environment.remove('JAVA_HOME'), +            }, +            ant.exec(executable: node.executable, spawn: node.config.daemonize, newenvironment: true,, +                     dir: node.cwd, taskname: 'elasticsearch') {, +                if (project.isRuntimeJavaHomeSet || node.nodeVersion.before(Version.fromString("8.0.0"))) {, +                    env(key: 'JAVA_HOME', value: project.runtimeJavaHome), +                }, +++ b/Vagrantfile, +export SYSTEM_JAVA_HOME=\\\$JAVA_HOME, +unset JAVA_HOME, +Defaults   env_keep += "SYSTEM_JAVA_HOME", +    $javaHome = [Environment]::GetEnvironmentVariable("JAVA_HOME", "Machine"), +    [Environment]::SetEnvironmentVariable("SYSTEM_JAVA_HOME", $javaHome, "Machine"), +    [Environment]::SetEnvironmentVariable("JAVA_HOME", $null, "Machine"), +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            project.rootProject.ext.isRuntimeJavaHomeSet = compilerJavaHome.equals(runtimeJavaHome) == false, +        project.ext.isRuntimeJavaHomeSet = project.rootProject.ext.isRuntimeJavaHomeSet, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +            // TODO: this must change to 7.0.0 after bundling java has been backported, +            if (project.isRuntimeJavaHomeSet || node.nodeVersion.before(Version.fromString("8.0.0"))) {, +                exec.environment.put('JAVA_HOME', project.runtimeJavaHome), +            } else {, +                // force JAVA_HOME to *not* be set, +                exec.environment.remove('JAVA_HOME'), +            }, +            ant.exec(executable: node.executable, spawn: node.config.daemonize, newenvironment: true,, +                     dir: node.cwd, taskname: 'elasticsearch') {, +                if (project.isRuntimeJavaHomeSet || node.nodeVersion.before(Version.fromString("8.0.0"))) {, +                    env(key: 'JAVA_HOME', value: project.runtimeJavaHome), +                }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/NodeInfo.groovy, +++ b/Vagrantfile, +export SYSTEM_JAVA_HOME=\\\$JAVA_HOME, +unset JAVA_HOME, +Defaults   env_keep += "SYSTEM_JAVA_HOME", +    $javaHome = [Environment]::GetEnvironmentVariable("JAVA_HOME", "Machine"), +    [Environment]::SetEnvironmentVariable("SYSTEM_JAVA_HOME", $javaHome, "Machine"), +    [Environment]::SetEnvironmentVariable("JAVA_HOME", $null, "Machine"), +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            project.rootProject.ext.isRuntimeJavaHomeSet = compilerJavaHome.equals(runtimeJavaHome) == false, +        project.ext.isRuntimeJavaHomeSet = project.rootProject.ext.isRuntimeJavaHomeSet, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +            // TODO: this must change to 7.0.0 after bundling java has been backported, +            if (project.isRuntimeJavaHomeSet || node.nodeVersion.before(Version.fromString("8.0.0"))) {, +                exec.environment.put('JAVA_HOME', project.runtimeJavaHome), +            } else {, +                // force JAVA_HOME to *not* be set, +                exec.environment.remove('JAVA_HOME'), +            }, +            ant.exec(executable: node.executable, spawn: node.config.daemonize, newenvironment: true,, +                     dir: node.cwd, taskname: 'elasticsearch') {, +                if (project.isRuntimeJavaHomeSet || node.nodeVersion.before(Version.fromString("8.0.0"))) {, +                    env(key: 'JAVA_HOME', value: project.runtimeJavaHome), +                }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/NodeInfo.groovy, +++ b/buildSrc/src/main/minimumRuntime/org/elasticsearch/gradle/VersionProperties.java, +, +    public static String getBundledJdk() {, +        return bundledJdk;, +    }, +, +    private static final String bundledJdk;, +, +        bundledJdk = props.getProperty("bundled_jdk");, +, +++ b/Vagrantfile, +export SYSTEM_JAVA_HOME=\\\$JAVA_HOME]