[+++ b/docs/reference/modules/cluster/misc.asciidoc, +There is a soft limit on the number of shards in a cluster, based on the number, +of nodes in the cluster. This is intended to prevent operations which may, +unintentionally destabilize the cluster., +going over this limit, the operation will fail with an error indicating the, +shard limit., +setting changes, all operations that create or open indices will fail until, +either the limit is increased as described below, or some indices are, +The limit defaults to 1,000 shards per data node, and can be dynamically, +adjusted using the following property:, +     Controls the number of shards allowed in the cluster per data node., +NOTE: If there are no data nodes in the cluster, the limit will not be enforced., +This allows the creation of indices during cluster creation if dedicated master, +nodes are set up before data nodes., +, +++ b/docs/reference/modules/cluster/misc.asciidoc, +There is a soft limit on the number of shards in a cluster, based on the number, +of nodes in the cluster. This is intended to prevent operations which may, +unintentionally destabilize the cluster., +going over this limit, the operation will fail with an error indicating the, +shard limit., +setting changes, all operations that create or open indices will fail until, +either the limit is increased as described below, or some indices are, +The limit defaults to 1,000 shards per data node, and can be dynamically, +adjusted using the following property:, +     Controls the number of shards allowed in the cluster per data node., +NOTE: If there are no data nodes in the cluster, the limit will not be enforced., +This allows the creation of indices during cluster creation if dedicated master, +nodes are set up before data nodes., +, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        Optional<String> shardAllocation = checkShardLimit(settings, clusterState);, +    static Optional<String> checkShardLimit(Settings settings, ClusterState clusterState) {, +        return IndicesService.checkShardLimit(shardsToCreate, clusterState);, +++ b/docs/reference/modules/cluster/misc.asciidoc, +There is a soft limit on the number of shards in a cluster, based on the number, +of nodes in the cluster. This is intended to prevent operations which may, +unintentionally destabilize the cluster., +going over this limit, the operation will fail with an error indicating the, +shard limit., +setting changes, all operations that create or open indices will fail until, +either the limit is increased as described below, or some indices are, +The limit defaults to 1,000 shards per data node, and can be dynamically, +adjusted using the following property:, +     Controls the number of shards allowed in the cluster per data node., +NOTE: If there are no data nodes in the cluster, the limit will not be enforced., +This allows the creation of indices during cluster creation if dedicated master, +nodes are set up before data nodes., +, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        Optional<String> shardAllocation = checkShardLimit(settings, clusterState);, +    static Optional<String> checkShardLimit(Settings settings, ClusterState clusterState) {, +        return IndicesService.checkShardLimit(shardsToCreate, clusterState);, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexStateService.java, +import org.apache.logging.log4j.Logger;, +                validateShardLimit(currentState, request.indices());, +    static void validateShardLimit(ClusterState currentState, Index[] indices) {, +        Optional<String> error = IndicesService.checkShardLimit(shardsToOpen, currentState);, +++ b/docs/reference/modules/cluster/misc.asciidoc, +There is a soft limit on the number of shards in a cluster, based on the number, +of nodes in the cluster. This is intended to prevent operations which may, +unintentionally destabilize the cluster., +going over this limit, the operation will fail with an error indicating the, +shard limit., +setting changes, all operations that create or open indices will fail until, +either the limit is increased as described below, or some indices are, +The limit defaults to 1,000 shards per data node, and can be dynamically, +adjusted using the following property:, +     Controls the number of shards allowed in the cluster per data node., +NOTE: If there are no data nodes in the cluster, the limit will not be enforced., +This allows the creation of indices during cluster creation if dedicated master, +nodes are set up before data nodes., +, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        Optional<String> shardAllocation = checkShardLimit(settings, clusterState);, +    static Optional<String> checkShardLimit(Settings settings, ClusterState clusterState) {, +        return IndicesService.checkShardLimit(shardsToCreate, clusterState);, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexStateService.java, +import org.apache.logging.log4j.Logger;, +                validateShardLimit(currentState, request.indices());, +    static void validateShardLimit(ClusterState currentState, Index[] indices) {, +        Optional<String> error = IndicesService.checkShardLimit(shardsToOpen, currentState);, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java, +                    Optional<String> error = IndicesService.checkShardLimit(totalNewShards, currentState);, +++ b/docs/reference/modules/cluster/misc.asciidoc, +There is a soft limit on the number of shards in a cluster, based on the number, +of nodes in the cluster. This is intended to prevent operations which may, +unintentionally destabilize the cluster., +going over this limit, the operation will fail with an error indicating the, +shard limit., +setting changes, all operations that create or open indices will fail until, +either the limit is increased as described below, or some indices are, +The limit defaults to 1,000 shards per data node, and can be dynamically, +adjusted using the following property:, +     Controls the number of shards allowed in the cluster per data node., +NOTE: If there are no data nodes in the cluster, the limit will not be enforced., +This allows the creation of indices during cluster creation if dedicated master, +nodes are set up before data nodes., +, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java]