[+++ b/core/src/main/java/org/elasticsearch/common/compress/CompressedXContent.java, +    private int hashCode;, +            try (StreamOutput compressedOutput = CompressorFactory.defaultCompressor().streamOutput(out)) {, +            assert CompressorFactory.compressor(new BytesArray(bytes)) != null;, +        byte[] bytes = new byte[in.readVInt()];, +        in.readBytes(bytes, 0, bytes.length);, +        return new CompressedXContent(bytes);, +        if (hashCode == 0) {, +            int h = Arrays.hashCode(uncompressed());, +            if (h == 0) {, +                h = 1;, +            }, +            hashCode = h;, +        }, +        return hashCode;, +++ b/core/src/main/java/org/elasticsearch/common/compress/CompressedXContent.java, +    private int hashCode;, +            try (StreamOutput compressedOutput = CompressorFactory.defaultCompressor().streamOutput(out)) {, +            assert CompressorFactory.compressor(new BytesArray(bytes)) != null;, +        byte[] bytes = new byte[in.readVInt()];, +        in.readBytes(bytes, 0, bytes.length);, +        return new CompressedXContent(bytes);, +        if (hashCode == 0) {, +            int h = Arrays.hashCode(uncompressed());, +            if (h == 0) {, +                h = 1;, +            }, +            hashCode = h;, +        }, +        return hashCode;, +++ b/core/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java, +                fieldValues.set(i, fieldMapper.valueForSearch(fieldValues.get(i)));, +++ b/core/src/main/java/org/elasticsearch/common/compress/CompressedXContent.java, +    private int hashCode;, +            try (StreamOutput compressedOutput = CompressorFactory.defaultCompressor().streamOutput(out)) {, +            assert CompressorFactory.compressor(new BytesArray(bytes)) != null;, +        byte[] bytes = new byte[in.readVInt()];, +        in.readBytes(bytes, 0, bytes.length);, +        return new CompressedXContent(bytes);, +        if (hashCode == 0) {, +            int h = Arrays.hashCode(uncompressed());, +            if (h == 0) {, +                h = 1;, +            }, +            hashCode = h;, +        }, +        return hashCode;, +++ b/core/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java, +                fieldValues.set(i, fieldMapper.valueForSearch(fieldValues.get(i)));, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                                        values.set(i, fieldMapper.valueForSearch(values.get(i)));, +                            values.set(i, fieldMapper.valueForSearch(values.get(i)));, +++ b/core/src/main/java/org/elasticsearch/common/compress/CompressedXContent.java, +    private int hashCode;, +            try (StreamOutput compressedOutput = CompressorFactory.defaultCompressor().streamOutput(out)) {, +            assert CompressorFactory.compressor(new BytesArray(bytes)) != null;, +        byte[] bytes = new byte[in.readVInt()];, +        in.readBytes(bytes, 0, bytes.length);, +        return new CompressedXContent(bytes);, +        if (hashCode == 0) {, +            int h = Arrays.hashCode(uncompressed());, +            if (h == 0) {, +                h = 1;, +            }, +            hashCode = h;, +        }, +        return hashCode;, +++ b/core/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java, +                fieldValues.set(i, fieldMapper.valueForSearch(fieldValues.get(i)));, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                                        values.set(i, fieldMapper.valueForSearch(values.get(i)));, +                            values.set(i, fieldMapper.valueForSearch(values.get(i)));, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +import org.elasticsearch.common.compress.CompressorFactory;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +import org.elasticsearch.common.xcontent.XContentFactory;, +        this.typeFilter = typeMapper().termQuery(type, null);, +            BytesStreamOutput bStream = new BytesStreamOutput();, +            try (XContentBuilder builder = XContentFactory.contentBuilder(XContentType.JSON, CompressorFactory.defaultCompressor().streamOutput(bStream))) {, +                builder.startObject();, +                toXContent(builder, ToXContent.EMPTY_PARAMS);, +                builder.endObject();, +            }, +            mappingSource = new CompressedXContent(bStream.bytes());, +++ b/core/src/main/java/org/elasticsearch/common/compress/CompressedXContent.java, +    private int hashCode;, +            try (StreamOutput compressedOutput = CompressorFactory.defaultCompressor().streamOutput(out)) {, +            assert CompressorFactory.compressor(new BytesArray(bytes)) != null;, +        byte[] bytes = new byte[in.readVInt()];, +        in.readBytes(bytes, 0, bytes.length);, +        return new CompressedXContent(bytes);, +        if (hashCode == 0) {, +            int h = Arrays.hashCode(uncompressed());, +            if (h == 0) {, +                h = 1;, +            }, +            hashCode = h;, +        }, +        return hashCode;, +++ b/core/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java]