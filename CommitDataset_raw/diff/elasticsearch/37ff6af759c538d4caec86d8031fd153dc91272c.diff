[+++ b/core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java, +    private final Environment environment;, +        this.environment = environment;, +                            return provider.get(environment, key).get();, +        return analyzerProvider.get(environment, analyzer).get();, +                    factory = type.get(settings, environment, name, currentSettings);, +                final T factory = type.get(settings, environment, name, currentSettings);, +                instance = provider.get(settings, environment, name, defaultSettings);, +                instance = defaultProvider.get(settings, environment, name, defaultSettings);, +                final T instance = provider.get(settings, environment, name, defaultSettings);]