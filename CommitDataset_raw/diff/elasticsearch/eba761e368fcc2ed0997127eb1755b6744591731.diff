[+++ b/src/test/java/org/elasticsearch/search/functionscore/FunctionScoreBackwardCompatibilityTests.java, +import org.elasticsearch.cluster.routing.allocation.decider.EnableAllocationDecider;, +import org.elasticsearch.common.settings.ImmutableSettings;, +        // prevent any kind of allocation during the upgrade we recover from gateway, +        client().admin().indices().prepareUpdateSettings("test").setSettings(ImmutableSettings.builder().put(EnableAllocationDecider.INDEX_ROUTING_ALLOCATION_ENABLE, "none")).get();, +        client().admin().indices().prepareUpdateSettings("test").setSettings(ImmutableSettings.builder().put(EnableAllocationDecider.INDEX_ROUTING_ALLOCATION_ENABLE, "all")).get();]