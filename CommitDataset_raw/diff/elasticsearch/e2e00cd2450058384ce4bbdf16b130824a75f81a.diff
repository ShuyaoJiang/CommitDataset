[+++ b/server/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java, +                        /*, +                         * If dirty WriteStateException occurred, it's only safe to proceed if there is subsequent, +                         * successful write of metadata and Manifest. We prefer to break here, not to over complicate test logic., +                         * See also MetaDataStateFormat#testFailRandomlyAndReadAnyState, that does not break., +                         */, +                        break;, +++ b/server/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java, +                        /*, +                         * If dirty WriteStateException occurred, it's only safe to proceed if there is subsequent, +                         * successful write of metadata and Manifest. We prefer to break here, not to over complicate test logic., +                         * See also MetaDataStateFormat#testFailRandomlyAndReadAnyState, that does not break., +                         */, +                        break;, +++ b/server/src/test/java/org/elasticsearch/gateway/MetaDataStateFormatTests.java, +            if (possibleStates.size() > 1) {, +                //if there was a WriteStateException we need to override current state before we continue, +                newState = writeAndReadStateSuccessfully(format, paths);, +                possibleStates.clear();, +                possibleStates.add(newState);, +            }]