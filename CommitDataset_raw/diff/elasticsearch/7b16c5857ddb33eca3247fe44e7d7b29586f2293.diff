[+++ b/docs/reference/search/aggregations/metrics.asciidoc, +, +include::metrics/percentile-aggregation.asciidoc[], +++ b/docs/reference/search/aggregations/metrics.asciidoc, +, +include::metrics/percentile-aggregation.asciidoc[], +++ b/docs/reference/search/aggregations/metrics/percentile-aggregation.asciidoc, +[[search-aggregations-metrics-percentile-aggregation]], +=== Percentiles, +A `multi-value` metrics aggregation that calculates one or more percentiles, +over numeric values extracted from the aggregated documents.  These values, +can be extracted either from specific numeric fields in the documents, or, +be generated by a provided script., +, +.Experimental!, +[IMPORTANT], +=====, +This feature is marked as experimental, and may be subject to change in the, +future.  If you use this feature, please let us know your experience with it!, +=====, +, +Percentiles show the point at which a certain percentage of observed values, +occur.  For example, the 95th percentile is the value which is greater than 95% , +of the observed values., +, +Percentiles are often used to find outliers.  In normal distributions, the , +0.13th and 99.87th percentiles represents three standard deviations from the , +mean.  Any data which falls outside three standard deviations is often considered, +an anomaly., +, +When a range of percentiles are retrieved, they can be used to estimate the , +data distribution and determine if the data is skewed, bimodal, etc., +, +Assume your data consists of website load times.  The average and median, +load times are not overly useful to an administrator.  The max may be interesting,, +but it can be easily skewed by a single slow response., +, +Let's look at a range of percentiles representing load time:, +, +[source,js], +--------------------------------------------------, +{, +    "aggs" : {, +        "load_time_outlier" : { , +            "percentiles" : { , +                "field" : "load_time" <1>, +            } , +        }, +    }, +}, +--------------------------------------------------, +<1> The field `load_time` must be a numeric field, +, +By default, the `percentile` metric will generate a range of , +percentiles: `[ 1, 5, 25, 50, 75, 95, 99 ]`.  The response will look like this:, +, +[source,js], +--------------------------------------------------, +{, +    ..., +, +   "aggregations": {, +      "load_time_outlier": {, +         "1.0": 15,, +         "5.0": 20,, +         "25.0": 23,, +         "50.0": 25,, +         "75.0": 29,, +         "95.0": 60,, +         "99.0": 150, +      }, +   }, +}, +--------------------------------------------------, +, +As you can see, the aggregation will return a calculated value for each percentile, +in the default range.  If we assume response times are in milliseconds, it is , +immediately obvious that the webpage normally loads in 15-30ms, but occasionally, +spikes to 60-150ms.  , +, +Often, administrators are only interested in outliers -- the extreme percentiles., +We can specify just the percents we are interested in (requested percentiles , +must be a value between 0-100 inclusive):, +, +[source,js], +--------------------------------------------------, +{, +    "aggs" : {, +        "load_time_outlier" : { , +            "percentiles" : { , +                "field" : "load_time",, +                "percents" : [95, 99, 99.9] <1>, +            } , +        }, +    }, +}, +--------------------------------------------------, +<1> Use the `percents` parameter to specify particular percentiles to calculate, +, +]