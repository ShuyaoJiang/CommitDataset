[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParser.java, +    void close();, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParser.java, +    void close();, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParserService.java, +    public void close() {, +        for (IndexQueryParser indexQueryParser : indexQueryParsers.values()) {, +            indexQueryParser.close();, +        }, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParser.java, +    void close();, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParserService.java, +    public void close() {, +        for (IndexQueryParser indexQueryParser : indexQueryParsers.values()) {, +            indexQueryParser.close();, +        }, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/XContentIndexQueryParser.java, +    private ThreadLocal<QueryParseContext> cache = new ThreadLocal<QueryParseContext>() {, +        @Override protected QueryParseContext initialValue() {, +            return new QueryParseContext(index, XContentIndexQueryParser.this);, +    @Override public void close() {, +        cache.remove();, +    }, +, +            return parse(cache.get(), parser);, +            return parse(cache.get(), parser);, +            return parse(cache.get(), parser);, +            return parse(cache.get(), parser);, +        QueryParseContext context = cache.get();, +        QueryParseContext context = cache.get();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParser.java, +    void close();, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParserService.java, +    public void close() {, +        for (IndexQueryParser indexQueryParser : indexQueryParsers.values()) {, +            indexQueryParser.close();, +        }, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/XContentIndexQueryParser.java, +    private ThreadLocal<QueryParseContext> cache = new ThreadLocal<QueryParseContext>() {, +        @Override protected QueryParseContext initialValue() {, +            return new QueryParseContext(index, XContentIndexQueryParser.this);, +    @Override public void close() {, +        cache.remove();, +    }, +, +            return parse(cache.get(), parser);, +            return parse(cache.get(), parser);, +            return parse(cache.get(), parser);, +            return parse(cache.get(), parser);, +        QueryParseContext context = cache.get();, +        QueryParseContext context = cache.get();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/indices/InternalIndicesService.java, +import org.elasticsearch.index.query.IndexQueryParserService;, +        indexInjector.getInstance(IndexQueryParserService.class).close();]