[+++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java, +            for (MutableShardRouting assignedShard : allocation.routingNodes().assignedShards(shardRouting)) {, +                if (assignedShard.relocating()) {, +                    RoutingNode relocationNode = allocation.routingNodes().node(assignedShard.relocatingNodeId());, +                } else if (assignedShard.started()) {, +                    RoutingNode routingNode = allocation.routingNodes().node(assignedShard.currentNodeId());, +, +++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java, +            for (MutableShardRouting assignedShard : allocation.routingNodes().assignedShards(shardRouting)) {, +                if (assignedShard.relocating()) {, +                    RoutingNode relocationNode = allocation.routingNodes().node(assignedShard.relocatingNodeId());, +                } else if (assignedShard.started()) {, +                    RoutingNode routingNode = allocation.routingNodes().node(assignedShard.currentNodeId());, +, +++ b/src/test/java/org/elasticsearch/benchmark/cluster/ClusterAllocationRerouteBenchmark.java, +        AllocationService strategy = ElasticsearchAllocationTestCase.createAllocationService(ImmutableSettings.builder(), +                .put("cluster.routing.allocation.awareness.attributes", "tag"), +                .build(), new Random(1));, +            nb.put(newNode("node" + i, numberOfTags == 0 ? ImmutableMap.<String, String>of() : ImmutableMap.of("tag", "tag_" + (i % numberOfTags))));]