[+++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +        public DocumentMapper build(MapperService mapperService, DocumentMapperParser docMapperParser) {, +            return new DocumentMapper(mapperService, index, indexSettings, docMapperParser, rootObjectMapper, meta, rootMappers, sourceTransforms);, +    private final MapperService mapperService;, +, +    public DocumentMapper(MapperService mapperService, String index, @Nullable Settings indexSettings, DocumentMapperParser docMapperParser,, +        this.mapperService = mapperService;, +        mapperService.addFieldMappers(fieldMappers);, +        mapperService.addObjectMappers(objectMappers);, +            final List<String> conflicts = new ArrayList<>();, +            final List<FieldMapper<?>> newFieldMappers = new ArrayList<>();, +            final List<ObjectMapper> newObjectMappers = new ArrayList<>();, +                newFieldMappers.addAll(fieldMappers);, +                newObjectMappers.addAll(objectMappers);, +            }, +, +            @Override, +            public Collection<FieldMapper<?>> getNewFieldMappers() {, +                return newFieldMappers;, +            }, +, +            @Override, +            public Collection<ObjectMapper> getNewObjectMappers() {, +                return newObjectMappers;, +            addFieldMappers(mergeResult.getNewFieldMappers());, +            addObjectMappers(mergeResult.getNewObjectMappers());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +        public DocumentMapper build(MapperService mapperService, DocumentMapperParser docMapperParser) {, +            return new DocumentMapper(mapperService, index, indexSettings, docMapperParser, rootObjectMapper, meta, rootMappers, sourceTransforms);, +    private final MapperService mapperService;, +, +    public DocumentMapper(MapperService mapperService, String index, @Nullable Settings indexSettings, DocumentMapperParser docMapperParser,, +        this.mapperService = mapperService;, +        mapperService.addFieldMappers(fieldMappers);, +        mapperService.addObjectMappers(objectMappers);, +            final List<String> conflicts = new ArrayList<>();, +            final List<FieldMapper<?>> newFieldMappers = new ArrayList<>();, +            final List<ObjectMapper> newObjectMappers = new ArrayList<>();, +                newFieldMappers.addAll(fieldMappers);, +                newObjectMappers.addAll(objectMappers);, +            }, +, +            @Override, +            public Collection<FieldMapper<?>> getNewFieldMappers() {, +                return newFieldMappers;, +            }, +, +            @Override, +            public Collection<ObjectMapper> getNewObjectMappers() {, +                return newObjectMappers;, +            addFieldMappers(mergeResult.getNewFieldMappers());, +            addObjectMappers(mergeResult.getNewObjectMappers());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +    final MapperService mapperService;, +    public DocumentMapperParser(Index index, @IndexSettings Settings indexSettings, MapperService mapperService, AnalysisService analysisService,, +        this.mapperService = mapperService;, +        DocumentMapper documentMapper = docBuilder.build(mapperService, this);, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +        public DocumentMapper build(MapperService mapperService, DocumentMapperParser docMapperParser) {, +            return new DocumentMapper(mapperService, index, indexSettings, docMapperParser, rootObjectMapper, meta, rootMappers, sourceTransforms);, +    private final MapperService mapperService;, +, +    public DocumentMapper(MapperService mapperService, String index, @Nullable Settings indexSettings, DocumentMapperParser docMapperParser,, +        this.mapperService = mapperService;, +        mapperService.addFieldMappers(fieldMappers);, +        mapperService.addObjectMappers(objectMappers);, +            final List<String> conflicts = new ArrayList<>();, +            final List<FieldMapper<?>> newFieldMappers = new ArrayList<>();, +            final List<ObjectMapper> newObjectMappers = new ArrayList<>();, +                newFieldMappers.addAll(fieldMappers);, +                newObjectMappers.addAll(objectMappers);, +            }, +, +            @Override, +            public Collection<FieldMapper<?>> getNewFieldMappers() {, +                return newFieldMappers;, +            }, +, +            @Override, +            public Collection<ObjectMapper> getNewObjectMappers() {, +                return newObjectMappers;, +            addFieldMappers(mergeResult.getNewFieldMappers());, +            addObjectMappers(mergeResult.getNewObjectMappers());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +    final MapperService mapperService;, +    public DocumentMapperParser(Index index, @IndexSettings Settings indexSettings, MapperService mapperService, AnalysisService analysisService,, +        this.mapperService = mapperService;, +        DocumentMapper documentMapper = docBuilder.build(mapperService, this);, +++ /dev/null, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +        public DocumentMapper build(MapperService mapperService, DocumentMapperParser docMapperParser) {, +            return new DocumentMapper(mapperService, index, indexSettings, docMapperParser, rootObjectMapper, meta, rootMappers, sourceTransforms);, +    private final MapperService mapperService;, +, +    public DocumentMapper(MapperService mapperService, String index, @Nullable Settings indexSettings, DocumentMapperParser docMapperParser,, +        this.mapperService = mapperService;, +        mapperService.addFieldMappers(fieldMappers);, +        mapperService.addObjectMappers(objectMappers);, +            final List<String> conflicts = new ArrayList<>();, +            final List<FieldMapper<?>> newFieldMappers = new ArrayList<>();]