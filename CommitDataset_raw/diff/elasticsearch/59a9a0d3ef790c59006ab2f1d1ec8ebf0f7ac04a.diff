[+++ b/src/test/java/org/elasticsearch/test/integration/indices/settings/UpdateSettingsTests.java, +import org.elasticsearch.index.engine.VersionConflictEngineException;, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertThrows;, +, +    @Test, +    public void testRobinEngineGCDeletesSetting() throws InterruptedException {, +        createIndex("test");, +        client().prepareIndex("test", "type", "1").setSource("f", 1).get(); // set version to 1, +        client().prepareDelete("test", "type", "1").get(); // sets version to 2, +        client().prepareIndex("test", "type", "1").setSource("f", 2).setVersion(2).get(); // delete is still in cache this should work & set version to 3, +        client().admin().indices().prepareUpdateSettings("test"), +                .setSettings(ImmutableSettings.settingsBuilder(), +                        .put("index.gc_deletes", 0), +                ).get();, +, +        client().prepareDelete("test", "type", "1").get(); // sets version to 4, +        Thread.sleep(300); // wait for cache time to change TODO: this needs to be solved better. To be discussed., +        assertThrows(client().prepareIndex("test", "type", "1").setSource("f", 3).setVersion(4), VersionConflictEngineException.class); // delete is should not be in cache, +, +    }]