[+++ b/src/main/java/org/elasticsearch/action/mlt/TransportMoreLikeThisAction.java, +                String value = fieldMapper.value(convertField(field)).toString();, +        addMoreLikeThis(request, boolBuilder, field.name(), fieldMapper.value(convertField(field)).toString());, +++ b/src/main/java/org/elasticsearch/action/mlt/TransportMoreLikeThisAction.java, +                String value = fieldMapper.value(convertField(field)).toString();, +        addMoreLikeThis(request, boolBuilder, field.name(), fieldMapper.value(convertField(field)).toString());, +++ b/src/main/java/org/elasticsearch/common/Numbers.java, +import org.apache.lucene.util.BytesRef;, +, +    public static short bytesToShort(BytesRef bytes) {, +        return (short) (((bytes.bytes[bytes.offset] & 0xff) << 8) | (bytes.bytes[bytes.offset + 1] & 0xff));, +    }, +, +    public static int bytesToInt(BytesRef bytes) {, +        return (bytes.bytes[bytes.offset] << 24) | ((bytes.bytes[bytes.offset + 1] & 0xff) << 16) | ((bytes.bytes[bytes.offset + 2] & 0xff) << 8) | (bytes.bytes[bytes.offset + 3] & 0xff);, +    }, +, +    public static long bytesToLong(BytesRef bytes) {, +        int high = (bytes.bytes[bytes.offset + 0] << 24) | ((bytes.bytes[bytes.offset + 1] & 0xff) << 16) | ((bytes.bytes[bytes.offset + 2] & 0xff) << 8) | (bytes.bytes[bytes.offset + 3] & 0xff);, +        int low = (bytes.bytes[bytes.offset + 4] << 24) | ((bytes.bytes[bytes.offset + 5] & 0xff) << 16) | ((bytes.bytes[bytes.offset + 6] & 0xff) << 8) | (bytes.bytes[bytes.offset + 7] & 0xff);, +        return (((long) high) << 32) | (low & 0x0ffffffffL);, +    }, +, +    public static float bytesToFloat(BytesRef bytes) {, +        return Float.intBitsToFloat(bytesToInt(bytes));, +    }, +, +    public static double bytesToDouble(BytesRef bytes) {, +        return Double.longBitsToDouble(bytesToLong(bytes));, +    }, +, +++ b/src/main/java/org/elasticsearch/action/mlt/TransportMoreLikeThisAction.java, +                String value = fieldMapper.value(convertField(field)).toString();, +        addMoreLikeThis(request, boolBuilder, field.name(), fieldMapper.value(convertField(field)).toString());, +++ b/src/main/java/org/elasticsearch/common/Numbers.java, +import org.apache.lucene.util.BytesRef;, +, +    public static short bytesToShort(BytesRef bytes) {, +        return (short) (((bytes.bytes[bytes.offset] & 0xff) << 8) | (bytes.bytes[bytes.offset + 1] & 0xff));, +    }, +, +    public static int bytesToInt(BytesRef bytes) {, +        return (bytes.bytes[bytes.offset] << 24) | ((bytes.bytes[bytes.offset + 1] & 0xff) << 16) | ((bytes.bytes[bytes.offset + 2] & 0xff) << 8) | (bytes.bytes[bytes.offset + 3] & 0xff);, +    }, +, +    public static long bytesToLong(BytesRef bytes) {, +        int high = (bytes.bytes[bytes.offset + 0] << 24) | ((bytes.bytes[bytes.offset + 1] & 0xff) << 16) | ((bytes.bytes[bytes.offset + 2] & 0xff) << 8) | (bytes.bytes[bytes.offset + 3] & 0xff);, +        int low = (bytes.bytes[bytes.offset + 4] << 24) | ((bytes.bytes[bytes.offset + 5] & 0xff) << 16) | ((bytes.bytes[bytes.offset + 6] & 0xff) << 8) | (bytes.bytes[bytes.offset + 7] & 0xff);, +        return (((long) high) << 32) | (low & 0x0ffffffffL);, +    }, +, +    public static float bytesToFloat(BytesRef bytes) {, +        return Float.intBitsToFloat(bytesToInt(bytes));, +    }, +, +    public static double bytesToDouble(BytesRef bytes) {, +        return Double.longBitsToDouble(bytesToLong(bytes));, +    }, +, +++ b/src/main/java/org/elasticsearch/common/bytes/ByteBufferBytesReference.java, +import org.apache.lucene.util.BytesRef;, +, +    @Override, +    public BytesRef toBytesRef() {, +        if (buffer.hasArray()) {, +            return new BytesRef(buffer.array(), buffer.arrayOffset() + buffer.position(), buffer.remaining());, +        }, +        return new BytesRef(toBytes());, +    }, +, +    @Override, +    public BytesRef copyBytesRef() {, +        return new BytesRef(toBytes());, +    }, +++ b/src/main/java/org/elasticsearch/action/mlt/TransportMoreLikeThisAction.java, +                String value = fieldMapper.value(convertField(field)).toString();, +        addMoreLikeThis(request, boolBuilder, field.name(), fieldMapper.value(convertField(field)).toString());, +++ b/src/main/java/org/elasticsearch/common/Numbers.java, +import org.apache.lucene.util.BytesRef;, +, +    public static short bytesToShort(BytesRef bytes) {, +        return (short) (((bytes.bytes[bytes.offset] & 0xff) << 8) | (bytes.bytes[bytes.offset + 1] & 0xff));, +    }, +, +    public static int bytesToInt(BytesRef bytes) {, +        return (bytes.bytes[bytes.offset] << 24) | ((bytes.bytes[bytes.offset + 1] & 0xff) << 16) | ((bytes.bytes[bytes.offset + 2] & 0xff) << 8) | (bytes.bytes[bytes.offset + 3] & 0xff);, +    }, +, +    public static long bytesToLong(BytesRef bytes) {, +        int high = (bytes.bytes[bytes.offset + 0] << 24) | ((bytes.bytes[bytes.offset + 1] & 0xff) << 16) | ((bytes.bytes[bytes.offset + 2] & 0xff) << 8) | (bytes.bytes[bytes.offset + 3] & 0xff);, +        int low = (bytes.bytes[bytes.offset + 4] << 24) | ((bytes.bytes[bytes.offset + 5] & 0xff) << 16) | ((bytes.bytes[bytes.offset + 6] & 0xff) << 8) | (bytes.bytes[bytes.offset + 7] & 0xff);, +        return (((long) high) << 32) | (low & 0x0ffffffffL);, +    }, +, +    public static float bytesToFloat(BytesRef bytes) {, +        return Float.intBitsToFloat(bytesToInt(bytes));, +    }, +, +    public static double bytesToDouble(BytesRef bytes) {, +        return Double.longBitsToDouble(bytesToLong(bytes));]