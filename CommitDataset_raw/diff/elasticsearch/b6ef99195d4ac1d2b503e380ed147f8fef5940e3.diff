[+++ b/core/src/main/java/org/elasticsearch/common/rounding/Rounding.java, +++ b/core/src/main/java/org/elasticsearch/common/rounding/Rounding.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java, +    private long offset;, +    public DateHistogramAggregator(String name, AggregatorFactories factories, Rounding rounding, long offset, InternalOrder order,, +            boolean keyed,, +        this.offset = offset;, +                    long rounded = rounding.round(value - offset) + offset;, +        return new InternalDateHistogram(name, buckets, order, minDocCount, offset, emptyBucketInfo, formatter, keyed,, +        return new InternalDateHistogram(name, Collections.emptyList(), order, minDocCount, offset, emptyBucketInfo, formatter, keyed,, +++ b/core/src/main/java/org/elasticsearch/common/rounding/Rounding.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java, +    private long offset;, +    public DateHistogramAggregator(String name, AggregatorFactories factories, Rounding rounding, long offset, InternalOrder order,, +            boolean keyed,, +        this.offset = offset;, +                    long rounded = rounding.round(value - offset) + offset;, +        return new InternalDateHistogram(name, buckets, order, minDocCount, offset, emptyBucketInfo, formatter, keyed,, +        return new InternalDateHistogram(name, Collections.emptyList(), order, minDocCount, offset, emptyBucketInfo, formatter, keyed,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java, +        Rounding rounding = tzRoundingBuilder.build();, +        return new DateHistogramAggregator(name, factories, rounding, offset, order, keyed, minDocCount, roundedBounds, valuesSource,, +++ b/core/src/main/java/org/elasticsearch/common/rounding/Rounding.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java, +    private long offset;, +    public DateHistogramAggregator(String name, AggregatorFactories factories, Rounding rounding, long offset, InternalOrder order,, +            boolean keyed,, +        this.offset = offset;, +                    long rounded = rounding.round(value - offset) + offset;, +        return new InternalDateHistogram(name, buckets, order, minDocCount, offset, emptyBucketInfo, formatter, keyed,, +        return new InternalDateHistogram(name, Collections.emptyList(), order, minDocCount, offset, emptyBucketInfo, formatter, keyed,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java, +        Rounding rounding = tzRoundingBuilder.build();, +        return new DateHistogramAggregator(name, factories, rounding, offset, order, keyed, minDocCount, roundedBounds, valuesSource,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +    private final long offset;, +    InternalDateHistogram(String name, List<Bucket> buckets, InternalOrder order, long minDocCount, long offset,, +            EmptyBucketInfo emptyBucketInfo,, +        this.offset = offset;, +        offset = in.readLong();, +        out.writeLong(offset);, +        return new InternalDateHistogram(name, buckets, order, minDocCount, offset, emptyBucketInfo, format,, +                        key = nextKey(key).longValue();, +                            key = nextKey(key).longValue();, +                long key = nextKey(lastBucket.key).longValue();, +                    key = nextKey(key).longValue();, +        return new InternalDateHistogram(getName(), reducedBuckets, order, minDocCount, offset, emptyBucketInfo,, +        return emptyBucketInfo.rounding.nextRoundingValue(key.longValue() - offset) + offset;, +        return new InternalDateHistogram(name, buckets2, order, minDocCount, offset, emptyBucketInfo, format,, +++ b/core/src/main/java/org/elasticsearch/common/rounding/Rounding.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java, +    private long offset;, +    public DateHistogramAggregator(String name, AggregatorFactories factories, Rounding rounding, long offset, InternalOrder order,, +            boolean keyed,, +        this.offset = offset;, +                    long rounded = rounding.round(value - offset) + offset;, +        return new InternalDateHistogram(name, buckets, order, minDocCount, offset, emptyBucketInfo, formatter, keyed,, +        return new InternalDateHistogram(name, Collections.emptyList(), order, minDocCount, offset, emptyBucketInfo, formatter, keyed,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java, +        Rounding rounding = tzRoundingBuilder.build();, +        return new DateHistogramAggregator(name, factories, rounding, offset, order, keyed, minDocCount, roundedBounds, valuesSource,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +    private final long offset;, +    InternalDateHistogram(String name, List<Bucket> buckets, InternalOrder order, long minDocCount, long offset,, +            EmptyBucketInfo emptyBucketInfo,, +        this.offset = offset;, +        offset = in.readLong();, +        out.writeLong(offset);, +        return new InternalDateHistogram(name, buckets, order, minDocCount, offset, emptyBucketInfo, format,, +                        key = nextKey(key).longValue();, +                            key = nextKey(key).longValue();, +                long key = nextKey(lastBucket.key).longValue();, +                    key = nextKey(key).longValue();, +        return new InternalDateHistogram(getName(), reducedBuckets, order, minDocCount, offset, emptyBucketInfo,, +        return emptyBucketInfo.rounding.nextRoundingValue(key.longValue() - offset) + offset;, +        return new InternalDateHistogram(name, buckets2, order, minDocCount, offset, emptyBucketInfo, format,, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/common/rounding/Rounding.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java, +    private long offset;, +    public DateHistogramAggregator(String name, AggregatorFactories factories, Rounding rounding, long offset, InternalOrder order,, +            boolean keyed,, +        this.offset = offset;, +                    long rounded = rounding.round(value - offset) + offset;, +        return new InternalDateHistogram(name, buckets, order, minDocCount, offset, emptyBucketInfo, formatter, keyed,, +        return new InternalDateHistogram(name, Collections.emptyList(), order, minDocCount, offset, emptyBucketInfo, formatter, keyed,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java, +        Rounding rounding = tzRoundingBuilder.build();, +        return new DateHistogramAggregator(name, factories, rounding, offset, order, keyed, minDocCount, roundedBounds, valuesSource,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +    private final long offset;, +    InternalDateHistogram(String name, List<Bucket> buckets, InternalOrder order, long minDocCount, long offset,, +            EmptyBucketInfo emptyBucketInfo,, +        this.offset = offset;, +        offset = in.readLong();, +        out.writeLong(offset);, +        return new InternalDateHistogram(name, buckets, order, minDocCount, offset, emptyBucketInfo, format,, +                        key = nextKey(key).longValue();, +                            key = nextKey(key).longValue();, +                long key = nextKey(lastBucket.key).longValue();]