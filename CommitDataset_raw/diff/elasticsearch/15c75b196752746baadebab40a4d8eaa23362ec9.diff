[+++ b/dev-tools/build_release.py, +if os.path.exists(LOG):, +  raise RuntimeError('please remove old release log %s first' % LOG), +# Ensures we are using a true Lucene release, not a snapshot build:, +def verify_lucene_version():, +  s = open('pom.xml', encoding='utf-8').read(), +  if s.find('download.elasticsearch.org/lucenesnapshots') != -1:, +    raise RuntimeError('pom.xml contains download.elasticsearch.org/lucenesnapshots repository: remove that before releasing'), +, +  m = re.search(r'<lucene.version>(.*?)</lucene.version>', s), +  if m is None:, +    raise RuntimeError('unable to locate lucene.version in pom.xml'), +  lucene_version = m.group(1), +, +  m = re.search(r'<lucene.maven.version>(.*?)</lucene.maven.version>', s), +  if m is None:, +    raise RuntimeError('unable to locate lucene.maven.version in pom.xml'), +  lucene_maven_version = m.group(1), +  if lucene_version != lucene_maven_version:, +    raise RuntimeError('pom.xml is still using a snapshot release of lucene (%s): cutover to a real lucene release before releasing' % lucene_maven_version), +    , +    verify_lucene_version(), +++ b/dev-tools/build_release.py, +if os.path.exists(LOG):, +  raise RuntimeError('please remove old release log %s first' % LOG), +# Ensures we are using a true Lucene release, not a snapshot build:, +def verify_lucene_version():, +  s = open('pom.xml', encoding='utf-8').read(), +  if s.find('download.elasticsearch.org/lucenesnapshots') != -1:, +    raise RuntimeError('pom.xml contains download.elasticsearch.org/lucenesnapshots repository: remove that before releasing'), +, +  m = re.search(r'<lucene.version>(.*?)</lucene.version>', s), +  if m is None:, +    raise RuntimeError('unable to locate lucene.version in pom.xml'), +  lucene_version = m.group(1), +, +  m = re.search(r'<lucene.maven.version>(.*?)</lucene.maven.version>', s), +  if m is None:, +    raise RuntimeError('unable to locate lucene.maven.version in pom.xml'), +  lucene_maven_version = m.group(1), +  if lucene_version != lucene_maven_version:, +    raise RuntimeError('pom.xml is still using a snapshot release of lucene (%s): cutover to a real lucene release before releasing' % lucene_maven_version), +    , +    verify_lucene_version(), +++ b/pom.xml, +        <lucene.version>4.10.1</lucene.version>, +        <lucene.maven.version>4.10.1-snapshot-1627159</lucene.maven.version>, +            <id>Lucene snapshots</id>, +            <url>https://download.elasticsearch.org/lucenesnapshots/</url>, +        </repository>, +        <repository>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +++ b/dev-tools/build_release.py, +if os.path.exists(LOG):, +  raise RuntimeError('please remove old release log %s first' % LOG), +# Ensures we are using a true Lucene release, not a snapshot build:, +def verify_lucene_version():, +  s = open('pom.xml', encoding='utf-8').read(), +  if s.find('download.elasticsearch.org/lucenesnapshots') != -1:, +    raise RuntimeError('pom.xml contains download.elasticsearch.org/lucenesnapshots repository: remove that before releasing'), +, +  m = re.search(r'<lucene.version>(.*?)</lucene.version>', s), +  if m is None:, +    raise RuntimeError('unable to locate lucene.version in pom.xml'), +  lucene_version = m.group(1), +, +  m = re.search(r'<lucene.maven.version>(.*?)</lucene.maven.version>', s), +  if m is None:, +    raise RuntimeError('unable to locate lucene.maven.version in pom.xml'), +  lucene_maven_version = m.group(1), +  if lucene_version != lucene_maven_version:, +    raise RuntimeError('pom.xml is still using a snapshot release of lucene (%s): cutover to a real lucene release before releasing' % lucene_maven_version), +    , +    verify_lucene_version(), +++ b/pom.xml, +        <lucene.version>4.10.1</lucene.version>, +        <lucene.maven.version>4.10.1-snapshot-1627159</lucene.maven.version>, +            <id>Lucene snapshots</id>, +            <url>https://download.elasticsearch.org/lucenesnapshots/</url>, +        </repository>, +        <repository>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>, +            <version>${lucene.maven.version}</version>]