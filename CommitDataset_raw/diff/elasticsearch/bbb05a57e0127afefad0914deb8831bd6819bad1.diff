[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/shard/service/InternalIndexShard.java, +import org.apache.lucene.index.CheckIndex;, +import org.elasticsearch.common.io.FastByteArrayOutputStream;, +import java.io.PrintStream;, +, +    private final boolean checkIndex;, +, +, +        this.checkIndex = indexSettings.getAsBoolean("index.shard.check_index", false);, +            if (checkIndex) {, +                checkIndex(true);, +            }, +        if (checkIndex) {, +            checkIndex(true);, +        }, +, +    private void checkIndex(boolean throwException) throws IndexShardException {, +        try {, +            CheckIndex checkIndex = new CheckIndex(store.directory());, +            FastByteArrayOutputStream os = new FastByteArrayOutputStream();, +            PrintStream out = new PrintStream(os);, +            checkIndex.setInfoStream(out);, +            out.flush();, +            CheckIndex.Status status = checkIndex.checkIndex();, +            if (!status.clean) {, +                logger.warn("check index [failure]\n{}", new String(os.unsafeByteArray(), 0, os.size()));, +                if (throwException) {, +                    throw new IndexShardException(shardId, "index check failure");, +                }, +            } else {, +                if (logger.isDebugEnabled()) {, +                    logger.debug("check index [success]\n{}", new String(os.unsafeByteArray(), 0, os.size()));, +                }, +            }, +        } catch (Exception e) {, +            logger.warn("failed to check index", e);, +        }, +    }]