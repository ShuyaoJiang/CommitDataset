[+++ b/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java, +import org.apache.lucene.index.AtomicReaderContext;, +    private boolean shouldUseOrdinals(Aggregator parent, ValuesSource valuesSource, AggregationContext context) {, +        // if there is a parent bucket aggregator the number of instances of this aggregator is going to be unbounded and most instances, +        // may only aggregate few documents, so don't use ordinals, +        if (hasParentBucketAggregator(parent)) {, +            return false;, +        }, +, +        // be defensive: if the number of unique values is unknown, don't use ordinals, +        final long maxNumUniqueValues = valuesSource.metaData().maxAtomicUniqueValuesCount();, +        if (maxNumUniqueValues == -1) {, +            return false;, +        }, +, +        // if the number of unique values is high compared to the document count, then ordinals are only going to make things slower, +        int maxDoc = 0;, +        for (AtomicReaderContext ctx : context.searchContext().searcher().getTopReaderContext().reader().leaves()) {, +            maxDoc = Math.max(maxDoc, ctx.reader().maxDoc());, +        }, +        if (maxNumUniqueValues > (maxDoc >>> 4)) {, +            return false;, +        }, +, +        return true;, +    }, +, +                        && shouldUseOrdinals(parent, valuesSource, aggregationContext)) {]