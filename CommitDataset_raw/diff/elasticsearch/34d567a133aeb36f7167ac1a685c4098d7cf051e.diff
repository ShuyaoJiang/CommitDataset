[+++ b/src/main/java/org/elasticsearch/search/SearchService.java, +        boolean contextFreed = false;, +                contextFreed = true;, +            if (!contextFreed) {, +            }, +++ b/src/main/java/org/elasticsearch/search/SearchService.java, +        boolean contextFreed = false;, +                contextFreed = true;, +            if (!contextFreed) {, +            }, +++ b/src/test/java/org/elasticsearch/search/basic/SearchWhileRelocatingTests.java, +                .setSettings(settingsBuilder().put("index.number_of_shards", numShards).put("index.number_of_replicas", numberOfReplicas), +                .put("index.store.type", "niofs"))]