[+++ b/x-pack/qa/security-example-spi-extension/src/test/java/org/elasticsearch/example/realm/CustomRealmIT.java, +import org.elasticsearch.client.Request;, +import org.elasticsearch.client.RequestOptions;, +            getRestClient().performRequest(new Request("GET", "/"));, +        Request request = new Request("GET", "/");, +        RequestOptions.Builder options = request.getOptions().toBuilder();, +        options.addHeader(CustomRealm.USER_HEADER, CustomRealm.KNOWN_USER);, +        options.addHeader(CustomRealm.PW_HEADER, CustomRealm.KNOWN_PW.toString());, +        request.setOptions(options);, +        Response response = getRestClient().performRequest(request);, +++ b/x-pack/qa/security-example-spi-extension/src/test/java/org/elasticsearch/example/realm/CustomRealmIT.java, +import org.elasticsearch.client.Request;, +import org.elasticsearch.client.RequestOptions;, +            getRestClient().performRequest(new Request("GET", "/"));, +        Request request = new Request("GET", "/");, +        RequestOptions.Builder options = request.getOptions().toBuilder();, +        options.addHeader(CustomRealm.USER_HEADER, CustomRealm.KNOWN_USER);, +        options.addHeader(CustomRealm.PW_HEADER, CustomRealm.KNOWN_PW.toString());, +        request.setOptions(options);, +        Response response = getRestClient().performRequest(request);, +++ b/x-pack/qa/security-example-spi-extension/src/test/java/org/elasticsearch/example/role/CustomRolesProviderIT.java, +import org.elasticsearch.client.Request;, +import org.elasticsearch.client.RequestOptions;, +    private static final RequestOptions AUTH_OPTIONS;, +    static {, +        RequestOptions.Builder options = RequestOptions.DEFAULT.toBuilder();, +        options.addHeader(UsernamePasswordToken.BASIC_AUTH_HEADER,, +                basicAuthHeaderValue(TEST_USER, new SecureString(TEST_PWD.toCharArray())));, +        AUTH_OPTIONS = options.build();, +    }, +, +        Request request = new Request("PUT", "/" + INDEX);, +        request.setOptions(AUTH_OPTIONS);, +        Response response = getRestClient().performRequest(request);, +            Request request = new Request("PUT", "/" + INDEX);, +            request.setOptions(AUTH_OPTIONS);, +            getRestClient().performRequest(request);, +            Request request = new Request("PUT", "/" + INDEX);, +            request.setOptions(AUTH_OPTIONS);, +            getRestClient().performRequest(request);]