[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/role/PutRoleRequest.java, +            indicesPrivileges.add(new RoleDescriptor.IndicesPrivileges(in));, +            applicationPrivileges = in.readList(RoleDescriptor.ApplicationResourcePrivileges::new);, +            out.writeList(applicationPrivileges);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/role/PutRoleRequest.java, +            indicesPrivileges.add(new RoleDescriptor.IndicesPrivileges(in));, +            applicationPrivileges = in.readList(RoleDescriptor.ApplicationResourcePrivileges::new);, +            out.writeList(applicationPrivileges);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/user/HasPrivilegesRequest.java, +            indexPrivileges[i] = new RoleDescriptor.IndicesPrivileges(in);, +            applicationPrivileges = in.readArray(ApplicationResourcePrivileges::new, ApplicationResourcePrivileges[]::new);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/role/PutRoleRequest.java, +            indicesPrivileges.add(new RoleDescriptor.IndicesPrivileges(in));, +            applicationPrivileges = in.readList(RoleDescriptor.ApplicationResourcePrivileges::new);, +            out.writeList(applicationPrivileges);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/user/HasPrivilegesRequest.java, +            indexPrivileges[i] = new RoleDescriptor.IndicesPrivileges(in);, +            applicationPrivileges = in.readArray(ApplicationResourcePrivileges::new, ApplicationResourcePrivileges[]::new);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authz/RoleDescriptor.java, +import org.elasticsearch.common.io.stream.Writeable;, +            indicesPrivileges[i] = new IndicesPrivileges(in);, +            applicationPrivileges = in.readArray(ApplicationResourcePrivileges::new, ApplicationResourcePrivileges[]::new);, +    public static class IndicesPrivileges implements ToXContentObject, Writeable {, +        public IndicesPrivileges(StreamInput in) throws IOException {, +            this.indices = in.readStringArray();, +            this.grantedFields = in.readOptionalStringArray();, +            this.deniedFields = in.readOptionalStringArray();, +            this.privileges = in.readStringArray();, +            this.query = in.readOptionalBytesReference();, +        }, +, +        @Override, +        public void writeTo(StreamOutput out) throws IOException {, +            out.writeStringArray(indices);, +            out.writeOptionalStringArray(grantedFields);, +            out.writeOptionalStringArray(deniedFields);, +            out.writeStringArray(privileges);, +            out.writeOptionalBytesReference(query);, +        }, +, +    public static class ApplicationResourcePrivileges implements ToXContentObject, Writeable {, +        public ApplicationResourcePrivileges(StreamInput in) throws IOException {, +            this.application = in.readString();, +            this.privileges = in.readStringArray();, +            this.resources = in.readStringArray();, +        }, +, +        @Override, +        public void writeTo(StreamOutput out) throws IOException {, +            out.writeString(application);, +            out.writeStringArray(privileges);, +            out.writeStringArray(resources);, +        }, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/role/PutRoleRequest.java, +            indicesPrivileges.add(new RoleDescriptor.IndicesPrivileges(in));, +            applicationPrivileges = in.readList(RoleDescriptor.ApplicationResourcePrivileges::new);, +            out.writeList(applicationPrivileges);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/user/HasPrivilegesRequest.java, +            indexPrivileges[i] = new RoleDescriptor.IndicesPrivileges(in);, +            applicationPrivileges = in.readArray(ApplicationResourcePrivileges::new, ApplicationResourcePrivileges[]::new);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authz/RoleDescriptor.java, +import org.elasticsearch.common.io.stream.Writeable;, +            indicesPrivileges[i] = new IndicesPrivileges(in);, +            applicationPrivileges = in.readArray(ApplicationResourcePrivileges::new, ApplicationResourcePrivileges[]::new);, +    public static class IndicesPrivileges implements ToXContentObject, Writeable {, +        public IndicesPrivileges(StreamInput in) throws IOException {, +            this.indices = in.readStringArray();, +            this.grantedFields = in.readOptionalStringArray();, +            this.deniedFields = in.readOptionalStringArray();, +            this.privileges = in.readStringArray();, +            this.query = in.readOptionalBytesReference();, +        }, +, +        @Override, +        public void writeTo(StreamOutput out) throws IOException {, +            out.writeStringArray(indices);, +            out.writeOptionalStringArray(grantedFields);, +            out.writeOptionalStringArray(deniedFields);, +            out.writeStringArray(privileges);, +            out.writeOptionalBytesReference(query);, +        }, +, +    public static class ApplicationResourcePrivileges implements ToXContentObject, Writeable {, +        public ApplicationResourcePrivileges(StreamInput in) throws IOException {, +            this.application = in.readString();, +            this.privileges = in.readStringArray();, +            this.resources = in.readStringArray();, +        }, +, +        @Override, +        public void writeTo(StreamOutput out) throws IOException {, +            out.writeString(application);, +            out.writeStringArray(privileges);, +            out.writeStringArray(resources);, +        }, +, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/accesscontrol/IndicesPermissionTests.java, +        RoleDescriptor.IndicesPrivileges readIndicesPrivileges = new RoleDescriptor.IndicesPrivileges(in);, +        RoleDescriptor.IndicesPrivileges readIndicesPrivileges2 = new RoleDescriptor.IndicesPrivileges(in);]