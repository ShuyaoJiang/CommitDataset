[+++ b/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java, +        ClusterState.Builder.writeTo(state, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java, +        ClusterState.Builder.writeTo(state, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java, +        ClusterState.Builder.writeTo(clusterState, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java, +        ClusterState.Builder.writeTo(state, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java, +        ClusterState.Builder.writeTo(clusterState, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java, +import com.carrotsearch.hppc.cursors.ObjectCursor;, +import org.elasticsearch.cluster.block.ClusterBlockLevel;, +import java.util.List;, +, +import static com.google.common.collect.Lists.newArrayList;, +import static org.elasticsearch.cluster.metadata.MetaData.lookupFactorySafe;, +, +            for(ObjectCursor<String> type :  currentState.metaData().customs().keys()) {, +                Custom.Factory factory = lookupFactorySafe(type.value);, +                if(!factory.context().contains(MetaData.XContentContext.API)) {, +                    mdBuilder.removeCustom(type.value);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java, +        ClusterState.Builder.writeTo(state, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java, +        ClusterState.Builder.writeTo(clusterState, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java, +import com.carrotsearch.hppc.cursors.ObjectCursor;, +import org.elasticsearch.cluster.block.ClusterBlockLevel;, +import java.util.List;, +, +import static com.google.common.collect.Lists.newArrayList;, +import static org.elasticsearch.cluster.metadata.MetaData.lookupFactorySafe;, +, +            for(ObjectCursor<String> type :  currentState.metaData().customs().keys()) {, +                Custom.Factory factory = lookupFactorySafe(type.value);, +                if(!factory.context().contains(MetaData.XContentContext.API)) {, +                    mdBuilder.removeCustom(type.value);, +++ b/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesResponse.java, +                AliasMetaData.Builder.writeTo(aliasMetaData, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java, +        ClusterState.Builder.writeTo(state, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java, +        ClusterState.Builder.writeTo(clusterState, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java, +import com.carrotsearch.hppc.cursors.ObjectCursor;, +import org.elasticsearch.cluster.block.ClusterBlockLevel;, +import java.util.List;, +, +import static com.google.common.collect.Lists.newArrayList;, +import static org.elasticsearch.cluster.metadata.MetaData.lookupFactorySafe;, +, +            for(ObjectCursor<String> type :  currentState.metaData().customs().keys()) {, +                Custom.Factory factory = lookupFactorySafe(type.value);, +                if(!factory.context().contains(MetaData.XContentContext.API)) {, +                    mdBuilder.removeCustom(type.value);, +++ b/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesResponse.java, +                AliasMetaData.Builder.writeTo(aliasMetaData, out);, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +                IndexMetaData.Custom.Factory factory = IndexMetaData.lookupFactory(name);, +                if (factory != null) {, +                        customs.put(name, factory.fromMap((Map<String, Object>) entry.getValue()));, +            IndexMetaData.Custom customIndexMetaData = IndexMetaData.lookupFactorySafe(type).readFrom(in);, +            IndexMetaData.lookupFactorySafe(entry.getKey()).writeTo(entry.getValue(), out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java, +        ClusterState.Builder.writeTo(state, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java, +        ClusterState.Builder.writeTo(clusterState, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java, +import com.carrotsearch.hppc.cursors.ObjectCursor;, +import org.elasticsearch.cluster.block.ClusterBlockLevel;, +import java.util.List;, +, +import static com.google.common.collect.Lists.newArrayList;, +import static org.elasticsearch.cluster.metadata.MetaData.lookupFactorySafe;, +, +            for(ObjectCursor<String> type :  currentState.metaData().customs().keys()) {, +                Custom.Factory factory = lookupFactorySafe(type.value);, +                if(!factory.context().contains(MetaData.XContentContext.API)) {, +                    mdBuilder.removeCustom(type.value);, +++ b/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesResponse.java, +                AliasMetaData.Builder.writeTo(aliasMetaData, out);, +++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +                IndexMetaData.Custom.Factory factory = IndexMetaData.lookupFactory(name);, +                if (factory != null) {, +                        customs.put(name, factory.fromMap((Map<String, Object>) entry.getValue()));, +            IndexMetaData.Custom customIndexMetaData = IndexMetaData.lookupFactorySafe(type).readFrom(in);, +            IndexMetaData.lookupFactorySafe(entry.getKey()).writeTo(entry.getValue(), out);, +++ b/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexResponse.java, +                mappingEntryBuilder.put(in.readString(), MappingMetaData.readFrom(in));, +                MappingMetaData.writeTo(mappingEntry.value, out);, +                AliasMetaData.Builder.writeTo(aliasEntry, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java, +        ClusterState.Builder.writeTo(state, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java, +        ClusterState.Builder.writeTo(clusterState, out);, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java, +import com.carrotsearch.hppc.cursors.ObjectCursor;, +import org.elasticsearch.cluster.block.ClusterBlockLevel;, +import java.util.List;]