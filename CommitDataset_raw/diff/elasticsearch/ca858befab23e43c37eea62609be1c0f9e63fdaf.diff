[+++ b/test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java, +import org.apache.http.client.methods.HttpGet;, +import org.apache.http.util.EntityUtils;, +    private static final ContentType YAML_CONTENT_TYPE = ContentType.create("application/yaml");, +, +    public ClientYamlTestResponse callApi(String apiName, Map<String, String> params, HttpEntity entity, Map<String, String> headers), +        if (entity != null) {, +            String contentType = entity.getContentType().getValue();, +            if (sendBodyAsSourceParam(supportedMethods, contentType)) {, +                queryStringParams.put("source", EntityUtils.toString(entity));, +                queryStringParams.put("source_content_type", contentType);, +                requestMethod = HttpGet.METHOD_NAME;, +                entity = null;, +            Response response = restClient.performRequest(requestMethod, requestPath, queryStringParams, entity, requestHeaders);, +    private static boolean sendBodyAsSourceParam(List<String> supportedMethods, String contentType) {, +        if (supportedMethods.contains(HttpGet.METHOD_NAME)) {, +            if (contentType.startsWith(ContentType.APPLICATION_JSON.getMimeType()) ||, +                    contentType.startsWith(YAML_CONTENT_TYPE.getMimeType())) {, +                return RandomizedTest.rarely();, +            }, +        }, +        return false;, +    }, +, +++ b/test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java, +import org.apache.http.client.methods.HttpGet;, +import org.apache.http.util.EntityUtils;, +    private static final ContentType YAML_CONTENT_TYPE = ContentType.create("application/yaml");, +, +    public ClientYamlTestResponse callApi(String apiName, Map<String, String> params, HttpEntity entity, Map<String, String> headers), +        if (entity != null) {, +            String contentType = entity.getContentType().getValue();, +            if (sendBodyAsSourceParam(supportedMethods, contentType)) {, +                queryStringParams.put("source", EntityUtils.toString(entity));, +                queryStringParams.put("source_content_type", contentType);, +                requestMethod = HttpGet.METHOD_NAME;, +                entity = null;, +            Response response = restClient.performRequest(requestMethod, requestPath, queryStringParams, entity, requestHeaders);, +    private static boolean sendBodyAsSourceParam(List<String> supportedMethods, String contentType) {, +        if (supportedMethods.contains(HttpGet.METHOD_NAME)) {, +            if (contentType.startsWith(ContentType.APPLICATION_JSON.getMimeType()) ||, +                    contentType.startsWith(YAML_CONTENT_TYPE.getMimeType())) {, +                return RandomizedTest.rarely();, +            }, +        }, +        return false;, +    }, +, +++ b/test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java, +import org.apache.http.HttpEntity;, +import org.apache.http.entity.ContentType;, +import org.apache.http.entity.StringEntity;, +        HttpEntity entity = createEntity(bodies);, +            response = callApiInternal(apiName, requestParams, entity, headers);, +    private HttpEntity createEntity(List<Map<String, Object>> bodies) throws IOException {, +            return null;, +            String bodyAsString = bodyAsString(stash.replaceStashedValues(bodies.get(0)));, +            return new StringEntity(bodyAsString, ContentType.APPLICATION_JSON);, +        return new StringEntity(bodyBuilder.toString(), ContentType.APPLICATION_JSON);, +    private ClientYamlTestResponse callApiInternal(String apiName, Map<String, String> params,, +                                                   HttpEntity entity, Map<String, String> headers) throws IOException  {, +        return clientYamlTestClient.callApi(apiName, params, entity, headers);]