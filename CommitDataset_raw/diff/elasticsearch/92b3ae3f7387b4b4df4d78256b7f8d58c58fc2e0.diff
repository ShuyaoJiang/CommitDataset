[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java, +    private final boolean useType;, +, +        this.useType = indexSettings.getAsBoolean("cluster.routing.operation.use_type", false);, +            if (!useType) {, +                return Math.abs(hash(id)) % indexMetaData(clusterState, index).numberOfShards();, +            } else {, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java, +    private final boolean useType;, +, +        this.useType = indexSettings.getAsBoolean("cluster.routing.operation.use_type", false);, +            if (!useType) {, +                return Math.abs(hash(id)) % indexMetaData(clusterState, index).numberOfShards();, +            } else {, +        }, +++ b/modules/test/integration/src/test/java/org/elasticsearch/test/integration/search/TwoInstanceUnbalancedShardsEmbeddedSearchTests.java, +        @Override protected int hash(String routing) {, +            long lId = Long.parseLong(routing);, +            if (lId < 60) {, +                return 0;, +            }, +            if (lId >= 60 && lId < 90) {, +                return 1;, +            }, +            return 2;, +        }, +]