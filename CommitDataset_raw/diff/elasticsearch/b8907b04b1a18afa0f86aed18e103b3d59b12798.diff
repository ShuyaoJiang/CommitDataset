[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +                if (test.testEnv != null) {, +                    switch (test.testEnv) {, +                    case 'basic':, +                    case 'gold':, +                    case 'platinum':, +                        current.println("        - xpack"), +                        break;, +                    default:, +                        throw new InvalidUserDataException('Unsupported testEnv: ', +                                + test.testEnv), +                    }, +                }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +                if (test.testEnv != null) {, +                    switch (test.testEnv) {, +                    case 'basic':, +                    case 'gold':, +                    case 'platinum':, +                        current.println("        - xpack"), +                        break;, +                    default:, +                        throw new InvalidUserDataException('Unsupported testEnv: ', +                                + test.testEnv), +                    }, +                }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/SnippetsTask.groovy, +            String testEnv = null, +                matcher = line =~ /\[testenv="([^"]+)"\]\s*/, +                if (matcher.matches()) {, +                    testEnv = matcher.group(1), +                }, +                        snippet = new Snippet(path: path, start: lineNumber, testEnv: testEnv), +        String testEnv, +                if (testEnv != null) {, +                    result += "[testenv=$testEnv]", +                }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +                if (test.testEnv != null) {, +                    switch (test.testEnv) {, +                    case 'basic':, +                    case 'gold':, +                    case 'platinum':, +                        current.println("        - xpack"), +                        break;, +                    default:, +                        throw new InvalidUserDataException('Unsupported testEnv: ', +                                + test.testEnv), +                    }, +                }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/SnippetsTask.groovy, +            String testEnv = null, +                matcher = line =~ /\[testenv="([^"]+)"\]\s*/, +                if (matcher.matches()) {, +                    testEnv = matcher.group(1), +                }, +                        snippet = new Snippet(path: path, start: lineNumber, testEnv: testEnv), +        String testEnv, +                if (testEnv != null) {, +                    result += "[testenv=$testEnv]", +                }, +++ b/docs/build.gradle, +listSnippets.docs = buildRestTests.docs, +]