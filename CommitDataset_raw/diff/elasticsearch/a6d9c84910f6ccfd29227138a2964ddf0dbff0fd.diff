[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/util/io/FileSystemUtils.java, +import java.io.*;, +import java.nio.channels.FileChannel;, +    public static void copyFile(File sourceFile, File destinationFile) throws IOException {, +        FileInputStream sourceIs = null;, +        FileChannel source = null;, +        FileOutputStream destinationOs = null;, +        FileChannel destination = null;, +        try {, +            sourceIs = new FileInputStream(sourceFile);, +            source = sourceIs.getChannel();, +            destinationOs = new FileOutputStream(destinationFile);, +            destination = destinationOs.getChannel();, +            destination.transferFrom(source, 0, source.size());, +        } finally {, +            if (source != null) {, +                source.close();, +            }, +            if (sourceIs != null) {, +                sourceIs.close();, +            }, +            if (destination != null) {, +                destination.close();, +            }, +            if (destinationOs != null) {, +                destinationOs.close();, +            }, +        }, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/util/io/FileSystemUtils.java, +import java.io.*;, +import java.nio.channels.FileChannel;, +    public static void copyFile(File sourceFile, File destinationFile) throws IOException {, +        FileInputStream sourceIs = null;, +        FileChannel source = null;, +        FileOutputStream destinationOs = null;, +        FileChannel destination = null;, +        try {, +            sourceIs = new FileInputStream(sourceFile);, +            source = sourceIs.getChannel();, +            destinationOs = new FileOutputStream(destinationFile);, +            destination = destinationOs.getChannel();, +            destination.transferFrom(source, 0, source.size());, +        } finally {, +            if (source != null) {, +                source.close();, +            }, +            if (sourceIs != null) {, +                sourceIs.close();, +            }, +            if (destination != null) {, +                destination.close();, +            }, +            if (destinationOs != null) {, +                destinationOs.close();, +            }, +        }, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/util/lucene/Directories.java, +import static org.elasticsearch.util.io.FileSystemUtils.*;, +, +            copyFile(new File(((FSDirectory) dir).getFile(), fileName), copyTo);, +        syncFile(copyTo);, +            copyFile(copyFrom, destinationFile);]