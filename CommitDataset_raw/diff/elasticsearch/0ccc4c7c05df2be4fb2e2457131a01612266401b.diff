[+++ b/src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java, +import org.elasticsearch.common.xcontent.support.XContentMapValues;, +        waitForMappingOnMaster(index, type, fieldNames);, +    public void waitForMappingOnMaster(final String index, final String type, final String... fieldNames) throws InterruptedException {, +                MappingMetaData mappingMetaData = mappings.get(type);, +                if (mappingMetaData == null) {, +                    return false;, +                }, +, +                Map<String, Object> mappingSource;, +                try {, +                    mappingSource = mappingMetaData.getSourceAsMap();, +                } catch (IOException e) {, +                    throw ExceptionsHelper.convertToElastic(e);, +                }, +                if (mappingSource.isEmpty() && !mappingSource.containsKey("properties")) {, +                    return false;, +                }, +, +                for (String fieldName : fieldNames) {, +                    Map<String, Object> mappingProperties = (Map<String, Object>) mappingSource.get("properties");, +                    if (fieldName.indexOf('.') != -1) {, +                        fieldName = fieldName.replace(".", ".properties.");, +                    }, +                    if (XContentMapValues.extractValue(fieldName, mappingProperties) == null) {, +                        return false;, +                    }, +                }, +, +                return true;]