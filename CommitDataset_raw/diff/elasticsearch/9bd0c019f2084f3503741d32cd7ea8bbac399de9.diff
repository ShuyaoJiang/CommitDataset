[+++ b/src/test/java/org/elasticsearch/search/geo/GeoShapeIntegrationTests.java, +import org.elasticsearch.cluster.ClusterState;, +import org.elasticsearch.cluster.routing.IndexShardRoutingTable;, +        ensureGreen(idxName, idxName+"2");, +        ensureGreen(idxName, idxName+"2");, +        IndicesService indicesService = internalCluster().getInstance(IndicesService.class, findNodeName(idxName));, +        indicesService = internalCluster().getInstance(IndicesService.class, findNodeName(idxName+"2"));, +, +    private String findNodeName(String index) {, +        ClusterState state = client().admin().cluster().prepareState().get().getState();, +        IndexShardRoutingTable shard = state.getRoutingTable().index(index).shard(0);, +        String nodeId = shard.assignedShards().get(0).currentNodeId();, +        return state.getNodes().get(nodeId).name();, +    }]