[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/indices/store/TransportNodesListShardStoreMetaData.java, +import org.elasticsearch.cluster.ClusterState;, +        ClusterState state = clusterService.state();, +        Set<String> nodesIds = Sets.newHashSet();, +        for (DiscoveryNode node : state.nodes()) {, +            if (node.dataNode()) {, +                nodesIds.add(node.id());, +            }, +        }, +        return execute(new Request(shardId, onlyUnallocated, nodesIds.toArray(new String[nodesIds.size()])));]