[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy, +import org.gradle.api.artifacts.Dependency, +            // the dependency jars, filtered for those provided, +            from project.configurations.runtime.fileCollection { Dependency dep ->, +                project.configurations.provided.contains(dep) == false ||, +                // handle dependencies upgraded explicitly from provided to compile, +                project.configurations.compile.contains(dep), +            }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy, +import org.gradle.api.artifacts.Dependency, +            // the dependency jars, filtered for those provided, +            from project.configurations.runtime.fileCollection { Dependency dep ->, +                project.configurations.provided.contains(dep) == false ||, +                // handle dependencies upgraded explicitly from provided to compile, +                project.configurations.compile.contains(dep), +            }, +++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy, +import org.gradle.api.artifacts.Dependency, +            // the dependency jars, filtered for those provided, +            from project.configurations.runtime.fileCollection { Dependency dep ->, +                project.configurations.provided.contains(dep) == false ||, +                // handle dependencies upgraded explicitly from provided to compile, +                project.configurations.compile.contains(dep), +            }, +++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +++ b/distribution/build.gradle, +ext.dependencyFiles = project(':core').configurations.runtime.copyRecursive().exclude(module: 'slf4j-api'), +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy, +import org.gradle.api.artifacts.Dependency, +            // the dependency jars, filtered for those provided, +            from project.configurations.runtime.fileCollection { Dependency dep ->, +                project.configurations.provided.contains(dep) == false ||, +                // handle dependencies upgraded explicitly from provided to compile, +                project.configurations.compile.contains(dep), +            }, +++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +++ b/distribution/build.gradle, +ext.dependencyFiles = project(':core').configurations.runtime.copyRecursive().exclude(module: 'slf4j-api'), +++ b/plugins/repository-hdfs/build.gradle, +configurations {, +    hadoop1, +    hadoop2, +}, +, +  'hadoop1': '1.2.1',, +  provided "org.elasticsearch:elasticsearch:${versions.elasticsearch}", +  provided "org.apache.hadoop:hadoop-core:${versions.hadoop1}", +, +  // use Hadoop1 to compile and test things (a subset of Hadoop2), +  testCompile "org.apache.hadoop:hadoop-core:${versions.hadoop1}", +  testCompile "org.apache.hadoop:hadoop-test:${versions.hadoop1}", +  // Hadoop dependencies, +  testCompile "commons-configuration:commons-configuration:1.6", +  testCompile "commons-lang:commons-lang:${versions.commonslang}", +  testCompile "commons-collections:commons-collections:3.2.2", +  testCompile "commons-net:commons-net:1.4.1", +  testCompile "org.mortbay.jetty:jetty:6.1.26", +  testCompile "org.mortbay.jetty:jetty-util:6.1.26", +  testCompile "org.mortbay.jetty:servlet-api:2.5-20081211", +  testCompile "com.sun.jersey:jersey-core:1.8", +  , +, +  hadoop1("org.apache.hadoop:hadoop-core:${versions.hadoop1}") {, +    exclude module: "commons-cli", +    exclude group: "com.sun.jersey", +    exclude group: "org.mortbay.jetty", +    exclude group: "tomcat", +    exclude module: "commons-el", +    exclude module: "hsqldb", +    exclude group: "org.eclipse.jdt", +    exclude module: "commons-beanutils", +    exclude module: "commons-beanutils-core", +    exclude module: "junit", +    // provided by ES itself, +    exclude group: "log4j", +  hadoop2("org.apache.hadoop:hadoop-client:${versions.hadoop2}") {, +    exclude module: "commons-cli", +    exclude group: "com.sun.jersey", +    exclude group: "com.sun.jersey.contribs", +    exclude group: "com.sun.jersey.jersey-test-framework", +    exclude module: "guice", +    exclude group: "org.mortbay.jetty", +    exclude group: "tomcat", +    exclude module: "commons-el", +    exclude module: "hsqldb", +    exclude group: "org.eclipse.jdt", +    exclude module: "commons-beanutils", +    exclude module: "commons-beanutils-core", +    exclude module: "javax.servlet", +    exclude module: "junit", +    // provided by ES itself, +    exclude group: "log4j", +  }, +, +  hadoop2("org.apache.hadoop:hadoop-hdfs:${versions.hadoop2}") {, +    exclude module: "guava", +    exclude module: "junit", +    // provided by ES itself, +    exclude group: "log4j"]