[+++ b/docs/reference/sql/functions/grouping.asciidoc, +NOTE:: The histogram in SQL does *NOT* return empty buckets for missing intervals as the traditional <<search-aggregations-bucket-histogram-aggregation, histogram>> and  <<search-aggregations-bucket-datehistogram-aggregation, date histogram>>. Such behavior does not fit conceptually in SQL which treats all missing values as `NULL`; as such the histogram places all missing values in the `NULL` group., +, +Expressions inside the histogram are also supported as long as the, +return type is numeric:, +["source","sql",subs="attributes,callouts,macros"], +----, +include-tagged::{sql-specs}/docs.csv-spec[histogramNumericExpression], +----, +, +Do note that histograms (and grouping functions in general) allow custom expressions but cannot have any functions applied to them in the `GROUP BY`. In other words, the following statement is *NOT* allowed:, +, +["source","sql",subs="attributes,callouts,macros"], +----, +include-tagged::{sql-specs}/docs.csv-spec[expressionOnHistogramNotAllowed], +----, +, +as it requires two groupings (one for histogram followed by a second for applying the function on top of the histogram groups)., +, +Instead one can rewrite the query to move the expression on the histogram _inside_ of it:, +, +["source","sql",subs="attributes,callouts,macros"], +----, +include-tagged::{sql-specs}/docs.csv-spec[histogramDateExpression], +----, +++ b/docs/reference/sql/functions/grouping.asciidoc, +NOTE:: The histogram in SQL does *NOT* return empty buckets for missing intervals as the traditional <<search-aggregations-bucket-histogram-aggregation, histogram>> and  <<search-aggregations-bucket-datehistogram-aggregation, date histogram>>. Such behavior does not fit conceptually in SQL which treats all missing values as `NULL`; as such the histogram places all missing values in the `NULL` group., +, +Expressions inside the histogram are also supported as long as the, +return type is numeric:, +["source","sql",subs="attributes,callouts,macros"], +----, +include-tagged::{sql-specs}/docs.csv-spec[histogramNumericExpression], +----, +, +Do note that histograms (and grouping functions in general) allow custom expressions but cannot have any functions applied to them in the `GROUP BY`. In other words, the following statement is *NOT* allowed:, +, +["source","sql",subs="attributes,callouts,macros"], +----, +include-tagged::{sql-specs}/docs.csv-spec[expressionOnHistogramNotAllowed], +----, +, +as it requires two groupings (one for histogram followed by a second for applying the function on top of the histogram groups)., +, +Instead one can rewrite the query to move the expression on the histogram _inside_ of it:, +, +["source","sql",subs="attributes,callouts,macros"], +----, +include-tagged::{sql-specs}/docs.csv-spec[histogramDateExpression], +----, +++ b/x-pack/plugin/sql/qa/src/main/resources/agg.csv-spec, +histogramDateWithMonthOnTop, +schema::h:i|c:l, +SELECT HISTOGRAM(MONTH(birth_date), 2) AS h, COUNT(*) as c FROM test_emp GROUP BY h ORDER BY h DESC;, +       h       |       c       , +---------------+---------------, +12             |7              , +10             |17             , +8              |16             , +6              |16             , +4              |18             , +2              |10             , +0              |6              , +null           |10    , +;, +histogramDateWithYearOnTop, +schema::h:i|c:l, +SELECT HISTOGRAM(YEAR(birth_date), 2) AS h, COUNT(*) as c FROM test_emp GROUP BY h ORDER BY h DESC;, +       h       |       c       , +---------------+---------------, +1964           |5              , +1962           |13             , +1960           |16             , +1958           |16             , +1956           |9              , +1954           |12             , +1952           |19             , +null           |10   , +;, +histogramNumericWithExpression, +schema::h:i|c:l, +SELECT HISTOGRAM(emp_no % 100, 10) AS h, COUNT(*) as c FROM test_emp GROUP BY h ORDER BY h DESC;, +, +       h       |       c       , +---------------+---------------, +90             |10             , +80             |10             , +70             |10             , +60             |10             , +50             |10             , +40             |10             , +30             |10             , +20             |10             , +10             |10             , +0              |10   , +++ b/docs/reference/sql/functions/grouping.asciidoc, +NOTE:: The histogram in SQL does *NOT* return empty buckets for missing intervals as the traditional <<search-aggregations-bucket-histogram-aggregation, histogram>> and  <<search-aggregations-bucket-datehistogram-aggregation, date histogram>>. Such behavior does not fit conceptually in SQL which treats all missing values as `NULL`; as such the histogram places all missing values in the `NULL` group., +, +Expressions inside the histogram are also supported as long as the, +return type is numeric:]