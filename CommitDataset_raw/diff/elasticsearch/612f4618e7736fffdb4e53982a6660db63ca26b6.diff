[+++ b/src/test/java/org/elasticsearch/get/GetActionTests.java, +import com.google.common.base.Predicate;, +import org.elasticsearch.action.admin.indices.recovery.RecoveryResponse;, +import org.elasticsearch.action.admin.indices.recovery.ShardRecoveryResponse;, +import java.util.List;, +import java.util.concurrent.TimeUnit;, +        // Flush fails if shard has ongoing recoveries, +        awaitBusy(new Predicate<Object>() {, +            @Override, +            public boolean apply(Object input) {, +                RecoveryResponse response = client().admin().indices().prepareRecoveries("my-index").setActiveOnly(true).get();, +                for (Map.Entry<String, List<ShardRecoveryResponse>> entry : response.shardResponses().entrySet()) {, +                    if (!entry.getValue().isEmpty()) {, +                        return false;, +                    }, +                }, +                return true;, +            }, +        }, 1 , TimeUnit.MINUTES);, +]