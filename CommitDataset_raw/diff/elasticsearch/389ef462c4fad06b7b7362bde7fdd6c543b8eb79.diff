[+++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/Analyzer.java, +        //, +        // reserved words parameters., +        //, +        // input map of variables passed to the script. TODO: rename to 'params' since that will be its use, +        // scorer parameter passed to the script. internal use only., +        // doc parameter passed to the script., +        // TODO: currently working as a def type, should be smapType..., +        metadata.docValueSlot = utility.addVariable(null, "doc", definition.defType).slot;, +        //, +        // reserved words implemented as local variables, +        //, +        // loop counter to catch runaway scripts. internal use only., +        // document's score as a read-only float., +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/Analyzer.java, +        //, +        // reserved words parameters., +        //, +        // input map of variables passed to the script. TODO: rename to 'params' since that will be its use, +        // scorer parameter passed to the script. internal use only., +        // doc parameter passed to the script., +        // TODO: currently working as a def type, should be smapType..., +        metadata.docValueSlot = utility.addVariable(null, "doc", definition.defType).slot;, +        //, +        // reserved words implemented as local variables, +        //, +        // loop counter to catch runaway scripts. internal use only., +        // document's score as a read-only float., +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/AnalyzerExternal.java, +            if ("_score".equals(id) || "doc".equals(id)) {, +            }, +, +            // track if the _score value is ever used, we will invoke Scorer.score() only once if so., +            if ("_score".equals(id)) {, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/Analyzer.java, +        //, +        // reserved words parameters., +        //, +        // input map of variables passed to the script. TODO: rename to 'params' since that will be its use, +        // scorer parameter passed to the script. internal use only., +        // doc parameter passed to the script., +        // TODO: currently working as a def type, should be smapType..., +        metadata.docValueSlot = utility.addVariable(null, "doc", definition.defType).slot;, +        //, +        // reserved words implemented as local variables, +        //, +        // loop counter to catch runaway scripts. internal use only., +        // document's score as a read-only float., +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/AnalyzerExternal.java, +            if ("_score".equals(id) || "doc".equals(id)) {, +            }, +, +            // track if the _score value is ever used, we will invoke Scorer.score() only once if so., +            if ("_score".equals(id)) {, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/Executable.java, +import org.elasticsearch.search.lookup.LeafDocLookup;, +    public abstract Object execute(Map<String, Object> input, Scorer scorer, LeafDocLookup doc);, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/Analyzer.java, +        //, +        // reserved words parameters., +        //, +        // input map of variables passed to the script. TODO: rename to 'params' since that will be its use, +        // scorer parameter passed to the script. internal use only., +        // doc parameter passed to the script., +        // TODO: currently working as a def type, should be smapType..., +        metadata.docValueSlot = utility.addVariable(null, "doc", definition.defType).slot;, +        //, +        // reserved words implemented as local variables, +        //, +        // loop counter to catch runaway scripts. internal use only., +        // document's score as a read-only float., +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/AnalyzerExternal.java, +            if ("_score".equals(id) || "doc".equals(id)) {, +            }, +, +            // track if the _score value is ever used, we will invoke Scorer.score() only once if so., +            if ("_score".equals(id)) {, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/Executable.java, +import org.elasticsearch.search.lookup.LeafDocLookup;, +    public abstract Object execute(Map<String, Object> input, Scorer scorer, LeafDocLookup doc);, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/Metadata.java, +    , +    /**, +     * Used to determine what slot the doc variable is stored in.  This is used in the {@link Writer} whenever, +     * the doc variable is accessed., +     */, +    int docValueSlot = -1;, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/Analyzer.java, +        //, +        // reserved words parameters., +        //, +        // input map of variables passed to the script. TODO: rename to 'params' since that will be its use, +        // scorer parameter passed to the script. internal use only., +        // doc parameter passed to the script., +        // TODO: currently working as a def type, should be smapType..., +        metadata.docValueSlot = utility.addVariable(null, "doc", definition.defType).slot;, +        //, +        // reserved words implemented as local variables, +        //, +        // loop counter to catch runaway scripts. internal use only.]