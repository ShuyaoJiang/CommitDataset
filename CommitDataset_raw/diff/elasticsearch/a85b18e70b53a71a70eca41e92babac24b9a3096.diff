[+++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/job/config/AnalysisConfig.java, +        if (usePerPartitionNormalization) {, +        }, +++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/job/config/AnalysisConfig.java, +        if (usePerPartitionNormalization) {, +        }, +++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/job/process/autodetect/output/StateProcessor.java, + * Reads the autodetect state and persists via a bulk request, +++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/job/config/AnalysisConfig.java, +        if (usePerPartitionNormalization) {, +        }, +++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/job/process/autodetect/output/StateProcessor.java, + * Reads the autodetect state and persists via a bulk request, +++ b/plugin/src/test/java/org/elasticsearch/xpack/ml/job/config/AnalysisConfigTests.java, +            Detector.Builder builder = new Detector.Builder("count", null);, +            builder.setPartitionFieldName("part");, +            detectors.add(builder.build());, +        boolean usePerPartitionNormalisation = randomBoolean();, +        builder.setUsePerPartitionNormalization(usePerPartitionNormalisation);, +        if (!usePerPartitionNormalisation) { // influencers can't be used with per partition normalisation, +            builder.setInfluencers(Arrays.asList(generateRandomStringArray(10, 10, false)));, +        }]