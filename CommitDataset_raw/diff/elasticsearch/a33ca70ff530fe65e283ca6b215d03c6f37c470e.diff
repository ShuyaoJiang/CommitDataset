[+++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +            innerHitsContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +            innerHitsContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            context.docValueFieldsContext(new DocValueFieldsContext(source.docValueFields()));, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +            innerHitsContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            context.docValueFieldsContext(new DocValueFieldsContext(source.docValueFields()));, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java, +import org.elasticsearch.search.fetch.StoredFieldsContext;, +            subSearchContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +            innerHitsContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            context.docValueFieldsContext(new DocValueFieldsContext(source.docValueFields()));, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java, +import org.elasticsearch.search.fetch.StoredFieldsContext;, +            subSearchContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsContext.java, +public class DocValueFieldsContext {, +    private final List<String> fields;, +    public DocValueFieldsContext(List<String> fields) {, +        this.fields = fields;, +    /**, +     * Returns the required docvalue fields, +     */, +    public List<String> fields() {, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +            innerHitsContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            context.docValueFieldsContext(new DocValueFieldsContext(source.docValueFields()));, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java, +import org.elasticsearch.search.fetch.StoredFieldsContext;, +            subSearchContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsContext.java, +public class DocValueFieldsContext {, +    private final List<String> fields;, +    public DocValueFieldsContext(List<String> fields) {, +        this.fields = fields;, +    /**, +     * Returns the required docvalue fields, +     */, +    public List<String> fields() {, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsFetchSubPhase.java, +        if (context.docValueFieldsContext() == null) {, +        for (String field : context.docValueFieldsContext().fields()) {, +            SearchHitField hitField = hitContext.hit().fields().get(field);, +                hitField = new InternalSearchHitField(field, new ArrayList<>(2));, +                hitContext.hit().fields().put(field, hitField);, +            MappedFieldType fieldType = context.mapperService().fullName(field);, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +            innerHitsContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            context.docValueFieldsContext(new DocValueFieldsContext(source.docValueFields()));, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java, +import org.elasticsearch.search.fetch.StoredFieldsContext;, +            subSearchContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsContext.java, +public class DocValueFieldsContext {, +    private final List<String> fields;, +    public DocValueFieldsContext(List<String> fields) {, +        this.fields = fields;, +    /**, +     * Returns the required docvalue fields, +     */, +    public List<String> fields() {, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsFetchSubPhase.java, +        if (context.docValueFieldsContext() == null) {, +        for (String field : context.docValueFieldsContext().fields()) {, +            SearchHitField hitField = hitContext.hit().fields().get(field);, +                hitField = new InternalSearchHitField(field, new ArrayList<>(2));, +                hitContext.hit().fields().put(field, hitField);, +            MappedFieldType fieldType = context.mapperService().fullName(field);, +++ b/core/src/main/java/org/elasticsearch/search/internal/DefaultSearchContext.java, +import org.elasticsearch.search.fetch.subphase.DocValueFieldsContext;, +    private DocValueFieldsContext docValueFieldsContext;, +    public DocValueFieldsContext docValueFieldsContext() {, +        return docValueFieldsContext;, +    }, +, +    @Override, +    public SearchContext docValueFieldsContext(DocValueFieldsContext docValueFieldsContext) {, +        this.docValueFieldsContext = docValueFieldsContext;, +        return this;, +    }, +, +    @Override, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +            innerHitsContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            context.docValueFieldsContext(new DocValueFieldsContext(source.docValueFields()));, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java, +import org.elasticsearch.search.fetch.StoredFieldsContext;, +            subSearchContext.docValueFieldsContext(new DocValueFieldsContext(docValueFields));, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsContext.java, +public class DocValueFieldsContext {, +    private final List<String> fields;, +    public DocValueFieldsContext(List<String> fields) {]