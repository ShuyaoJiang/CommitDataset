[+++ b/src/test/java/org/elasticsearch/test/store/MockDirectoryHelper.java, +import org.apache.lucene.store.Lock;, +import java.util.Map;, +import java.util.concurrent.ConcurrentHashMap;, +        private final Map<String, Exception> locks = new ConcurrentHashMap<>();, +            for (Exception ex : locks.values()) {, +                logger.info("Lock still open - opened from: ", ex);, +            }, +, +        @Override, +        public Lock makeLock(String lockName) {, +            Lock l = super.makeLock(lockName);, +            if (l != null) {, +                locks.put(lockName, new Exception());, +            }, +            return l;, +        }, +, +        public void clearLock(String lockName) throws IOException {, +            try {, +                super.clearLock(lockName);, +            } finally {, +                locks.remove(lockName);, +            }, +        }]