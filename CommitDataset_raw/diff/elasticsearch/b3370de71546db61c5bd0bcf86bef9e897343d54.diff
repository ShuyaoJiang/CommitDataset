[+++ b/core/src/main/java/org/elasticsearch/transport/TcpTransport.java, +, +import org.elasticsearch.common.transport.TransportAddress;, +        @Override, +++ b/core/src/main/java/org/elasticsearch/transport/TcpTransport.java, +, +import org.elasticsearch.common.transport.TransportAddress;, +        @Override, +++ b/core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java, +        // we should have deprecation warning headers regardless of throwing an exception, +        checkWarningHeaders("query malformed, empty clause found at [1:27]",, +                "query malformed, empty clause found at [1:46]",, +                "query malformed, empty clause found at [1:100]");, +        checkWarningHeaders("query malformed, empty clause found at [1:27]");, +++ b/core/src/main/java/org/elasticsearch/transport/TcpTransport.java, +, +import org.elasticsearch.common.transport.TransportAddress;, +        @Override, +++ b/core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java, +        // we should have deprecation warning headers regardless of throwing an exception, +        checkWarningHeaders("query malformed, empty clause found at [1:27]",, +                "query malformed, empty clause found at [1:46]",, +                "query malformed, empty clause found at [1:100]");, +        checkWarningHeaders("query malformed, empty clause found at [1:27]");, +++ b/core/src/test/java/org/elasticsearch/index/query/BoostingQueryBuilderTests.java, +import static org.hamcrest.CoreMatchers.equalTo;, +import static org.hamcrest.CoreMatchers.nullValue;;, +        checkWarningHeaders("query malformed, empty clause found at [1:36]");, +, +                "{ \"boosting\" : {\n" +, +                "    \"positive\" : { \"match_all\" : {} },\n" +, +                "    \"negative\" : { },\n" +, +                "    \"negative_boost\" : 23.0\n" +, +                "  }\n" +, +        checkWarningHeaders("query malformed, empty clause found at [3:20]");, +, +        assertThat(ex.getMessage(), equalTo("query malformed, empty clause found at [3:20]"));, +        checkWarningHeaders("query malformed, empty clause found at [3:20]");, +++ b/core/src/main/java/org/elasticsearch/transport/TcpTransport.java, +, +import org.elasticsearch.common.transport.TransportAddress;, +        @Override, +++ b/core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java, +        // we should have deprecation warning headers regardless of throwing an exception, +        checkWarningHeaders("query malformed, empty clause found at [1:27]",, +                "query malformed, empty clause found at [1:46]",, +                "query malformed, empty clause found at [1:100]");, +        checkWarningHeaders("query malformed, empty clause found at [1:27]");, +++ b/core/src/test/java/org/elasticsearch/index/query/BoostingQueryBuilderTests.java, +import static org.hamcrest.CoreMatchers.equalTo;, +import static org.hamcrest.CoreMatchers.nullValue;;, +        checkWarningHeaders("query malformed, empty clause found at [1:36]");, +, +                "{ \"boosting\" : {\n" +, +                "    \"positive\" : { \"match_all\" : {} },\n" +, +                "    \"negative\" : { },\n" +, +                "    \"negative_boost\" : 23.0\n" +, +                "  }\n" +, +        checkWarningHeaders("query malformed, empty clause found at [3:20]");, +, +        assertThat(ex.getMessage(), equalTo("query malformed, empty clause found at [3:20]"));, +        checkWarningHeaders("query malformed, empty clause found at [3:20]");, +++ b/core/src/test/java/org/elasticsearch/index/query/ConstantScoreQueryBuilderTests.java, +import static org.hamcrest.CoreMatchers.equalTo;, +        checkWarningHeaders("query malformed, empty clause found at [1:40]");, +        assertThat(ex.getMessage(), equalTo("query malformed, empty clause found at [1:40]"));, +        checkWarningHeaders("query malformed, empty clause found at [1:40]");, +++ b/core/src/main/java/org/elasticsearch/transport/TcpTransport.java, +, +import org.elasticsearch.common.transport.TransportAddress;, +        @Override, +++ b/core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java, +        // we should have deprecation warning headers regardless of throwing an exception, +        checkWarningHeaders("query malformed, empty clause found at [1:27]",, +                "query malformed, empty clause found at [1:46]",, +                "query malformed, empty clause found at [1:100]");, +        checkWarningHeaders("query malformed, empty clause found at [1:27]");, +++ b/core/src/test/java/org/elasticsearch/index/query/BoostingQueryBuilderTests.java, +import static org.hamcrest.CoreMatchers.equalTo;, +import static org.hamcrest.CoreMatchers.nullValue;;, +        checkWarningHeaders("query malformed, empty clause found at [1:36]");, +, +                "{ \"boosting\" : {\n" +, +                "    \"positive\" : { \"match_all\" : {} },\n" +, +                "    \"negative\" : { },\n" +, +                "    \"negative_boost\" : 23.0\n" +, +                "  }\n" +, +        checkWarningHeaders("query malformed, empty clause found at [3:20]");, +, +        assertThat(ex.getMessage(), equalTo("query malformed, empty clause found at [3:20]"));, +        checkWarningHeaders("query malformed, empty clause found at [3:20]");, +++ b/core/src/test/java/org/elasticsearch/index/query/ConstantScoreQueryBuilderTests.java, +import static org.hamcrest.CoreMatchers.equalTo;, +        checkWarningHeaders("query malformed, empty clause found at [1:40]");, +        assertThat(ex.getMessage(), equalTo("query malformed, empty clause found at [1:40]"));, +        checkWarningHeaders("query malformed, empty clause found at [1:40]");, +++ b/core/src/test/java/org/elasticsearch/index/query/DisMaxQueryBuilderTests.java, +        checkWarningHeaders("query malformed, empty clause found at [1:78]");, +++ b/core/src/main/java/org/elasticsearch/transport/TcpTransport.java, +]