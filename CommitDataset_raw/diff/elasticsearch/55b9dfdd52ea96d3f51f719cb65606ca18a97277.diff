[+++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java, +            builder.field(Fields.SUM, 0.0d);, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java, +            builder.field(Fields.SUM, 0.0d);, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java, +import org.elasticsearch.common.xcontent.ToXContent;, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.common.xcontent.json.JsonXContent;, +import java.io.IOException;, +import java.util.Collections;, +, +    public void testDoXContentBody() throws IOException {, +        // count is greater than zero, +        double min = randomDoubleBetween(-1000000, 1000000, true);, +        double max = randomDoubleBetween(-1000000, 1000000, true);, +        double sum = randomDoubleBetween(-1000000, 1000000, true);, +        int count = randomIntBetween(1, 10);, +        DocValueFormat format = randomNumericDocValueFormat();, +        InternalStats internalStats = createInstance("stats", count, sum, min, max, format, Collections.emptyList(), null);, +        XContentBuilder builder = JsonXContent.contentBuilder().prettyPrint();, +        builder.startObject();, +        internalStats.doXContentBody(builder, ToXContent.EMPTY_PARAMS);, +        builder.endObject();, +, +        String expected = "{\n" +, +            "  \"count\" : " + count + ",\n" +, +            "  \"min\" : " + min + ",\n" +, +            "  \"max\" : " + max + ",\n" +, +            "  \"avg\" : " + internalStats.getAvg() + ",\n" +, +            "  \"sum\" : " + sum;, +        if (format != DocValueFormat.RAW) {, +            expected += ",\n"+, +                "  \"min_as_string\" : \"" + format.format(internalStats.getMin()) + "\",\n" +, +                "  \"max_as_string\" : \"" + format.format(internalStats.getMax()) + "\",\n" +, +                "  \"avg_as_string\" : \"" + format.format(internalStats.getAvg()) + "\",\n" +, +                "  \"sum_as_string\" : \"" + format.format(internalStats.getSum()) + "\"";, +        }, +        expected += "\n}";, +        assertEquals(expected, builder.string());, +, +        // count is zero, +        format = randomNumericDocValueFormat();, +        min = 0.0;, +        max = 0.0;, +        sum = 0.0;, +        count = 0;, +        internalStats = createInstance("stats", count, sum, min, max, format, Collections.emptyList(), null);, +        builder = JsonXContent.contentBuilder().prettyPrint();, +        builder.startObject();, +        internalStats.doXContentBody(builder, ToXContent.EMPTY_PARAMS);, +        builder.endObject();, +, +        assertEquals("{\n" +, +            "  \"count\" : 0,\n" +, +            "  \"min\" : null,\n" +, +            "  \"max\" : null,\n" +, +            "  \"avg\" : null,\n" +, +            "  \"sum\" : 0.0\n" +, +            "}", builder.string());, +    }]