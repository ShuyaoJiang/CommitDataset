[+++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +            case 21:, +                return readBytesRef();, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +            case 21:, +                return readBytesRef();, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +        } else if (value instanceof BytesRef) {, +            writeByte((byte) 21);, +            writeBytesRef((BytesRef) value);, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +            case 21:, +                return readBytesRef();, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +        } else if (value instanceof BytesRef) {, +            writeByte((byte) 21);, +            writeBytesRef((BytesRef) value);, +++ b/src/main/java/org/elasticsearch/discovery/zen/ping/multicast/MulticastZenPing.java, +import org.elasticsearch.ElasticsearchException;, +import org.elasticsearch.common.io.stream.*;, +            BytesStreamOutput out = new BytesStreamOutput();, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +            case 21:, +                return readBytesRef();, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +        } else if (value instanceof BytesRef) {, +            writeByte((byte) 21);, +            writeBytesRef((BytesRef) value);, +++ b/src/main/java/org/elasticsearch/discovery/zen/ping/multicast/MulticastZenPing.java, +import org.elasticsearch.ElasticsearchException;, +import org.elasticsearch.common.io.stream.*;, +            BytesStreamOutput out = new BytesStreamOutput();, +++ b/src/test/java/org/elasticsearch/common/io/streams/BytesStreamsTests.java, +import org.elasticsearch.common.lucene.BytesRefs;, +        out.writeGenericValue(BytesRefs.toBytesRef("bytesref"));, +        assertThat(in.readGenericValue(), equalTo((Object)BytesRefs.toBytesRef("bytesref")));]