[+++ b/src/test/java/org/elasticsearch/test/integration/indexlifecycle/IndexLifecycleActionTests.java, +        // first wait for 3 nodes in the cluster, +, +        // explicitly call reroute, so shards will get relocated to the new node (we delay it in ES in case other nodes join), +        client("server1").admin().cluster().prepareReroute().execute().actionGet();, +, +        clusterHealth = client("server1").admin().cluster().health(clusterHealthRequest().waitForGreenStatus().waitForNodes("3").waitForRelocatingShards(0)).actionGet();, +        assertThat(clusterHealth.isTimedOut(), equalTo(false));, +        assertThat(clusterHealth.getStatus(), equalTo(ClusterHealthStatus.GREEN));, +        assertThat(clusterHealth.getNumberOfDataNodes(), equalTo(3));, +        assertThat(clusterHealth.getInitializingShards(), equalTo(0));, +        assertThat(clusterHealth.getUnassignedShards(), equalTo(0));, +, +, +        // first wait for 2 nodes in the cluster, +, +        // explicitly call reroute, so shards will get relocated to the new node (we delay it in ES in case other nodes join), +        client("server1").admin().cluster().prepareReroute().execute().actionGet();, +, +        clusterHealth = client("server1").admin().cluster().health(clusterHealthRequest().waitForGreenStatus().waitForRelocatingShards(0).waitForNodes("2")).actionGet();, +        assertThat(clusterHealth.isTimedOut(), equalTo(false));, +        assertThat(clusterHealth.getStatus(), equalTo(ClusterHealthStatus.GREEN));, +        assertThat(clusterHealth.getNumberOfDataNodes(), equalTo(2));, +        assertThat(clusterHealth.getInitializingShards(), equalTo(0));, +        assertThat(clusterHealth.getUnassignedShards(), equalTo(0));, +, +        // first wait for 3 nodes in the cluster, +        clusterHealth = client("server1").admin().cluster().health(clusterHealthRequest().waitForGreenStatus().waitForNodes("3").waitForRelocatingShards(0)).actionGet();, +, +        // explicitly call reroute, so shards will get relocated to the new node (we delay it in ES in case other nodes join), +        client("server1").admin().cluster().prepareReroute().execute().actionGet();, +, +        clusterHealth = client("server1").admin().cluster().health(clusterHealthRequest().waitForGreenStatus().waitForNodes("3").waitForRelocatingShards(0)).actionGet();, +        assertThat(clusterHealth.isTimedOut(), equalTo(false));, +        assertThat(clusterHealth.getStatus(), equalTo(ClusterHealthStatus.GREEN));, +        assertThat(clusterHealth.getNumberOfDataNodes(), equalTo(3));, +        assertThat(clusterHealth.getInitializingShards(), equalTo(0));, +        assertThat(clusterHealth.getUnassignedShards(), equalTo(0));]