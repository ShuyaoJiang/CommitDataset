[+++ b/src/test/java/org/elasticsearch/indices/mapping/ConcurrentDynamicTemplateTests.java, +, +import org.elasticsearch.common.Strings;, +import org.elasticsearch.common.settings.ImmutableSettings;, +import static org.elasticsearch.test.hamcrest.ElasticSearchAssertions.assertHitCount;, +            client().admin().indices().prepareCreate("test"), +                .setSettings(, +                        ImmutableSettings.settingsBuilder(), +                        .put("number_of_shards", between(1,5)), +                        .put("number_of_replicas", between(0,1)).build()), +                        .addMapping(mappingType, mapping).execute().actionGet();, +            int numDocs = atLeast(10);, +                source.put("an_id", Strings.randomBase64UUID(getRandom()));, +                client().prepareIndex("test", mappingType).setSource(source).execute(new ActionListener<IndexResponse>() {, +            assertHitCount(client().prepareSearch("test").setQuery(QueryBuilders.matchQuery(fieldName, "test-user")).get(), numDocs);, +            assertHitCount(client().prepareSearch("test").setQuery(QueryBuilders.matchQuery(fieldName, "test user")).get(), 0);]