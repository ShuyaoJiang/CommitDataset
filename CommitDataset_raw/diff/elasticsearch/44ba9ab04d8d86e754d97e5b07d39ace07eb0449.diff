[+++ b/server/src/main/java/org/elasticsearch/discovery/PeerFinder.java, +import java.util.LinkedHashMap;, +import static java.util.Collections.emptyList;, +    private final Map<TransportAddress, Peer> peersByAddress = new LinkedHashMap<>();, +        assert holdsLock() : "PeerFinder mutex not held";, +        final boolean peersRemoved = peersByAddress.values().removeIf(Peer::handleWakeUp);, +                    synchronized (mutex) {, +                        peersByAddress.remove(transportAddress);, +                    }]