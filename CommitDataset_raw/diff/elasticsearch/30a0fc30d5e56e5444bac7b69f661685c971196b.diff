[+++ b/src/test/java/org/elasticsearch/indices/store/SimpleDistributorTests.java, +import org.elasticsearch.env.NodeEnvironment;, +import java.util.Set;, +        File[] dataPaths = dataPaths();, +        assertThat(storeString, startsWith("store(least_used[rate_limited(niofs(" + dataPaths[0].getAbsolutePath()));, +        if (dataPaths.length > 1) {, +            assertThat(storeString, containsString("), rate_limited(niofs(" + dataPaths[1].getAbsolutePath()));, +        }, +        dataPaths = dataPaths();, +        assertThat(storeString, startsWith("store(random[rate_limited(niofs(" + dataPaths[0].getAbsolutePath()));, +        if (dataPaths.length > 1) {, +            assertThat(storeString, containsString("), rate_limited(niofs(" + dataPaths[1].getAbsolutePath()));, +        }, +        dataPaths = dataPaths();, +        assertThat(storeString, startsWith("store(least_used[rate_limited(mmapfs(" + dataPaths[0].getAbsolutePath()));, +        if (dataPaths.length > 1) {, +            assertThat(storeString, containsString("), rate_limited(mmapfs(" + dataPaths[1].getAbsolutePath()));, +        }, +        dataPaths = dataPaths();, +        assertThat(storeString, startsWith("store(least_used[rate_limited(simplefs(" + dataPaths[0].getAbsolutePath()));, +        if (dataPaths.length > 1) {, +            assertThat(storeString, containsString("), rate_limited(simplefs(" + dataPaths[1].getAbsolutePath()));, +        }, +        dataPaths = dataPaths();, +        dataPaths = dataPaths();, +        assertThat(storeString, startsWith("store(least_used[niofs(" + dataPaths[0].getAbsolutePath()));, +        if (dataPaths.length > 1) {, +            assertThat(storeString, containsString("), niofs(" + dataPaths[1].getAbsolutePath()));, +        }, +, +    private File[] dataPaths() {, +        Set<String> nodes = cluster().nodesInclude("test");, +        assertThat(nodes.isEmpty(), equalTo(false));, +        NodeEnvironment env = cluster().getInstance(NodeEnvironment.class, nodes.iterator().next());, +        return env.nodeDataLocations();, +    }, +, +        Set<String> nodes = cluster().nodesInclude("test");, +        assertThat(nodes.isEmpty(), equalTo(false));, +        IndicesService indicesService = cluster().getInstance(IndicesService.class, nodes.iterator().next());, +++ b/src/test/java/org/elasticsearch/indices/store/SimpleDistributorTests.java, +import org.elasticsearch.env.NodeEnvironment;, +import java.util.Set;, +        File[] dataPaths = dataPaths();, +        assertThat(storeString, startsWith("store(least_used[rate_limited(niofs(" + dataPaths[0].getAbsolutePath()));, +        if (dataPaths.length > 1) {, +            assertThat(storeString, containsString("), rate_limited(niofs(" + dataPaths[1].getAbsolutePath()));, +        }, +        dataPaths = dataPaths();, +        assertThat(storeString, startsWith("store(random[rate_limited(niofs(" + dataPaths[0].getAbsolutePath()));, +        if (dataPaths.length > 1) {, +            assertThat(storeString, containsString("), rate_limited(niofs(" + dataPaths[1].getAbsolutePath()));, +        }, +        dataPaths = dataPaths();, +        assertThat(storeString, startsWith("store(least_used[rate_limited(mmapfs(" + dataPaths[0].getAbsolutePath()));, +        if (dataPaths.length > 1) {, +            assertThat(storeString, containsString("), rate_limited(mmapfs(" + dataPaths[1].getAbsolutePath()));, +        }, +        dataPaths = dataPaths();, +        assertThat(storeString, startsWith("store(least_used[rate_limited(simplefs(" + dataPaths[0].getAbsolutePath()));, +        if (dataPaths.length > 1) {, +            assertThat(storeString, containsString("), rate_limited(simplefs(" + dataPaths[1].getAbsolutePath()));, +        }, +        dataPaths = dataPaths();, +        dataPaths = dataPaths();, +        assertThat(storeString, startsWith("store(least_used[niofs(" + dataPaths[0].getAbsolutePath()));, +        if (dataPaths.length > 1) {, +            assertThat(storeString, containsString("), niofs(" + dataPaths[1].getAbsolutePath()));, +        }, +, +    private File[] dataPaths() {, +        Set<String> nodes = cluster().nodesInclude("test");, +        assertThat(nodes.isEmpty(), equalTo(false));, +        NodeEnvironment env = cluster().getInstance(NodeEnvironment.class, nodes.iterator().next());, +        return env.nodeDataLocations();, +    }, +, +        Set<String> nodes = cluster().nodesInclude("test");, +        assertThat(nodes.isEmpty(), equalTo(false));, +        IndicesService indicesService = cluster().getInstance(IndicesService.class, nodes.iterator().next());, +++ b/src/test/java/org/elasticsearch/test/TestCluster.java, +        // randomize (multi/single) data path, special case for 0, don't set it at all..., +        int numOfDataPaths = random.nextInt(5);, +        if (numOfDataPaths > 0) {, +            StringBuilder dataPath = new StringBuilder();, +            for (int i = 0; i < numOfDataPaths; i++) {, +                dataPath.append("data/d").append(i).append(',');, +            }, +            builder.put("path.data", dataPath.toString());, +        }, +]