[+++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java, +                    if (shard.primary() && !shard.active() && shard.relocatingNodeId() == null) {, +                    if (!shard.active() && shard.relocatingNodeId() == null) {, +++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java, +                    if (shard.primary() && !shard.active() && shard.relocatingNodeId() == null) {, +                    if (!shard.active() && shard.relocatingNodeId() == null) {, +++ b/src/test/java/org/elasticsearch/test/unit/cluster/routing/allocation/ConcurrentRebalanceRoutingTests.java, +import static org.elasticsearch.test.unit.cluster.routing.allocation.RoutingAllocationTests.newNode;, +++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java, +                    if (shard.primary() && !shard.active() && shard.relocatingNodeId() == null) {, +                    if (!shard.active() && shard.relocatingNodeId() == null) {, +++ b/src/test/java/org/elasticsearch/test/unit/cluster/routing/allocation/ConcurrentRebalanceRoutingTests.java, +import static org.elasticsearch.test.unit.cluster.routing.allocation.RoutingAllocationTests.newNode;, +++ b/src/test/java/org/elasticsearch/test/unit/cluster/routing/allocation/ShardsLimitAllocationTests.java]