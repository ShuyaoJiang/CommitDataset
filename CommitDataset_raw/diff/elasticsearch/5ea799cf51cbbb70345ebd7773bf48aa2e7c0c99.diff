[+++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/ApplicableBasicAuth.java, +import org.elasticsearch.xpack.common.http.auth.ApplicableHttpAuth;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +, +    public ApplicableBasicAuth(BasicAuth auth, CryptoService service) {, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/ApplicableBasicAuth.java, +import org.elasticsearch.xpack.common.http.auth.ApplicableHttpAuth;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +, +    public ApplicableBasicAuth(BasicAuth auth, CryptoService service) {, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/BasicAuthFactory.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +    private final CryptoService cryptoService;, +    public BasicAuthFactory(@Nullable CryptoService cryptoService) {, +        this.cryptoService = cryptoService;, +        return new ApplicableBasicAuth(auth, cryptoService);, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/ApplicableBasicAuth.java, +import org.elasticsearch.xpack.common.http.auth.ApplicableHttpAuth;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +, +    public ApplicableBasicAuth(BasicAuth auth, CryptoService service) {, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/BasicAuthFactory.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +    private final CryptoService cryptoService;, +    public BasicAuthFactory(@Nullable CryptoService cryptoService) {, +        this.cryptoService = cryptoService;, +        return new ApplicableBasicAuth(auth, cryptoService);, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/secret/Secret.java, +import org.elasticsearch.common.xcontent.ToXContent;, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +, +    public char[] text(CryptoService service) {, +        if (service == null) {, +            return text;, +        }, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/ApplicableBasicAuth.java, +import org.elasticsearch.xpack.common.http.auth.ApplicableHttpAuth;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +, +    public ApplicableBasicAuth(BasicAuth auth, CryptoService service) {, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/BasicAuthFactory.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +    private final CryptoService cryptoService;, +    public BasicAuthFactory(@Nullable CryptoService cryptoService) {, +        this.cryptoService = cryptoService;, +        return new ApplicableBasicAuth(auth, cryptoService);, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/secret/Secret.java, +import org.elasticsearch.common.xcontent.ToXContent;, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +, +    public char[] text(CryptoService service) {, +        if (service == null) {, +            return text;, +        }, +++ /dev/null, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/ApplicableBasicAuth.java, +import org.elasticsearch.xpack.common.http.auth.ApplicableHttpAuth;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +, +    public ApplicableBasicAuth(BasicAuth auth, CryptoService service) {, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/BasicAuthFactory.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +    private final CryptoService cryptoService;, +    public BasicAuthFactory(@Nullable CryptoService cryptoService) {, +        this.cryptoService = cryptoService;, +        return new ApplicableBasicAuth(auth, cryptoService);, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/secret/Secret.java, +import org.elasticsearch.common.xcontent.ToXContent;, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +, +    public char[] text(CryptoService service) {, +        if (service == null) {, +            return text;, +        }, +++ /dev/null, +++ /dev/null, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/ApplicableBasicAuth.java, +import org.elasticsearch.xpack.common.http.auth.ApplicableHttpAuth;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +, +    public ApplicableBasicAuth(BasicAuth auth, CryptoService service) {, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/common/http/auth/basic/BasicAuthFactory.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.xpack.security.crypto.CryptoService;, +    private final CryptoService cryptoService;, +    public BasicAuthFactory(@Nullable CryptoService cryptoService) {]