[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            String badBody = /GET|PUT|POST|HEAD|OPTIONS|DELETE|startyaml|#/, +            String rawRequest = /(?:$method\s+$pathAndQuery$body?)/, +            String yamlRequest = /(?:startyaml(?s)(?<yaml>.+?)(?-s)endyaml)/, +            String nonComment = /(?:$rawRequest|$yamlRequest)/, +                String yamlRequest = matcher.group("yaml");, +                if (yamlRequest != null) {, +                    current.println(yamlRequest), +                    return, +                }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            String badBody = /GET|PUT|POST|HEAD|OPTIONS|DELETE|startyaml|#/, +            String rawRequest = /(?:$method\s+$pathAndQuery$body?)/, +            String yamlRequest = /(?:startyaml(?s)(?<yaml>.+?)(?-s)endyaml)/, +            String nonComment = /(?:$rawRequest|$yamlRequest)/, +                String yamlRequest = matcher.group("yaml");, +                if (yamlRequest != null) {, +                    current.println(yamlRequest), +                    return, +                }, +++ b/docs/README.asciidoc, +In addition to the standard CONSOLE syntax these snippets can contain blocks, +of yaml surrounded by markers like this:, +, +```, +startyaml, +  - compare_analyzers: {index: thai_example, first: thai, second: rebuilt_thai}, +endyaml, +```, +, +This allows slightly more expressive testing of the snippets. Since that syntax, +is not supported by CONSOLE the usual way to incorporate it is with a, +`// TEST[s//]` marker like this:, +, +```, +// TEST[s/\n$/\nstartyaml\n  - compare_analyzers: {index: thai_example, first: thai, second: rebuilt_thai}\nendyaml\n/], +```, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            String badBody = /GET|PUT|POST|HEAD|OPTIONS|DELETE|startyaml|#/, +            String rawRequest = /(?:$method\s+$pathAndQuery$body?)/, +            String yamlRequest = /(?:startyaml(?s)(?<yaml>.+?)(?-s)endyaml)/, +            String nonComment = /(?:$rawRequest|$yamlRequest)/, +                String yamlRequest = matcher.group("yaml");, +                if (yamlRequest != null) {, +                    current.println(yamlRequest), +                    return, +                }, +++ b/docs/README.asciidoc, +In addition to the standard CONSOLE syntax these snippets can contain blocks, +of yaml surrounded by markers like this:, +, +```, +startyaml, +  - compare_analyzers: {index: thai_example, first: thai, second: rebuilt_thai}, +endyaml, +```, +, +This allows slightly more expressive testing of the snippets. Since that syntax, +is not supported by CONSOLE the usual way to incorporate it is with a, +`// TEST[s//]` marker like this:, +, +```, +// TEST[s/\n$/\nstartyaml\n  - compare_analyzers: {index: thai_example, first: thai, second: rebuilt_thai}\nendyaml\n/], +```, +, +++ b/docs/build.gradle, +  // Just syntax examples, +  exclude 'README.asciidoc', +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            String badBody = /GET|PUT|POST|HEAD|OPTIONS|DELETE|startyaml|#/, +            String rawRequest = /(?:$method\s+$pathAndQuery$body?)/, +            String yamlRequest = /(?:startyaml(?s)(?<yaml>.+?)(?-s)endyaml)/, +            String nonComment = /(?:$rawRequest|$yamlRequest)/, +                String yamlRequest = matcher.group("yaml");, +                if (yamlRequest != null) {, +                    current.println(yamlRequest), +                    return, +                }, +++ b/docs/README.asciidoc, +In addition to the standard CONSOLE syntax these snippets can contain blocks, +of yaml surrounded by markers like this:, +, +```, +startyaml, +  - compare_analyzers: {index: thai_example, first: thai, second: rebuilt_thai}, +endyaml, +```, +, +This allows slightly more expressive testing of the snippets. Since that syntax, +is not supported by CONSOLE the usual way to incorporate it is with a, +`// TEST[s//]` marker like this:, +, +```, +// TEST[s/\n$/\nstartyaml\n  - compare_analyzers: {index: thai_example, first: thai, second: rebuilt_thai}\nendyaml\n/], +```, +, +++ b/docs/build.gradle, +  // Just syntax examples, +  exclude 'README.asciidoc']