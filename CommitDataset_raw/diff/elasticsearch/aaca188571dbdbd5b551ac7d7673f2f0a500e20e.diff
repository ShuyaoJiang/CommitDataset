[+++ b/dev-tools/prepare_release_candidate.py, +# Note: Ensure the script is run from the elasticsearch top level directory, +VERBOSE=True, +def run(command, env_vars=None, verbose=VERBOSE):, +  if not verbose:, +    command = '%s >> /dev/null 2>&1' % (command), +  if os.system(command):, +  parser.add_argument('--verbose', '-b', dest='verbose',, +                      help='Runs the script in verbose mode'), +  parser.set_defaults(verbose=False), +  VERBOSE = args.verbose, +++ b/dev-tools/prepare_release_candidate.py, +# Note: Ensure the script is run from the elasticsearch top level directory, +VERBOSE=True, +def run(command, env_vars=None, verbose=VERBOSE):, +  if not verbose:, +    command = '%s >> /dev/null 2>&1' % (command), +  if os.system(command):, +  parser.add_argument('--verbose', '-b', dest='verbose',, +                      help='Runs the script in verbose mode'), +  parser.set_defaults(verbose=False), +  VERBOSE = args.verbose, +++ b/dev-tools/smoke_test_rc.py, +# Licensed to Elasticsearch under one or more contributor, +# license agreements. See the NOTICE file distributed with, +# this work for additional information regarding copyright, +# ownership. Elasticsearch licenses this file to you under, +# the Apache License, Version 2.0 (the "License"); you may, +# not use this file except in compliance  with the License., +# You may obtain a copy of the License at, +#, +#     http://www.apache.org/licenses/LICENSE-2.0, +#, +# Unless required by applicable law or agreed to in writing,, +# software distributed under the License is distributed on, +# an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,, +# either express or implied. See the License for the specific, +# language governing permissions and limitations under the License., +, +# Smoke-tests a release candidate, +#, +# 1. Downloads the tar.gz, deb, RPM and zip file from the staging URL, +# 2. Verifies it's sha1 hashes and GPG signatures against the release key, +# 3. Installs all official plugins, +# 4. Starts one node for tar.gz and zip packages and checks:, +#    -- if it runs with Java 1.7, +#    -- if the build hash given is the one that is returned by the status response, +#    -- if the build is a release version and not a snapshot version, +#    -- if all plugins are loaded, +#    -- if the status response returns the correct version, +#, +# USAGE:, +#, +# python3 -B ./dev-tools/smoke_tests_rc.py --version 2.0.0-beta1 --hash bfa3e47, +#, +# to also test other plugins try run, +#, +# python3 -B ./dev-tools/smoke_tests_rc.py --version 2.0.0-beta1 --hash bfa3e47 --plugins license,shield,watcher, +#, +# Note: Ensure the script is run from the elasticsearch top level directory, +#, +, +import argparse, +import tempfile, +import os, +import signal, +import shutil, +import urllib, +import urllib.request, +import hashlib, +import time, +import socket, +import json, +import base64, +, +from prepare_release_candidate import run, +from http.client import HTTPConnection, +, +DEFAULT_PLUGINS = ["analysis-icu",, +                   "analysis-kuromoji",, +                   "analysis-phonetic",, +                   "analysis-smartcn",, +                   "analysis-stempel",, +                   "cloud-aws",, +                   "cloud-azure",, +                   "cloud-gce",, +                   "delete-by-query",, +                   "discovery-multicast",, +                   "lang-javascript",, +                   "lang-python",, +                   "mapper-murmur3",, +                   "mapper-size"], +, +try:, +  JAVA_HOME = os.environ['JAVA_HOME'], +except KeyError:, +  raise RuntimeError(""", +  Please set JAVA_HOME in the env before running release tool, +  On OSX use: export JAVA_HOME=`/usr/libexec/java_home -v '1.7*'`"""), +]