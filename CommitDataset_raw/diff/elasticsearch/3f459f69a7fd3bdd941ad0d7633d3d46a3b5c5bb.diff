[+++ b/src/test/java/org/elasticsearch/index/mapper/dynamic/DynamicMappingTests.java, +import org.elasticsearch.index.mapper.*;, +        // we have to wait here because the cluster state might not be immediately updated, +        assertTrue(awaitBusy(new Predicate<Object>() {, +            @Override, +            public boolean apply(java.lang.Object input) {, +                GetMappingsResponse getMappingsResponse = client().admin().indices().prepareGetMappings("test").get();, +                return getMappingsResponse.getMappings().get("test").get("doc") != null;, +            }, +        }));, +        assertTrue(awaitBusy(new Predicate<Object>() {, +            @Override, +            public boolean apply(java.lang.Object input) {, +                GetMappingsResponse getMappingsResponse = client().admin().indices().prepareGetMappings("test").get();, +                Map<String, Object> mappings = null;, +                try {, +                    mappings = getMappingsResponse.getMappings().get("test").get("doc").getSourceAsMap();, +                } catch (IOException e) {, +                    fail("IOException when calling getSourceAsMap()" + e.getMessage());, +                }, +                return ((LinkedHashMap) mappings.get("properties")).get("a") != null && ((LinkedHashMap) mappings.get("properties")).get("z") != null;, +            }, +        }));]