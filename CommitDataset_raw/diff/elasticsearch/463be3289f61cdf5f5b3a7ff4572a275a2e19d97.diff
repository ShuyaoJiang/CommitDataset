[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/dataframe/DataFrameField.java, +    /**, +     * Parameter to indicate whether we are serialising to X Content for internal storage. Default the field is invisible (e.g. for get, +     * API's), +     */, +    public static final String FOR_INTERNAL_STORAGE = "for_internal_storage";, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/dataframe/DataFrameField.java, +    /**, +     * Parameter to indicate whether we are serialising to X Content for internal storage. Default the field is invisible (e.g. for get, +     * API's), +     */, +    public static final String FOR_INTERNAL_STORAGE = "for_internal_storage";, +, +++ b/x-pack/plugin/data-frame/src/main/java/org/elasticsearch/xpack/dataframe/action/TransportPutDataFrameTransformAction.java, +import org.elasticsearch.xpack.core.ClientHelper;, +import org.elasticsearch.xpack.dataframe.transforms.DataFrameTransformConfig;, +import java.util.Map;, +import java.util.stream.Collectors;, +, +        // set headers to run data frame transform as calling user, +        Map<String, String> filteredHeaders = threadPool.getThreadContext().getHeaders().entrySet().stream(), +                    .filter(e -> ClientHelper.SECURITY_HEADER_FILTERS.contains(e.getKey())), +                    .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));, +, +        DataFrameTransformConfig config = request.getConfig();, +        config.setHeaders(filteredHeaders);, +, +        String transformId = config.getId();, +        Pivot pivot = new Pivot(config.getSource(), new MatchAllQueryBuilder(), config.getPivotConfig());, +                DataframeIndex.createDestinationIndex(client, config, mappings, ActionListener.wrap(createIndexResult -> {, +                    dataFrameTransformsConfigManager.putTransformConfiguration(config, ActionListener.wrap(r -> {, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/dataframe/DataFrameField.java, +    /**, +     * Parameter to indicate whether we are serialising to X Content for internal storage. Default the field is invisible (e.g. for get, +     * API's), +     */, +    public static final String FOR_INTERNAL_STORAGE = "for_internal_storage";, +, +++ b/x-pack/plugin/data-frame/src/main/java/org/elasticsearch/xpack/dataframe/action/TransportPutDataFrameTransformAction.java, +import org.elasticsearch.xpack.core.ClientHelper;, +import org.elasticsearch.xpack.dataframe.transforms.DataFrameTransformConfig;, +import java.util.Map;, +import java.util.stream.Collectors;, +, +        // set headers to run data frame transform as calling user, +        Map<String, String> filteredHeaders = threadPool.getThreadContext().getHeaders().entrySet().stream(), +                    .filter(e -> ClientHelper.SECURITY_HEADER_FILTERS.contains(e.getKey())), +                    .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));, +, +        DataFrameTransformConfig config = request.getConfig();, +        config.setHeaders(filteredHeaders);, +, +        String transformId = config.getId();, +        Pivot pivot = new Pivot(config.getSource(), new MatchAllQueryBuilder(), config.getPivotConfig());, +                DataframeIndex.createDestinationIndex(client, config, mappings, ActionListener.wrap(createIndexResult -> {, +                    dataFrameTransformsConfigManager.putTransformConfiguration(config, ActionListener.wrap(r -> {, +++ b/x-pack/plugin/data-frame/src/main/java/org/elasticsearch/xpack/dataframe/persistence/DataFrameTransformsConfigManager.java, +import org.elasticsearch.xpack.core.dataframe.DataFrameField;, +    public static final Map<String, String> TO_XCONTENT_PARAMS = Collections.singletonMap(DataFrameField.FOR_INTERNAL_STORAGE, "true");, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/dataframe/DataFrameField.java, +    /**, +     * Parameter to indicate whether we are serialising to X Content for internal storage. Default the field is invisible (e.g. for get, +     * API's), +     */, +    public static final String FOR_INTERNAL_STORAGE = "for_internal_storage";, +, +++ b/x-pack/plugin/data-frame/src/main/java/org/elasticsearch/xpack/dataframe/action/TransportPutDataFrameTransformAction.java, +import org.elasticsearch.xpack.core.ClientHelper;, +import org.elasticsearch.xpack.dataframe.transforms.DataFrameTransformConfig;, +import java.util.Map;, +import java.util.stream.Collectors;, +, +        // set headers to run data frame transform as calling user, +        Map<String, String> filteredHeaders = threadPool.getThreadContext().getHeaders().entrySet().stream(), +                    .filter(e -> ClientHelper.SECURITY_HEADER_FILTERS.contains(e.getKey())), +                    .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));, +, +        DataFrameTransformConfig config = request.getConfig();, +        config.setHeaders(filteredHeaders);, +, +        String transformId = config.getId();, +        Pivot pivot = new Pivot(config.getSource(), new MatchAllQueryBuilder(), config.getPivotConfig());, +                DataframeIndex.createDestinationIndex(client, config, mappings, ActionListener.wrap(createIndexResult -> {, +                    dataFrameTransformsConfigManager.putTransformConfiguration(config, ActionListener.wrap(r -> {, +++ b/x-pack/plugin/data-frame/src/main/java/org/elasticsearch/xpack/dataframe/persistence/DataFrameTransformsConfigManager.java, +import org.elasticsearch.xpack.core.dataframe.DataFrameField;, +    public static final Map<String, String> TO_XCONTENT_PARAMS = Collections.singletonMap(DataFrameField.FOR_INTERNAL_STORAGE, "true");, +++ b/x-pack/plugin/data-frame/src/main/java/org/elasticsearch/xpack/dataframe/transforms/DataFrameTransform.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/dataframe/DataFrameField.java, +    /**, +     * Parameter to indicate whether we are serialising to X Content for internal storage. Default the field is invisible (e.g. for get, +     * API's), +     */, +    public static final String FOR_INTERNAL_STORAGE = "for_internal_storage";, +, +++ b/x-pack/plugin/data-frame/src/main/java/org/elasticsearch/xpack/dataframe/action/TransportPutDataFrameTransformAction.java, +import org.elasticsearch.xpack.core.ClientHelper;, +import org.elasticsearch.xpack.dataframe.transforms.DataFrameTransformConfig;, +import java.util.Map;]