[+++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +import org.elasticsearch.script.ScriptParameterParser;, +import org.elasticsearch.script.ScriptParameterParser.ScriptParameterValue;, +        ScriptParameterParser scriptParameterParser = new ScriptParameterParser();, +                } else {, +                    scriptParameterParser.token(currentFieldName, token, parser);, +            ScriptParameterValue scriptValue = scriptParameterParser.getDefaultScriptParameterValue();, +            if (scriptValue != null) {, +                script = scriptValue.script();, +                scriptType = scriptValue.scriptType();, +            }, +            scriptLang = scriptParameterParser.lang();, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +import org.elasticsearch.script.ScriptParameterParser;, +import org.elasticsearch.script.ScriptParameterParser.ScriptParameterValue;, +        ScriptParameterParser scriptParameterParser = new ScriptParameterParser();, +                } else {, +                    scriptParameterParser.token(currentFieldName, token, parser);, +            ScriptParameterValue scriptValue = scriptParameterParser.getDefaultScriptParameterValue();, +            if (scriptValue != null) {, +                script = scriptValue.script();, +                scriptType = scriptValue.scriptType();, +            }, +            scriptLang = scriptParameterParser.lang();, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +import org.elasticsearch.script.ScriptParameterParser;, +import org.elasticsearch.script.ScriptParameterParser.ScriptParameterValue;, +        ScriptParameterParser scriptParameterParser = new ScriptParameterParser();, +        scriptParameterParser.parseConfig(transformConfig, true);, +        , +        String script = null;, +        ScriptType scriptType = null;, +        ScriptParameterValue scriptValue = scriptParameterParser.getDefaultScriptParameterValue();, +        if (scriptValue != null) {, +            script = scriptValue.script();, +            scriptType = scriptValue.scriptType();, +        , +            String scriptLang = scriptParameterParser.lang();, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +import org.elasticsearch.script.ScriptParameterParser;, +import org.elasticsearch.script.ScriptParameterParser.ScriptParameterValue;, +        ScriptParameterParser scriptParameterParser = new ScriptParameterParser();, +                } else {, +                    scriptParameterParser.token(currentFieldName, token, parser);, +            ScriptParameterValue scriptValue = scriptParameterParser.getDefaultScriptParameterValue();, +            if (scriptValue != null) {, +                script = scriptValue.script();, +                scriptType = scriptValue.scriptType();, +            }, +            scriptLang = scriptParameterParser.lang();, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +import org.elasticsearch.script.ScriptParameterParser;, +import org.elasticsearch.script.ScriptParameterParser.ScriptParameterValue;, +        ScriptParameterParser scriptParameterParser = new ScriptParameterParser();, +        scriptParameterParser.parseConfig(transformConfig, true);, +        , +        String script = null;, +        ScriptType scriptType = null;, +        ScriptParameterValue scriptValue = scriptParameterParser.getDefaultScriptParameterValue();, +        if (scriptValue != null) {, +            script = scriptValue.script();, +            scriptType = scriptValue.scriptType();, +        , +            String scriptLang = scriptParameterParser.lang();, +++ b/src/main/java/org/elasticsearch/index/query/ScriptFilterParser.java, +import org.elasticsearch.script.ScriptParameterParser;, +import org.elasticsearch.script.ScriptParameterParser.ScriptParameterValue;, +        ScriptParameterParser scriptParameterParser = new ScriptParameterParser();, +                if ("_name".equals(currentFieldName)) {, +                } else if (!scriptParameterParser.token(currentFieldName, token, parser)){, +        ScriptParameterValue scriptValue = scriptParameterParser.getDefaultScriptParameterValue();, +        if (scriptValue != null) {, +            script = scriptValue.script();, +            scriptType = scriptValue.scriptType();, +        }, +        scriptLang = scriptParameterParser.lang();, +, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +import org.elasticsearch.script.ScriptParameterParser;, +import org.elasticsearch.script.ScriptParameterParser.ScriptParameterValue;, +        ScriptParameterParser scriptParameterParser = new ScriptParameterParser();, +                } else {, +                    scriptParameterParser.token(currentFieldName, token, parser);, +            ScriptParameterValue scriptValue = scriptParameterParser.getDefaultScriptParameterValue();, +            if (scriptValue != null) {, +                script = scriptValue.script();, +                scriptType = scriptValue.scriptType();, +            }, +            scriptLang = scriptParameterParser.lang();, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +import org.elasticsearch.script.ScriptParameterParser;, +import org.elasticsearch.script.ScriptParameterParser.ScriptParameterValue;, +        ScriptParameterParser scriptParameterParser = new ScriptParameterParser();, +        scriptParameterParser.parseConfig(transformConfig, true);, +        , +        String script = null;, +        ScriptType scriptType = null;, +        ScriptParameterValue scriptValue = scriptParameterParser.getDefaultScriptParameterValue();, +        if (scriptValue != null) {, +            script = scriptValue.script();]