[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/annotations/AnnotationIndex.java, +     * Create the .ml-annotations index with correct mappings if it does not already, +     * exist. This index is read and written by the UI results views, so needs to, +     * exist when there might be ML results to view., +    public static void createAnnotationsIndexIfNecessary(Settings settings, Client client, ClusterState state,, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/annotations/AnnotationIndex.java, +     * Create the .ml-annotations index with correct mappings if it does not already, +     * exist. This index is read and written by the UI results views, so needs to, +     * exist when there might be ML results to view., +    public static void createAnnotationsIndexIfNecessary(Settings settings, Client client, ClusterState state,, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MlInitializationService.java, +import java.util.concurrent.atomic.AtomicBoolean;, +, +    private final AtomicBoolean isIndexCreationInProgress = new AtomicBoolean(false);, +        // The atomic flag prevents multiple simultaneous attempts to create the, +        // index if there is a flurry of cluster state updates in quick succession, +        if (event.localNodeMaster() && isIndexCreationInProgress.compareAndSet(false, true)) {, +            AnnotationIndex.createAnnotationsIndexIfNecessary(settings, client, event.state(), ActionListener.wrap(, +                    isIndexCreationInProgress.set(false);, +                e -> {, +                    isIndexCreationInProgress.set(false);, +                    logger.error("Error creating ML annotations index or aliases", e);, +                }));]