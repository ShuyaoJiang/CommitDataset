[+++ b/README.md, +Changing default transport port, +-------------------------------, +, +By default, elasticsearch GCE plugin assumes that you run elasticsearch on 9300 default port., +But you can specify the port value elasticsearch is meant to use using google compute engine metadata `es_port`:, +, +### When creating instance, +, +Add `--metadata=es_port:9301` option:, +, +```sh, +# when creating first instance, +gcutil --project=es-cloud addinstance myesnode1 --service_account_scope=compute-rw,storage-full --persistent_boot_disk --metadata=es_port:9301, +, +# when creating an instance from an image, +gcutil --project=es-cloud addinstance --image=elasticsearch-0-90-2 \, +       --kernel=projects/google/global/kernels/gce-v20130603 myesnode2 \, +       --zone europe-west1-a --machine_type f1-micro --service_account_scope=compute-rw \, +       --persistent_boot_disk --metadata=es_port:9301, +```, +, +### On a running instance, +, +```sh, +# Get metadata fingerprint, +gcutil --project=es-cloud getinstance myesnode1 --zone=europe-west1-a, ++------------------------+---------------------------------------------------------------------------------------------------------+, +|        property        |                                                  value                                                  |, ++------------------------+---------------------------------------------------------------------------------------------------------+, +| metadata               |                                                                                                         |, +| fingerprint            | 42WmSpB8rSM=                                                                                            |, ++------------------------+---------------------------------------------------------------------------------------------------------+, +, +# Use that fingerprint, +gcutil --project=es-cloud setinstancemetadata myesnode1 --zone=europe-west1-a --metadata=es_port:9301 --fingerprint=42WmSpB8rSM=, +```, +, +, +++ b/README.md, +Changing default transport port, +-------------------------------, +, +By default, elasticsearch GCE plugin assumes that you run elasticsearch on 9300 default port., +But you can specify the port value elasticsearch is meant to use using google compute engine metadata `es_port`:, +, +### When creating instance, +, +Add `--metadata=es_port:9301` option:, +, +```sh, +# when creating first instance, +gcutil --project=es-cloud addinstance myesnode1 --service_account_scope=compute-rw,storage-full --persistent_boot_disk --metadata=es_port:9301, +, +# when creating an instance from an image, +gcutil --project=es-cloud addinstance --image=elasticsearch-0-90-2 \, +       --kernel=projects/google/global/kernels/gce-v20130603 myesnode2 \, +       --zone europe-west1-a --machine_type f1-micro --service_account_scope=compute-rw \, +       --persistent_boot_disk --metadata=es_port:9301, +```, +, +### On a running instance, +, +```sh, +# Get metadata fingerprint, +gcutil --project=es-cloud getinstance myesnode1 --zone=europe-west1-a, ++------------------------+---------------------------------------------------------------------------------------------------------+, +|        property        |                                                  value                                                  |, ++------------------------+---------------------------------------------------------------------------------------------------------+, +| metadata               |                                                                                                         |, +| fingerprint            | 42WmSpB8rSM=                                                                                            |, ++------------------------+---------------------------------------------------------------------------------------------------------+, +, +# Use that fingerprint, +gcutil --project=es-cloud setinstancemetadata myesnode1 --zone=europe-west1-a --metadata=es_port:9301 --fingerprint=42WmSpB8rSM=, +```, +, +, +++ b/src/main/java/org/elasticsearch/discovery/gce/GceUnicastHostsProvider.java, +                    logger.trace("filtering out instance {} based tags {}, not part of {}", name, tags,, +                    logger.trace("instance {} with tags {} is added to discovery", name, tags);, +                        String address = ip_private;, +                        // Test if we have es_port metadata defined here, +                        if (instance.getMetadata() != null && instance.getMetadata().containsKey("es_port")) {, +                            Object es_port = instance.getMetadata().get("es_port");, +                            logger.trace("es_port is defined with {}", es_port);, +                            if (es_port instanceof String) {, +                                address = address.concat(":").concat((String) es_port);, +                            } else {, +                                // Ignoring other values, +                                logger.trace("es_port is instance of {}. Ignoring...", es_port.getClass().getName());, +                            }, +                        }, +, +                        // ip_private is a single IP Address. We need to build a TransportAddress from it, +                        TransportAddress[] addresses = transportService.addressesFromString(address);, +, +++ b/README.md, +Changing default transport port, +-------------------------------]