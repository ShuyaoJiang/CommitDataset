[+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/filestructurefinder/TextLogFileStructureFinder.java, +        fieldStats.put("message", FileStructureUtils.calculateFieldStats(sampleMessages, timeoutChecker));, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/filestructurefinder/TextLogFileStructureFinder.java, +        fieldStats.put("message", FileStructureUtils.calculateFieldStats(sampleMessages, timeoutChecker));, +++ b/x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/filestructurefinder/TextLogFileStructureFinderTests.java, +import org.elasticsearch.xpack.core.ml.filestructurefinder.FieldStats;, +import java.util.stream.Collectors;, +, +import static org.hamcrest.Matchers.hasItem;, +import static org.hamcrest.Matchers.not;, +        FieldStats messageFieldStats = structure.getFieldStats().get("message");, +        assertNotNull(messageFieldStats);, +        for (String statMessage : messageFieldStats.getTopHits().stream().map(m -> (String) m.get("value")).collect(Collectors.toList())) {, +            assertThat(structureFinder.getSampleMessages(), hasItem(statMessage));, +        }, +        FieldStats messageFieldStats = structure.getFieldStats().get("message");, +        assertNotNull(messageFieldStats);, +        for (String statMessage : messageFieldStats.getTopHits().stream().map(m -> (String) m.get("value")).collect(Collectors.toList())) {, +            assertThat(structureFinder.getSampleMessages(), hasItem(statMessage));, +        }, +        FieldStats messageFieldStats = structure.getFieldStats().get("message");, +        assertNotNull(messageFieldStats);, +        for (String statMessage : messageFieldStats.getTopHits().stream().map(m -> (String) m.get("value")).collect(Collectors.toList())) {, +            // In this case the "message" field was output by the Grok pattern, so "message", +            // at the end of the processing will _not_ contain a complete sample message, +            assertThat(structureFinder.getSampleMessages(), not(hasItem(statMessage)));, +        }]