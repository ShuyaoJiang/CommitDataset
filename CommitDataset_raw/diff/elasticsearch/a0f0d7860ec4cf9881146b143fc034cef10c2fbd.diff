[+++ b/server/src/main/java/org/elasticsearch/index/shard/GlobalCheckpointListeners.java, +import org.elasticsearch.Assertions;, +        if (closed) {, +            assert listeners.isEmpty() : listeners;, +        }, +        assert Thread.holdsLock(this) : Thread.currentThread();, +        assertNotification(globalCheckpoint, e);, +        assertNotification(globalCheckpoint, e);, +, +    private void assertNotification(final long globalCheckpoint, final Exception e) {, +        if (Assertions.ENABLED) {, +            assert globalCheckpoint >= UNASSIGNED_SEQ_NO : globalCheckpoint;, +            if (globalCheckpoint != UNASSIGNED_SEQ_NO) {, +                assert e == null : e;, +            } else {, +                assert e != null;, +                assert e instanceof IndexShardClosedException || e instanceof TimeoutException : e;, +            }, +        }, +    }, +]