[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/AndFilterParser.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == XContentParser.Token.START_ARRAY) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                filters.add(parseContext.parseInnerFilter());, +            }, +        } else {, +                    } else {, +                        while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                            filters.add(parseContext.parseInnerFilter());, +                        }, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/AndFilterParser.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == XContentParser.Token.START_ARRAY) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                filters.add(parseContext.parseInnerFilter());, +            }, +        } else {, +                    } else {, +                        while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                            filters.add(parseContext.parseInnerFilter());, +                        }, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/OrFilterParser.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == XContentParser.Token.START_ARRAY) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                filters.add(parseContext.parseInnerFilter());, +            }, +        } else {, +                    } else {, +                        while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                            filters.add(parseContext.parseInnerFilter());, +                        }, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/AndFilterParser.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == XContentParser.Token.START_ARRAY) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                filters.add(parseContext.parseInnerFilter());, +            }, +        } else {, +                    } else {, +                        while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                            filters.add(parseContext.parseInnerFilter());, +                        }, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/OrFilterParser.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == XContentParser.Token.START_ARRAY) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                filters.add(parseContext.parseInnerFilter());, +            }, +        } else {, +                    } else {, +                        while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                            filters.add(parseContext.parseInnerFilter());, +                        }, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/QueryParseContext.java, +        assert token == XContentParser.Token.START_OBJECT || token == XContentParser.Token.START_ARRAY;, +        if (parser.currentToken() == XContentParser.Token.END_OBJECT || parser.currentToken() == XContentParser.Token.END_ARRAY) {, +        // move to the next START_OBJECT or START_ARRAY, +        assert token == XContentParser.Token.START_OBJECT || token == XContentParser.Token.START_ARRAY;, +        if (parser.currentToken() == XContentParser.Token.END_OBJECT || parser.currentToken() == XContentParser.Token.END_ARRAY) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/AndFilterParser.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == XContentParser.Token.START_ARRAY) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                filters.add(parseContext.parseInnerFilter());, +            }, +        } else {, +                    } else {, +                        while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                            filters.add(parseContext.parseInnerFilter());, +                        }, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/OrFilterParser.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == XContentParser.Token.START_ARRAY) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                filters.add(parseContext.parseInnerFilter());, +            }, +        } else {, +                    } else {, +                        while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +                            filters.add(parseContext.parseInnerFilter());, +                        }, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/QueryParseContext.java, +        assert token == XContentParser.Token.START_OBJECT || token == XContentParser.Token.START_ARRAY;, +        if (parser.currentToken() == XContentParser.Token.END_OBJECT || parser.currentToken() == XContentParser.Token.END_ARRAY) {, +        // move to the next START_OBJECT or START_ARRAY, +        assert token == XContentParser.Token.START_OBJECT || token == XContentParser.Token.START_ARRAY;, +        if (parser.currentToken() == XContentParser.Token.END_OBJECT || parser.currentToken() == XContentParser.Token.END_ARRAY) {, +++ b/modules/elasticsearch/src/test/java/org/elasticsearch/index/query/xcontent/SimpleIndexQueryParserTests.java, +    @Test public void testAndFilteredQuery2() throws IOException {, +        IndexQueryParser queryParser = newQueryParser();, +        String query = copyToStringFromClasspath("/org/elasticsearch/index/query/xcontent/and-filter2.json");]