[+++ b/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreTests.java, +import org.elasticsearch.action.admin.cluster.snapshots.get.GetSnapshotsResponse;, +, +            // There is slight delay between snapshot being marked as completed in the cluster state and on the file system, +            // After it was marked as completed in the cluster state - we need to check if it's completed on the file system as well, +            awaitBusy(new Predicate<Object>() {, +                @Override, +                public boolean apply(Object o) {, +                    GetSnapshotsResponse response = client().admin().cluster().prepareGetSnapshots("test-repo").setSnapshots("test-snap-2").get();, +                    assertThat(response.getSnapshots().size(), equalTo(1));, +                    SnapshotInfo snapshotInfo = response.getSnapshots().get(0);, +                    if (snapshotInfo.state().completed()) {, +                        assertThat(snapshotInfo.state(), equalTo(SnapshotState.PARTIAL));, +                        return true;, +                    }, +                    return false;, +                }, +            });, +        }]