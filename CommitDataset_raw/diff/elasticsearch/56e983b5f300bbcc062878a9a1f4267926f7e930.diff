[+++ b/elasticsearch/build.gradle, +import com.amazonaws.AmazonServiceException, +import com.amazonaws.ClientConfiguration, +import com.amazonaws.auth.AWSCredentials, +import com.amazonaws.auth.BasicAWSCredentials, +import com.amazonaws.services.s3.AmazonS3Client, +import com.amazonaws.services.s3.model.HeadBucketRequest, +    classpath 'com.amazonaws:aws-java-sdk-s3:1.10.33', +// Retrying 10 times to give AWS a chance to propagate the credentials, +int retries = 60, +while (retries > 0) {, +  AWSCredentials creds = new BasicAWSCredentials(mlAwsAccessKey, mlAwsSecretKey), +, +  ClientConfiguration clientConfiguration = new ClientConfiguration(), +  // the response metadata cache is only there for diagnostics purposes,, +  // but can force objects from every response to the old generation., +  clientConfiguration.setResponseMetadataCacheSize(0), +, +  AmazonS3Client client = new AmazonS3Client(creds, clientConfiguration), +  try {, +    client.headBucket(new HeadBucketRequest('prelert-artifacts')), +    break;, +  } catch (AmazonServiceException e) {, +    if (e.getStatusCode() != 403 || retries == 0) {, +      throw new GradleException('Could not access ml-cpp artifacts. Timed out after 60 attempts', e), +    }, +  }, +  sleep(500), +  retries--, +}, +, +]