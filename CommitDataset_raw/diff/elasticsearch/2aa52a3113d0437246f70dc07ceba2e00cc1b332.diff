[+++ b/src/main/java/org/elasticsearch/shield/authc/InternalAuthenticationService.java, +        AuthenticationToken token = (AuthenticationToken) message.getContext().get(TOKEN_CTX_KEY);, +                message.putInContext(TOKEN_CTX_KEY, token);, +        message.putInContext(TOKEN_CTX_KEY, defaultToken);, +        User user = (User) message.getContext().get(USER_CTX_KEY);, +                    message.putInContext(USER_CTX_KEY, user);, +++ b/src/main/java/org/elasticsearch/shield/authc/InternalAuthenticationService.java, +        AuthenticationToken token = (AuthenticationToken) message.getContext().get(TOKEN_CTX_KEY);, +                message.putInContext(TOKEN_CTX_KEY, token);, +        message.putInContext(TOKEN_CTX_KEY, defaultToken);, +        User user = (User) message.getContext().get(USER_CTX_KEY);, +                    message.putInContext(USER_CTX_KEY, user);, +++ b/src/main/java/org/elasticsearch/shield/authc/support/UsernamePasswordToken.java, +        UsernamePasswordToken token = (UsernamePasswordToken) message.getContext().get(TOKEN_KEY);, +            message.putInContext(TOKEN_KEY, defaultToken);, +        message.putInContext(TOKEN_KEY, token);, +++ b/src/main/java/org/elasticsearch/shield/authc/InternalAuthenticationService.java, +        AuthenticationToken token = (AuthenticationToken) message.getContext().get(TOKEN_CTX_KEY);, +                message.putInContext(TOKEN_CTX_KEY, token);, +        message.putInContext(TOKEN_CTX_KEY, defaultToken);, +        User user = (User) message.getContext().get(USER_CTX_KEY);, +                    message.putInContext(USER_CTX_KEY, user);, +++ b/src/main/java/org/elasticsearch/shield/authc/support/UsernamePasswordToken.java, +        UsernamePasswordToken token = (UsernamePasswordToken) message.getContext().get(TOKEN_KEY);, +            message.putInContext(TOKEN_KEY, defaultToken);, +        message.putInContext(TOKEN_KEY, token);, +++ b/src/test/java/org/elasticsearch/shield/authc/InternalAuthenticationServiceTests.java, +        assertThat(message.getContext().get(InternalAuthenticationService.TOKEN_CTX_KEY), nullValue());, +        assertThat(message.getContext().get(InternalAuthenticationService.TOKEN_CTX_KEY), nullValue());, +        assertThat(message.getContext().get(InternalAuthenticationService.TOKEN_CTX_KEY), notNullValue());, +        assertThat(message.getContext().get(InternalAuthenticationService.TOKEN_CTX_KEY), is((Object) token));, +        message.putInContext(InternalAuthenticationService.TOKEN_CTX_KEY, token);, +        assertThat(message.getContext().get(InternalAuthenticationService.TOKEN_CTX_KEY), notNullValue());, +        assertThat(message.getContext().get(InternalAuthenticationService.TOKEN_CTX_KEY), is((Object) token));, +        assertThat(message.getContext().get(InternalAuthenticationService.USER_CTX_KEY), notNullValue());, +        assertThat(message.getContext().get(InternalAuthenticationService.USER_CTX_KEY), is((Object) user));, +        assertThat(message.getContext().get(InternalAuthenticationService.USER_CTX_KEY), notNullValue());, +        assertThat(message.getContext().get(InternalAuthenticationService.USER_CTX_KEY), is((Object) user));, +        message.putInContext(InternalAuthenticationService.USER_CTX_KEY, user);, +        assertThat(message.getContext().get(InternalAuthenticationService.USER_CTX_KEY), notNullValue());, +        assertThat(message.getContext().get(InternalAuthenticationService.USER_CTX_KEY), is((Object) user));]