[+++ b/plugins/examples/script-expert-scoring/src/main/java/org/elasticsearch/example/expertscript/ExpertScriptPlugin.java, +            if (context.equals(SearchScript.SCRIPT_SCORE_CONTEXT) == false) {, +++ b/plugins/examples/script-expert-scoring/src/main/java/org/elasticsearch/example/expertscript/ExpertScriptPlugin.java, +            if (context.equals(SearchScript.SCRIPT_SCORE_CONTEXT) == false) {, +++ b/server/src/main/java/org/elasticsearch/index/query/TermsSetQueryBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(minimumShouldMatchScript,, +                SearchScript.TERMS_SET_QUERY_CONTEXT);, +++ b/plugins/examples/script-expert-scoring/src/main/java/org/elasticsearch/example/expertscript/ExpertScriptPlugin.java, +            if (context.equals(SearchScript.SCRIPT_SCORE_CONTEXT) == false) {, +++ b/server/src/main/java/org/elasticsearch/index/query/TermsSetQueryBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(minimumShouldMatchScript,, +                SearchScript.TERMS_SET_QUERY_CONTEXT);, +++ b/server/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(script, SearchScript.SCRIPT_SCORE_CONTEXT);, +++ b/plugins/examples/script-expert-scoring/src/main/java/org/elasticsearch/example/expertscript/ExpertScriptPlugin.java, +            if (context.equals(SearchScript.SCRIPT_SCORE_CONTEXT) == false) {, +++ b/server/src/main/java/org/elasticsearch/index/query/TermsSetQueryBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(minimumShouldMatchScript,, +                SearchScript.TERMS_SET_QUERY_CONTEXT);, +++ b/server/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(script, SearchScript.SCRIPT_SCORE_CONTEXT);, +++ b/server/src/main/java/org/elasticsearch/script/ScriptModule.java, +            SearchScript.SCRIPT_SCORE_CONTEXT,, +            SearchScript.SCRIPT_SORT_CONTEXT,, +            SearchScript.TERMS_SET_QUERY_CONTEXT,, +++ b/plugins/examples/script-expert-scoring/src/main/java/org/elasticsearch/example/expertscript/ExpertScriptPlugin.java, +            if (context.equals(SearchScript.SCRIPT_SCORE_CONTEXT) == false) {, +++ b/server/src/main/java/org/elasticsearch/index/query/TermsSetQueryBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(minimumShouldMatchScript,, +                SearchScript.TERMS_SET_QUERY_CONTEXT);, +++ b/server/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(script, SearchScript.SCRIPT_SCORE_CONTEXT);, +++ b/server/src/main/java/org/elasticsearch/script/ScriptModule.java, +            SearchScript.SCRIPT_SCORE_CONTEXT,, +            SearchScript.SCRIPT_SORT_CONTEXT,, +            SearchScript.TERMS_SET_QUERY_CONTEXT,, +++ b/server/src/main/java/org/elasticsearch/script/SearchScript.java, +    // TODO: remove these contexts when it has its own interface, +    // Can return a double. (For ScriptSortType#NUMBER only, for ScriptSortType#STRING normal CONTEXT should be used), +    public static final ScriptContext<Factory> SCRIPT_SORT_CONTEXT = new ScriptContext<>("sort", Factory.class);, +    // Can return a float, +    public static final ScriptContext<Factory> SCRIPT_SCORE_CONTEXT = new ScriptContext<>("score", Factory.class);, +    // Can return a long, +    public static final ScriptContext<Factory> TERMS_SET_QUERY_CONTEXT = new ScriptContext<>("terms_set", Factory.class);, +++ b/plugins/examples/script-expert-scoring/src/main/java/org/elasticsearch/example/expertscript/ExpertScriptPlugin.java, +            if (context.equals(SearchScript.SCRIPT_SCORE_CONTEXT) == false) {, +++ b/server/src/main/java/org/elasticsearch/index/query/TermsSetQueryBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(minimumShouldMatchScript,, +                SearchScript.TERMS_SET_QUERY_CONTEXT);, +++ b/server/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(script, SearchScript.SCRIPT_SCORE_CONTEXT);, +++ b/server/src/main/java/org/elasticsearch/script/ScriptModule.java, +            SearchScript.SCRIPT_SCORE_CONTEXT,, +            SearchScript.SCRIPT_SORT_CONTEXT,, +            SearchScript.TERMS_SET_QUERY_CONTEXT,, +++ b/server/src/main/java/org/elasticsearch/script/SearchScript.java, +    // TODO: remove these contexts when it has its own interface, +    // Can return a double. (For ScriptSortType#NUMBER only, for ScriptSortType#STRING normal CONTEXT should be used), +    public static final ScriptContext<Factory> SCRIPT_SORT_CONTEXT = new ScriptContext<>("sort", Factory.class);, +    // Can return a float, +    public static final ScriptContext<Factory> SCRIPT_SCORE_CONTEXT = new ScriptContext<>("score", Factory.class);, +    // Can return a long, +    public static final ScriptContext<Factory> TERMS_SET_QUERY_CONTEXT = new ScriptContext<>("terms_set", Factory.class);, +++ b/server/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java, +        final SearchScript.Factory factory = context.getScriptService().compile(script, SearchScript.SCRIPT_SORT_CONTEXT);, +++ b/plugins/examples/script-expert-scoring/src/main/java/org/elasticsearch/example/expertscript/ExpertScriptPlugin.java, +            if (context.equals(SearchScript.SCRIPT_SCORE_CONTEXT) == false) {, +++ b/server/src/main/java/org/elasticsearch/index/query/TermsSetQueryBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(minimumShouldMatchScript,, +                SearchScript.TERMS_SET_QUERY_CONTEXT);, +++ b/server/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +            SearchScript.Factory factory = context.getScriptService().compile(script, SearchScript.SCRIPT_SCORE_CONTEXT);, +++ b/server/src/main/java/org/elasticsearch/script/ScriptModule.java, +            SearchScript.SCRIPT_SCORE_CONTEXT,, +            SearchScript.SCRIPT_SORT_CONTEXT,, +            SearchScript.TERMS_SET_QUERY_CONTEXT,, +++ b/server/src/main/java/org/elasticsearch/script/SearchScript.java, +    // TODO: remove these contexts when it has its own interface, +    // Can return a double. (For ScriptSortType#NUMBER only, for ScriptSortType#STRING normal CONTEXT should be used), +    public static final ScriptContext<Factory> SCRIPT_SORT_CONTEXT = new ScriptContext<>("sort", Factory.class);, +    // Can return a float, +    public static final ScriptContext<Factory> SCRIPT_SCORE_CONTEXT = new ScriptContext<>("score", Factory.class);, +    // Can return a long, +    public static final ScriptContext<Factory> TERMS_SET_QUERY_CONTEXT = new ScriptContext<>("terms_set", Factory.class);, +++ b/server/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java, +        final SearchScript.Factory factory = context.getScriptService().compile(script, SearchScript.SCRIPT_SORT_CONTEXT);, +++ b/server/src/test/java/org/elasticsearch/search/functionscore/ExplainableScriptIT.java, +                    assert context == SearchScript.SCRIPT_SCORE_CONTEXT;]