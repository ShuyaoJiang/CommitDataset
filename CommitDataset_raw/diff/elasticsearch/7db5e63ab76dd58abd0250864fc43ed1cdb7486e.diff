[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/replication/TransportShardReplicationPingAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, ShardReplicationPingRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/replication/TransportShardReplicationPingAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, ShardReplicationPingRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardRouting nextShardOrNull(ShardIterator shardIt) {, +    @Override protected boolean hasNextShard(ShardIterator shardIt) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/replication/TransportShardReplicationPingAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, ShardReplicationPingRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardRouting nextShardOrNull(ShardIterator shardIt) {, +    @Override protected boolean hasNextShard(ShardIterator shardIt) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +                    for (ShardIterator shardIt : groupShards) {, +                        List<BulkItemRequest> list = requestsByShard.get(shardIt.shardId());, +                            requestsByShard.put(shardIt.shardId(), list);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/replication/TransportShardReplicationPingAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, ShardReplicationPingRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardRouting nextShardOrNull(ShardIterator shardIt) {, +    @Override protected boolean hasNextShard(ShardIterator shardIt) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +                    for (ShardIterator shardIt : groupShards) {, +                        List<BulkItemRequest> list = requestsByShard.get(shardIt.shardId());, +                            requestsByShard.put(shardIt.shardId(), list);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, BulkShardRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/replication/TransportShardReplicationPingAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, ShardReplicationPingRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardRouting nextShardOrNull(ShardIterator shardIt) {, +    @Override protected boolean hasNextShard(ShardIterator shardIt) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +                    for (ShardIterator shardIt : groupShards) {, +                        List<BulkItemRequest> list = requestsByShard.get(shardIt.shardId());, +                            requestsByShard.put(shardIt.shardId(), list);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, BulkShardRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, DeleteRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/replication/TransportShardReplicationPingAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, ShardReplicationPingRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardRouting nextShardOrNull(ShardIterator shardIt) {, +    @Override protected boolean hasNextShard(ShardIterator shardIt) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +                    for (ShardIterator shardIt : groupShards) {, +                        List<BulkItemRequest> list = requestsByShard.get(shardIt.shardId());, +                            requestsByShard.put(shardIt.shardId(), list);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, BulkShardRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, DeleteRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/delete/index/TransportShardDeleteAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, ShardDeleteRequest request) {, +        for (ShardIterator shardIt : group) {, +            if (shardIt.shardId().id() == request.shardId()) {, +                return shardIt;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/replication/TransportShardReplicationPingAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, ShardReplicationPingRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardRouting nextShardOrNull(ShardIterator shardIt) {, +    @Override protected boolean hasNextShard(ShardIterator shardIt) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +                    for (ShardIterator shardIt : groupShards) {, +                        List<BulkItemRequest> list = requestsByShard.get(shardIt.shardId());, +                            requestsByShard.put(shardIt.shardId(), list);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, BulkShardRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, DeleteRequest request) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/delete/index/TransportShardDeleteAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +    @Override protected ShardIterator shards(ClusterState clusterState, ShardDeleteRequest request) {]