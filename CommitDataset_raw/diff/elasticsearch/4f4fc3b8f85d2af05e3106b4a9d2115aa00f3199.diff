[+++ b/docs/reference/ccr/apis/follow/get-follow-stats.asciidoc, +`indices[].shards[].follower_settings_version`::, +  (long) the index settings version the follower is synced up to, +, +          "follower_settings_version" : 2,, +// TESTRESPONSE[s/"follower_settings_version" : 2/"follower_settings_version" : $body.indices.0.shards.0.follower_settings_version/], +++ b/docs/reference/ccr/apis/follow/get-follow-stats.asciidoc, +`indices[].shards[].follower_settings_version`::, +  (long) the index settings version the follower is synced up to, +, +          "follower_settings_version" : 2,, +// TESTRESPONSE[s/"follower_settings_version" : 2/"follower_settings_version" : $body.indices.0.shards.0.follower_settings_version/], +++ b/server/src/main/java/org/elasticsearch/node/Node.java, +                .map(p -> p.getPersistentTasksExecutor(clusterService, threadPool, client, settingsModule)), +++ b/docs/reference/ccr/apis/follow/get-follow-stats.asciidoc, +`indices[].shards[].follower_settings_version`::, +  (long) the index settings version the follower is synced up to, +, +          "follower_settings_version" : 2,, +// TESTRESPONSE[s/"follower_settings_version" : 2/"follower_settings_version" : $body.indices.0.shards.0.follower_settings_version/], +++ b/server/src/main/java/org/elasticsearch/node/Node.java, +                .map(p -> p.getPersistentTasksExecutor(clusterService, threadPool, client, settingsModule)), +++ b/server/src/main/java/org/elasticsearch/plugins/PersistentTaskPlugin.java, +import org.elasticsearch.common.settings.SettingsModule;, +                                                                        ThreadPool threadPool,, +                                                                        Client client,, +                                                                        SettingsModule settingsModule) {, +++ b/docs/reference/ccr/apis/follow/get-follow-stats.asciidoc, +`indices[].shards[].follower_settings_version`::, +  (long) the index settings version the follower is synced up to, +, +          "follower_settings_version" : 2,, +// TESTRESPONSE[s/"follower_settings_version" : 2/"follower_settings_version" : $body.indices.0.shards.0.follower_settings_version/], +++ b/server/src/main/java/org/elasticsearch/node/Node.java, +                .map(p -> p.getPersistentTasksExecutor(clusterService, threadPool, client, settingsModule)), +++ b/server/src/main/java/org/elasticsearch/plugins/PersistentTaskPlugin.java, +import org.elasticsearch.common.settings.SettingsModule;, +                                                                        ThreadPool threadPool,, +                                                                        Client client,, +                                                                        SettingsModule settingsModule) {, +++ b/server/src/test/java/org/elasticsearch/persistent/TestPersistentTasksPlugin.java, +import org.elasticsearch.common.settings.SettingsModule;, +                                                                       ThreadPool threadPool,, +                                                                       Client client,, +                                                                       SettingsModule settingsModule) {, +++ b/docs/reference/ccr/apis/follow/get-follow-stats.asciidoc, +`indices[].shards[].follower_settings_version`::, +  (long) the index settings version the follower is synced up to, +, +          "follower_settings_version" : 2,, +// TESTRESPONSE[s/"follower_settings_version" : 2/"follower_settings_version" : $body.indices.0.shards.0.follower_settings_version/], +++ b/server/src/main/java/org/elasticsearch/node/Node.java, +                .map(p -> p.getPersistentTasksExecutor(clusterService, threadPool, client, settingsModule)), +++ b/server/src/main/java/org/elasticsearch/plugins/PersistentTaskPlugin.java, +import org.elasticsearch.common.settings.SettingsModule;, +                                                                        ThreadPool threadPool,, +                                                                        Client client,, +                                                                        SettingsModule settingsModule) {, +++ b/server/src/test/java/org/elasticsearch/persistent/TestPersistentTasksPlugin.java, +import org.elasticsearch.common.settings.SettingsModule;, +                                                                       ThreadPool threadPool,, +                                                                       Client client,, +                                                                       SettingsModule settingsModule) {, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/Ccr.java, +import org.elasticsearch.common.settings.SettingsModule;, +                                                                       ThreadPool threadPool,, +                                                                       Client client,, +                                                                       SettingsModule settingsModule) {, +        IndexScopedSettings indexScopedSettings = settingsModule.getIndexScopedSettings();, +        return Collections.singletonList(new ShardFollowTasksExecutor(client, threadPool, clusterService, indexScopedSettings));, +++ b/docs/reference/ccr/apis/follow/get-follow-stats.asciidoc, +`indices[].shards[].follower_settings_version`::, +  (long) the index settings version the follower is synced up to, +, +          "follower_settings_version" : 2,, +// TESTRESPONSE[s/"follower_settings_version" : 2/"follower_settings_version" : $body.indices.0.shards.0.follower_settings_version/], +++ b/server/src/main/java/org/elasticsearch/node/Node.java, +                .map(p -> p.getPersistentTasksExecutor(clusterService, threadPool, client, settingsModule)), +++ b/server/src/main/java/org/elasticsearch/plugins/PersistentTaskPlugin.java, +import org.elasticsearch.common.settings.SettingsModule;, +                                                                        ThreadPool threadPool,, +                                                                        Client client,, +                                                                        SettingsModule settingsModule) {, +++ b/server/src/test/java/org/elasticsearch/persistent/TestPersistentTasksPlugin.java, +import org.elasticsearch.common.settings.SettingsModule;, +                                                                       ThreadPool threadPool,, +                                                                       Client client,, +                                                                       SettingsModule settingsModule) {, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/Ccr.java, +import org.elasticsearch.common.settings.SettingsModule;, +                                                                       ThreadPool threadPool,, +                                                                       Client client,, +                                                                       SettingsModule settingsModule) {, +        IndexScopedSettings indexScopedSettings = settingsModule.getIndexScopedSettings();, +        return Collections.singletonList(new ShardFollowTasksExecutor(client, threadPool, clusterService, indexScopedSettings));, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/ShardChangesAction.java, +import org.elasticsearch.cluster.metadata.IndexMetaData;, +        private long settingsVersion;, +, +        public long getSettingsVersion() {]