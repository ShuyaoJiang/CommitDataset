[+++ b/core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java, +            return getMaxSizeVirtualMemory() != Long.MIN_VALUE && getMaxSizeVirtualMemory() != getRlimInfinity();, +        long getRlimInfinity() {, +            return JNACLibrary.RLIM_INFINITY;, +        }, +, +        // visible for testing, +++ b/core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java, +            return getMaxSizeVirtualMemory() != Long.MIN_VALUE && getMaxSizeVirtualMemory() != getRlimInfinity();, +        long getRlimInfinity() {, +            return JNACLibrary.RLIM_INFINITY;, +        }, +, +        // visible for testing, +++ b/core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java, +import org.apache.lucene.util.Constants;, +        final long rlimInfinity = Constants.MAC_OS_X ? 9223372036854775807L : -1L;, +        final AtomicLong maxSizeVirtualMemory = new AtomicLong(randomIntBetween(0, Integer.MAX_VALUE));, +, +            @Override, +            long getRlimInfinity() {, +                return rlimInfinity;, +            }, +        maxSizeVirtualMemory.set(rlimInfinity);]