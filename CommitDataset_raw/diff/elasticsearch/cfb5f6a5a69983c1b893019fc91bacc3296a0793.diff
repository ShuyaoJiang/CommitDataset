[+++ b/core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java, +import static org.hamcrest.Matchers.empty;, +                boolean committing = false;, +                            failableTLog.rollGeneration();, +                            committing = true;, +                            failableTLog.getDeletionPolicy().setMinTranslogGenerationForRecovery(failableTLog.currentFileGeneration());, +                            failableTLog.trimUnreferencedReaders();, +                            committing = false;, +                    if (committing && checkpoint.minTranslogGeneration == checkpoint.generation) {, +                        // we were committing and blew up in one of the syncs, but they made it through, +                        syncedDocs.clear();, +                        assertThat(unsynced, empty());, +                    }]