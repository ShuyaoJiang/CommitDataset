[+++ b/core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.delete(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.delete(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/GetPipelineTransportAction.java, +        listener.onResponse(new GetPipelineResponse(pipelineStore.getPipelines(state, request.getIds())));, +++ b/core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.delete(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/GetPipelineTransportAction.java, +        listener.onResponse(new GetPipelineResponse(pipelineStore.getPipelines(state, request.getIds())));, +++ b/core/src/main/java/org/elasticsearch/action/ingest/PutPipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.put(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.delete(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/GetPipelineTransportAction.java, +        listener.onResponse(new GetPipelineResponse(pipelineStore.getPipelines(state, request.getIds())));, +++ b/core/src/main/java/org/elasticsearch/action/ingest/PutPipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.put(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/ingest/IngestService.java, +    public IngestService(Settings settings, ThreadPool threadPool, ProcessorsRegistry processorsRegistry) {, +        this.pipelineStore = new PipelineStore(settings);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.delete(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/GetPipelineTransportAction.java, +        listener.onResponse(new GetPipelineResponse(pipelineStore.getPipelines(state, request.getIds())));, +++ b/core/src/main/java/org/elasticsearch/action/ingest/PutPipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.put(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/ingest/IngestService.java, +    public IngestService(Settings settings, ThreadPool threadPool, ProcessorsRegistry processorsRegistry) {, +        this.pipelineStore = new PipelineStore(settings);, +++ b/core/src/main/java/org/elasticsearch/ingest/PipelineStore.java, +    public PipelineStore(Settings settings) {, +    public void delete(ClusterService clusterService, DeletePipelineRequest request, ActionListener<WritePipelineResponse> listener) {, +    public void put(ClusterService clusterService, PutPipelineRequest request, ActionListener<WritePipelineResponse> listener) throws IllegalArgumentException {, +    public List<PipelineConfiguration> getPipelines(ClusterState clusterState, String... ids) {, +        IngestMetadata ingestMetadata = clusterState.getMetaData().custom(IngestMetadata.TYPE);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.delete(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/GetPipelineTransportAction.java, +        listener.onResponse(new GetPipelineResponse(pipelineStore.getPipelines(state, request.getIds())));, +++ b/core/src/main/java/org/elasticsearch/action/ingest/PutPipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.put(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/ingest/IngestService.java, +    public IngestService(Settings settings, ThreadPool threadPool, ProcessorsRegistry processorsRegistry) {, +        this.pipelineStore = new PipelineStore(settings);, +++ b/core/src/main/java/org/elasticsearch/ingest/PipelineStore.java, +    public PipelineStore(Settings settings) {, +    public void delete(ClusterService clusterService, DeletePipelineRequest request, ActionListener<WritePipelineResponse> listener) {, +    public void put(ClusterService clusterService, PutPipelineRequest request, ActionListener<WritePipelineResponse> listener) throws IllegalArgumentException {, +    public List<PipelineConfiguration> getPipelines(ClusterState clusterState, String... ids) {, +        IngestMetadata ingestMetadata = clusterState.getMetaData().custom(IngestMetadata.TYPE);, +++ b/core/src/main/java/org/elasticsearch/node/service/NodeService.java, +        this.ingestService = new IngestService(settings, threadPool, processorsRegistry);, +        clusterService.add(ingestService.getPipelineStore());, +++ b/core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.delete(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/GetPipelineTransportAction.java, +        listener.onResponse(new GetPipelineResponse(pipelineStore.getPipelines(state, request.getIds())));, +++ b/core/src/main/java/org/elasticsearch/action/ingest/PutPipelineTransportAction.java, +    private final ClusterService clusterService;, +        this.clusterService = clusterService;, +        pipelineStore.put(clusterService, request, listener);, +++ b/core/src/main/java/org/elasticsearch/ingest/IngestService.java, +    public IngestService(Settings settings, ThreadPool threadPool, ProcessorsRegistry processorsRegistry) {, +        this.pipelineStore = new PipelineStore(settings);, +++ b/core/src/main/java/org/elasticsearch/ingest/PipelineStore.java, +    public PipelineStore(Settings settings) {, +    public void delete(ClusterService clusterService, DeletePipelineRequest request, ActionListener<WritePipelineResponse> listener) {, +    public void put(ClusterService clusterService, PutPipelineRequest request, ActionListener<WritePipelineResponse> listener) throws IllegalArgumentException {, +    public List<PipelineConfiguration> getPipelines(ClusterState clusterState, String... ids) {, +        IngestMetadata ingestMetadata = clusterState.getMetaData().custom(IngestMetadata.TYPE);, +++ b/core/src/main/java/org/elasticsearch/node/service/NodeService.java, +        this.ingestService = new IngestService(settings, threadPool, processorsRegistry);, +        clusterService.add(ingestService.getPipelineStore());, +++ b/core/src/test/java/org/elasticsearch/ingest/PipelineStoreTests.java, +        store = new PipelineStore(Settings.EMPTY);]