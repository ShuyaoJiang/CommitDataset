[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/gateway/blobstore/BlobReuseExistingNodeAllocation.java, +            for (Iterator<DiscoveryNode> it = shardStores.keySet().iterator(); it.hasNext();) {, +                DiscoveryNode node = it.next();, +                    it.remove();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/gateway/blobstore/BlobReuseExistingNodeAllocation.java, +            for (Iterator<DiscoveryNode> it = shardStores.keySet().iterator(); it.hasNext();) {, +                DiscoveryNode node = it.next();, +                    it.remove();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/gateway/local/LocalGatewayNodeAllocation.java, +            for (TObjectLongIterator<DiscoveryNode> it = shardStates.iterator(); it.hasNext();) {, +                it.advance();, +                if (!nodes.nodeExists(it.key().id())) {, +                    it.remove();, +            for (Iterator<DiscoveryNode> it = shardStores.keySet().iterator(); it.hasNext();) {, +                DiscoveryNode node = it.next();, +                    it.remove();]