[+++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +import org.apache.lucene.util.BytesRef;, +, +        /**, +         * Creates a new index term based on the provided value., +         */, +        public Term createIndexNameTerm(BytesRef value) {, +            return new Term(indexName, value);, +        }, +    BytesRef indexedValue(String value);, +    Filter fieldFilter(String value, @Nullable QueryParseContext context);, +, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +import org.apache.lucene.util.BytesRef;, +, +        /**, +         * Creates a new index term based on the provided value., +         */, +        public Term createIndexNameTerm(BytesRef value) {, +            return new Term(indexName, value);, +        }, +    BytesRef indexedValue(String value);, +    Filter fieldFilter(String value, @Nullable QueryParseContext context);, +, +++ b/src/main/java/org/elasticsearch/index/mapper/Uid.java, +    public static final byte DELIMITER_BYTE = 0x23;, +    public static final BytesRef DELIMITER_BYTES = new BytesRef(new byte[]{DELIMITER_BYTE});, +    public static BytesRef createUidAsBytes(String type, String id) {, +        BytesRef ref = new BytesRef(type.length() + 1 + id.length());, +        ref.copyChars(type);, +        ref.copyBytes(DELIMITER_BYTES);, +        ref.copyChars(id);, +        return ref;, +    }, +, +            if (uid.bytes[i] == DELIMITER_BYTE) { // 0x23 is equal to '#', +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +import org.apache.lucene.util.BytesRef;, +, +        /**, +         * Creates a new index term based on the provided value., +         */, +        public Term createIndexNameTerm(BytesRef value) {, +            return new Term(indexName, value);, +        }, +    BytesRef indexedValue(String value);, +    Filter fieldFilter(String value, @Nullable QueryParseContext context);, +, +++ b/src/main/java/org/elasticsearch/index/mapper/Uid.java, +    public static final byte DELIMITER_BYTE = 0x23;, +    public static final BytesRef DELIMITER_BYTES = new BytesRef(new byte[]{DELIMITER_BYTE});, +    public static BytesRef createUidAsBytes(String type, String id) {, +        BytesRef ref = new BytesRef(type.length() + 1 + id.length());, +        ref.copyChars(type);, +        ref.copyBytes(DELIMITER_BYTES);, +        ref.copyChars(id);, +        return ref;, +    }, +, +            if (uid.bytes[i] == DELIMITER_BYTE) { // 0x23 is equal to '#', +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +    public BytesRef indexedValue(String value) {, +        return new BytesRef(value);, +                lowerTerm == null ? null : indexedValue(lowerTerm),, +                upperTerm == null ? null : indexedValue(upperTerm),, +                lowerTerm == null ? null : indexedValue(lowerTerm),, +                upperTerm == null ? null : indexedValue(upperTerm),, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +import org.apache.lucene.util.BytesRef;, +, +        /**, +         * Creates a new index term based on the provided value., +         */, +        public Term createIndexNameTerm(BytesRef value) {, +            return new Term(indexName, value);, +        }, +    BytesRef indexedValue(String value);, +    Filter fieldFilter(String value, @Nullable QueryParseContext context);, +, +++ b/src/main/java/org/elasticsearch/index/mapper/Uid.java, +    public static final byte DELIMITER_BYTE = 0x23;, +    public static final BytesRef DELIMITER_BYTES = new BytesRef(new byte[]{DELIMITER_BYTE});, +    public static BytesRef createUidAsBytes(String type, String id) {, +        BytesRef ref = new BytesRef(type.length() + 1 + id.length());, +        ref.copyChars(type);, +        ref.copyBytes(DELIMITER_BYTES);, +        ref.copyChars(id);, +        return ref;, +    }, +, +            if (uid.bytes[i] == DELIMITER_BYTE) { // 0x23 is equal to '#', +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +    public BytesRef indexedValue(String value) {, +        return new BytesRef(value);, +                lowerTerm == null ? null : indexedValue(lowerTerm),, +                upperTerm == null ? null : indexedValue(upperTerm),, +                lowerTerm == null ? null : indexedValue(lowerTerm),, +                upperTerm == null ? null : indexedValue(upperTerm),, +++ b/src/main/java/org/elasticsearch/index/mapper/core/BinaryFieldMapper.java, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java]