[+++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +    static class ActionEntry<Request extends ActionRequest<Request>, Response extends ActionResponse> {, +    public <Request extends ActionRequest<Request>, Response extends ActionResponse> void registerAction(GenericAction<Request, Response> action, Class<? extends TransportAction<Request, Response>> transportAction, Class... supportTransportActions) {, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +    static class ActionEntry<Request extends ActionRequest<Request>, Response extends ActionResponse> {, +    public <Request extends ActionRequest<Request>, Response extends ActionResponse> void registerAction(GenericAction<Request, Response> action, Class<? extends TransportAction<Request, Response>> transportAction, Class... supportTransportActions) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +import org.elasticsearch.action.support.replication.BasicReplicationRequest;, +public class TransportRefreshAction extends TransportBroadcastReplicationAction<RefreshRequest, RefreshResponse, BasicReplicationRequest, ReplicationResponse> {, +    protected BasicReplicationRequest newShardRequest(RefreshRequest request, ShardId shardId) {, +        return new BasicReplicationRequest(request, shardId);, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +    static class ActionEntry<Request extends ActionRequest<Request>, Response extends ActionResponse> {, +    public <Request extends ActionRequest<Request>, Response extends ActionResponse> void registerAction(GenericAction<Request, Response> action, Class<? extends TransportAction<Request, Response>> transportAction, Class... supportTransportActions) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +import org.elasticsearch.action.support.replication.BasicReplicationRequest;, +public class TransportRefreshAction extends TransportBroadcastReplicationAction<RefreshRequest, RefreshResponse, BasicReplicationRequest, ReplicationResponse> {, +    protected BasicReplicationRequest newShardRequest(RefreshRequest request, ShardId shardId) {, +        return new BasicReplicationRequest(request, shardId);, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java, +import org.elasticsearch.action.support.replication.BasicReplicationRequest;, +public class TransportShardRefreshAction extends TransportReplicationAction<BasicReplicationRequest, BasicReplicationRequest, ReplicationResponse> {, +                actionFilters, indexNameExpressionResolver, BasicReplicationRequest::new, BasicReplicationRequest::new, ThreadPool.Names.REFRESH);, +    protected Tuple<ReplicationResponse, BasicReplicationRequest> shardOperationOnPrimary(MetaData metaData, BasicReplicationRequest shardRequest) throws Throwable {, +    protected void shardOperationOnReplica(BasicReplicationRequest request) {, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +    static class ActionEntry<Request extends ActionRequest<Request>, Response extends ActionResponse> {, +    public <Request extends ActionRequest<Request>, Response extends ActionResponse> void registerAction(GenericAction<Request, Response> action, Class<? extends TransportAction<Request, Response>> transportAction, Class... supportTransportActions) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +import org.elasticsearch.action.support.replication.BasicReplicationRequest;, +public class TransportRefreshAction extends TransportBroadcastReplicationAction<RefreshRequest, RefreshResponse, BasicReplicationRequest, ReplicationResponse> {, +    protected BasicReplicationRequest newShardRequest(RefreshRequest request, ShardId shardId) {, +        return new BasicReplicationRequest(request, shardId);, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java, +import org.elasticsearch.action.support.replication.BasicReplicationRequest;, +public class TransportShardRefreshAction extends TransportReplicationAction<BasicReplicationRequest, BasicReplicationRequest, ReplicationResponse> {, +                actionFilters, indexNameExpressionResolver, BasicReplicationRequest::new, BasicReplicationRequest::new, ThreadPool.Names.REFRESH);, +    protected Tuple<ReplicationResponse, BasicReplicationRequest> shardOperationOnPrimary(MetaData metaData, BasicReplicationRequest shardRequest) throws Throwable {, +    protected void shardOperationOnReplica(BasicReplicationRequest request) {, +++ b/core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java, +    private final ScheduledFuture<?> scheduledFuture;, +        return add((ActionRequest<?>) request);, +        return add((ActionRequest<?>) request);, +    public BulkProcessor add(ActionRequest<?> request) {, +    public BulkProcessor add(ActionRequest<?> request, @Nullable Object payload) {, +    private synchronized void internalAdd(ActionRequest<?> request, @Nullable Object payload) {, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +    static class ActionEntry<Request extends ActionRequest<Request>, Response extends ActionResponse> {, +    public <Request extends ActionRequest<Request>, Response extends ActionResponse> void registerAction(GenericAction<Request, Response> action, Class<? extends TransportAction<Request, Response>> transportAction, Class... supportTransportActions) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +import org.elasticsearch.action.support.replication.BasicReplicationRequest;, +public class TransportRefreshAction extends TransportBroadcastReplicationAction<RefreshRequest, RefreshResponse, BasicReplicationRequest, ReplicationResponse> {, +    protected BasicReplicationRequest newShardRequest(RefreshRequest request, ShardId shardId) {, +        return new BasicReplicationRequest(request, shardId);, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java, +import org.elasticsearch.action.support.replication.BasicReplicationRequest;, +public class TransportShardRefreshAction extends TransportReplicationAction<BasicReplicationRequest, BasicReplicationRequest, ReplicationResponse> {, +                actionFilters, indexNameExpressionResolver, BasicReplicationRequest::new, BasicReplicationRequest::new, ThreadPool.Names.REFRESH);, +    protected Tuple<ReplicationResponse, BasicReplicationRequest> shardOperationOnPrimary(MetaData metaData, BasicReplicationRequest shardRequest) throws Throwable {, +    protected void shardOperationOnReplica(BasicReplicationRequest request) {, +++ b/core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java, +    private final ScheduledFuture<?> scheduledFuture;, +        return add((ActionRequest<?>) request);, +        return add((ActionRequest<?>) request);, +    public BulkProcessor add(ActionRequest<?> request) {, +    public BulkProcessor add(ActionRequest<?> request, @Nullable Object payload) {, +    private synchronized void internalAdd(ActionRequest<?> request, @Nullable Object payload) {, +++ b/core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java, +    final List<ActionRequest<?>> requests = new ArrayList<>();, +    public BulkRequest(ActionRequest<?> request) {, +    public BulkRequest add(ActionRequest<?>... requests) {, +        for (ActionRequest<?> request : requests) {, +    public BulkRequest add(ActionRequest<?> request) {, +    public BulkRequest add(ActionRequest<?> request, @Nullable Object payload) {, +    public BulkRequest add(Iterable<ActionRequest<?>> requests) {, +        for (ActionRequest<?> request : requests) {, +    public List<ActionRequest<?>> requests() {, +        for (ActionRequest<?> request : requests) {, +        for (ActionRequest<?> request : requests) {, +        for (ActionRequest<?> request : requests) {, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +    static class ActionEntry<Request extends ActionRequest<Request>, Response extends ActionResponse> {, +    public <Request extends ActionRequest<Request>, Response extends ActionResponse> void registerAction(GenericAction<Request, Response> action, Class<? extends TransportAction<Request, Response>> transportAction, Class... supportTransportActions) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +import org.elasticsearch.action.support.replication.BasicReplicationRequest;, +public class TransportRefreshAction extends TransportBroadcastReplicationAction<RefreshRequest, RefreshResponse, BasicReplicationRequest, ReplicationResponse> {, +    protected BasicReplicationRequest newShardRequest(RefreshRequest request, ShardId shardId) {, +        return new BasicReplicationRequest(request, shardId);, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java, +import org.elasticsearch.action.support.replication.BasicReplicationRequest;, +public class TransportShardRefreshAction extends TransportReplicationAction<BasicReplicationRequest, BasicReplicationRequest, ReplicationResponse> {, +                actionFilters, indexNameExpressionResolver, BasicReplicationRequest::new, BasicReplicationRequest::new, ThreadPool.Names.REFRESH);, +    protected Tuple<ReplicationResponse, BasicReplicationRequest> shardOperationOnPrimary(MetaData metaData, BasicReplicationRequest shardRequest) throws Throwable {, +    protected void shardOperationOnReplica(BasicReplicationRequest request) {, +++ b/core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java, +    private final ScheduledFuture<?> scheduledFuture;, +        return add((ActionRequest<?>) request);, +        return add((ActionRequest<?>) request);, +    public BulkProcessor add(ActionRequest<?> request) {, +    public BulkProcessor add(ActionRequest<?> request, @Nullable Object payload) {]