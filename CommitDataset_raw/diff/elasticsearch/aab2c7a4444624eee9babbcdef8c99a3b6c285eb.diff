[+++ b/src/main/java/org/elasticsearch/index/engine/internal/InternalEngine.java, +        private final AtomicBoolean released;, +            this.released = new AtomicBoolean(false);, +            if (!released.compareAndSet(false, true)) {, +                throw new ElasticsearchIllegalStateException("Double release");, +            }]