[+++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClient.java, +                List<LifecycleComponent> pluginLifecycleComponents = pluginComponents.stream(), +                pluginLifecycleComponents.addAll(pluginsService.getGuiceServiceClasses().stream(), +                resourcesToClose.addAll(pluginLifecycleComponents);, +                TransportClient transportClient = new TransportClient(injector, pluginLifecycleComponents, nodesService, proxy);, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClient.java, +                List<LifecycleComponent> pluginLifecycleComponents = pluginComponents.stream(), +                pluginLifecycleComponents.addAll(pluginsService.getGuiceServiceClasses().stream(), +                resourcesToClose.addAll(pluginLifecycleComponents);, +                TransportClient transportClient = new TransportClient(injector, pluginLifecycleComponents, nodesService, proxy);, +++ b/core/src/main/java/org/elasticsearch/node/Node.java, +            List<LifecycleComponent> pluginLifecycleComponents = pluginComponents.stream(), +            pluginLifecycleComponents.addAll(pluginsService.getGuiceServiceClasses().stream(), +            resourcesToClose.addAll(pluginLifecycleComponents);, +            this.pluginLifecycleComponents = Collections.unmodifiableList(pluginLifecycleComponents);]