[+++ b/core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java, +import org.elasticsearch.cluster.routing.ShardIterator;, +        new AsyncSingleAction(request, listener).start();, +    }, +, +    class AsyncSingleAction {, +, +        private final ActionListener<Response> listener;, +        private final Request request;, +        private volatile ClusterStateObserver observer;, +, +        AsyncSingleAction(Request request, ActionListener<Response> listener) {, +            this.request = request;, +            this.listener = listener;, +        public void start() {, +            this.observer = new ClusterStateObserver(clusterService, request.masterNodeTimeout(), logger);, +            doStart(false);, +        }, +, +        protected void doStart(boolean retrying) {, +                                    doStart(false);, +                                        doStart(true);, +                                           doStart(false);, +}]