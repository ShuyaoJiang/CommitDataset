[+++ b/src/test/java/org/elasticsearch/search/basic/SearchWhileRelocatingTests.java, +import org.elasticsearch.client.Client;, +    public void testSearchAndRelocateConcurrently0Replicas() throws Exception {, +        testSearchAndRelocateConcurrently(0);, +    }, +, +    @Test, +    public void testSearchAndRelocateConcurrently1Replicas() throws Exception {, +        testSearchAndRelocateConcurrently(1);, +    }, +, +    private void testSearchAndRelocateConcurrently(int numberOfReplicas) throws Exception {, +                .setSettings(settingsBuilder().put("index.number_of_shards", numShards).put("index.number_of_replicas", numberOfReplicas)), +                .addMapping("type1", "loc", "type=geo_point", "test", "type=string").execute().actionGet();, +        ensureGreen();, +        assertHitCount(client().prepareSearch().get(), (long) (numDocs));, +                            SearchResponse sr = client().prepareSearch().setSize(numDocs).get();, +, +            if (!thrownExceptions.isEmpty()) {, +                Client client = client();, +                String verified = "POST SEARCH OK";, +                for (int j = 0; j < 10; j++) {, +                    if (client.prepareSearch().get().getHits().getTotalHits() != numDocs) {, +                        verified = "POST SEARCH FAIL";, +                        break;, +                    }, +                }, +, +                assertThat("failed in iteration " + i + ", verification: " + verified, thrownExceptions, Matchers.emptyIterable());, +            }]