[+++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +    @Nullable, +    public Long readOptionalLong() throws IOException {, +        if (readBoolean()) {, +            return readLong();, +        }, +        return null;, +    }, +, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +    @Nullable, +    public Long readOptionalLong() throws IOException {, +        if (readBoolean()) {, +            return readLong();, +        }, +        return null;, +    }, +, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +    public void writeOptionalLong(@Nullable Long l) throws IOException {, +        if (l == null) {, +            writeBoolean(false);, +        } else {, +            writeBoolean(true);, +            writeLong(l);, +        }, +    }, +, +    public void writeOptionalDouble(@Nullable Double v) throws IOException {, +    public void writeOptionalTimeZone(@Nullable DateTimeZone timeZone) throws IOException {, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +    @Nullable, +    public Long readOptionalLong() throws IOException {, +        if (readBoolean()) {, +            return readLong();, +        }, +        return null;, +    }, +, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +    public void writeOptionalLong(@Nullable Long l) throws IOException {, +        if (l == null) {, +            writeBoolean(false);, +        } else {, +            writeBoolean(true);, +            writeLong(l);, +        }, +    }, +, +    public void writeOptionalDouble(@Nullable Double v) throws IOException {, +    public void writeOptionalTimeZone(@Nullable DateTimeZone timeZone) throws IOException {, +++ b/core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java, +        LONG_OR_NULL(VALUE_NUMBER, VALUE_STRING, VALUE_NULL),, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +    @Nullable, +    public Long readOptionalLong() throws IOException {, +        if (readBoolean()) {, +            return readLong();, +        }, +        return null;, +    }, +, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +    @Nullable, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +    public void writeOptionalLong(@Nullable Long l) throws IOException {, +        if (l == null) {, +            writeBoolean(false);, +        } else {, +            writeBoolean(true);, +            writeLong(l);, +        }, +    }, +, +    public void writeOptionalDouble(@Nullable Double v) throws IOException {, +    public void writeOptionalTimeZone(@Nullable DateTimeZone timeZone) throws IOException {, +++ b/core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java, +        LONG_OR_NULL(VALUE_NUMBER, VALUE_STRING, VALUE_NULL),]