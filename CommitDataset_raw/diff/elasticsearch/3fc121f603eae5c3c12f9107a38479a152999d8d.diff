[+++ b/src/main/java/org/elasticsearch/script/python/PythonScriptEngineService.java, +            if (vars != null) {, +        }, +++ b/src/main/java/org/elasticsearch/script/python/PythonScriptEngineService.java, +            if (vars != null) {, +        }, +++ b/src/test/java/org/elasticsearch/script/python/PythonScriptSearchTests.java, +import org.hamcrest.CoreMatchers;, +import static org.elasticsearch.client.Requests.searchRequest;, +import static org.hamcrest.CoreMatchers.is;, +, +    /**, +     * Test case for #4: https://github.com/elasticsearch/elasticsearch-lang-python/issues/4, +     * Update request that uses python script with no parameters fails with NullPointerException, +     * @throws Exception, +     */, +    @Test, +    public void testPythonEmptyParameters() throws Exception {, +        wipeIndices("test");, +        createIndex("test");, +        index("test", "type1", "1", jsonBuilder().startObject().field("myfield", "foo").endObject());, +        refresh();, +, +        client().prepareUpdate("test", "type1", "1").setScriptLang("python").setScript("ctx[\"_source\"][\"myfield\"]=\"bar\""), +            .execute().actionGet();, +        refresh();, +, +        Object value = get("test", "type1", "1").getSourceAsMap().get("myfield");, +        assertThat(value instanceof String, is(true));, +, +        assertThat((String) value, CoreMatchers.equalTo("bar"));, +    }]