[+++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            XContentParser.Token token = parser.nextToken();, +            if (token == null) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_OBJECT) {, +                if (token == XContentParser.Token.FIELD_NAME) {, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            XContentParser.Token token = parser.nextToken();, +            if (token == null) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_OBJECT) {, +                if (token == XContentParser.Token.FIELD_NAME) {, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == null) {, +            token = parser.nextToken();, +        if (token == XContentParser.Token.START_OBJECT) {, +            token = parser.nextToken();, +        for (; token == XContentParser.Token.FIELD_NAME; token = parser.nextToken()) {, +            token = parser.nextToken();, +                    if (!token.isValue()) {, +                if (token == XContentParser.Token.START_OBJECT) {, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            XContentParser.Token token = parser.nextToken();, +            if (token == null) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_OBJECT) {, +                if (token == XContentParser.Token.FIELD_NAME) {, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == null) {, +            token = parser.nextToken();, +        if (token == XContentParser.Token.START_OBJECT) {, +            token = parser.nextToken();, +        for (; token == XContentParser.Token.FIELD_NAME; token = parser.nextToken()) {, +            token = parser.nextToken();, +                    if (!token.isValue()) {, +                if (token == XContentParser.Token.START_OBJECT) {, +++ b/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == XContentParser.Token.FIELD_NAME) {, +            token = parser.nextToken();, +        switch (token) {, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            XContentParser.Token token = parser.nextToken();, +            if (token == null) {, +            while ((token = parser.nextToken()) != XContentParser.Token.END_OBJECT) {, +                if (token == XContentParser.Token.FIELD_NAME) {, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == null) {, +            token = parser.nextToken();, +        if (token == XContentParser.Token.START_OBJECT) {, +            token = parser.nextToken();, +        for (; token == XContentParser.Token.FIELD_NAME; token = parser.nextToken()) {, +            token = parser.nextToken();, +                    if (!token.isValue()) {, +                if (token == XContentParser.Token.START_OBJECT) {, +++ b/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == XContentParser.Token.FIELD_NAME) {, +            token = parser.nextToken();, +        switch (token) {, +++ b/src/main/java/org/elasticsearch/common/xcontent/support/AbstractXContentParser.java, +        XContentParser.Token token = parser.currentToken();, +        if (token == null) {, +            token = parser.nextToken();, +        if (token == XContentParser.Token.START_OBJECT) {, +            token = parser.nextToken();, +        for (; token == XContentParser.Token.FIELD_NAME; token = parser.nextToken()) {, +            token = parser.nextToken();, +            Object value = readValue(parser, mapFactory, token);, +    private static List<Object> readList(XContentParser parser, MapFactory mapFactory, XContentParser.Token token) throws IOException {, +        while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {, +            list.add(readValue(parser, mapFactory, token));, +    private static Object readValue(XContentParser parser, MapFactory mapFactory, XContentParser.Token token) throws IOException {, +        if (token == XContentParser.Token.VALUE_NULL) {, +        } else if (token == XContentParser.Token.VALUE_STRING) {, +        } else if (token == XContentParser.Token.VALUE_NUMBER) {, +        } else if (token == XContentParser.Token.VALUE_BOOLEAN) {, +        } else if (token == XContentParser.Token.START_OBJECT) {, +        } else if (token == XContentParser.Token.START_ARRAY) {, +            return readList(parser, mapFactory, token);, +        } else if (token == XContentParser.Token.VALUE_EMBEDDED_OBJECT) {]