[+++ b/qa/full-cluster-restart/src/test/java/org/elasticsearch/upgrades/FullClusterRestartIT.java, +public class FullClusterRestartIT extends AbstractFullClusterRestartTestCase {, +    private final boolean supportsLenientBooleans = getOldClusterVersion().before(Version.V_6_0_0_alpha1);, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +            getOldClusterVersion().before(VERSION_5_1_0_UNRELEASED));, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster() == false) {, +        if (isRunningAgainstOldCluster()) {, +        assertEquals(getOldClusterVersion(), version);, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster() == false) {, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        int expectedCount = bulkCount + (isRunningAgainstOldCluster() ? 0 : bulkCount);, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        if (false == isRunningAgainstOldCluster()) {, +        String bwcLuceneVersion = getOldClusterVersion().luceneVersion.toString();, +        if (isRunningAgainstOldCluster()) {, +                    "{\"persistent\": {\"cluster.routing.allocation.exclude.test_attr\": \"" + getOldClusterVersion() + "\"}}");, +                        templateBuilder.field("version", isRunningAgainstOldCluster() ? getOldClusterVersion() : Version.CURRENT);, +        if (isRunningAgainstOldCluster()) {, +        Request createSnapshot = new Request("PUT", "/_snapshot/repo/" + (isRunningAgainstOldCluster() ? "old_snap" : "new_snap"));, +        checkSnapshot("old_snap", count, getOldClusterVersion());, +        if (false == isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +                singletonMap("cluster.routing.allocation.exclude.test_attr", getOldClusterVersion().toString()));, +        if (isRunningAgainstOldCluster() && getOldClusterVersion().before(Version.V_6_0_0_beta1)) {, +++ b/qa/full-cluster-restart/src/test/java/org/elasticsearch/upgrades/FullClusterRestartIT.java, +public class FullClusterRestartIT extends AbstractFullClusterRestartTestCase {, +    private final boolean supportsLenientBooleans = getOldClusterVersion().before(Version.V_6_0_0_alpha1);, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +            getOldClusterVersion().before(VERSION_5_1_0_UNRELEASED));, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster() == false) {, +        if (isRunningAgainstOldCluster()) {, +        assertEquals(getOldClusterVersion(), version);, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster() == false) {, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        int expectedCount = bulkCount + (isRunningAgainstOldCluster() ? 0 : bulkCount);, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        if (false == isRunningAgainstOldCluster()) {, +        String bwcLuceneVersion = getOldClusterVersion().luceneVersion.toString();, +        if (isRunningAgainstOldCluster()) {, +                    "{\"persistent\": {\"cluster.routing.allocation.exclude.test_attr\": \"" + getOldClusterVersion() + "\"}}");, +                        templateBuilder.field("version", isRunningAgainstOldCluster() ? getOldClusterVersion() : Version.CURRENT);, +        if (isRunningAgainstOldCluster()) {, +        Request createSnapshot = new Request("PUT", "/_snapshot/repo/" + (isRunningAgainstOldCluster() ? "old_snap" : "new_snap"));, +        checkSnapshot("old_snap", count, getOldClusterVersion());, +        if (false == isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +                singletonMap("cluster.routing.allocation.exclude.test_attr", getOldClusterVersion().toString()));, +        if (isRunningAgainstOldCluster() && getOldClusterVersion().before(Version.V_6_0_0_beta1)) {, +++ b/qa/full-cluster-restart/src/test/java/org/elasticsearch/upgrades/QueryBuilderBWCIT.java, +public class QueryBuilderBWCIT extends AbstractFullClusterRestartTestCase {, +        if (isRunningAgainstOldCluster()) {, +                        input.setVersion(getOldClusterVersion());, +++ b/qa/full-cluster-restart/src/test/java/org/elasticsearch/upgrades/FullClusterRestartIT.java, +public class FullClusterRestartIT extends AbstractFullClusterRestartTestCase {, +    private final boolean supportsLenientBooleans = getOldClusterVersion().before(Version.V_6_0_0_alpha1);, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +            getOldClusterVersion().before(VERSION_5_1_0_UNRELEASED));, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster() == false) {, +        if (isRunningAgainstOldCluster()) {, +        assertEquals(getOldClusterVersion(), version);, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster() == false) {, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        int expectedCount = bulkCount + (isRunningAgainstOldCluster() ? 0 : bulkCount);, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +        if (false == isRunningAgainstOldCluster()) {, +        String bwcLuceneVersion = getOldClusterVersion().luceneVersion.toString();, +        if (isRunningAgainstOldCluster()) {, +                    "{\"persistent\": {\"cluster.routing.allocation.exclude.test_attr\": \"" + getOldClusterVersion() + "\"}}");, +                        templateBuilder.field("version", isRunningAgainstOldCluster() ? getOldClusterVersion() : Version.CURRENT);, +        if (isRunningAgainstOldCluster()) {, +        Request createSnapshot = new Request("PUT", "/_snapshot/repo/" + (isRunningAgainstOldCluster() ? "old_snap" : "new_snap"));, +        checkSnapshot("old_snap", count, getOldClusterVersion());, +        if (false == isRunningAgainstOldCluster()) {, +        if (isRunningAgainstOldCluster()) {, +                singletonMap("cluster.routing.allocation.exclude.test_attr", getOldClusterVersion().toString()));, +        if (isRunningAgainstOldCluster() && getOldClusterVersion().before(Version.V_6_0_0_beta1)) {, +++ b/qa/full-cluster-restart/src/test/java/org/elasticsearch/upgrades/QueryBuilderBWCIT.java, +public class QueryBuilderBWCIT extends AbstractFullClusterRestartTestCase {, +        if (isRunningAgainstOldCluster()) {]