[+++ b/core/src/test/java/org/elasticsearch/percolator/RecoveryPercolatorIT.java, +import org.elasticsearch.action.percolate.PercolateRequestBuilder;, +import static org.elasticsearch.index.query.QueryBuilders.*;, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.*;, +import static org.hamcrest.Matchers.*;, +        final String document = "{\"field\" : \"a\"}";, +                .setSource(document), +                                PercolateRequestBuilder percolateBuilder = client.preparePercolate(), +                                        .setIndices("test").setDocumentType("type");, +                                    percolateBuilder.setGetRequest(Requests.getRequest("test").type("type").id("1"));, +                                    percolateBuilder.setPercolateDoc(docBuilder().setDoc(document));, +                                builder.add(percolateBuilder);, +                            PercolateRequestBuilder percolateBuilder = client.preparePercolate(), +                                    .setIndices("test").setDocumentType("type");, +                                percolateBuilder.setPercolateDoc(docBuilder().setDoc(document));, +                                percolateBuilder.setGetRequest(Requests.getRequest("test").type("type").id("1"));, +                            PercolateResponse response = percolateBuilder.get();, +        Thread t = new Thread(r);, +        t.start();, +        t.join();]