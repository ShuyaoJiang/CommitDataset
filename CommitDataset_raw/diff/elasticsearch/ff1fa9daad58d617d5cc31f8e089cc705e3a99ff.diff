[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java, +            builder.field("max_number_of_shards_per_node", metaData.maxNumberOfShardsPerNode());, +                    if ("max_number_of_shards_per_node".equals(currentFieldName)) {]