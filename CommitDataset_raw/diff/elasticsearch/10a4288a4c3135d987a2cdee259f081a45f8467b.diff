[+++ b/core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java, +    private static final Comparator<AtomicArray.Entry<? extends QuerySearchResultProvider>> QUERY_RESULT_ORDERING = (o1, o2) -> {, +    private static final ScoreDoc[] EMPTY_DOCS = new ScoreDoc[0];, +    SearchPhaseController(Settings settings, BigArrays bigArrays, ScriptService scriptService) {, +            ReduceContext reduceContext = new ReduceContext(bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java, +    private static final Comparator<AtomicArray.Entry<? extends QuerySearchResultProvider>> QUERY_RESULT_ORDERING = (o1, o2) -> {, +    private static final ScoreDoc[] EMPTY_DOCS = new ScoreDoc[0];, +    SearchPhaseController(Settings settings, BigArrays bigArrays, ScriptService scriptService) {, +            ReduceContext reduceContext = new ReduceContext(bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        this.searchPhaseController = new SearchPhaseController(settings, bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java, +    private static final Comparator<AtomicArray.Entry<? extends QuerySearchResultProvider>> QUERY_RESULT_ORDERING = (o1, o2) -> {, +    private static final ScoreDoc[] EMPTY_DOCS = new ScoreDoc[0];, +    SearchPhaseController(Settings settings, BigArrays bigArrays, ScriptService scriptService) {, +            ReduceContext reduceContext = new ReduceContext(bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        this.searchPhaseController = new SearchPhaseController(settings, bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java, +        this.searchPhaseController = new SearchPhaseController(settings, bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java, +    private static final Comparator<AtomicArray.Entry<? extends QuerySearchResultProvider>> QUERY_RESULT_ORDERING = (o1, o2) -> {, +    private static final ScoreDoc[] EMPTY_DOCS = new ScoreDoc[0];, +    SearchPhaseController(Settings settings, BigArrays bigArrays, ScriptService scriptService) {, +            ReduceContext reduceContext = new ReduceContext(bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        this.searchPhaseController = new SearchPhaseController(settings, bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java, +        this.searchPhaseController = new SearchPhaseController(settings, bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java, +        public ReduceContext(BigArrays bigArrays, ScriptService scriptService) {, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java, +    private static final Comparator<AtomicArray.Entry<? extends QuerySearchResultProvider>> QUERY_RESULT_ORDERING = (o1, o2) -> {, +    private static final ScoreDoc[] EMPTY_DOCS = new ScoreDoc[0];, +    SearchPhaseController(Settings settings, BigArrays bigArrays, ScriptService scriptService) {, +            ReduceContext reduceContext = new ReduceContext(bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        this.searchPhaseController = new SearchPhaseController(settings, bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java, +        this.searchPhaseController = new SearchPhaseController(settings, bigArrays, scriptService);, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java, +        public ReduceContext(BigArrays bigArrays, ScriptService scriptService) {, +++ b/core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java, +        searchPhaseController = new SearchPhaseController(Settings.EMPTY, BigArrays.NON_RECYCLING_INSTANCE, null);]