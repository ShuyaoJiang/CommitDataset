[+++ b/server/src/main/java/org/elasticsearch/index/IndexSettings.java, +             * An empty translog occupies 55 bytes on disk. If the flush threshold is below this, the flush thread, +                     * An empty translog occupies 55 bytes on disk. If the generation threshold is, +++ b/server/src/main/java/org/elasticsearch/index/IndexSettings.java, +             * An empty translog occupies 55 bytes on disk. If the flush threshold is below this, the flush thread, +                     * An empty translog occupies 55 bytes on disk. If the generation threshold is, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        public Index(Term uid, long primaryTerm, ParsedDocument doc) {, +            this(uid, primaryTerm, doc, Versions.MATCH_ANY);, +        Index(Term uid, long primaryTerm, ParsedDocument doc, long version) {, +            this(uid, doc, SequenceNumbers.UNASSIGNED_SEQ_NO, primaryTerm, version, VersionType.INTERNAL,, +        public Delete(String type, String id, Term uid, long primaryTerm) {, +            this(type, id, uid, SequenceNumbers.UNASSIGNED_SEQ_NO, primaryTerm, Versions.MATCH_ANY, VersionType.INTERNAL, Origin.PRIMARY, System.nanoTime());, +++ b/server/src/main/java/org/elasticsearch/index/IndexSettings.java, +             * An empty translog occupies 55 bytes on disk. If the flush threshold is below this, the flush thread, +                     * An empty translog occupies 55 bytes on disk. If the generation threshold is, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        public Index(Term uid, long primaryTerm, ParsedDocument doc) {, +            this(uid, primaryTerm, doc, Versions.MATCH_ANY);, +        Index(Term uid, long primaryTerm, ParsedDocument doc, long version) {, +            this(uid, doc, SequenceNumbers.UNASSIGNED_SEQ_NO, primaryTerm, version, VersionType.INTERNAL,, +        public Delete(String type, String id, Term uid, long primaryTerm) {, +            this(type, id, uid, SequenceNumbers.UNASSIGNED_SEQ_NO, primaryTerm, Versions.MATCH_ANY, VersionType.INTERNAL, Origin.PRIMARY, System.nanoTime());, +++ b/server/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +    private final LongSupplier primaryTermSupplier;, +                        LongSupplier globalCheckpointSupplier, LongSupplier primaryTermSupplier) {, +        this.primaryTermSupplier = primaryTermSupplier;, +, +    /**, +     * Returns a supplier that supplies the latest primary term value of the associated shard., +     */, +    public LongSupplier getPrimaryTermSupplier() {, +        return primaryTermSupplier;, +    }, +++ b/server/src/main/java/org/elasticsearch/index/IndexSettings.java, +             * An empty translog occupies 55 bytes on disk. If the flush threshold is below this, the flush thread, +                     * An empty translog occupies 55 bytes on disk. If the generation threshold is, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        public Index(Term uid, long primaryTerm, ParsedDocument doc) {, +            this(uid, primaryTerm, doc, Versions.MATCH_ANY);, +        Index(Term uid, long primaryTerm, ParsedDocument doc, long version) {, +            this(uid, doc, SequenceNumbers.UNASSIGNED_SEQ_NO, primaryTerm, version, VersionType.INTERNAL,, +        public Delete(String type, String id, Term uid, long primaryTerm) {, +            this(type, id, uid, SequenceNumbers.UNASSIGNED_SEQ_NO, primaryTerm, Versions.MATCH_ANY, VersionType.INTERNAL, Origin.PRIMARY, System.nanoTime());, +++ b/server/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +    private final LongSupplier primaryTermSupplier;, +                        LongSupplier globalCheckpointSupplier, LongSupplier primaryTermSupplier) {, +        this.primaryTermSupplier = primaryTermSupplier;, +, +    /**, +     * Returns a supplier that supplies the latest primary term value of the associated shard., +     */, +    public LongSupplier getPrimaryTermSupplier() {, +        return primaryTermSupplier;, +    }, +++ b/server/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +        return new Translog(translogConfig, translogUUID, translogDeletionPolicy, globalCheckpointSupplier, engineConfig.getPrimaryTermSupplier());, +++ b/server/src/main/java/org/elasticsearch/index/IndexSettings.java, +             * An empty translog occupies 55 bytes on disk. If the flush threshold is below this, the flush thread, +                     * An empty translog occupies 55 bytes on disk. If the generation threshold is, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        public Index(Term uid, long primaryTerm, ParsedDocument doc) {, +            this(uid, primaryTerm, doc, Versions.MATCH_ANY);, +        Index(Term uid, long primaryTerm, ParsedDocument doc, long version) {, +            this(uid, doc, SequenceNumbers.UNASSIGNED_SEQ_NO, primaryTerm, version, VersionType.INTERNAL,, +        public Delete(String type, String id, Term uid, long primaryTerm) {, +            this(type, id, uid, SequenceNumbers.UNASSIGNED_SEQ_NO, primaryTerm, Versions.MATCH_ANY, VersionType.INTERNAL, Origin.PRIMARY, System.nanoTime());, +++ b/server/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +    private final LongSupplier primaryTermSupplier;, +                        LongSupplier globalCheckpointSupplier, LongSupplier primaryTermSupplier) {, +        this.primaryTermSupplier = primaryTermSupplier;, +, +    /**, +     * Returns a supplier that supplies the latest primary term value of the associated shard., +     */, +    public LongSupplier getPrimaryTermSupplier() {, +        return primaryTermSupplier;, +    }, +++ b/server/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +        return new Translog(translogConfig, translogUUID, translogDeletionPolicy, globalCheckpointSupplier, engineConfig.getPrimaryTermSupplier());, +++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +            indexSort, this::runTranslogRecovery, circuitBreakerService, replicationTracker, this::getPrimaryTerm);, +++ b/server/src/main/java/org/elasticsearch/index/IndexSettings.java, +             * An empty translog occupies 55 bytes on disk. If the flush threshold is below this, the flush thread, +                     * An empty translog occupies 55 bytes on disk. If the generation threshold is, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        public Index(Term uid, long primaryTerm, ParsedDocument doc) {, +            this(uid, primaryTerm, doc, Versions.MATCH_ANY);, +        Index(Term uid, long primaryTerm, ParsedDocument doc, long version) {, +            this(uid, doc, SequenceNumbers.UNASSIGNED_SEQ_NO, primaryTerm, version, VersionType.INTERNAL,, +        public Delete(String type, String id, Term uid, long primaryTerm) {, +            this(type, id, uid, SequenceNumbers.UNASSIGNED_SEQ_NO, primaryTerm, Versions.MATCH_ANY, VersionType.INTERNAL, Origin.PRIMARY, System.nanoTime());, +++ b/server/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +    private final LongSupplier primaryTermSupplier;, +                        LongSupplier globalCheckpointSupplier, LongSupplier primaryTermSupplier) {, +        this.primaryTermSupplier = primaryTermSupplier;, +, +    /**, +     * Returns a supplier that supplies the latest primary term value of the associated shard., +     */]