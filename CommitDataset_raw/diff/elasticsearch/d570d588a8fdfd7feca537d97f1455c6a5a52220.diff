[+++ b/src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsTests.java, +                        .put("number_of_shards", between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsTests.java, +                        .put("number_of_shards", between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/cluster/ack/AckTests.java, +                .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsTests.java, +                        .put("number_of_shards", between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/cluster/ack/AckTests.java, +                .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/index/suggest/stats/SuggestStatsTests.java, +        final int numNodes = immutableCluster().dataNodes();, +++ b/src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsTests.java, +                        .put("number_of_shards", between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/cluster/ack/AckTests.java, +                .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/index/suggest/stats/SuggestStatsTests.java, +        final int numNodes = immutableCluster().dataNodes();, +++ b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java, +        assertAcked(prepareCreate("test").setSettings(settingsBuilder().put("index.number_of_shards", immutableCluster().dataNodes()+2).put("index.number_of_replicas", 0)));, +++ b/src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsTests.java, +                        .put("number_of_shards", between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/cluster/ack/AckTests.java, +                .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/index/suggest/stats/SuggestStatsTests.java, +        final int numNodes = immutableCluster().dataNodes();, +++ b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java, +        assertAcked(prepareCreate("test").setSettings(settingsBuilder().put("index.number_of_shards", immutableCluster().dataNodes()+2).put("index.number_of_replicas", 0)));, +++ b/src/test/java/org/elasticsearch/search/stats/SearchStatsTests.java, +        final int numNodes = immutableCluster().dataNodes();, +++ b/src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsTests.java, +                        .put("number_of_shards", between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/cluster/ack/AckTests.java, +                .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/index/suggest/stats/SuggestStatsTests.java, +        final int numNodes = immutableCluster().dataNodes();, +++ b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java, +        assertAcked(prepareCreate("test").setSettings(settingsBuilder().put("index.number_of_shards", immutableCluster().dataNodes()+2).put("index.number_of_replicas", 0)));, +++ b/src/test/java/org/elasticsearch/search/stats/SearchStatsTests.java, +        final int numNodes = immutableCluster().dataNodes();, +++ b/src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java, +        return immutableCluster().dataNodes() - 1;, +++ b/src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsTests.java, +                        .put("number_of_shards", between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/cluster/ack/AckTests.java, +                .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/index/suggest/stats/SuggestStatsTests.java, +        final int numNodes = immutableCluster().dataNodes();, +++ b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java, +        assertAcked(prepareCreate("test").setSettings(settingsBuilder().put("index.number_of_shards", immutableCluster().dataNodes()+2).put("index.number_of_replicas", 0)));, +++ b/src/test/java/org/elasticsearch/search/stats/SearchStatsTests.java, +        final int numNodes = immutableCluster().dataNodes();, +++ b/src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java, +        return immutableCluster().dataNodes() - 1;, +++ b/src/test/java/org/elasticsearch/test/ImmutableTestCluster.java, +     * Returns the number of data nodes in the cluster., +     */, +    public abstract int dataNodes();, +, +    /**, +++ b/src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsTests.java, +                        .put("number_of_shards", between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/cluster/ack/AckTests.java, +                .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +                        .put(SETTING_NUMBER_OF_SHARDS, between(immutableCluster().dataNodes(), DEFAULT_MAX_NUM_SHARDS)), +++ b/src/test/java/org/elasticsearch/index/suggest/stats/SuggestStatsTests.java, +        final int numNodes = immutableCluster().dataNodes();, +++ b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java, +        assertAcked(prepareCreate("test").setSettings(settingsBuilder().put("index.number_of_shards", immutableCluster().dataNodes()+2).put("index.number_of_replicas", 0)));, +++ b/src/test/java/org/elasticsearch/search/stats/SearchStatsTests.java, +        final int numNodes = immutableCluster().dataNodes();, +++ b/src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java, +        return immutableCluster().dataNodes() - 1;, +++ b/src/test/java/org/elasticsearch/test/ImmutableTestCluster.java, +     * Returns the number of data nodes in the cluster., +     */, +    public abstract int dataNodes();, +, +    /**, +++ b/src/test/java/org/elasticsearch/test/TestCluster.java]