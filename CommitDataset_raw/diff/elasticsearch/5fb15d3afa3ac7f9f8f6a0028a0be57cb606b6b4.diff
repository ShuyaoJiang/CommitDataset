[+++ b/src/main/java/org/elasticsearch/index/percolator/PercolatorQueriesRegistry.java, +        public void afterIndexShardPostRecovery(IndexShard indexShard) {, +                // Maybe add a mode load? This isn't really a write. We need write b/c state=post_recovery, +                Engine.Searcher searcher = shard.acquireSearcher("percolator_load_queries", IndexShard.Mode.WRITE);, +++ b/src/main/java/org/elasticsearch/index/percolator/PercolatorQueriesRegistry.java, +        public void afterIndexShardPostRecovery(IndexShard indexShard) {, +                // Maybe add a mode load? This isn't really a write. We need write b/c state=post_recovery, +                Engine.Searcher searcher = shard.acquireSearcher("percolator_load_queries", IndexShard.Mode.WRITE);, +++ b/src/main/java/org/elasticsearch/index/shard/service/IndexShard.java, +import org.elasticsearch.index.shard.IllegalIndexShardStateException;, +    void readAllowed() throws IllegalIndexShardStateException;, +, +    void readAllowed(Mode mode) throws IllegalIndexShardStateException;, +, +++ b/src/main/java/org/elasticsearch/index/percolator/PercolatorQueriesRegistry.java, +        public void afterIndexShardPostRecovery(IndexShard indexShard) {, +                // Maybe add a mode load? This isn't really a write. We need write b/c state=post_recovery, +                Engine.Searcher searcher = shard.acquireSearcher("percolator_load_queries", IndexShard.Mode.WRITE);, +++ b/src/main/java/org/elasticsearch/index/shard/service/IndexShard.java, +import org.elasticsearch.index.shard.IllegalIndexShardStateException;, +    void readAllowed() throws IllegalIndexShardStateException;, +, +    void readAllowed(Mode mode) throws IllegalIndexShardStateException;, +, +++ b/src/main/java/org/elasticsearch/index/shard/service/InternalIndexShard.java, +        indicesLifecycle.afterIndexShardPostRecovery(this);, +        indicesLifecycle.afterIndexShardPostRecovery(this);, +++ b/src/main/java/org/elasticsearch/index/percolator/PercolatorQueriesRegistry.java, +        public void afterIndexShardPostRecovery(IndexShard indexShard) {, +                // Maybe add a mode load? This isn't really a write. We need write b/c state=post_recovery, +                Engine.Searcher searcher = shard.acquireSearcher("percolator_load_queries", IndexShard.Mode.WRITE);, +++ b/src/main/java/org/elasticsearch/index/shard/service/IndexShard.java, +import org.elasticsearch.index.shard.IllegalIndexShardStateException;, +    void readAllowed() throws IllegalIndexShardStateException;, +, +    void readAllowed(Mode mode) throws IllegalIndexShardStateException;, +, +++ b/src/main/java/org/elasticsearch/index/shard/service/InternalIndexShard.java, +        indicesLifecycle.afterIndexShardPostRecovery(this);, +        indicesLifecycle.afterIndexShardPostRecovery(this);, +++ b/src/main/java/org/elasticsearch/indices/IndicesLifecycle.java, +        public void afterIndexShardPostRecovery(IndexShard indexShard) {, +, +        }, +, +++ b/src/main/java/org/elasticsearch/index/percolator/PercolatorQueriesRegistry.java, +        public void afterIndexShardPostRecovery(IndexShard indexShard) {, +                // Maybe add a mode load? This isn't really a write. We need write b/c state=post_recovery, +                Engine.Searcher searcher = shard.acquireSearcher("percolator_load_queries", IndexShard.Mode.WRITE);, +++ b/src/main/java/org/elasticsearch/index/shard/service/IndexShard.java, +import org.elasticsearch.index.shard.IllegalIndexShardStateException;, +    void readAllowed() throws IllegalIndexShardStateException;, +, +    void readAllowed(Mode mode) throws IllegalIndexShardStateException;, +, +++ b/src/main/java/org/elasticsearch/index/shard/service/InternalIndexShard.java, +        indicesLifecycle.afterIndexShardPostRecovery(this);, +        indicesLifecycle.afterIndexShardPostRecovery(this);, +++ b/src/main/java/org/elasticsearch/indices/IndicesLifecycle.java, +        public void afterIndexShardPostRecovery(IndexShard indexShard) {, +, +        }, +, +++ b/src/main/java/org/elasticsearch/indices/InternalIndicesLifecycle.java, +    public void afterIndexShardPostRecovery(IndexShard indexShard) {, +        for (Listener listener : listeners) {, +            try {, +                listener.afterIndexShardPostRecovery(indexShard);, +            } catch (Throwable t) {, +                logger.warn("{} failed to invoke after shard post recovery callback", t, indexShard.shardId());, +            }, +        }, +    }, +, +++ b/src/main/java/org/elasticsearch/index/percolator/PercolatorQueriesRegistry.java, +        public void afterIndexShardPostRecovery(IndexShard indexShard) {, +                // Maybe add a mode load? This isn't really a write. We need write b/c state=post_recovery, +                Engine.Searcher searcher = shard.acquireSearcher("percolator_load_queries", IndexShard.Mode.WRITE);, +++ b/src/main/java/org/elasticsearch/index/shard/service/IndexShard.java, +import org.elasticsearch.index.shard.IllegalIndexShardStateException;, +    void readAllowed() throws IllegalIndexShardStateException;, +, +    void readAllowed(Mode mode) throws IllegalIndexShardStateException;, +, +++ b/src/main/java/org/elasticsearch/index/shard/service/InternalIndexShard.java, +        indicesLifecycle.afterIndexShardPostRecovery(this);, +        indicesLifecycle.afterIndexShardPostRecovery(this);, +++ b/src/main/java/org/elasticsearch/indices/IndicesLifecycle.java, +        public void afterIndexShardPostRecovery(IndexShard indexShard) {, +, +        }, +, +++ b/src/main/java/org/elasticsearch/indices/InternalIndicesLifecycle.java, +    public void afterIndexShardPostRecovery(IndexShard indexShard) {, +        for (Listener listener : listeners) {, +            try {, +                listener.afterIndexShardPostRecovery(indexShard);, +            } catch (Throwable t) {, +                logger.warn("{} failed to invoke after shard post recovery callback", t, indexShard.shardId());, +            }]