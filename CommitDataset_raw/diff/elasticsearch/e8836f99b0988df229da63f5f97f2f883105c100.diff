[+++ b/qa/rolling-upgrade/build.gradle, +dependencies {, +    testCompile project(path: ':x-plugins:elasticsearch', configuration: 'runtime'), +}, +, +// copy x-pack plugin info so it is on the classpath and security manager has the right permissions, +String outputDir = "generated-resources/${project.name}", +task copyXPackPluginProps(type: Copy) {, +    from project(':x-plugins:elasticsearch').file('src/main/plugin-metadata'), +    from project(':x-plugins:elasticsearch').tasks.pluginProperties, +    into outputDir, +}, +project.sourceSets.test.output.dir(outputDir, builtBy: copyXPackPluginProps), +, +++ b/qa/rolling-upgrade/build.gradle, +dependencies {, +    testCompile project(path: ':x-plugins:elasticsearch', configuration: 'runtime'), +}, +, +// copy x-pack plugin info so it is on the classpath and security manager has the right permissions, +String outputDir = "generated-resources/${project.name}", +task copyXPackPluginProps(type: Copy) {, +    from project(':x-plugins:elasticsearch').file('src/main/plugin-metadata'), +    from project(':x-plugins:elasticsearch').tasks.pluginProperties, +    into outputDir, +}, +project.sourceSets.test.output.dir(outputDir, builtBy: copyXPackPluginProps), +, +++ b/qa/rolling-upgrade/src/test/resources/rest-api-spec/test/mixed_cluster/20_security.yaml, +---, +"Verify user and role in mixed cluster":, +  - do:, +      headers:, +        Authorization: "Basic bmF0aXZlX3VzZXI6Y2hhbmdlbWU=", +      cluster.health:, +        wait_for_status: yellow, +        wait_for_nodes: 2, +        timeout: 25s, +  - match: { timed_out: false }, +, +  - do:, +      xpack.security.get_user:, +        username: "native_user", +  - match: { native_user.username:  "native_user" }, +  - match: { native_user.roles.0:  "native_role" }, +, +  - do:, +      xpack.security.get_role:, +        name: "native_role", +  - match: { native_role.cluster.0:  "all" }, +  - match: { native_role.indices.0.names.0: "test_index" }, +  - match: { native_role.indices.0.privileges.0:  "all" }, +, +  - do:, +      xpack.security.clear_cached_roles:, +        name: "native_role", +, +  - do:, +      xpack.security.clear_cached_realms:, +        realms: "_all", +++ b/qa/rolling-upgrade/build.gradle, +dependencies {, +    testCompile project(path: ':x-plugins:elasticsearch', configuration: 'runtime'), +}, +, +// copy x-pack plugin info so it is on the classpath and security manager has the right permissions, +String outputDir = "generated-resources/${project.name}", +task copyXPackPluginProps(type: Copy) {, +    from project(':x-plugins:elasticsearch').file('src/main/plugin-metadata'), +    from project(':x-plugins:elasticsearch').tasks.pluginProperties, +    into outputDir, +}, +project.sourceSets.test.output.dir(outputDir, builtBy: copyXPackPluginProps), +, +++ b/qa/rolling-upgrade/src/test/resources/rest-api-spec/test/mixed_cluster/20_security.yaml, +---, +"Verify user and role in mixed cluster":, +  - do:, +      headers:, +        Authorization: "Basic bmF0aXZlX3VzZXI6Y2hhbmdlbWU=", +      cluster.health:, +        wait_for_status: yellow, +        wait_for_nodes: 2, +        timeout: 25s, +  - match: { timed_out: false }, +, +  - do:, +      xpack.security.get_user:, +        username: "native_user", +  - match: { native_user.username:  "native_user" }, +  - match: { native_user.roles.0:  "native_role" }, +, +  - do:, +      xpack.security.get_role:, +        name: "native_role", +  - match: { native_role.cluster.0:  "all" }, +  - match: { native_role.indices.0.names.0: "test_index" }, +  - match: { native_role.indices.0.privileges.0:  "all" }, +, +  - do:]