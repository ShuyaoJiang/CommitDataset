[+++ b/src/main/java/org/elasticsearch/index/translog/Translog.java, +            boolean removed = outstandingViews.remove(view);, +            assert removed : "View was never set but was supposed to be removed";, +        final ReleasableBytesStreamOutput out = new ReleasableBytesStreamOutput(bigArrays);, +            final long end = out.position();, +            final int operationSize = (int) (end - RamUsageEstimator.NUM_BYTES_INT - start);, +            final ReleasablePagedBytesReference bytes = out.bytes();, +    /**, +     * The number of currently open views, +     */, +    int getNumOpenViews() {, +        return outstandingViews.size();, +    }, +, +++ b/src/main/java/org/elasticsearch/index/translog/Translog.java, +            boolean removed = outstandingViews.remove(view);, +            assert removed : "View was never set but was supposed to be removed";, +        final ReleasableBytesStreamOutput out = new ReleasableBytesStreamOutput(bigArrays);, +            final long end = out.position();, +            final int operationSize = (int) (end - RamUsageEstimator.NUM_BYTES_INT - start);, +            final ReleasablePagedBytesReference bytes = out.bytes();, +    /**, +     * The number of currently open views, +     */, +    int getNumOpenViews() {, +        return outstandingViews.size();, +    }, +, +++ b/src/test/java/org/elasticsearch/index/translog/TranslogTests.java, +import org.apache.lucene.util.LuceneTestCase;, +@LuceneTestCase.SuppressFileSystems("ExtrasFS"), +            assertEquals("there are still open views", 0, translog.getNumOpenViews());]