[+++ b/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/transport/nio/SSLDriver.java, +        Mode modePriorToRead;, +        do {, +            modePriorToRead = currentMode;, +            // If we switched modes we want to read again as there might be unhandled bytes that need to be, +            // handled by the new mode., +        } while (modePriorToRead != currentMode);, +                    // If we are done handshaking we should exit the handshake read, +                    continueUnwrap = result.bytesConsumed() > 0 && currentMode.isHandshake();]