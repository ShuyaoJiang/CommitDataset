[+++ b/server/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +                        promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +                    promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +    private void promoteReplicaToPrimary(ShardRouting activeReplica, RoutingChangesObserver routingChangesObserver) {, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +                        promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +                    promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +    private void promoteReplicaToPrimary(ShardRouting activeReplica, RoutingChangesObserver routingChangesObserver) {, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +                        set.add(new PlainShardIterator(shardRouting.shardId(), Collections.emptyList()));, +                    set.add(new PlainShardIterator(primary.shardId(), Collections.emptyList()));, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +                        promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +                    promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +    private void promoteReplicaToPrimary(ShardRouting activeReplica, RoutingChangesObserver routingChangesObserver) {, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +                        set.add(new PlainShardIterator(shardRouting.shardId(), Collections.emptyList()));, +                    set.add(new PlainShardIterator(primary.shardId(), Collections.emptyList()));, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/DiskThresholdSettings.java, +        setFloodStage(floodStage);, +        clusterSettings.addSettingsUpdateConsumer(CLUSTER_ROUTING_ALLOCATION_DISK_FLOOD_STAGE_WATERMARK_SETTING, this::setFloodStage);, +    private void setFloodStage(String floodStageRaw) {, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +                        promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +                    promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +    private void promoteReplicaToPrimary(ShardRouting activeReplica, RoutingChangesObserver routingChangesObserver) {, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +                        set.add(new PlainShardIterator(shardRouting.shardId(), Collections.emptyList()));, +                    set.add(new PlainShardIterator(primary.shardId(), Collections.emptyList()));, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/DiskThresholdSettings.java, +        setFloodStage(floodStage);, +        clusterSettings.addSettingsUpdateConsumer(CLUSTER_ROUTING_ALLOCATION_DISK_FLOOD_STAGE_WATERMARK_SETTING, this::setFloodStage);, +    private void setFloodStage(String floodStageRaw) {, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +                        promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +                    promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +    private void promoteReplicaToPrimary(ShardRouting activeReplica, RoutingChangesObserver routingChangesObserver) {, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +                        set.add(new PlainShardIterator(shardRouting.shardId(), Collections.emptyList()));, +                    set.add(new PlainShardIterator(primary.shardId(), Collections.emptyList()));, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/DiskThresholdSettings.java, +        setFloodStage(floodStage);, +        clusterSettings.addSettingsUpdateConsumer(CLUSTER_ROUTING_ALLOCATION_DISK_FLOOD_STAGE_WATERMARK_SETTING, this::setFloodStage);, +    private void setFloodStage(String floodStageRaw) {, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +                        promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +                    promoteReplicaToPrimary(activeReplica, routingChangesObserver);, +    private void promoteReplicaToPrimary(ShardRouting activeReplica, RoutingChangesObserver routingChangesObserver) {, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +                        set.add(new PlainShardIterator(shardRouting.shardId(), Collections.emptyList()));, +                    set.add(new PlainShardIterator(primary.shardId(), Collections.emptyList()));, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/DiskThresholdSettings.java, +        setFloodStage(floodStage);, +        clusterSettings.addSettingsUpdateConsumer(CLUSTER_ROUTING_ALLOCATION_DISK_FLOOD_STAGE_WATERMARK_SETTING, this::setFloodStage);, +    private void setFloodStage(String floodStageRaw) {, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java, +++ b/server/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java]