[+++ b/plugin/src/test/java/org/elasticsearch/xpack/test/rest/XPackRestIT.java, +import static org.hamcrest.Matchers.is;, +, +        // ensure watcher is started, so that a test can stop watcher and everything still works fine, +        if (isWatcherTest()) {, +            assertBusy(() -> {, +                try {, +                    ClientYamlTestResponse response =, +                            getAdminExecutionContext().callApi("xpack.watcher.stats", emptyMap(), emptyList(), emptyMap());, +                    String state = (String) response.evaluate("stats.0.watcher_state");, +                    if ("started".equals(state) == false) {, +                        getAdminExecutionContext().callApi("xpack.watcher.start", emptyMap(), emptyList(), emptyMap());, +                    }, +                    // assertion required to exit the assertBusy lambda, +                    assertThat(state, is("started"));, +                } catch (IOException e) {, +                    throw new AssertionError(e);, +                }, +            });, +        }, +        if (isMachineLearningTest()) {, +    }, +, +    private boolean isWatcherTest() {, +        String testName = getTestName();, +        return testName != null && (testName.contains("=watcher/") || testName.contains("=watcher\\"));, +    }, +, +    private boolean isMachineLearningTest() {, +        String testName = getTestName();, +        return testName != null && (testName.contains("=ml/") || testName.contains("=ml\\"));, +    }]