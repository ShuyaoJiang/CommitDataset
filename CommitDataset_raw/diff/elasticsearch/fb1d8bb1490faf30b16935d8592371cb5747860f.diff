[+++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +        int allocatedProcessors;, +            allocatedProcessors += nodeInfo.getOs().getAllocatedProcessors();, +, +        public int getAllocatedProcessors() {, +            return allocatedProcessors;, +        }, +, +            allocatedProcessors = in.readVInt();, +            out.writeVInt(allocatedProcessors);, +            static final XContentBuilderString ALLOCATED_PROCESSORS = new XContentBuilderString("allocated_processors");, +            builder.field(Fields.ALLOCATED_PROCESSORS, allocatedProcessors);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +        int allocatedProcessors;, +            allocatedProcessors += nodeInfo.getOs().getAllocatedProcessors();, +, +        public int getAllocatedProcessors() {, +            return allocatedProcessors;, +        }, +, +            allocatedProcessors = in.readVInt();, +            out.writeVInt(allocatedProcessors);, +            static final XContentBuilderString ALLOCATED_PROCESSORS = new XContentBuilderString("allocated_processors");, +            builder.field(Fields.ALLOCATED_PROCESSORS, allocatedProcessors);, +++ b/core/src/main/java/org/elasticsearch/monitor/os/OsInfo.java, +    int allocatedProcessors;, +, +    public int getAllocatedProcessors() {, +        return this.allocatedProcessors;, +    }, +, +        static final XContentBuilderString ALLOCATED_PROCESSORS = new XContentBuilderString("allocated_processors");, +        builder.field(Fields.ALLOCATED_PROCESSORS, allocatedProcessors);, +        allocatedProcessors = in.readInt();, +        out.writeInt(allocatedProcessors);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +        int allocatedProcessors;, +            allocatedProcessors += nodeInfo.getOs().getAllocatedProcessors();, +, +        public int getAllocatedProcessors() {, +            return allocatedProcessors;, +        }, +, +            allocatedProcessors = in.readVInt();, +            out.writeVInt(allocatedProcessors);, +            static final XContentBuilderString ALLOCATED_PROCESSORS = new XContentBuilderString("allocated_processors");, +            builder.field(Fields.ALLOCATED_PROCESSORS, allocatedProcessors);, +++ b/core/src/main/java/org/elasticsearch/monitor/os/OsInfo.java, +    int allocatedProcessors;, +, +    public int getAllocatedProcessors() {, +        return this.allocatedProcessors;, +    }, +, +        static final XContentBuilderString ALLOCATED_PROCESSORS = new XContentBuilderString("allocated_processors");, +        builder.field(Fields.ALLOCATED_PROCESSORS, allocatedProcessors);, +        allocatedProcessors = in.readInt();, +        out.writeInt(allocatedProcessors);, +++ b/core/src/main/java/org/elasticsearch/monitor/os/OsService.java, +import org.elasticsearch.common.util.concurrent.EsExecutors;, +        this.info.allocatedProcessors = EsExecutors.boundedNumberOfProcessors(settings);, +, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +        int allocatedProcessors;, +            allocatedProcessors += nodeInfo.getOs().getAllocatedProcessors();, +, +        public int getAllocatedProcessors() {, +            return allocatedProcessors;, +        }, +, +            allocatedProcessors = in.readVInt();, +            out.writeVInt(allocatedProcessors);, +            static final XContentBuilderString ALLOCATED_PROCESSORS = new XContentBuilderString("allocated_processors");, +            builder.field(Fields.ALLOCATED_PROCESSORS, allocatedProcessors);, +++ b/core/src/main/java/org/elasticsearch/monitor/os/OsInfo.java, +    int allocatedProcessors;, +, +    public int getAllocatedProcessors() {, +        return this.allocatedProcessors;, +    }, +, +        static final XContentBuilderString ALLOCATED_PROCESSORS = new XContentBuilderString("allocated_processors");, +        builder.field(Fields.ALLOCATED_PROCESSORS, allocatedProcessors);, +        allocatedProcessors = in.readInt();, +        out.writeInt(allocatedProcessors);, +++ b/core/src/main/java/org/elasticsearch/monitor/os/OsService.java, +import org.elasticsearch.common.util.concurrent.EsExecutors;, +        this.info.allocatedProcessors = EsExecutors.boundedNumberOfProcessors(settings);, +, +++ b/core/src/test/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsIT.java, +import org.elasticsearch.common.util.concurrent.EsExecutors;, +import static org.hamcrest.Matchers.equalTo;, +, +    public void testAllocatedProcessors() throws Exception {, +        // stop all other nodes, +        internalCluster().ensureAtMostNumDataNodes(0);, +, +        // start one node with 7 processors., +        internalCluster().startNodesAsync(Settings.builder().put(EsExecutors.PROCESSORS, 7).build()).get();, +        waitForNodes(1);]