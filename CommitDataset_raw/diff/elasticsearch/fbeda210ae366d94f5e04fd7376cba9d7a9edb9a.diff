[+++ b/elasticsearch/qa/shield-audit-tests/src/test/java/org/elasticsearch/shield/audit/IndexAuditIT.java, +import org.elasticsearch.cluster.ClusterState;, +import java.util.concurrent.atomic.AtomicBoolean;, +import java.util.concurrent.atomic.AtomicReference;, +        HttpResponse response = httpClient().path("/"), +        final AtomicReference<ClusterState> lastClusterState = new AtomicReference<>();, +        final AtomicBoolean indexExists = new AtomicBoolean(false);, +            if (indexExists.get() == false) {, +                ClusterState state = client().admin().cluster().prepareState().get().getState();, +                lastClusterState.set(state);, +                for (ObjectCursor<String> cursor : state.getMetaData().getIndices().keys()) {, +                        logger.info("found audit index [{}]", cursor.value);, +                        indexExists.set(true);, +, +                if (indexExists.get() == false) {, +            }, +            ensureYellow(".shield_audit_log*");, +            ClusterState state = client().admin().cluster().prepareState().get().getState();, +            lastClusterState.set(state);, +        if (!found) {, +            logger.info("current cluster state: {}", lastClusterState.get());, +        }]