[+++ b/server/src/main/java/org/elasticsearch/gateway/GatewayService.java, +                threadPool.schedule(new AbstractRunnable() {, +                    @Override, +                    public void onFailure(Exception e) {, +                        logger.warn("delayed state recovery failed", e);, +                        resetRecoveredFlags();, +                    }, +, +                    @Override, +                    protected void doRun() {, +                    }, +                        logger.warn("state recovery failed", e);, +                        resetRecoveredFlags();, +    private void resetRecoveredFlags() {, +        public void onNoLongerMaster(String source) {, +            logger.debug("stepped down as master before recovering state [{}]", source);, +            resetRecoveredFlags();, +        }, +, +        @Override, +            resetRecoveredFlags();, +            logger.info("state recovery failed: {}", msg);, +            resetRecoveredFlags();]