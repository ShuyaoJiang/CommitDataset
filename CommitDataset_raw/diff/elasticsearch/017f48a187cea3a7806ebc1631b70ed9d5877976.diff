[+++ b/config/elasticsearch.yml, +, +#################################### Plugin ###################################, +, +# If a plugin listed here is not installed for current node, the node will not start., +#, +# plugin.mandatory: mapper-attachments,lang-groovy, +, +, +++ b/config/elasticsearch.yml, +, +#################################### Plugin ###################################, +, +# If a plugin listed here is not installed for current node, the node will not start., +#, +# plugin.mandatory: mapper-attachments,lang-groovy, +, +, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java, +++ b/config/elasticsearch.yml, +, +#################################### Plugin ###################################, +, +# If a plugin listed here is not installed for current node, the node will not start., +#, +# plugin.mandatory: mapper-attachments,lang-groovy, +, +, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java, +++ b/src/main/java/org/elasticsearch/plugins/PluginsService.java, +        Set<String> sitePlugins = sitePlugins();, +        String[] mandatoryPlugins = settings.getAsArray("plugin.mandatory", null);, +        if (mandatoryPlugins != null) {, +            Set<String> missingPlugins = Sets.newHashSet();, +            for (String mandatoryPlugin : mandatoryPlugins) {, +                if (!plugins.containsKey(mandatoryPlugin) && !sitePlugins.contains(mandatoryPlugin) && !missingPlugins.contains(mandatoryPlugin)) {, +                    missingPlugins.add(mandatoryPlugin);, +                }, +            }, +            if (!missingPlugins.isEmpty()) {, +                throw new ElasticSearchException("Missing mandatory plugins " + missingPlugins);, +            }, +        }, +, +        logger.info("loaded {}, sites {}", plugins.keySet(), sitePlugins);]