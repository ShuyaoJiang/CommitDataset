[+++ b/rest-api-spec/test/percolate/18_highligh_with_query.yaml, +---, +"Basic percolation highlight query test":, +, +  - do:, +      indices.create:, +        index: test_index, +, +  - do:, +      index:, +        index: test_index, +        type: .percolator, +        id:  test_percolator, +        body:, +          query:, +            match:, +              foo: bar, +, +  - do:, +      indices.refresh: {}, +, +  - do:, +      percolate:, +        index: test_index, +        type:  test_type, +        body:, +          doc:, +              foo: "bar foo", +          size: 1, +          highlight:, +              fields:, +                foo:, +                    highlight_query:, +                      match:, +                          foo: foo, +, +  - match: {'total': 1}, +++ b/rest-api-spec/test/percolate/18_highligh_with_query.yaml, +---, +"Basic percolation highlight query test":, +, +  - do:, +      indices.create:, +        index: test_index, +, +  - do:, +      index:, +        index: test_index, +        type: .percolator, +        id:  test_percolator, +        body:, +          query:, +            match:, +              foo: bar, +, +  - do:, +      indices.refresh: {}, +, +  - do:, +      percolate:, +        index: test_index, +        type:  test_type, +        body:, +          doc:, +              foo: "bar foo", +          size: 1, +          highlight:, +              fields:, +                foo:, +                    highlight_query:, +                      match:, +                          foo: foo, +, +  - match: {'total': 1}, +++ b/src/main/java/org/elasticsearch/percolator/PercolateContext.java, +    private final ScriptService scriptService;, +    public PercolateContext(PercolateShardRequest request, SearchShardTarget searchShardTarget, IndexShard indexShard,, +                            IndexService indexService, CacheRecycler cacheRecycler, PageCacheRecycler pageCacheRecycler,, +                            ScriptService scriptService) {, +        this.scriptService = scriptService;, +        return indexService.analysisService();, +        return indexService.queryParserService();, +        return indexService.similarityService();, +        return scriptService;, +        return indexService.cache().filter();, +        return indexService.cache().docSet();, +        return indexService.cache().idCache();, +++ b/rest-api-spec/test/percolate/18_highligh_with_query.yaml, +---, +"Basic percolation highlight query test":, +, +  - do:, +      indices.create:, +        index: test_index, +, +  - do:, +      index:, +        index: test_index, +        type: .percolator, +        id:  test_percolator]