[+++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +                // mark as corrupted, so opening the store will fail, +                store.markStoreCorrupted(new IOException("failed engine (reason: [" + reason + "])", failure));, +                logger.warn("failed to mark shard store as corrupted", e);, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +                // mark as corrupted, so opening the store will fail, +                store.markStoreCorrupted(new IOException("failed engine (reason: [" + reason + "])", failure));, +                logger.warn("failed to mark shard store as corrupted", e);, +++ b/core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java, +import org.elasticsearch.index.store.Store;, +    public void testFailShard() throws Exception {, +        createIndex("test");, +        ensureGreen();, +        IndicesService indicesService = getInstanceFromNode(IndicesService.class);, +        NodeEnvironment env = getInstanceFromNode(NodeEnvironment.class);, +        IndexService test = indicesService.indexService("test");, +        IndexShard shard = test.shard(0);, +        // fail shard, +        shard.failShard("test shard fail", new IOException("corrupted"));, +        // check state file still exists, +        ShardStateMetaData shardStateMetaData = load(logger, env.availableShardPaths(shard.shardId));, +        assertEquals(shardStateMetaData, getShardStateMetadata(shard));, +        ShardPath shardPath = ShardPath.loadShardPath(logger, env, shard.shardId(), test.getIndexSettings());, +        assertNotNull(shardPath);, +        // but index can't be opened for a failed shard, +        assertThat("store index should be corrupted", Store.canOpenIndex(logger, shardPath.resolveIndex()), equalTo(false));, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +                // mark as corrupted, so opening the store will fail, +                store.markStoreCorrupted(new IOException("failed engine (reason: [" + reason + "])", failure));, +                logger.warn("failed to mark shard store as corrupted", e);, +++ b/core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java, +import org.elasticsearch.index.store.Store;, +    public void testFailShard() throws Exception {, +        createIndex("test");, +        ensureGreen();, +        IndicesService indicesService = getInstanceFromNode(IndicesService.class);, +        NodeEnvironment env = getInstanceFromNode(NodeEnvironment.class);, +        IndexService test = indicesService.indexService("test");, +        IndexShard shard = test.shard(0);, +        // fail shard, +        shard.failShard("test shard fail", new IOException("corrupted"));, +        // check state file still exists, +        ShardStateMetaData shardStateMetaData = load(logger, env.availableShardPaths(shard.shardId));, +        assertEquals(shardStateMetaData, getShardStateMetadata(shard));, +        ShardPath shardPath = ShardPath.loadShardPath(logger, env, shard.shardId(), test.getIndexSettings());, +        assertNotNull(shardPath);, +        // but index can't be opened for a failed shard, +        assertThat("store index should be corrupted", Store.canOpenIndex(logger, shardPath.resolveIndex()), equalTo(false));, +    }, +, +++ b/docs/reference/getting-started.asciidoc, +A cluster is a collection of one or more nodes (servers) that together holds your entire data and provides federated indexing and search capabilities across all nodes. A cluster is identified by a unique name which by default is "elasticsearch". This name is important because a node can only be part of a cluster if the node is set up to join the cluster by its name., +, +Make sure that you don't reuse the same cluster names in different, +environments, otherwise you might end up with nodes joining the wrong cluster., +For instance you could use `logging-dev`, `logging-stage`, and `logging-prod`, +for the development, staging, and production clusters., +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +                // mark as corrupted, so opening the store will fail, +                store.markStoreCorrupted(new IOException("failed engine (reason: [" + reason + "])", failure));, +                logger.warn("failed to mark shard store as corrupted", e);, +++ b/core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java, +import org.elasticsearch.index.store.Store;, +    public void testFailShard() throws Exception {, +        createIndex("test");, +        ensureGreen();, +        IndicesService indicesService = getInstanceFromNode(IndicesService.class);, +        NodeEnvironment env = getInstanceFromNode(NodeEnvironment.class);, +        IndexService test = indicesService.indexService("test");, +        IndexShard shard = test.shard(0);, +        // fail shard, +        shard.failShard("test shard fail", new IOException("corrupted"));, +        // check state file still exists, +        ShardStateMetaData shardStateMetaData = load(logger, env.availableShardPaths(shard.shardId));, +        assertEquals(shardStateMetaData, getShardStateMetadata(shard));, +        ShardPath shardPath = ShardPath.loadShardPath(logger, env, shard.shardId(), test.getIndexSettings());, +        assertNotNull(shardPath);, +        // but index can't be opened for a failed shard, +        assertThat("store index should be corrupted", Store.canOpenIndex(logger, shardPath.resolveIndex()), equalTo(false));, +    }, +, +++ b/docs/reference/getting-started.asciidoc, +A cluster is a collection of one or more nodes (servers) that together holds your entire data and provides federated indexing and search capabilities across all nodes. A cluster is identified by a unique name which by default is "elasticsearch". This name is important because a node can only be part of a cluster if the node is set up to join the cluster by its name., +, +Make sure that you don't reuse the same cluster names in different, +environments, otherwise you might end up with nodes joining the wrong cluster., +For instance you could use `logging-dev`, `logging-stage`, and `logging-prod`, +for the development, staging, and production clusters., +++ b/docs/reference/modules/snapshots.asciidoc, +PUT /_snapshot/my_backup, +{, +  "type": "fs",, +}, +GET /_snapshot/my_backup, +// AUTOSENSE, +, +which returns:, +]