[+++ b/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                    //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                    Query fuzzyQuery = currentMapper.fuzzyQuery(termStr, minSimilarity, fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                    //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                    Query fuzzyQuery = currentMapper.fuzzyQuery(termStr, minSimilarity, fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +    Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions);, +    Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions);, +++ b/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                    //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                    Query fuzzyQuery = currentMapper.fuzzyQuery(termStr, minSimilarity, fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +    Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions);, +    Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions);, +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +        int edits = FuzzyQuery.floatToEdits(Float.parseFloat(minSim), value.codePointCount(0, value.length()));, +        return new FuzzyQuery(names.createIndexNameTerm(indexedValue(value)), edits, prefixLength, maxExpansions, transpositions);, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +        int edits = FuzzyQuery.floatToEdits((float) minSim, value.codePointCount(0, value.length()));, +        return new FuzzyQuery(names.createIndexNameTerm(indexedValue(value)), edits, prefixLength, maxExpansions, transpositions);, +++ b/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                    //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                    Query fuzzyQuery = currentMapper.fuzzyQuery(termStr, minSimilarity, fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +    Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions);, +    Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions);, +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +        int edits = FuzzyQuery.floatToEdits(Float.parseFloat(minSim), value.codePointCount(0, value.length()));, +        return new FuzzyQuery(names.createIndexNameTerm(indexedValue(value)), edits, prefixLength, maxExpansions, transpositions);, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +        int edits = FuzzyQuery.floatToEdits((float) minSim, value.codePointCount(0, value.length()));, +        return new FuzzyQuery(names.createIndexNameTerm(indexedValue(value)), edits, prefixLength, maxExpansions, transpositions);, +++ b/src/main/java/org/elasticsearch/index/mapper/core/ByteFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +++ b/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                    //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                    Query fuzzyQuery = currentMapper.fuzzyQuery(termStr, minSimilarity, fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +    Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions);, +    Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions);, +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +        int edits = FuzzyQuery.floatToEdits(Float.parseFloat(minSim), value.codePointCount(0, value.length()));, +        return new FuzzyQuery(names.createIndexNameTerm(indexedValue(value)), edits, prefixLength, maxExpansions, transpositions);, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +        int edits = FuzzyQuery.floatToEdits((float) minSim, value.codePointCount(0, value.length()));, +        return new FuzzyQuery(names.createIndexNameTerm(indexedValue(value)), edits, prefixLength, maxExpansions, transpositions);, +++ b/src/main/java/org/elasticsearch/index/mapper/core/ByteFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +++ b/src/main/java/org/elasticsearch/index/mapper/core/DateFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +++ b/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                    //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                    Query fuzzyQuery = currentMapper.fuzzyQuery(termStr, minSimilarity, fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +    Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions);, +    Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions);, +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +        int edits = FuzzyQuery.floatToEdits(Float.parseFloat(minSim), value.codePointCount(0, value.length()));, +        return new FuzzyQuery(names.createIndexNameTerm(indexedValue(value)), edits, prefixLength, maxExpansions, transpositions);, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +        int edits = FuzzyQuery.floatToEdits((float) minSim, value.codePointCount(0, value.length()));, +        return new FuzzyQuery(names.createIndexNameTerm(indexedValue(value)), edits, prefixLength, maxExpansions, transpositions);, +++ b/src/main/java/org/elasticsearch/index/mapper/core/ByteFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +++ b/src/main/java/org/elasticsearch/index/mapper/core/DateFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +++ b/src/main/java/org/elasticsearch/index/mapper/core/DoubleFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +++ b/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                    //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                    Query fuzzyQuery = currentMapper.fuzzyQuery(termStr, minSimilarity, fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +    Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions);, +    Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions);, +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +        int edits = FuzzyQuery.floatToEdits(Float.parseFloat(minSim), value.codePointCount(0, value.length()));, +        return new FuzzyQuery(names.createIndexNameTerm(indexedValue(value)), edits, prefixLength, maxExpansions, transpositions);, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +        int edits = FuzzyQuery.floatToEdits((float) minSim, value.codePointCount(0, value.length()));, +        return new FuzzyQuery(names.createIndexNameTerm(indexedValue(value)), edits, prefixLength, maxExpansions, transpositions);, +++ b/src/main/java/org/elasticsearch/index/mapper/core/ByteFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +++ b/src/main/java/org/elasticsearch/index/mapper/core/DateFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +    public Query fuzzyQuery(String value, double minSim, int prefixLength, int maxExpansions, boolean transpositions) {, +++ b/src/main/java/org/elasticsearch/index/mapper/core/DoubleFieldMapper.java, +    public Query fuzzyQuery(String value, String minSim, int prefixLength, int maxExpansions, boolean transpositions) {]