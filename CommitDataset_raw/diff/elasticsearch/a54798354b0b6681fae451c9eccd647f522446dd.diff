[+++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregator.java, +            bufferingNestedLeafBucketCollector.processBufferedChildBuckets();, +                processBufferedChildBuckets();, +        void processBufferedChildBuckets() throws IOException {, +            final int prevParentDoc = parentDocs.prevSetBit(currentParentDoc - 1);, +            for (; childDocId < currentParentDoc; childDocId = childDocs.nextDoc()) {, +                final long[] buffer = bucketBuffer.buffer;, +                final int size = bucketBuffer.size();]