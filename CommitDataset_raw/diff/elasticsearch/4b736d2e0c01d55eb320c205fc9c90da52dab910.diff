[+++ b/core/src/main/java/org/elasticsearch/action/suggest/TransportSuggestAction.java, +import org.elasticsearch.index.query.QueryShardContext;, +        QueryShardContext shardContext = indexShard.getQueryShardContext();, +                final SuggestionSearchContext context = suggestPhase.parseElement().parseInternal(parser, indexShard.getQueryShardContext());, +++ b/core/src/main/java/org/elasticsearch/action/suggest/TransportSuggestAction.java, +import org.elasticsearch.index.query.QueryShardContext;, +        QueryShardContext shardContext = indexShard.getQueryShardContext();, +                final SuggestionSearchContext context = suggestPhase.parseElement().parseInternal(parser, indexShard.getQueryShardContext());, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestContextParser.java, +import org.elasticsearch.index.query.QueryShardContext;, +    SuggestionSearchContext.SuggestionContext parse(XContentParser parser, QueryShardContext shardContext) throws IOException;, +++ b/core/src/main/java/org/elasticsearch/action/suggest/TransportSuggestAction.java, +import org.elasticsearch.index.query.QueryShardContext;, +        QueryShardContext shardContext = indexShard.getQueryShardContext();, +                final SuggestionSearchContext context = suggestPhase.parseElement().parseInternal(parser, indexShard.getQueryShardContext());, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestContextParser.java, +import org.elasticsearch.index.query.QueryShardContext;, +    SuggestionSearchContext.SuggestionContext parse(XContentParser parser, QueryShardContext shardContext) throws IOException;, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestParseElement.java, +import org.elasticsearch.index.query.QueryShardContext;, +        SuggestionSearchContext suggestionSearchContext = parseInternal(parser, context.indexShard().getQueryShardContext());, +    public SuggestionSearchContext parseInternal(XContentParser parser, QueryShardContext shardContext) throws IOException {, +        MapperService mapperService = shardContext.getMapperService();, +                        suggestionContext = contextParser.parse(parser, shardContext);, +                    suggestionContext.setShardContext(shardContext);, +                } else {, +                    throw new IllegalArgumentException("suggestion context could not be parsed correctly");, +++ b/core/src/main/java/org/elasticsearch/action/suggest/TransportSuggestAction.java, +import org.elasticsearch.index.query.QueryShardContext;, +        QueryShardContext shardContext = indexShard.getQueryShardContext();, +                final SuggestionSearchContext context = suggestPhase.parseElement().parseInternal(parser, indexShard.getQueryShardContext());, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestContextParser.java, +import org.elasticsearch.index.query.QueryShardContext;, +    SuggestionSearchContext.SuggestionContext parse(XContentParser parser, QueryShardContext shardContext) throws IOException;, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestParseElement.java, +import org.elasticsearch.index.query.QueryShardContext;, +        SuggestionSearchContext suggestionSearchContext = parseInternal(parser, context.indexShard().getQueryShardContext());, +    public SuggestionSearchContext parseInternal(XContentParser parser, QueryShardContext shardContext) throws IOException {, +        MapperService mapperService = shardContext.getMapperService();, +                        suggestionContext = contextParser.parse(parser, shardContext);, +                    suggestionContext.setShardContext(shardContext);, +                } else {, +                    throw new IllegalArgumentException("suggestion context could not be parsed correctly");, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestionSearchContext.java, +import org.elasticsearch.index.query.QueryShardContext;, +        private QueryShardContext shardContext;, +, +        public void setShardContext(QueryShardContext context) {, +            this.shardContext = context;, +        }, +, +        public QueryShardContext getShardContext() {, +            return this.shardContext;, +        }, +++ b/core/src/main/java/org/elasticsearch/action/suggest/TransportSuggestAction.java, +import org.elasticsearch.index.query.QueryShardContext;, +        QueryShardContext shardContext = indexShard.getQueryShardContext();, +                final SuggestionSearchContext context = suggestPhase.parseElement().parseInternal(parser, indexShard.getQueryShardContext());, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestContextParser.java, +import org.elasticsearch.index.query.QueryShardContext;, +    SuggestionSearchContext.SuggestionContext parse(XContentParser parser, QueryShardContext shardContext) throws IOException;, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestParseElement.java, +import org.elasticsearch.index.query.QueryShardContext;, +        SuggestionSearchContext suggestionSearchContext = parseInternal(parser, context.indexShard().getQueryShardContext());, +    public SuggestionSearchContext parseInternal(XContentParser parser, QueryShardContext shardContext) throws IOException {, +        MapperService mapperService = shardContext.getMapperService();, +                        suggestionContext = contextParser.parse(parser, shardContext);, +                    suggestionContext.setShardContext(shardContext);, +                } else {, +                    throw new IllegalArgumentException("suggestion context could not be parsed correctly");, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestionSearchContext.java, +import org.elasticsearch.index.query.QueryShardContext;, +        private QueryShardContext shardContext;, +, +        public void setShardContext(QueryShardContext context) {, +            this.shardContext = context;, +        }, +, +        public QueryShardContext getShardContext() {, +            return this.shardContext;, +        }, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestParser.java, +import org.elasticsearch.index.query.QueryShardContext;, +    public SuggestionSearchContext.SuggestionContext parse(XContentParser parser,  QueryShardContext shardContext) throws IOException {, +        MapperService mapperService = shardContext.getMapperService();, +        final CompletionSuggestionContext suggestion = new CompletionSuggestionContext(completionSuggester, mapperService);, +++ b/core/src/main/java/org/elasticsearch/action/suggest/TransportSuggestAction.java, +import org.elasticsearch.index.query.QueryShardContext;, +        QueryShardContext shardContext = indexShard.getQueryShardContext();, +                final SuggestionSearchContext context = suggestPhase.parseElement().parseInternal(parser, indexShard.getQueryShardContext());, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestContextParser.java, +import org.elasticsearch.index.query.QueryShardContext;, +    SuggestionSearchContext.SuggestionContext parse(XContentParser parser, QueryShardContext shardContext) throws IOException;, +++ b/core/src/main/java/org/elasticsearch/search/suggest/SuggestParseElement.java, +import org.elasticsearch.index.query.QueryShardContext;, +        SuggestionSearchContext suggestionSearchContext = parseInternal(parser, context.indexShard().getQueryShardContext());, +    public SuggestionSearchContext parseInternal(XContentParser parser, QueryShardContext shardContext) throws IOException {, +        MapperService mapperService = shardContext.getMapperService();, +                        suggestionContext = contextParser.parse(parser, shardContext);, +                    suggestionContext.setShardContext(shardContext);]