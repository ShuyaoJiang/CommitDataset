[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequest.java, +    private int waitForActiveShards = -1;, +, +    public int waitForActiveShards() {, +        return waitForActiveShards;, +    }, +, +    public ClusterHealthRequest waitForActiveShards(int waitForActiveShards) {, +        this.waitForActiveShards = waitForActiveShards;, +        return this;, +    }, +, +        waitForActiveShards = in.readInt();, +        out.writeInt(waitForActiveShards);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequest.java, +    private int waitForActiveShards = -1;, +, +    public int waitForActiveShards() {, +        return waitForActiveShards;, +    }, +, +    public ClusterHealthRequest waitForActiveShards(int waitForActiveShards) {, +        this.waitForActiveShards = waitForActiveShards;, +        return this;, +    }, +, +        waitForActiveShards = in.readInt();, +        out.writeInt(waitForActiveShards);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +        int waitFor = 3;, +        if (request.waitForActiveShards() == -1) {, +            waitFor--;, +        }, +            if (request.waitForActiveShards() != -1 && response.activeShards() >= request.waitForActiveShards()) {, +                waitForCounter++;, +            }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequest.java, +    private int waitForActiveShards = -1;, +, +    public int waitForActiveShards() {, +        return waitForActiveShards;, +    }, +, +    public ClusterHealthRequest waitForActiveShards(int waitForActiveShards) {, +        this.waitForActiveShards = waitForActiveShards;, +        return this;, +    }, +, +        waitForActiveShards = in.readInt();, +        out.writeInt(waitForActiveShards);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +        int waitFor = 3;, +        if (request.waitForActiveShards() == -1) {, +            waitFor--;, +        }, +            if (request.waitForActiveShards() != -1 && response.activeShards() >= request.waitForActiveShards()) {, +                waitForCounter++;, +            }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java, +            private TimeValue throttlingWaitTime;, +            public Index(long version, int numberOfFiles, SizeValue totalSize, TimeValue throttlingWaitTime) {, +                this.throttlingWaitTime = throttlingWaitTime;, +, +            public TimeValue throttlingWaitTime() {, +                return throttlingWaitTime;, +            }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequest.java, +    private int waitForActiveShards = -1;, +, +    public int waitForActiveShards() {, +        return waitForActiveShards;, +    }, +, +    public ClusterHealthRequest waitForActiveShards(int waitForActiveShards) {, +        this.waitForActiveShards = waitForActiveShards;, +        return this;, +    }, +, +        waitForActiveShards = in.readInt();, +        out.writeInt(waitForActiveShards);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +        int waitFor = 3;, +        if (request.waitForActiveShards() == -1) {, +            waitFor--;, +        }, +            if (request.waitForActiveShards() != -1 && response.activeShards() >= request.waitForActiveShards()) {, +                waitForCounter++;, +            }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java, +            private TimeValue throttlingWaitTime;, +            public Index(long version, int numberOfFiles, SizeValue totalSize, TimeValue throttlingWaitTime) {, +                this.throttlingWaitTime = throttlingWaitTime;, +, +            public TimeValue throttlingWaitTime() {, +                return throttlingWaitTime;, +            }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/gateway/IndexShardGatewayService.java, +import org.elasticsearch.indices.recovery.throttler.RecoveryThrottler;, +    private final RecoveryThrottler recoveryThrottler;, +]