[+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/close/TransportVerifyShardBeforeCloseAction.java, +        indexShard.flush(new FlushRequest().force(true).waitIfOngoing(true));, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/close/TransportVerifyShardBeforeCloseAction.java, +        indexShard.flush(new FlushRequest().force(true).waitIfOngoing(true));, +++ b/server/src/test/java/org/elasticsearch/indices/state/CloseIndexIT.java, +import org.elasticsearch.common.unit.ByteSizeUnit;, +import org.elasticsearch.common.unit.ByteSizeValue;, +import org.elasticsearch.index.IndexSettings;, +    @Override, +    public Settings indexSettings() {, +        Settings.builder().put(super.indexSettings()), +            .put(IndexSettings.INDEX_TRANSLOG_FLUSH_THRESHOLD_SIZE_SETTING.getKey(),, +                new ByteSizeValue(randomIntBetween(1, 4096), ByteSizeUnit.KB));, +        return super.indexSettings();, +    }, +]