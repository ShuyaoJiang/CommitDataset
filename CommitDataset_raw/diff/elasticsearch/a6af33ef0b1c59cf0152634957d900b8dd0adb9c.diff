[+++ b/x-pack/plugin/ccr/src/test/java/org/elasticsearch/xpack/CcrIntegTestCase.java, +import org.elasticsearch.license.LicensesMetaData;, +        assertBusy(() -> {, +            ClusterService clusterService = leaderCluster.getMasterNodeInstance(ClusterService.class);, +            assertNotNull(clusterService.state().metaData().custom(LicensesMetaData.TYPE));, +        });, +        assertBusy(() -> {, +            ClusterService clusterService = followerCluster.getMasterNodeInstance(ClusterService.class);, +            assertNotNull(clusterService.state().metaData().custom(LicensesMetaData.TYPE));, +        });, +++ b/x-pack/plugin/ccr/src/test/java/org/elasticsearch/xpack/CcrIntegTestCase.java, +import org.elasticsearch.license.LicensesMetaData;, +        assertBusy(() -> {, +            ClusterService clusterService = leaderCluster.getMasterNodeInstance(ClusterService.class);, +            assertNotNull(clusterService.state().metaData().custom(LicensesMetaData.TYPE));, +        });, +        assertBusy(() -> {, +            ClusterService clusterService = followerCluster.getMasterNodeInstance(ClusterService.class);, +            assertNotNull(clusterService.state().metaData().custom(LicensesMetaData.TYPE));, +        });, +++ b/x-pack/plugin/ccr/src/test/java/org/elasticsearch/xpack/CcrSingleNodeTestCase.java, +import org.elasticsearch.license.LicensesMetaData;, +    @Before, +    public void waitForTrialLicenseToBeGenerated() throws Exception {, +        assertBusy(() -> assertNotNull(getInstanceFromNode(ClusterService.class).state().metaData().custom(LicensesMetaData.TYPE)));, +    }, +]