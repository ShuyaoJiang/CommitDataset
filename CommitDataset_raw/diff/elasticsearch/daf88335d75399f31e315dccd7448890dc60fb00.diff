[+++ b/docs/reference/search/request/sort.asciidoc, +`max_children`::, +    The maximum number of children to consider per root document, +    when picking the sort value. Defaults to unlimited., +++ b/docs/reference/search/request/sort.asciidoc, +`max_children`::, +    The maximum number of children to consider per root document, +    when picking the sort value. Defaults to unlimited., +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateField.java, +++ b/docs/reference/search/request/sort.asciidoc, +`max_children`::, +    The maximum number of children to consider per root document, +    when picking the sort value. Defaults to unlimited., +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateField.java, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/NumericField.java, +++ b/docs/reference/search/request/sort.asciidoc, +`max_children`::, +    The maximum number of children to consider per root document, +    when picking the sort value. Defaults to unlimited., +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateField.java, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/NumericField.java, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.sort.NestedSortBuilder;, +            private final NestedSortBuilder nestedSort;, +            public Nested(BitSetProducer rootFilter, Query innerQuery, NestedSortBuilder nestedSort) {, +                this.nestedSort = nestedSort;, +            public NestedSortBuilder getNestedSort() { return nestedSort; }, +, +++ b/docs/reference/search/request/sort.asciidoc, +`max_children`::, +    The maximum number of children to consider per root document, +    when picking the sort value. Defaults to unlimited., +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateField.java, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/NumericField.java, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.sort.NestedSortBuilder;, +            private final NestedSortBuilder nestedSort;, +            public Nested(BitSetProducer rootFilter, Query innerQuery, NestedSortBuilder nestedSort) {, +                this.nestedSort = nestedSort;, +            public NestedSortBuilder getNestedSort() { return nestedSort; }, +, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java, +                        final int maxChildren = nested.getNestedSort() != null ?, +                            nested.getNestedSort().getMaxChildren() : Integer.MAX_VALUE;, +                        selectedValues = sortMode.select(values, rootDocs, innerDocs, maxChildren);, +                    final int maxChildren = nested.getNestedSort() != null ? nested.getNestedSort().getMaxChildren() : Integer.MAX_VALUE;, +                    selectedValues = sortMode.select(values, missingBytes, rootDocs, innerDocs, context.reader().maxDoc(), maxChildren);, +++ b/docs/reference/search/request/sort.asciidoc, +`max_children`::, +    The maximum number of children to consider per root document, +    when picking the sort value. Defaults to unlimited., +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateField.java, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/NumericField.java, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.sort.NestedSortBuilder;, +            private final NestedSortBuilder nestedSort;, +            public Nested(BitSetProducer rootFilter, Query innerQuery, NestedSortBuilder nestedSort) {, +                this.nestedSort = nestedSort;, +            public NestedSortBuilder getNestedSort() { return nestedSort; }, +, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java, +                        final int maxChildren = nested.getNestedSort() != null ?, +                            nested.getNestedSort().getMaxChildren() : Integer.MAX_VALUE;, +                        selectedValues = sortMode.select(values, rootDocs, innerDocs, maxChildren);, +                    final int maxChildren = nested.getNestedSort() != null ? nested.getNestedSort().getMaxChildren() : Integer.MAX_VALUE;, +                    selectedValues = sortMode.select(values, missingBytes, rootDocs, innerDocs, context.reader().maxDoc(), maxChildren);, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/DoubleValuesComparatorSource.java, +                    final int maxChildren = nested.getNestedSort() != null ? nested.getNestedSort().getMaxChildren() : Integer.MAX_VALUE;, +                    selectedValues = sortMode.select(values, dMissingValue, rootDocs, innerDocs, context.reader().maxDoc(), maxChildren);, +++ b/docs/reference/search/request/sort.asciidoc, +`max_children`::, +    The maximum number of children to consider per root document, +    when picking the sort value. Defaults to unlimited., +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateField.java, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/NumericField.java, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.sort.NestedSortBuilder;, +            private final NestedSortBuilder nestedSort;, +            public Nested(BitSetProducer rootFilter, Query innerQuery, NestedSortBuilder nestedSort) {, +                this.nestedSort = nestedSort;, +            public NestedSortBuilder getNestedSort() { return nestedSort; }, +, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java, +                        final int maxChildren = nested.getNestedSort() != null ?, +                            nested.getNestedSort().getMaxChildren() : Integer.MAX_VALUE;, +                        selectedValues = sortMode.select(values, rootDocs, innerDocs, maxChildren);, +                    final int maxChildren = nested.getNestedSort() != null ? nested.getNestedSort().getMaxChildren() : Integer.MAX_VALUE;, +                    selectedValues = sortMode.select(values, missingBytes, rootDocs, innerDocs, context.reader().maxDoc(), maxChildren);, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/DoubleValuesComparatorSource.java, +                    final int maxChildren = nested.getNestedSort() != null ? nested.getNestedSort().getMaxChildren() : Integer.MAX_VALUE;, +                    selectedValues = sortMode.select(values, dMissingValue, rootDocs, innerDocs, context.reader().maxDoc(), maxChildren);, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/FloatValuesComparatorSource.java, +                    final int maxChildren = nested.getNestedSort() != null ? nested.getNestedSort().getMaxChildren() : Integer.MAX_VALUE;, +                    selectedValues = sortMode.select(values, dMissingValue, rootDocs, innerDocs, context.reader().maxDoc(), maxChildren);, +++ b/docs/reference/search/request/sort.asciidoc, +`max_children`::, +    The maximum number of children to consider per root document, +    when picking the sort value. Defaults to unlimited., +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateField.java, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/NumericField.java]