[+++ b/src/main/java/org/elasticsearch/watcher/actions/email/EmailAction.java, +    private final @Nullable Boolean attachData;, +    public EmailAction(EmailTemplate email, @Nullable String account, @Nullable Authentication auth, @Nullable Profile profile, @Nullable Boolean attachData) {, +        this.attachData = attachData;, +    public boolean getAttachData() {, +        return attachData != null && attachData;, +        return !(attachData != null ? !attachData.equals(action.attachData) : action.attachData != null);, +        result = 31 * result + (attachData != null ? attachData.hashCode() : 0);, +        if (attachData != null) {, +            builder.field(Field.ATTACH_DATA.getPreferredName(), attachData);, +                    if (Field.ATTACH_DATA.match(currentFieldName)) {, +        ParseField ATTACH_DATA = new ParseField("attach_data");, +++ b/src/main/java/org/elasticsearch/watcher/actions/email/EmailAction.java, +    private final @Nullable Boolean attachData;, +    public EmailAction(EmailTemplate email, @Nullable String account, @Nullable Authentication auth, @Nullable Profile profile, @Nullable Boolean attachData) {, +        this.attachData = attachData;, +    public boolean getAttachData() {, +        return attachData != null && attachData;, +        return !(attachData != null ? !attachData.equals(action.attachData) : action.attachData != null);, +        result = 31 * result + (attachData != null ? attachData.hashCode() : 0);, +        if (attachData != null) {, +            builder.field(Field.ATTACH_DATA.getPreferredName(), attachData);, +                    if (Field.ATTACH_DATA.match(currentFieldName)) {, +        ParseField ATTACH_DATA = new ParseField("attach_data");, +++ b/src/main/java/org/elasticsearch/watcher/actions/email/ExecutableEmailAction.java, +        if (action.getAttachData()) {, +            Attachment.Bytes attachment = new Attachment.XContent.Yaml("data", "data.yml", new Payload.Simple(model));, +++ b/src/main/java/org/elasticsearch/watcher/actions/email/EmailAction.java, +    private final @Nullable Boolean attachData;, +    public EmailAction(EmailTemplate email, @Nullable String account, @Nullable Authentication auth, @Nullable Profile profile, @Nullable Boolean attachData) {, +        this.attachData = attachData;, +    public boolean getAttachData() {, +        return attachData != null && attachData;, +        return !(attachData != null ? !attachData.equals(action.attachData) : action.attachData != null);, +        result = 31 * result + (attachData != null ? attachData.hashCode() : 0);, +        if (attachData != null) {, +            builder.field(Field.ATTACH_DATA.getPreferredName(), attachData);, +                    if (Field.ATTACH_DATA.match(currentFieldName)) {, +        ParseField ATTACH_DATA = new ParseField("attach_data");, +++ b/src/main/java/org/elasticsearch/watcher/actions/email/ExecutableEmailAction.java, +        if (action.getAttachData()) {, +            Attachment.Bytes attachment = new Attachment.XContent.Yaml("data", "data.yml", new Payload.Simple(model));, +++ b/src/main/java/org/elasticsearch/watcher/execution/WatchExecutionContext.java, +import org.elasticsearch.watcher.actions.ExecutableActions;, +++ b/src/main/java/org/elasticsearch/watcher/actions/email/EmailAction.java, +    private final @Nullable Boolean attachData;, +    public EmailAction(EmailTemplate email, @Nullable String account, @Nullable Authentication auth, @Nullable Profile profile, @Nullable Boolean attachData) {, +        this.attachData = attachData;, +    public boolean getAttachData() {, +        return attachData != null && attachData;, +        return !(attachData != null ? !attachData.equals(action.attachData) : action.attachData != null);, +        result = 31 * result + (attachData != null ? attachData.hashCode() : 0);, +        if (attachData != null) {, +            builder.field(Field.ATTACH_DATA.getPreferredName(), attachData);, +                    if (Field.ATTACH_DATA.match(currentFieldName)) {, +        ParseField ATTACH_DATA = new ParseField("attach_data");, +++ b/src/main/java/org/elasticsearch/watcher/actions/email/ExecutableEmailAction.java, +        if (action.getAttachData()) {, +            Attachment.Bytes attachment = new Attachment.XContent.Yaml("data", "data.yml", new Payload.Simple(model));, +++ b/src/main/java/org/elasticsearch/watcher/execution/WatchExecutionContext.java, +import org.elasticsearch.watcher.actions.ExecutableActions;, +++ b/src/main/java/org/elasticsearch/watcher/support/Variables.java, +    public static final String METADATA = "metadata";, +        vars.put(WATCH_ID, ctx.watch().name());, +        vars.put(EXECUTION_TIME, ctx.executionTime());, +        vars.put(TRIGGER, ctx.triggerEvent().data());, +        vars.put(METADATA, ctx.watch().metadata());, +, +++ b/src/main/java/org/elasticsearch/watcher/actions/email/EmailAction.java, +    private final @Nullable Boolean attachData;, +    public EmailAction(EmailTemplate email, @Nullable String account, @Nullable Authentication auth, @Nullable Profile profile, @Nullable Boolean attachData) {, +        this.attachData = attachData;, +    public boolean getAttachData() {, +        return attachData != null && attachData;, +        return !(attachData != null ? !attachData.equals(action.attachData) : action.attachData != null);, +        result = 31 * result + (attachData != null ? attachData.hashCode() : 0);, +        if (attachData != null) {, +            builder.field(Field.ATTACH_DATA.getPreferredName(), attachData);, +                    if (Field.ATTACH_DATA.match(currentFieldName)) {, +        ParseField ATTACH_DATA = new ParseField("attach_data");, +++ b/src/main/java/org/elasticsearch/watcher/actions/email/ExecutableEmailAction.java, +        if (action.getAttachData()) {, +            Attachment.Bytes attachment = new Attachment.XContent.Yaml("data", "data.yml", new Payload.Simple(model));, +++ b/src/main/java/org/elasticsearch/watcher/execution/WatchExecutionContext.java, +import org.elasticsearch.watcher.actions.ExecutableActions;, +++ b/src/main/java/org/elasticsearch/watcher/support/Variables.java, +    public static final String METADATA = "metadata";, +        vars.put(WATCH_ID, ctx.watch().name());, +        vars.put(EXECUTION_TIME, ctx.executionTime());, +        vars.put(TRIGGER, ctx.triggerEvent().data());, +        vars.put(METADATA, ctx.watch().metadata());, +, +++ b/src/test/java/org/elasticsearch/watcher/actions/email/EmailActionTests.java, +import org.elasticsearch.common.collect.MapBuilder;, +import static org.elasticsearch.watcher.test.WatcherTestUtils.mockExecutionContextBuilder;, +        Map<String, Object> data = new HashMap<>();, +        Payload payload = new Payload.Simple(data);, +        Map<String, Object> metadata = MapBuilder.<String, Object>newMapBuilder().put("_key", "_val").map();, +        Wid wid = new Wid(randomAsciiOfLength(5), randomLong(), now);, +        WatchExecutionContext ctx = mockExecutionContextBuilder("watch1")]