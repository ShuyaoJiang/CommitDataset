[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParserService.java, +import org.elasticsearch.index.similarity.SimilarityService;, +        this(index, ImmutableSettings.Builder.EMPTY_SETTINGS, mapperService, filterCache, analysisService, null, null);, +                                           @Nullable SimilarityService similarityService,, +            IndexQueryParser defaultQueryParser = new JsonIndexQueryParser(index, indexSettings, mapperService, filterCache, analysisService, similarityService, null, null, Defaults.DEFAULT, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParserService.java, +import org.elasticsearch.index.similarity.SimilarityService;, +        this(index, ImmutableSettings.Builder.EMPTY_SETTINGS, mapperService, filterCache, analysisService, null, null);, +                                           @Nullable SimilarityService similarityService,, +            IndexQueryParser defaultQueryParser = new JsonIndexQueryParser(index, indexSettings, mapperService, filterCache, analysisService, similarityService, null, null, Defaults.DEFAULT, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/json/JsonIndexQueryParser.java, +import org.elasticsearch.index.similarity.SimilarityService;, +            return new ThreadLocals.CleanableValue<JsonQueryParseContext>(new JsonQueryParseContext(index, queryParserRegistry, mapperService, similarityService, filterCache));, +    private final SimilarityService similarityService;, +, +                                        AnalysisService analysisService, @Nullable SimilarityService similarityService,, +        this.similarityService = similarityService;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParserService.java, +import org.elasticsearch.index.similarity.SimilarityService;, +        this(index, ImmutableSettings.Builder.EMPTY_SETTINGS, mapperService, filterCache, analysisService, null, null);, +                                           @Nullable SimilarityService similarityService,, +            IndexQueryParser defaultQueryParser = new JsonIndexQueryParser(index, indexSettings, mapperService, filterCache, analysisService, similarityService, null, null, Defaults.DEFAULT, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/json/JsonIndexQueryParser.java, +import org.elasticsearch.index.similarity.SimilarityService;, +            return new ThreadLocals.CleanableValue<JsonQueryParseContext>(new JsonQueryParseContext(index, queryParserRegistry, mapperService, similarityService, filterCache));, +    private final SimilarityService similarityService;, +, +                                        AnalysisService analysisService, @Nullable SimilarityService similarityService,, +        this.similarityService = similarityService;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/json/JsonQueryParseContext.java, +import org.apache.lucene.search.Similarity;, +import org.elasticsearch.index.similarity.SimilarityService;, +import org.elasticsearch.util.Nullable;, +    private final SimilarityService similarityService;, +, +                                 MapperService mapperService, SimilarityService similarityService, FilterCache filterCache) {, +        this.similarityService = similarityService;, +    @Nullable public SimilarityService similarityService() {, +        return this.similarityService;, +    }, +, +    public Similarity searchSimilarity() {, +        return similarityService != null ? similarityService.defaultSearchSimilarity() : null;, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParserService.java, +import org.elasticsearch.index.similarity.SimilarityService;, +        this(index, ImmutableSettings.Builder.EMPTY_SETTINGS, mapperService, filterCache, analysisService, null, null);, +                                           @Nullable SimilarityService similarityService,, +            IndexQueryParser defaultQueryParser = new JsonIndexQueryParser(index, indexSettings, mapperService, filterCache, analysisService, similarityService, null, null, Defaults.DEFAULT, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/json/JsonIndexQueryParser.java, +import org.elasticsearch.index.similarity.SimilarityService;, +            return new ThreadLocals.CleanableValue<JsonQueryParseContext>(new JsonQueryParseContext(index, queryParserRegistry, mapperService, similarityService, filterCache));, +    private final SimilarityService similarityService;, +, +                                        AnalysisService analysisService, @Nullable SimilarityService similarityService,, +        this.similarityService = similarityService;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/json/JsonQueryParseContext.java, +import org.apache.lucene.search.Similarity;, +import org.elasticsearch.index.similarity.SimilarityService;, +import org.elasticsearch.util.Nullable;, +    private final SimilarityService similarityService;, +, +                                 MapperService mapperService, SimilarityService similarityService, FilterCache filterCache) {, +        this.similarityService = similarityService;, +    @Nullable public SimilarityService similarityService() {, +        return this.similarityService;, +    }, +, +    public Similarity searchSimilarity() {, +        return similarityService != null ? similarityService.defaultSearchSimilarity() : null;, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/json/MoreLikeThisFieldJsonQueryParser.java, +        mltQuery.setSimilarity(parseContext.searchSimilarity());, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/IndexQueryParserService.java, +import org.elasticsearch.index.similarity.SimilarityService;, +        this(index, ImmutableSettings.Builder.EMPTY_SETTINGS, mapperService, filterCache, analysisService, null, null);, +                                           @Nullable SimilarityService similarityService,, +            IndexQueryParser defaultQueryParser = new JsonIndexQueryParser(index, indexSettings, mapperService, filterCache, analysisService, similarityService, null, null, Defaults.DEFAULT, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/json/JsonIndexQueryParser.java, +import org.elasticsearch.index.similarity.SimilarityService;, +            return new ThreadLocals.CleanableValue<JsonQueryParseContext>(new JsonQueryParseContext(index, queryParserRegistry, mapperService, similarityService, filterCache));, +    private final SimilarityService similarityService;, +, +                                        AnalysisService analysisService, @Nullable SimilarityService similarityService,, +        this.similarityService = similarityService;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/json/JsonQueryParseContext.java, +import org.apache.lucene.search.Similarity;, +import org.elasticsearch.index.similarity.SimilarityService;, +import org.elasticsearch.util.Nullable;, +    private final SimilarityService similarityService;, +, +                                 MapperService mapperService, SimilarityService similarityService, FilterCache filterCache) {, +        this.similarityService = similarityService;, +    @Nullable public SimilarityService similarityService() {, +        return this.similarityService;, +    }, +, +    public Similarity searchSimilarity() {]