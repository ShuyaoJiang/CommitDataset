[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/ClusterService.java, +     * Adds last listener., +     */, +    void addLast(ClusterStateListener listener);, +, +    /**, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/ClusterService.java, +     * Adds last listener., +     */, +    void addLast(ClusterStateListener listener);, +, +    /**, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java, +    private final List<ClusterStateListener> lastClusterStateListeners = new CopyOnWriteArrayList<ClusterStateListener>();, +    public void addLast(ClusterStateListener listener) {, +        lastClusterStateListeners.add(listener);, +    }, +, +                    for (ClusterStateListener listener : lastClusterStateListeners) {, +                        listener.clusterChanged(clusterChangedEvent);, +                    }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/ClusterService.java, +     * Adds last listener., +     */, +    void addLast(ClusterStateListener listener);, +, +    /**, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java, +    private final List<ClusterStateListener> lastClusterStateListeners = new CopyOnWriteArrayList<ClusterStateListener>();, +    public void addLast(ClusterStateListener listener) {, +        lastClusterStateListeners.add(listener);, +    }, +, +                    for (ClusterStateListener listener : lastClusterStateListeners) {, +                        listener.clusterChanged(clusterChangedEvent);, +                    }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/indices/store/IndicesStore.java, +        clusterService.addLast(this);]