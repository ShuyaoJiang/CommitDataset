[+++ b/src/main/java/org/elasticsearch/transport/netty/NettyTransport.java, +import java.util.concurrent.locks.ReadWriteLock;, +import java.util.concurrent.locks.ReentrantReadWriteLock;, +    // this lock is here to make sure we close this transport and disconnect all the client nodes, +    // connections while no connect operations is going on... (this might help with 100% CPU when stopping the transport?), +    private final ReadWriteLock globalLock = new ReentrantReadWriteLock();, +                globalLock.writeLock().lock();, +                    globalLock.writeLock().unlock();, +            throw new ElasticSearchIllegalStateException("can't add nodes to a stopped transport");, +            throw new ConnectTransportException(null, "can't connect to a null node");, +        }, +        globalLock.readLock().lock();, +        try {, +            if (!lifecycle.started()) {, +                throw new ElasticSearchIllegalStateException("can't add nodes to a stopped transport");, +                if (!lifecycle.started()) {, +                    throw new ElasticSearchIllegalStateException("can't add nodes to a stopped transport");, +                }, +        } finally {, +            globalLock.readLock().unlock();, +        }]