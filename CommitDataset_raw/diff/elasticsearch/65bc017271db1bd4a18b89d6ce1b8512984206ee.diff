[+++ b/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                Engine.Index index = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.PRIMARY, request.canHaveDuplicates() || indexRequest.canHaveDuplicates());, +                Engine.Create create = indexShard.prepareCreate(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.PRIMARY,, +                        request.canHaveDuplicates() || indexRequest.canHaveDuplicates(), indexRequest.autoGeneratedId());, +, +                        Engine.Index index = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA, request.canHaveDuplicates() || indexRequest.canHaveDuplicates());, +                                Engine.Operation.Origin.REPLICA, request.canHaveDuplicates() || indexRequest.canHaveDuplicates(), indexRequest.autoGeneratedId());, +++ b/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                Engine.Index index = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.PRIMARY, request.canHaveDuplicates() || indexRequest.canHaveDuplicates());, +                Engine.Create create = indexShard.prepareCreate(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.PRIMARY,, +                        request.canHaveDuplicates() || indexRequest.canHaveDuplicates(), indexRequest.autoGeneratedId());, +, +                        Engine.Index index = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA, request.canHaveDuplicates() || indexRequest.canHaveDuplicates());, +                                Engine.Operation.Origin.REPLICA, request.canHaveDuplicates() || indexRequest.canHaveDuplicates(), indexRequest.autoGeneratedId());, +++ b/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import org.elasticsearch.*;, +    private boolean autoGeneratedId = false;, +    /**, +     * Has the id been auto generated?, +     */, +    public boolean autoGeneratedId() {, +        return this.autoGeneratedId;, +    }, +, +                autoGeneratedId = true;, +        if (in.getVersion().onOrAfter(Version.V_1_2_0)) {, +            autoGeneratedId = in.readBoolean();, +        }, +        if (out.getVersion().onOrAfter(Version.V_1_2_0)) {, +            out.writeBoolean(autoGeneratedId);, +        }, +++ b/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                Engine.Index index = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.PRIMARY, request.canHaveDuplicates() || indexRequest.canHaveDuplicates());, +                Engine.Create create = indexShard.prepareCreate(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.PRIMARY,, +                        request.canHaveDuplicates() || indexRequest.canHaveDuplicates(), indexRequest.autoGeneratedId());, +, +                        Engine.Index index = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA, request.canHaveDuplicates() || indexRequest.canHaveDuplicates());, +                                Engine.Operation.Origin.REPLICA, request.canHaveDuplicates() || indexRequest.canHaveDuplicates(), indexRequest.autoGeneratedId());, +++ b/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import org.elasticsearch.*;, +    private boolean autoGeneratedId = false;, +    /**, +     * Has the id been auto generated?, +     */, +    public boolean autoGeneratedId() {, +        return this.autoGeneratedId;, +    }, +, +                autoGeneratedId = true;, +        if (in.getVersion().onOrAfter(Version.V_1_2_0)) {, +            autoGeneratedId = in.readBoolean();, +        }, +        if (out.getVersion().onOrAfter(Version.V_1_2_0)) {, +            out.writeBoolean(autoGeneratedId);, +        }, +++ b/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java, +            Engine.Index index = indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.PRIMARY, request.canHaveDuplicates());, +                    request.version(), request.versionType(), Engine.Operation.Origin.PRIMARY, request.canHaveDuplicates(), request.autoGeneratedId());, +            Engine.Index index = indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA, request.canHaveDuplicates());, +                    request.version(), request.versionType(), Engine.Operation.Origin.REPLICA, request.canHaveDuplicates(), request.autoGeneratedId());, +++ b/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                Engine.Index index = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.PRIMARY, request.canHaveDuplicates() || indexRequest.canHaveDuplicates());, +                Engine.Create create = indexShard.prepareCreate(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.PRIMARY,, +                        request.canHaveDuplicates() || indexRequest.canHaveDuplicates(), indexRequest.autoGeneratedId());, +, +                        Engine.Index index = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA, request.canHaveDuplicates() || indexRequest.canHaveDuplicates());, +                                Engine.Operation.Origin.REPLICA, request.canHaveDuplicates() || indexRequest.canHaveDuplicates(), indexRequest.autoGeneratedId());, +++ b/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import org.elasticsearch.*;, +    private boolean autoGeneratedId = false;, +    /**, +     * Has the id been auto generated?, +     */, +    public boolean autoGeneratedId() {, +        return this.autoGeneratedId;, +    }, +, +                autoGeneratedId = true;, +        if (in.getVersion().onOrAfter(Version.V_1_2_0)) {, +            autoGeneratedId = in.readBoolean();, +        }, +        if (out.getVersion().onOrAfter(Version.V_1_2_0)) {, +            out.writeBoolean(autoGeneratedId);, +        }, +++ b/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java, +            Engine.Index index = indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.PRIMARY, request.canHaveDuplicates());, +                    request.version(), request.versionType(), Engine.Operation.Origin.PRIMARY, request.canHaveDuplicates(), request.autoGeneratedId());, +            Engine.Index index = indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA, request.canHaveDuplicates());, +                    request.version(), request.versionType(), Engine.Operation.Origin.REPLICA, request.canHaveDuplicates(), request.autoGeneratedId());, +++ b/src/main/java/org/elasticsearch/action/support/replication/ShardReplicationOperationRequest.java, +import org.elasticsearch.Version;, +    private boolean canHaveDuplicates = false;, +    void setCanHaveDuplicates() {, +        this.canHaveDuplicates = true;, +    }, +, +    /**, +     * Is this request can potentially be dup on a single shard., +     */, +    public boolean canHaveDuplicates() {]