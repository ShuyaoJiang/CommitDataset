[+++ b/src/test/java/org/elasticsearch/plugin/PluginManagerTests.java, +import com.google.common.base.Predicate;, +import java.util.concurrent.TimeUnit;, +import static org.hamcrest.Matchers.equalTo;, +import static org.hamcrest.Matchers.notNullValue;, +        cluster().startNode(SETTINGS);, +        assertPluginAvailable(pluginName);, +        assertPluginAvailable(pluginName);, +        cluster().startNode(SETTINGS);, +        assertPluginAvailable(pluginName);, +        cluster().startNode(SETTINGS);, +        assertPluginAvailable(pluginName);, +    private void assertPluginAvailable(String pluginName) throws InterruptedException {, +        final HttpClient httpClient = new HttpClient(httpServerTransport.boundAddress().publishAddress());, +        //checking that the http connector is working properly, +        // We will try it for some seconds as it could happen that the REST interface is not yet fully started, +        assertThat(awaitBusy(new Predicate<Object>() {, +            public boolean apply(Object obj) {, +                HttpClientResponse response = httpClient.request("");, +                    return false;, +                return true;, +            }, +        }, 5, TimeUnit.SECONDS), equalTo(true));, +, +, +        //checking now that the plugin is available, +        HttpClientResponse response = httpClient.request("_plugin/" + pluginName + "/");, +        assertThat(response, notNullValue());]