[+++ b/server/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java, +            || (cause instanceof TransportException &&, +                ("TransportService is closed stopped can't send request".equals(cause.getMessage()), +                || "transport stopped, action: internal:cluster/shard/failure".equals(cause.getMessage())));, +++ b/server/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java, +            || (cause instanceof TransportException &&, +                ("TransportService is closed stopped can't send request".equals(cause.getMessage()), +                || "transport stopped, action: internal:cluster/shard/failure".equals(cause.getMessage())));, +++ b/server/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java, +                new DiscoveryNode("foo", buildNewFakeTransportAddress(), Version.CURRENT), ShardStateAction.SHARD_FAILED_ACTION_NAME,, +        } else if (randomBoolean()) {, +            shardActionFailure = new TransportException(, +                "transport stopped, action: " + ShardStateAction.SHARD_FAILED_ACTION_NAME);]