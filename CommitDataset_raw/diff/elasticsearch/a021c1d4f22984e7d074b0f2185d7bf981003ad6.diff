[+++ b/src/test/java/org/elasticsearch/cluster/ack/AckTests.java, +        //testing only on master with the latest cluster state as we didn't make any change thus we cannot guarantee that, +        //all nodes hold the same cluster state version. We only know there was no need to change anything, thus no need for ack on this update., +        ClusterStateResponse clusterStateResponse = client().admin().cluster().prepareState().get();, +        boolean found = false;, +        assertThat(found, equalTo(true));, +, +        routingNode = clusterStateResponse.getState().routingNodes().nodesToShards().get(moveAllocationCommand.toNode());, +        for (MutableShardRouting mutableShardRouting : routingNode) {, +            if (mutableShardRouting.shardId().equals(moveAllocationCommand.shardId())) {, +                fail("shard [" + mutableShardRouting + "] shouldn't be on node [" + moveAllocationCommand.toString() + "]");, +            }, +    private MoveAllocationCommand getAllocationCommand() {, +                    shardToBeMoved = routingNode.shards().get(randomInt(routingNode.shards().size()-1));, +        logger.info("==> going to move shard [{}] from [{}] to [{}]", shardToBeMoved, fromNodeId, toNodeId);]