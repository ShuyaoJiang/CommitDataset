[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                'node.attr.testattr'                : 'test',, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                'node.attr.testattr'                : 'test',, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                logger.trace("cluster is blocked ({}), scheduling a retry", blockException.getMessage());, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                'node.attr.testattr'                : 'test',, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                logger.trace("cluster is blocked ({}), scheduling a retry", blockException.getMessage());, +++ b/core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java, +                    logger.error("NodeStatsAction timed out for ClusterInfoUpdateJob (reason [{}])", e.getMessage());, +                    logger.error("IndicesStatsAction timed out for ClusterInfoUpdateJob (reason [{}])", e.getMessage());, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                'node.attr.testattr'                : 'test',, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                logger.trace("cluster is blocked ({}), scheduling a retry", blockException.getMessage());, +++ b/core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java, +                    logger.error("NodeStatsAction timed out for ClusterInfoUpdateJob (reason [{}])", e.getMessage());, +                    logger.error("IndicesStatsAction timed out for ClusterInfoUpdateJob (reason [{}])", e.getMessage());, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeService.java, +        Set<DiscoveryNode.Role> roles = new HashSet<>();, +        if (Node.NODE_INGEST_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.INGEST);, +        }, +        if (Node.NODE_MASTER_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.MASTER);, +        }, +        if (Node.NODE_DATA_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.DATA);, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                'node.attr.testattr'                : 'test',, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                logger.trace("cluster is blocked ({}), scheduling a retry", blockException.getMessage());, +++ b/core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java, +                    logger.error("NodeStatsAction timed out for ClusterInfoUpdateJob (reason [{}])", e.getMessage());, +                    logger.error("IndicesStatsAction timed out for ClusterInfoUpdateJob (reason [{}])", e.getMessage());, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeService.java, +        Set<DiscoveryNode.Role> roles = new HashSet<>();, +        if (Node.NODE_INGEST_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.INGEST);, +        }, +        if (Node.NODE_MASTER_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.MASTER);, +        }, +        if (Node.NODE_DATA_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.DATA);, +++ b/core/src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java, +                            logger.warn("failed to execute bulk: [{}]", e.getMessage());, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                'node.attr.testattr'                : 'test',, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                logger.trace("cluster is blocked ({}), scheduling a retry", blockException.getMessage());, +++ b/core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java, +                    logger.error("NodeStatsAction timed out for ClusterInfoUpdateJob (reason [{}])", e.getMessage());, +                    logger.error("IndicesStatsAction timed out for ClusterInfoUpdateJob (reason [{}])", e.getMessage());, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeService.java, +        Set<DiscoveryNode.Role> roles = new HashSet<>();, +        if (Node.NODE_INGEST_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.INGEST);, +        }, +        if (Node.NODE_MASTER_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.MASTER);, +        }, +        if (Node.NODE_DATA_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.DATA);, +++ b/core/src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java, +                            logger.warn("failed to execute bulk: [{}]", e.getMessage());, +++ b/core/src/main/java/org/elasticsearch/node/Node.java, +    public static final Setting<Settings> NODE_ATTRIBUTES = Setting.groupSetting("node.attr.", Property.NodeScope);, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                'node.attr.testattr'                : 'test',, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                logger.trace("cluster is blocked ({}), scheduling a retry", blockException.getMessage());, +++ b/core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java, +                    logger.error("NodeStatsAction timed out for ClusterInfoUpdateJob (reason [{}])", e.getMessage());, +                    logger.error("IndicesStatsAction timed out for ClusterInfoUpdateJob (reason [{}])", e.getMessage());, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeService.java, +        Set<DiscoveryNode.Role> roles = new HashSet<>();, +        if (Node.NODE_INGEST_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.INGEST);, +        }, +        if (Node.NODE_MASTER_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.MASTER);, +        }, +        if (Node.NODE_DATA_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.DATA);, +++ b/core/src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java, +                            logger.warn("failed to execute bulk: [{}]", e.getMessage());, +++ b/core/src/main/java/org/elasticsearch/node/Node.java, +    public static final Setting<Settings> NODE_ATTRIBUTES = Setting.groupSetting("node.attr.", Property.NodeScope);, +++ b/core/src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationIT.java, +        internalCluster().startNodesAsync(2, Settings.settingsBuilder().put(commonSettings).put("node.attr.rack_id", "rack_1").build()).get();, +        final String node3 = internalCluster().startNode(Settings.settingsBuilder().put(commonSettings).put("node.attr.rack_id", "rack_2").build());, +                Settings.settingsBuilder().put(commonSettings).put("node.attr.zone", "a").build(),, +                Settings.settingsBuilder().put(commonSettings).put("node.attr.zone", "b").build(),, +                Settings.settingsBuilder().put(commonSettings).put("node.attr.zone", "b").build(),, +                Settings.settingsBuilder().put(commonSettings).put("node.attr.zone", "a").build(), +                Settings.settingsBuilder().put(commonSettings).put("node.attr.zone", "a").build(),, +                Settings.settingsBuilder().put(commonSettings).put("node.attr.zone", "b").build()]