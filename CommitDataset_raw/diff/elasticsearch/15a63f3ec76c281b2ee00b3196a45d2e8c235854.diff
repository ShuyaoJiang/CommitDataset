[+++ b/core/src/test/java/org/elasticsearch/gateway/MetaDataWriteDataNodesIT.java, +import org.elasticsearch.env.NodeEnvironment;, +import org.elasticsearch.index.Index;, +import java.nio.file.Files;, +import java.nio.file.Path;, +        assertIndexDirectoryDeleted(node2, index);, +        assertIndexDirectoryDeleted(node1, index);, +    protected void assertIndexDirectoryDeleted(final String nodeName, final String indexName) throws Exception {, +        assertBusy(() -> {, +            logger.info("checking if index directory exists...");, +            assertFalse("Expecting index directory of " + indexName + " to be deleted from node " + nodeName, indexDirectoryExists(nodeName, indexName));, +        }, +        );, +    protected void assertIndexInMetaState(final String nodeName, final String indexName) throws Exception {, +        assertBusy(() -> {, +                assertTrue("Expecting meta state of index " + indexName + " to be on node " + nodeName, getIndicesMetaDataOnNode(nodeName).containsKey(indexName));, +                fail("could not load meta state");, +        );, +, +    private boolean indexDirectoryExists(String nodeName, String indexName) {, +        NodeEnvironment nodeEnv = ((InternalTestCluster) cluster()).getInstance(NodeEnvironment.class, nodeName);, +        for (Path path : nodeEnv.indexPaths(new Index(indexName))) {, +            if (Files.exists(path)) {, +                return true;, +        }, +        return false;, +        MetaData nodeMetaData = nodeMetaState.loadMetaState();]