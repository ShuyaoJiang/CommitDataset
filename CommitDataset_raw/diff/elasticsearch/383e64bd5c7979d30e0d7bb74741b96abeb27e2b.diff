[+++ b/docs/reference/search/aggregations/bucket.asciidoc, +include::bucket/children-aggregation.asciidoc[], +, +++ b/docs/reference/search/aggregations/bucket.asciidoc, +include::bucket/children-aggregation.asciidoc[], +, +++ b/docs/reference/search/aggregations/bucket/children-aggregation.asciidoc, +[[search-aggregations-bucket-children-aggregation]], +=== Children Aggregation, +, +A special single bucket aggregation that enables aggregating from buckets on parent document types to buckets on child documents., +, +This aggregation relies on the <<mapping-parent-field,_parent field>> in the mapping. This aggregation has a single option:, +* `type` - The what child type the buckets in the parent space should be mapped to., +, +For example, let's say we have an index of questions and answers. The answer type has the following `_parent` field in the mapping:, +[source,js], +--------------------------------------------------, +{, +    "answer" : {, +        "_parent" : {, +            "type" : "question", +        }, +    }, +}, +--------------------------------------------------, +, +The question typed document contain a tag field and the answer typed documents contain an owner field. With the `children`, +aggregation the tag buckets can be mapped to the owner buckets in a single request even though the two fields exist in, +two different kinds of documents., +, +An example of a question typed document:, +[source,js], +--------------------------------------------------, +{, +    "body": "<p>I have Windows 2003 server and i bought a new Windows 2008 server...",, +    "title": "Whats the best way to file transfer my site from server to a newer one?",, +    "tags": [, +        "windows-server-2003",, +        "windows-server-2008",, +        "file-transfer", +    ],, +}, +--------------------------------------------------, +, +An example of an answer typed document:, +[source,js], +--------------------------------------------------, +{, +    "owner": {, +        "location": "Norfolk, United Kingdom",, +        "display_name": "Sam",, +        "id": 48, +    },, +    "body": "<p>Unfortunately your pretty much limited to FTP...",, +    "creation_date": "2009-05-04T13:45:37.030", +}, +--------------------------------------------------, +, +The following request can be built that connects the two together:, +, +[source,js], +--------------------------------------------------, +{, +  "aggs": {, +    "top-tags": {, +      "terms": {, +        "field": "tags",, +        "size": 10, +      },, +      "aggs": {, +        "to-answers": {, +          "children": {, +            "type" : "answer" <1>, +          },, +          "aggs": {, +            "top-names": {, +              "terms": {, +                "field": "owner.display_name",, +                "size": 10, +              }, +            }, +          }, +        }, +      }, +    }, +  }, +}, +--------------------------------------------------, +, +<1> The `type` points to type / mapping with the name `answer`., +, +The above example returns the top question tags and per tag the top answer owners., +, +Possible response:, +, +[source,js], +--------------------------------------------------, +{, +  "aggregations": {]