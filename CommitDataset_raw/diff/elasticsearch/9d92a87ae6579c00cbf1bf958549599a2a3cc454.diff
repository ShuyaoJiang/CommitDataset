[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +++ b/docs/build.gradle, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +++ b/docs/build.gradle, +++ b/docs/reference/migration/migrate_7_0/aggregations.asciidoc, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +++ b/docs/build.gradle, +++ b/docs/reference/migration/migrate_7_0/aggregations.asciidoc, +++ b/server/build.gradle, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +++ b/docs/build.gradle, +++ b/docs/reference/migration/migrate_7_0/aggregations.asciidoc, +++ b/server/build.gradle, +++ b/server/src/main/java/org/elasticsearch/script/ScriptedMetricAggContexts.java, +        private final Map<String, Object> state;, +        ParamsAndStateBase(Map<String, Object> params, Map<String, Object> state) {, +        public InitScript(Map<String, Object> params, Map<String, Object> state) {, +            InitScript newInstance(Map<String, Object> params, Map<String, Object> state);, +        public MapScript(Map<String, Object> params, Map<String, Object> state, SearchLookup lookup, LeafReaderContext leafContext) {, +            LeafFactory newFactory(Map<String, Object> params, Map<String, Object> state, SearchLookup lookup);, +        public CombineScript(Map<String, Object> params, Map<String, Object> state) {, +            CombineScript newInstance(Map<String, Object> params, Map<String, Object> state);, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +++ b/docs/build.gradle, +++ b/docs/reference/migration/migrate_7_0/aggregations.asciidoc, +++ b/server/build.gradle, +++ b/server/src/main/java/org/elasticsearch/script/ScriptedMetricAggContexts.java, +        private final Map<String, Object> state;, +        ParamsAndStateBase(Map<String, Object> params, Map<String, Object> state) {, +        public InitScript(Map<String, Object> params, Map<String, Object> state) {, +            InitScript newInstance(Map<String, Object> params, Map<String, Object> state);, +        public MapScript(Map<String, Object> params, Map<String, Object> state, SearchLookup lookup, LeafReaderContext leafContext) {, +            LeafFactory newFactory(Map<String, Object> params, Map<String, Object> state, SearchLookup lookup);, +        public CombineScript(Map<String, Object> params, Map<String, Object> state) {, +            CombineScript newInstance(Map<String, Object> params, Map<String, Object> state);, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +++ b/docs/build.gradle, +++ b/docs/reference/migration/migrate_7_0/aggregations.asciidoc, +++ b/server/build.gradle, +++ b/server/src/main/java/org/elasticsearch/script/ScriptedMetricAggContexts.java, +        private final Map<String, Object> state;, +        ParamsAndStateBase(Map<String, Object> params, Map<String, Object> state) {, +        public InitScript(Map<String, Object> params, Map<String, Object> state) {, +            InitScript newInstance(Map<String, Object> params, Map<String, Object> state);, +        public MapScript(Map<String, Object> params, Map<String, Object> state, SearchLookup lookup, LeafReaderContext leafContext) {, +            LeafFactory newFactory(Map<String, Object> params, Map<String, Object> state, SearchLookup lookup);, +        public CombineScript(Map<String, Object> params, Map<String, Object> state) {, +            CombineScript newInstance(Map<String, Object> params, Map<String, Object> state);, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java, +    private Map<String, Object> aggState;, +                                       Script reduceScript, Map<String, Object> aggState, SearchContext context, Aggregator parent,, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +++ b/docs/build.gradle, +++ b/docs/reference/migration/migrate_7_0/aggregations.asciidoc, +++ b/server/build.gradle, +++ b/server/src/main/java/org/elasticsearch/script/ScriptedMetricAggContexts.java, +        private final Map<String, Object> state;, +        ParamsAndStateBase(Map<String, Object> params, Map<String, Object> state) {, +        public InitScript(Map<String, Object> params, Map<String, Object> state) {, +            InitScript newInstance(Map<String, Object> params, Map<String, Object> state);, +        public MapScript(Map<String, Object> params, Map<String, Object> state, SearchLookup lookup, LeafReaderContext leafContext) {, +            LeafFactory newFactory(Map<String, Object> params, Map<String, Object> state, SearchLookup lookup);, +        public CombineScript(Map<String, Object> params, Map<String, Object> state) {, +            CombineScript newInstance(Map<String, Object> params, Map<String, Object> state);, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java, +    private Map<String, Object> aggState;, +                                       Script reduceScript, Map<String, Object> aggState, SearchContext context, Aggregator parent,, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java, +        Map<String, Object> aggState = new HashMap<String, Object>();, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +++ b/docs/build.gradle, +++ b/docs/reference/migration/migrate_7_0/aggregations.asciidoc, +++ b/server/build.gradle, +++ b/server/src/main/java/org/elasticsearch/script/ScriptedMetricAggContexts.java, +        private final Map<String, Object> state;, +        ParamsAndStateBase(Map<String, Object> params, Map<String, Object> state) {, +        public InitScript(Map<String, Object> params, Map<String, Object> state) {, +            InitScript newInstance(Map<String, Object> params, Map<String, Object> state);, +        public MapScript(Map<String, Object> params, Map<String, Object> state, SearchLookup lookup, LeafReaderContext leafContext) {, +            LeafFactory newFactory(Map<String, Object> params, Map<String, Object> state, SearchLookup lookup);, +        public CombineScript(Map<String, Object> params, Map<String, Object> state) {, +            CombineScript newInstance(Map<String, Object> params, Map<String, Object> state);, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java, +    private Map<String, Object> aggState;, +                                       Script reduceScript, Map<String, Object> aggState, SearchContext context, Aggregator parent,, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java, +        Map<String, Object> aggState = new HashMap<String, Object>();, +++ /dev/null, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +++ b/docs/build.gradle, +++ b/docs/reference/migration/migrate_7_0/aggregations.asciidoc, +++ b/server/build.gradle, +++ b/server/src/main/java/org/elasticsearch/script/ScriptedMetricAggContexts.java, +        private final Map<String, Object> state;, +        ParamsAndStateBase(Map<String, Object> params, Map<String, Object> state) {]