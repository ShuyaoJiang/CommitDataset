[+++ b/core/src/test/java/org/elasticsearch/transport/netty/NettyTransportMultiPortTests.java, +, +import org.elasticsearch.test.junit.rule.RepeatOnExceptionRule;, +import java.net.ServerSocket;, +        int nextPort = randomIntBetween(49152, 65535);, +            boolean foundPortInRange = false;, +            while (!foundPortInRange) {, +                if (!ports.contains(nextPort)) {, +                    logger.debug("looking to see if port [{}]is available", nextPort);, +                    try (ServerSocket serverSocket = new ServerSocket()) {, +                        // Set SO_REUSEADDR as we may bind here and not be able, +                        // to reuse the address immediately without it., +                        serverSocket.setReuseAddress(NetworkUtils.defaultReuseAddress());, +                        serverSocket.bind(new InetSocketAddress(nextPort));, +                        // bind was a success, +                        logger.debug("port [{}] available.", nextPort);, +                        foundPortInRange = true;, +                        ports.add(nextPort);, +                    } catch (IOException e) {, +                        // Do nothing, +                        logger.debug("port [{}] not available.", e, nextPort);, +                    }, +                }, +                nextPort = randomIntBetween(49152, 65535);, +            }, +        }]