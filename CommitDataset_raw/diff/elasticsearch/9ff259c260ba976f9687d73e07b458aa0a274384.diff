[+++ b/core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java, +        if (connection.getNode().getVersion().onOrAfter(Version.V_5_6_0)) {, +            throw new IllegalArgumentException("can_match is not supported on pre 5.6 nodes");, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java, +        if (connection.getNode().getVersion().onOrAfter(Version.V_5_6_0)) {, +            throw new IllegalArgumentException("can_match is not supported on pre 5.6 nodes");, +++ b/core/src/test/java/org/elasticsearch/action/search/CanMatchPreFilterSearchPhaseTests.java, +        DiscoveryNode node = new DiscoveryNode("node_1", buildNewFakeTransportAddress(), VersionUtils.randomVersionBetween(random(),, +            VersionUtils.getFirstVersion(), VersionUtils.getPreviousVersion(Version.V_5_6_0)));, +        assertEquals("can_match is not supported on pre 5.6 nodes", illegalArgumentException.getMessage());]