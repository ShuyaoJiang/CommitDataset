[+++ b/core/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java, +        if (!analyzerProviders.containsKey("default")) {, +            analyzerProviders.put("default", new StandardAnalyzerProvider(indexSettings, null, "default", Settings.Builder.EMPTY_SETTINGS));, +        }, +        if (!analyzerProviders.containsKey("default_search")) {, +            analyzerProviders.put("default_search", analyzerProviders.get("default"));, +        }, +        if (!analyzerProviders.containsKey("default_search_quoted")) {, +            analyzerProviders.put("default_search_quoted", analyzerProviders.get("default_search"));, +        }, +, +            AnalyzerProvider<?> analyzerFactory = entry.getValue();, +            String name = entry.getKey();, +                for (String alias : Strings.commaDelimitedListToStringArray(strAliases)) {, +                    analyzers.put(alias, analyzer);, +            }, +            String[] aliases = this.indexSettings.getSettings().getAsArray("index.analysis.analyzer." + analyzerFactory.name() + ".alias");, +                analyzers.put(alias, analyzer);, +, +        NamedAnalyzer defaultAnalyzer = analyzers.get("default");, +        if (defaultAnalyzer == null) {, +            throw new IllegalArgumentException("no default analyzer configured");, +        }, +        if (analyzers.containsKey("default_index")) {, +            final Version createdVersion = indexSettings.getIndexVersionCreated();, +            if (createdVersion.onOrAfter(Version.V_5_0_0_alpha1)) {, +                throw new IllegalArgumentException("setting [index.analysis.analyzer.default_index] is not supported anymore, use [index.analysis.analyzer.default] instead for index [" + index().getName() + "]");, +            } else {, +                deprecationLogger.deprecated("setting [index.analysis.analyzer.default_index] is deprecated, use [index.analysis.analyzer.default] instead for index [{}]", index().getName());, +            }, +        }, +        defaultIndexAnalyzer = analyzers.containsKey("default_index") ? analyzers.get("default_index") : defaultAnalyzer;, +        defaultSearchAnalyzer = analyzers.containsKey("default_search") ? analyzers.get("default_search") : defaultAnalyzer;, +        defaultSearchQuoteAnalyzer = analyzers.containsKey("default_search_quote") ? analyzers.get("default_search_quote") : defaultSearchAnalyzer;, +, +        for (Map.Entry<String, NamedAnalyzer> analyzer : analyzers.entrySet()) {, +            if (analyzer.getKey().startsWith("_")) {, +                throw new IllegalArgumentException("analyzer name must not start with '_'. got \"" + analyzer.getKey() + "\"");, +            }, +        }, +        this.analyzers = unmodifiableMap(analyzers);, +++ b/core/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java, +        if (!analyzerProviders.containsKey("default")) {, +            analyzerProviders.put("default", new StandardAnalyzerProvider(indexSettings, null, "default", Settings.Builder.EMPTY_SETTINGS));, +        }, +        if (!analyzerProviders.containsKey("default_search")) {, +            analyzerProviders.put("default_search", analyzerProviders.get("default"));, +        }, +        if (!analyzerProviders.containsKey("default_search_quoted")) {, +            analyzerProviders.put("default_search_quoted", analyzerProviders.get("default_search"));, +        }, +, +            AnalyzerProvider<?> analyzerFactory = entry.getValue();, +            String name = entry.getKey();, +                for (String alias : Strings.commaDelimitedListToStringArray(strAliases)) {, +                    analyzers.put(alias, analyzer);, +            }, +            String[] aliases = this.indexSettings.getSettings().getAsArray("index.analysis.analyzer." + analyzerFactory.name() + ".alias");, +                analyzers.put(alias, analyzer);, +, +        NamedAnalyzer defaultAnalyzer = analyzers.get("default");, +        if (defaultAnalyzer == null) {, +            throw new IllegalArgumentException("no default analyzer configured");, +        }, +        if (analyzers.containsKey("default_index")) {, +            final Version createdVersion = indexSettings.getIndexVersionCreated();, +            if (createdVersion.onOrAfter(Version.V_5_0_0_alpha1)) {, +                throw new IllegalArgumentException("setting [index.analysis.analyzer.default_index] is not supported anymore, use [index.analysis.analyzer.default] instead for index [" + index().getName() + "]");, +            } else {, +                deprecationLogger.deprecated("setting [index.analysis.analyzer.default_index] is deprecated, use [index.analysis.analyzer.default] instead for index [{}]", index().getName());, +            }, +        }, +        defaultIndexAnalyzer = analyzers.containsKey("default_index") ? analyzers.get("default_index") : defaultAnalyzer;, +        defaultSearchAnalyzer = analyzers.containsKey("default_search") ? analyzers.get("default_search") : defaultAnalyzer;, +        defaultSearchQuoteAnalyzer = analyzers.containsKey("default_search_quote") ? analyzers.get("default_search_quote") : defaultSearchAnalyzer;, +, +        for (Map.Entry<String, NamedAnalyzer> analyzer : analyzers.entrySet()) {, +            if (analyzer.getKey().startsWith("_")) {, +                throw new IllegalArgumentException("analyzer name must not start with '_'. got \"" + analyzer.getKey() + "\"");, +            }, +        }, +        this.analyzers = unmodifiableMap(analyzers);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +                if (hasDifferentSearchAnalyzer || hasDifferentSearchQuoteAnalyzer) {, +                    if (hasDifferentSearchQuoteAnalyzer) {, +++ b/core/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java, +        if (!analyzerProviders.containsKey("default")) {, +            analyzerProviders.put("default", new StandardAnalyzerProvider(indexSettings, null, "default", Settings.Builder.EMPTY_SETTINGS));, +        }, +        if (!analyzerProviders.containsKey("default_search")) {, +            analyzerProviders.put("default_search", analyzerProviders.get("default"));, +        }, +        if (!analyzerProviders.containsKey("default_search_quoted")) {, +            analyzerProviders.put("default_search_quoted", analyzerProviders.get("default_search"));, +        }, +, +            AnalyzerProvider<?> analyzerFactory = entry.getValue();, +            String name = entry.getKey();, +                for (String alias : Strings.commaDelimitedListToStringArray(strAliases)) {, +                    analyzers.put(alias, analyzer);]