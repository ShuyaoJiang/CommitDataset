[+++ b/.idea/misc.xml, +++ b/.idea/misc.xml, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +import org.elasticsearch.transport.BaseTransportResponseHandler;, +import org.elasticsearch.transport.ConnectTransportException;, +import org.elasticsearch.transport.FutureTransportResponseHandler;, +import org.elasticsearch.transport.TransportException;, +import org.elasticsearch.transport.TransportService;, +    private final NodeSampler nodesSampler;, +            this.nodesSampler = new SniffNodesSampler();, +            this.nodesSampler = new SimpleNodeSampler();, +        this.nodesSamplerFuture = threadPool.schedule(nodesSamplerInterval, ThreadPool.Names.CACHED, new ScheduledNodeSampler());, +        nodesSampler.sample();, +        nodesSampler.sample();, +    interface NodeSampler {, +        void sample();, +    }, +, +    class ScheduledNodeSampler implements Runnable {, +        @Override public void run() {, +            nodesSampler.sample();, +            if (!closed) {, +                nodesSamplerFuture = threadPool.schedule(nodesSamplerInterval, ThreadPool.Names.CACHED, this);, +            }, +        }, +    }, +, +    class SimpleNodeSampler implements NodeSampler {, +, +        @Override public synchronized void sample() {, +    class SniffNodesSampler implements NodeSampler {, +        @Override public synchronized void sample() {]