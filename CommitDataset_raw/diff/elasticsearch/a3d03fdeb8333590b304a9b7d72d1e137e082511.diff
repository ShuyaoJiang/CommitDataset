[+++ b/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +    private void setup(boolean addShutdownHook, Settings settings, Environment environment) throws Exception {, +        setupSecurity(settings, environment);, +        if (settings.getAsBoolean("bootstrap.mlockall", false)) {, +        NodeBuilder nodeBuilder = NodeBuilder.nodeBuilder().settings(settings).loadConfigSettings(false);, +        if (settings.getAsBoolean("bootstrap.ctrlhandler", true)) {, +    private static void setupLogging(Settings settings, Environment environment) {, +            settings.getClassLoader().loadClass("org.apache.log4j.Logger");, +            LogConfigurator.configure(settings);, +        Settings settings = tuple.v1();, +        Environment environment = tuple.v2();, +        setupLogging(settings, environment);, +        setup(true, settings, environment);, +        Settings settings = null;, +        Environment environment = null;, +            Tuple<Settings, Environment> tuple = initialSettings();, +            settings = tuple.v1();, +            environment = tuple.v2();, +            setupLogging(settings, environment);, +            bootstrap.setup(true, settings, environment);]