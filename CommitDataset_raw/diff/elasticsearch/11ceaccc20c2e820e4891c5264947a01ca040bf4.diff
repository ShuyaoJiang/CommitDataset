[+++ b/src/test/java/org/elasticsearch/gateway/fs/IndexGatewayTests.java, +++ b/src/test/java/org/elasticsearch/gateway/fs/IndexGatewayTests.java, +++ b/src/test/java/org/elasticsearch/test/TestCluster.java, +        this.nodeSettingsSource = nodeSettingsSource;, +        Builder builder = ImmutableSettings.settingsBuilder();, +        // randomize (multi/single) data path, special case for 0, don't set it at all..., +        int numOfDataPaths = random.nextInt(5);, +        if (numOfDataPaths > 0) {, +            StringBuilder dataPath = new StringBuilder();, +            for (int i = 0; i < numOfDataPaths; i++) {, +                dataPath.append("data/d").append(i).append(',');, +            }, +            builder.put("path.data", dataPath.toString());, +        }, +        defaultSettings = builder.build();, +, +    }, +, +    private static boolean isLocalTransportConfigured() {, +        if ("local".equals(System.getProperty("es.node.mode", "network"))) {, +           return true;, +        }, +        return Boolean.parseBoolean(System.getProperty("es.node.local", "false"));, +    }, +, +    private Settings getSettings(int nodeOrdinal, long nodeSeed, Settings others) {, +        Builder builder = ImmutableSettings.settingsBuilder().put(defaultSettings), +                .put(getRandomNodeSettings(nodeSeed, clusterName));, +        Settings settings = nodeSettingsSource.settings(nodeOrdinal);, +        if (settings != null) {, +            builder.put(settings);, +        }, +        if (others != null) {, +            builder.put(others);, +        }, +        return builder.build();, +    }, +, +    private static Settings getRandomNodeSettings(long seed, String clusterName) {, +        Random random = new Random(seed);, +        settings = getSettings(nodeId, seed, settings);, +                nodeAndClient = buildNode(i, sharedNodesSeeds[i], null);]