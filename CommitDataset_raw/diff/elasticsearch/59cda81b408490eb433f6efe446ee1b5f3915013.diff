[+++ b/dev-tools/create_bwc_index.py, +  warmers = {}, +  if parse_version(version) < parse_version('2.0.0-alpha1'):, +    warmers['warmer1'] = {, +      'source': {, +        'query': {, +          'match_all': {}, +        }, +      }, +    }, +        'required': 'false', +  if parse_version(version) < parse_version("5.0.0-alpha1"):, +  else: # current version of the norms mapping, +    mappings['norms'] = {, +      'properties': {, +        'string_with_norms_disabled': {, +          'type': 'text',, +          'norms' : False, +        },, +        'string_with_norms_enabled': {, +          'type': 'keyword',, +          'index': 'not_analyzed',, +          'norms': True,, +          'eager_global_ordinals' : True, +        }, +      }, +    }, +    mappings['doc'] = {, +      'properties': {, +        'string': {, +          'type': 'text',, +          'boost': 4, +        }, +      }, +    }, +  body = {, +  }, +, +  if warmers:, +    body['warmers'] = warmers, +  client.indices.create(index=index_name, body=body), +  persistent = {, +    'cluster.routing.allocation.exclude.version_attr': version, +  }, +  if parse_version(version) < parse_version('5.0.0-alpha1'):, +    # Same as ES default (30 seconds), but missing the units to make sure they are inserted on upgrade:, +    persistent['discovery.zen.publish_timeout'] = '30000', +    # Same as ES default (512 KB), but missing the units to make sure they are inserted on upgrade:, +    persistent['indices.recovery.file_chunk_size'] = '524288', +    'persistent': persistent, +def parse_version(version):, +  import re, +  splitted = re.split('[.-]', version), +  if len(splitted) == 3:, +    splitted = splitted + ['GA'], +  splitted = [s.lower() for s in splitted], +  assert len(splitted) == 4;, +  return splitted, +, +assert parse_version('5.0.0-alpha1') == parse_version('5.0.0-alpha1'), +assert parse_version('5.0.0-alpha1') < parse_version('5.0.0-alpha2'), +assert parse_version('5.0.0-alpha1') < parse_version('5.0.0-beta1'), +assert parse_version('5.0.0-beta1') < parse_version('5.0.0'), +assert parse_version('1.2.3') < parse_version('2.1.0'), +assert parse_version('1.2.3') < parse_version('1.2.4'), +assert parse_version('1.1.0') < parse_version('1.2.0'), +, +]