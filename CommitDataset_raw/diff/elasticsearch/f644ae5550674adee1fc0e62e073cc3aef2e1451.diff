[+++ b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java, +        public static final String ANALYZER = "analyzer";, +                if (fieldName.equals("analyzer")) {, +                    builder.indexAnalyzer(parserContext.analysisService().analyzer(fieldNode.toString()));, +                    builder.searchAnalyzer(parserContext.analysisService().analyzer(fieldNode.toString()));, +                } else if (fieldName.equals(Fields.INDEX_ANALYZER) || fieldName.equals("indexAnalyzer")) {, +        builder.startObject(name()), +            .field(Fields.TYPE, CONTENT_TYPE);, +        if (indexAnalyzer.name().equals(searchAnalyzer.name())) {, +            builder.field(Fields.ANALYZER, indexAnalyzer.name());, +        } else {, +            builder.field(Fields.INDEX_ANALYZER, indexAnalyzer.name()), +                .field(Fields.SEARCH_ANALYZER, searchAnalyzer.name());, +        }, +        builder.field(Fields.PAYLOADS, this.payloads), +, +        return builder;, +++ b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java, +        public static final String ANALYZER = "analyzer";, +                if (fieldName.equals("analyzer")) {, +                    builder.indexAnalyzer(parserContext.analysisService().analyzer(fieldNode.toString()));, +                    builder.searchAnalyzer(parserContext.analysisService().analyzer(fieldNode.toString()));, +                } else if (fieldName.equals(Fields.INDEX_ANALYZER) || fieldName.equals("indexAnalyzer")) {, +        builder.startObject(name()), +            .field(Fields.TYPE, CONTENT_TYPE);, +        if (indexAnalyzer.name().equals(searchAnalyzer.name())) {, +            builder.field(Fields.ANALYZER, indexAnalyzer.name());, +        } else {, +            builder.field(Fields.INDEX_ANALYZER, indexAnalyzer.name()), +                .field(Fields.SEARCH_ANALYZER, searchAnalyzer.name());, +        }, +        builder.field(Fields.PAYLOADS, this.payloads), +, +        return builder;, +++ b/src/main/java/org/elasticsearch/search/suggest/completion/AnalyzingCompletionLookupProvider.java, +                            suggestionContext.getFuzzyPrefixLength(), suggestionContext.getFuzzyMinLength(),, +++ b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java, +        public static final String ANALYZER = "analyzer";, +                if (fieldName.equals("analyzer")) {, +                    builder.indexAnalyzer(parserContext.analysisService().analyzer(fieldNode.toString()));, +                    builder.searchAnalyzer(parserContext.analysisService().analyzer(fieldNode.toString()));, +                } else if (fieldName.equals(Fields.INDEX_ANALYZER) || fieldName.equals("indexAnalyzer")) {, +        builder.startObject(name()), +            .field(Fields.TYPE, CONTENT_TYPE);, +        if (indexAnalyzer.name().equals(searchAnalyzer.name())) {, +            builder.field(Fields.ANALYZER, indexAnalyzer.name());, +        } else {, +            builder.field(Fields.INDEX_ANALYZER, indexAnalyzer.name()), +                .field(Fields.SEARCH_ANALYZER, searchAnalyzer.name());, +        }, +        builder.field(Fields.PAYLOADS, this.payloads), +, +        return builder;, +++ b/src/main/java/org/elasticsearch/search/suggest/completion/AnalyzingCompletionLookupProvider.java, +                            suggestionContext.getFuzzyPrefixLength(), suggestionContext.getFuzzyMinLength(),, +++ b/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestParser.java, +                        } else if ("min_length".equals(fuzzyConfigName) || "minLength".equals(fuzzyConfigName)) {, +                            suggestion.setFuzzyMinLength(parser.intValue());, +                        } else if ("prefix_length".equals(fuzzyConfigName) || "prefixLength".equals(fuzzyConfigName)) {, +                            suggestion.setFuzzyPrefixLength(parser.intValue());, +++ b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java, +        public static final String ANALYZER = "analyzer";, +                if (fieldName.equals("analyzer")) {, +                    builder.indexAnalyzer(parserContext.analysisService().analyzer(fieldNode.toString()));, +                    builder.searchAnalyzer(parserContext.analysisService().analyzer(fieldNode.toString()));, +                } else if (fieldName.equals(Fields.INDEX_ANALYZER) || fieldName.equals("indexAnalyzer")) {, +        builder.startObject(name()), +            .field(Fields.TYPE, CONTENT_TYPE);, +        if (indexAnalyzer.name().equals(searchAnalyzer.name())) {, +            builder.field(Fields.ANALYZER, indexAnalyzer.name());, +        } else {, +            builder.field(Fields.INDEX_ANALYZER, indexAnalyzer.name()), +                .field(Fields.SEARCH_ANALYZER, searchAnalyzer.name());, +        }, +        builder.field(Fields.PAYLOADS, this.payloads), +, +        return builder;, +++ b/src/main/java/org/elasticsearch/search/suggest/completion/AnalyzingCompletionLookupProvider.java, +                            suggestionContext.getFuzzyPrefixLength(), suggestionContext.getFuzzyMinLength(),, +++ b/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestParser.java, +                        } else if ("min_length".equals(fuzzyConfigName) || "minLength".equals(fuzzyConfigName)) {, +                            suggestion.setFuzzyMinLength(parser.intValue());, +                        } else if ("prefix_length".equals(fuzzyConfigName) || "prefixLength".equals(fuzzyConfigName)) {, +                            suggestion.setFuzzyPrefixLength(parser.intValue());, +++ b/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java, +import org.apache.lucene.util.UnicodeUtil;, +        CompletionSuggestion completionSuggestion = new CompletionSuggestion(name, suggestionContext.getSize());, +        UnicodeUtil.UTF8toUTF16(suggestionContext.getText(), spare);, +, +        CompletionSuggestion.Entry completionSuggestEntry = new CompletionSuggestion.Entry(new StringText(spare.toString()), 0, spare.length());, +        completionSuggestion.addTerm(completionSuggestEntry);, +, +        String fieldName = suggestionContext.getField();, +                List<Lookup.LookupResult> lookupResults = lookup.lookup(spare, false, suggestionContext.getSize());, +        int optionCount = Math.min(suggestionContext.getSize(), options.size());, +        for (int i = 0 ; i < optionCount ; i++) {, +        return completionSuggestion;, +++ b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java, +        public static final String ANALYZER = "analyzer";, +                if (fieldName.equals("analyzer")) {]