[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java, +import java.util.concurrent.atomic.AtomicBoolean;, +        final AtomicBoolean done = new AtomicBoolean();, +        final Set<DiscoveryNode> nodesToDisconnect1 = sendPings(id, timeout, false, done);, +                nodesToDisconnect.addAll(sendPings(id, timeout, true, done));, +                done.set(true);, +    Set<DiscoveryNode> sendPings(final int id, final TimeValue timeout, boolean wait, final AtomicBoolean done) {, +                        if (done.get()) {, +                            return;, +                        }]