[+++ b/plugin/src/main/java/org/elasticsearch/xpack/security/TokenPassphraseBootstrapCheck.java, +    private final boolean tokenServiceEnabled;, +    private final SecureString tokenPassphrase;, +        this.tokenServiceEnabled = XPackSettings.TOKEN_SERVICE_ENABLED_SETTING.get(settings);, +        this.tokenPassphrase = TokenService.TOKEN_PASSPHRASE.get(settings);, +        try (SecureString ignore = tokenPassphrase) {, +            if (tokenServiceEnabled) {, +                return tokenPassphrase.length() < MINIMUM_PASSPHRASE_LENGTH || tokenPassphrase.equals(TokenService.DEFAULT_PASSPHRASE);, +++ b/plugin/src/main/java/org/elasticsearch/xpack/security/TokenPassphraseBootstrapCheck.java, +    private final boolean tokenServiceEnabled;, +    private final SecureString tokenPassphrase;, +        this.tokenServiceEnabled = XPackSettings.TOKEN_SERVICE_ENABLED_SETTING.get(settings);, +        this.tokenPassphrase = TokenService.TOKEN_PASSPHRASE.get(settings);, +        try (SecureString ignore = tokenPassphrase) {, +            if (tokenServiceEnabled) {, +                return tokenPassphrase.length() < MINIMUM_PASSPHRASE_LENGTH || tokenPassphrase.equals(TokenService.DEFAULT_PASSPHRASE);, +++ b/plugin/src/test/java/org/elasticsearch/xpack/security/TokenPassphraseBootstrapCheckTests.java, +, +    public void testTokenPassphraseCheckAfterSecureSettingsClosed() throws Exception {, +        Settings settings = Settings.builder().put(XPackSettings.TOKEN_SERVICE_ENABLED_SETTING.getKey(), true).build();, +        MockSecureSettings secureSettings = new MockSecureSettings();, +        secureSettings.setString("foo", "bar"); // leniency in setSecureSettings... if its empty it's skipped, +        settings = Settings.builder().put(settings).setSecureSettings(secureSettings).build();, +        secureSettings.setString(TokenService.TOKEN_PASSPHRASE.getKey(), TokenService.DEFAULT_PASSPHRASE);, +        final TokenPassphraseBootstrapCheck check = new TokenPassphraseBootstrapCheck(settings);, +        secureSettings.close();, +        assertTrue(check.check());, +    }]