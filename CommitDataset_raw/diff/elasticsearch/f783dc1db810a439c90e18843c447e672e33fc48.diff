[+++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthenticationTests.java, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthenticationTests.java, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/ssl/ClientSSLServiceTests.java, +    private Environment env;, +    private Path testclientStore;, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +    private ClientSSLService createClientSSLService(Settings settings) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthenticationTests.java, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/ssl/ClientSSLServiceTests.java, +    private Environment env;, +    private Path testclientStore;, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +    private ClientSSLService createClientSSLService(Settings settings) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/ssl/ServerSSLServiceTests.java, +    private Path testnodeStore;, +    private Environment env;, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthenticationTests.java, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/ssl/ClientSSLServiceTests.java, +    private Environment env;, +    private Path testclientStore;, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +    private ClientSSLService createClientSSLService(Settings settings) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/ssl/ServerSSLServiceTests.java, +    private Path testnodeStore;, +    private Environment env;, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/transport/TransportFilterTests.java, +            return Collections.singletonList(new TestTransportFilterModule());, +    private static void await(CountDownLatch latch) throws Exception {, +            return Collections.singletonMap(TransportSettings.DEFAULT_PROFILE,, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthenticationTests.java, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/ssl/ClientSSLServiceTests.java, +    private Environment env;, +    private Path testclientStore;, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +    private ClientSSLService createClientSSLService(Settings settings) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/ssl/ServerSSLServiceTests.java, +    private Path testnodeStore;, +    private Environment env;, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/transport/TransportFilterTests.java, +            return Collections.singletonList(new TestTransportFilterModule());, +    private static void await(CountDownLatch latch) throws Exception {, +            return Collections.singletonMap(TransportSettings.DEFAULT_PROFILE,, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/transport/ssl/SslClientAuthTests.java, +import org.apache.http.conn.ssl.NoopHostnameVerifier;, +import org.apache.http.ssl.SSLContexts;, +import org.elasticsearch.test.SecurityIntegTestCase;, +import org.elasticsearch.transport.Transport;, +import org.elasticsearch.xpack.XPackPlugin;, +import static org.elasticsearch.xpack.security.authc.support.UsernamePasswordToken.basicAuthHeaderValue;, +                NoopHostnameVerifier.INSTANCE);, +                NoopHostnameVerifier.INSTANCE);, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthenticationTests.java, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(context).build()) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/ssl/ClientSSLServiceTests.java, +    private Environment env;, +    private Path testclientStore;, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(sslContext).build()) {, +    private ClientSSLService createClientSSLService(Settings settings) {, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/ssl/ServerSSLServiceTests.java, +    private Path testnodeStore;, +    private Environment env;, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/transport/TransportFilterTests.java, +            return Collections.singletonList(new TestTransportFilterModule());, +    private static void await(CountDownLatch latch) throws Exception {, +            return Collections.singletonMap(TransportSettings.DEFAULT_PROFILE,, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/transport/ssl/SslClientAuthTests.java, +import org.apache.http.conn.ssl.NoopHostnameVerifier;, +import org.apache.http.ssl.SSLContexts;, +import org.elasticsearch.test.SecurityIntegTestCase;, +import org.elasticsearch.transport.Transport;, +import org.elasticsearch.xpack.XPackPlugin;, +import static org.elasticsearch.xpack.security.authc.support.UsernamePasswordToken.basicAuthHeaderValue;, +                NoopHostnameVerifier.INSTANCE);, +                NoopHostnameVerifier.INSTANCE);, +++ b/elasticsearch/x-pack/security/src/test/java/org/elasticsearch/xpack/security/transport/ssl/SslIntegrationTests.java, +import org.apache.http.conn.ssl.NoopHostnameVerifier;, +        try (CloseableHttpClient client = HttpClients.custom().setSSLContext(service.sslContext()), +                NoopHostnameVerifier.INSTANCE);]