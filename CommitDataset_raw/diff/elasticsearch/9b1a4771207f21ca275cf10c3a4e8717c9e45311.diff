[+++ b/core/src/main/java/org/elasticsearch/cluster/ClusterInfo.java, +    final ImmutableOpenMap<ShardRouting, String> routingToDataPath;, +        Map<String, DiskUsage> leastMap = in.readMap(StreamInput::readString, DiskUsage::new);, +        Map<String, DiskUsage> mostMap = in.readMap(StreamInput::readString, DiskUsage::new);, +        Map<String, Long> sizeMap = in.readMap(StreamInput::readString, StreamInput::readLong);, +        Map<ShardRouting, String> routingMap = in.readMap(ShardRouting::new, StreamInput::readString);, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterInfo.java, +    final ImmutableOpenMap<ShardRouting, String> routingToDataPath;, +        Map<String, DiskUsage> leastMap = in.readMap(StreamInput::readString, DiskUsage::new);, +        Map<String, DiskUsage> mostMap = in.readMap(StreamInput::readString, DiskUsage::new);, +        Map<String, Long> sizeMap = in.readMap(StreamInput::readString, StreamInput::readLong);, +        Map<ShardRouting, String> routingMap = in.readMap(ShardRouting::new, StreamInput::readString);, +++ b/core/src/main/java/org/elasticsearch/cluster/DiskUsage.java, +import java.util.Objects;, +, +    public boolean equals(Object o) {, +        if (this == o) return true;, +        if (o == null || getClass() != o.getClass()) return false;, +, +        DiskUsage other = (DiskUsage) o;, +        return Objects.equals(nodeId, other.nodeId) &&, +                Objects.equals(nodeName, other.nodeName) &&, +                Objects.equals(totalBytes, other.totalBytes) &&, +                Objects.equals(freeBytes, other.freeBytes);, +, +    }, +, +    @Override, +    public int hashCode() {, +        return Objects.hash(nodeId, nodeName, path, totalBytes, freeBytes);, +    }, +, +    @Override, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterInfo.java, +    final ImmutableOpenMap<ShardRouting, String> routingToDataPath;, +        Map<String, DiskUsage> leastMap = in.readMap(StreamInput::readString, DiskUsage::new);, +        Map<String, DiskUsage> mostMap = in.readMap(StreamInput::readString, DiskUsage::new);, +        Map<String, Long> sizeMap = in.readMap(StreamInput::readString, StreamInput::readLong);, +        Map<ShardRouting, String> routingMap = in.readMap(ShardRouting::new, StreamInput::readString);, +++ b/core/src/main/java/org/elasticsearch/cluster/DiskUsage.java, +import java.util.Objects;, +, +    public boolean equals(Object o) {, +        if (this == o) return true;, +        if (o == null || getClass() != o.getClass()) return false;, +, +        DiskUsage other = (DiskUsage) o;, +        return Objects.equals(nodeId, other.nodeId) &&, +                Objects.equals(nodeName, other.nodeName) &&, +                Objects.equals(totalBytes, other.totalBytes) &&, +                Objects.equals(freeBytes, other.freeBytes);, +, +    }, +, +    @Override, +    public int hashCode() {, +        return Objects.hash(nodeId, nodeName, path, totalBytes, freeBytes);, +    }, +, +    @Override, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +    public <K, V> Map<K, V> readMap(Writeable.Reader<K> keyReader, Writeable.Reader<V> valueReader) throws IOException {, +        int size = readVInt();, +        Map<K, V> map = new HashMap<>(size);, +        for (int i = 0; i < size; i++) {, +            K key = keyReader.read(this);, +            V value = valueReader.read(this);, +            map.put(key, value);, +        }, +        return map;, +    }, +, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterInfo.java, +    final ImmutableOpenMap<ShardRouting, String> routingToDataPath;, +        Map<String, DiskUsage> leastMap = in.readMap(StreamInput::readString, DiskUsage::new);, +        Map<String, DiskUsage> mostMap = in.readMap(StreamInput::readString, DiskUsage::new);, +        Map<String, Long> sizeMap = in.readMap(StreamInput::readString, StreamInput::readLong);, +        Map<ShardRouting, String> routingMap = in.readMap(ShardRouting::new, StreamInput::readString);, +++ b/core/src/main/java/org/elasticsearch/cluster/DiskUsage.java, +import java.util.Objects;, +, +    public boolean equals(Object o) {, +        if (this == o) return true;, +        if (o == null || getClass() != o.getClass()) return false;, +, +        DiskUsage other = (DiskUsage) o;, +        return Objects.equals(nodeId, other.nodeId) &&, +                Objects.equals(nodeName, other.nodeName) &&, +                Objects.equals(totalBytes, other.totalBytes) &&, +                Objects.equals(freeBytes, other.freeBytes);, +, +    }, +, +    @Override, +    public int hashCode() {, +        return Objects.hash(nodeId, nodeName, path, totalBytes, freeBytes);, +    }, +, +    @Override, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java]