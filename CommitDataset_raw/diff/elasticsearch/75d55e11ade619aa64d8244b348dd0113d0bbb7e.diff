[+++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestParser.java, +            Map<String, List<ContextMapping.QueryContext>> queryContexts = Collections.emptyMap();, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestParser.java, +            Map<String, List<ContextMapping.QueryContext>> queryContexts = Collections.emptyMap();, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java, +    private Map<String, List<ToXContent>> queryContexts;, +        return contexts(name, queryContexts);, +        return contexts(name, queryContexts);, +    }, +, +    private CompletionSuggestionBuilder contexts(String name, ToXContent... queryContexts) {, +        if (this.queryContexts == null) {, +            this.queryContexts = new HashMap<>(2);, +        }, +        List<ToXContent> contexts = this.queryContexts.get(name);, +        if (contexts == null) {, +            contexts = new ArrayList<>(2);, +            this.queryContexts.put(name, contexts);, +        }, +        Collections.addAll(contexts, queryContexts);, +        return this;, +            for (Map.Entry<String, List<ToXContent>> entry : this.queryContexts.entrySet()) {, +                for (ToXContent queryContext : entry.getValue()) {, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestParser.java, +            Map<String, List<ContextMapping.QueryContext>> queryContexts = Collections.emptyMap();, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java, +    private Map<String, List<ToXContent>> queryContexts;, +        return contexts(name, queryContexts);, +        return contexts(name, queryContexts);, +    }, +, +    private CompletionSuggestionBuilder contexts(String name, ToXContent... queryContexts) {, +        if (this.queryContexts == null) {, +            this.queryContexts = new HashMap<>(2);, +        }, +        List<ToXContent> contexts = this.queryContexts.get(name);, +        if (contexts == null) {, +            contexts = new ArrayList<>(2);, +            this.queryContexts.put(name, contexts);, +        }, +        Collections.addAll(contexts, queryContexts);, +        return this;, +            for (Map.Entry<String, List<ToXContent>> entry : this.queryContexts.entrySet()) {, +                for (ToXContent queryContext : entry.getValue()) {, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionContext.java, +import org.elasticsearch.search.suggest.completion.context.ContextMapping;, +    private Map<String, List<ContextMapping.QueryContext>> queryContexts;, +    void setQueryContexts(Map<String, List<ContextMapping.QueryContext>> queryContexts) {, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestParser.java, +            Map<String, List<ContextMapping.QueryContext>> queryContexts = Collections.emptyMap();, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java, +    private Map<String, List<ToXContent>> queryContexts;, +        return contexts(name, queryContexts);, +        return contexts(name, queryContexts);, +    }, +, +    private CompletionSuggestionBuilder contexts(String name, ToXContent... queryContexts) {, +        if (this.queryContexts == null) {, +            this.queryContexts = new HashMap<>(2);, +        }, +        List<ToXContent> contexts = this.queryContexts.get(name);, +        if (contexts == null) {, +            contexts = new ArrayList<>(2);, +            this.queryContexts.put(name, contexts);, +        }, +        Collections.addAll(contexts, queryContexts);, +        return this;, +            for (Map.Entry<String, List<ToXContent>> entry : this.queryContexts.entrySet()) {, +                for (ToXContent queryContext : entry.getValue()) {, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionContext.java, +import org.elasticsearch.search.suggest.completion.context.ContextMapping;, +    private Map<String, List<ContextMapping.QueryContext>> queryContexts;, +    void setQueryContexts(Map<String, List<ContextMapping.QueryContext>> queryContexts) {, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/context/CategoryContextMapping.java, +    public List<QueryContext> parseQueryContext(XContentParser parser) throws IOException, ElasticsearchParseException {, +        List<QueryContext> queryContexts = new ArrayList<>();, +            CategoryQueryContext parse = CategoryQueryContext.parse(parser);, +            queryContexts.add(new QueryContext(parse.context.toString(), parse.boost, parse.isPrefix));, +                CategoryQueryContext parse = CategoryQueryContext.parse(parser);, +                queryContexts.add(new QueryContext(parse.context.toString(), parse.boost, parse.isPrefix));, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestParser.java, +            Map<String, List<ContextMapping.QueryContext>> queryContexts = Collections.emptyMap();, +++ b/core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java, +    private Map<String, List<ToXContent>> queryContexts;, +        return contexts(name, queryContexts);, +        return contexts(name, queryContexts);, +    }, +, +    private CompletionSuggestionBuilder contexts(String name, ToXContent... queryContexts) {, +        if (this.queryContexts == null) {, +            this.queryContexts = new HashMap<>(2);, +        }, +        List<ToXContent> contexts = this.queryContexts.get(name);, +        if (contexts == null) {, +            contexts = new ArrayList<>(2);, +            this.queryContexts.put(name, contexts);, +        }, +        Collections.addAll(contexts, queryContexts);, +        return this;, +            for (Map.Entry<String, List<ToXContent>> entry : this.queryContexts.entrySet()) {]