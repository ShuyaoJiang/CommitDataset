[+++ b/buildSrc/.gitignore, +build-bootstrap/, +++ b/buildSrc/.gitignore, +build-bootstrap/, +++ b/buildSrc/build.gradle, +import java.nio.file.Files, +, +, +if (project == rootProject) {, +  // change the build dir used during build init, so that doing a clean, +  // won't wipe out the buildscript jar, +  buildDir = 'build-bootstrap', +}, +, +/*****************************************************************************, + *         Propagating version.properties to the rest of the build           *, + *****************************************************************************/, +/*****************************************************************************, + *                    Dependencies used by the entire build                  *, + *****************************************************************************/, +, +repositories {, +  jcenter(), +}, +, +dependencies {, +  compile gradleApi(), +  compile localGroovy(), +  compile "com.carrotsearch.randomizedtesting:junit4-ant:${props.getProperty('randomizedrunner')}", +  compile("junit:junit:${props.getProperty('junit')}") {, +    transitive = false, +  }, +  compile 'com.netflix.nebula:gradle-extra-configurations-plugin:3.0.3', +  compile 'com.netflix.nebula:nebula-publishing-plugin:4.4.4', +  compile 'com.netflix.nebula:gradle-info-plugin:3.0.3', +  compile 'org.eclipse.jgit:org.eclipse.jgit:3.2.0.201312181205-r', +  compile 'com.perforce:p4java:2012.3.551082' // THIS IS SUPPOSED TO BE OPTIONAL IN THE FUTURE...., +  compile 'de.thetaphi:forbiddenapis:2.0', +  compile 'com.bmuschko:gradle-nexus-plugin:2.3.1', +  compile 'org.apache.rat:apache-rat:0.11', +}, +, +, +/*****************************************************************************, + *                    Bootstrap repositories and IDE setup                   *, + *****************************************************************************/, +// this will only happen when buildSrc is built on its own during build init, +if (project == rootProject) {, +, +  // TODO: move common IDE configuration to a common file to include, +  apply plugin: 'idea', +  apply plugin: 'eclipse', +, +  repositories {, +    mavenCentral(), +    maven {, +      name 'sonatype-snapshots', +      url "https://oss.sonatype.org/content/repositories/snapshots/", +    }, +}, +, +/*****************************************************************************, + *                           Normal project checks                           *, + *****************************************************************************/, +, +// this happens when included as a normal project in the build, which we do, +// to enforce precommit checks like forbidden apis, as well as setup publishing, +if (project != rootProject) {, +  apply plugin: 'elasticsearch.build', +  apply plugin: 'nebula.maven-base-publish', +  apply plugin: 'nebula.maven-scm', +, +  // groovydoc succeeds, but has some weird internal exception..., +  groovydoc.enabled = false, +, +  // build-tools is not ready for primetime with these..., +  dependencyLicenses.enabled = false, +  forbiddenApisMain.enabled = false, +  jarHell.enabled = false, +  loggerUsageCheck.enabled = false, +  thirdPartyAudit.enabled = false, +, +  // test for elasticsearch.build tries to run with ES..., +  test.enabled = false, +, +  // TODO: re-enable once randomizedtesting gradle code is published and removed from here, +  licenseHeaders.enabled = false, +, +  forbiddenPatterns {, +    exclude '**/*.wav', +    // the file that actually defines nocommit, +    exclude '**/ForbiddenPatternsTask.groovy', +  }, +}, +++ b/buildSrc/.gitignore, +build-bootstrap/, +++ b/buildSrc/build.gradle, +import java.nio.file.Files, +, +]