[+++ b/core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java, +import static org.hamcrest.Matchers.both;, +import static org.hamcrest.Matchers.lessThanOrEqualTo;, +            final int indexedDuringRecovery = shards.indexDocs(randomInt(5));, +            docs += indexedDuringRecovery;, +            assertThat(newReplica.recoveryState().getTranslog().recoveredOperations(),, +                // we don't know which of the inflight operations made it into the translog range we re-play, +                both(greaterThanOrEqualTo(docs-indexedDuringRecovery)).and(lessThanOrEqualTo(docs)));]