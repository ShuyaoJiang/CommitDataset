[+++ b/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +, +            if (parent != null && !mappingMd.hasParentField()) {, +                throw new ElasticSearchIllegalArgumentException("Can't specify parent if no parent field has been configured");, +            }, +        } else {, +            if (parent != null) {, +                throw new ElasticSearchIllegalArgumentException("Can't specify parent if no parent field has been configured");, +            }, +++ b/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +, +            if (parent != null && !mappingMd.hasParentField()) {, +                throw new ElasticSearchIllegalArgumentException("Can't specify parent if no parent field has been configured");, +            }, +        } else {, +            if (parent != null) {, +                throw new ElasticSearchIllegalArgumentException("Can't specify parent if no parent field has been configured");, +            }, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java, +import org.elasticsearch.Version;, +    private boolean hasParentField;, +        this.hasParentField = docMapper.parentFieldMapper().active();, +        if (withoutType.containsKey("_parent")) {, +            this.hasParentField = true;, +        } else {, +            this.hasParentField = false;, +        }, +    public MappingMetaData(String type, CompressedString source, Id id, Routing routing, Timestamp timestamp, boolean hasParentField) {, +        this.hasParentField = hasParentField;, +    public boolean hasParentField() {, +        return hasParentField;, +    }, +, +        if (out.getVersion().onOrAfter(Version.V_0_90_6)) {, +            out.writeBoolean(mappingMd.hasParentField());, +        }, +        final boolean hasParentField;, +        if (in.getVersion().onOrAfter(Version.V_0_90_6)) {, +            hasParentField = in.readBoolean();, +        } else {, +            hasParentField = true; // We assume here that the type has a parent field, which is confirm with the behaviour of <= 0.90.5, +        }, +        return new MappingMetaData(type, source, id, routing, timestamp, hasParentField);, +++ b/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +, +            if (parent != null && !mappingMd.hasParentField()) {, +                throw new ElasticSearchIllegalArgumentException("Can't specify parent if no parent field has been configured");, +            }, +        } else {, +            if (parent != null) {, +                throw new ElasticSearchIllegalArgumentException("Can't specify parent if no parent field has been configured");, +            }, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java, +import org.elasticsearch.Version;, +    private boolean hasParentField;, +        this.hasParentField = docMapper.parentFieldMapper().active();, +        if (withoutType.containsKey("_parent")) {, +            this.hasParentField = true;, +        } else {, +            this.hasParentField = false;, +        }, +    public MappingMetaData(String type, CompressedString source, Id id, Routing routing, Timestamp timestamp, boolean hasParentField) {, +        this.hasParentField = hasParentField;, +    public boolean hasParentField() {, +        return hasParentField;, +    }, +, +        if (out.getVersion().onOrAfter(Version.V_0_90_6)) {, +            out.writeBoolean(mappingMd.hasParentField());, +        }, +        final boolean hasParentField;, +        if (in.getVersion().onOrAfter(Version.V_0_90_6)) {, +            hasParentField = in.readBoolean();, +        } else {, +            hasParentField = true; // We assume here that the type has a parent field, which is confirm with the behaviour of <= 0.90.5, +        }, +        return new MappingMetaData(type, source, id, routing, timestamp, hasParentField);, +++ b/src/main/java/org/elasticsearch/index/cache/id/simple/SimpleIdCache.java, +                    if (parentFieldMapper.active()) {, +++ b/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +, +            if (parent != null && !mappingMd.hasParentField()) {, +                throw new ElasticSearchIllegalArgumentException("Can't specify parent if no parent field has been configured");, +            }, +        } else {, +            if (parent != null) {, +                throw new ElasticSearchIllegalArgumentException("Can't specify parent if no parent field has been configured");, +            }, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java, +import org.elasticsearch.Version;, +    private boolean hasParentField;, +        this.hasParentField = docMapper.parentFieldMapper().active();, +        if (withoutType.containsKey("_parent")) {, +            this.hasParentField = true;, +        } else {, +            this.hasParentField = false;, +        }, +    public MappingMetaData(String type, CompressedString source, Id id, Routing routing, Timestamp timestamp, boolean hasParentField) {, +        this.hasParentField = hasParentField;, +    public boolean hasParentField() {]