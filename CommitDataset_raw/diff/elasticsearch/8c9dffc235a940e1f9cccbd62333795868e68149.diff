[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java, +import org.elasticsearch.common.Strings;, +        String[] elements = Strings.splitStringToArray(scrollId, ';');, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java, +import org.elasticsearch.common.Strings;, +        String[] elements = Strings.splitStringToArray(scrollId, ';');, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java, +                    indexToSearchRoutingMap.put(indexMetaData.index(), ImmutableSet.copyOf(Strings.splitStringByCommaToSet(aliasMd.searchRouting())));, +            Set<String> r = Strings.splitStringByCommaToSet(routing);, +        Set<String> paramRouting = null;, +            paramRouting = Strings.splitStringByCommaToSet(routing);, +                routings = ImmutableMap.of(aliasOrIndex, paramRouting);, +        Map<String, Set<String>> routings = null;, +        Set<String> paramRouting = null;, +        // List of indices that don't require any routing, +        Set<String> norouting = newHashSet();, +        if (routing != null) {, +            paramRouting = Strings.splitStringByCommaToSet(routing);, +        }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java, +import org.elasticsearch.common.Strings;, +        String[] elements = Strings.splitStringToArray(scrollId, ';');, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java, +                    indexToSearchRoutingMap.put(indexMetaData.index(), ImmutableSet.copyOf(Strings.splitStringByCommaToSet(aliasMd.searchRouting())));, +            Set<String> r = Strings.splitStringByCommaToSet(routing);, +        Set<String> paramRouting = null;, +            paramRouting = Strings.splitStringByCommaToSet(routing);, +                routings = ImmutableMap.of(aliasOrIndex, paramRouting);, +        Map<String, Set<String>> routings = null;, +        Set<String> paramRouting = null;, +        // List of indices that don't require any routing, +        Set<String> norouting = newHashSet();, +        if (routing != null) {, +            paramRouting = Strings.splitStringByCommaToSet(routing);, +        }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/PlainShardsIterator.java, +    @Override public ShardRouting nextActiveOrNull() {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java, +import org.elasticsearch.common.Strings;, +        String[] elements = Strings.splitStringToArray(scrollId, ';');, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java, +                    indexToSearchRoutingMap.put(indexMetaData.index(), ImmutableSet.copyOf(Strings.splitStringByCommaToSet(aliasMd.searchRouting())));, +            Set<String> r = Strings.splitStringByCommaToSet(routing);, +        Set<String> paramRouting = null;, +            paramRouting = Strings.splitStringByCommaToSet(routing);, +                routings = ImmutableMap.of(aliasOrIndex, paramRouting);, +        Map<String, Set<String>> routings = null;, +        Set<String> paramRouting = null;, +        // List of indices that don't require any routing, +        Set<String> norouting = newHashSet();, +        if (routing != null) {, +            paramRouting = Strings.splitStringByCommaToSet(routing);, +        }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/PlainShardsIterator.java, +    @Override public ShardRouting nextActiveOrNull() {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java, +import org.elasticsearch.common.Strings;, +        String[] elements = Strings.splitStringToArray(scrollId, ';');, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java, +                    indexToSearchRoutingMap.put(indexMetaData.index(), ImmutableSet.copyOf(Strings.splitStringByCommaToSet(aliasMd.searchRouting())));, +            Set<String> r = Strings.splitStringByCommaToSet(routing);, +        Set<String> paramRouting = null;, +            paramRouting = Strings.splitStringByCommaToSet(routing);, +                routings = ImmutableMap.of(aliasOrIndex, paramRouting);, +        Map<String, Set<String>> routings = null;, +        Set<String> paramRouting = null;, +        // List of indices that don't require any routing, +        Set<String> norouting = newHashSet();, +        if (routing != null) {, +            paramRouting = Strings.splitStringByCommaToSet(routing);, +        }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/PlainShardsIterator.java, +    @Override public ShardRouting nextActiveOrNull() {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/Strings.java, +import org.elasticsearch.common.trove.set.hash.THashSet;, +    public static Set<String> splitStringByCommaToSet(final String s) {, +        return splitStringToSet(s, ',');, +    }, +, +    public static String[] splitStringByCommaToArray(final String s) {, +        return splitStringToArray(s, ',');, +    }, +, +    public static Set<String> splitStringToSet(final String s, final char c) {, +        final char[] chars = s.toCharArray();, +        int count = 1;, +        for (final char x : chars) {, +            if (x == c) {, +                count++;, +            }, +        }, +        final THashSet<String> result = new THashSet<String>(count);, +        final int len = chars.length;, +        int start = 0;  // starting index in chars of the current substring.]