[+++ b/src/main/java/org/elasticsearch/index/query/CustomFiltersScoreQueryParser.java, +                SearchScript searchScript = parseContext.scriptService().search(parseContext.lookup(), scriptLang, script, vars);, +++ b/src/main/java/org/elasticsearch/index/query/CustomFiltersScoreQueryParser.java, +                SearchScript searchScript = parseContext.scriptService().search(parseContext.lookup(), scriptLang, script, vars);, +++ b/src/main/java/org/elasticsearch/index/query/CustomScoreQueryParser.java, +        SearchScript searchScript = parseContext.scriptService().search(parseContext.lookup(), scriptLang, script, vars);, +++ b/src/main/java/org/elasticsearch/index/query/CustomFiltersScoreQueryParser.java, +                SearchScript searchScript = parseContext.scriptService().search(parseContext.lookup(), scriptLang, script, vars);, +++ b/src/main/java/org/elasticsearch/index/query/CustomScoreQueryParser.java, +        SearchScript searchScript = parseContext.scriptService().search(parseContext.lookup(), scriptLang, script, vars);, +++ b/src/main/java/org/elasticsearch/index/query/QueryParseContext.java, +import org.elasticsearch.search.internal.SearchContext;, +import org.elasticsearch.search.lookup.SearchLookup;, +        this.lookup = null;, +, +    private SearchLookup lookup = null;, +, +    public SearchLookup lookup() {, +        SearchContext current = SearchContext.current();, +        if (current != null) {, +            return current.lookup();, +        }, +        if (lookup == null) {, +            lookup = new SearchLookup(mapperService(), indexCache().fieldData());, +        }, +        return lookup;, +    }]