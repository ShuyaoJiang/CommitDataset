[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedCountHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedCountHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedValueHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedCountHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedValueHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedValueScriptHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedCountHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedValueHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedValueScriptHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/InternalBoundedCountHistogramFacet.java, +            InternalBoundedCountHistogramFacet firstHistoFacet = (InternalBoundedCountHistogramFacet) facets.get(0);, +            if (comparatorType != ComparatorType.KEY) {, +                Arrays.sort(firstHistoFacet.entries, comparatorType.comparator());, +            }, +        if (comparatorType != ComparatorType.KEY) {, +            Arrays.sort(firstHistoFacet.entries, comparatorType.comparator());, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedCountHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedValueHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {, +            normalizedTo += interval;, +        }, +        long offset = -normalizedFrom;, +        int size = (int) ((normalizedTo - normalizedFrom) / interval);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedValueScriptHistogramFacetCollector.java, +        long normalizedFrom = (((long) ((double) from / interval)) * interval);, +        long normalizedTo = (((long) ((double) to / interval)) * interval);, +        if ((to % interval) != 0) {]