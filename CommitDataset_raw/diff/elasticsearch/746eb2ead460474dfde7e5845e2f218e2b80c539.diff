[+++ b/plugin/src/main/java/org/elasticsearch/xpack/XPackSettings.java, +    public static final Setting<Boolean> MACHINE_LEARNING_ENABLED = enabledSetting(XPackPlugin.MACHINE_LEARNING, true);, +++ b/plugin/src/main/java/org/elasticsearch/xpack/XPackSettings.java, +    public static final Setting<Boolean> MACHINE_LEARNING_ENABLED = enabledSetting(XPackPlugin.MACHINE_LEARNING, true);, +++ b/plugin/src/test/java/org/elasticsearch/license/AbstractLicensesIntegrationTestCase.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put(MachineLearning.AUTODETECT_PROCESS.getKey(), false), +++ b/plugin/src/main/java/org/elasticsearch/xpack/XPackSettings.java, +    public static final Setting<Boolean> MACHINE_LEARNING_ENABLED = enabledSetting(XPackPlugin.MACHINE_LEARNING, true);, +++ b/plugin/src/test/java/org/elasticsearch/license/AbstractLicensesIntegrationTestCase.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put(MachineLearning.AUTODETECT_PROCESS.getKey(), false), +++ b/plugin/src/test/java/org/elasticsearch/license/LicensesManagerServiceTests.java, +            .put(XPackSettings.GRAPH_ENABLED.getKey(), false), +            .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +            .build();, +++ b/plugin/src/main/java/org/elasticsearch/xpack/XPackSettings.java, +    public static final Setting<Boolean> MACHINE_LEARNING_ENABLED = enabledSetting(XPackPlugin.MACHINE_LEARNING, true);, +++ b/plugin/src/test/java/org/elasticsearch/license/AbstractLicensesIntegrationTestCase.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put(MachineLearning.AUTODETECT_PROCESS.getKey(), false), +++ b/plugin/src/test/java/org/elasticsearch/license/LicensesManagerServiceTests.java, +            .put(XPackSettings.GRAPH_ENABLED.getKey(), false), +            .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +            .build();, +++ b/plugin/src/test/java/org/elasticsearch/license/TribeTransportTestCase.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +        builder.put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), enabledFeatures.contains(XPackPlugin.MACHINE_LEARNING));, +        builder.put(MachineLearning.AUTODETECT_PROCESS.getKey(), false);, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put(MachineLearning.AUTODETECT_PROCESS.getKey(), false), +                .put("tribe.t1." + XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put("tribe.t2." + XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put("tribe.t1." + MachineLearning.AUTODETECT_PROCESS.getKey(), false), +                .put("tribe.t2." + MachineLearning.AUTODETECT_PROCESS.getKey(), false), +++ b/plugin/src/main/java/org/elasticsearch/xpack/XPackSettings.java, +    public static final Setting<Boolean> MACHINE_LEARNING_ENABLED = enabledSetting(XPackPlugin.MACHINE_LEARNING, true);, +++ b/plugin/src/test/java/org/elasticsearch/license/AbstractLicensesIntegrationTestCase.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put(MachineLearning.AUTODETECT_PROCESS.getKey(), false), +++ b/plugin/src/test/java/org/elasticsearch/license/LicensesManagerServiceTests.java, +            .put(XPackSettings.GRAPH_ENABLED.getKey(), false), +            .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +            .build();, +++ b/plugin/src/test/java/org/elasticsearch/license/TribeTransportTestCase.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +        builder.put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), enabledFeatures.contains(XPackPlugin.MACHINE_LEARNING));, +        builder.put(MachineLearning.AUTODETECT_PROCESS.getKey(), false);, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put(MachineLearning.AUTODETECT_PROCESS.getKey(), false), +                .put("tribe.t1." + XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put("tribe.t2." + XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put("tribe.t1." + MachineLearning.AUTODETECT_PROCESS.getKey(), false), +                .put("tribe.t2." + MachineLearning.AUTODETECT_PROCESS.getKey(), false), +++ b/plugin/src/test/java/org/elasticsearch/test/SecuritySettingsSource.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put(MachineLearning.AUTODETECT_PROCESS.getKey(), false), +++ b/plugin/src/main/java/org/elasticsearch/xpack/XPackSettings.java, +    public static final Setting<Boolean> MACHINE_LEARNING_ENABLED = enabledSetting(XPackPlugin.MACHINE_LEARNING, true);, +++ b/plugin/src/test/java/org/elasticsearch/license/AbstractLicensesIntegrationTestCase.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put(MachineLearning.AUTODETECT_PROCESS.getKey(), false), +++ b/plugin/src/test/java/org/elasticsearch/license/LicensesManagerServiceTests.java, +            .put(XPackSettings.GRAPH_ENABLED.getKey(), false), +            .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +            .build();, +++ b/plugin/src/test/java/org/elasticsearch/license/TribeTransportTestCase.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +        builder.put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), enabledFeatures.contains(XPackPlugin.MACHINE_LEARNING));, +        builder.put(MachineLearning.AUTODETECT_PROCESS.getKey(), false);, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put(MachineLearning.AUTODETECT_PROCESS.getKey(), false), +                .put("tribe.t1." + XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put("tribe.t2." + XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put("tribe.t1." + MachineLearning.AUTODETECT_PROCESS.getKey(), false), +                .put("tribe.t2." + MachineLearning.AUTODETECT_PROCESS.getKey(), false), +++ b/plugin/src/test/java/org/elasticsearch/test/SecuritySettingsSource.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false), +                .put(MachineLearning.AUTODETECT_PROCESS.getKey(), false), +++ b/plugin/src/test/java/org/elasticsearch/xpack/ml/MachineLearningFeatureSetTests.java, +        boolean useDefault = randomBoolean();, +        boolean enabled = true;, +        if (useDefault == false) {, +            enabled = randomBoolean();, +        boolean expected = enabled || useDefault;, +        assertThat(featureSet.enabled(), is(expected));, +        assertThat(featureSet.usage().enabled(), is(expected));, +        assertThat(serializedUsage.enabled(), is(expected));, +++ b/plugin/src/main/java/org/elasticsearch/xpack/XPackSettings.java, +    public static final Setting<Boolean> MACHINE_LEARNING_ENABLED = enabledSetting(XPackPlugin.MACHINE_LEARNING, true);, +++ b/plugin/src/test/java/org/elasticsearch/license/AbstractLicensesIntegrationTestCase.java, +import org.elasticsearch.xpack.ml.MachineLearning;, +                .put(XPackSettings.MACHINE_LEARNING_ENABLED.getKey(), false)]