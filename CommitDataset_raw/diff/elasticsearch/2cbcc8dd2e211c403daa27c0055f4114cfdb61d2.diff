[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/SearchService.java, +            contextProcessing(context);, +            contextProcessingDone(context);, +            contextProcessing(context);, +            contextProcessingDone(context);, +            contextProcessing(context);, +            contextProcessingDone(context);, +        contextProcessing(context);, +            contextProcessingDone(context);, +        activeContexts.put(context.id(), context);, +        contextProcessing(context);, +            if (context.scroll() == null) {, +                freeContext(context.id());, +            } else {, +                contextProcessingDone(context);, +        contextProcessing(context);, +            } else {, +                contextProcessingDone(context);, +        contextProcessing(context);, +            } else {, +                contextProcessingDone(context);, +        contextProcessing(context);, +            } else {, +                contextProcessingDone(context);, +    private void contextProcessing(SearchContext context) {, +        if (context.keepAliveTimeout() != null) {, +            ((KeepAliveTimerTask) context.keepAliveTimeout().getTask()).processing();, +        }, +    }, +, +    private void contextProcessingDone(SearchContext context) {, +        if (context.keepAliveTimeout() != null) {, +            ((KeepAliveTimerTask) context.keepAliveTimeout().getTask()).doneProcessing();, +        } else {, +            context.accessed(timerService.estimatedTimeInMillis());, +            context.keepAliveTimeout(timerService.newTimeout(new KeepAliveTimerTask(context), context.keepAlive(), TimerService.ExecutionType.DEFAULT));, +        }, +    }, +, +        KeepAliveTimerTask(SearchContext context) {, +        public void processing() {, +            context.keepAliveTimeout().cancel();, +        }, +, +        public void doneProcessing() {, +            context.accessed(timerService.estimatedTimeInMillis());, +            context.keepAliveTimeout(timerService.newTimeout(this, context.keepAlive(), TimerService.ExecutionType.DEFAULT));, +        }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/SearchService.java, +            contextProcessing(context);, +            contextProcessingDone(context);, +            contextProcessing(context);, +            contextProcessingDone(context);, +            contextProcessing(context);, +            contextProcessingDone(context);, +        contextProcessing(context);, +            contextProcessingDone(context);, +        activeContexts.put(context.id(), context);, +        contextProcessing(context);, +            if (context.scroll() == null) {, +                freeContext(context.id());, +            } else {, +                contextProcessingDone(context);, +        contextProcessing(context);, +            } else {, +                contextProcessingDone(context);, +        contextProcessing(context);, +            } else {, +                contextProcessingDone(context);, +        contextProcessing(context);, +            } else {, +                contextProcessingDone(context);, +    private void contextProcessing(SearchContext context) {, +        if (context.keepAliveTimeout() != null) {, +            ((KeepAliveTimerTask) context.keepAliveTimeout().getTask()).processing();, +        }, +    }, +, +    private void contextProcessingDone(SearchContext context) {, +        if (context.keepAliveTimeout() != null) {, +            ((KeepAliveTimerTask) context.keepAliveTimeout().getTask()).doneProcessing();, +        } else {, +            context.accessed(timerService.estimatedTimeInMillis());, +            context.keepAliveTimeout(timerService.newTimeout(new KeepAliveTimerTask(context), context.keepAlive(), TimerService.ExecutionType.DEFAULT));, +        }, +    }, +, +        KeepAliveTimerTask(SearchContext context) {, +        public void processing() {, +            context.keepAliveTimeout().cancel();, +        }, +, +        public void doneProcessing() {, +            context.accessed(timerService.estimatedTimeInMillis());, +            context.keepAliveTimeout(timerService.newTimeout(this, context.keepAlive(), TimerService.ExecutionType.DEFAULT));, +        }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/internal/SearchContext.java, +    public Timeout keepAliveTimeout() {]