[+++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/license/StartBasicLicenseTests.java, +import org.elasticsearch.client.Request;, +        Response response = restClient.performRequest(new Request("GET", "/_xpack/license/basic_status"));, +        Request ackRequest = new Request("POST", "/_xpack/license/start_basic");, +        ackRequest.addParameter("acknowledge", "true");, +        Response response2 = restClient.performRequest(ackRequest);, +        Response response3 = restClient.performRequest(new Request("GET", "/_xpack/license"));, +        Response response4 = restClient.performRequest(new Request("GET", "/_xpack/license/basic_status"));, +                () -> restClient.performRequest(new Request("POST", "/_xpack/license/start_basic")));, +        Response response2 = getRestClient().performRequest(new Request("POST", "/_xpack/license/start_basic"));, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/license/StartBasicLicenseTests.java, +import org.elasticsearch.client.Request;, +        Response response = restClient.performRequest(new Request("GET", "/_xpack/license/basic_status"));, +        Request ackRequest = new Request("POST", "/_xpack/license/start_basic");, +        ackRequest.addParameter("acknowledge", "true");, +        Response response2 = restClient.performRequest(ackRequest);, +        Response response3 = restClient.performRequest(new Request("GET", "/_xpack/license"));, +        Response response4 = restClient.performRequest(new Request("GET", "/_xpack/license/basic_status"));, +                () -> restClient.performRequest(new Request("POST", "/_xpack/license/start_basic")));, +        Response response2 = getRestClient().performRequest(new Request("POST", "/_xpack/license/start_basic"));, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/license/StartTrialLicenseTests.java, +import org.elasticsearch.client.Request;, +        Response response = restClient.performRequest(new Request("GET", "/_xpack/license/trial_status"));, +        Response response2 = restClient.performRequest(new Request("POST", "/_xpack/license/start_trial"));, +        Request ackRequest = new Request("POST", "/_xpack/license/start_trial");, +        ackRequest.addParameter("acknowledge", "true");, +        ackRequest.addParameter("type", type);, +        Response response3 = restClient.performRequest(ackRequest);, +        Response response4 = restClient.performRequest(new Request("GET", "/_xpack/license/trial_status"));, +        Request startTrialWhenStartedRequest = new Request("POST", "/_xpack/license/start_trial");, +        startTrialWhenStartedRequest.addParameter("acknowledge", "true");, +        startTrialWhenStartedRequest.addParameter("type", secondAttemptType);, +        ResponseException ex = expectThrows(ResponseException.class, () -> restClient.performRequest(startTrialWhenStartedRequest));, +        Request request = new Request("POST", "/_xpack/license/start_trial");, +        request.addParameter("type", "basic");, +        ResponseException ex = expectThrows(ResponseException.class, () -> getRestClient().performRequest(request));, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/license/StartBasicLicenseTests.java, +import org.elasticsearch.client.Request;, +        Response response = restClient.performRequest(new Request("GET", "/_xpack/license/basic_status"));, +        Request ackRequest = new Request("POST", "/_xpack/license/start_basic");, +        ackRequest.addParameter("acknowledge", "true");, +        Response response2 = restClient.performRequest(ackRequest);, +        Response response3 = restClient.performRequest(new Request("GET", "/_xpack/license"));, +        Response response4 = restClient.performRequest(new Request("GET", "/_xpack/license/basic_status"));, +                () -> restClient.performRequest(new Request("POST", "/_xpack/license/start_basic")));, +        Response response2 = getRestClient().performRequest(new Request("POST", "/_xpack/license/start_basic"));, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/license/StartTrialLicenseTests.java, +import org.elasticsearch.client.Request;, +        Response response = restClient.performRequest(new Request("GET", "/_xpack/license/trial_status"));, +        Response response2 = restClient.performRequest(new Request("POST", "/_xpack/license/start_trial"));, +        Request ackRequest = new Request("POST", "/_xpack/license/start_trial");, +        ackRequest.addParameter("acknowledge", "true");, +        ackRequest.addParameter("type", type);, +        Response response3 = restClient.performRequest(ackRequest);, +        Response response4 = restClient.performRequest(new Request("GET", "/_xpack/license/trial_status"));, +        Request startTrialWhenStartedRequest = new Request("POST", "/_xpack/license/start_trial");, +        startTrialWhenStartedRequest.addParameter("acknowledge", "true");, +        startTrialWhenStartedRequest.addParameter("type", secondAttemptType);, +        ResponseException ex = expectThrows(ResponseException.class, () -> restClient.performRequest(startTrialWhenStartedRequest));, +        Request request = new Request("POST", "/_xpack/license/start_trial");, +        request.addParameter("type", "basic");, +        ResponseException ex = expectThrows(ResponseException.class, () -> getRestClient().performRequest(request));, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/integration/MlRestTestStateCleaner.java, +            adminClient.performRequest(new Request("POST", "/_xpack/ml/datafeeds/_all/_stop"));, +                adminClient.performRequest(new Request("POST", "/_xpack/ml/datafeeds/_all/_stop?force=true"));, +            adminClient.performRequest(new Request("DELETE", "/_xpack/ml/datafeeds/" + datafeedId));, +            adminClient.performRequest(new Request("POST", "/_xpack/ml/anomaly_detectors/_all/_close"));, +                adminClient.performRequest(new Request("POST", "/_xpack/ml/anomaly_detectors/_all/_close?force=true"));, +            adminClient.performRequest(new Request("DELETE", "/_xpack/ml/anomaly_detectors/" + jobId));, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/license/StartBasicLicenseTests.java, +import org.elasticsearch.client.Request;, +        Response response = restClient.performRequest(new Request("GET", "/_xpack/license/basic_status"));, +        Request ackRequest = new Request("POST", "/_xpack/license/start_basic");, +        ackRequest.addParameter("acknowledge", "true");, +        Response response2 = restClient.performRequest(ackRequest);, +        Response response3 = restClient.performRequest(new Request("GET", "/_xpack/license"));, +        Response response4 = restClient.performRequest(new Request("GET", "/_xpack/license/basic_status"));, +                () -> restClient.performRequest(new Request("POST", "/_xpack/license/start_basic")));, +        Response response2 = getRestClient().performRequest(new Request("POST", "/_xpack/license/start_basic"));, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/license/StartTrialLicenseTests.java, +import org.elasticsearch.client.Request;, +        Response response = restClient.performRequest(new Request("GET", "/_xpack/license/trial_status"));, +        Response response2 = restClient.performRequest(new Request("POST", "/_xpack/license/start_trial"));, +        Request ackRequest = new Request("POST", "/_xpack/license/start_trial");, +        ackRequest.addParameter("acknowledge", "true");, +        ackRequest.addParameter("type", type);, +        Response response3 = restClient.performRequest(ackRequest);, +        Response response4 = restClient.performRequest(new Request("GET", "/_xpack/license/trial_status"));, +        Request startTrialWhenStartedRequest = new Request("POST", "/_xpack/license/start_trial");, +        startTrialWhenStartedRequest.addParameter("acknowledge", "true");, +        startTrialWhenStartedRequest.addParameter("type", secondAttemptType);, +        ResponseException ex = expectThrows(ResponseException.class, () -> restClient.performRequest(startTrialWhenStartedRequest));, +        Request request = new Request("POST", "/_xpack/license/start_trial");, +        request.addParameter("type", "basic");, +        ResponseException ex = expectThrows(ResponseException.class, () -> getRestClient().performRequest(request));, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/integration/MlRestTestStateCleaner.java, +            adminClient.performRequest(new Request("POST", "/_xpack/ml/datafeeds/_all/_stop"));, +                adminClient.performRequest(new Request("POST", "/_xpack/ml/datafeeds/_all/_stop?force=true"));, +            adminClient.performRequest(new Request("DELETE", "/_xpack/ml/datafeeds/" + datafeedId));, +            adminClient.performRequest(new Request("POST", "/_xpack/ml/anomaly_detectors/_all/_close"));]