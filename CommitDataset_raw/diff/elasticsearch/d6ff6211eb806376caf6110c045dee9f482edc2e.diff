[+++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/notification/NotificationModule.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/notification/NotificationModule.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/notification/email/HtmlSanitizer.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/notification/NotificationModule.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/notification/email/HtmlSanitizer.java, +++ b/elasticsearch/x-pack/watcher/src/main/java/org/elasticsearch/xpack/watcher/actions/email/EmailActionFactory.java, +    public EmailActionFactory(Settings settings, EmailService emailService, TextTemplateEngine templateEngine,, +        this.htmlSanitizer = new HtmlSanitizer(settings);, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/notification/NotificationModule.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/notification/email/HtmlSanitizer.java, +++ b/elasticsearch/x-pack/watcher/src/main/java/org/elasticsearch/xpack/watcher/actions/email/EmailActionFactory.java, +    public EmailActionFactory(Settings settings, EmailService emailService, TextTemplateEngine templateEngine,, +        this.htmlSanitizer = new HtmlSanitizer(settings);, +++ b/elasticsearch/x-pack/watcher/src/test/java/org/elasticsearch/xpack/watcher/actions/email/EmailActionTests.java, +        ExecutableEmailAction executable = new EmailActionFactory(Settings.EMPTY, emailService, engine,, +        ExecutableEmailAction parsed = new EmailActionFactory(Settings.EMPTY, service, engine, emailAttachmentParser), +            new EmailActionFactory(Settings.EMPTY, emailService, engine, emailAttachmentsParser), +        ExecutableEmailAction executableEmailAction = new EmailActionFactory(Settings.EMPTY, emailService, engine,, +        return new EmailActionFactory(Settings.EMPTY, emailService, engine, emailAttachmentParser);, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/notification/NotificationModule.java, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/notification/email/HtmlSanitizer.java, +++ b/elasticsearch/x-pack/watcher/src/main/java/org/elasticsearch/xpack/watcher/actions/email/EmailActionFactory.java, +    public EmailActionFactory(Settings settings, EmailService emailService, TextTemplateEngine templateEngine,, +        this.htmlSanitizer = new HtmlSanitizer(settings);, +++ b/elasticsearch/x-pack/watcher/src/test/java/org/elasticsearch/xpack/watcher/actions/email/EmailActionTests.java, +        ExecutableEmailAction executable = new EmailActionFactory(Settings.EMPTY, emailService, engine,, +        ExecutableEmailAction parsed = new EmailActionFactory(Settings.EMPTY, service, engine, emailAttachmentParser), +            new EmailActionFactory(Settings.EMPTY, emailService, engine, emailAttachmentsParser), +        ExecutableEmailAction executableEmailAction = new EmailActionFactory(Settings.EMPTY, emailService, engine,, +        return new EmailActionFactory(Settings.EMPTY, emailService, engine, emailAttachmentParser);, +++ b/elasticsearch/x-pack/watcher/src/test/java/org/elasticsearch/xpack/watcher/watch/WatchTests.java, +                    parsers.put(EmailAction.TYPE, new EmailActionFactory(settings, emailService, templateEngine,]