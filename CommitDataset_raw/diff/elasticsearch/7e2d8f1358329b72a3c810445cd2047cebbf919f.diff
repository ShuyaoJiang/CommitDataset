[+++ b/src/test/java/org/elasticsearch/test/integration/search/basic/SearchWhileCreatingIndexTests.java, +import java.util.Arrays;, +, +import org.elasticsearch.action.search.SearchResponse;, +import org.elasticsearch.index.query.QueryBuilders;, +import org.elasticsearch.test.integration.AbstractSharedClusterTest;, +import org.testng.annotations.Test;, +, +, +, +            run(prepareCreate("test").setSettings(settingsBuilder().put("index.number_of_shards", 10)));, +            run(client().prepareIndex("test", "type1").setSource("field", "test"));, +            refresh();, +            assertThat("Found unexpected number of hits ShardFailures:" + Arrays.toString(searchResponse.getShardFailures()), searchResponse.getHits().totalHits(), equalTo(1l));, +            wipeIndex("test");, +++ b/src/test/java/org/elasticsearch/test/integration/search/basic/SearchWhileCreatingIndexTests.java, +import java.util.Arrays;, +, +import org.elasticsearch.action.search.SearchResponse;, +import org.elasticsearch.index.query.QueryBuilders;, +import org.elasticsearch.test.integration.AbstractSharedClusterTest;, +import org.testng.annotations.Test;, +, +, +, +            run(prepareCreate("test").setSettings(settingsBuilder().put("index.number_of_shards", 10)));, +            run(client().prepareIndex("test", "type1").setSource("field", "test"));, +            refresh();, +            assertThat("Found unexpected number of hits ShardFailures:" + Arrays.toString(searchResponse.getShardFailures()), searchResponse.getHits().totalHits(), equalTo(1l));, +            wipeIndex("test");, +++ b/src/test/java/org/elasticsearch/test/integration/search/simple/SimpleSearchTests.java, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.*;, +        refresh();, +        ensureGreen();, +        assertNoFailures(searchResponse);, +        refresh();, +        ensureGreen();, +        assertNoFailures(searchResponse);]