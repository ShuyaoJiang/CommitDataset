[+++ b/core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java, +    /** Returns the maximum distance/radius from the point 'center' before overlapping */, +    public static double maxRadialDistance(GeoPoint center) {, +        return SloppyMath.haversin(center.lat(), center.lon(), center.lat(), (180.0 + center.lon()) % 360)*1000.0;, +    }, +, +    /** Returns the minimum between the provided distance 'initialRadius' and the, +     * maximum distance/radius from the point 'center' before overlapping, +     **/, +    public static double maxRadialDistance(GeoPoint center, double initialRadius) {, +        final double maxRadius = maxRadialDistance(center);, +        return Math.min(initialRadius, maxRadius);, +    }, +, +++ b/core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java, +    /** Returns the maximum distance/radius from the point 'center' before overlapping */, +    public static double maxRadialDistance(GeoPoint center) {, +        return SloppyMath.haversin(center.lat(), center.lon(), center.lat(), (180.0 + center.lon()) % 360)*1000.0;, +    }, +, +    /** Returns the minimum between the provided distance 'initialRadius' and the, +     * maximum distance/radius from the point 'center' before overlapping, +     **/, +    public static double maxRadialDistance(GeoPoint center, double initialRadius) {, +        final double maxRadius = maxRadialDistance(center);, +        return Math.min(initialRadius, maxRadius);, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java, +import org.apache.lucene.search.GeoPointInBBoxQuery;, +        // norelease cut over to .before(Version.2_2_0) once GeoPointFieldV2 is fully merged, +        if (context.indexVersionCreated().after(Version.CURRENT)) {, +            return new GeoPointInBBoxQuery(fieldType.names().fullName(), topLeft.lon(), bottomRight.lat(), bottomRight.lon(), topLeft.lat());, +        }, +, +        Query query;, +                query = IndexedGeoBoundingBoxQuery.create(luceneTopLeft, luceneBottomRight, geoFieldType);, +                query = new InMemoryGeoBoundingBoxQuery(luceneTopLeft, luceneBottomRight, indexFieldData);, +        return query;, +++ b/core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java, +    /** Returns the maximum distance/radius from the point 'center' before overlapping */, +    public static double maxRadialDistance(GeoPoint center) {, +        return SloppyMath.haversin(center.lat(), center.lon(), center.lat(), (180.0 + center.lon()) % 360)*1000.0;, +    }, +, +    /** Returns the minimum between the provided distance 'initialRadius' and the, +     * maximum distance/radius from the point 'center' before overlapping, +     **/, +    public static double maxRadialDistance(GeoPoint center, double initialRadius) {, +        final double maxRadius = maxRadialDistance(center);, +        return Math.min(initialRadius, maxRadius);, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java, +import org.apache.lucene.search.GeoPointInBBoxQuery;, +        // norelease cut over to .before(Version.2_2_0) once GeoPointFieldV2 is fully merged, +        if (context.indexVersionCreated().after(Version.CURRENT)) {, +            return new GeoPointInBBoxQuery(fieldType.names().fullName(), topLeft.lon(), bottomRight.lat(), bottomRight.lon(), topLeft.lat());, +        }, +, +        Query query;, +                query = IndexedGeoBoundingBoxQuery.create(luceneTopLeft, luceneBottomRight, geoFieldType);, +                query = new InMemoryGeoBoundingBoxQuery(luceneTopLeft, luceneBottomRight, indexFieldData);, +        return query;, +++ b/core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java, +import org.apache.lucene.search.GeoPointDistanceQuery;, +        // norelease cut over to .before(Version.2_2_0) once GeoPointFieldV2 is fully merged, +        if (shardContext.indexVersionCreated().onOrBefore(Version.CURRENT)) {, +            GeoPointFieldMapper.GeoPointFieldType geoFieldType = ((GeoPointFieldMapper.GeoPointFieldType) fieldType);, +            return new GeoDistanceRangeQuery(center, null, normDistance, true, false, geoDistance, geoFieldType, indexFieldData, optimizeBbox);, +        }, +, +        normDistance = GeoUtils.maxRadialDistance(center, normDistance);, +        return new GeoPointDistanceQuery(fieldType.names().fullName(), center.lon(), center.lat(), normDistance);, +++ b/core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java, +    /** Returns the maximum distance/radius from the point 'center' before overlapping */, +    public static double maxRadialDistance(GeoPoint center) {, +        return SloppyMath.haversin(center.lat(), center.lon(), center.lat(), (180.0 + center.lon()) % 360)*1000.0;, +    }, +, +    /** Returns the minimum between the provided distance 'initialRadius' and the, +     * maximum distance/radius from the point 'center' before overlapping, +     **/, +    public static double maxRadialDistance(GeoPoint center, double initialRadius) {, +        final double maxRadius = maxRadialDistance(center);, +        return Math.min(initialRadius, maxRadius);, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java, +import org.apache.lucene.search.GeoPointInBBoxQuery;, +        // norelease cut over to .before(Version.2_2_0) once GeoPointFieldV2 is fully merged, +        if (context.indexVersionCreated().after(Version.CURRENT)) {, +            return new GeoPointInBBoxQuery(fieldType.names().fullName(), topLeft.lon(), bottomRight.lat(), bottomRight.lon(), topLeft.lat());, +        }, +, +        Query query;, +                query = IndexedGeoBoundingBoxQuery.create(luceneTopLeft, luceneBottomRight, geoFieldType);, +                query = new InMemoryGeoBoundingBoxQuery(luceneTopLeft, luceneBottomRight, indexFieldData);, +        return query;, +++ b/core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java]