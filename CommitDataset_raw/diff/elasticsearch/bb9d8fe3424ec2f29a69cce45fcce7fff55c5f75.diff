[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +    public ShardIterator onlyNodeActiveShardsIt(String nodeId) {, +        ArrayList<ShardRouting> ordered = new ArrayList<ShardRouting>(shards.size());, +        // fill it in a randomized fashion, +        for (int i = 0; i < shards.size(); i++) {, +            ShardRouting shardRouting = shards.get(i);, +            if (nodeId.equals(shardRouting.currentNodeId())) {, +                ordered.add(shardRouting);, +            }, +        }, +        return new PlainShardIterator(shardId, ordered);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +    public ShardIterator onlyNodeActiveShardsIt(String nodeId) {, +        ArrayList<ShardRouting> ordered = new ArrayList<ShardRouting>(shards.size());, +        // fill it in a randomized fashion, +        for (int i = 0; i < shards.size(); i++) {, +            ShardRouting shardRouting = shards.get(i);, +            if (nodeId.equals(shardRouting.currentNodeId())) {, +                ordered.add(shardRouting);, +            }, +        }, +        return new PlainShardIterator(shardId, ordered);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java, +    private ShardIterator preferenceActiveShardIterator(IndexShardRoutingTable indexShard, String localNodeId, DiscoveryNodes nodes, @Nullable String preference) {, +        if (preference.charAt(0) == '_') {, +                return indexShard.preferNodeActiveShardsIt(localNodeId);, +            if ("_only_local".equals(preference) || "_onlyLocal".equals(preference)) {, +                return indexShard.onlyNodeActiveShardsIt(localNodeId);, +            }, +            if (preference.startsWith("_only_node:")) {, +                return indexShard.onlyNodeActiveShardsIt(preference.substring("_only_node:".length()));, +            }, +        }]