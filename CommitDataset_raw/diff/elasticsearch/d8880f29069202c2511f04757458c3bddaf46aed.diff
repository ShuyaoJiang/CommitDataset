[+++ b/src/main/java/org/elasticsearch/action/search/type/TransportSearchDfsQueryThenFetchAction.java, +import org.elasticsearch.action.search.*;, +                if (successfulOps.get() == 0) {, +                    listener.onFailure(new SearchPhaseExecutionException("query", "all shards failed", buildShardFailures()));, +                } else {, +        }]