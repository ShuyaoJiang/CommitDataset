[+++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +     * Reads an optional {@link QueryBuilder}., +     */, +    public <C extends NamedWriteable<?>> C readOptionalNamedWriteable(Class<C> categoryClass) throws IOException {, +        if (readBoolean()) {, +            return readNamedWriteable(categoryClass);, +        }, +        return null;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +     * Reads an optional {@link QueryBuilder}., +     */, +    public <C extends NamedWriteable<?>> C readOptionalNamedWriteable(Class<C> categoryClass) throws IOException {, +        if (readBoolean()) {, +            return readNamedWriteable(categoryClass);, +        }, +        return null;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java, +        nestedFilter = in.readOptionalNamedWriteable(QueryBuilder.class);, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +     * Reads an optional {@link QueryBuilder}., +     */, +    public <C extends NamedWriteable<?>> C readOptionalNamedWriteable(Class<C> categoryClass) throws IOException {, +        if (readBoolean()) {, +            return readNamedWriteable(categoryClass);, +        }, +        return null;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java, +        nestedFilter = in.readOptionalNamedWriteable(QueryBuilder.class);, +++ b/core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java, +        nestedFilter = in.readOptionalNamedWriteable(QueryBuilder.class);, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +     * Reads an optional {@link QueryBuilder}., +     */, +    public <C extends NamedWriteable<?>> C readOptionalNamedWriteable(Class<C> categoryClass) throws IOException {, +        if (readBoolean()) {, +            return readNamedWriteable(categoryClass);, +        }, +        return null;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java, +        nestedFilter = in.readOptionalNamedWriteable(QueryBuilder.class);, +++ b/core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java, +        nestedFilter = in.readOptionalNamedWriteable(QueryBuilder.class);, +++ b/core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java, +        nestedFilter = in.readOptionalNamedWriteable(QueryBuilder.class);]