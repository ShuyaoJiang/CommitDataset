[+++ b/server/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +            // try to update the mappings and mark the context as needing to try again., +                context.markAsRequiringMappingUpdate();, +++ b/server/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +            // try to update the mappings and mark the context as needing to try again., +                context.markAsRequiringMappingUpdate();, +++ b/server/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java, +        // Verify that the shard "executed" the operation once, +        verify(shard, times(1)).applyIndexOperationOnPrimary(anyLong(), any(), any(), anyLong(), anyLong(), anyLong(), anyBoolean());, +        // Verify that the shard "executed" the operation only once (1 for previous invocations plus, +        verify(shard, times(2)).applyIndexOperationOnPrimary(anyLong(), any(), any(), anyLong(), anyLong(), anyLong(), anyBoolean());]