[+++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public static final String MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID = "max_unsafe_auto_id_timestamp";, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public static final String MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID = "max_unsafe_auto_id_timestamp";, +++ b/server/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public static final String MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID = "max_unsafe_auto_id_timestamp";, +++ b/server/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +        assert userData.containsKey(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID) :, +            "opening index which was created post 5.5.0 but " + Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public static final String MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID = "max_unsafe_auto_id_timestamp";, +++ b/server/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +        assert userData.containsKey(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID) :, +            "opening index which was created post 5.5.0 but " + Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID, +++ b/server/src/main/java/org/elasticsearch/index/shard/LocalShardSnapshot.java, +        return Long.parseLong(shard.getEngine().commitStats().getUserData().get(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID));, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public static final String MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID = "max_unsafe_auto_id_timestamp";, +++ b/server/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +        assert userData.containsKey(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID) :, +            "opening index which was created post 5.5.0 but " + Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID, +++ b/server/src/main/java/org/elasticsearch/index/shard/LocalShardSnapshot.java, +        return Long.parseLong(shard.getEngine().commitStats().getUserData().get(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID));, +++ b/server/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java, +import org.elasticsearch.index.engine.Engine;, +                liveCommitData.put(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID, Long.toString(maxUnsafeAutoIdTimestamp));, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public static final String MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID = "max_unsafe_auto_id_timestamp";, +++ b/server/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +        assert userData.containsKey(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID) :, +            "opening index which was created post 5.5.0 but " + Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID, +++ b/server/src/main/java/org/elasticsearch/index/shard/LocalShardSnapshot.java, +        return Long.parseLong(shard.getEngine().commitStats().getUserData().get(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID));, +++ b/server/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java, +import org.elasticsearch.index.engine.Engine;, +                liveCommitData.put(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID, Long.toString(maxUnsafeAutoIdTimestamp));, +++ b/server/src/main/java/org/elasticsearch/index/store/Store.java, +            map.put(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID, "-1");, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public static final String MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID = "max_unsafe_auto_id_timestamp";, +++ b/server/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +        assert userData.containsKey(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID) :, +            "opening index which was created post 5.5.0 but " + Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID, +++ b/server/src/main/java/org/elasticsearch/index/shard/LocalShardSnapshot.java, +        return Long.parseLong(shard.getEngine().commitStats().getUserData().get(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID));, +++ b/server/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java, +import org.elasticsearch.index.engine.Engine;, +                liveCommitData.put(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID, Long.toString(maxUnsafeAutoIdTimestamp));, +++ b/server/src/main/java/org/elasticsearch/index/store/Store.java, +            map.put(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID, "-1");, +++ b/server/src/test/java/org/elasticsearch/index/shard/StoreRecoveryTests.java, +import org.elasticsearch.index.engine.Engine;, +        assertThat(userData.get(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID), equalTo(Long.toString(maxUnsafeAutoIdTimestamp)));, +        assertThat(userData.get(Engine.MAX_UNSAFE_AUTO_ID_TIMESTAMP_COMMIT_ID), equalTo(Long.toString(maxUnsafeAutoIdTimestamp)));]