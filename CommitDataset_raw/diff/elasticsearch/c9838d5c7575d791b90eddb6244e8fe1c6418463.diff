[+++ b/modules/benchmark/micro/src/main/java/org/elasticsearch/benchmark/search/facet/HistogramFacetSearchBenchmark.java, +        long COUNT = SizeValue.parseSizeValue("5m").singles();, +        COUNT = client.prepareCount().setQuery(matchAllQuery()).execute().actionGet().count();, +        System.out.println("--> Number of docs in index: " + COUNT);, +++ b/modules/benchmark/micro/src/main/java/org/elasticsearch/benchmark/search/facet/HistogramFacetSearchBenchmark.java, +        long COUNT = SizeValue.parseSizeValue("5m").singles();, +        COUNT = client.prepareCount().setQuery(matchAllQuery()).execute().actionGet().count();, +        System.out.println("--> Number of docs in index: " + COUNT);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/CacheRecycler.java, +    // ----- TLongLongHashMap ----, +, +    private static ThreadLocal<SoftReference<Deque<TLongLongHashMap>>> longLongHashMap = new ThreadLocal<SoftReference<Deque<TLongLongHashMap>>>();, +, +, +    public static TLongLongHashMap popLongLongMap() {, +        SoftReference<Deque<TLongLongHashMap>> ref = longLongHashMap.get();, +        Deque<TLongLongHashMap> deque = ref == null ? null : ref.get();, +        if (deque == null) {, +            deque = new ArrayDeque<TLongLongHashMap>();, +            longLongHashMap.set(new SoftReference<Deque<TLongLongHashMap>>(deque));, +        }, +        if (deque.isEmpty()) {, +            return new TLongLongHashMap();, +        }, +        TLongLongHashMap map = deque.pollFirst();, +        map.clear();, +        return map;, +    }, +, +    public static void pushLongLongMap(TLongLongHashMap map) {, +        SoftReference<Deque<TLongLongHashMap>> ref = longLongHashMap.get();, +        Deque<TLongLongHashMap> deque = ref == null ? null : ref.get();, +        if (deque == null) {, +            deque = new ArrayDeque<TLongLongHashMap>();, +            longLongHashMap.set(new SoftReference<Deque<TLongLongHashMap>>(deque));, +        }, +        deque.add(map);, +    }, +, +++ b/modules/benchmark/micro/src/main/java/org/elasticsearch/benchmark/search/facet/HistogramFacetSearchBenchmark.java, +        long COUNT = SizeValue.parseSizeValue("5m").singles();, +        COUNT = client.prepareCount().setQuery(matchAllQuery()).execute().actionGet().count();, +        System.out.println("--> Number of docs in index: " + COUNT);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/CacheRecycler.java, +    // ----- TLongLongHashMap ----, +, +    private static ThreadLocal<SoftReference<Deque<TLongLongHashMap>>> longLongHashMap = new ThreadLocal<SoftReference<Deque<TLongLongHashMap>>>();, +, +, +    public static TLongLongHashMap popLongLongMap() {, +        SoftReference<Deque<TLongLongHashMap>> ref = longLongHashMap.get();, +        Deque<TLongLongHashMap> deque = ref == null ? null : ref.get();, +        if (deque == null) {, +            deque = new ArrayDeque<TLongLongHashMap>();, +            longLongHashMap.set(new SoftReference<Deque<TLongLongHashMap>>(deque));, +        }, +        if (deque.isEmpty()) {, +            return new TLongLongHashMap();, +        }, +        TLongLongHashMap map = deque.pollFirst();, +        map.clear();, +        return map;, +    }, +, +    public static void pushLongLongMap(TLongLongHashMap map) {, +        SoftReference<Deque<TLongLongHashMap>> ref = longLongHashMap.get();, +        Deque<TLongLongHashMap> deque = ref == null ? null : ref.get();, +        if (deque == null) {, +            deque = new ArrayDeque<TLongLongHashMap>();, +            longLongHashMap.set(new SoftReference<Deque<TLongLongHashMap>>(deque));, +        }, +        deque.add(map);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/datehistogram/CountDateHistogramFacetCollector.java, +import org.elasticsearch.common.CacheRecycler;, +        CacheRecycler.pushLongLongMap(histoProc.counts());, +        protected final TLongLongHashMap counts = CacheRecycler.popLongLongMap();, +++ b/modules/benchmark/micro/src/main/java/org/elasticsearch/benchmark/search/facet/HistogramFacetSearchBenchmark.java, +        long COUNT = SizeValue.parseSizeValue("5m").singles();, +        COUNT = client.prepareCount().setQuery(matchAllQuery()).execute().actionGet().count();, +        System.out.println("--> Number of docs in index: " + COUNT);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/CacheRecycler.java, +    // ----- TLongLongHashMap ----, +, +    private static ThreadLocal<SoftReference<Deque<TLongLongHashMap>>> longLongHashMap = new ThreadLocal<SoftReference<Deque<TLongLongHashMap>>>();, +, +, +    public static TLongLongHashMap popLongLongMap() {, +        SoftReference<Deque<TLongLongHashMap>> ref = longLongHashMap.get();, +        Deque<TLongLongHashMap> deque = ref == null ? null : ref.get();, +        if (deque == null) {, +            deque = new ArrayDeque<TLongLongHashMap>();, +            longLongHashMap.set(new SoftReference<Deque<TLongLongHashMap>>(deque));, +        }, +        if (deque.isEmpty()) {, +            return new TLongLongHashMap();, +        }, +        TLongLongHashMap map = deque.pollFirst();, +        map.clear();]