[+++ b/core/src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java, +            updateTasksExecutor.execute(new SourcePrioritizedRunnable(Priority.HIGH, "_add_listener_") {, +            } else if (task instanceof SourcePrioritizedRunnable) {, +                SourcePrioritizedRunnable runnable = (SourcePrioritizedRunnable) task;, +                assert false : "expected SourcePrioritizedRunnable got " + task.getClass();, +    static abstract class SourcePrioritizedRunnable extends PrioritizedRunnable {, +        public SourcePrioritizedRunnable(Priority priority, String source) {, +    }, +, +    class UpdateTask extends SourcePrioritizedRunnable {, +, +        public final ClusterStateUpdateTask updateTask;, +, +        UpdateTask(String source, Priority priority, ClusterStateUpdateTask updateTask) {, +            super(priority, source);, +            this.updateTask = updateTask;, +        }]