[+++ b/src/main/java/org/elasticsearch/index/search/nested/NestedFieldComparatorSource.java, +                copyMissing(wrappedComparator, slot);, +++ b/src/main/java/org/elasticsearch/index/search/nested/NestedFieldComparatorSource.java, +                copyMissing(wrappedComparator, slot);, +++ b/src/test/java/org/elasticsearch/search/geo/GeoDistanceTests.java, +import org.elasticsearch.AbstractSharedClusterTest;, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.*;, +        assertOrderedSearchHits(searchResponse, "1", "3", "4", "5", "6", "2", "7");, +        assertOrderedSearchHits(searchResponse, "7", "2", "6", "5", "4", "3", "1");, +        assertOrderedSearchHits(searchResponse, "1", "2", "3", "4");, +        assertOrderedSearchHits(searchResponse, "1", "3", "2", "4");, +        assertOrderedSearchHits(searchResponse, "4", "2", "3", "1");, +        assertOrderedSearchHits(searchResponse, "4", "3", "2", "1");, +        assertOrderedSearchHits(searchResponse, "1", "3", "2", "4");, +        assertOrderedSearchHits(searchResponse, "4", "2", "3", "1");        , +        assertOrderedSearchHits(searchResponse, "1", "2");, +        assertOrderedSearchHits(searchResponse, "2", "1");        , +        indexRandom("companies", true, , +                .endObject()),, +                .endObject()),, +                .endObject()),, +                .endObject()));, +        assertOrderedSearchHits(searchResponse, "1", "2", "3", "4");, +        assertOrderedSearchHits(searchResponse, "1", "3", "2", "4");, +        assertOrderedSearchHits(searchResponse, "4", "2", "3", "1");, +        assertOrderedSearchHits(searchResponse, "4", "3", "2", "1");, +        assertOrderedSearchHits(searchResponse, "1", "3", "2", "4");, +        assertOrderedSearchHits(searchResponse, "4", "2", "3", "1");, +        assertFirstHit(searchResponse, hasId("4"));, +        assertSearchHits(searchResponse, "1", "2", "3", "4");, +++ b/src/main/java/org/elasticsearch/index/search/nested/NestedFieldComparatorSource.java, +                copyMissing(wrappedComparator, slot);, +++ b/src/test/java/org/elasticsearch/search/geo/GeoDistanceTests.java, +import org.elasticsearch.AbstractSharedClusterTest;, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.*;, +        assertOrderedSearchHits(searchResponse, "1", "3", "4", "5", "6", "2", "7");, +        assertOrderedSearchHits(searchResponse, "7", "2", "6", "5", "4", "3", "1");, +        assertOrderedSearchHits(searchResponse, "1", "2", "3", "4");, +        assertOrderedSearchHits(searchResponse, "1", "3", "2", "4");, +        assertOrderedSearchHits(searchResponse, "4", "2", "3", "1");, +        assertOrderedSearchHits(searchResponse, "4", "3", "2", "1");, +        assertOrderedSearchHits(searchResponse, "1", "3", "2", "4");, +        assertOrderedSearchHits(searchResponse, "4", "2", "3", "1");        , +        assertOrderedSearchHits(searchResponse, "1", "2");, +        assertOrderedSearchHits(searchResponse, "2", "1");        , +        indexRandom("companies", true, , +                .endObject()),, +                .endObject()),, +                .endObject()),, +                .endObject()));, +        assertOrderedSearchHits(searchResponse, "1", "2", "3", "4");, +        assertOrderedSearchHits(searchResponse, "1", "3", "2", "4");, +        assertOrderedSearchHits(searchResponse, "4", "2", "3", "1");, +        assertOrderedSearchHits(searchResponse, "4", "3", "2", "1");, +        assertOrderedSearchHits(searchResponse, "1", "3", "2", "4");, +        assertOrderedSearchHits(searchResponse, "4", "2", "3", "1");, +        assertFirstHit(searchResponse, hasId("4"));, +        assertSearchHits(searchResponse, "1", "2", "3", "4");, +++ b/src/test/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java, +            assertThat("Expected id: " + ids[i] + " at position " + i + " but wasn't." + shardStatus, hit.getId(), equalTo(ids[i]));]