[+++ b/bin/elasticsearch, +        es_parms="$es_parms -Des.pidfile=$pidpath", +    # The es-foreground option will tell ElasticSearch not to close stdout/stderr, but it's up to us not to background., +        es_parms="$es_parms -Des.foreground=yes", +        # no longer need to write the pid, the elasticsearch process will do it, +        # [ ! -z "$pidpath" ] && printf '%d' $! > "$pidpath", +++ b/bin/elasticsearch, +        es_parms="$es_parms -Des.pidfile=$pidpath", +    # The es-foreground option will tell ElasticSearch not to close stdout/stderr, but it's up to us not to background., +        es_parms="$es_parms -Des.foreground=yes", +        # no longer need to write the pid, the elasticsearch process will do it, +        # [ ! -z "$pidpath" ] && printf '%d' $! > "$pidpath", +++ b/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +import java.io.RandomAccessFile;, +        final String pidFile = System.getProperty("es.pidfile", System.getProperty("es-pidfile"));, +        if (pidFile != null) {, +            try {, +                File fPidFile = new File(pidFile);, +                if (fPidFile.getParentFile() != null) {, +                    FileSystemUtils.mkdirs(fPidFile.getParentFile());, +                }, +                RandomAccessFile rafPidFile = new RandomAccessFile(fPidFile, "rw");, +                rafPidFile.writeBytes(Long.toString(JvmInfo.jvmInfo().pid()) + "\n");, +                rafPidFile.close();, +, +                fPidFile.deleteOnExit();, +            } catch (Exception e) {, +                String errorMessage = buildErrorMessage("pid", e);, +                System.err.println(errorMessage);, +                System.err.flush();, +                System.exit(3);, +            }, +        }, +, +        boolean foreground = System.getProperty("es.foreground", System.getProperty("es-foreground")) != null;, +++ b/bin/elasticsearch, +        es_parms="$es_parms -Des.pidfile=$pidpath", +    # The es-foreground option will tell ElasticSearch not to close stdout/stderr, but it's up to us not to background., +        es_parms="$es_parms -Des.foreground=yes", +        # no longer need to write the pid, the elasticsearch process will do it, +        # [ ! -z "$pidpath" ] && printf '%d' $! > "$pidpath", +++ b/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +import java.io.RandomAccessFile;, +        final String pidFile = System.getProperty("es.pidfile", System.getProperty("es-pidfile"));, +        if (pidFile != null) {, +            try {, +                File fPidFile = new File(pidFile);, +                if (fPidFile.getParentFile() != null) {, +                    FileSystemUtils.mkdirs(fPidFile.getParentFile());, +                }, +                RandomAccessFile rafPidFile = new RandomAccessFile(fPidFile, "rw");, +                rafPidFile.writeBytes(Long.toString(JvmInfo.jvmInfo().pid()) + "\n");, +                rafPidFile.close();, +, +                fPidFile.deleteOnExit();, +            } catch (Exception e) {, +                String errorMessage = buildErrorMessage("pid", e);, +                System.err.println(errorMessage);, +                System.err.flush();, +                System.exit(3);, +            }, +        }, +, +        boolean foreground = System.getProperty("es.foreground", System.getProperty("es-foreground")) != null;, +++ b/src/main/java/org/elasticsearch/bootstrap/ElasticSearchF.java, +        System.setProperty("es.foreground", "yes");]