[+++ b/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +import org.apache.lucene.index.FilterCodecReader;, +        } else if (reader instanceof FilterCodecReader) {, +            final FilterCodecReader fReader = (FilterCodecReader) reader;, +            return segmentReader(FilterCodecReader.unwrap(fReader));, +++ b/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +import org.apache.lucene.index.FilterCodecReader;, +        } else if (reader instanceof FilterCodecReader) {, +            final FilterCodecReader fReader = (FilterCodecReader) reader;, +            return segmentReader(FilterCodecReader.unwrap(fReader));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/snapshots/SourceOnlySnapshot.java, +            SegmentInfos segmentInfos = reader.getSegmentInfos().clone();, +            DirectoryReader wrappedReader = wrapReader(reader);, +            for (LeafReaderContext ctx : wrappedReader.leaves()) {, +                SegmentCommitInfo info = Lucene.segmentReader(leafReader).getSegmentInfo();]