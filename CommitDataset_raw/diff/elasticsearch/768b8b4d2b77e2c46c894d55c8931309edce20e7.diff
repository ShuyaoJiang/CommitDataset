[+++ b/src/main/java/org/elasticsearch/common/geo/ShapeRelation.java, +    WITHIN("within");, +++ b/src/main/java/org/elasticsearch/common/geo/ShapeRelation.java, +    WITHIN("within");, +++ b/src/main/java/org/elasticsearch/common/lucene/spatial/SpatialStrategy.java, +            case WITHIN:, +                return createWithinFilter(shape);, +            case WITHIN:, +                return createWithinQuery(shape);, +    public abstract Filter createWithinFilter(Shape shape);, +    public abstract Query createWithinQuery(Shape shape);, +++ b/src/main/java/org/elasticsearch/common/geo/ShapeRelation.java, +    WITHIN("within");, +++ b/src/main/java/org/elasticsearch/common/lucene/spatial/SpatialStrategy.java, +            case WITHIN:, +                return createWithinFilter(shape);, +            case WITHIN:, +                return createWithinQuery(shape);, +    public abstract Filter createWithinFilter(Shape shape);, +    public abstract Query createWithinQuery(Shape shape);, +++ b/src/main/java/org/elasticsearch/common/lucene/spatial/prefix/TermQueryPrefixTreeStrategy.java, +    private static final double WITHIN_BUFFER_DISTANCE = 0.5;, +    public Filter createWithinFilter(Shape shape) {, +        Geometry buffer = BufferOp.bufferOp(shapeGeometry, WITHIN_BUFFER_DISTANCE, BUFFER_PARAMETERS);, +    public Query createWithinQuery(Shape shape) {, +        Geometry buffer = BufferOp.bufferOp(shapeGeometry, WITHIN_BUFFER_DISTANCE, BUFFER_PARAMETERS);, +++ b/src/main/java/org/elasticsearch/common/geo/ShapeRelation.java, +    WITHIN("within");, +++ b/src/main/java/org/elasticsearch/common/lucene/spatial/SpatialStrategy.java, +            case WITHIN:, +                return createWithinFilter(shape);, +            case WITHIN:, +                return createWithinQuery(shape);, +    public abstract Filter createWithinFilter(Shape shape);, +    public abstract Query createWithinQuery(Shape shape);, +++ b/src/main/java/org/elasticsearch/common/lucene/spatial/prefix/TermQueryPrefixTreeStrategy.java, +    private static final double WITHIN_BUFFER_DISTANCE = 0.5;, +    public Filter createWithinFilter(Shape shape) {, +        Geometry buffer = BufferOp.bufferOp(shapeGeometry, WITHIN_BUFFER_DISTANCE, BUFFER_PARAMETERS);, +    public Query createWithinQuery(Shape shape) {, +        Geometry buffer = BufferOp.bufferOp(shapeGeometry, WITHIN_BUFFER_DISTANCE, BUFFER_PARAMETERS);, +++ b/src/test/java/org/elasticsearch/test/unit/common/lucene/spatial/prefix/TermQueryPrefixTreeStrategyTests.java, +    public void testWithinRelation() throws IOException {, +        Filter filter = STRATEGY.createWithinFilter(rectangle);, +        Query query = STRATEGY.createWithinQuery(rectangle);, +        filter = STRATEGY.createWithinFilter(polygon);, +        query = STRATEGY.createWithinQuery(polygon);]