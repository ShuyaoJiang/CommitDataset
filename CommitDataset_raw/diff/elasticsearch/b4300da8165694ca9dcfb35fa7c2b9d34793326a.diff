[+++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +                    if (tryRenewSyncCommit() == false) {, +                        flush(false, true);, +                    }, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +                    if (tryRenewSyncCommit() == false) {, +                        flush(false, true);, +                    }, +++ b/core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java, +                assertEquals(gen2, store.readLastCommittedSegmentsInfo().getLastGeneration());, +                engine.forceMerge(forceMergeFlushes, 1, false, false, false);]