[+++ b/src/main/java/org/elasticsearch/action/percolate/TransportMultiPercolateAction.java, +                                try {, +                                } catch (Throwable t) {, +                                    // Don't let any failure bubble up, otherwise expectedOperationsPerItem will be decremented twice, +                                    listener.onFailure(t);, +                                }, +                            assert expectedOperationsPerItem[slot].get() >= 1 : "Caused by: " + e.getMessage();, +++ b/src/main/java/org/elasticsearch/action/percolate/TransportMultiPercolateAction.java, +                                try {, +                                } catch (Throwable t) {, +                                    // Don't let any failure bubble up, otherwise expectedOperationsPerItem will be decremented twice, +                                    listener.onFailure(t);, +                                }, +                            assert expectedOperationsPerItem[slot].get() >= 1 : "Caused by: " + e.getMessage();, +++ b/src/test/java/org/elasticsearch/test/integration/percolator/RecoveryPercolatorTests.java, +                                assertThat(item.getResponse().getSuccessfulShards(), equalTo(2));, +                            assertThat(response.getSuccessfulShards(), equalTo(2));]