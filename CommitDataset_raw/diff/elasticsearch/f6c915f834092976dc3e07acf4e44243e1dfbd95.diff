[+++ b/src/test/java/org/elasticsearch/rest/action/admin/indices/upgrade/UpgradeTest.java, +import org.elasticsearch.common.xcontent.ToXContent;, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.common.xcontent.json.JsonXContent;, +import org.junit.After;, +        Loggers.getLogger(UpgradeTest.class).setLevel("DEBUG");, +        logger.debug("--> Running upgrade on index " + indexToUpgrade);, +        logSegmentsState(indexToUpgrade);, +        logger.debug("--> Single index upgrade complete");, +        logSegmentsState(indexToUpgrade);, +        logger.debug("--> Running upgrade on the rest of the indexes");, +        logSegmentsState(null);, +        logger.debug("--> Full upgrade complete");, +        logSegmentsState(null);, +    @After, +    void restLogLevel() {, +        Loggers.getLogger(UpgradeTest.class).setLevel("INFO");, +    }, +    , +    void logSegmentsState(String index) throws Exception {, +        // double check using the segments api that all segments are actually upgraded, +        IndicesSegmentResponse segsRsp;, +        if (index == null) {, +            segsRsp = client().admin().indices().prepareSegments().get();, +        } else {, +            segsRsp = client().admin().indices().prepareSegments(index).get();, +        }, +        XContentBuilder builder = JsonXContent.contentBuilder();, +        logger.debug("Segments State: \n\n" + segsRsp.toXContent(builder.prettyPrint(), ToXContent.EMPTY_PARAMS).string());, +    }, +    ]