[+++ b/core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java, +    final AtomicReference<ObservingContext> observingContext = new AtomicReference<>(null);, +                if (timeoutTimeLeftMS <= 0L) {, +    public interface Listener {, +        boolean apply(ClusterState previousState,, +                      ClusterState.ClusterStateStatus previousStatus,, +                      ClusterState newState,, +                      ClusterState.ClusterStateStatus newStatus);, +        boolean apply(ClusterChangedEvent changedEvent);, +            return (previousState != newState || previousStatus != newStatus) && validate(newState);, +            return changedEvent.previousState().version() != changedEvent.state().version() && validate(changedEvent.state());]