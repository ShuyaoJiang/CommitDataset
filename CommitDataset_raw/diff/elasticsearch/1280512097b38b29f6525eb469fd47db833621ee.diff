[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/terms/TermsFacetProcessor.java, +                if (script == null && !"map".equals(executionHint)) {, +                    return new TermsStringOrdinalsFacetCollector(facetName, field, size, comparatorType, allTerms, context, excluded, pattern);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/terms/TermsFacetProcessor.java, +                if (script == null && !"map".equals(executionHint)) {, +                    return new TermsStringOrdinalsFacetCollector(facetName, field, size, comparatorType, allTerms, context, excluded, pattern);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/terms/strings/TermsStringOrdinalsFacetCollector.java, +import java.util.regex.Matcher;, +import java.util.regex.Pattern;, +    private final Matcher matcher;, +, +                                             ImmutableSet<String> excluded, Pattern pattern) {, +        this.matcher = pattern != null ? pattern.matcher("") : null;, +                    if (excluded != null && excluded.contains(value)) {, +                        continue;, +                    }, +                    if (matcher != null && !matcher.reset(value).matches()) {, +                        continue;, +                    }]