[+++ b/qa/vagrant/src/test/resources/packaging/tests/60_tar_certgen.bats, +certgen.bash, +++ b/qa/vagrant/src/test/resources/packaging/tests/60_tar_certgen.bats, +certgen.bash, +++ b/qa/vagrant/src/test/resources/packaging/tests/65_package_certgen.bats, +certgen.bash, +++ b/qa/vagrant/src/test/resources/packaging/tests/60_tar_certgen.bats, +certgen.bash, +++ b/qa/vagrant/src/test/resources/packaging/tests/65_package_certgen.bats, +certgen.bash, +++ b/qa/vagrant/src/test/resources/packaging/tests/certgen.bash, +#!/usr/bin/env bats, +, +# Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one, +# or more contributor license agreements. Licensed under the Elastic License;, +# you may not use this file except in compliance with the Elastic License., +, +load $BATS_UTILS/utils.bash, +load $BATS_UTILS/plugins.bash, +load $BATS_UTILS/xpack.bash, +, +# Description of the nodes instances, +instances="/tmp/instances.yml", +, +# Destination for generated certificates, +certificates="/tmp/certificates.zip", +, +setup() {, +    if [ $BATS_TEST_NUMBER == 1 ]; then, +        clean_before_test, +    fi, +}, +, +DEFAULT_ARCHIVE_USER=elasticsearch, +DEFAULT_ARCHIVE_ESHOME="/tmp/elasticsearch", +DEFAULT_ARCHIVE_UTILS=$BATS_UTILS/tar.bash, +, +DEFAULT_PACKAGE_USER=root, +DEFAULT_PACKAGE_ESHOME="/usr/share/elasticsearch", +DEFAULT_PACKAGE_UTILS=$BATS_UTILS/packages.bash, +, +if [[ "$BATS_TEST_FILENAME" =~ 60_tar_certgen.bats$ ]]; then, +    GROUP='TAR CERTGEN', +, +    MASTER_USER=$DEFAULT_ARCHIVE_USER, +    MASTER_HOME=$DEFAULT_ARCHIVE_ESHOME, +    MASTER_UTILS=$DEFAULT_ARCHIVE_UTILS, +, +    DATA_USER=$DEFAULT_PACKAGE_USER, +    DATA_HOME=$DEFAULT_PACKAGE_ESHOME, +    DATA_UTILS=$DEFAULT_PACKAGE_UTILS, +    , +    install_master_node() {, +	install_node_using_archive, +    }, +    start_master_node() {, +	start_node_using_archive, +    }, +    install_data_node() {, +	install_node_using_package, +    }, +    start_data_node() {, +	start_node_using_package, +    }, +else, +    if is_rpm; then, +        GROUP='RPM CERTGEN', +    elif is_dpkg; then, +        GROUP='DEB CERTGEN', +    fi, +, +    MASTER_USER=$DEFAULT_PACKAGE_USER, +    MASTER_HOME=$DEFAULT_PACKAGE_ESHOME, +    MASTER_UTILS=$DEFAULT_PACKAGE_UTILS, +, +    DATA_USER=$DEFAULT_ARCHIVE_USER, +    DATA_HOME=$DEFAULT_ARCHIVE_ESHOME, +    DATA_UTILS=$DEFAULT_ARCHIVE_UTILS, +    , +    install_master_node() {, +	install_node_using_package, +    }, +    start_master_node() {, +	start_node_using_package, +    }, +    install_data_node() {, +	install_node_using_archive, +    }, +    start_data_node() {, +	start_node_using_archive, +    }, +fi, +, +# Install a node with x-pack using the archive file, +install_node_using_archive() {, +    load $BATS_UTILS/tar.bash, +    export ESHOME="$DEFAULT_ARCHIVE_ESHOME", +    export_elasticsearch_paths, +    , +    install_archive]