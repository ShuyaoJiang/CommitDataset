[+++ b/core/src/main/java/org/elasticsearch/transport/TransportService.java, +import java.util.stream.Stream;, +            // capture listeners before spawning the background callback so the following pattern won't trigger a call, +            // connectToNode(); connection is completed successfully, +            // addConnectionListener(); this listener shouldn't be called, +            final Stream<TransportConnectionListener> listenersToNotify = TransportService.this.connectionListeners.stream();, +            threadPool.generic().execute(() -> listenersToNotify.forEach(listener -> listener.onNodeConnected(node)));, +            // capture listeners before spawning the background callback so the following pattern won't trigger a call, +            // connectToNode(); connection is completed successfully, +            // addConnectionListener(); this listener shouldn't be called, +            final Stream<TransportConnectionListener> listenersToNotify = TransportService.this.connectionListeners.stream();, +            threadPool.generic().execute(() -> listenersToNotify.forEach(listener -> listener.onConnectionOpened(node)));, +++ b/core/src/main/java/org/elasticsearch/transport/TransportService.java, +import java.util.stream.Stream;, +            // capture listeners before spawning the background callback so the following pattern won't trigger a call, +            // connectToNode(); connection is completed successfully, +            // addConnectionListener(); this listener shouldn't be called, +            final Stream<TransportConnectionListener> listenersToNotify = TransportService.this.connectionListeners.stream();, +            threadPool.generic().execute(() -> listenersToNotify.forEach(listener -> listener.onNodeConnected(node)));, +            // capture listeners before spawning the background callback so the following pattern won't trigger a call, +            // connectToNode(); connection is completed successfully, +            // addConnectionListener(); this listener shouldn't be called, +            final Stream<TransportConnectionListener> listenersToNotify = TransportService.this.connectionListeners.stream();, +            threadPool.generic().execute(() -> listenersToNotify.forEach(listener -> listener.onConnectionOpened(node)));, +++ b/core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java]