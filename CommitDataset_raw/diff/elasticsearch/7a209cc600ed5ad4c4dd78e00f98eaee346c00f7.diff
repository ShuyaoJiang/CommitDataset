[+++ b/core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java, +import java.util.Arrays;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.HashSet;, +import java.util.Objects;, +import java.util.Set;, +        IdsQueryBuilder idsQueryBuilder = new IdsQueryBuilder(in.readOptionalStringArray());, +        out.writeOptionalStringArray(types);, +++ b/core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java, +import java.util.Arrays;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.HashSet;, +import java.util.Objects;, +import java.util.Set;, +        IdsQueryBuilder idsQueryBuilder = new IdsQueryBuilder(in.readOptionalStringArray());, +        out.writeOptionalStringArray(types);, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            fieldDataFieldsContext.setHitExecutionNeeded(true);, +++ b/core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java, +import java.util.Arrays;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.HashSet;, +import java.util.Objects;, +import java.util.Set;, +        IdsQueryBuilder idsQueryBuilder = new IdsQueryBuilder(in.readOptionalStringArray());, +        out.writeOptionalStringArray(types);, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            fieldDataFieldsContext.setHitExecutionNeeded(true);, +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhaseContext.java, +    public void setHitExecutionNeeded(boolean hitExecutionNeeded) {, +++ b/core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java, +import java.util.Arrays;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.HashSet;, +import java.util.Objects;, +import java.util.Set;, +        IdsQueryBuilder idsQueryBuilder = new IdsQueryBuilder(in.readOptionalStringArray());, +        out.writeOptionalStringArray(types);, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            fieldDataFieldsContext.setHitExecutionNeeded(true);, +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhaseContext.java, +    public void setHitExecutionNeeded(boolean hitExecutionNeeded) {, +++ b/core/src/test/java/org/elasticsearch/index/query/plugin/DummyQueryParserPlugin.java, +import org.elasticsearch.common.io.stream.StreamInput;, +import org.elasticsearch.common.io.stream.StreamOutput;, +import org.elasticsearch.index.query.AbstractQueryBuilder;, +import org.elasticsearch.index.query.BaseQueryParser;, +import org.elasticsearch.index.query.QueryBuilder;, +import org.elasticsearch.index.query.QueryParseContext;, +import org.elasticsearch.index.query.QueryShardContext;, +, +        @Override, +        protected DummyQueryBuilder doReadFrom(StreamInput in) throws IOException {, +            return new DummyQueryBuilder();, +        }, +, +        @Override, +        protected void doWriteTo(StreamOutput out) throws IOException {, +            // Do Nothing, +        }, +, +        @Override, +        protected int doHashCode() {, +            return 0;, +        }, +, +        @Override, +        protected boolean doEquals(DummyQueryBuilder other) {, +            return true;, +        }]