[+++ b/src/main/java/org/elasticsearch/index/query/CustomScoreQueryBuilder.java, + * A query that uses a script to compute or influence the score of documents that match with the inner query or filter., +    private final FilterBuilder filterBuilder;, +, +     * Constructs a query that defines how the scores are computed or influenced for documents that match with the, +     * specified query by a custom defined script., +     * @param queryBuilder The query that defines what documents are custom scored by this query, +        this.filterBuilder = null;, +    }, +, +    /**, +     * Constructs a query that defines how documents are scored that match with the specified filter., +     *, +     * @param filterBuilder The filter that decides with documents are scored by this query., +     */, +    public CustomScoreQueryBuilder(FilterBuilder filterBuilder) {, +        this.filterBuilder = filterBuilder;, +        this.queryBuilder = null;, +        if (queryBuilder != null) {, +        } else if (filterBuilder != null) {, +            builder.field("filter");, +            filterBuilder.toXContent(builder, params);, +        }, +++ b/src/main/java/org/elasticsearch/index/query/CustomScoreQueryBuilder.java, + * A query that uses a script to compute or influence the score of documents that match with the inner query or filter., +    private final FilterBuilder filterBuilder;, +, +     * Constructs a query that defines how the scores are computed or influenced for documents that match with the, +     * specified query by a custom defined script., +     * @param queryBuilder The query that defines what documents are custom scored by this query, +        this.filterBuilder = null;, +    }, +, +    /**, +     * Constructs a query that defines how documents are scored that match with the specified filter., +     *, +     * @param filterBuilder The filter that decides with documents are scored by this query., +     */, +    public CustomScoreQueryBuilder(FilterBuilder filterBuilder) {, +        this.filterBuilder = filterBuilder;, +        this.queryBuilder = null;, +        if (queryBuilder != null) {, +        } else if (filterBuilder != null) {, +            builder.field("filter");, +            filterBuilder.toXContent(builder, params);, +        }, +++ b/src/main/java/org/elasticsearch/index/query/CustomScoreQueryParser.java, +import org.apache.lucene.search.ConstantScoreQuery;, +import org.apache.lucene.search.Filter;, +        Filter filter = null;, +        boolean queryOrFilterFound = false;, +                    queryOrFilterFound = true;, +                } else if ("filter".equals(currentFieldName)) {, +                    filter = parseContext.parseInnerFilter();, +                    queryOrFilterFound = true;, +        if (!queryOrFilterFound) {, +            throw new QueryParsingException(parseContext.index(), "[custom_score] requires 'query' or 'filter' field");, +        if (query == null && filter == null) {, +        } else if (filter != null) {, +            query = new ConstantScoreQuery(filter);, +++ b/src/main/java/org/elasticsearch/index/query/CustomScoreQueryBuilder.java, + * A query that uses a script to compute or influence the score of documents that match with the inner query or filter., +    private final FilterBuilder filterBuilder;, +, +     * Constructs a query that defines how the scores are computed or influenced for documents that match with the, +     * specified query by a custom defined script., +     * @param queryBuilder The query that defines what documents are custom scored by this query, +        this.filterBuilder = null;, +    }, +, +    /**, +     * Constructs a query that defines how documents are scored that match with the specified filter., +     *, +     * @param filterBuilder The filter that decides with documents are scored by this query., +     */, +    public CustomScoreQueryBuilder(FilterBuilder filterBuilder) {, +        this.filterBuilder = filterBuilder;, +        this.queryBuilder = null;, +        if (queryBuilder != null) {, +        } else if (filterBuilder != null) {, +            builder.field("filter");, +            filterBuilder.toXContent(builder, params);, +        }, +++ b/src/main/java/org/elasticsearch/index/query/CustomScoreQueryParser.java, +import org.apache.lucene.search.ConstantScoreQuery;, +import org.apache.lucene.search.Filter;, +        Filter filter = null;, +        boolean queryOrFilterFound = false;, +                    queryOrFilterFound = true;, +                } else if ("filter".equals(currentFieldName)) {, +                    filter = parseContext.parseInnerFilter();, +                    queryOrFilterFound = true;, +        if (!queryOrFilterFound) {, +            throw new QueryParsingException(parseContext.index(), "[custom_score] requires 'query' or 'filter' field");, +        if (query == null && filter == null) {, +        } else if (filter != null) {, +            query = new ConstantScoreQuery(filter);, +++ b/src/main/java/org/elasticsearch/index/query/QueryBuilders.java, +    /**, +     * A query that allows to define a custom scoring script, that defines the score for each document that match]