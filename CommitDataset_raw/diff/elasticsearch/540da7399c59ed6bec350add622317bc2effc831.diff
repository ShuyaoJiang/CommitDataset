[+++ b/build.gradle, +task wrapper(type: Wrapper), +, +gradle.projectsEvaluated {, +, +  allprojects {, +    tasks.withType(Wrapper) { Wrapper wrapper ->, +      wrapper.distributionType = DistributionType.ALL, +, +      wrapper.doLast {, +  }, +, +}, +      gradleVersion = "4.7" // does not default to gradle weapper of project dir, but current version, +++ b/build.gradle, +task wrapper(type: Wrapper), +, +gradle.projectsEvaluated {, +, +  allprojects {, +    tasks.withType(Wrapper) { Wrapper wrapper ->, +      wrapper.distributionType = DistributionType.ALL, +, +      wrapper.doLast {, +  }, +, +}, +      gradleVersion = "4.7" // does not default to gradle weapper of project dir, but current version, +++ b/buildSrc/build.gradle, +, +, +++ b/build.gradle, +task wrapper(type: Wrapper), +, +gradle.projectsEvaluated {, +, +  allprojects {, +    tasks.withType(Wrapper) { Wrapper wrapper ->, +      wrapper.distributionType = DistributionType.ALL, +, +      wrapper.doLast {, +  }, +, +}, +      gradleVersion = "4.7" // does not default to gradle weapper of project dir, but current version, +++ b/buildSrc/build.gradle, +, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +import nebula.plugin.extraconfigurations.ProvidedBasePlugin, +    static final JavaVersion minimumRuntimeVersion = JavaVersion.VERSION_1_8, +    static final JavaVersion minimumCompilerVersion = JavaVersion.VERSION_1_10, +, +        project.targetCompatibility = minimumRuntimeVersion, +        project.sourceCompatibility = minimumRuntimeVersion, +, +            // Work around Gradle 4.8 issue until we `enableFeaturePreview('STABLE_PUBLISHING')`, +            // https://github.com/gradle/gradle/issues/5696#issuecomment-396965185, +            project.getGradle().getTaskGraph().whenReady {, +                project.tasks.withType(GenerateMavenPom.class) { GenerateMavenPom t ->, +                    // place the pom next to the jar it is for, +                    t.destination = new File(project.buildDir, "distributions/${project.archivesBaseName}-${project.version}.pom"), +                    // build poms with assemble (if the assemble task exists), +                    Task assemble = project.tasks.findByName('assemble'), +                    if (assemble) {, +                        assemble.dependsOn(t), +                    }, +                }, +            }, +++ b/build.gradle, +task wrapper(type: Wrapper), +, +gradle.projectsEvaluated {, +, +  allprojects {, +    tasks.withType(Wrapper) { Wrapper wrapper ->, +      wrapper.distributionType = DistributionType.ALL, +, +      wrapper.doLast {, +  }, +, +}, +      gradleVersion = "4.7" // does not default to gradle weapper of project dir, but current version, +++ b/buildSrc/build.gradle, +, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +import nebula.plugin.extraconfigurations.ProvidedBasePlugin, +    static final JavaVersion minimumRuntimeVersion = JavaVersion.VERSION_1_8, +    static final JavaVersion minimumCompilerVersion = JavaVersion.VERSION_1_10, +, +        project.targetCompatibility = minimumRuntimeVersion, +        project.sourceCompatibility = minimumRuntimeVersion, +, +            // Work around Gradle 4.8 issue until we `enableFeaturePreview('STABLE_PUBLISHING')`, +            // https://github.com/gradle/gradle/issues/5696#issuecomment-396965185, +            project.getGradle().getTaskGraph().whenReady {, +                project.tasks.withType(GenerateMavenPom.class) { GenerateMavenPom t ->, +                    // place the pom next to the jar it is for, +                    t.destination = new File(project.buildDir, "distributions/${project.archivesBaseName}-${project.version}.pom")]