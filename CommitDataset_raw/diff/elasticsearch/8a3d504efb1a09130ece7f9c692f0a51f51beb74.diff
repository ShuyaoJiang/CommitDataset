[+++ b/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java, +import org.elasticsearch.gateway.CorruptStateException;, +    /**, +     * performs the recovery from the local engine to the target, +     */, +                long numDocsTarget = request.metadataSnapshot().getNumDocs();, +                long numDocsSource = recoverySourceMetadata.getNumDocs();, +                if (numDocsTarget != numDocsSource) {, +                    throw new IllegalStateException("try to recover " + request.shardId() + " from primary shard with sync id but number of docs differ: " + numDocsTarget + " (" + request.sourceNode().getName() + ", primary) vs " + numDocsSource + "(" + request.targetNode().getName() + ")");, +                // we shortcut recovery here because we have nothing to copy. but we must still start the engine on the target., +                // so we don't return here, +, +                                    new RecoveryCleanFilesRequest(request.recoveryId(), shard.shardId(), recoverySourceMetadata, translogView.totalOperations()),, +            }]