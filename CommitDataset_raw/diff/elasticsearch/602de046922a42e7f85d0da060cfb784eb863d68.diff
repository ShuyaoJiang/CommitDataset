[+++ b/docs/reference/search/aggregations/bucket.asciidoc, +, +include::bucket/geohashgrid-aggregation.asciidoc[], +++ b/docs/reference/search/aggregations/bucket.asciidoc, +, +include::bucket/geohashgrid-aggregation.asciidoc[], +++ b/docs/reference/search/aggregations/bucket/geohashgrid-aggregation.asciidoc, +[[search-aggregations-bucket-geohashgrid-aggregation]], +=== GeoHash grid, +, +A multi-bucket aggregation that works on `geo_point` fields and groups points into buckets that represent cells in a grid., +The resulting grid can be sparse and only contains cells that have matching data. Each cell is labeled using a http://en.wikipedia.org/wiki/Geohash[geohash] which is of user-definable precision., +, +* High precision geohashes have a long string length and represent cells that cover only a small area., +* Low precision geohashes have a short string length and represent cells that each cover a large area., +, +Geohashes used in this aggregation can have a choice of precision between 1 and 12., + , +WARNING: The highest-precision geohash of length 12 produces cells that cover less than a square metre of land and so high-precision requests can be very costly in terms of RAM and result sizes. , +Please see the example below on how to first filter the aggregation to a smaller geographic area before requesting high-levels of detail., + , +The specified field must be of type `geo_point` (which can only be set explicitly in the mappings) and it can also hold an array of `geo_point` fields, in which case all points will be taken into account during aggregation. , + , +    , +==== Simple low-precision request , +, +[source,js], +--------------------------------------------------, +{, +    "aggregations" : {, +        "myLarge-GrainGeoHashGrid" : {, +            "geohashgrid" : {, +                "field" : "location",, +                "precision" : 3, +            }, +        }, +    }, +}, +--------------------------------------------------, +, +Response:, +, +[source,js], +--------------------------------------------------, +{, +    "aggregations": {, +        "myLarge-GrainGeoHashGrid": {, +            "buckets": [, +                {, +                    "key": "svz",, +                    "doc_count": 10964, +                },, +                {, +                    "key": "sv8",, +                    "doc_count": 3198, +                }, +            ], +        }, +    }, +}, +--------------------------------------------------, +, +, +, +==== High-precision requests, +, +When requesting detailed buckets (typically for displaying a "zoomed in" map) a filter like <<query-dsl-geo-bounding-box-filter,geo_bounding_box>> should be applied to narrow the subject area otherwise potentially millions of buckets will be created and returned. , +, +[source,js], +--------------------------------------------------, +{, +    "aggregations" : {, +        "zoomedInView" : {, +            "filter" : { , +                "geo_bounding_box" : {, +                    "location" : {, +                        "top_left" : "51.73, 0.9",, +                        "bottom_right" : "51.55, 1.1", +                    }, +                }, +            },, +            "aggregations":{, +                "zoom1":{, +                    "geohashgrid" : { , +                        "field":"location",, +                        "precision":8,, +                    }, +                }, +            }, +        }, +    }, + }, +--------------------------------------------------, +, +=== Cell dimensions at the equator, +The table below shows the metric dimensions for cells covered by various string lengths of geohash., +Cell dimensions vary with latitude and so the table is for the worst-case scenario at the equator., +[horizontal], +*GeoHash length*::	*Area width x height*, +1::	5,009.4km x 4,992.6km]