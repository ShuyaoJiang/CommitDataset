[+++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java, +            BytesReference nestedSource = contentBuilder(contentType).map(nestedSourceAsMap).bytes();, +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java, +            BytesReference nestedSource = contentBuilder(contentType).map(nestedSourceAsMap).bytes();, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java, +import static org.elasticsearch.common.xcontent.support.XContentMapValues.extractValue;, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(1));, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(2));, +        assertThat(extractValue("comments.date", searchHits.getAt(1).getSourceAsMap()), equalTo(3));, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(4));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(0).getSourceAsMap()), equalTo("user a"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(1).getSourceAsMap()), equalTo("user b"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(2).getSourceAsMap()), equalTo("user c"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(3).getSourceAsMap()), equalTo("user c"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(4).getSourceAsMap()), equalTo("user d"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(5).getSourceAsMap()), equalTo("user e"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(6).getSourceAsMap()), equalTo("user f"));, +        assertThat(extractValue("comments.message", searchHit.getSourceAsMap()), equalTo("some comment"));, +                assertThat(extractValue("comments.id", searchHits.getAt(j).getSourceAsMap()), equalTo(0));, +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java, +            BytesReference nestedSource = contentBuilder(contentType).map(nestedSourceAsMap).bytes();, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java, +import static org.elasticsearch.common.xcontent.support.XContentMapValues.extractValue;, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(1));, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(2));, +        assertThat(extractValue("comments.date", searchHits.getAt(1).getSourceAsMap()), equalTo(3));, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(4));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(0).getSourceAsMap()), equalTo("user a"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(1).getSourceAsMap()), equalTo("user b"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(2).getSourceAsMap()), equalTo("user c"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(3).getSourceAsMap()), equalTo("user c"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(4).getSourceAsMap()), equalTo("user d"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(5).getSourceAsMap()), equalTo("user e"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(6).getSourceAsMap()), equalTo("user f"));, +        assertThat(extractValue("comments.message", searchHit.getSourceAsMap()), equalTo("some comment"));, +                assertThat(extractValue("comments.id", searchHits.getAt(j).getSourceAsMap()), equalTo(0));, +++ b/core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java, +    public void testNestedSource() throws Exception {, +, +        response = client().prepareSearch(), +                .setQuery(nestedQuery("comments", matchQuery("comments.message", "fox"), ScoreMode.None), +                        .innerHit(new InnerHitBuilder())), +                .get();, +        assertNoFailures(response);, +        assertHitCount(response, 1);, +, +        assertThat(response.getHits().getAt(0).getInnerHits().get("comments").getTotalHits(), equalTo(2L));, +        assertThat(extractValue("comments.message", response.getHits().getAt(0).getInnerHits().get("comments").getAt(0).getSourceAsMap()),, +                equalTo("fox eat quick"));, +        assertThat(extractValue("comments.message", response.getHits().getAt(0).getInnerHits().get("comments").getAt(1).getSourceAsMap()),, +                equalTo("fox ate rabbit x y z"));, +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java, +            BytesReference nestedSource = contentBuilder(contentType).map(nestedSourceAsMap).bytes();, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java, +import static org.elasticsearch.common.xcontent.support.XContentMapValues.extractValue;, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(1));, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(2));, +        assertThat(extractValue("comments.date", searchHits.getAt(1).getSourceAsMap()), equalTo(3));, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(4));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(0).getSourceAsMap()), equalTo("user a"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(1).getSourceAsMap()), equalTo("user b"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(2).getSourceAsMap()), equalTo("user c"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(3).getSourceAsMap()), equalTo("user c"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(4).getSourceAsMap()), equalTo("user d"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(5).getSourceAsMap()), equalTo("user e"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(6).getSourceAsMap()), equalTo("user f"));, +        assertThat(extractValue("comments.message", searchHit.getSourceAsMap()), equalTo("some comment"));, +                assertThat(extractValue("comments.id", searchHits.getAt(j).getSourceAsMap()), equalTo(0));, +++ b/core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java, +    public void testNestedSource() throws Exception {, +, +        response = client().prepareSearch(), +                .setQuery(nestedQuery("comments", matchQuery("comments.message", "fox"), ScoreMode.None), +                        .innerHit(new InnerHitBuilder())), +                .get();, +        assertNoFailures(response);, +        assertHitCount(response, 1);, +, +        assertThat(response.getHits().getAt(0).getInnerHits().get("comments").getTotalHits(), equalTo(2L));, +        assertThat(extractValue("comments.message", response.getHits().getAt(0).getInnerHits().get("comments").getAt(0).getSourceAsMap()),, +                equalTo("fox eat quick"));, +        assertThat(extractValue("comments.message", response.getHits().getAt(0).getInnerHits().get("comments").getAt(1).getSourceAsMap()),, +                equalTo("fox ate rabbit x y z"));, +++ b/docs/reference/migration/migrate_6_0/search.asciidoc, +, +==== Inner hits, +, +The source inside a hit of inner hits keeps its full path with respect to the entire source., +In prior versions the source field names were relative to the inner hit., +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java, +            BytesReference nestedSource = contentBuilder(contentType).map(nestedSourceAsMap).bytes();, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java, +import static org.elasticsearch.common.xcontent.support.XContentMapValues.extractValue;, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(1));, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(2));, +        assertThat(extractValue("comments.date", searchHits.getAt(1).getSourceAsMap()), equalTo(3));, +        assertThat(extractValue("comments.date", searchHits.getAt(0).getSourceAsMap()), equalTo(4));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(0).getSourceAsMap()), equalTo("user a"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(1).getSourceAsMap()), equalTo("user b"));, +        assertThat(extractValue("comments.reviewers.name", topReviewers.getHits().getAt(2).getSourceAsMap()), equalTo("user c"));]