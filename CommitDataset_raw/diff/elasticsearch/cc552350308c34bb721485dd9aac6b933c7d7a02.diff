[+++ b/modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSource.java, +            return multiValueMode.select(values[ordinal].doubleValues(ctx));, +++ b/modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSource.java, +            return multiValueMode.select(values[ordinal].doubleValues(ctx));, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateMethodValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSource.java, +            return multiValueMode.select(values[ordinal].doubleValues(ctx));, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateMethodValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateObjectValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSource.java, +            return multiValueMode.select(values[ordinal].doubleValues(ctx));, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateMethodValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateObjectValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/FieldDataValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSource.java, +            return multiValueMode.select(values[ordinal].doubleValues(ctx));, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateMethodValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateObjectValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/FieldDataValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/FieldData.java, +, +    /**, +     * Return a {@link NumericDocValues} instance that has a value for every, +     * document, returns the same value as {@code values} if there is a value, +     * for the current document and {@code missing} otherwise., +     */, +    public static NumericDocValues replaceMissing(NumericDocValues values, long missing) {, +        return new AbstractNumericDocValues() {, +, +            private long value;, +, +            @Override, +            public int docID() {, +                return values.docID();, +            }, +, +            @Override, +            public boolean advanceExact(int target) throws IOException {, +                if (values.advanceExact(target)) {, +                    value = values.longValue();, +                } else {, +                    value = missing;, +                }, +                return true;, +            }, +, +            @Override, +            public long longValue() throws IOException {, +                return value;, +            }, +        };, +    }, +, +    /**, +     * Return a {@link NumericDoubleValues} instance that has a value for every, +     * document, returns the same value as {@code values} if there is a value, +     * for the current document and {@code missing} otherwise., +     */, +    public static NumericDoubleValues replaceMissing(NumericDoubleValues values, double missing) {, +        return new NumericDoubleValues() {, +, +            private double value;, +, +            @Override, +            public boolean advanceExact(int target) throws IOException {, +                if (values.advanceExact(target)) {, +                    value = values.doubleValue();, +                } else {, +                    value = missing;, +                }, +                return true;, +            }, +, +            @Override, +            public double doubleValue() throws IOException {, +                return value;, +            }, +        };, +    }, +++ b/modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSource.java, +            return multiValueMode.select(values[ordinal].doubleValues(ctx));, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateMethodValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateObjectValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/modules/lang-expression/src/main/java/org/elasticsearch/script/expression/FieldDataValueSource.java, +        NumericDoubleValues docValues = multiValueMode.select(leafData.getDoubleValues());, +++ b/server/src/main/java/org/elasticsearch/index/fielddata/FieldData.java, +, +    /**, +     * Return a {@link NumericDocValues} instance that has a value for every]