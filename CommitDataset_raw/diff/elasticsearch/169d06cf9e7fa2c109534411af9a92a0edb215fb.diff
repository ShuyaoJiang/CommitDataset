[+++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                        operation = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA);, +                                Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                        operation = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA);, +                                Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import java.nio.charset.StandardCharsets;, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                        operation = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA);, +                                Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import java.nio.charset.StandardCharsets;, +++ b/core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java, +            operation = indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +            operation = indexShard.prepareCreate(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                        operation = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA);, +                                Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import java.nio.charset.StandardCharsets;, +++ b/core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java, +            operation = indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +            operation = indexShard.prepareCreate(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                        operation = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA);, +                                Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import java.nio.charset.StandardCharsets;, +++ b/core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java, +            operation = indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +            operation = indexShard.prepareCreate(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +import org.elasticsearch.cluster.routing.IndexRoutingTable;, +import org.elasticsearch.cluster.routing.IndexShardRoutingTable;, +import org.elasticsearch.cluster.routing.ShardIterator;, +import org.elasticsearch.cluster.routing.ShardRouting;, +            return indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.PRIMARY);, +                    request.version(), request.versionType(), Engine.Operation.Origin.PRIMARY);, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                        operation = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA);, +                                Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import java.nio.charset.StandardCharsets;, +++ b/core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java, +            operation = indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +            operation = indexShard.prepareCreate(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +import org.elasticsearch.cluster.routing.IndexRoutingTable;, +import org.elasticsearch.cluster.routing.IndexShardRoutingTable;, +import org.elasticsearch.cluster.routing.ShardIterator;, +import org.elasticsearch.cluster.routing.ShardRouting;, +            return indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.PRIMARY);, +                    request.version(), request.versionType(), Engine.Operation.Origin.PRIMARY);, +++ b/core/src/main/java/org/elasticsearch/index/IndexService.java, +import org.elasticsearch.cluster.node.DiscoveryNode;, +            settingsService.addListener(indexShard);, +                    settingsService.removeListener(indexShard);, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                        operation = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA);, +                                Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import java.nio.charset.StandardCharsets;, +++ b/core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java, +            operation = indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +            operation = indexShard.prepareCreate(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +import org.elasticsearch.cluster.routing.IndexRoutingTable;, +import org.elasticsearch.cluster.routing.IndexShardRoutingTable;, +import org.elasticsearch.cluster.routing.ShardIterator;, +import org.elasticsearch.cluster.routing.ShardRouting;, +            return indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.PRIMARY);, +                    request.version(), request.versionType(), Engine.Operation.Origin.PRIMARY);, +++ b/core/src/main/java/org/elasticsearch/index/IndexService.java, +import org.elasticsearch.cluster.node.DiscoveryNode;, +            settingsService.addListener(indexShard);, +                    settingsService.removeListener(indexShard);, +++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +import java.util.*;, +        public IndexingOperation(Term uid, ParsedDocument doc, long version, VersionType versionType, Origin origin, long startTime) {, +            this(uid, doc, Versions.MATCH_ANY, VersionType.INTERNAL, Origin.PRIMARY, System.nanoTime());, +            super(uid, doc, version, versionType, origin, startTime);, +            super(uid, doc, version, versionType, origin, startTime);, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                        operation = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA);, +                                Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import java.nio.charset.StandardCharsets;, +++ b/core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java, +            operation = indexShard.prepareIndex(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +            operation = indexShard.prepareCreate(sourceToParse, request.version(), request.versionType(), Engine.Operation.Origin.REPLICA);, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +import org.elasticsearch.cluster.routing.IndexRoutingTable;, +import org.elasticsearch.cluster.routing.IndexShardRoutingTable;, +import org.elasticsearch.cluster.routing.ShardIterator;]