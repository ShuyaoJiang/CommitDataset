[+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/filestructurefinder/XmlFileStructureFinder.java, +import javax.xml.XMLConstants;, +        DocumentBuilderFactory docBuilderFactory = makeDocBuilderFactory();, +    private static DocumentBuilderFactory makeDocBuilderFactory() throws ParserConfigurationException {, +, +        DocumentBuilderFactory docBuilderFactory = DocumentBuilderFactory.newInstance();, +        docBuilderFactory.setNamespaceAware(false);, +        docBuilderFactory.setValidating(false);, +        docBuilderFactory.setXIncludeAware(false);, +        docBuilderFactory.setExpandEntityReferences(false);, +        docBuilderFactory.setIgnoringComments(true);, +        docBuilderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);, +        docBuilderFactory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);, +        // The next 5 should be irrelevant given the previous 1, but it doesn't hurt to set them just in case, +        docBuilderFactory.setFeature("http://xml.org/sax/features/external-parameter-entities", false);, +        docBuilderFactory.setFeature("http://xml.org/sax/features/external-general-entities", false);, +        docBuilderFactory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);, +        docBuilderFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");, +        docBuilderFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");, +        return docBuilderFactory;, +    }, +, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/filestructurefinder/XmlFileStructureFinder.java, +import javax.xml.XMLConstants;, +        DocumentBuilderFactory docBuilderFactory = makeDocBuilderFactory();, +    private static DocumentBuilderFactory makeDocBuilderFactory() throws ParserConfigurationException {, +, +        DocumentBuilderFactory docBuilderFactory = DocumentBuilderFactory.newInstance();, +        docBuilderFactory.setNamespaceAware(false);, +        docBuilderFactory.setValidating(false);, +        docBuilderFactory.setXIncludeAware(false);, +        docBuilderFactory.setExpandEntityReferences(false);, +        docBuilderFactory.setIgnoringComments(true);, +        docBuilderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);, +        docBuilderFactory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);, +        // The next 5 should be irrelevant given the previous 1, but it doesn't hurt to set them just in case, +        docBuilderFactory.setFeature("http://xml.org/sax/features/external-parameter-entities", false);, +        docBuilderFactory.setFeature("http://xml.org/sax/features/external-general-entities", false);, +        docBuilderFactory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);, +        docBuilderFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");, +        docBuilderFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");, +        return docBuilderFactory;, +    }, +, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/filestructurefinder/XmlFileStructureFinderFactory.java, +        xmlFactory.setProperty(XMLInputFactory.SUPPORT_DTD, Boolean.FALSE);, +        xmlFactory.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, Boolean.FALSE);, +        xmlFactory.setProperty(XMLInputFactory.IS_REPLACING_ENTITY_REFERENCES, Boolean.FALSE);]