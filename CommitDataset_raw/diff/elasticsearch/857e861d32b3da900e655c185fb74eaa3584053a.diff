[+++ b/plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreServiceIntegTests.java, +import org.elasticsearch.snapshots.SnapshotInfo;, +import org.elasticsearch.snapshots.SnapshotShardFailure;, +import static org.hamcrest.Matchers.is;, +        CreateSnapshotResponse createSnapshotResponse = client.admin().cluster(), +                .prepareCreateSnapshot("test-repo", "test-snap"), +                .setWaitForCompletion(true), +                .setIndices("test-idx-*", "-test-idx-3"), +                .get();, +        final SnapshotInfo snapshotInfo = createSnapshotResponse.getSnapshotInfo();, +        if (snapshotInfo.shardFailures() != null) {, +            for (SnapshotShardFailure shardFailure : snapshotInfo.shardFailures()) {, +                logger.warn("shard failure during snapshot: {}", shardFailure::toString);, +            }, +        }, +        assertThat(snapshotInfo.state(), is(SnapshotState.SUCCESS));, +        assertEquals(snapshotInfo.failedShards(), 0);]