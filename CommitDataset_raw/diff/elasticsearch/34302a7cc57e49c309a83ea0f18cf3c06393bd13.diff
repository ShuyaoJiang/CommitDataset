[+++ b/src/test/java/org/elasticsearch/common/xcontent/cbor/JsonVsCborTests.java, +import com.fasterxml.jackson.core.JsonFactory;, +import com.fasterxml.jackson.core.JsonGenerator;, +import com.fasterxml.jackson.core.JsonParser;, +import com.fasterxml.jackson.dataformat.cbor.CBORFactory;, +import java.io.ByteArrayOutputStream;, +    public void testBugInJacksonCBOR() throws Exception {, +        JsonFactory factory = new CBORFactory();, +        ByteArrayOutputStream out = new ByteArrayOutputStream();, +        JsonGenerator generator = factory.createGenerator(out);, +        generator.writeStartObject();, +        generator.writeFieldName("field");, +        generator.writeNumber(-1000000000001L);, +        generator.writeEndObject();, +        generator.close();, +, +        JsonParser parser = factory.createParser(out.toByteArray());, +        parser.nextToken();, +        parser.nextToken();, +        parser.nextToken();, +        // this is the bug, if it gets fixed when upgrading to a new Jackson version, +        // we should re-enable using CBOR in our randomized testing (ElasticsearchTestCase#randomXContentType), +        assertThat(parser.getLongValue(), equalTo(0L));, +    }, +, +    @Test, +++ b/src/test/java/org/elasticsearch/common/xcontent/cbor/JsonVsCborTests.java, +import com.fasterxml.jackson.core.JsonFactory;, +import com.fasterxml.jackson.core.JsonGenerator;, +import com.fasterxml.jackson.core.JsonParser;, +import com.fasterxml.jackson.dataformat.cbor.CBORFactory;, +import java.io.ByteArrayOutputStream;, +    public void testBugInJacksonCBOR() throws Exception {, +        JsonFactory factory = new CBORFactory();, +        ByteArrayOutputStream out = new ByteArrayOutputStream();, +        JsonGenerator generator = factory.createGenerator(out);, +        generator.writeStartObject();, +        generator.writeFieldName("field");, +        generator.writeNumber(-1000000000001L);, +        generator.writeEndObject();, +        generator.close();, +, +        JsonParser parser = factory.createParser(out.toByteArray());, +        parser.nextToken();, +        parser.nextToken();, +        parser.nextToken();, +        // this is the bug, if it gets fixed when upgrading to a new Jackson version, +        // we should re-enable using CBOR in our randomized testing (ElasticsearchTestCase#randomXContentType), +        assertThat(parser.getLongValue(), equalTo(0L));, +    }, +, +    @Test, +++ b/src/test/java/org/elasticsearch/test/ElasticsearchTestCase.java, +        Requests.CONTENT_TYPE = randomXContentType();, +        Requests.INDEX_CONTENT_TYPE = randomXContentType();, +    }, +, +    private static XContentType randomXContentType() {, +        XContentType type = randomFrom(XContentType.values());, +        // for now, CBOR is disabled, see JsonVsCborTests#testBugInJacksonCBOR, +        if (type == XContentType.CBOR) {, +            return XContentType.JSON;, +        }, +        return type;]