[+++ b/core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java, +        } else {, +            internalShardId = null;, +        if (internalShardId != null) {, +            out.writeBoolean(true);, +            internalShardId.writeTo(out);, +        } else {, +            out.writeBoolean(false);, +        }]