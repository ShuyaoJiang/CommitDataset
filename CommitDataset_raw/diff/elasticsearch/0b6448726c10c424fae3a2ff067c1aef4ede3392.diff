[+++ b/core/src/main/java/org/elasticsearch/bootstrap/ElasticsearchUncaughtExceptionHandler.java, +        AccessController.doPrivileged(new PrivilegedHaltAction(status));, +    }, +, +    static class PrivilegedHaltAction implements PrivilegedAction<Void> {, +, +        private final int status;, +, +        private PrivilegedHaltAction(final int status) {, +            this.status = status;, +        }, +, +, +++ b/core/src/main/java/org/elasticsearch/bootstrap/ElasticsearchUncaughtExceptionHandler.java, +        AccessController.doPrivileged(new PrivilegedHaltAction(status));, +    }, +, +    static class PrivilegedHaltAction implements PrivilegedAction<Void> {, +, +        private final int status;, +, +        private PrivilegedHaltAction(final int status) {, +            this.status = status;, +        }, +, +, +++ b/core/src/main/java/org/elasticsearch/bootstrap/Security.java, +        final String[] classesThatCanExit =, +                new String[]{, +                        // SecureSM matches class names as regular expressions so we escape the $ that arises from the nested class name, +                        ElasticsearchUncaughtExceptionHandler.PrivilegedHaltAction.class.getName().replace("$", "\\$"),, +                        Command.class.getName()};]