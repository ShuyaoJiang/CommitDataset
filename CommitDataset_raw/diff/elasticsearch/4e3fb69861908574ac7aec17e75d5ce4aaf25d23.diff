[+++ b/plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java, +import java.util.HashSet;, +    public void testHtmlDocumentWithRandomFields() throws Exception {, +        //date is not present in the html doc, +        ArrayList<AttachmentProcessor.Field> fieldsList = new ArrayList<>(EnumSet.complementOf(EnumSet.of, +            (AttachmentProcessor.Field.DATE)));, +        Set<AttachmentProcessor.Field> selectedFields = new HashSet<>();, +, +        int numFields = randomIntBetween(1, fieldsList.size());, +        String[] selectedFieldNames = new String[numFields];, +            AttachmentProcessor.Field field;, +            do {, +                field = randomFrom(fieldsList);, +            } while (selectedFields.add(field) == false);, +, +            selectedFieldNames[i] = field.toLowerCase();, +        if (randomBoolean()) {, +            selectedFields.add(AttachmentProcessor.Field.DATE);, +        }, +            "target_field", selectedFields, 10000);, +        Map<String, Object> attachmentData = parseDocument("htmlWithEmptyDateMeta.html", processor);, +        assertThat(attachmentData.keySet(), hasSize(selectedFieldNames.length));, +        assertThat(attachmentData.keySet(), containsInAnyOrder(selectedFieldNames));]