[+++ b/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/cors/Netty4CorsHandler.java, +import io.netty.handler.codec.http.FullHttpRequest;, +    private FullHttpRequest request;, +        assert msg instanceof FullHttpRequest : "Invalid message type: " + msg.getClass();, +        if (config.isCorsSupportEnabled()) {, +            request = (FullHttpRequest) msg;, +                try {, +                } finally {, +                    releaseRequest();, +                }, +                try {, +                } finally {, +                    releaseRequest();, +                }, +    private void releaseRequest() {, +        request.release();, +        request = null;, +    }, +, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/cors/Netty4CorsHandler.java, +import io.netty.handler.codec.http.FullHttpRequest;, +    private FullHttpRequest request;, +        assert msg instanceof FullHttpRequest : "Invalid message type: " + msg.getClass();, +        if (config.isCorsSupportEnabled()) {, +            request = (FullHttpRequest) msg;, +                try {, +                } finally {, +                    releaseRequest();, +                }, +                try {, +                } finally {, +                    releaseRequest();, +                }, +    private void releaseRequest() {, +        request.release();, +        request = null;, +    }, +, +++ b/plugins/transport-nio/src/main/java/org/elasticsearch/http/nio/cors/NioCorsHandler.java, +import io.netty.handler.codec.http.FullHttpRequest;, +    private FullHttpRequest request;, +        assert msg instanceof FullHttpRequest : "Invalid message type: " + msg.getClass();, +        if (config.isCorsSupportEnabled()) {, +            request = (FullHttpRequest) msg;, +                try {, +                } finally {, +                    releaseRequest();, +                }, +                try {, +                } finally {, +                    releaseRequest();, +                }, +    private void releaseRequest() {, +        request.release();, +        request = null;, +    }, +]