[+++ b/src/main/java/org/elasticsearch/action/deletebyquery/TransportShardDeleteByQueryAction.java, +        Engine.DeleteByQuery deleteByQuery = indexShard.prepareDeleteByQuery(request.querySource(), request.filteringAliases(), request.types()), +                .origin(Engine.Operation.Origin.PRIMARY);, +        Engine.DeleteByQuery deleteByQuery = indexShard.prepareDeleteByQuery(request.querySource(), request.filteringAliases(), request.types()), +                .origin(Engine.Operation.Origin.REPLICA);, +++ b/src/main/java/org/elasticsearch/action/deletebyquery/TransportShardDeleteByQueryAction.java, +        Engine.DeleteByQuery deleteByQuery = indexShard.prepareDeleteByQuery(request.querySource(), request.filteringAliases(), request.types()), +                .origin(Engine.Operation.Origin.PRIMARY);, +        Engine.DeleteByQuery deleteByQuery = indexShard.prepareDeleteByQuery(request.querySource(), request.filteringAliases(), request.types()), +                .origin(Engine.Operation.Origin.REPLICA);, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +        private Operation.Origin origin = Operation.Origin.PRIMARY;, +        public DeleteByQuery origin(Operation.Origin origin) {, +            this.origin = origin;, +            return this;, +        }, +, +        public Operation.Origin origin() {, +            return this.origin;, +        }, +, +++ b/src/main/java/org/elasticsearch/action/deletebyquery/TransportShardDeleteByQueryAction.java, +        Engine.DeleteByQuery deleteByQuery = indexShard.prepareDeleteByQuery(request.querySource(), request.filteringAliases(), request.types()), +                .origin(Engine.Operation.Origin.PRIMARY);, +        Engine.DeleteByQuery deleteByQuery = indexShard.prepareDeleteByQuery(request.querySource(), request.filteringAliases(), request.types()), +                .origin(Engine.Operation.Origin.REPLICA);, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +        private Operation.Origin origin = Operation.Origin.PRIMARY;, +        public DeleteByQuery origin(Operation.Origin origin) {, +            this.origin = origin;, +            return this;, +        }, +, +        public Operation.Origin origin() {, +            return this.origin;, +        }, +, +++ b/src/main/java/org/elasticsearch/index/shard/service/InternalIndexShard.java, +                    engine.delete(prepareDeleteByQuery(deleteByQuery.source(), deleteByQuery.filteringAliases(), deleteByQuery.types()), +                            .origin(Engine.Operation.Origin.RECOVERY));]