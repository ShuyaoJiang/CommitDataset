[+++ b/src/main/java/org/elasticsearch/action/percolate/PercolateRequest.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationThreading;, +        // we want to do the percolate in parallel on all the local shards, +        operationThreading(BroadcastOperationThreading.THREAD_PER_SHARD);, +        operationThreading(request.operationThreading());, +++ b/src/main/java/org/elasticsearch/action/percolate/PercolateRequest.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationThreading;, +        // we want to do the percolate in parallel on all the local shards, +        operationThreading(BroadcastOperationThreading.THREAD_PER_SHARD);, +        operationThreading(request.operationThreading());, +++ b/src/main/java/org/elasticsearch/rest/action/percolate/RestPercolateAction.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationThreading;, +, +        if (restRequest.hasParam("operation_threading")) {, +            BroadcastOperationThreading operationThreading = BroadcastOperationThreading.fromString(restRequest.param("operation_threading"), null);, +            if (operationThreading == BroadcastOperationThreading.NO_THREADS) {, +                // don't do work on the network thread, +                operationThreading = BroadcastOperationThreading.SINGLE_THREAD;, +            }, +            percolateRequest.operationThreading(operationThreading);, +        }, +, +++ b/src/main/java/org/elasticsearch/action/percolate/PercolateRequest.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationThreading;, +        // we want to do the percolate in parallel on all the local shards, +        operationThreading(BroadcastOperationThreading.THREAD_PER_SHARD);, +        operationThreading(request.operationThreading());, +++ b/src/main/java/org/elasticsearch/rest/action/percolate/RestPercolateAction.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationThreading;, +, +        if (restRequest.hasParam("operation_threading")) {, +            BroadcastOperationThreading operationThreading = BroadcastOperationThreading.fromString(restRequest.param("operation_threading"), null);, +            if (operationThreading == BroadcastOperationThreading.NO_THREADS) {, +                // don't do work on the network thread, +                operationThreading = BroadcastOperationThreading.SINGLE_THREAD;, +            }, +            percolateRequest.operationThreading(operationThreading);, +        }, +, +++ b/src/test/java/org/elasticsearch/benchmark/percolator/PercolatorStressBenchmark.java, +        Node[] nodes = new Node[1];]