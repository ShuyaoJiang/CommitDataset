[+++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +                                      Set<IndexTemplateFilter> indexTemplateFilters, Environment env, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                    indicesService.createIndex(nodeServicesProvider, tmpImd, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +                                      Set<IndexTemplateFilter> indexTemplateFilters, Environment env, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                    indicesService.createIndex(nodeServicesProvider, tmpImd, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +    public MetaDataIndexAliasesService(Settings settings, ClusterService clusterService, IndicesService indicesService, AliasValidator aliasValidator, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                                            indexService = indicesService.createIndex(nodeServicesProvider, indexMetaData, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +                                      Set<IndexTemplateFilter> indexTemplateFilters, Environment env, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                    indicesService.createIndex(nodeServicesProvider, tmpImd, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +    public MetaDataIndexAliasesService(Settings settings, ClusterService clusterService, IndicesService indicesService, AliasValidator aliasValidator, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                                            indexService = indicesService.createIndex(nodeServicesProvider, indexMetaData, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +                                    "index.shard.inactive_time",, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +                                      Set<IndexTemplateFilter> indexTemplateFilters, Environment env, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                    indicesService.createIndex(nodeServicesProvider, tmpImd, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +    public MetaDataIndexAliasesService(Settings settings, ClusterService clusterService, IndicesService indicesService, AliasValidator aliasValidator, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                                            indexService = indicesService.createIndex(nodeServicesProvider, indexMetaData, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +                                    "index.shard.inactive_time",, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +    public MetaDataMappingService(Settings settings, ClusterService clusterService, IndicesService indicesService, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                indexService = indicesService.createIndex(nodeServicesProvider, indexMetaData, Collections.EMPTY_LIST);, +                        IndexService indexService = indicesService.createIndex(nodeServicesProvider, indexMetaData, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +                                      Set<IndexTemplateFilter> indexTemplateFilters, Environment env, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                    indicesService.createIndex(nodeServicesProvider, tmpImd, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +    public MetaDataIndexAliasesService(Settings settings, ClusterService clusterService, IndicesService indicesService, AliasValidator aliasValidator, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                                            indexService = indicesService.createIndex(nodeServicesProvider, indexMetaData, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +                                    "index.shard.inactive_time",, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +    public MetaDataMappingService(Settings settings, ClusterService clusterService, IndicesService indicesService, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                indexService = indicesService.createIndex(nodeServicesProvider, indexMetaData, Collections.EMPTY_LIST);, +                        IndexService indexService = indicesService.createIndex(nodeServicesProvider, indexMetaData, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/common/unit/TimeValue.java, +        assert settingName.startsWith("index.") == false || MetaDataIndexUpgradeService.INDEX_TIME_SETTINGS.contains(settingName) : settingName;, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +                                      Set<IndexTemplateFilter> indexTemplateFilters, Environment env, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                    indicesService.createIndex(nodeServicesProvider, tmpImd, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java, +import org.elasticsearch.index.NodeServicesProvider;, +    private final NodeServicesProvider nodeServicesProvider;, +, +    public MetaDataIndexAliasesService(Settings settings, ClusterService clusterService, IndicesService indicesService, AliasValidator aliasValidator, NodeServicesProvider nodeServicesProvider) {, +        this.nodeServicesProvider = nodeServicesProvider;, +                                            indexService = indicesService.createIndex(nodeServicesProvider, indexMetaData, Collections.EMPTY_LIST);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java]