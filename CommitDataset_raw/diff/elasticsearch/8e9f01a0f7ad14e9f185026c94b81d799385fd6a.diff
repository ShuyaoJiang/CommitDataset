[+++ b/plugins/river/couchdb/src/main/java/org/elasticsearch/river/couchdb/CouchdbRiver.java, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import java.util.List;, +    private Object processLine(String s, BulkRequestBuilder bulk) {, +        Object seq = ctx.get("seq");, +                Object lastSeq = null;, +                Object lineSeq = processLine(s, bulk);, +                Object lastSeq = null;, +                            lastSeq = couchdbState.get("last_seq");, +                    String lastSeqAsString = null;, +                    if (lastSeq instanceof List) {, +                        // bigcouch uses array for the seq, +                            XContentBuilder builder = XContentFactory.jsonBuilder();, +                            builder.startObject();, +                            for (Object value : ((List) lastSeq)) {, +                                builder.value(value);, +                            }, +                            builder.endObject();, +                            lastSeqAsString = builder.string();, +                        } catch (Exception e) {, +                            logger.error("failed to convert last_seq to a json string", e);, +                        }, +                    } else {, +                        lastSeqAsString = lastSeq.toString();, +                    }, +                    try {, +                        file = file + "&since=" + URLEncoder.encode(lastSeqAsString, "UTF-8");, +                        file = file + "&since=" + lastSeqAsString;]