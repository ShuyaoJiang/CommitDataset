[+++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/settings/SettingsUpdater.java, +import org.elasticsearch.common.regex.Regex;, +import java.util.HashSet;, +import java.util.Map;, +import java.util.Set;, +, +        changed |= apply(transientToApply, transientSettings, transientUpdates, "transient");, +        changed |= apply(persistentToApply, persistentSettings, persistentUpdates, "persistent");, +    private boolean apply(Settings toApply, Settings.Builder target, Settings.Builder updates, String type) {, +        boolean changed = false;, +        final Set<String> toRemove = new HashSet<>();, +        Settings.Builder settingsBuilder = Settings.settingsBuilder();, +        for (Map.Entry<String, String> entry : toApply.getAsMap().entrySet()) {, +            if (entry.getValue() == null) {, +                toRemove.add(entry.getKey());, +            } else if (clusterSettings.isLoggerSetting(entry.getKey()) || clusterSettings.hasDynamicSetting(entry.getKey())) {, +                settingsBuilder.put(entry.getKey(), entry.getValue());, +                updates.put(entry.getKey(), entry.getValue());, +                changed = true;, +            } else {, +                throw new IllegalArgumentException(type + " setting [" + entry.getKey() + "], not dynamically updateable");, +            }, +        changed |= applyDeletes(toRemove, target);, +        target.put(settingsBuilder.build());, +        return changed;, +    }, +, +    private final boolean applyDeletes(Set<String> deletes, Settings.Builder builder) {, +        boolean changed = false;, +        for (String entry : deletes) {, +            Set<String> keysToRemove = new HashSet<>();, +            Set<String> keySet = builder.internalMap().keySet();, +            for (String key : keySet) {, +                if (Regex.simpleMatch(entry, key)) {, +                    keysToRemove.add(key);, +                }, +            }, +            for (String key : keysToRemove) {, +                builder.remove(key);, +                changed = true;, +            }, +        }, +        return changed;, +    }, +}, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/settings/SettingsUpdater.java, +import org.elasticsearch.common.regex.Regex;, +import java.util.HashSet;, +import java.util.Map;, +import java.util.Set;, +, +        changed |= apply(transientToApply, transientSettings, transientUpdates, "transient");, +        changed |= apply(persistentToApply, persistentSettings, persistentUpdates, "persistent");, +    private boolean apply(Settings toApply, Settings.Builder target, Settings.Builder updates, String type) {, +        boolean changed = false;, +        final Set<String> toRemove = new HashSet<>();, +        Settings.Builder settingsBuilder = Settings.settingsBuilder();, +        for (Map.Entry<String, String> entry : toApply.getAsMap().entrySet()) {, +            if (entry.getValue() == null) {, +                toRemove.add(entry.getKey());, +            } else if (clusterSettings.isLoggerSetting(entry.getKey()) || clusterSettings.hasDynamicSetting(entry.getKey())) {, +                settingsBuilder.put(entry.getKey(), entry.getValue());, +                updates.put(entry.getKey(), entry.getValue());, +                changed = true;, +            } else {, +                throw new IllegalArgumentException(type + " setting [" + entry.getKey() + "], not dynamically updateable");, +            }, +        changed |= applyDeletes(toRemove, target);, +        target.put(settingsBuilder.build());, +        return changed;, +    }, +, +    private final boolean applyDeletes(Set<String> deletes, Settings.Builder builder) {, +        boolean changed = false;, +        for (String entry : deletes) {, +            Set<String> keysToRemove = new HashSet<>();, +            Set<String> keySet = builder.internalMap().keySet();, +            for (String key : keySet) {, +                if (Regex.simpleMatch(entry, key)) {, +                    keysToRemove.add(key);, +                }, +            }, +            for (String key : keysToRemove) {, +                builder.remove(key);, +                changed = true;, +            }, +        }, +        return changed;, +    }, +}, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/TransportUpdateSettingsAction.java, +        if (request.settings().getAsMap().size() == 1 && (request.settings().get(IndexMetaData.SETTING_BLOCKS_METADATA) != null || request.settings().get(IndexMetaData.SETTING_READ_ONLY) != null )) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/settings/SettingsUpdater.java, +import org.elasticsearch.common.regex.Regex;, +import java.util.HashSet;, +import java.util.Map;, +import java.util.Set;, +, +        changed |= apply(transientToApply, transientSettings, transientUpdates, "transient");, +        changed |= apply(persistentToApply, persistentSettings, persistentUpdates, "persistent");]