[+++ b/server/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java, +import org.elasticsearch.transport.TransportResponseHandler;, +                new TransportResponseHandler<UpdateIndexShardSnapshotStatusResponse>() {, +                    public UpdateIndexShardSnapshotStatusResponse read(StreamInput in) throws IOException {, +                        final UpdateIndexShardSnapshotStatusResponse response = new UpdateIndexShardSnapshotStatusResponse();, +                        response.readFrom(in);, +                        return response;, +                    }, +, +                    @Override, +                    public void handleResponse(UpdateIndexShardSnapshotStatusResponse response) {, +, +                    @Override, +                    public String executor() {, +                        return ThreadPool.Names.SAME;, +                    }, +++ b/server/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java, +import org.elasticsearch.transport.TransportResponseHandler;, +                new TransportResponseHandler<UpdateIndexShardSnapshotStatusResponse>() {, +                    public UpdateIndexShardSnapshotStatusResponse read(StreamInput in) throws IOException {, +                        final UpdateIndexShardSnapshotStatusResponse response = new UpdateIndexShardSnapshotStatusResponse();, +                        response.readFrom(in);, +                        return response;, +                    }, +, +                    @Override, +                    public void handleResponse(UpdateIndexShardSnapshotStatusResponse response) {, +, +                    @Override, +                    public String executor() {, +                        return ThreadPool.Names.SAME;, +                    }, +++ b/server/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java, +++ b/server/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java, +import org.elasticsearch.transport.TransportResponseHandler;, +                new TransportResponseHandler<UpdateIndexShardSnapshotStatusResponse>() {, +                    public UpdateIndexShardSnapshotStatusResponse read(StreamInput in) throws IOException {, +                        final UpdateIndexShardSnapshotStatusResponse response = new UpdateIndexShardSnapshotStatusResponse();, +                        response.readFrom(in);, +                        return response;, +                    }, +, +                    @Override, +                    public void handleResponse(UpdateIndexShardSnapshotStatusResponse response) {, +, +                    @Override, +                    public String executor() {, +                        return ThreadPool.Names.SAME;, +                    }, +++ b/server/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java, +++ b/server/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java, +                try {, +                    SnapshotsStatusResponse status =, +                        client.admin().cluster().prepareSnapshotStatus("repository").setSnapshots("snap").get();, +                } catch (Exception e) {, +                    // Force assertBusy to retry on every exception, +                    throw new AssertionError(e);, +                }]