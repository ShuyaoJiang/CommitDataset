[+++ b/test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java, +++ b/test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java, +++ b/test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java, +import org.elasticsearch.common.util.concurrent.AbstractRunnable;, +        executor.execute(new AbstractRunnable() {, +            @Override, +            public void onFailure(Exception e) {, +, +            @Override, +            protected void doRun() throws Exception {, +                started.countDown();, +                serverMockChannel.accept(executor);, +            }, +            executor.execute(new AbstractRunnable() {, +                @Override, +                public void onFailure(Exception e) {, +                            onException(MockChannel.this, e);, +, +                @Override, +                protected void doRun() throws Exception {, +                    StreamInput input = new InputStreamStreamInput(new BufferedInputStream(activeChannel.getInputStream()));, +                    while (isOpen.get()) {, +                        cancellableThreads.executeIO(() -> readMessage(MockChannel.this, input));, +                    }, +                }]