[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/gateway/fs/FsIndexShardGateway.java, +, +    private final boolean nativeCopy;, +, +        this.nativeCopy = componentSettings.getAsBoolean("native_copy", true);, +, +                            copyFromDirectory(snapshotIndexCommit.getDirectory(), fileName, copyTo, nativeCopy);, +                        new File(locationIndex, snapshotIndexCommit.getSegmentsFileName()), nativeCopy);, +                        copyToDirectory(file, store.directory(), file.getName(), nativeCopy);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/gateway/fs/FsIndexShardGateway.java, +, +    private final boolean nativeCopy;, +, +        this.nativeCopy = componentSettings.getAsBoolean("native_copy", true);, +, +                            copyFromDirectory(snapshotIndexCommit.getDirectory(), fileName, copyTo, nativeCopy);, +                        new File(locationIndex, snapshotIndexCommit.getSegmentsFileName()), nativeCopy);, +                        copyToDirectory(file, store.directory(), file.getName(), nativeCopy);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/util/lucene/Directories.java, +    public static void copyFromDirectory(Directory dir, String fileName, File copyTo, boolean nativeCopy) throws IOException {, +        if (nativeCopy && (dir instanceof FSDirectory)) {, +    public static void copyToDirectory(File copyFrom, Directory dir, String fileName, boolean nativeCopy) throws IOException {, +        if (nativeCopy && (dir instanceof FSDirectory)) {]