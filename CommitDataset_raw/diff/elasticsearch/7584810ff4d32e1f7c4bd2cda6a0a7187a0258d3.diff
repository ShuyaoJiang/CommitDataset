[+++ b/plugins/repository-hdfs/build.gradle, +configurations {, +    hadoop2, +dependencies {, +    exclude module: "hadoop-yarn-common", +    exclude module: "hadoop-mapreduce-client-app", +    exclude module: "hadoop-mapreduce-client-core", +    exclude module: "hadoop-mapreduce-client-jobclient", +    exclude module: "hadoop-yarn-api", +    , +    exclude group: "commons-cli", +    exclude module: "netty", +    // prevent jar hell, +    exclude module: "hadoop-yarn-common", +    exclude module: "commons-cli", +    exclude module: "netty", +, +  provided "org.elasticsearch:elasticsearch:${versions.elasticsearch}", +  provided configurations.hadoop2, +  , +  testCompile ("org.apache.hadoop:hadoop-hdfs:${versions.hadoop2}:tests") {, +    exclude module: "commons-cli", +    exclude module: "netty", +  }, +  , +  testCompile ("org.apache.hadoop:hadoop-common:${versions.hadoop2}:tests") {, +    exclude module: "commons-cli", +  }, +    // used due to _transitive_ configuration, +        force "commons-cli:commons-cli:1.3.1", +        force "io.netty:netty:3.10.5.Final", +        force "org.codehaus.jackson:jackson-core-asl:1.9.13", +        force "org.codehaus.jackson:jackson-mapper-asl:1.9.13", +        force "org.slf4j:slf4j-api:${versions.slf4j}", +        force "org.slf4j:slf4j-log4j12:${versions.slf4j}", +        force "junit:junit:${versions.junit}", +        force "org.apache.httpcomponents:httpclient:4.3.6", +        force "log4j:log4j:${versions.log4j}", +  mapping from: /hadoop-.*/, to: 'hadoop', +task miniHdfsStart(type: JavaExec) {, +    classpath = sourceSets.test.compileClasspath + sourceSets.test.output, +    main = "org.elasticsearch.plugin.hadoop.hdfs.MiniHDFS", +    errorOutput = new FileOutputStream("build/minihdfs.err"), +    standardOutput = new FileOutputStream("build/minihdfs.out"), +    //ext.hdfsPid = (main as Class).getPid, +//task miniHdfsStop(type: org.elasticsearch.gradle.LoggedExec) {, +//    onlyIf { hdfsPid > -1 }, +//    if (Os.isFamily(Os.FAMILY_WINDOWS)) {, +//       executable 'Taskkill', +//        args '/PID', hdfsCluster.pid, '/F', +//    } else {, +//        executable 'kill', +//       args '-9', hdfsCluster.pid, +//    }, +//}, +//integTest.dependsOn(miniHdfsStart), +//integTest.finalizedBy(miniHdfsStop), +thirdPartyAudit.enabled = false, +++ b/plugins/repository-hdfs/build.gradle, +configurations {, +    hadoop2, +dependencies {, +    exclude module: "hadoop-yarn-common", +    exclude module: "hadoop-mapreduce-client-app", +    exclude module: "hadoop-mapreduce-client-core", +    exclude module: "hadoop-mapreduce-client-jobclient", +    exclude module: "hadoop-yarn-api", +    , +    exclude group: "commons-cli", +    exclude module: "netty", +    // prevent jar hell, +    exclude module: "hadoop-yarn-common", +    exclude module: "commons-cli", +    exclude module: "netty", +, +  provided "org.elasticsearch:elasticsearch:${versions.elasticsearch}", +  provided configurations.hadoop2, +  , +  testCompile ("org.apache.hadoop:hadoop-hdfs:${versions.hadoop2}:tests") {, +    exclude module: "commons-cli", +    exclude module: "netty", +  }, +  , +  testCompile ("org.apache.hadoop:hadoop-common:${versions.hadoop2}:tests") {, +    exclude module: "commons-cli", +  }, +    // used due to _transitive_ configuration, +        force "commons-cli:commons-cli:1.3.1", +        force "io.netty:netty:3.10.5.Final", +        force "org.codehaus.jackson:jackson-core-asl:1.9.13", +        force "org.codehaus.jackson:jackson-mapper-asl:1.9.13", +        force "org.slf4j:slf4j-api:${versions.slf4j}", +        force "org.slf4j:slf4j-log4j12:${versions.slf4j}", +        force "junit:junit:${versions.junit}", +        force "org.apache.httpcomponents:httpclient:4.3.6", +        force "log4j:log4j:${versions.log4j}", +  mapping from: /hadoop-.*/, to: 'hadoop', +task miniHdfsStart(type: JavaExec) {, +    classpath = sourceSets.test.compileClasspath + sourceSets.test.output, +    main = "org.elasticsearch.plugin.hadoop.hdfs.MiniHDFS"]