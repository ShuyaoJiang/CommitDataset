[+++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java, +    public static class KeyedFilter implements Writeable<KeyedFilter>, ToXContent {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java, +    public static class KeyedFilter implements Writeable<KeyedFilter>, ToXContent {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorBuilder.java, +import org.elasticsearch.search.aggregations.AggregatorFactories.Builder;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java, +    public static class KeyedFilter implements Writeable<KeyedFilter>, ToXContent {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorBuilder.java, +import org.elasticsearch.search.aggregations.AggregatorFactories.Builder;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorBuilder.java, +    private List<ScriptField> scriptFields;, +            scriptFields = new ArrayList<>();, +            this.scriptFields = new ArrayList<>();, +    public List<ScriptField> scriptFields() {, +            List<ScriptField> scriptFields = new ArrayList<>(size);, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java, +    public static class KeyedFilter implements Writeable<KeyedFilter>, ToXContent {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorBuilder.java, +import org.elasticsearch.search.aggregations.AggregatorFactories.Builder;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorBuilder.java, +    private List<ScriptField> scriptFields;, +            scriptFields = new ArrayList<>();, +            this.scriptFields = new ArrayList<>();, +    public List<ScriptField> scriptFields() {, +            List<ScriptField> scriptFields = new ArrayList<>(size);, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java, +    private final List<ScriptField> scriptFields;, +            List<ScriptField> scriptFields, FetchSourceContext fetchSourceContext, AggregationContext context, AggregatorFactory<?> parent,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java, +    public static class KeyedFilter implements Writeable<KeyedFilter>, ToXContent {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorBuilder.java, +import org.elasticsearch.search.aggregations.AggregatorFactories.Builder;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorBuilder.java, +    private List<ScriptField> scriptFields;, +            scriptFields = new ArrayList<>();, +            this.scriptFields = new ArrayList<>();, +    public List<ScriptField> scriptFields() {, +            List<ScriptField> scriptFields = new ArrayList<>(size);, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java, +    private final List<ScriptField> scriptFields;, +            List<ScriptField> scriptFields, FetchSourceContext fetchSourceContext, AggregationContext context, AggregatorFactory<?> parent,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/PipelineAggregatorBuilder.java, +    protected String name;, +    protected String type;, +    protected String[] bucketsPaths;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java, +    public static class KeyedFilter implements Writeable<KeyedFilter>, ToXContent {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorBuilder.java, +import org.elasticsearch.search.aggregations.AggregatorFactories.Builder;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorBuilder.java, +    private List<ScriptField> scriptFields;, +            scriptFields = new ArrayList<>();, +            this.scriptFields = new ArrayList<>();, +    public List<ScriptField> scriptFields() {, +            List<ScriptField> scriptFields = new ArrayList<>(size);, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java, +    private final List<ScriptField> scriptFields;, +            List<ScriptField> scriptFields, FetchSourceContext fetchSourceContext, AggregationContext context, AggregatorFactory<?> parent,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/PipelineAggregatorBuilder.java, +    protected String name;, +    protected String type;, +    protected String[] bucketsPaths;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptParser.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java, +    public static class KeyedFilter implements Writeable<KeyedFilter>, ToXContent {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorBuilder.java, +import org.elasticsearch.search.aggregations.AggregatorFactories.Builder;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorBuilder.java, +    private List<ScriptField> scriptFields;, +            scriptFields = new ArrayList<>();, +            this.scriptFields = new ArrayList<>();, +    public List<ScriptField> scriptFields() {, +            List<ScriptField> scriptFields = new ArrayList<>(size);, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java, +    private final List<ScriptField> scriptFields;, +            List<ScriptField> scriptFields, FetchSourceContext fetchSourceContext, AggregationContext context, AggregatorFactory<?> parent,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/PipelineAggregatorBuilder.java, +    protected String name;, +    protected String type;, +    protected String[] bucketsPaths;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptParser.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregatorBuilder.java, +import org.elasticsearch.search.aggregations.pipeline.BucketHelpers.GapPolicy;, +import java.util.Map.Entry;, +        super(name, BucketScriptPipelineAggregator.TYPE.name(), bucketsPathsMap.values().toArray(new String[bucketsPathsMap.size()]));, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java, +    public static class KeyedFilter implements Writeable<KeyedFilter>, ToXContent {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorBuilder.java, +import org.elasticsearch.search.aggregations.AggregatorFactories.Builder;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorBuilder.java, +    private List<ScriptField> scriptFields;, +            scriptFields = new ArrayList<>();, +            this.scriptFields = new ArrayList<>();, +    public List<ScriptField> scriptFields() {, +            List<ScriptField> scriptFields = new ArrayList<>(size);, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java, +    private final List<ScriptField> scriptFields;, +            List<ScriptField> scriptFields, FetchSourceContext fetchSourceContext, AggregationContext context, AggregatorFactory<?> parent,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/PipelineAggregatorBuilder.java]