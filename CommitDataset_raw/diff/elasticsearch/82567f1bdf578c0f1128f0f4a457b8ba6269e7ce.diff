[+++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +                    segments = indexShard.segmentStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +                    segments = indexShard.segmentStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +                    segments = indexShard.segmentStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +                    segments = indexShard.segmentStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +                    segments = indexShard.segmentStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +                    segments = indexShard.segmentStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +import java.util.concurrent.TimeUnit;, +        final long startTimeNanos = System.nanoTime();, +        executeBulk(bulkRequest, startTimeNanos, listener, new AtomicArray<>(bulkRequest.requests.size()));, +    private long buildTookInMillis(long startTimeNanos) {, +        return TimeUnit.NANOSECONDS.toMillis(System.nanoTime() - startTimeNanos);, +    private void executeBulk(final BulkRequest bulkRequest, final long startTimeNanos, final ActionListener<BulkResponse> listener, final AtomicArray<BulkItemResponse> responses ) {, +            listener.onResponse(new BulkResponse(responses.toArray(new BulkItemResponse[responses.length()]), buildTookInMillis(startTimeNanos)));, +                    listener.onResponse(new BulkResponse(responses.toArray(new BulkItemResponse[responses.length()]), buildTookInMillis(startTimeNanos)));, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +                    segments = indexShard.segmentStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +import java.util.concurrent.TimeUnit;, +        final long startTimeNanos = System.nanoTime();, +        executeBulk(bulkRequest, startTimeNanos, listener, new AtomicArray<>(bulkRequest.requests.size()));, +    private long buildTookInMillis(long startTimeNanos) {, +        return TimeUnit.NANOSECONDS.toMillis(System.nanoTime() - startTimeNanos);, +    private void executeBulk(final BulkRequest bulkRequest, final long startTimeNanos, final ActionListener<BulkResponse> listener, final AtomicArray<BulkItemResponse> responses ) {, +            listener.onResponse(new BulkResponse(responses.toArray(new BulkItemResponse[responses.length()]), buildTookInMillis(startTimeNanos)));, +                    listener.onResponse(new BulkResponse(responses.toArray(new BulkItemResponse[responses.length()]), buildTookInMillis(startTimeNanos)));, +++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public final SegmentsStats segmentsStats() {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +                    segments = indexShard.segmentStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +import java.util.concurrent.TimeUnit;, +        final long startTimeNanos = System.nanoTime();, +        executeBulk(bulkRequest, startTimeNanos, listener, new AtomicArray<>(bulkRequest.requests.size()));, +    private long buildTookInMillis(long startTimeNanos) {, +        return TimeUnit.NANOSECONDS.toMillis(System.nanoTime() - startTimeNanos);, +    private void executeBulk(final BulkRequest bulkRequest, final long startTimeNanos, final ActionListener<BulkResponse> listener, final AtomicArray<BulkItemResponse> responses ) {, +            listener.onResponse(new BulkResponse(responses.toArray(new BulkItemResponse[responses.length()]), buildTookInMillis(startTimeNanos)));, +                    listener.onResponse(new BulkResponse(responses.toArray(new BulkItemResponse[responses.length()]), buildTookInMillis(startTimeNanos)));, +++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public final SegmentsStats segmentsStats() {, +++ b/core/src/main/java/org/elasticsearch/index/engine/SegmentsStats.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +                    segments = indexShard.segmentStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +import java.util.concurrent.TimeUnit;, +        final long startTimeNanos = System.nanoTime();, +        executeBulk(bulkRequest, startTimeNanos, listener, new AtomicArray<>(bulkRequest.requests.size()));, +    private long buildTookInMillis(long startTimeNanos) {, +        return TimeUnit.NANOSECONDS.toMillis(System.nanoTime() - startTimeNanos);, +    private void executeBulk(final BulkRequest bulkRequest, final long startTimeNanos, final ActionListener<BulkResponse> listener, final AtomicArray<BulkItemResponse> responses ) {, +            listener.onResponse(new BulkResponse(responses.toArray(new BulkItemResponse[responses.length()]), buildTookInMillis(startTimeNanos)));, +                    listener.onResponse(new BulkResponse(responses.toArray(new BulkItemResponse[responses.length()]), buildTookInMillis(startTimeNanos)));, +++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public final SegmentsStats segmentsStats() {, +++ b/core/src/main/java/org/elasticsearch/index/engine/SegmentsStats.java, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +    public SegmentsStats segmentStats() {, +        SegmentsStats segmentsStats = getEngine().segmentsStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +                    segments = indexShard.segmentStats();, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +import java.util.concurrent.TimeUnit;, +        final long startTimeNanos = System.nanoTime();]