[+++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +    static final String INDEX_CODEC = "index.codec";, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +    static final String INDEX_CODEC = "index.codec";, +++ b/src/main/java/org/elasticsearch/index/engine/robin/RobinEngine.java, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +    static final String INDEX_CODEC = "index.codec";, +++ b/src/main/java/org/elasticsearch/index/engine/robin/RobinEngine.java, +++ b/src/main/java/org/elasticsearch/index/shard/service/InternalIndexShard.java, +import org.elasticsearch.index.codec.CodecService;, +    private final CodecService codecService;, +                              PercolatorQueriesRegistry percolatorQueriesRegistry, ShardPercolateService shardPercolateService, CodecService codecService) {, +        this.codecService = codecService;, +                    checkIndex.fixIndex(status, codecService.codec(indexSettings.get(Engine.INDEX_CODEC, "default")));]