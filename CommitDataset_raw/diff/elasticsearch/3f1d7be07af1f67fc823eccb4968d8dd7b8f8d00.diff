[+++ b/core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ShardsLimitAllocationDecider.java, +import java.util.function.BiPredicate;, +, +        return doDecide(shardRouting, node, allocation, (count, limit) -> count >= limit);, +        return doDecide(shardRouting, node, allocation, (count, limit) -> count > limit);, +, +    }, +, +    private Decision doDecide(ShardRouting shardRouting, RoutingNode node, RoutingAllocation allocation,, +                              BiPredicate<Integer, Integer> decider) {, +, +        if (clusterShardLimit > 0 && decider.test(nodeShardCount, clusterShardLimit)) {, +        if (indexShardLimit > 0 && decider.test(indexShardCount, indexShardLimit)) {]