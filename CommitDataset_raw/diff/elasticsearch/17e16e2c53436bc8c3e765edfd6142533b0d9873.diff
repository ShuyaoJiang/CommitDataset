[+++ b/src/test/java/org/elasticsearch/shield/transport/netty/HandshakeWaitingHandlerTests.java, +import org.elasticsearch.shield.ShieldException;, +import java.net.BindException;, +    private int iterations;, +    private int randomPort;, +        randomPort = randomIntBetween(49000, 65500);, +        iterations = randomIntBetween(10, 100);, +, +        startBootstrap();, +    public void reset() throws InterruptedException {, +        terminate(threadPoolExecutor);, +    private void startBootstrap() {, +        serverBootstrap = new ServerBootstrap(new NioServerSocketChannelFactory());, +        serverBootstrap.setPipelineFactory(getServerFactory());, +        int tries = 1;, +        int maxTries = 10;, +        while (tries <= maxTries) {, +            try {, +                serverBootstrap.bind(new InetSocketAddress("localhost", randomPort));, +                break;, +            } catch (Throwable t) {, +                if (t.getCause() instanceof BindException) {, +                    logger.error("Tried to bind to port [{}], going to retry", randomPort);, +                    randomPort = randomIntBetween(49000, 65500);, +                }, +                if (tries >= maxTries) {, +                    throw new ShieldException("Failed to start server bootstrap [" + tries + "] times, stopping", t);, +                }, +                tries++;, +            }, +        }, +    }, +]