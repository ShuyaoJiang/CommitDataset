[+++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/PrelertPlugin.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +                new JobDataDeleterFactory(client), //NORELEASE: this should use Delete-by-query, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/PrelertPlugin.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +                new JobDataDeleterFactory(client), //NORELEASE: this should use Delete-by-query, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/action/DeleteModelSnapshotAction.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleter;, +        private final JobDataDeleterFactory bulkDeleterFactory;, +                               JobDataDeleterFactory bulkDeleterFactory) {, +            JobDataDeleter deleter = bulkDeleterFactory.apply(request.getJobId());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/PrelertPlugin.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +                new JobDataDeleterFactory(client), //NORELEASE: this should use Delete-by-query, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/action/DeleteModelSnapshotAction.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleter;, +        private final JobDataDeleterFactory bulkDeleterFactory;, +                               JobDataDeleterFactory bulkDeleterFactory) {, +            JobDataDeleter deleter = bulkDeleterFactory.apply(request.getJobId());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/action/RevertModelSnapshotAction.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +        private final JobDataDeleterFactory bulkDeleterFactory;, +                ClusterService clusterService, JobDataDeleterFactory bulkDeleterFactory,, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/PrelertPlugin.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +                new JobDataDeleterFactory(client), //NORELEASE: this should use Delete-by-query, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/action/DeleteModelSnapshotAction.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleter;, +        private final JobDataDeleterFactory bulkDeleterFactory;, +                               JobDataDeleterFactory bulkDeleterFactory) {, +            JobDataDeleter deleter = bulkDeleterFactory.apply(request.getJobId());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/action/RevertModelSnapshotAction.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +        private final JobDataDeleterFactory bulkDeleterFactory;, +                ClusterService clusterService, JobDataDeleterFactory bulkDeleterFactory,, +++ /dev/null, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/PrelertPlugin.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +                new JobDataDeleterFactory(client), //NORELEASE: this should use Delete-by-query, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/action/DeleteModelSnapshotAction.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleter;, +        private final JobDataDeleterFactory bulkDeleterFactory;, +                               JobDataDeleterFactory bulkDeleterFactory) {, +            JobDataDeleter deleter = bulkDeleterFactory.apply(request.getJobId());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/action/RevertModelSnapshotAction.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +        private final JobDataDeleterFactory bulkDeleterFactory;, +                ClusterService clusterService, JobDataDeleterFactory bulkDeleterFactory,, +++ /dev/null, +++ /dev/null, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/PrelertPlugin.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +                new JobDataDeleterFactory(client), //NORELEASE: this should use Delete-by-query, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/action/DeleteModelSnapshotAction.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleter;, +        private final JobDataDeleterFactory bulkDeleterFactory;, +                               JobDataDeleterFactory bulkDeleterFactory) {, +            JobDataDeleter deleter = bulkDeleterFactory.apply(request.getJobId());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/action/RevertModelSnapshotAction.java, +import org.elasticsearch.xpack.prelert.job.persistence.JobDataDeleterFactory;, +        private final JobDataDeleterFactory bulkDeleterFactory;, +                ClusterService clusterService, JobDataDeleterFactory bulkDeleterFactory,, +++ /dev/null, +++ /dev/null, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/prelert/job/persistence/JobDataDeleter.java, +import org.apache.logging.log4j.Level;, +import org.apache.logging.log4j.Logger;, +import org.elasticsearch.action.bulk.BulkItemResponse;, +import org.elasticsearch.action.bulk.BulkRequestBuilder;, +import org.elasticsearch.action.delete.DeleteAction;, +import org.elasticsearch.action.delete.DeleteRequestBuilder;, +import org.elasticsearch.action.search.SearchResponse;, +import org.elasticsearch.client.Client;, +import org.elasticsearch.common.logging.Loggers;, +import org.elasticsearch.index.query.QueryBuilder;, +import org.elasticsearch.index.query.QueryBuilders;, +import org.elasticsearch.index.query.RangeQueryBuilder;, +import org.elasticsearch.search.SearchHit;, +import org.elasticsearch.search.SearchHits;, +import org.elasticsearch.search.sort.SortBuilders;, +import org.elasticsearch.xpack.prelert.job.ModelState;, +import org.elasticsearch.xpack.prelert.job.results.Bucket;, +import org.elasticsearch.xpack.prelert.job.results.Result;, +import java.util.Date;, +import java.util.Objects;, +import java.util.concurrent.atomic.AtomicLong;, +, +public class JobDataDeleter {, +, +    private static final Logger LOGGER = Loggers.getLogger(JobDataDeleter.class);, +, +    private static final int SCROLL_SIZE = 1000;, +    private static final String SCROLL_CONTEXT_DURATION = "5m";, +, +    private final Client client;]