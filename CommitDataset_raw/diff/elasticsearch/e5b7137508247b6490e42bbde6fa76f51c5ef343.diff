[+++ b/test/framework/src/main/java/org/elasticsearch/test/transport/CapturingTransport.java, +import java.util.Collection;, +        List<CapturedRequest> requests = new ArrayList<>(capturedRequests.size());, +        capturedRequests.drainTo(requests);, +        return requests.toArray(new CapturedRequest[0]);, +    }, +, +    private Map<String, List<CapturedRequest>> groupRequestsByTargetNode(Collection<CapturedRequest> requests) {, +        Map<String, List<CapturedRequest>> result = new HashMap<>();, +        for (CapturedRequest request : requests) {, +            result.computeIfAbsent(request.node.getId(), node -> new ArrayList<>()).add(request);, +        }, +        return result;, +        return groupRequestsByTargetNode(capturedRequests);, +        List<CapturedRequest> requests = new ArrayList<>(capturedRequests.size());, +        capturedRequests.drainTo(requests);, +        return groupRequestsByTargetNode(requests);]