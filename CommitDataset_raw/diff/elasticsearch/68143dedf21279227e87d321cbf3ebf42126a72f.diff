[+++ b/dev-tools/src/main/resources/ant/integration-tests.xml, +                   -Des.script.indexed=on -Des.pidfile=${integ.pidfile} -Des.repositories.url.allowed_urls=http://snapshot.test*"/>, +  <!-- installs a plugin into elasticsearch -->, +  <macrodef name="install-plugin">, +      <attribute name="home" default="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +      <attribute name="name"/>, +      <attribute name="file"/>, +    <sequential>, +      <local name="url"/>, +      <makeurl property="url" file="@{file}"/>, +      <echo>Installing plugin @{name}...</echo>, +      <run-script dir="@{home}" script="bin/plugin" args="-u ${url} -i @{name}"/>, +      <local name="longname"/>, +      <property name="longname" value="@{name}"/>, +      <local name="shortname"/>, +      <filter-property src="longname" dest="shortname">, +      <fail message="did not find plugin installed as ${shortname}">, +              <file file="@{home}/plugins/${shortname}"/>, +    </sequential>, +  </macrodef>, +  <!-- start elasticsearch and wait until its ready -->, +  <macrodef name="startup-elasticsearch">, +      <attribute name="home" default="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +      <attribute name="args" default="${integ.args}"/>, +    <sequential>, +      <run-script dir="@{home}" script="bin/elasticsearch" spawn="true", +                  args="@{args} -Des.path.repo=@{home}/repo" />, +      <local name="integ.pid"/>, +    </sequential>, +  </macrodef>, +, +  <!-- unzip the elasticsearch zip -->, +  <target name="setup-workspace" depends="stop-external-cluster">, +    <sequential>, +      <delete dir="${integ.scratch}"/>, +      <unzip src="${integ.deps}/elasticsearch-${elasticsearch.version}.zip" dest="${integ.scratch}"/>, +    </sequential>, +  </target>, +, +  <!-- unzip core release artifact and start ES -->, +  <target name="start-external-cluster" depends="setup-workspace" unless="${shouldskip}">, +    <startup-elasticsearch/>, +  </target>, +, +  <!-- unzip core release artifact, install plugin, then start ES -->, +  <target name="start-external-cluster-with-plugin" depends="setup-workspace" unless="${shouldskip}">, +    <install-plugin name="${project.artifactId}" file="${project.build.directory}/releases/${project.artifactId}-${project.version}.zip"/>, +    <startup-elasticsearch/>, +++ b/dev-tools/src/main/resources/ant/integration-tests.xml, +                   -Des.script.indexed=on -Des.pidfile=${integ.pidfile} -Des.repositories.url.allowed_urls=http://snapshot.test*"/>, +  <!-- installs a plugin into elasticsearch -->, +  <macrodef name="install-plugin">, +      <attribute name="home" default="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +      <attribute name="name"/>, +      <attribute name="file"/>, +    <sequential>, +      <local name="url"/>, +      <makeurl property="url" file="@{file}"/>, +      <echo>Installing plugin @{name}...</echo>, +      <run-script dir="@{home}" script="bin/plugin" args="-u ${url} -i @{name}"/>, +      <local name="longname"/>, +      <property name="longname" value="@{name}"/>, +      <local name="shortname"/>, +      <filter-property src="longname" dest="shortname">, +      <fail message="did not find plugin installed as ${shortname}">, +              <file file="@{home}/plugins/${shortname}"/>, +    </sequential>, +  </macrodef>, +  <!-- start elasticsearch and wait until its ready -->, +  <macrodef name="startup-elasticsearch">, +      <attribute name="home" default="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +      <attribute name="args" default="${integ.args}"/>, +    <sequential>, +      <run-script dir="@{home}" script="bin/elasticsearch" spawn="true", +                  args="@{args} -Des.path.repo=@{home}/repo" />, +      <local name="integ.pid"/>, +    </sequential>, +  </macrodef>, +, +  <!-- unzip the elasticsearch zip -->, +  <target name="setup-workspace" depends="stop-external-cluster">, +    <sequential>, +      <delete dir="${integ.scratch}"/>, +      <unzip src="${integ.deps}/elasticsearch-${elasticsearch.version}.zip" dest="${integ.scratch}"/>, +    </sequential>, +  </target>, +, +  <!-- unzip core release artifact and start ES -->, +  <target name="start-external-cluster" depends="setup-workspace" unless="${shouldskip}">, +    <startup-elasticsearch/>, +  </target>, +, +  <!-- unzip core release artifact, install plugin, then start ES -->, +  <target name="start-external-cluster-with-plugin" depends="setup-workspace" unless="${shouldskip}">, +    <install-plugin name="${project.artifactId}" file="${project.build.directory}/releases/${project.artifactId}-${project.version}.zip"/>, +    <startup-elasticsearch/>, +++ b/plugins/pom.xml, +++ b/dev-tools/src/main/resources/ant/integration-tests.xml, +                   -Des.script.indexed=on -Des.pidfile=${integ.pidfile} -Des.repositories.url.allowed_urls=http://snapshot.test*"/>, +  <!-- installs a plugin into elasticsearch -->]