[+++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +        return checkIdle(inactiveTime.nanos());, +    }, +, +    final boolean checkIdle(long inactiveTimeNS) { // pkg private for testing, +        if (engineOrNull != null && System.nanoTime() - engineOrNull.getLastWriteNanos() >= inactiveTimeNS) {, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +        return checkIdle(inactiveTime.nanos());, +    }, +, +    final boolean checkIdle(long inactiveTimeNS) { // pkg private for testing, +        if (engineOrNull != null && System.nanoTime() - engineOrNull.getLastWriteNanos() >= inactiveTimeNS) {, +++ b/core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java, +                .setSettings(SETTING_NUMBER_OF_SHARDS, 1, SETTING_NUMBER_OF_REPLICAS, 0));, +        client().prepareIndex("test", "test").setSource("{}").get();, +        Boolean result = indicesService.indexService("test").getShardOrNull(0).checkIdle(0);]