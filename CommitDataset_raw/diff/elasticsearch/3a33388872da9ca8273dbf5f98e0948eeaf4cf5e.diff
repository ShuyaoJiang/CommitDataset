[+++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +        URI uri = getClass().getResource(POLICY_RESOURCE).toURI();, +        this.template = Policy.getInstance("JavaPolicy", new URIParameter(uri));, +                // run groovy scripts with no permissions, +                    return false;, +++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +        URI uri = getClass().getResource(POLICY_RESOURCE).toURI();, +        this.template = Policy.getInstance("JavaPolicy", new URIParameter(uri));, +                // run groovy scripts with no permissions, +                    return false;, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +import org.apache.lucene.index.IndexWriter;, +import org.elasticsearch.ExceptionsHelper;, +            } catch (AssertionError e) {, +                // IndexWriter throws AssertionError on init, if asserts are enabled, if any files don't exist, but tests that, +                // randomly throw FNFE/NSFE can also hit this:, +                if (ExceptionsHelper.stackTrace(e).contains("org.apache.lucene.index.IndexWriter.filesExist")) {, +                    throw new EngineCreationFailureException(shardId, "failed to create engine", e);, +                } else {, +                    throw e;, +                }, +++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +        URI uri = getClass().getResource(POLICY_RESOURCE).toURI();, +        this.template = Policy.getInstance("JavaPolicy", new URIParameter(uri));, +                // run groovy scripts with no permissions, +                    return false;, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +import org.apache.lucene.index.IndexWriter;, +import org.elasticsearch.ExceptionsHelper;, +            } catch (AssertionError e) {, +                // IndexWriter throws AssertionError on init, if asserts are enabled, if any files don't exist, but tests that, +                // randomly throw FNFE/NSFE can also hit this:, +                if (ExceptionsHelper.stackTrace(e).contains("org.apache.lucene.index.IndexWriter.filesExist")) {, +                    throw new EngineCreationFailureException(shardId, "failed to create engine", e);, +                } else {, +                    throw e;, +                }, +++ b/core/src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java, +++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +        URI uri = getClass().getResource(POLICY_RESOURCE).toURI();, +        this.template = Policy.getInstance("JavaPolicy", new URIParameter(uri));, +                // run groovy scripts with no permissions, +                    return false;, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +import org.apache.lucene.index.IndexWriter;, +import org.elasticsearch.ExceptionsHelper;, +            } catch (AssertionError e) {, +                // IndexWriter throws AssertionError on init, if asserts are enabled, if any files don't exist, but tests that, +                // randomly throw FNFE/NSFE can also hit this:, +                if (ExceptionsHelper.stackTrace(e).contains("org.apache.lucene.index.IndexWriter.filesExist")) {, +                    throw new EngineCreationFailureException(shardId, "failed to create engine", e);, +                } else {, +                    throw e;, +                }, +++ b/core/src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +        URI uri = getClass().getResource(POLICY_RESOURCE).toURI();, +        this.template = Policy.getInstance("JavaPolicy", new URIParameter(uri));, +                // run groovy scripts with no permissions, +                    return false;, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +import org.apache.lucene.index.IndexWriter;, +import org.elasticsearch.ExceptionsHelper;, +            } catch (AssertionError e) {, +                // IndexWriter throws AssertionError on init, if asserts are enabled, if any files don't exist, but tests that, +                // randomly throw FNFE/NSFE can also hit this:, +                if (ExceptionsHelper.stackTrace(e).contains("org.apache.lucene.index.IndexWriter.filesExist")) {, +                    throw new EngineCreationFailureException(shardId, "failed to create engine", e);, +                } else {, +                    throw e;, +                }, +++ b/core/src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java, +++ /dev/null, +++ b/core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java]