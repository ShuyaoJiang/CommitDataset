[+++ b/src/main/java/org/elasticsearch/indices/IndicesService.java, +    public static final String INDICES_SHARDS_CLOSED_TIMEOUT = "indices.shards_closed_timeout";, +, +    private final TimeValue shardsClosedTimeout;, +        this.shardsClosedTimeout = settings.getAsTime(INDICES_SHARDS_CLOSED_TIMEOUT, new TimeValue(1, TimeUnit.DAYS));, +            if (latch.await(shardsClosedTimeout.seconds(), TimeUnit.SECONDS) == false) {, +              logger.warn("Not all shards are closed yet, waited {}sec - stopping service", shardsClosedTimeout.seconds());]