[+++ b/core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java, +        private final float avgShardsPerNode;, +            avgShardsPerNode = ((float) metaData.totalNumberOfShards()) / nodes.size();, +            return avgShardsPerNode;]