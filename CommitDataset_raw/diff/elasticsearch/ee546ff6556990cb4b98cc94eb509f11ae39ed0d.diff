[+++ b/plugins/repository-hdfs/src/main/java/org/elasticsearch/plugin/hadoop/hdfs/HdfsPlugin.java, +import java.io.IOException;, +import java.nio.file.Files;, +import java.nio.file.Path;, +import org.elasticsearch.common.SuppressForbidden;, +                return evilHadoopInit();, +            }, +        });, +    }, +, +    @SuppressForbidden(reason = "Needs a security hack for hadoop on windows, until HADOOP-XXXX is fixed"), +    private static Void evilHadoopInit() {, +        String oldValue = null;, +            // hack: on Windows, Shell's cinit has a similar problem that on unix,, +            // but here we can workaround it for now by setting hadoop home, +            // TODO: remove THIS when hadoop is fixed, +            Path hadoopHome = Files.createTempDirectory("hadoop").toAbsolutePath();, +            oldValue = System.setProperty("hadoop.home.dir", hadoopHome.toString());, +        } catch (ClassNotFoundException | IOException e) {, +        } finally {, +            if (oldValue == null) {, +                System.clearProperty("hadoop.home.dir");, +            } else {, +                System.setProperty("hadoop.home.dir", oldValue);, +            }]