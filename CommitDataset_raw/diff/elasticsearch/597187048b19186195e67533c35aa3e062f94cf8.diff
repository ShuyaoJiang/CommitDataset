[+++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java, +import org.apache.logging.log4j.Logger;, +import java.util.Collections;, +import java.util.LinkedList;, +import java.util.Optional;, +import java.util.Queue;, +        final Optional<Error> maybeError = maybeError(cause);, +        if (maybeError.isPresent()) {, +                final Logger logger = ESLoggerFactory.getLogger(Netty4Utils.class);, +                logger.error("fatal error on the network layer\n{}", formatted);, +                            throw maybeError.get();, +    static final int MAX_ITERATIONS = 1024;, +, +    /**, +     * Unwrap the specified throwable looking for any suppressed errors or errors as a root cause of the specified throwable., +     *, +     * @param cause the root throwable, +     *, +     * @return an optional error if one is found suppressed or a root cause in the tree rooted at the specified throwable, +     */, +    static Optional<Error> maybeError(final Throwable cause) {, +        // early terminate if the cause is already an error, +        if (cause instanceof Error) {, +            return Optional.of((Error) cause);, +        }, +, +        final Queue<Throwable> queue = new LinkedList<>();, +        queue.add(cause);, +        int iterations = 0;, +        while (!queue.isEmpty()) {, +            iterations++;, +            if (iterations > MAX_ITERATIONS) {, +                ESLoggerFactory.getLogger(Netty4Utils.class).warn("giving up looking for fatal errors on the network layer", cause);, +                break;, +            }, +            final Throwable current = queue.remove();, +            if (current instanceof Error) {, +                return Optional.of((Error) current);, +            }, +            Collections.addAll(queue, current.getSuppressed());, +            if (current.getCause() != null) {, +                queue.add(current.getCause());, +            }, +        }, +        return Optional.empty();, +    }, +, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java, +import org.apache.logging.log4j.Logger;, +import java.util.Collections;, +import java.util.LinkedList;, +import java.util.Optional;, +import java.util.Queue;, +        final Optional<Error> maybeError = maybeError(cause);, +        if (maybeError.isPresent()) {, +                final Logger logger = ESLoggerFactory.getLogger(Netty4Utils.class);, +                logger.error("fatal error on the network layer\n{}", formatted);, +                            throw maybeError.get();, +    static final int MAX_ITERATIONS = 1024;, +, +    /**, +     * Unwrap the specified throwable looking for any suppressed errors or errors as a root cause of the specified throwable., +     *, +     * @param cause the root throwable, +     *, +     * @return an optional error if one is found suppressed or a root cause in the tree rooted at the specified throwable, +     */, +    static Optional<Error> maybeError(final Throwable cause) {, +        // early terminate if the cause is already an error, +        if (cause instanceof Error) {, +            return Optional.of((Error) cause);, +        }, +, +        final Queue<Throwable> queue = new LinkedList<>();, +        queue.add(cause);, +        int iterations = 0;, +        while (!queue.isEmpty()) {, +            iterations++;, +            if (iterations > MAX_ITERATIONS) {, +                ESLoggerFactory.getLogger(Netty4Utils.class).warn("giving up looking for fatal errors on the network layer", cause);, +                break;, +            }, +            final Throwable current = queue.remove();, +            if (current instanceof Error) {, +                return Optional.of((Error) current);, +            }, +            Collections.addAll(queue, current.getSuppressed());, +            if (current.getCause() != null) {, +                queue.add(current.getCause());, +            }, +        }, +        return Optional.empty();, +    }, +, +++ b/modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4UtilsTests.java, +import io.netty.handler.codec.DecoderException;, +import java.util.Optional;, +, +import static org.hamcrest.CoreMatchers.equalTo;, +    public void testMaybeError() {]