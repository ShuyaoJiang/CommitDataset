[+++ b/plugin/rollup/src/test/java/org/elasticsearch/xpack/rollup/job/RollupIndexerStateTests.java, +        final CountDownLatch latch = new CountDownLatch(1);, +            EmptyRollupIndexer indexer = new EmptyRollupIndexer(executor, job, state, null) {, +                    try {, +                        latch.await();, +                    } catch (InterruptedException e) {, +                        throw new IllegalStateException(e);, +                    }, +, +, +        // Don't use the indexer's latch because we completely change doNextSearch(), +        final CountDownLatch doNextSearchLatch = new CountDownLatch(1);, +, +                    try {, +                        doNextSearchLatch.await();, +                    } catch (InterruptedException e) {, +                        throw new IllegalStateException(e);, +                    }, +, +            doNextSearchLatch.countDown();]