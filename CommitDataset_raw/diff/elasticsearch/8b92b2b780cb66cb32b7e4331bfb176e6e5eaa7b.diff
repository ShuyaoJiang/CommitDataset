[+++ b/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +import com.google.common.collect.Sets;, +import org.elasticsearch.common.collect.Tuple;, +import java.util.Set;, +        Set<Tuple<String, String>> mappingsToUpdate = null;, +, +                        if (mappingsToUpdate == null) {, +                            mappingsToUpdate = Sets.newHashSet();, +                        }, +                        mappingsToUpdate.add(Tuple.create(indexRequest.index(), indexRequest.type()));, +        if (mappingsToUpdate != null) {, +            for (Tuple<String, String> mappingToUpdate : mappingsToUpdate) {, +                updateMappingOnMaster(mappingToUpdate.v1(), mappingToUpdate.v2());, +            }, +        }, +, +    private void updateMappingOnMaster(final String index, final String type) {, +            MapperService mapperService = indicesService.indexServiceSafe(index).mapperService();, +            final DocumentMapper documentMapper = mapperService.documentMapper(type);, +            mappingUpdatedAction.execute(new MappingUpdatedAction.MappingUpdatedRequest(index, type, documentMapper.mappingSource()), new ActionListener<MappingUpdatedAction.MappingUpdatedResponse>() {, +                        logger.warn("failed to update master on updated mapping for index [{}], type [{}] and source [{}]", e, index, type, documentMapper.mappingSource().string());, +            logger.warn("failed to update master on updated mapping for index [{}], type [{}]", e, index, type);]