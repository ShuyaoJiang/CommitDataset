[+++ b/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java, +import org.elasticsearch.common.io.stream.OutputStreamStreamOutput;, +                writeSnapshot(blobStoreSnapshot, output);, +                writeGlobalMetaData(metaData, output);, +                final IndexMetaData indexMetaData = metaData.index(index);, +                final BlobPath indexPath = basePath().add("indices").add(index);, +                final BlobContainer indexMetaDataBlobContainer = blobStore().blobContainer(indexPath);, +                try (OutputStream output = indexMetaDataBlobContainer.createOutput(snapshotBlobName(snapshotId))) {, +                    StreamOutput stream = new OutputStreamStreamOutput(output);, +                writeSnapshot(snapshot, output);, +    private void writeSnapshot(BlobStoreSnapshot snapshot, OutputStream outputStream) throws IOException {, +        StreamOutput stream = new OutputStreamStreamOutput(outputStream);, +    private void writeGlobalMetaData(MetaData metaData, OutputStream outputStream) throws IOException {, +        StreamOutput stream = new OutputStreamStreamOutput(outputStream) ;]