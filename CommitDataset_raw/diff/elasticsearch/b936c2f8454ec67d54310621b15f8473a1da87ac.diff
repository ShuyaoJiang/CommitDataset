[+++ b/src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java, +import org.elasticsearch.common.util.CancellableThreads;, +    private final CancellableThreads cancellableThreads = new CancellableThreads();, +            cancellableThreads.execute(new CancellableThreads.Interruptable() {, +                @Override, +                public void run() throws InterruptedException {, +                        if (latch.await(waitForMappingUpdatePostRecovery.millis(), TimeUnit.MILLISECONDS) == false) {, +                            logger.debug("waited for mapping update on master for [{}], yet timed out", type);, +                        throw e;, +            });, +, +        }, +        cancellableThreads.cancel("closed");]