[+++ b/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsResponse.java, +            return XContentHelper.convertToMap(source, true).v2();, +++ b/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsResponse.java, +            return XContentHelper.convertToMap(source, true).v2();, +++ b/src/main/java/org/elasticsearch/gateway/local/state/meta/LocalGatewayMetaState.java, +                bytes.writeTo(fos);, +                bytes.writeTo(fos);, +++ b/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsResponse.java, +            return XContentHelper.convertToMap(source, true).v2();, +++ b/src/main/java/org/elasticsearch/gateway/local/state/meta/LocalGatewayMetaState.java, +                bytes.writeTo(fos);, +                bytes.writeTo(fos);, +++ b/src/main/java/org/elasticsearch/gateway/local/state/shards/LocalGatewayShardsState.java, +                bytes.writeTo(fos);, +            logger.warn("[{}][{}]: failed to write shard state", lastFailure, shardId.index().name(), shardId.id());, +++ b/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsResponse.java, +            return XContentHelper.convertToMap(source, true).v2();, +++ b/src/main/java/org/elasticsearch/gateway/local/state/meta/LocalGatewayMetaState.java, +                bytes.writeTo(fos);, +                bytes.writeTo(fos);, +++ b/src/main/java/org/elasticsearch/gateway/local/state/shards/LocalGatewayShardsState.java, +                bytes.writeTo(fos);, +            logger.warn("[{}][{}]: failed to write shard state", lastFailure, shardId.index().name(), shardId.id());, +++ b/src/main/java/org/elasticsearch/index/mapper/internal/SourceFieldMapper.java, +        if (!source.hasArray()) {, +            source = source.toBytesArray();, +        }, +++ b/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsResponse.java, +            return XContentHelper.convertToMap(source, true).v2();, +++ b/src/main/java/org/elasticsearch/gateway/local/state/meta/LocalGatewayMetaState.java, +                bytes.writeTo(fos);, +                bytes.writeTo(fos);, +++ b/src/main/java/org/elasticsearch/gateway/local/state/shards/LocalGatewayShardsState.java, +                bytes.writeTo(fos);, +            logger.warn("[{}][{}]: failed to write shard state", lastFailure, shardId.index().name(), shardId.id());, +++ b/src/main/java/org/elasticsearch/index/mapper/internal/SourceFieldMapper.java, +        if (!source.hasArray()) {, +            source = source.toBytesArray();, +        }, +++ b/src/main/java/org/elasticsearch/index/translog/fs/FsTranslog.java, +            // TODO: pass teh BytesReference to the FsTranslogFile and have them optimize writing, +            if (!ref.hasArray()) {, +                ref = ref.toBytesArray();, +            }, +++ b/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsResponse.java, +            return XContentHelper.convertToMap(source, true).v2();, +++ b/src/main/java/org/elasticsearch/gateway/local/state/meta/LocalGatewayMetaState.java, +                bytes.writeTo(fos);, +                bytes.writeTo(fos);, +++ b/src/main/java/org/elasticsearch/gateway/local/state/shards/LocalGatewayShardsState.java, +                bytes.writeTo(fos);, +            logger.warn("[{}][{}]: failed to write shard state", lastFailure, shardId.index().name(), shardId.id());, +++ b/src/main/java/org/elasticsearch/index/mapper/internal/SourceFieldMapper.java, +        if (!source.hasArray()) {, +            source = source.toBytesArray();, +        }, +++ b/src/main/java/org/elasticsearch/index/translog/fs/FsTranslog.java, +            // TODO: pass teh BytesReference to the FsTranslogFile and have them optimize writing, +            if (!ref.hasArray()) {, +                ref = ref.toBytesArray();, +            }, +++ b/src/test/java/org/elasticsearch/index/mapper/all/SimpleAllMapperTests.java, +                .endObject().bytes().toBytes();]