[+++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +     * that were created before Elasticsearch v2.0.0.beta1 should be upgraded using upgrade API before they can, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +     * that were created before Elasticsearch v2.0.0.beta1 should be upgraded using upgrade API before they can, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +        final Translog.TranslogGeneration generation = loadTranslogIdFromCommit(writer, createNew);, +            assert createNew;, +    private Translog.TranslogGeneration loadTranslogIdFromCommit(IndexWriter writer, boolean createNew) throws IOException {, +            if (createNew == false &&  translogUUID == null) {, +                throw new IndexFormatTooOldException("translog", "translog has no generation nor a UUID - this might be an index from a previous version consider upgrading to N-1 first");, +            }, +, +        if (createNew == false) {, +            // We expect that this shard already exists, so it must already have an existing translog else something is badly wrong!, +            throw new IllegalStateException("no translog generation present in commit data but translog is expected to exist");, +        }, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +     * that were created before Elasticsearch v2.0.0.beta1 should be upgraded using upgrade API before they can, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +        final Translog.TranslogGeneration generation = loadTranslogIdFromCommit(writer, createNew);, +            assert createNew;, +    private Translog.TranslogGeneration loadTranslogIdFromCommit(IndexWriter writer, boolean createNew) throws IOException {, +            if (createNew == false &&  translogUUID == null) {, +                throw new IndexFormatTooOldException("translog", "translog has no generation nor a UUID - this might be an index from a previous version consider upgrading to N-1 first");, +            }, +, +        if (createNew == false) {, +            // We expect that this shard already exists, so it must already have an existing translog else something is badly wrong!, +            throw new IllegalStateException("no translog generation present in commit data but translog is expected to exist");, +        }, +++ b/core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java, +        ids.put(64, null); // DeleteByQueryFailedEngineException was removed in 3.0]