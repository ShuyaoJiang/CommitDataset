[+++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorBuilder.java, +        factory.highlightBuilder = in.readOptionalWriteable(HighlightBuilder::new);, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorBuilder.java, +        factory.highlightBuilder = in.readOptionalWriteable(HighlightBuilder::new);, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java, +                assertEquals(testAgg, deserializedQuery);, +                assertEquals(testAgg.hashCode(), deserializedQuery.hashCode());, +                assertNotSame(testAgg, deserializedQuery);]