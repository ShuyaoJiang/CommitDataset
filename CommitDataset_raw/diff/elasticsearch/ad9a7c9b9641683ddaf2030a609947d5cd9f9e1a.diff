[+++ b/elasticsearch/qa/smoke-test-plugins-ssl/build.gradle, +    setting 'xpack.ssl.keystore.path', nodeKeystore.name, +    setting 'xpack.ssl.keystore.password', 'keypass', +++ b/elasticsearch/qa/smoke-test-plugins-ssl/build.gradle, +    setting 'xpack.ssl.keystore.path', nodeKeystore.name, +    setting 'xpack.ssl.keystore.password', 'keypass', +++ b/elasticsearch/qa/smoke-test-plugins-ssl/src/test/java/org/elasticsearch/smoketest/SmokeTestMonitoringWithSecurityIT.java, +                .put("xpack.security.transport.ssl.enabled", true), +                .put("xpack.ssl.keystore.path", clientKeyStore), +                .put("xpack.ssl.keystore.password", KEYSTORE_PASS);, +++ b/elasticsearch/qa/smoke-test-plugins-ssl/build.gradle, +    setting 'xpack.ssl.keystore.path', nodeKeystore.name, +    setting 'xpack.ssl.keystore.password', 'keypass', +++ b/elasticsearch/qa/smoke-test-plugins-ssl/src/test/java/org/elasticsearch/smoketest/SmokeTestMonitoringWithSecurityIT.java, +                .put("xpack.security.transport.ssl.enabled", true), +                .put("xpack.ssl.keystore.path", clientKeyStore), +                .put("xpack.ssl.keystore.password", KEYSTORE_PASS);, +++ b/elasticsearch/x-pack/monitoring/src/main/java/org/elasticsearch/xpack/monitoring/Monitoring.java, +import org.elasticsearch.xpack.ssl.SSLService;, +                                               LicenseService licenseService, SSLService sslService) {, +        // TODO do exporters and their ssl config really need to be dynamic? https://github.com/elastic/x-plugins/issues/3117, +        final SSLService dynamicSSLService = sslService.createDynamicSSLService();, +        exporterFactories.put(HttpExporter.TYPE, config -> new HttpExporter(config, env, dynamicSSLService));, +++ b/elasticsearch/qa/smoke-test-plugins-ssl/build.gradle, +    setting 'xpack.ssl.keystore.path', nodeKeystore.name, +    setting 'xpack.ssl.keystore.password', 'keypass', +++ b/elasticsearch/qa/smoke-test-plugins-ssl/src/test/java/org/elasticsearch/smoketest/SmokeTestMonitoringWithSecurityIT.java, +                .put("xpack.security.transport.ssl.enabled", true), +                .put("xpack.ssl.keystore.path", clientKeyStore), +                .put("xpack.ssl.keystore.password", KEYSTORE_PASS);, +++ b/elasticsearch/x-pack/monitoring/src/main/java/org/elasticsearch/xpack/monitoring/Monitoring.java, +import org.elasticsearch.xpack.ssl.SSLService;, +                                               LicenseService licenseService, SSLService sslService) {, +        // TODO do exporters and their ssl config really need to be dynamic? https://github.com/elastic/x-plugins/issues/3117, +        final SSLService dynamicSSLService = sslService.createDynamicSSLService();, +        exporterFactories.put(HttpExporter.TYPE, config -> new HttpExporter(config, env, dynamicSSLService));, +++ b/elasticsearch/x-pack/monitoring/src/main/java/org/elasticsearch/xpack/monitoring/agent/exporter/http/HttpExporter.java, +import org.elasticsearch.xpack.ssl.SSLService;, +    public HttpExporter(Config config, Environment env, SSLService sslService) {, +        final Settings sslSettings = config.settings().getByPrefix("ssl.");, +        sslSocketFactory = sslService.sslSocketFactory(sslSettings);, +        hostnameVerification = sslService.getVerificationMode(sslSettings, Settings.EMPTY).isHostnameVerificationEnabled();, +++ b/elasticsearch/qa/smoke-test-plugins-ssl/build.gradle, +    setting 'xpack.ssl.keystore.path', nodeKeystore.name, +    setting 'xpack.ssl.keystore.password', 'keypass', +++ b/elasticsearch/qa/smoke-test-plugins-ssl/src/test/java/org/elasticsearch/smoketest/SmokeTestMonitoringWithSecurityIT.java, +                .put("xpack.security.transport.ssl.enabled", true), +                .put("xpack.ssl.keystore.path", clientKeyStore), +                .put("xpack.ssl.keystore.password", KEYSTORE_PASS);, +++ b/elasticsearch/x-pack/monitoring/src/main/java/org/elasticsearch/xpack/monitoring/Monitoring.java, +import org.elasticsearch.xpack.ssl.SSLService;, +                                               LicenseService licenseService, SSLService sslService) {, +        // TODO do exporters and their ssl config really need to be dynamic? https://github.com/elastic/x-plugins/issues/3117, +        final SSLService dynamicSSLService = sslService.createDynamicSSLService();, +        exporterFactories.put(HttpExporter.TYPE, config -> new HttpExporter(config, env, dynamicSSLService));, +++ b/elasticsearch/x-pack/monitoring/src/main/java/org/elasticsearch/xpack/monitoring/agent/exporter/http/HttpExporter.java, +import org.elasticsearch.xpack.ssl.SSLService;, +    public HttpExporter(Config config, Environment env, SSLService sslService) {, +        final Settings sslSettings = config.settings().getByPrefix("ssl.");, +        sslSocketFactory = sslService.sslSocketFactory(sslSettings);, +        hostnameVerification = sslService.getVerificationMode(sslSettings, Settings.EMPTY).isHostnameVerificationEnabled();, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/agent/exporter/http/HttpExporterSimpleTests.java, +import org.elasticsearch.xpack.ssl.SSLService;, +            new HttpExporter(config, environment, new SSLService(builder.build(), environment));, +            new HttpExporter(config, environment, new SSLService(builder.build(), environment));, +            new HttpExporter(config, environment, new SSLService(builder.build(), environment));, +            new HttpExporter(config, environment, new SSLService(builder.build(), environment));, +        new HttpExporter(config, environment, new SSLService(builder.build(), environment));, +++ b/elasticsearch/qa/smoke-test-plugins-ssl/build.gradle, +    setting 'xpack.ssl.keystore.path', nodeKeystore.name, +    setting 'xpack.ssl.keystore.password', 'keypass', +++ b/elasticsearch/qa/smoke-test-plugins-ssl/src/test/java/org/elasticsearch/smoketest/SmokeTestMonitoringWithSecurityIT.java, +                .put("xpack.security.transport.ssl.enabled", true), +                .put("xpack.ssl.keystore.path", clientKeyStore), +                .put("xpack.ssl.keystore.password", KEYSTORE_PASS);, +++ b/elasticsearch/x-pack/monitoring/src/main/java/org/elasticsearch/xpack/monitoring/Monitoring.java, +import org.elasticsearch.xpack.ssl.SSLService;, +                                               LicenseService licenseService, SSLService sslService) {, +        // TODO do exporters and their ssl config really need to be dynamic? https://github.com/elastic/x-plugins/issues/3117, +        final SSLService dynamicSSLService = sslService.createDynamicSSLService();, +        exporterFactories.put(HttpExporter.TYPE, config -> new HttpExporter(config, env, dynamicSSLService));, +++ b/elasticsearch/x-pack/monitoring/src/main/java/org/elasticsearch/xpack/monitoring/agent/exporter/http/HttpExporter.java, +import org.elasticsearch.xpack.ssl.SSLService;, +    public HttpExporter(Config config, Environment env, SSLService sslService) {, +        final Settings sslSettings = config.settings().getByPrefix("ssl.");, +        sslSocketFactory = sslService.sslSocketFactory(sslSettings);, +        hostnameVerification = sslService.getVerificationMode(sslSettings, Settings.EMPTY).isHostnameVerificationEnabled();, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/agent/exporter/http/HttpExporterSimpleTests.java, +import org.elasticsearch.xpack.ssl.SSLService;, +            new HttpExporter(config, environment, new SSLService(builder.build(), environment));, +            new HttpExporter(config, environment, new SSLService(builder.build(), environment));, +            new HttpExporter(config, environment, new SSLService(builder.build(), environment));, +            new HttpExporter(config, environment, new SSLService(builder.build(), environment));, +        new HttpExporter(config, environment, new SSLService(builder.build(), environment));, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/security/MonitoringSettingsFilterTests.java, +// TODO: we do not need individual tests for monitoring and security... maybe watcher even has one too?, +                .put("xpack.monitoring.exporters._http.ssl.truststore.path",, +                        getDataPath("/org/elasticsearch/xpack/security/transport/ssl/certs/simple/truststore-testnode-only.jks")), +                .put("xpack.monitoring.exporters._http.ssl.truststore.password", "truststore-testnode-only"), +                .put("xpack.monitoring.exporters._http.ssl.verification_mode", "full")]