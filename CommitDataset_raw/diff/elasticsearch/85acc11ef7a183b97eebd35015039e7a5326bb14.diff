[+++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/indexing/AsyncTwoPhaseIndexerTests.java, +import java.util.concurrent.CountDownLatch;, +import java.util.concurrent.TimeUnit;, +        private final CountDownLatch latch;, +        protected MockIndexer(Executor executor, AtomicReference<IndexerState> initialState, Integer initialPosition,, +                              CountDownLatch latch) {, +            this.latch = latch;, +            awaitForLatch();, +        private void awaitForLatch() {, +            try {, +                latch.await(10, TimeUnit.SECONDS);, +            } catch (InterruptedException e) {, +                throw new RuntimeException(e);, +            }, +        }, +, +            CountDownLatch countDownLatch = new CountDownLatch(1);, +            MockIndexer indexer = new MockIndexer(executor, state, 2, countDownLatch);, +            countDownLatch.countDown();, +]