[+++ b/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java, +    private ImmutableMap<String, String> serviceAttributes;, +    public NodeInfo(DiscoveryNode node, ImmutableMap<String, String> serviceAttributes, Settings settings,, +        this.serviceAttributes = serviceAttributes;, +     * The service attributes of the node., +    public ImmutableMap<String, String> serviceAttributes() {, +        return this.serviceAttributes;, +    public ImmutableMap<String, String> getServiceAttributes() {, +        return serviceAttributes();, +        serviceAttributes = builder.build();, +        out.writeVInt(serviceAttributes.size());, +        for (Map.Entry<String, String> entry : serviceAttributes.entrySet()) {, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java, +    private ImmutableMap<String, String> serviceAttributes;, +    public NodeInfo(DiscoveryNode node, ImmutableMap<String, String> serviceAttributes, Settings settings,, +        this.serviceAttributes = serviceAttributes;, +     * The service attributes of the node., +    public ImmutableMap<String, String> serviceAttributes() {, +        return this.serviceAttributes;, +    public ImmutableMap<String, String> getServiceAttributes() {, +        return serviceAttributes();, +        serviceAttributes = builder.build();, +        out.writeVInt(serviceAttributes.size());, +        for (Map.Entry<String, String> entry : serviceAttributes.entrySet()) {, +++ b/src/main/java/org/elasticsearch/discovery/zen/DiscoveryNodesProvider.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.node.service.NodeService;, +, +    @Nullable, +    NodeService nodeService();, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java, +    private ImmutableMap<String, String> serviceAttributes;, +    public NodeInfo(DiscoveryNode node, ImmutableMap<String, String> serviceAttributes, Settings settings,, +        this.serviceAttributes = serviceAttributes;, +     * The service attributes of the node., +    public ImmutableMap<String, String> serviceAttributes() {, +        return this.serviceAttributes;, +    public ImmutableMap<String, String> getServiceAttributes() {, +        return serviceAttributes();, +        serviceAttributes = builder.build();, +        out.writeVInt(serviceAttributes.size());, +        for (Map.Entry<String, String> entry : serviceAttributes.entrySet()) {, +++ b/src/main/java/org/elasticsearch/discovery/zen/DiscoveryNodesProvider.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.node.service.NodeService;, +, +    @Nullable, +    NodeService nodeService();, +++ b/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java, +import org.elasticsearch.common.inject.internal.Nullable;, +import org.elasticsearch.node.service.NodeService;, +    @Nullable, +    private NodeService nodeService;, +, +    public void setNodeService(@Nullable NodeService nodeService) {, +        this.nodeService = nodeService;, +    }, +, +    public NodeService nodeService() {, +        return this.nodeService;, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java, +    private ImmutableMap<String, String> serviceAttributes;, +    public NodeInfo(DiscoveryNode node, ImmutableMap<String, String> serviceAttributes, Settings settings,, +        this.serviceAttributes = serviceAttributes;, +     * The service attributes of the node., +    public ImmutableMap<String, String> serviceAttributes() {, +        return this.serviceAttributes;, +    public ImmutableMap<String, String> getServiceAttributes() {, +        return serviceAttributes();, +        serviceAttributes = builder.build();, +        out.writeVInt(serviceAttributes.size());, +        for (Map.Entry<String, String> entry : serviceAttributes.entrySet()) {, +++ b/src/main/java/org/elasticsearch/discovery/zen/DiscoveryNodesProvider.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.node.service.NodeService;, +, +    @Nullable, +    NodeService nodeService();, +++ b/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java, +import org.elasticsearch.common.inject.internal.Nullable;, +import org.elasticsearch.node.service.NodeService;, +    @Nullable, +    private NodeService nodeService;, +, +    public void setNodeService(@Nullable NodeService nodeService) {, +        this.nodeService = nodeService;, +    }, +, +    public NodeService nodeService() {, +        return this.nodeService;, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/discovery/zen/ping/multicast/MulticastZenPing.java, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.common.xcontent.XContentFactory;, +import org.elasticsearch.common.xcontent.XContentType;]