[+++ b/core/src/main/java/org/elasticsearch/http/netty/cors/CorsHandler.java, +import org.elasticsearch.rest.support.RestUtils;, +import static org.jboss.netty.handler.codec.http.HttpHeaders.Names.USER_AGENT;, +, +            if (RestUtils.isBrowser(request.headers().get(USER_AGENT))) {, +        }, +            } else if (config.isOriginAllowed(originHeader)) {, +++ b/core/src/main/java/org/elasticsearch/http/netty/cors/CorsHandler.java, +import org.elasticsearch.rest.support.RestUtils;, +import static org.jboss.netty.handler.codec.http.HttpHeaders.Names.USER_AGENT;, +, +            if (RestUtils.isBrowser(request.headers().get(USER_AGENT))) {, +        }, +            } else if (config.isOriginAllowed(originHeader)) {, +++ b/core/src/main/java/org/elasticsearch/rest/support/RestUtils.java, +    public static boolean isBrowser(@Nullable String userAgent) {, +        if (userAgent == null) {, +            return false;, +        }, +        // chrome, safari, firefox, ie, +        if (userAgent.startsWith("Mozilla")) {, +            return true;, +        }, +        return false;, +    }, +, +++ b/core/src/main/java/org/elasticsearch/http/netty/cors/CorsHandler.java, +import org.elasticsearch.rest.support.RestUtils;, +import static org.jboss.netty.handler.codec.http.HttpHeaders.Names.USER_AGENT;, +, +            if (RestUtils.isBrowser(request.headers().get(USER_AGENT))) {, +        }, +            } else if (config.isOriginAllowed(originHeader)) {, +++ b/core/src/main/java/org/elasticsearch/rest/support/RestUtils.java, +    public static boolean isBrowser(@Nullable String userAgent) {, +        if (userAgent == null) {, +            return false;, +        }, +        // chrome, safari, firefox, ie, +        if (userAgent.startsWith("Mozilla")) {, +            return true;, +        }, +        return false;, +    }, +, +++ b/core/src/main/java/org/elasticsearch/script/ExecutableScript.java, +    /**, +     * Sets a runtime script parameter., +     * <p>, +     * Note that this method may be slow, involving put() and get() calls, +     * to a hashmap or similar., +     * @param name parameter name, +     * @param value parameter value, +     */, +++ b/core/src/main/java/org/elasticsearch/http/netty/cors/CorsHandler.java, +import org.elasticsearch.rest.support.RestUtils;, +import static org.jboss.netty.handler.codec.http.HttpHeaders.Names.USER_AGENT;, +, +            if (RestUtils.isBrowser(request.headers().get(USER_AGENT))) {, +        }, +            } else if (config.isOriginAllowed(originHeader)) {, +++ b/core/src/main/java/org/elasticsearch/rest/support/RestUtils.java, +    public static boolean isBrowser(@Nullable String userAgent) {, +        if (userAgent == null) {, +            return false;, +        }, +        // chrome, safari, firefox, ie, +        if (userAgent.startsWith("Mozilla")) {, +            return true;, +        }, +        return false;, +    }, +, +++ b/core/src/main/java/org/elasticsearch/script/ExecutableScript.java, +    /**, +     * Sets a runtime script parameter., +     * <p>, +     * Note that this method may be slow, involving put() and get() calls, +     * to a hashmap or similar., +     * @param name parameter name, +     * @param value parameter value, +     */, +++ b/core/src/main/java/org/elasticsearch/script/LeafSearchScript.java, +    , +    /**, +     * Sets per-document aggregation {@code _value}., +     * <p>, +     * The default implementation just calls {@code setNextVar("_value", value)} but, +     * some engines might want to handle this differently for better performance., +     * <p>, +     * @param value per-document value, typically a String, Long, or Double, +     */, +    default void setNextAggregationValue(Object value) {, +        setNextVar("_value", value);, +    }, +++ b/core/src/main/java/org/elasticsearch/http/netty/cors/CorsHandler.java, +import org.elasticsearch.rest.support.RestUtils;, +import static org.jboss.netty.handler.codec.http.HttpHeaders.Names.USER_AGENT;, +, +            if (RestUtils.isBrowser(request.headers().get(USER_AGENT))) {]