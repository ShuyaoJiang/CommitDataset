[+++ b/core/src/main/java/org/elasticsearch/index/IndexService.java, +    private final IndexServicesProvider indexServicesProvider;, +    private final IndexStore indexStore;, +    public IndexService(Index index, @IndexSettings Settings indexSettings, NodeEnvironment nodeEnv,, +                        AnalysisService analysisService,, +                        IndexFieldDataService indexFieldData,, +                        BitsetFilterCache bitSetFilterCache,, +                        IndicesService indicesServices,, +                        IndexServicesProvider indexServicesProvider,, +                        IndexStore indexStore) {, +        this.indicesLifecycle = (InternalIndicesLifecycle) indexServicesProvider.getIndicesLifecycle();, +        this.nodeEnv = nodeEnv;, +        this.indexServicesProvider = indexServicesProvider;, +        this.indexStore = indexStore;, +        return indexServicesProvider.getIndexCache();, +        return indexServicesProvider.getMapperService();, +        return indexServicesProvider.getQueryParserService();, +        return indexServicesProvider.getSimilarityService();, +        return indexServicesProvider.getIndexAliasesService();, +            store = new Store(shardId, indexSettings, indexStore.newDirectoryService(path), lock, new StoreCloseListener(shardId, canDeleteShardContent, () -> indexServicesProvider.getIndicesQueryCache().onClose(shardId)));, +                indexShard = new ShadowIndexShard(shardId, indexSettings, path, store, indexServicesProvider);, +                indexShard = new IndexShard(shardId, indexSettings, path, store, indexServicesProvider);, +    public IndexServicesProvider getIndexServices() {, +        return indexServicesProvider;, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/IndexService.java, +    private final IndexServicesProvider indexServicesProvider;, +    private final IndexStore indexStore;, +    public IndexService(Index index, @IndexSettings Settings indexSettings, NodeEnvironment nodeEnv,, +                        AnalysisService analysisService,, +                        IndexFieldDataService indexFieldData,, +                        BitsetFilterCache bitSetFilterCache,, +                        IndicesService indicesServices,, +                        IndexServicesProvider indexServicesProvider,, +                        IndexStore indexStore) {, +        this.indicesLifecycle = (InternalIndicesLifecycle) indexServicesProvider.getIndicesLifecycle();, +        this.nodeEnv = nodeEnv;, +        this.indexServicesProvider = indexServicesProvider;, +        this.indexStore = indexStore;, +        return indexServicesProvider.getIndexCache();, +        return indexServicesProvider.getMapperService();, +        return indexServicesProvider.getQueryParserService();, +        return indexServicesProvider.getSimilarityService();, +        return indexServicesProvider.getIndexAliasesService();, +            store = new Store(shardId, indexSettings, indexStore.newDirectoryService(path), lock, new StoreCloseListener(shardId, canDeleteShardContent, () -> indexServicesProvider.getIndicesQueryCache().onClose(shardId)));, +                indexShard = new ShadowIndexShard(shardId, indexSettings, path, store, indexServicesProvider);, +                indexShard = new IndexShard(shardId, indexSettings, path, store, indexServicesProvider);, +    public IndexServicesProvider getIndexServices() {, +        return indexServicesProvider;, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/IndexServicesProvider.java, +++ b/core/src/main/java/org/elasticsearch/index/IndexService.java, +    private final IndexServicesProvider indexServicesProvider;, +    private final IndexStore indexStore;, +    public IndexService(Index index, @IndexSettings Settings indexSettings, NodeEnvironment nodeEnv,, +                        AnalysisService analysisService,, +                        IndexFieldDataService indexFieldData,, +                        BitsetFilterCache bitSetFilterCache,, +                        IndicesService indicesServices,, +                        IndexServicesProvider indexServicesProvider,, +                        IndexStore indexStore) {, +        this.indicesLifecycle = (InternalIndicesLifecycle) indexServicesProvider.getIndicesLifecycle();, +        this.nodeEnv = nodeEnv;, +        this.indexServicesProvider = indexServicesProvider;, +        this.indexStore = indexStore;, +        return indexServicesProvider.getIndexCache();, +        return indexServicesProvider.getMapperService();, +        return indexServicesProvider.getQueryParserService();, +        return indexServicesProvider.getSimilarityService();, +        return indexServicesProvider.getIndexAliasesService();, +            store = new Store(shardId, indexSettings, indexStore.newDirectoryService(path), lock, new StoreCloseListener(shardId, canDeleteShardContent, () -> indexServicesProvider.getIndicesQueryCache().onClose(shardId)));, +                indexShard = new ShadowIndexShard(shardId, indexSettings, path, store, indexServicesProvider);, +                indexShard = new IndexShard(shardId, indexSettings, path, store, indexServicesProvider);, +    public IndexServicesProvider getIndexServices() {, +        return indexServicesProvider;, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/IndexServicesProvider.java, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +++ b/core/src/main/java/org/elasticsearch/index/IndexService.java, +    private final IndexServicesProvider indexServicesProvider;, +    private final IndexStore indexStore;, +    public IndexService(Index index, @IndexSettings Settings indexSettings, NodeEnvironment nodeEnv,, +                        AnalysisService analysisService,, +                        IndexFieldDataService indexFieldData,, +                        BitsetFilterCache bitSetFilterCache,, +                        IndicesService indicesServices,, +                        IndexServicesProvider indexServicesProvider,, +                        IndexStore indexStore) {, +        this.indicesLifecycle = (InternalIndicesLifecycle) indexServicesProvider.getIndicesLifecycle();, +        this.nodeEnv = nodeEnv;, +        this.indexServicesProvider = indexServicesProvider;, +        this.indexStore = indexStore;, +        return indexServicesProvider.getIndexCache();, +        return indexServicesProvider.getMapperService();, +        return indexServicesProvider.getQueryParserService();, +        return indexServicesProvider.getSimilarityService();, +        return indexServicesProvider.getIndexAliasesService();]