[+++ b/core/src/main/java/org/elasticsearch/common/network/NetworkModule.java, +import java.util.List;, +import java.util.concurrent.CopyOnWriteArrayList;, +, +    private final List<NetworkService.CustomNameResolver> customNameResolvers = new CopyOnWriteArrayList<>();, +, +    /**, +     * Add a custom name resolver., +     */, +    public void addCustomNameResolver(NetworkService.CustomNameResolver customNameResolver) {, +        customNameResolvers.add(customNameResolver);, +    }, +, +        networkService.setCustomNameResolvers(customNameResolvers);, +++ b/core/src/main/java/org/elasticsearch/common/network/NetworkModule.java, +import java.util.List;, +import java.util.concurrent.CopyOnWriteArrayList;, +, +    private final List<NetworkService.CustomNameResolver> customNameResolvers = new CopyOnWriteArrayList<>();, +, +    /**, +     * Add a custom name resolver., +     */, +    public void addCustomNameResolver(NetworkService.CustomNameResolver customNameResolver) {, +        customNameResolvers.add(customNameResolver);, +    }, +, +        networkService.setCustomNameResolvers(customNameResolvers);, +++ b/core/src/main/java/org/elasticsearch/common/network/NetworkService.java, +    private  List<CustomNameResolver> customNameResolvers;, +    public void setCustomNameResolvers(List<CustomNameResolver> customNameResolvers) {, +        this.customNameResolvers = customNameResolvers;, +                // next check any registered custom resolvers if any, +                if (customNameResolvers != null) {, +                }, +                // next check any registered custom resolvers if any, +                if (customNameResolvers != null) {, +                }, +            // next check any registered custom resolvers if any, +            if (customNameResolvers != null) {, +            }, +++ b/core/src/main/java/org/elasticsearch/common/network/NetworkModule.java, +import java.util.List;, +import java.util.concurrent.CopyOnWriteArrayList;, +, +    private final List<NetworkService.CustomNameResolver> customNameResolvers = new CopyOnWriteArrayList<>();, +, +    /**, +     * Add a custom name resolver., +     */, +    public void addCustomNameResolver(NetworkService.CustomNameResolver customNameResolver) {, +        customNameResolvers.add(customNameResolver);, +    }, +, +        networkService.setCustomNameResolvers(customNameResolvers);, +++ b/core/src/main/java/org/elasticsearch/common/network/NetworkService.java, +    private  List<CustomNameResolver> customNameResolvers;, +    public void setCustomNameResolvers(List<CustomNameResolver> customNameResolvers) {, +        this.customNameResolvers = customNameResolvers;, +                // next check any registered custom resolvers if any, +                if (customNameResolvers != null) {, +                }, +                // next check any registered custom resolvers if any, +                if (customNameResolvers != null) {, +                }, +            // next check any registered custom resolvers if any, +            if (customNameResolvers != null) {, +            }, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java, +    public AwsEc2ServiceImpl(Settings settings) {, +++ b/core/src/main/java/org/elasticsearch/common/network/NetworkModule.java, +import java.util.List;, +import java.util.concurrent.CopyOnWriteArrayList;, +, +    private final List<NetworkService.CustomNameResolver> customNameResolvers = new CopyOnWriteArrayList<>();, +, +    /**, +     * Add a custom name resolver., +     */, +    public void addCustomNameResolver(NetworkService.CustomNameResolver customNameResolver) {, +        customNameResolvers.add(customNameResolver);, +    }, +, +        networkService.setCustomNameResolvers(customNameResolvers);, +++ b/core/src/main/java/org/elasticsearch/common/network/NetworkService.java, +    private  List<CustomNameResolver> customNameResolvers;, +    public void setCustomNameResolvers(List<CustomNameResolver> customNameResolvers) {, +        this.customNameResolvers = customNameResolvers;, +                // next check any registered custom resolvers if any, +                if (customNameResolvers != null) {, +                }, +                // next check any registered custom resolvers if any, +                if (customNameResolvers != null) {, +                }, +            // next check any registered custom resolvers if any, +            if (customNameResolvers != null) {, +            }, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java, +    public AwsEc2ServiceImpl(Settings settings) {, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java]