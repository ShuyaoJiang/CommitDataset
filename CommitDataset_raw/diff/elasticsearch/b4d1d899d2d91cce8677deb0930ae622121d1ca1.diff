[+++ b/src/main/java/org/elasticsearch/index/percolator/PercolatorQueriesRegistry.java, +import java.util.concurrent.atomic.AtomicBoolean;, +    private final AtomicBoolean realTimePercolatorEnabled = new AtomicBoolean(false);, +    void enableRealTimePercolator() {, +        if (realTimePercolatorEnabled.compareAndSet(false, true)) {, +    void disableRealTimePercolator() {, +        if (realTimePercolatorEnabled.compareAndSet(true, false)) {, +++ b/src/main/java/org/elasticsearch/index/percolator/PercolatorQueriesRegistry.java, +import java.util.concurrent.atomic.AtomicBoolean;, +    private final AtomicBoolean realTimePercolatorEnabled = new AtomicBoolean(false);, +    void enableRealTimePercolator() {, +        if (realTimePercolatorEnabled.compareAndSet(false, true)) {, +    void disableRealTimePercolator() {, +        if (realTimePercolatorEnabled.compareAndSet(true, false)) {, +++ b/src/test/java/org/elasticsearch/percolator/PercolatorTests.java]