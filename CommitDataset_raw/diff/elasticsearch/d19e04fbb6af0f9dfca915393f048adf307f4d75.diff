[+++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                org.elasticsearch.index.engine.ForceMergeFailedEngineException.class,, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                org.elasticsearch.index.engine.ForceMergeFailedEngineException.class,, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +    protected EmptyResult shardOperation(OptimizeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                org.elasticsearch.index.engine.ForceMergeFailedEngineException.class,, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +    protected EmptyResult shardOperation(OptimizeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeAction.java, +    protected ShardUpgradeResult shardOperation(UpgradeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                org.elasticsearch.index.engine.ForceMergeFailedEngineException.class,, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +    protected EmptyResult shardOperation(OptimizeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeAction.java, +    protected ShardUpgradeResult shardOperation(UpgradeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/support/TransportActions.java, +                actual instanceof UnavailableShardsException) {, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                org.elasticsearch.index.engine.ForceMergeFailedEngineException.class,, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +    protected EmptyResult shardOperation(OptimizeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeAction.java, +    protected ShardUpgradeResult shardOperation(UpgradeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/support/TransportActions.java, +                actual instanceof UnavailableShardsException) {, +++ b/core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java, +    protected abstract ShardOperationResult shardOperation(Request request, ShardRouting shardRouting);, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                org.elasticsearch.index.engine.ForceMergeFailedEngineException.class,, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +    protected EmptyResult shardOperation(OptimizeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeAction.java, +    protected ShardUpgradeResult shardOperation(UpgradeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/support/TransportActions.java, +                actual instanceof UnavailableShardsException) {, +++ b/core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java, +    protected abstract ShardOperationResult shardOperation(Request request, ShardRouting shardRouting);, +++ b/core/src/main/java/org/elasticsearch/action/support/single/shard/TransportSingleShardAction.java, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                org.elasticsearch.index.engine.ForceMergeFailedEngineException.class,, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +    protected EmptyResult shardOperation(OptimizeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeAction.java, +    protected ShardUpgradeResult shardOperation(UpgradeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/support/TransportActions.java, +                actual instanceof UnavailableShardsException) {, +++ b/core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java, +    protected abstract ShardOperationResult shardOperation(Request request, ShardRouting shardRouting);, +++ b/core/src/main/java/org/elasticsearch/action/support/single/shard/TransportSingleShardAction.java, +++ b/core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +    private static Environment initialSettings(boolean foreground) {, +        return InternalSettingsPreparer.prepareEnvironment(EMPTY_SETTINGS, terminal);, +        Environment environment = initialSettings(foreground);, +        Settings settings = environment.settings();, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                org.elasticsearch.index.engine.ForceMergeFailedEngineException.class,, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +    protected EmptyResult shardOperation(OptimizeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeAction.java, +    protected ShardUpgradeResult shardOperation(UpgradeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/support/TransportActions.java, +                actual instanceof UnavailableShardsException) {, +++ b/core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java, +    protected abstract ShardOperationResult shardOperation(Request request, ShardRouting shardRouting);, +++ b/core/src/main/java/org/elasticsearch/action/support/single/shard/TransportSingleShardAction.java, +++ b/core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +    private static Environment initialSettings(boolean foreground) {, +        return InternalSettingsPreparer.prepareEnvironment(EMPTY_SETTINGS, terminal);, +        Environment environment = initialSettings(foreground);, +        Settings settings = environment.settings();, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClient.java, +            Settings settings = InternalSettingsPreparer.prepareSettings(this.settings);, +            settings = settingsBuilder(), +                    .put(settings), +            PluginsService pluginsService = new PluginsService(settings, null, pluginClasses);, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                org.elasticsearch.index.engine.ForceMergeFailedEngineException.class,, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +    protected EmptyResult shardOperation(OptimizeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeAction.java, +    protected ShardUpgradeResult shardOperation(UpgradeRequest request, ShardRouting shardRouting) {, +++ b/core/src/main/java/org/elasticsearch/action/support/TransportActions.java, +                actual instanceof UnavailableShardsException) {, +++ b/core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java, +    protected abstract ShardOperationResult shardOperation(Request request, ShardRouting shardRouting);, +++ b/core/src/main/java/org/elasticsearch/action/support/single/shard/TransportSingleShardAction.java, +++ b/core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +    private static Environment initialSettings(boolean foreground) {, +        return InternalSettingsPreparer.prepareEnvironment(EMPTY_SETTINGS, terminal);, +        Environment environment = initialSettings(foreground);, +        Settings settings = environment.settings();, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClient.java, +            Settings settings = InternalSettingsPreparer.prepareSettings(this.settings);, +            settings = settingsBuilder(), +                    .put(settings), +            PluginsService pluginsService = new PluginsService(settings, null, pluginClasses);, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java]