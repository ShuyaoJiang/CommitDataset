[+++ b/plugins/repository-hdfs/src/main/java/org/elasticsearch/plugin/hadoop/hdfs/HdfsPlugin.java, +import java.security.AccessController;, +import java.security.PrivilegedAction;, +, +import org.elasticsearch.SpecialPermission;, +    // initialize some problematic classes with elevated privileges, +    static {, +      SecurityManager sm = System.getSecurityManager();, +      if (sm != null) {, +          sm.checkPermission(new SpecialPermission());, +      }, +      AccessController.doPrivileged(new PrivilegedAction<Void>() {, +          @Override, +          public Void run() {, +              try {, +                  Class.forName("org.apache.hadoop.security.UserGroupInformation");, +                  Class.forName("org.apache.hadoop.util.StringUtils");, +                  Class.forName("org.apache.hadoop.util.ShutdownHookManager");, +              } catch (ClassNotFoundException e) {, +                  throw new RuntimeException(e);, +              }, +              return null;, +          }, +      });, +    }, +, +++ b/plugins/repository-hdfs/src/main/java/org/elasticsearch/plugin/hadoop/hdfs/HdfsPlugin.java, +import java.security.AccessController;, +import java.security.PrivilegedAction;, +, +import org.elasticsearch.SpecialPermission;, +    // initialize some problematic classes with elevated privileges, +    static {, +      SecurityManager sm = System.getSecurityManager();, +      if (sm != null) {, +          sm.checkPermission(new SpecialPermission());, +      }, +      AccessController.doPrivileged(new PrivilegedAction<Void>() {, +          @Override, +          public Void run() {, +              try {, +                  Class.forName("org.apache.hadoop.security.UserGroupInformation");, +                  Class.forName("org.apache.hadoop.util.StringUtils");, +                  Class.forName("org.apache.hadoop.util.ShutdownHookManager");, +              } catch (ClassNotFoundException e) {, +                  throw new RuntimeException(e);, +              }, +              return null;, +          }, +      });, +    }, +, +++ b/plugins/repository-hdfs/src/main/plugin-metadata/plugin-security.policy, +  // UserGroupInformation (UGI) Metrics clinit, +  // org.apache.hadoop.util.StringUtils clinit, +  // org.apache.hadoop.util.ShutdownHookManager clinit, +  permission java.lang.RuntimePermission "shutdownHooks";, +  ]