[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/controller/SearchPhaseController.java, +import org.elasticsearch.common.collect.Ordering;, +import javax.annotation.Nullable;, +    public static Ordering<QuerySearchResultProvider> QUERY_RESULT_ORDERING = new Ordering<QuerySearchResultProvider>() {, +        @Override public int compare(@Nullable QuerySearchResultProvider o1, @Nullable QuerySearchResultProvider o2) {, +            int i = o1.shardTarget().index().compareTo(o2.shardTarget().index());, +            if (i == 0) {, +                i = o1.shardTarget().shardId() - o2.shardTarget().shardId();, +            }, +            return i;, +        }, +    };, +, +    public ShardDoc[] sortDocs(Collection<? extends QuerySearchResultProvider> results1) {, +        if (results1.isEmpty()) {, +        List<? extends QuerySearchResultProvider> results = QUERY_RESULT_ORDERING.sortedCopy(results1);, +, +        QuerySearchResultProvider queryResultProvider = results.get(0);]