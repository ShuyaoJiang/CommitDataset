[+++ b/Vagrantfile, +    ubuntu_common config, extra: <<-SHELL, +      # Install Jayatana so we can work around it being present., +      [ -f /usr/share/java/jayatanaag.jar ] || install jayatana, +    SHELL, +def ubuntu_common(config, extra: ''), +  deb_common config, 'apt-add-repository -y ppa:openjdk-r/ppa > /dev/null 2>&1', 'openjdk-r-*', extra: extra, +def deb_common(config, add_openjdk_repository_command, openjdk_list, extra: ''), +      #{extra}, +++ b/Vagrantfile, +    ubuntu_common config, extra: <<-SHELL, +      # Install Jayatana so we can work around it being present., +      [ -f /usr/share/java/jayatanaag.jar ] || install jayatana, +    SHELL, +def ubuntu_common(config, extra: ''), +  deb_common config, 'apt-add-repository -y ppa:openjdk-r/ppa > /dev/null 2>&1', 'openjdk-r-*', extra: extra, +def deb_common(config, add_openjdk_repository_command, openjdk_list, extra: ''), +      #{extra}, +++ b/core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +            LogConfigurator.configure(settings, true);, +        setupLogging(settings, environment);, +        checkForCustomConfFile();, +, +    private static void checkForCustomConfFile() {, +        String confFileSetting = System.getProperty("es.default.config");, +        checkUnsetAndMaybeExit(confFileSetting, "es.default.config");, +        confFileSetting = System.getProperty("es.config");, +        checkUnsetAndMaybeExit(confFileSetting, "es.config");, +        confFileSetting = System.getProperty("elasticsearch.config");, +        checkUnsetAndMaybeExit(confFileSetting, "elasticsearch.config");, +    }, +, +    private static void checkUnsetAndMaybeExit(String confFileSetting, String settingName) {, +        if (confFileSetting != null && confFileSetting.isEmpty() == false) {, +            ESLogger logger = Loggers.getLogger(Bootstrap.class);, +            logger.info("{} is no longer supported. elasticsearch.yml must be placed in the config directory and cannot be renamed.", settingName);, +            System.exit(1);, +        }, +    }, +++ b/Vagrantfile, +    ubuntu_common config, extra: <<-SHELL, +      # Install Jayatana so we can work around it being present., +      [ -f /usr/share/java/jayatanaag.jar ] || install jayatana, +    SHELL, +def ubuntu_common(config, extra: ''), +  deb_common config, 'apt-add-repository -y ppa:openjdk-r/ppa > /dev/null 2>&1', 'openjdk-r-*', extra: extra, +def deb_common(config, add_openjdk_repository_command, openjdk_list, extra: ''), +      #{extra}, +++ b/core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +            LogConfigurator.configure(settings, true);, +        setupLogging(settings, environment);, +        checkForCustomConfFile();, +, +    private static void checkForCustomConfFile() {, +        String confFileSetting = System.getProperty("es.default.config");, +        checkUnsetAndMaybeExit(confFileSetting, "es.default.config");, +        confFileSetting = System.getProperty("es.config");, +        checkUnsetAndMaybeExit(confFileSetting, "es.config");, +        confFileSetting = System.getProperty("elasticsearch.config");, +        checkUnsetAndMaybeExit(confFileSetting, "elasticsearch.config");, +    }, +, +    private static void checkUnsetAndMaybeExit(String confFileSetting, String settingName) {, +        if (confFileSetting != null && confFileSetting.isEmpty() == false) {, +            ESLogger logger = Loggers.getLogger(Bootstrap.class);, +            logger.info("{} is no longer supported. elasticsearch.yml must be placed in the config directory and cannot be renamed.", settingName);, +            System.exit(1);, +        }, +    }, +++ b/core/src/main/java/org/elasticsearch/common/logging/log4j/LogConfigurator.java, +            .put("terminal", "org.elasticsearch.common.logging.log4j.TerminalAppender"), +    /**, +     * Consolidates settings and converts them into actual log4j settings, then initializes loggers and appenders., +     *, +     * @param settings      custom settings that should be applied, +     * @param resolveConfig controls whether the logging conf file should be read too or not., +     */, +    public static void configure(Settings settings, boolean resolveConfig) {, +, +        if (resolveConfig) {, +        }, +++ b/Vagrantfile, +    ubuntu_common config, extra: <<-SHELL, +      # Install Jayatana so we can work around it being present., +      [ -f /usr/share/java/jayatanaag.jar ] || install jayatana, +    SHELL, +def ubuntu_common(config, extra: ''), +  deb_common config, 'apt-add-repository -y ppa:openjdk-r/ppa > /dev/null 2>&1', 'openjdk-r-*', extra: extra, +def deb_common(config, add_openjdk_repository_command, openjdk_list, extra: ''), +      #{extra}, +++ b/core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +            LogConfigurator.configure(settings, true);, +        setupLogging(settings, environment);, +        checkForCustomConfFile();, +, +    private static void checkForCustomConfFile() {, +        String confFileSetting = System.getProperty("es.default.config");, +        checkUnsetAndMaybeExit(confFileSetting, "es.default.config");, +        confFileSetting = System.getProperty("es.config");, +        checkUnsetAndMaybeExit(confFileSetting, "es.config");]