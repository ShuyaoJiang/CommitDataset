[+++ b/server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +                            MappingMetaData mappingMd = indexMetaData.mappingOrDefault();, +++ b/server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +                            MappingMetaData mappingMd = indexMetaData.mappingOrDefault();, +++ b/server/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                    MappingMetaData mappingMd = metaData.mappingOrDefault();, +++ b/server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +                            MappingMetaData mappingMd = indexMetaData.mappingOrDefault();, +++ b/server/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                    MappingMetaData mappingMd = metaData.mappingOrDefault();, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java, +    public MappingMetaData mappingOrDefault() {, +        MappingMetaData mapping = null;, +        for (ObjectCursor<MappingMetaData> m : mappings.values()) {, +            if (mapping == null || mapping.type().equals(MapperService.DEFAULT_MAPPING)) {, +                mapping = m.value;, +        }, +, +        return mapping;, +++ b/server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +                            MappingMetaData mappingMd = indexMetaData.mappingOrDefault();, +++ b/server/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +                    MappingMetaData mappingMd = metaData.mappingOrDefault();, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java, +    public MappingMetaData mappingOrDefault() {, +        MappingMetaData mapping = null;, +        for (ObjectCursor<MappingMetaData> m : mappings.values()) {, +            if (mapping == null || mapping.type().equals(MapperService.DEFAULT_MAPPING)) {, +                mapping = m.value;, +        }, +, +        return mapping;, +++ b/server/src/test/java/org/elasticsearch/cluster/metadata/IndexMetaDataTests.java, +import org.elasticsearch.Version;, +import org.elasticsearch.index.mapper.MapperService;, +, +    public void testMappingOrDefault() throws IOException {, +        Settings settings = Settings.builder(), +                .put(IndexMetaData.SETTING_VERSION_CREATED, Version.CURRENT), +                .put(IndexMetaData.SETTING_NUMBER_OF_SHARDS, 2), +                .put(IndexMetaData.SETTING_NUMBER_OF_REPLICAS, 1), +                .build();, +        IndexMetaData meta = IndexMetaData.builder("index"), +                .settings(settings), +                .build();, +        assertNull(meta.mappingOrDefault());, +, +        meta = IndexMetaData.builder("index"), +                .settings(settings), +                .putMapping("type", "{}"), +                .build();, +        assertNotNull(meta.mappingOrDefault());, +        assertEquals("type", meta.mappingOrDefault().type());, +, +        meta = IndexMetaData.builder("index"), +                .settings(settings), +                .putMapping(MapperService.DEFAULT_MAPPING, "{}"), +                .build();, +        assertNotNull(meta.mappingOrDefault());, +        assertEquals(MapperService.DEFAULT_MAPPING, meta.mappingOrDefault().type());, +, +        meta = IndexMetaData.builder("index"), +                .settings(settings), +                .putMapping("type", "{}"), +                .putMapping(MapperService.DEFAULT_MAPPING, "{}"), +                .build();, +        assertNotNull(meta.mappingOrDefault());, +        assertEquals("type", meta.mappingOrDefault().type());, +    }]