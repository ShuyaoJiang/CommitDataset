[+++ b/test/framework/src/main/java/org/elasticsearch/test/rest/ObjectPath.java, +import org.elasticsearch.common.xcontent.XContent;, +    public static ObjectPath createFromXContent(XContent xContent, String input) throws IOException {, +        try (XContentParser parser = xContent.createParser(input)) {, +++ b/test/framework/src/main/java/org/elasticsearch/test/rest/ObjectPath.java, +import org.elasticsearch.common.xcontent.XContent;, +    public static ObjectPath createFromXContent(XContent xContent, String input) throws IOException {, +        try (XContentParser parser = xContent.createParser(input)) {, +++ b/test/framework/src/main/java/org/elasticsearch/test/rest/client/RestTestResponse.java, +import org.elasticsearch.common.xcontent.XContentType;, +    public RestTestResponse(Response response) throws IOException {, +        parseResponseBody();, +    public RestTestResponse(ResponseException responseException) throws IOException {, +        parseResponseBody();, +    }, +, +    private void parseResponseBody() throws IOException {, +        if (body != null) {, +            String contentType = response.getHeader("Content-Type");, +            XContentType xContentType = XContentType.fromMediaTypeOrFormat(contentType);, +            //skip parsing if we got text back (e.g. if we called _cat apis), +            if (xContentType == XContentType.JSON) {, +                this.parsedResponse = ObjectPath.createFromXContent(xContentType.xContent(), body);, +            }, +        }, +        if (parsedResponse != null) {, +        if (parsedResponse == null) {, +        return parsedResponse.evaluate(path, stash);, +++ b/test/framework/src/main/java/org/elasticsearch/test/rest/ObjectPath.java, +import org.elasticsearch.common.xcontent.XContent;, +    public static ObjectPath createFromXContent(XContent xContent, String input) throws IOException {, +        try (XContentParser parser = xContent.createParser(input)) {, +++ b/test/framework/src/main/java/org/elasticsearch/test/rest/client/RestTestResponse.java, +import org.elasticsearch.common.xcontent.XContentType;, +    public RestTestResponse(Response response) throws IOException {, +        parseResponseBody();, +    public RestTestResponse(ResponseException responseException) throws IOException {, +        parseResponseBody();, +    }, +, +    private void parseResponseBody() throws IOException {, +        if (body != null) {, +            String contentType = response.getHeader("Content-Type");, +            XContentType xContentType = XContentType.fromMediaTypeOrFormat(contentType);, +            //skip parsing if we got text back (e.g. if we called _cat apis), +            if (xContentType == XContentType.JSON) {, +                this.parsedResponse = ObjectPath.createFromXContent(xContentType.xContent(), body);, +            }, +        }, +        if (parsedResponse != null) {, +        if (parsedResponse == null) {, +        return parsedResponse.evaluate(path, stash);, +++ b/test/framework/src/test/java/org/elasticsearch/test/rest/test/ObjectPathTests.java, +        ObjectPath objectPath = ObjectPath.createFromXContent(xContentBuilder.contentType().xContent(), xContentBuilder.string());, +        ObjectPath objectPath = ObjectPath.createFromXContent(xContentBuilder.contentType().xContent(), xContentBuilder.string());, +        ObjectPath objectPath = ObjectPath.createFromXContent(xContentBuilder.contentType().xContent(), xContentBuilder.string());, +        ObjectPath objectPath = ObjectPath.createFromXContent(xContentBuilder.contentType().xContent(), xContentBuilder.string());, +        ObjectPath objectPath = ObjectPath.createFromXContent(xContentBuilder.contentType().xContent(), xContentBuilder.string());, +        ObjectPath objectPath = ObjectPath.createFromXContent(xContentBuilder.contentType().xContent(), xContentBuilder.string());, +        ObjectPath objectPath = ObjectPath.createFromXContent(xContentBuilder.contentType().xContent(), xContentBuilder.string());, +        ObjectPath objectPath = ObjectPath.createFromXContent(xContentBuilder.contentType().xContent(), xContentBuilder.string());, +        XContentBuilder xContentBuilder = randomXContentBuilder();, +        xContentBuilder.startArray();, +        xContentBuilder.startObject();, +        xContentBuilder.field("alias", "test_alias1");, +        xContentBuilder.field("index", "test1");, +        xContentBuilder.endObject();, +        xContentBuilder.startObject();, +        xContentBuilder.field("alias", "test_alias2");, +        xContentBuilder.field("index", "test2");, +        xContentBuilder.endObject();, +        xContentBuilder.endArray();, +        ObjectPath objectPath = ObjectPath.createFromXContent(XContentFactory.xContent(XContentType.YAML), xContentBuilder.string());]