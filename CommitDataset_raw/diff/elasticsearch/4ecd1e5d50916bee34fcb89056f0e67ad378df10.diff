[+++ b/plugin/src/test/java/org/elasticsearch/xpack/monitoring/test/MockPainlessScriptEngine.java, +    public <T> T compile(String name, String script, ScriptContext<T> context, Map<String, String> options) {, +        MockCompiledScript compiledScript = new MockCompiledScript(name, options, script, p -> script);, +            return context.factoryClazz.cast((ExecutableScript.Factory) compiledScript::createExecutableScript);, +            return context.factoryClazz.cast((SearchScript.Factory) compiledScript::createSearchScript);]