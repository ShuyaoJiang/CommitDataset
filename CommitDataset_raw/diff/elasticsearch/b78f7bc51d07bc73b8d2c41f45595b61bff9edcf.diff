[+++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +                translog = openTranslog(engineConfig, writer, () -> seqNoService().getGlobalCheckpoint());, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +                translog = openTranslog(engineConfig, writer, () -> seqNoService().getGlobalCheckpoint());, +++ b/core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java, +import static org.elasticsearch.index.engine.Engine.Operation.Origin.PEER_RECOVERY;, +                if (randomInt(10) < 3) {, +                    // only update rarely as we do it every doc, +                    replicaLocalCheckpoint = randomIntBetween(Math.toIntExact(replicaLocalCheckpoint), Math.toIntExact(primarySeqNo));, +                }, +            logger.info("localcheckpoint {}, global {}", replicaLocalCheckpoint, primarySeqNo);]