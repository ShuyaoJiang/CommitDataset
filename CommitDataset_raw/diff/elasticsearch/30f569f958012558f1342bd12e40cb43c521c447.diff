[+++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportShardMultiTermsVectorAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                                IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +                TermVectorsResponse termVectorsResponse = termVectorsService.getTermVectors(indexShard, termVectorsRequest);, +++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportShardMultiTermsVectorAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                                IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +                TermVectorsResponse termVectorsResponse = termVectorsService.getTermVectors(indexShard, termVectorsRequest);, +++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                      IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +, +        TermVectorsResponse response = termVectorsService.getTermVectors(indexShard, request);, +++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportShardMultiTermsVectorAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                                IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +                TermVectorsResponse termVectorsResponse = termVectorsService.getTermVectors(indexShard, termVectorsRequest);, +++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                      IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +, +        TermVectorsResponse response = termVectorsService.getTermVectors(indexShard, request);, +++ b/core/src/main/java/org/elasticsearch/index/NodeServicesProvider.java, +    public NodeServicesProvider(ThreadPool threadPool, IndicesQueryCache indicesQueryCache, @Nullable IndicesWarmer warmer, BigArrays bigArrays, Client client, ScriptService scriptService, IndicesQueriesRegistry indicesQueriesRegistry, IndicesFieldDataCache indicesFieldDataCache, CircuitBreakerService circuitBreakerService) {, +++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportShardMultiTermsVectorAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                                IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +                TermVectorsResponse termVectorsResponse = termVectorsService.getTermVectors(indexShard, termVectorsRequest);, +++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                      IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +, +        TermVectorsResponse response = termVectorsService.getTermVectors(indexShard, request);, +++ b/core/src/main/java/org/elasticsearch/index/NodeServicesProvider.java, +    public NodeServicesProvider(ThreadPool threadPool, IndicesQueryCache indicesQueryCache, @Nullable IndicesWarmer warmer, BigArrays bigArrays, Client client, ScriptService scriptService, IndicesQueriesRegistry indicesQueriesRegistry, IndicesFieldDataCache indicesFieldDataCache, CircuitBreakerService circuitBreakerService) {, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportShardMultiTermsVectorAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                                IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +                TermVectorsResponse termVectorsResponse = termVectorsService.getTermVectors(indexShard, termVectorsRequest);, +++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                      IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +, +        TermVectorsResponse response = termVectorsService.getTermVectors(indexShard, request);, +++ b/core/src/main/java/org/elasticsearch/index/NodeServicesProvider.java, +    public NodeServicesProvider(ThreadPool threadPool, IndicesQueryCache indicesQueryCache, @Nullable IndicesWarmer warmer, BigArrays bigArrays, Client client, ScriptService scriptService, IndicesQueriesRegistry indicesQueriesRegistry, IndicesFieldDataCache indicesFieldDataCache, CircuitBreakerService circuitBreakerService) {, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +++ b/core/src/test/java/org/elasticsearch/index/IndexModuleTests.java, +        return new NodeServicesProvider(threadPool, indicesQueryCache, warmer, bigArrays, client, scriptService, indicesQueriesRegistry, indicesFieldDataCache, circuitBreakerService);, +++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportShardMultiTermsVectorAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                                IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +                TermVectorsResponse termVectorsResponse = termVectorsService.getTermVectors(indexShard, termVectorsRequest);, +++ b/core/src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +    private final TermVectorsService termVectorsService;, +                                      IndexNameExpressionResolver indexNameExpressionResolver, TermVectorsService termVectorsService) {, +        this.termVectorsService = termVectorsService;, +, +        TermVectorsResponse response = termVectorsService.getTermVectors(indexShard, request);, +++ b/core/src/main/java/org/elasticsearch/index/NodeServicesProvider.java, +    public NodeServicesProvider(ThreadPool threadPool, IndicesQueryCache indicesQueryCache, @Nullable IndicesWarmer warmer, BigArrays bigArrays, Client client, ScriptService scriptService, IndicesQueriesRegistry indicesQueriesRegistry, IndicesFieldDataCache indicesFieldDataCache, CircuitBreakerService circuitBreakerService) {, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +++ b/core/src/test/java/org/elasticsearch/index/IndexModuleTests.java, +        return new NodeServicesProvider(threadPool, indicesQueryCache, warmer, bigArrays, client, scriptService, indicesQueriesRegistry, indicesFieldDataCache, circuitBreakerService);, +++ b/core/src/test/java/org/elasticsearch/search/fetch/FetchSubPhasePluginIT.java, +import org.elasticsearch.index.termvectors.TermVectorsService;, +        private final TermVectorsService termVectorsService;, +        public TermVectorsFetchSubPhase(TermVectorsService termVectorsService) {, +            this.termVectorsService = termVectorsService;, +                hitContext.hit().fields(new HashMap<>());, +            TermVectorsResponse termVector =  termVectorsService.getTermVectors(context.indexShard(), new TermVectorsRequest(context.indexShard().shardId().getIndex().getName(), hitContext.hit().type(), hitContext.hit().id()));]