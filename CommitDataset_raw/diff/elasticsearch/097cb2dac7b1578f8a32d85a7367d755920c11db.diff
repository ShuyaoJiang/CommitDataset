[+++ b/src/main/java/org/elasticsearch/index/analysis/CharFilterFactory.java, +import java.io.Reader;, +    Reader create(Reader tokenStream);, +++ b/src/main/java/org/elasticsearch/index/analysis/CharFilterFactory.java, +import java.io.Reader;, +    Reader create(Reader tokenStream);, +++ b/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzer.java, +                reader = charFilter.create(reader);, +++ b/src/main/java/org/elasticsearch/index/analysis/CharFilterFactory.java, +import java.io.Reader;, +    Reader create(Reader tokenStream);, +++ b/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzer.java, +                reader = charFilter.create(reader);, +++ b/src/main/java/org/elasticsearch/index/analysis/HtmlStripCharFilterFactory.java, +import java.io.Reader;, +, +    public Reader create(Reader tokenStream) {, +++ b/src/main/java/org/elasticsearch/index/analysis/CharFilterFactory.java, +import java.io.Reader;, +    Reader create(Reader tokenStream);, +++ b/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzer.java, +                reader = charFilter.create(reader);, +++ b/src/main/java/org/elasticsearch/index/analysis/HtmlStripCharFilterFactory.java, +import java.io.Reader;, +, +    public Reader create(Reader tokenStream) {, +++ b/src/main/java/org/elasticsearch/index/analysis/MappingCharFilterFactory.java, +import org.apache.lucene.analysis.charfilter.MappingCharFilter;, +import org.apache.lucene.analysis.charfilter.NormalizeCharMap;, +import java.io.Reader;, +    private final NormalizeCharMap.Builder normMapBuilder;, +        normMapBuilder = new NormalizeCharMap.Builder();, +        parseRules(rules, normMapBuilder);, +    public Reader create(Reader tokenStream) {, +        return new MappingCharFilter(normMapBuilder.build(), tokenStream);, +    private void parseRules(List<String> rules, NormalizeCharMap.Builder map) {, +++ b/src/main/java/org/elasticsearch/index/analysis/CharFilterFactory.java, +import java.io.Reader;, +    Reader create(Reader tokenStream);, +++ b/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzer.java, +                reader = charFilter.create(reader);, +++ b/src/main/java/org/elasticsearch/index/analysis/HtmlStripCharFilterFactory.java, +import java.io.Reader;, +, +    public Reader create(Reader tokenStream) {, +++ b/src/main/java/org/elasticsearch/index/analysis/MappingCharFilterFactory.java, +import org.apache.lucene.analysis.charfilter.MappingCharFilter;, +import org.apache.lucene.analysis.charfilter.NormalizeCharMap;, +import java.io.Reader;, +    private final NormalizeCharMap.Builder normMapBuilder;, +        normMapBuilder = new NormalizeCharMap.Builder();, +        parseRules(rules, normMapBuilder);, +    public Reader create(Reader tokenStream) {, +        return new MappingCharFilter(normMapBuilder.build(), tokenStream);, +    private void parseRules(List<String> rules, NormalizeCharMap.Builder map) {, +++ b/src/main/java/org/elasticsearch/indices/analysis/IndicesAnalysisService.java, +            public Reader create(Reader tokenStream) {, +            public Reader create(Reader tokenStream) {]