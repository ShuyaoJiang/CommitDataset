[+++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/ldap/ActiveDirectorySessionFactorySettings.java, +    public static final Setting<Integer> AD_LDAP_PORT_SETTING = Setting.intSetting("port.ldap", 389, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_LDAPS_PORT_SETTING = Setting.intSetting("port.ldaps", 636, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_GC_LDAP_PORT_SETTING = Setting.intSetting("port.gc_ldap", 3268, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_GC_LDAPS_PORT_SETTING = Setting.intSetting("port.gc_ldaps", 3269, Setting.Property.NodeScope);, +        settings.add(AD_LDAP_PORT_SETTING);, +        settings.add(AD_LDAPS_PORT_SETTING);, +        settings.add(AD_GC_LDAP_PORT_SETTING);, +        settings.add(AD_GC_LDAPS_PORT_SETTING);, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/ldap/ActiveDirectorySessionFactorySettings.java, +    public static final Setting<Integer> AD_LDAP_PORT_SETTING = Setting.intSetting("port.ldap", 389, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_LDAPS_PORT_SETTING = Setting.intSetting("port.ldaps", 636, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_GC_LDAP_PORT_SETTING = Setting.intSetting("port.gc_ldap", 3268, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_GC_LDAPS_PORT_SETTING = Setting.intSetting("port.gc_ldaps", 3269, Setting.Property.NodeScope);, +        settings.add(AD_LDAP_PORT_SETTING);, +        settings.add(AD_LDAPS_PORT_SETTING);, +        settings.add(AD_GC_LDAP_PORT_SETTING);, +        settings.add(AD_GC_LDAPS_PORT_SETTING);, +++ b/plugin/core/src/test/java/org/elasticsearch/xpack/core/ssl/SSLConfigurationReloaderTests.java, +            assertThat(trustedCount.get() - updatedTrustManager.getAcceptedIssuers().length, is(5));, +            assertThat(trustedCount.get() - updatedTrustManager.getAcceptedIssuers().length, is(6));, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/ldap/ActiveDirectorySessionFactorySettings.java, +    public static final Setting<Integer> AD_LDAP_PORT_SETTING = Setting.intSetting("port.ldap", 389, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_LDAPS_PORT_SETTING = Setting.intSetting("port.ldaps", 636, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_GC_LDAP_PORT_SETTING = Setting.intSetting("port.gc_ldap", 3268, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_GC_LDAPS_PORT_SETTING = Setting.intSetting("port.gc_ldaps", 3269, Setting.Property.NodeScope);, +        settings.add(AD_LDAP_PORT_SETTING);, +        settings.add(AD_LDAPS_PORT_SETTING);, +        settings.add(AD_GC_LDAP_PORT_SETTING);, +        settings.add(AD_GC_LDAPS_PORT_SETTING);, +++ b/plugin/core/src/test/java/org/elasticsearch/xpack/core/ssl/SSLConfigurationReloaderTests.java, +            assertThat(trustedCount.get() - updatedTrustManager.getAcceptedIssuers().length, is(5));, +            assertThat(trustedCount.get() - updatedTrustManager.getAcceptedIssuers().length, is(6));, +++ b/plugin/core/src/test/java/org/elasticsearch/xpack/core/ssl/SSLServiceTests.java, +        assertThat(certificates, iterableWithSize(8));, +        assertThat(cert.alias(), equalTo("mykey"));, +        assertThat(cert.path(), equalTo(jksPath.toString()));, +        assertThat(cert.format(), equalTo("jks"));, +        assertThat(cert.serialNumber(), equalTo("3151a81eec8d4e34c56a8466a8510bcfbe63cc31"));, +        assertThat(cert.subjectDn(), equalTo("CN=samba4"));, +        assertThat(cert.expiry(), equalTo(DateTime.parse("2021-02-14T17:49:11.000Z")));, +        assertThat(cert.hasPrivateKey(), equalTo(false));, +, +        cert = iterator.next();, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/ldap/ActiveDirectorySessionFactorySettings.java, +    public static final Setting<Integer> AD_LDAP_PORT_SETTING = Setting.intSetting("port.ldap", 389, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_LDAPS_PORT_SETTING = Setting.intSetting("port.ldaps", 636, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_GC_LDAP_PORT_SETTING = Setting.intSetting("port.gc_ldap", 3268, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_GC_LDAPS_PORT_SETTING = Setting.intSetting("port.gc_ldaps", 3269, Setting.Property.NodeScope);, +        settings.add(AD_LDAP_PORT_SETTING);, +        settings.add(AD_LDAPS_PORT_SETTING);, +        settings.add(AD_GC_LDAP_PORT_SETTING);, +        settings.add(AD_GC_LDAPS_PORT_SETTING);, +++ b/plugin/core/src/test/java/org/elasticsearch/xpack/core/ssl/SSLConfigurationReloaderTests.java, +            assertThat(trustedCount.get() - updatedTrustManager.getAcceptedIssuers().length, is(5));, +            assertThat(trustedCount.get() - updatedTrustManager.getAcceptedIssuers().length, is(6));, +++ b/plugin/core/src/test/java/org/elasticsearch/xpack/core/ssl/SSLServiceTests.java, +        assertThat(certificates, iterableWithSize(8));, +        assertThat(cert.alias(), equalTo("mykey"));, +        assertThat(cert.path(), equalTo(jksPath.toString()));, +        assertThat(cert.format(), equalTo("jks"));, +        assertThat(cert.serialNumber(), equalTo("3151a81eec8d4e34c56a8466a8510bcfbe63cc31"));, +        assertThat(cert.subjectDn(), equalTo("CN=samba4"));, +        assertThat(cert.expiry(), equalTo(DateTime.parse("2021-02-14T17:49:11.000Z")));, +        assertThat(cert.hasPrivateKey(), equalTo(false));, +, +        cert = iterator.next();, +++ b/plugin/core/src/test/resources/org/elasticsearch/xpack/security/transport/ssl/certs/simple/testnode.jks, +++ b/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/ldap/ActiveDirectorySessionFactorySettings.java, +    public static final Setting<Integer> AD_LDAP_PORT_SETTING = Setting.intSetting("port.ldap", 389, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_LDAPS_PORT_SETTING = Setting.intSetting("port.ldaps", 636, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_GC_LDAP_PORT_SETTING = Setting.intSetting("port.gc_ldap", 3268, Setting.Property.NodeScope);, +    public static final Setting<Integer> AD_GC_LDAPS_PORT_SETTING = Setting.intSetting("port.gc_ldaps", 3269, Setting.Property.NodeScope);, +        settings.add(AD_LDAP_PORT_SETTING);, +        settings.add(AD_LDAPS_PORT_SETTING);, +        settings.add(AD_GC_LDAP_PORT_SETTING);, +        settings.add(AD_GC_LDAPS_PORT_SETTING);, +++ b/plugin/core/src/test/java/org/elasticsearch/xpack/core/ssl/SSLConfigurationReloaderTests.java, +            assertThat(trustedCount.get() - updatedTrustManager.getAcceptedIssuers().length, is(5));, +            assertThat(trustedCount.get() - updatedTrustManager.getAcceptedIssuers().length, is(6));, +++ b/plugin/core/src/test/java/org/elasticsearch/xpack/core/ssl/SSLServiceTests.java, +        assertThat(certificates, iterableWithSize(8));, +        assertThat(cert.alias(), equalTo("mykey"));, +        assertThat(cert.path(), equalTo(jksPath.toString()));, +        assertThat(cert.format(), equalTo("jks"));, +        assertThat(cert.serialNumber(), equalTo("3151a81eec8d4e34c56a8466a8510bcfbe63cc31"));, +        assertThat(cert.subjectDn(), equalTo("CN=samba4"));, +        assertThat(cert.expiry(), equalTo(DateTime.parse("2021-02-14T17:49:11.000Z")));, +        assertThat(cert.hasPrivateKey(), equalTo(false));, +, +        cert = iterator.next();, +++ b/plugin/core/src/test/resources/org/elasticsearch/xpack/security/transport/ssl/certs/simple/testnode.jks, +++ b/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/ldap/ActiveDirectorySessionFactory.java, +    private final int ldapPort;, +, +        ldapPort = ActiveDirectorySessionFactorySettings.AD_LDAP_PORT_SETTING.get(settings);, +        final int ldapsPort = ActiveDirectorySessionFactorySettings.AD_LDAPS_PORT_SETTING.get(settings);, +        final int gcLdapPort = ActiveDirectorySessionFactorySettings.AD_GC_LDAP_PORT_SETTING.get(settings);, +        final int gcLdapsPort = ActiveDirectorySessionFactorySettings.AD_GC_LDAPS_PORT_SETTING.get(settings);, +]