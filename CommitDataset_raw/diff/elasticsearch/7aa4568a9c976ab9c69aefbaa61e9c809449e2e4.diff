[+++ b/plugins/discovery-ec2/build.gradle, +++ b/plugins/discovery-ec2/build.gradle, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java, +        String key = CLOUD_EC2.KEY_SETTING.get(settings);, +        String secret = CLOUD_EC2.SECRET_SETTING.get(settings);, +        if (CLOUD_EC2.PROXY_HOST_SETTING.exists(settings)) {, +        AWSCredentialsProvider credentials;, +, +        if (key == null && secret == null) {, +            credentials = new AWSCredentialsProviderChain(, +                    new EnvironmentVariableCredentialsProvider(),, +                    new SystemPropertiesCredentialsProvider(),, +                    new InstanceProfileCredentialsProvider(), +            );, +        } else {, +            credentials = new AWSCredentialsProviderChain(, +                    new StaticCredentialsProvider(new BasicAWSCredentials(key, secret)), +            );, +        this.client = new AmazonEC2Client(credentials, clientConfiguration);, +, +            final String endpoint = CLOUD_EC2.ENDPOINT_SETTING.get(settings);, +            client.setEndpoint(endpoint);, +        } else if (CLOUD_EC2.REGION_SETTING.exists(settings)) {, +            final String endpoint;, +            if (region.equals("us-east-1") || region.equals("us-east")) {, +            } else if (region.equals("us-west") || region.equals("us-west-1")) {, +            } else if (region.equals("us-west-2")) {, +            } else if (region.equals("ap-southeast") || region.equals("ap-southeast-1")) {, +            } else if (region.equals("us-gov-west") || region.equals("us-gov-west-1")) {, +            } else if (region.equals("ap-south-1")) {, +                endpoint = "ec2.ap-south-1.amazonaws.com";, +            } else if (region.equals("ap-southeast-2")) {, +            } else if (region.equals("ap-northeast") || region.equals("ap-northeast-1")) {, +            } else if (region.equals("ap-northeast-2")) {, +            } else if (region.equals("eu-west") || region.equals("eu-west-1")) {, +            } else if (region.equals("eu-central") || region.equals("eu-central-1")) {, +            } else if (region.equals("sa-east") || region.equals("sa-east-1")) {, +            } else if (region.equals("cn-north") || region.equals("cn-north-1")) {, +            } else {, +            client.setEndpoint(endpoint);, +, +        return this.client;, +++ b/plugins/discovery-ec2/build.gradle, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java, +        String key = CLOUD_EC2.KEY_SETTING.get(settings);, +        String secret = CLOUD_EC2.SECRET_SETTING.get(settings);, +        if (CLOUD_EC2.PROXY_HOST_SETTING.exists(settings)) {, +        AWSCredentialsProvider credentials;, +, +        if (key == null && secret == null) {, +            credentials = new AWSCredentialsProviderChain(, +                    new EnvironmentVariableCredentialsProvider(),, +                    new SystemPropertiesCredentialsProvider(),, +                    new InstanceProfileCredentialsProvider(), +            );, +        } else {, +            credentials = new AWSCredentialsProviderChain(, +                    new StaticCredentialsProvider(new BasicAWSCredentials(key, secret)), +            );, +        this.client = new AmazonEC2Client(credentials, clientConfiguration);, +, +            final String endpoint = CLOUD_EC2.ENDPOINT_SETTING.get(settings);, +            client.setEndpoint(endpoint);, +        } else if (CLOUD_EC2.REGION_SETTING.exists(settings)) {, +            final String endpoint;, +            if (region.equals("us-east-1") || region.equals("us-east")) {, +            } else if (region.equals("us-west") || region.equals("us-west-1")) {, +            } else if (region.equals("us-west-2")) {, +            } else if (region.equals("ap-southeast") || region.equals("ap-southeast-1")) {, +            } else if (region.equals("us-gov-west") || region.equals("us-gov-west-1")) {, +            } else if (region.equals("ap-south-1")) {, +                endpoint = "ec2.ap-south-1.amazonaws.com";, +            } else if (region.equals("ap-southeast-2")) {, +            } else if (region.equals("ap-northeast") || region.equals("ap-northeast-1")) {, +            } else if (region.equals("ap-northeast-2")) {, +            } else if (region.equals("eu-west") || region.equals("eu-west-1")) {, +            } else if (region.equals("eu-central") || region.equals("eu-central-1")) {, +            } else if (region.equals("sa-east") || region.equals("sa-east-1")) {, +            } else if (region.equals("cn-north") || region.equals("cn-north-1")) {, +            } else {, +            client.setEndpoint(endpoint);, +, +        return this.client;, +++ /dev/null, +++ b/plugins/discovery-ec2/build.gradle, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java, +        String key = CLOUD_EC2.KEY_SETTING.get(settings);, +        String secret = CLOUD_EC2.SECRET_SETTING.get(settings);, +        if (CLOUD_EC2.PROXY_HOST_SETTING.exists(settings)) {, +        AWSCredentialsProvider credentials;, +, +        if (key == null && secret == null) {, +            credentials = new AWSCredentialsProviderChain(, +                    new EnvironmentVariableCredentialsProvider(),, +                    new SystemPropertiesCredentialsProvider(),, +                    new InstanceProfileCredentialsProvider(), +            );, +        } else {, +            credentials = new AWSCredentialsProviderChain(, +                    new StaticCredentialsProvider(new BasicAWSCredentials(key, secret))]