[+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +            builder.rawValue(new BytesArray(source).streamInput(), XContentType.JSON);, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +            builder.rawValue(new BytesArray(source).streamInput(), XContentType.JSON);, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java, +        generator.writeRawField(name, value.streamInput());, +        generator.writeRawField(name, value.streamInput(), contentType);, +     * Writes a value with the source coming directly from the bytes in the stream, +    public XContentBuilder rawValue(InputStream stream, XContentType contentType) throws IOException {, +        generator.writeRawValue(stream, contentType);, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +            builder.rawValue(new BytesArray(source).streamInput(), XContentType.JSON);, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java, +        generator.writeRawField(name, value.streamInput());, +        generator.writeRawField(name, value.streamInput(), contentType);, +     * Writes a value with the source coming directly from the bytes in the stream, +    public XContentBuilder rawValue(InputStream stream, XContentType contentType) throws IOException {, +        generator.writeRawValue(stream, contentType);, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/XContentGenerator.java, +     * Writes a raw value taken from the bytes in the stream, +    void writeRawValue(InputStream value, XContentType xContentType) throws IOException;, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +            builder.rawValue(new BytesArray(source).streamInput(), XContentType.JSON);, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java, +        generator.writeRawField(name, value.streamInput());, +        generator.writeRawField(name, value.streamInput(), contentType);, +     * Writes a value with the source coming directly from the bytes in the stream, +    public XContentBuilder rawValue(InputStream stream, XContentType contentType) throws IOException {, +        generator.writeRawValue(stream, contentType);, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/XContentGenerator.java, +     * Writes a raw value taken from the bytes in the stream, +    void writeRawValue(InputStream value, XContentType xContentType) throws IOException;, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java, +    public void writeRawValue(InputStream stream, XContentType xContentType) throws IOException {, +        if (mayWriteRawData(xContentType) == false) {, +            copyRawValue(stream, xContentType.xContent());, +            transfer(stream, os);, +    // A basic copy of Java 9's InputStream#transferTo, +    private static long transfer(InputStream in, OutputStream out) throws IOException {, +        Objects.requireNonNull(out, "out");, +        long transferred = 0;, +        byte[] buffer = new byte[8192];, +        int read;, +        while ((read = in.read(buffer, 0, 8192)) >= 0) {, +            out.write(buffer, 0, read);, +            transferred += read;, +        }, +        return transferred;, +    }, +, +    protected void copyRawValue(InputStream stream, XContent xContent) throws IOException {, +        try (XContentParser parser = xContent, +                 .createParser(NamedXContentRegistry.EMPTY, DeprecationHandler.THROW_UNSUPPORTED_OPERATION, stream)) {, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +            builder.rawValue(new BytesArray(source).streamInput(), XContentType.JSON);, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java, +        generator.writeRawField(name, value.streamInput());, +        generator.writeRawField(name, value.streamInput(), contentType);, +     * Writes a value with the source coming directly from the bytes in the stream, +    public XContentBuilder rawValue(InputStream stream, XContentType contentType) throws IOException {, +        generator.writeRawValue(stream, contentType);, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/XContentGenerator.java, +     * Writes a raw value taken from the bytes in the stream, +    void writeRawValue(InputStream value, XContentType xContentType) throws IOException;, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java, +    public void writeRawValue(InputStream stream, XContentType xContentType) throws IOException {, +        if (mayWriteRawData(xContentType) == false) {, +            copyRawValue(stream, xContentType.xContent());, +            transfer(stream, os);, +    // A basic copy of Java 9's InputStream#transferTo, +    private static long transfer(InputStream in, OutputStream out) throws IOException {, +        Objects.requireNonNull(out, "out");, +        long transferred = 0;, +        byte[] buffer = new byte[8192];, +        int read;, +        while ((read = in.read(buffer, 0, 8192)) >= 0) {, +            out.write(buffer, 0, read);, +            transferred += read;, +        }, +        return transferred;, +    }, +, +    protected void copyRawValue(InputStream stream, XContent xContent) throws IOException {, +        try (XContentParser parser = xContent, +                 .createParser(NamedXContentRegistry.EMPTY, DeprecationHandler.THROW_UNSUPPORTED_OPERATION, stream)) {, +++ b/server/src/main/java/org/elasticsearch/rest/action/document/RestGetSourceAction.java, +import org.elasticsearch.common.bytes.BytesReference;, +import org.elasticsearch.common.xcontent.XContentFactory;, +                            final BytesReference source = response.getSourceInternal();, +                            builder.rawValue(source.streamInput(), XContentFactory.xContentType(source));, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +            builder.rawValue(new BytesArray(source).streamInput(), XContentType.JSON);, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java, +        generator.writeRawField(name, value.streamInput());, +        generator.writeRawField(name, value.streamInput(), contentType);, +     * Writes a value with the source coming directly from the bytes in the stream, +    public XContentBuilder rawValue(InputStream stream, XContentType contentType) throws IOException {, +        generator.writeRawValue(stream, contentType);, +++ b/server/src/main/java/org/elasticsearch/common/xcontent/XContentGenerator.java, +     * Writes a raw value taken from the bytes in the stream]