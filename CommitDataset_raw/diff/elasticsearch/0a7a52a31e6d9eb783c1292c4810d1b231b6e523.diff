[+++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +            os = new OsStats(in);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +            os = new OsStats(in);, +++ b/core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java, +        OsStats.Cpu cpu = new OsStats.Cpu(getSystemCpuPercent(), getSystemLoadAverage());, +        OsStats.Mem mem = new OsStats.Mem(getTotalPhysicalMemorySize(), getFreePhysicalMemorySize());, +        OsStats.Swap swap = new OsStats.Swap(getTotalSwapSpaceSize(), getFreeSwapSpaceSize());, +        return new OsStats(System.currentTimeMillis(), cpu, mem , swap);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +            os = new OsStats(in);, +++ b/core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java, +        OsStats.Cpu cpu = new OsStats.Cpu(getSystemCpuPercent(), getSystemLoadAverage());, +        OsStats.Mem mem = new OsStats.Mem(getTotalPhysicalMemorySize(), getFreePhysicalMemorySize());, +        OsStats.Swap swap = new OsStats.Swap(getTotalSwapSpaceSize(), getFreeSwapSpaceSize());, +        return new OsStats(System.currentTimeMillis(), cpu, mem , swap);, +++ b/core/src/main/java/org/elasticsearch/monitor/os/OsStats.java, +import org.elasticsearch.common.io.stream.Writeable;, +public class OsStats implements Writeable, ToXContent {, +    private final long timestamp;, +    private final Cpu cpu;, +    private final Mem mem;, +    private final Swap swap;, +    public OsStats(long timestamp, Cpu cpu, Mem mem, Swap swap) {, +        this.timestamp = timestamp;, +        this.cpu = cpu;, +        this.mem = mem;, +        this.swap = swap;, +    }, +    public OsStats(StreamInput in) throws IOException {, +        this.timestamp = in.readVLong();, +        this.cpu = new Cpu(in);, +        this.mem = new Mem(in);, +        this.swap = new Swap(in);, +    }, +    @Override, +    public void writeTo(StreamOutput out) throws IOException {, +        out.writeVLong(timestamp);, +        cpu.writeTo(out);, +        mem.writeTo(out);, +        swap.writeTo(out);, +        static final String LOAD_AVERAGE_1M = "1m";, +        static final String LOAD_AVERAGE_5M = "5m";, +        static final String LOAD_AVERAGE_15M = "15m";, +    public static class Cpu implements Writeable {, +, +        private final short percent;, +        private final double[] loadAverage;, +, +        public Cpu(short systemCpuPercent, double[] systemLoadAverage) {, +            this.percent = systemCpuPercent;, +            this.loadAverage = systemLoadAverage;, +        public Cpu(StreamInput in) throws IOException {, +            this.percent = in.readShort();, +                this.loadAverage = in.readDoubleArray();, +                this.loadAverage = null;, +    public static class Swap implements Writeable {, +        private final long total;, +        private final long free;, +, +        public Swap(long total, long free) {, +            this.total = total;, +            this.free = free;, +        }, +, +        public Swap(StreamInput in) throws IOException {, +            this.total = in.readLong();, +            this.free = in.readLong();, +        }, +, +        @Override, +        public void writeTo(StreamOutput out) throws IOException {, +            out.writeLong(total);, +            out.writeLong(free);, +        }, +    public static class Mem implements Writeable {, +, +        private final long total;, +        private final long free;, +, +        public Mem(long total, long free) {, +            this.total = total;, +            this.free = free;, +        public Mem(StreamInput in) throws IOException {, +            this.total = in.readLong();, +            this.free = in.readLong();, +            return calculatePercentage(getUsed().bytes(), total);, +            return calculatePercentage(free, total);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +            os = new OsStats(in);, +++ b/core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java, +        OsStats.Cpu cpu = new OsStats.Cpu(getSystemCpuPercent(), getSystemLoadAverage());, +        OsStats.Mem mem = new OsStats.Mem(getTotalPhysicalMemorySize(), getFreePhysicalMemorySize());, +        OsStats.Swap swap = new OsStats.Swap(getTotalSwapSpaceSize(), getFreeSwapSpaceSize());, +        return new OsStats(System.currentTimeMillis(), cpu, mem , swap);, +++ b/core/src/main/java/org/elasticsearch/monitor/os/OsStats.java, +import org.elasticsearch.common.io.stream.Writeable;, +public class OsStats implements Writeable, ToXContent {, +    private final long timestamp;, +    private final Cpu cpu;]