[+++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java, +    , +    public final static String CLASS_NAME      = BASE_CLASS_NAME + "$Script";, +    public final static Type CLASS_TYPE        = Type.getObjectType(CLASS_NAME.replace('.', '/'));, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java, +    , +    public final static String CLASS_NAME      = BASE_CLASS_NAME + "$Script";, +    public final static Type CLASS_TYPE        = Type.getObjectType(CLASS_NAME.replace('.', '/'));, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LBrace.java, +            try {, +                before.clazz.asSubclass(Map.class);, +, +            } catch (final ClassCastException exception) {, +                // Do nothing., +            try {, +                before.clazz.asSubclass(List.class);, +, +            } catch (final ClassCastException exception) {, +                // Do nothing., +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java, +    , +    public final static String CLASS_NAME      = BASE_CLASS_NAME + "$Script";, +    public final static Type CLASS_TYPE        = Type.getObjectType(CLASS_NAME.replace('.', '/'));, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LBrace.java, +            try {, +                before.clazz.asSubclass(Map.class);, +, +            } catch (final ClassCastException exception) {, +                // Do nothing., +            try {, +                before.clazz.asSubclass(List.class);, +, +            } catch (final ClassCastException exception) {, +                // Do nothing., +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LDefArray.java, +        adapter.visitInvokeDynamicInsn("arrayLoad", desc, DEF_BOOTSTRAP_HANDLE, DefBootstrap.ARRAY_LOAD);, +        adapter.visitInvokeDynamicInsn("arrayStore", desc, DEF_BOOTSTRAP_HANDLE, DefBootstrap.ARRAY_STORE);, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java, +    , +    public final static String CLASS_NAME      = BASE_CLASS_NAME + "$Script";, +    public final static Type CLASS_TYPE        = Type.getObjectType(CLASS_NAME.replace('.', '/'));, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LBrace.java, +            try {, +                before.clazz.asSubclass(Map.class);, +, +            } catch (final ClassCastException exception) {, +                // Do nothing., +            try {, +                before.clazz.asSubclass(List.class);, +, +            } catch (final ClassCastException exception) {, +                // Do nothing., +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LDefArray.java, +        adapter.visitInvokeDynamicInsn("arrayLoad", desc, DEF_BOOTSTRAP_HANDLE, DefBootstrap.ARRAY_LOAD);, +        adapter.visitInvokeDynamicInsn("arrayStore", desc, DEF_BOOTSTRAP_HANDLE, DefBootstrap.ARRAY_STORE);, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LDefCall.java, +        adapter.visitInvokeDynamicInsn(name, signature.toString(), DEF_BOOTSTRAP_HANDLE, DefBootstrap.METHOD_CALL);, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java, +    , +    public final static String CLASS_NAME      = BASE_CLASS_NAME + "$Script";, +    public final static Type CLASS_TYPE        = Type.getObjectType(CLASS_NAME.replace('.', '/'));, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LBrace.java, +            try {, +                before.clazz.asSubclass(Map.class);, +, +            } catch (final ClassCastException exception) {, +                // Do nothing., +            try {, +                before.clazz.asSubclass(List.class);, +, +            } catch (final ClassCastException exception) {, +                // Do nothing., +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LDefArray.java, +        adapter.visitInvokeDynamicInsn("arrayLoad", desc, DEF_BOOTSTRAP_HANDLE, DefBootstrap.ARRAY_LOAD);, +        adapter.visitInvokeDynamicInsn("arrayStore", desc, DEF_BOOTSTRAP_HANDLE, DefBootstrap.ARRAY_STORE);, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LDefCall.java, +        adapter.visitInvokeDynamicInsn(name, signature.toString(), DEF_BOOTSTRAP_HANDLE, DefBootstrap.METHOD_CALL);, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LDefField.java, +        adapter.visitInvokeDynamicInsn(value, desc, DEF_BOOTSTRAP_HANDLE, DefBootstrap.LOAD);, +        adapter.visitInvokeDynamicInsn(value, desc, DEF_BOOTSTRAP_HANDLE, DefBootstrap.STORE);, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java, +    , +    public final static String CLASS_NAME      = BASE_CLASS_NAME + "$Script";, +    public final static Type CLASS_TYPE        = Type.getObjectType(CLASS_NAME.replace('.', '/'));, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LBrace.java, +            try {, +                before.clazz.asSubclass(Map.class);, +, +            } catch (final ClassCastException exception) {, +                // Do nothing., +            try {, +                before.clazz.asSubclass(List.class);, +, +            } catch (final ClassCastException exception) {, +                // Do nothing., +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LDefArray.java, +        adapter.visitInvokeDynamicInsn("arrayLoad", desc, DEF_BOOTSTRAP_HANDLE, DefBootstrap.ARRAY_LOAD);, +        adapter.visitInvokeDynamicInsn("arrayStore", desc, DEF_BOOTSTRAP_HANDLE, DefBootstrap.ARRAY_STORE);, +++ b/modules/lang-painless/src/main/java/org/elasticsearch/painless/node/LDefCall.java, +        adapter.visitInvokeDynamicInsn(name, signature.toString(), DEF_BOOTSTRAP_HANDLE, DefBootstrap.METHOD_CALL);]