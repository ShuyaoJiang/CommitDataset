[+++ b/elasticsearch/x-pack/shield/src/main/java/org/elasticsearch/shield/authz/accesscontrol/ShieldIndexSearcherWrapper.java, +import org.elasticsearch.common.xcontent.XContentFactory;, +import org.elasticsearch.common.xcontent.XContentParser;, +import org.elasticsearch.index.query.QueryBuilder;, +                    try (XContentParser parser = XContentFactory.xContent(bytesReference).createParser(bytesReference)) {, +                        QueryBuilder queryBuilder = queryShardContext.newParseContext(parser).parseInnerQueryBuilder();, +                        ParsedQuery parsedQuery = queryShardContext.toQuery(queryBuilder);, +                }, +++ b/elasticsearch/x-pack/shield/src/main/java/org/elasticsearch/shield/authz/accesscontrol/ShieldIndexSearcherWrapper.java, +import org.elasticsearch.common.xcontent.XContentFactory;, +import org.elasticsearch.common.xcontent.XContentParser;, +import org.elasticsearch.index.query.QueryBuilder;, +                    try (XContentParser parser = XContentFactory.xContent(bytesReference).createParser(bytesReference)) {, +                        QueryBuilder queryBuilder = queryShardContext.newParseContext(parser).parseInnerQueryBuilder();, +                        ParsedQuery parsedQuery = queryShardContext.toQuery(queryBuilder);, +                }, +++ b/elasticsearch/x-pack/shield/src/test/java/org/elasticsearch/shield/authz/accesscontrol/ShieldIndexSearcherWrapperIntegrationTests.java, +import org.elasticsearch.common.xcontent.XContentParser;, +import org.elasticsearch.index.query.QueryBuilder;, +import org.elasticsearch.index.query.QueryParseContext;, +import org.elasticsearch.index.query.TermQueryBuilder;, +        QueryParseContext queryParseContext = mock(QueryParseContext.class);, +            when(queryShardContext.newParseContext(any(XContentParser.class))).thenReturn(queryParseContext);, +            when(queryParseContext.parseInnerQueryBuilder()).thenReturn((QueryBuilder) new TermQueryBuilder("field", values[i]));, +            when(queryShardContext.toQuery(any(QueryBuilder.class))).thenReturn(parsedQuery);]