[+++ b/core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +++ b/core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +++ b/core/src/main/java/org/elasticsearch/search/Highlighters.java, +    public Highlighters(Settings settings) {, +++ b/core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +++ b/core/src/main/java/org/elasticsearch/search/Highlighters.java, +    public Highlighters(Settings settings) {, +++ b/core/src/main/java/org/elasticsearch/search/SearchModule.java, +import java.util.Objects;, +    private final Set<FetchSubPhase> fetchSubPhases = new HashSet<>();, +        registerBuiltinSubFetchPhases();, +    /**, +     * Registers a {@link FetchSubPhase} instance. This sub phase is executed when docuemnts are fetched for instanced to highlight, +     * documents., +     */, +    public void registerFetchSubPhase(FetchSubPhase subPhase) {, +        fetchSubPhases.add(Objects.requireNonNull(subPhase, "FetchSubPhase must not be null"));, +    }, +, +    /**, +     * Returns the {@link Highlighter} registry, +     */, +    public Highlighters getHighlighters() {, +        return highlighters;, +        bind(FetchPhase.class).toInstance(new FetchPhase(fetchSubPhases));, +    private void registerBuiltinSubFetchPhases() {, +        registerFetchSubPhase(new ExplainFetchSubPhase());, +        registerFetchSubPhase(new FieldDataFieldsFetchSubPhase());, +        registerFetchSubPhase(new ScriptFieldsFetchSubPhase());, +        registerFetchSubPhase(new FetchSourceSubPhase());, +        registerFetchSubPhase(new VersionFetchSubPhase());, +        registerFetchSubPhase(new MatchedQueriesFetchSubPhase());, +        registerFetchSubPhase(new HighlightPhase(settings, highlighters));, +        registerFetchSubPhase(new ParentFieldSubFetchPhase());, +    }, +, +++ b/core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +++ b/core/src/main/java/org/elasticsearch/search/Highlighters.java, +    public Highlighters(Settings settings) {, +++ b/core/src/main/java/org/elasticsearch/search/SearchModule.java, +import java.util.Objects;, +    private final Set<FetchSubPhase> fetchSubPhases = new HashSet<>();, +        registerBuiltinSubFetchPhases();, +    /**, +     * Registers a {@link FetchSubPhase} instance. This sub phase is executed when docuemnts are fetched for instanced to highlight, +     * documents., +     */, +    public void registerFetchSubPhase(FetchSubPhase subPhase) {, +        fetchSubPhases.add(Objects.requireNonNull(subPhase, "FetchSubPhase must not be null"));, +    }, +, +    /**, +     * Returns the {@link Highlighter} registry, +     */, +    public Highlighters getHighlighters() {, +        return highlighters;, +        bind(FetchPhase.class).toInstance(new FetchPhase(fetchSubPhases));, +    private void registerBuiltinSubFetchPhases() {, +        registerFetchSubPhase(new ExplainFetchSubPhase());, +        registerFetchSubPhase(new FieldDataFieldsFetchSubPhase());, +        registerFetchSubPhase(new ScriptFieldsFetchSubPhase());, +        registerFetchSubPhase(new FetchSourceSubPhase());, +        registerFetchSubPhase(new VersionFetchSubPhase());, +        registerFetchSubPhase(new MatchedQueriesFetchSubPhase());, +        registerFetchSubPhase(new HighlightPhase(settings, highlighters));, +        registerFetchSubPhase(new ParentFieldSubFetchPhase());, +    }, +, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +    private final DfsPhase dfsPhase = new DfsPhase();, +                         ThreadPool threadPool, ScriptService scriptService, BigArrays bigArrays,, +                          FetchPhase fetchPhase, AggregatorParsers aggParsers, Suggesters suggesters) {, +        this.queryPhase = new QueryPhase(settings);, +    private void loadOrExecuteQueryPhase(final ShardSearchRequest request, final SearchContext context) throws Exception {, +            loadOrExecuteQueryPhase(request, context);, +                loadOrExecuteQueryPhase(request, context);, +++ b/core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +++ b/core/src/main/java/org/elasticsearch/search/Highlighters.java, +    public Highlighters(Settings settings) {, +++ b/core/src/main/java/org/elasticsearch/search/SearchModule.java, +import java.util.Objects;, +    private final Set<FetchSubPhase> fetchSubPhases = new HashSet<>();, +        registerBuiltinSubFetchPhases();, +    /**, +     * Registers a {@link FetchSubPhase} instance. This sub phase is executed when docuemnts are fetched for instanced to highlight, +     * documents., +     */, +    public void registerFetchSubPhase(FetchSubPhase subPhase) {, +        fetchSubPhases.add(Objects.requireNonNull(subPhase, "FetchSubPhase must not be null"));, +    }, +, +    /**, +     * Returns the {@link Highlighter} registry, +     */, +    public Highlighters getHighlighters() {, +        return highlighters;, +        bind(FetchPhase.class).toInstance(new FetchPhase(fetchSubPhases));, +    private void registerBuiltinSubFetchPhases() {, +        registerFetchSubPhase(new ExplainFetchSubPhase());, +        registerFetchSubPhase(new FieldDataFieldsFetchSubPhase());]