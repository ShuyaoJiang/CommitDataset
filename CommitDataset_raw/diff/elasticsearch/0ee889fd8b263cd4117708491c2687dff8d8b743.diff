[+++ b/src/main/java/org/elasticsearch/index/mapper/ParseContext.java, +    private boolean withinMultiFields = false;, +    public void setWithinMultiFields() {, +        this.withinMultiFields = true;, +    }, +, +    public void clearWithinMultiFields() {, +        this.withinMultiFields = false;, +    }, +, +        if (withinMultiFields) {, +            return false;, +        }, +++ b/src/main/java/org/elasticsearch/index/mapper/ParseContext.java, +    private boolean withinMultiFields = false;, +    public void setWithinMultiFields() {, +        this.withinMultiFields = true;, +    }, +, +    public void clearWithinMultiFields() {, +        this.withinMultiFields = false;, +    }, +, +        if (withinMultiFields) {, +            return false;, +        }, +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +            context.setWithinMultiFields();, +, +, +            context.clearWithinMultiFields();, +++ b/src/main/java/org/elasticsearch/index/mapper/ParseContext.java, +    private boolean withinMultiFields = false;, +    public void setWithinMultiFields() {, +        this.withinMultiFields = true;, +    }, +, +    public void clearWithinMultiFields() {, +        this.withinMultiFields = false;, +    }, +, +        if (withinMultiFields) {, +            return false;, +        }, +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +            context.setWithinMultiFields();, +, +, +            context.clearWithinMultiFields();, +++ b/src/test/java/org/elasticsearch/index/mapper/all/SimpleAllMapperTests.java, +import org.elasticsearch.common.xcontent.XContentFactory;, +import java.io.IOException;, +, +    @Test, +    public void testMultiField() throws IOException {, +        String mapping = copyToStringFromClasspath("/org/elasticsearch/index/mapper/all/multifield-mapping.json");, +        DocumentMapper docMapper = MapperTestUtils.newParser().parse(mapping);, +, +        XContentBuilder builder = XContentFactory.jsonBuilder();, +        builder.startObject(), +                .field("_id", "1"), +                .field("foo"), +                    .startObject(), +                        .field("bar", "Elasticsearch rules!"), +                    .endObject(), +                .endObject();, +, +        Document doc = docMapper.parse(builder.bytes()).rootDoc();, +        AllField field = (AllField) doc.getField("_all");, +        AllEntries allEntries = ((AllTokenStream) field.tokenStream(docMapper.mappers().indexAnalyzer())).allEntries();, +        assertThat(allEntries.fields(), empty());, +    }, +++ b/src/main/java/org/elasticsearch/index/mapper/ParseContext.java, +    private boolean withinMultiFields = false;, +    public void setWithinMultiFields() {, +        this.withinMultiFields = true;, +    }, +, +    public void clearWithinMultiFields() {, +        this.withinMultiFields = false;, +    }, +, +        if (withinMultiFields) {, +            return false;, +        }, +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +            context.setWithinMultiFields();, +, +, +            context.clearWithinMultiFields();, +++ b/src/test/java/org/elasticsearch/index/mapper/all/SimpleAllMapperTests.java, +import org.elasticsearch.common.xcontent.XContentFactory;, +import java.io.IOException;, +, +    @Test, +    public void testMultiField() throws IOException {, +        String mapping = copyToStringFromClasspath("/org/elasticsearch/index/mapper/all/multifield-mapping.json");, +        DocumentMapper docMapper = MapperTestUtils.newParser().parse(mapping);, +, +        XContentBuilder builder = XContentFactory.jsonBuilder();]