[+++ b/elasticsearch/x-pack/marvel/src/main/java/org/elasticsearch/marvel/agent/exporter/http/HttpExporter.java, +import org.elasticsearch.SpecialPermission;, +import java.security.AccessController;, +import java.security.PrivilegedAction;, +                final HttpsURLConnection httpsConn = (HttpsURLConnection) conn;, +                final SSLSocketFactory factory = sslSocketFactory;, +, +                SecurityManager sm = System.getSecurityManager();, +                if (sm != null) {, +                    sm.checkPermission(new SpecialPermission());, +                }, +                AccessController.doPrivileged((PrivilegedAction<Void>) () -> {, +                    // Requires permission java.lang.RuntimePermission "setFactory";, +                    httpsConn.setSSLSocketFactory(factory);, +, +                    // Requires permission javax.net.ssl.SSLPermission "setHostnameVerifier";, +                    return null;, +                });, +++ b/elasticsearch/x-pack/marvel/src/main/java/org/elasticsearch/marvel/agent/exporter/http/HttpExporter.java, +import org.elasticsearch.SpecialPermission;, +import java.security.AccessController;, +import java.security.PrivilegedAction;, +                final HttpsURLConnection httpsConn = (HttpsURLConnection) conn;, +                final SSLSocketFactory factory = sslSocketFactory;, +, +                SecurityManager sm = System.getSecurityManager();, +                if (sm != null) {, +                    sm.checkPermission(new SpecialPermission());, +                }, +                AccessController.doPrivileged((PrivilegedAction<Void>) () -> {, +                    // Requires permission java.lang.RuntimePermission "setFactory";, +                    httpsConn.setSSLSocketFactory(factory);, +, +                    // Requires permission javax.net.ssl.SSLPermission "setHostnameVerifier";, +                    return null;, +                });, +++ b/elasticsearch/x-pack/src/main/plugin-metadata/plugin-security.policy, +  permission javax.net.ssl.SSLPermission "setHostnameVerifier";]