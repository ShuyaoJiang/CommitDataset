[+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +import static org.elasticsearch.common.settings.Settings.Builder.EMPTY_SETTINGS;, +        if (in.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // This used to be the size of custom metadata classes, +            assert customSize == 0 : "unexpected custom metadata when none is supported";, +            if (customSize > 0) {, +                throw new IllegalStateException("unexpected custom metadata when none is supported");, +            }, +        if (out.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // Size of custom index metadata, which is removed, +            out.writeVInt(0);, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +import static org.elasticsearch.common.settings.Settings.Builder.EMPTY_SETTINGS;, +        if (in.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // This used to be the size of custom metadata classes, +            assert customSize == 0 : "unexpected custom metadata when none is supported";, +            if (customSize > 0) {, +                throw new IllegalStateException("unexpected custom metadata when none is supported");, +            }, +        if (out.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // Size of custom index metadata, which is removed, +            out.writeVInt(0);, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestBuilder.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +import static org.elasticsearch.common.settings.Settings.Builder.EMPTY_SETTINGS;, +        if (in.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // This used to be the size of custom metadata classes, +            assert customSize == 0 : "unexpected custom metadata when none is supported";, +            if (customSize > 0) {, +                throw new IllegalStateException("unexpected custom metadata when none is supported");, +            }, +        if (out.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // Size of custom index metadata, which is removed, +            out.writeVInt(0);, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestBuilder.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +                .aliases(request.aliases()), +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +import static org.elasticsearch.common.settings.Settings.Builder.EMPTY_SETTINGS;, +        if (in.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // This used to be the size of custom metadata classes, +            assert customSize == 0 : "unexpected custom metadata when none is supported";, +            if (customSize > 0) {, +                throw new IllegalStateException("unexpected custom metadata when none is supported");, +            }, +        if (out.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // Size of custom index metadata, which is removed, +            out.writeVInt(0);, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestBuilder.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +                .aliases(request.aliases()), +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportResizeAction.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +import static org.elasticsearch.common.settings.Settings.Builder.EMPTY_SETTINGS;, +        if (in.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // This used to be the size of custom metadata classes, +            assert customSize == 0 : "unexpected custom metadata when none is supported";, +            if (customSize > 0) {, +                throw new IllegalStateException("unexpected custom metadata when none is supported");, +            }, +        if (out.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // Size of custom index metadata, which is removed, +            out.writeVInt(0);, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestBuilder.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +                .aliases(request.aliases()), +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportResizeAction.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java, +import static org.elasticsearch.common.settings.Settings.Builder.EMPTY_SETTINGS;, +                throw new ElasticsearchParseException("unknown key [{}] in the template ", name);, +        if (in.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // Used to be used for custom index metadata, +            assert customSize == 0 : "expected not to have any custom metadata";, +            if (customSize > 0) {, +                throw new IllegalStateException("unexpected custom metadata when none is supported");, +            }, +        if (out.getVersion().before(Version.V_7_0_0_alpha1)) {, +            out.writeVInt(0);, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +import static org.elasticsearch.common.settings.Settings.Builder.EMPTY_SETTINGS;, +        if (in.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // This used to be the size of custom metadata classes, +            assert customSize == 0 : "unexpected custom metadata when none is supported";, +            if (customSize > 0) {, +                throw new IllegalStateException("unexpected custom metadata when none is supported");, +            }, +        if (out.getVersion().before(Version.V_7_0_0_alpha1)) {, +            // Size of custom index metadata, which is removed, +            out.writeVInt(0);, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestBuilder.java, +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java, +                .aliases(request.aliases()), +++ b/server/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportResizeAction.java]