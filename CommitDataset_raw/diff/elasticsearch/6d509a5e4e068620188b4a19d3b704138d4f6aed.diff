[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/io/stream/HandlesStreamInput.java, +    public void cleanHandles() {, +        handles.clear();, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/io/stream/HandlesStreamInput.java, +    public void cleanHandles() {, +        handles.clear();, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/io/stream/HandlesStreamOutput.java, +    private static final int DEFAULT_IDENTITY_THRESHOLD = 100;, +    public void cleanHandles() {, +        handles.clear();, +        identityHandles.clear();, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/io/stream/HandlesStreamInput.java, +    public void cleanHandles() {, +        handles.clear();, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/io/stream/HandlesStreamOutput.java, +    private static final int DEFAULT_IDENTITY_THRESHOLD = 100;, +    public void cleanHandles() {, +        handles.clear();, +        identityHandles.clear();, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/transport/netty/MessageChannelHandler.java, +import org.elasticsearch.common.io.stream.HandlesStreamInput;, +        HandlesStreamInput handlesStream;, +            handlesStream = CachedStreamInput.cachedHandlesLzf(streamIn);, +            handlesStream = CachedStreamInput.cachedHandles(streamIn);, +            String action = handleRequest(event, handlesStream, requestId);, +                    handlerResponseError(handlesStream, handler);, +                    handleResponse(handlesStream, handler);, +        handlesStream.cleanHandles();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/io/stream/HandlesStreamInput.java, +    public void cleanHandles() {, +        handles.clear();, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/io/stream/HandlesStreamOutput.java, +    private static final int DEFAULT_IDENTITY_THRESHOLD = 100;, +    public void cleanHandles() {, +        handles.clear();, +        identityHandles.clear();, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/transport/netty/MessageChannelHandler.java, +import org.elasticsearch.common.io.stream.HandlesStreamInput;, +        HandlesStreamInput handlesStream;, +            handlesStream = CachedStreamInput.cachedHandlesLzf(streamIn);, +            handlesStream = CachedStreamInput.cachedHandles(streamIn);, +            String action = handleRequest(event, handlesStream, requestId);, +                    handlerResponseError(handlesStream, handler);, +                    handleResponse(handlesStream, handler);, +        handlesStream.cleanHandles();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/transport/support/TransportStreams.java, +            stream.cleanHandles();, +            stream.cleanHandles();]