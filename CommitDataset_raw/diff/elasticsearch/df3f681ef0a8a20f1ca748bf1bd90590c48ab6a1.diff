[+++ b/docs/reference/indices/optimize.asciidoc, +++ b/docs/reference/indices/optimize.asciidoc, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequest.java, +import org.elasticsearch.Version;, +        if (in.getVersion().onOrBefore(Version.V_0_90_3)) {, +            in.readBoolean(); // old refresh flag, +        }, +        if (out.getVersion().onOrBefore(Version.V_0_90_3)) {, +            out.writeBoolean(false); // old refresh flag, +        }, +++ b/docs/reference/indices/optimize.asciidoc, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequest.java, +import org.elasticsearch.Version;, +        if (in.getVersion().onOrBefore(Version.V_0_90_3)) {, +            in.readBoolean(); // old refresh flag, +        }, +        if (out.getVersion().onOrBefore(Version.V_0_90_3)) {, +            out.writeBoolean(false); // old refresh flag, +        }, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequestBuilder.java, +++ b/docs/reference/indices/optimize.asciidoc, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequest.java, +import org.elasticsearch.Version;, +        if (in.getVersion().onOrBefore(Version.V_0_90_3)) {, +            in.readBoolean(); // old refresh flag, +        }, +        if (out.getVersion().onOrBefore(Version.V_0_90_3)) {, +            out.writeBoolean(false); // old refresh flag, +        }, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequestBuilder.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/ShardOptimizeRequest.java, +import org.elasticsearch.Version;, +        if (in.getVersion().onOrBefore(Version.V_0_90_3)) {, +            in.readBoolean(); // old refresh flag, +        }, +        if (out.getVersion().onOrBefore(Version.V_0_90_3)) {, +            out.writeBoolean(false); // old refresh flag, +        }, +++ b/docs/reference/indices/optimize.asciidoc, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequest.java, +import org.elasticsearch.Version;, +        if (in.getVersion().onOrBefore(Version.V_0_90_3)) {, +            in.readBoolean(); // old refresh flag, +        }, +        if (out.getVersion().onOrBefore(Version.V_0_90_3)) {, +            out.writeBoolean(false); // old refresh flag, +        }, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequestBuilder.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/ShardOptimizeRequest.java, +import org.elasticsearch.Version;, +        if (in.getVersion().onOrBefore(Version.V_0_90_3)) {, +            in.readBoolean(); // old refresh flag, +        }, +        if (out.getVersion().onOrBefore(Version.V_0_90_3)) {, +            out.writeBoolean(false); // old refresh flag, +        }, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/docs/reference/indices/optimize.asciidoc, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequest.java, +import org.elasticsearch.Version;, +        if (in.getVersion().onOrBefore(Version.V_0_90_3)) {, +            in.readBoolean(); // old refresh flag, +        }, +        if (out.getVersion().onOrBefore(Version.V_0_90_3)) {, +            out.writeBoolean(false); // old refresh flag, +        }, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequestBuilder.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/ShardOptimizeRequest.java, +import org.elasticsearch.Version;, +        if (in.getVersion().onOrBefore(Version.V_0_90_3)) {, +            in.readBoolean(); // old refresh flag, +        }, +        if (out.getVersion().onOrBefore(Version.V_0_90_3)) {, +            out.writeBoolean(false); // old refresh flag, +        }, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +            return "waitForMerge[" + waitForMerge + "], maxNumSegments[" + maxNumSegments + "], onlyExpungeDeletes[" + onlyExpungeDeletes + "], flush[" + flush + "]";, +++ b/docs/reference/indices/optimize.asciidoc, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequest.java, +import org.elasticsearch.Version;, +        if (in.getVersion().onOrBefore(Version.V_0_90_3)) {, +            in.readBoolean(); // old refresh flag, +        }, +        if (out.getVersion().onOrBefore(Version.V_0_90_3)) {, +            out.writeBoolean(false); // old refresh flag, +        }, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequestBuilder.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/ShardOptimizeRequest.java, +import org.elasticsearch.Version;, +        if (in.getVersion().onOrBefore(Version.V_0_90_3)) {, +            in.readBoolean(); // old refresh flag, +        }, +        if (out.getVersion().onOrBefore(Version.V_0_90_3)) {, +            out.writeBoolean(false); // old refresh flag, +        }, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +            return "waitForMerge[" + waitForMerge + "], maxNumSegments[" + maxNumSegments + "], onlyExpungeDeletes[" + onlyExpungeDeletes + "], flush[" + flush + "]";, +++ b/src/main/java/org/elasticsearch/index/engine/robin/RobinEngine.java]