[+++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateRequestBuilder.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationRequestBuilder;, +    public PercolateRequestBuilder addSort(SortBuilder sort) {, +++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateRequestBuilder.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationRequestBuilder;, +    public PercolateRequestBuilder addSort(SortBuilder sort) {, +++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateSourceBuilder.java, +    private QueryBuilder queryBuilder;, +    private List<SortBuilder> sorts;, +    private List<PipelineAggregatorBuilder> pipelineAggregationBuilders;, +    public PercolateSourceBuilder setQueryBuilder(QueryBuilder queryBuilder) {, +    public PercolateSourceBuilder addSort(SortBuilder sort) {, +    public PercolateSourceBuilder addAggregation(PipelineAggregatorBuilder aggregationBuilder) {, +            for (SortBuilder sort : sorts) {, +                builder.startObject();, +                builder.endObject();, +                for (PipelineAggregatorBuilder aggregation : pipelineAggregationBuilders) {, +++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateRequestBuilder.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationRequestBuilder;, +    public PercolateRequestBuilder addSort(SortBuilder sort) {, +++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateSourceBuilder.java, +    private QueryBuilder queryBuilder;, +    private List<SortBuilder> sorts;, +    private List<PipelineAggregatorBuilder> pipelineAggregationBuilders;, +    public PercolateSourceBuilder setQueryBuilder(QueryBuilder queryBuilder) {, +    public PercolateSourceBuilder addSort(SortBuilder sort) {, +    public PercolateSourceBuilder addAggregation(PipelineAggregatorBuilder aggregationBuilder) {, +            for (SortBuilder sort : sorts) {, +                builder.startObject();, +                builder.endObject();, +                for (PipelineAggregatorBuilder aggregation : pipelineAggregationBuilders) {, +++ b/core/src/main/java/org/elasticsearch/common/bytes/PagedBytesReference.java, +        @Override, +        public int available() throws IOException {, +            return length - pos;, +        }, +, +++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateRequestBuilder.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationRequestBuilder;, +    public PercolateRequestBuilder addSort(SortBuilder sort) {, +++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateSourceBuilder.java, +    private QueryBuilder queryBuilder;, +    private List<SortBuilder> sorts;, +    private List<PipelineAggregatorBuilder> pipelineAggregationBuilders;, +    public PercolateSourceBuilder setQueryBuilder(QueryBuilder queryBuilder) {, +    public PercolateSourceBuilder addSort(SortBuilder sort) {, +    public PercolateSourceBuilder addAggregation(PipelineAggregatorBuilder aggregationBuilder) {, +            for (SortBuilder sort : sorts) {, +                builder.startObject();, +                builder.endObject();, +                for (PipelineAggregatorBuilder aggregation : pipelineAggregationBuilders) {, +++ b/core/src/main/java/org/elasticsearch/common/bytes/PagedBytesReference.java, +        @Override, +        public int available() throws IOException {, +            return length - pos;, +        }, +, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/FilterStreamInput.java, +    public int available() throws IOException {, +        return delegate.available();, +    }, +, +    @Override, +++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateRequestBuilder.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationRequestBuilder;, +    public PercolateRequestBuilder addSort(SortBuilder sort) {, +++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateSourceBuilder.java, +    private QueryBuilder queryBuilder;, +    private List<SortBuilder> sorts;, +    private List<PipelineAggregatorBuilder> pipelineAggregationBuilders;, +    public PercolateSourceBuilder setQueryBuilder(QueryBuilder queryBuilder) {, +    public PercolateSourceBuilder addSort(SortBuilder sort) {, +    public PercolateSourceBuilder addAggregation(PipelineAggregatorBuilder aggregationBuilder) {, +            for (SortBuilder sort : sorts) {, +                builder.startObject();, +                builder.endObject();, +                for (PipelineAggregatorBuilder aggregation : pipelineAggregationBuilders) {, +++ b/core/src/main/java/org/elasticsearch/common/bytes/PagedBytesReference.java, +        @Override, +        public int available() throws IOException {, +            return length - pos;, +        }, +, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/FilterStreamInput.java, +    public int available() throws IOException {, +        return delegate.available();, +    }, +, +    @Override, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/InputStreamStreamInput.java, +    public int available() throws IOException {, +        return is.available();, +    }, +, +    @Override, +++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateRequestBuilder.java, +import org.elasticsearch.action.support.broadcast.BroadcastOperationRequestBuilder;, +    public PercolateRequestBuilder addSort(SortBuilder sort) {, +++ b/core/src/main/java/org/elasticsearch/action/percolate/PercolateSourceBuilder.java, +    private QueryBuilder queryBuilder;]