[+++ b/docs/reference/modules.asciidoc, +include::modules/advanced-scripting.asciidoc[], +, +++ b/docs/reference/modules.asciidoc, +include::modules/advanced-scripting.asciidoc[], +, +++ b/docs/reference/modules/advanced-scripting.asciidoc, +[[modules-advanced-scripting]], +== Text scoring in scripts, +, +, +Text features, such as term or document frequency for a specific term can be accessed in scripts (see <<modules-scripting, scripting documentation>> ) with the `_shard` variable. This can be useful if, for example, you want to implement your own scoring model using for example a script inside a <<query-dsl-function-score-query,function score query>>., +Statistics over the document collection are computed *per shard*, not per, +index., +, +[float], +=== Nomenclature:, +, +, +[horizontal], +`df`::, +, +    document frequency. The number of documents a term appears in. Computed, +    per field., +, +, +`tf`::, +, +    term frequency. The number times a term appears in a field in one specific, +    document., +, +`ttf`::, +, +    total term frequency. The number of times this term appears in all, +    documents, that is, the sum of `tf` over all documents.  Computed per, +    field., +, +`df` and `ttf` are computed per shard and therefore these numbers can vary, +depending on the shard the current document resides in., +, +, +[float], +=== Shard statistics:, +, +`_shard.numDocs()`::, +, +    Number of documents in shard. , +    , +`_shard.maxDoc()`::, +, +    Maximal document number in shard., +    , +`_shard.numDeletedDocs()`::, +, +    Number of deleted documents in shard., +, +, +[float], +=== Field statistics:, +, +Field statistics can be accessed with a subscript operator like this:, +`_shard['FIELD']`., +, +, +`_shard['FIELD'].docCount()`::, +, +    Number of documents containing the field `FIELD`. Does not take deleted documents into account., +, +`_shard['FIELD'].sumttf()`::, +, +    Sum of `ttf` over all terms that appear in field `FIELD` in all documents., +    , +`_shard['FIELD'].sumdf()`::, +, +    The sum of `df` s over all terms that appear in field `FIELD` in all, +    documents., +, +, +Field statistics are computed per shard and therfore these numbers can vary, +depending on the shard the current document resides in., +The number of terms in a field cannot be accessed using the `_shard` variable. See <<mapping-core-types, word count mapping type>> on how to do that., +, +[float], +=== Term statistics:, +, +Term statistics for a field can be accessed with a subscript operator like, +this: `_shard['FIELD']['TERM']`. This will never return null, even if term or field does not exist. , +If you do not need the term frequency, call `_shard['FIELD'].get('TERM', 0)`, +to avoid uneccesary initialization of the frequencies. The flag will have only, +affect is your set the `index_options` to `docs` (see <<mapping-core-types, mapping documentation>>)., +, +, +`_shard['FIELD']['TERM'].df()`::, +, +    `df` of term `TERM` in field `FIELD`. Will be returned, even if the term, +    is not present in the current document., +, +`_shard['FIELD']['TERM'].ttf()`::, +, +    The sum of term frequencys of term `TERM` in field `FIELD` over all]