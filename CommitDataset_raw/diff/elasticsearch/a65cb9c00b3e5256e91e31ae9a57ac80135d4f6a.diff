[+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportSetUpgradeModeAction.java, +import org.apache.logging.log4j.LogManager;, +import org.apache.logging.log4j.Logger;, +    private static final Logger logger = LogManager.getLogger(TransportSetUpgradeModeAction.class);, +            logger.info(msg);, +            logger.info("Upgrade mode noop");, +        logger.info("Starting to set [upgrade_mode] to [" + request.isEnabled() +, +            "] from [" + MlMetadata.getMlMetadata(state).isUpgradeMode() + "]");, +, +                logger.info("Completed upgrade mode request");, +                logger.info("Completed upgrade mode request but with failure", e);, +                                logger.info("Waited for tasks to be unassigned");, +                                if (r.getNodeFailures().isEmpty() == false) {, +                                    logger.info("There were node failures waiting for tasks", r.getNodeFailures().get(0));, +                                }, +                                logger.info("Caught node failures waiting for tasks to be unassigned", ex);, +            isolatedDatafeeds -> {, +                logger.info("Isolated the datafeeds");, +                unassignPersistentTasks(tasksCustomMetaData, unassignPersistentTasksListener);, +            },, +                    logger.info("Cluster state update is NOT acknowledged");, +                    logger.info("No tasks to worry about after state update");, +                    logger.info("Enabling upgrade mode, must isolate datafeeds");, +                    logger.info("Disabling upgrade mode, must wait for tasks to not have AWAITING_UPGRADE assignment");, +                        ActionListener.wrap(r -> {, +                            logger.info("Done waiting for tasks to be out of AWAITING_UPGRADE");, +                            wrappedListener.onResponse(new AcknowledgedResponse(true));, +                        }, wrappedListener::onFailure), +                    logger.info("Cluster update response built: " + acknowledged);, +                    logger.info("Executing cluster state update");]