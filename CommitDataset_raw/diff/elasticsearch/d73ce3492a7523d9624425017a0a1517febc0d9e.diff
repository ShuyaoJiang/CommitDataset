[+++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/BucketStreamContext.java, +    public void formatter(ValueFormatter formatter) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/BucketStreamContext.java, +    public void formatter(ValueFormatter formatter) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java, +    private final ValueFormatter formatter;, +    public HistogramAggregator(String name, AggregatorFactories factories, Rounding rounding, InternalOrder order, boolean keyed,, +            long minDocCount, @Nullable ExtendedBounds extendedBounds, @Nullable ValuesSource.Numeric valuesSource,, +            ValueFormatter formatter, InternalHistogram.Factory<?> histogramFactory, AggregationContext aggregationContext,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/BucketStreamContext.java, +    public void formatter(ValueFormatter formatter) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java, +    private final ValueFormatter formatter;, +    public HistogramAggregator(String name, AggregatorFactories factories, Rounding rounding, InternalOrder order, boolean keyed,, +            long minDocCount, @Nullable ExtendedBounds extendedBounds, @Nullable ValuesSource.Numeric valuesSource,, +            ValueFormatter formatter, InternalHistogram.Factory<?> histogramFactory, AggregationContext aggregationContext,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +        Bucket(boolean keyed, ValueFormatter formatter, InternalHistogram.Factory<Bucket> factory) {, +        Bucket(long key, long docCount, InternalAggregations aggregations, boolean keyed, ValueFormatter formatter,, +                ValueFormatter formatter) {, +        protected InternalDateHistogram.Bucket createEmptyBucket(boolean keyed, ValueFormatter formatter) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/BucketStreamContext.java, +    public void formatter(ValueFormatter formatter) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java, +    private final ValueFormatter formatter;, +    public HistogramAggregator(String name, AggregatorFactories factories, Rounding rounding, InternalOrder order, boolean keyed,, +            long minDocCount, @Nullable ExtendedBounds extendedBounds, @Nullable ValuesSource.Numeric valuesSource,, +            ValueFormatter formatter, InternalHistogram.Factory<?> histogramFactory, AggregationContext aggregationContext,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +        Bucket(boolean keyed, ValueFormatter formatter, InternalHistogram.Factory<Bucket> factory) {, +        Bucket(long key, long docCount, InternalAggregations aggregations, boolean keyed, ValueFormatter formatter,, +                ValueFormatter formatter) {, +        protected InternalDateHistogram.Bucket createEmptyBucket(boolean keyed, ValueFormatter formatter) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java, +        protected transient final ValueFormatter formatter;, +        public Bucket(boolean keyed, ValueFormatter formatter, Factory<?> factory) {, +        public Bucket(long key, long docCount, boolean keyed, ValueFormatter formatter, Factory factory,, +            if (formatter != ValueFormatter.RAW) {, +                EmptyBucketInfo emptyBucketInfo, ValueFormatter formatter, boolean keyed,, +        public B createBucket(Object key, long docCount, InternalAggregations aggregations, boolean keyed, ValueFormatter formatter) {, +        protected B createEmptyBucket(boolean keyed, ValueFormatter formatter) {, +    private ValueFormatter formatter;, +    InternalHistogram(String name, List<B> buckets, InternalOrder order, long minDocCount, EmptyBucketInfo emptyBucketInfo,, +            ValueFormatter formatter, boolean keyed, Factory<B> factory, List<PipelineAggregator> pipelineAggregators,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/BucketStreamContext.java, +    public void formatter(ValueFormatter formatter) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java, +    private final ValueFormatter formatter;, +    public HistogramAggregator(String name, AggregatorFactories factories, Rounding rounding, InternalOrder order, boolean keyed,, +            long minDocCount, @Nullable ExtendedBounds extendedBounds, @Nullable ValuesSource.Numeric valuesSource,, +            ValueFormatter formatter, InternalHistogram.Factory<?> histogramFactory, AggregationContext aggregationContext,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +        Bucket(boolean keyed, ValueFormatter formatter, InternalHistogram.Factory<Bucket> factory) {, +        Bucket(long key, long docCount, InternalAggregations aggregations, boolean keyed, ValueFormatter formatter,, +                ValueFormatter formatter) {, +        protected InternalDateHistogram.Bucket createEmptyBucket(boolean keyed, ValueFormatter formatter) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java, +        protected transient final ValueFormatter formatter;, +        public Bucket(boolean keyed, ValueFormatter formatter, Factory<?> factory) {, +        public Bucket(long key, long docCount, boolean keyed, ValueFormatter formatter, Factory factory,, +            if (formatter != ValueFormatter.RAW) {, +                EmptyBucketInfo emptyBucketInfo, ValueFormatter formatter, boolean keyed,, +        public B createBucket(Object key, long docCount, InternalAggregations aggregations, boolean keyed, ValueFormatter formatter) {, +        protected B createEmptyBucket(boolean keyed, ValueFormatter formatter) {, +    private ValueFormatter formatter;, +    InternalHistogram(String name, List<B> buckets, InternalOrder order, long minDocCount, EmptyBucketInfo emptyBucketInfo,, +            ValueFormatter formatter, boolean keyed, Factory<B> factory, List<PipelineAggregator> pipelineAggregators,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java, +        public Bucket(boolean keyed, ValueFormatter formatter) {, +        public Bucket(String key, double from, double to, long docCount, InternalAggregations aggregations, boolean keyed,, +                ValueFormatter formatter) {, +        protected String generateKey(double from, double to, ValueFormatter formatter) {, +            sb.append(Double.isInfinite(from) ? "*" : formatter.format(from));, +            sb.append(Double.isInfinite(to) ? "*" : formatter.format(to));, +        public R create(String name, List<B> ranges, ValueFormatter formatter, boolean keyed, List<PipelineAggregator> pipelineAggregators,, +                ValueFormatter formatter) {, +    public InternalRange(String name, List<B> ranges, ValueFormatter formatter, boolean keyed,, +            List<PipelineAggregator> pipelineAggregators,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/BucketStreamContext.java, +    public void formatter(ValueFormatter formatter) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java, +    private final ValueFormatter formatter;, +    public HistogramAggregator(String name, AggregatorFactories factories, Rounding rounding, InternalOrder order, boolean keyed,, +            long minDocCount, @Nullable ExtendedBounds extendedBounds, @Nullable ValuesSource.Numeric valuesSource,, +            ValueFormatter formatter, InternalHistogram.Factory<?> histogramFactory, AggregationContext aggregationContext,, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +        Bucket(boolean keyed, ValueFormatter formatter, InternalHistogram.Factory<Bucket> factory) {, +        Bucket(long key, long docCount, InternalAggregations aggregations, boolean keyed, ValueFormatter formatter,, +                ValueFormatter formatter) {, +        protected InternalDateHistogram.Bucket createEmptyBucket(boolean keyed, ValueFormatter formatter) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java, +        protected transient final ValueFormatter formatter;, +        public Bucket(boolean keyed, ValueFormatter formatter, Factory<?> factory) {, +        public Bucket(long key, long docCount, boolean keyed, ValueFormatter formatter, Factory factory,, +            if (formatter != ValueFormatter.RAW) {, +                EmptyBucketInfo emptyBucketInfo, ValueFormatter formatter, boolean keyed,, +        public B createBucket(Object key, long docCount, InternalAggregations aggregations, boolean keyed, ValueFormatter formatter) {, +        protected B createEmptyBucket(boolean keyed, ValueFormatter formatter) {, +    private ValueFormatter formatter;, +    InternalHistogram(String name, List<B> buckets, InternalOrder order, long minDocCount, EmptyBucketInfo emptyBucketInfo,]