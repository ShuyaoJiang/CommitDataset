[+++ b/distribution/rpm/build.gradle, +, +  // Declare the folders so that the RPM package manager removes, +  // them when upgrading or removing the package, +  directory('/usr/share/elasticsearch/bin', 0755), +  directory('/usr/share/elasticsearch/lib', 0755), +  directory('/usr/share/elasticsearch/modules', 0755), +  modulesFiles.eachFile { FileCopyDetails fcp ->, +    if (fcp.name == "plugin-descriptor.properties") {, +      directory('/usr/share/elasticsearch/modules/' + fcp.file.parentFile.name, 0755), +    }, +  }, +++ b/distribution/rpm/build.gradle, +, +  // Declare the folders so that the RPM package manager removes, +  // them when upgrading or removing the package, +  directory('/usr/share/elasticsearch/bin', 0755), +  directory('/usr/share/elasticsearch/lib', 0755), +  directory('/usr/share/elasticsearch/modules', 0755), +  modulesFiles.eachFile { FileCopyDetails fcp ->, +    if (fcp.name == "plugin-descriptor.properties") {, +      directory('/usr/share/elasticsearch/modules/' + fcp.file.parentFile.name, 0755), +    }, +  }, +++ b/qa/vagrant/src/test/resources/packaging/scripts/30_deb_package.bats, +    assert_file_not_exist "/usr/share/elasticsearch/modules", +    # Those directories are removed by the package manager, +    assert_file_not_exist "/usr/share/elasticsearch/bin", +    assert_file_not_exist "/usr/share/elasticsearch/lib", +    assert_file_not_exist "/usr/share/elasticsearch/modules", +    assert_file_not_exist "/usr/share/elasticsearch/modules/lang-painless", +, +++ b/distribution/rpm/build.gradle, +, +  // Declare the folders so that the RPM package manager removes, +  // them when upgrading or removing the package, +  directory('/usr/share/elasticsearch/bin', 0755), +  directory('/usr/share/elasticsearch/lib', 0755), +  directory('/usr/share/elasticsearch/modules', 0755), +  modulesFiles.eachFile { FileCopyDetails fcp ->, +    if (fcp.name == "plugin-descriptor.properties") {, +      directory('/usr/share/elasticsearch/modules/' + fcp.file.parentFile.name, 0755), +    }, +  }, +++ b/qa/vagrant/src/test/resources/packaging/scripts/30_deb_package.bats, +    assert_file_not_exist "/usr/share/elasticsearch/modules", +    # Those directories are removed by the package manager, +    assert_file_not_exist "/usr/share/elasticsearch/bin", +    assert_file_not_exist "/usr/share/elasticsearch/lib", +    assert_file_not_exist "/usr/share/elasticsearch/modules", +    assert_file_not_exist "/usr/share/elasticsearch/modules/lang-painless", +, +++ b/qa/vagrant/src/test/resources/packaging/scripts/40_rpm_package.bats, +    assert_file_not_exist "/usr/share/elasticsearch/modules", +    # Those directories are removed by the package manager, +    assert_file_not_exist "/usr/share/elasticsearch/bin", +    assert_file_not_exist "/usr/share/elasticsearch/lib", +    assert_file_not_exist "/usr/share/elasticsearch/modules", +    assert_file_not_exist "/usr/share/elasticsearch/modules/lang-painless", +, +    assert_file_not_exist "/usr/share/elasticsearch/modules", +    assert_file_not_exist "/usr/share/elasticsearch/bin", +    assert_file_not_exist "/usr/share/elasticsearch/lib", +    assert_file_not_exist "/usr/share/elasticsearch/modules", +    assert_file_not_exist "/usr/share/elasticsearch/modules/lang-painless", +]