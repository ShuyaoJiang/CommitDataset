[+++ b/core/src/main/java/org/elasticsearch/common/hash/MessageDigests.java, +    private static ThreadLocal<MessageDigest> createThreadLocalMessageDigest(String digest) {, +        return ThreadLocal.withInitial(() -> {, +                return MessageDigest.getInstance(digest);, +                throw new ElasticsearchException("unexpected exception creating MessageDigest instance for [" + digest + "]", e);, +        });, +    private static final ThreadLocal<MessageDigest> MD5_DIGEST = createThreadLocalMessageDigest("MD5");, +    private static final ThreadLocal<MessageDigest> SHA_1_DIGEST = createThreadLocalMessageDigest("SHA-1");, +    private static final ThreadLocal<MessageDigest> SHA_256_DIGEST = createThreadLocalMessageDigest("SHA-256");, +, +        return get(MD5_DIGEST);, +        return get(SHA_1_DIGEST);, +        return get(SHA_256_DIGEST);, +    private static MessageDigest get(ThreadLocal<MessageDigest> messageDigest) {, +        MessageDigest instance = messageDigest.get();, +        instance.reset();, +        return instance;, +, +]