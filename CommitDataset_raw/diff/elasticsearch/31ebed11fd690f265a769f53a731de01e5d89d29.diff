[+++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/field/function/sort/DoubleFieldsFunctionDataComparator.java, +import org.elasticsearch.script.search.SearchScript;, +    public static FieldComparatorSource comparatorSource(SearchScript script) {, +        return new InnerSource(script);, +        private final SearchScript script;, +        private InnerSource(SearchScript script) {, +            this.script = script;, +            return new DoubleFieldsFunctionDataComparator(numHits, script);, +    private final SearchScript script;, +    public DoubleFieldsFunctionDataComparator(int numHits, SearchScript script) {, +        this.script = script;, +        script.setNextReader(reader);, +        final double v2 = ((Number) script.execute(doc)).doubleValue();, +        values[slot] = ((Number) script.execute(doc)).doubleValue();, +++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/field/function/sort/DoubleFieldsFunctionDataComparator.java, +import org.elasticsearch.script.search.SearchScript;, +    public static FieldComparatorSource comparatorSource(SearchScript script) {, +        return new InnerSource(script);, +        private final SearchScript script;, +        private InnerSource(SearchScript script) {, +            this.script = script;, +            return new DoubleFieldsFunctionDataComparator(numHits, script);, +    private final SearchScript script;, +    public DoubleFieldsFunctionDataComparator(int numHits, SearchScript script) {, +        this.script = script;, +        script.setNextReader(reader);, +        final double v2 = ((Number) script.execute(doc)).doubleValue();, +        values[slot] = ((Number) script.execute(doc)).doubleValue();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/field/function/sort/StringFieldsFunctionDataComparator.java, +import org.elasticsearch.script.search.SearchScript;, +    public static FieldComparatorSource comparatorSource(SearchScript script) {, +        return new InnerSource(script);, +        private final SearchScript script;, +        private InnerSource(SearchScript script) {, +            this.script = script;, +            return new StringFieldsFunctionDataComparator(numHits, script);, +    private final SearchScript script;, +    public StringFieldsFunctionDataComparator(int numHits, SearchScript script) {, +        this.script = script;, +        script.setNextReader(reader);, +        final String val2 = script.execute(doc).toString();, +        values[slot] = script.execute(doc).toString();, +++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/field/function/sort/DoubleFieldsFunctionDataComparator.java, +import org.elasticsearch.script.search.SearchScript;, +    public static FieldComparatorSource comparatorSource(SearchScript script) {, +        return new InnerSource(script);, +        private final SearchScript script;, +        private InnerSource(SearchScript script) {, +            this.script = script;, +            return new DoubleFieldsFunctionDataComparator(numHits, script);, +    private final SearchScript script;, +    public DoubleFieldsFunctionDataComparator(int numHits, SearchScript script) {, +        this.script = script;, +        script.setNextReader(reader);, +        final double v2 = ((Number) script.execute(doc)).doubleValue();, +        values[slot] = ((Number) script.execute(doc)).doubleValue();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/field/function/sort/StringFieldsFunctionDataComparator.java, +import org.elasticsearch.script.search.SearchScript;, +    public static FieldComparatorSource comparatorSource(SearchScript script) {, +        return new InnerSource(script);, +        private final SearchScript script;, +        private InnerSource(SearchScript script) {, +            this.script = script;, +            return new StringFieldsFunctionDataComparator(numHits, script);, +    private final SearchScript script;, +    public StringFieldsFunctionDataComparator(int numHits, SearchScript script) {, +        this.script = script;, +        script.setNextReader(reader);, +        final String val2 = script.execute(doc).toString();, +        values[slot] = script.execute(doc).toString();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/query/xcontent/CustomScoreQueryParser.java, +import org.elasticsearch.common.collect.Maps;, +import org.elasticsearch.script.search.SearchScript;, +, +        SearchScript searchScript = new SearchScript(scriptLang, script, vars, parseContext.scriptService(), parseContext.mapperService(), parseContext.indexCache().fieldData());, +        FunctionScoreQuery functionScoreQuery = new FunctionScoreQuery(query, new ScriptScoreFunction(searchScript));, +        private final SearchScript script;, +        private Map<String, Object> vars = Maps.newHashMapWithExpectedSize(2);, +        private ScriptScoreFunction(SearchScript script) {, +            this.script = script;, +            script.setNextReader(reader);, +            return ((Number) script.execute(docId, vars)).floatValue();, +++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/field/function/sort/DoubleFieldsFunctionDataComparator.java, +import org.elasticsearch.script.search.SearchScript;, +    public static FieldComparatorSource comparatorSource(SearchScript script) {, +        return new InnerSource(script);, +        private final SearchScript script;, +        private InnerSource(SearchScript script) {, +            this.script = script;]