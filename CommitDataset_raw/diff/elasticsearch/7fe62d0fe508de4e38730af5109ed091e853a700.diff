[+++ b/server/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java, +            AtomicBoolean recoveryDone = new AtomicBoolean(false);, +                    public void finalizeRecovery(long globalCheckpoint, ActionListener<Void> listener) {, +                        recoveryDone.set(true);, +                        super.finalizeRecovery(globalCheckpoint, listener);, +            assertBusy(() -> assertTrue("recovery should not wait for on pending docs", recoveryDone.get()));]