[+++ b/server/src/main/java/org/elasticsearch/index/seqno/ReplicationTracker.java, +    private Collection<RetentionLease> copyRetentionLeases() {, +        assert Thread.holdsLock(this);, +        return Collections.unmodifiableCollection(new ArrayList<>(retentionLeases.values()));, +    }, +, +            currentRetentionLeases = copyRetentionLeases();, +        onNewRetentionLease.accept(currentRetentionLeases, listener);]