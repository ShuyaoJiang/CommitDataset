[+++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractInternalPercentiles.java, +                if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +                if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractInternalPercentiles.java, +                if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +                if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractInternalPercentiles.java, +                if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +                if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/InternalExtendedStats.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractInternalPercentiles.java, +                if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +                if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/InternalExtendedStats.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSum.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java, +        if (hasValue && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractInternalPercentiles.java, +                if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +                if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/InternalExtendedStats.java, +        if (count != 0 && valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSum.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {, +++ b/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCount.java, +        if (valueFormatter != null && !(valueFormatter instanceof ValueFormatter.Raw)) {]