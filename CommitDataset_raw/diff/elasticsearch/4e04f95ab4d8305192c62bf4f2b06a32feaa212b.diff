[+++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/NettyTcpChannel.java, +import io.netty.channel.ChannelPromise;, +import org.elasticsearch.ElasticsearchException;, +import org.elasticsearch.transport.TransportException;, +import java.nio.channels.ClosedSelectorException;, +        ChannelPromise writePromise = channel.newPromise();, +        writePromise.addListener(f -> {, +        channel.writeAndFlush(Netty4Utils.toByteBuf(reference), writePromise);, +        , +        if (channel.eventLoop().isShutdown()) {, +            listener.onFailure(new TransportException("Cannot send message, event loop is shutting down."));, +        }]