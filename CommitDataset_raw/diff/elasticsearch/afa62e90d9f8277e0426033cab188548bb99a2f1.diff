[+++ b/src/main/java/org/elasticsearch/index/shard/service/IndexShard.java, +import org.elasticsearch.index.shard.*;, +    ShardId shardId();, +, +++ b/src/main/java/org/elasticsearch/index/shard/service/IndexShard.java, +import org.elasticsearch.index.shard.*;, +    ShardId shardId();, +, +++ b/src/main/java/org/elasticsearch/search/SearchService.java, +import org.elasticsearch.index.Index;, +        indicesService.indicesLifecycle().addListener(new IndicesLifecycle.Listener() {, +, +            @Override, +            public void afterIndexDeleted(Index index) {, +                // once an index is closed we can just clean up all the pending search context information, +                // to release memory and let references to the filesystem go etc., +                freeAllContextForIndex(index);, +            }, +        });, +    private void freeAllContextForIndex(Index index) {, +        assert index != null;, +        for (SearchContext ctx : activeContexts.values()) {, +            if (index.equals(ctx.indexShard().shardId().index())) {, +                freeContext(ctx.id());, +            }, +        }, +    }, +, +]