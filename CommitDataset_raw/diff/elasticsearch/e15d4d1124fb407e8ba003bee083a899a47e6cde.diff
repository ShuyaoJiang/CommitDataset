[+++ b/src/main/java/org/elasticsearch/common/unit/TimeValue.java, +    /**, +     * serialization converts TimeValue internally to NANOSECONDS, +     */, +        return timeUnit.toNanos(duration) == timeValue.timeUnit.toNanos(timeValue.duration);, +        long normalized = timeUnit.toNanos(duration);, +        return (int) (normalized ^ (normalized >>> 32));, +++ b/src/main/java/org/elasticsearch/common/unit/TimeValue.java, +    /**, +     * serialization converts TimeValue internally to NANOSECONDS, +     */, +        return timeUnit.toNanos(duration) == timeValue.timeUnit.toNanos(timeValue.duration);, +        long normalized = timeUnit.toNanos(duration);, +        return (int) (normalized ^ (normalized >>> 32));, +++ b/src/test/java/org/elasticsearch/common/unit/TimeValueTests.java, +import org.elasticsearch.common.io.stream.BytesStreamInput;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +import java.io.IOException;, +, +    private void assertEqualityAfterSerialize(TimeValue value) throws IOException {, +        BytesStreamOutput out = new BytesStreamOutput();, +        value.writeTo(out);, +, +        BytesStreamInput in = new BytesStreamInput(out.bytes());, +        TimeValue inValue = TimeValue.readTimeValue(in);, +, +        assertThat(inValue, equalTo(value));, +    }, +, +    @Test, +    public void testSerialize() throws Exception {, +        assertEqualityAfterSerialize(new TimeValue(100, TimeUnit.DAYS));, +        assertEqualityAfterSerialize(new TimeValue(-1));, +        assertEqualityAfterSerialize(new TimeValue(1, TimeUnit.NANOSECONDS));, +, +    }]