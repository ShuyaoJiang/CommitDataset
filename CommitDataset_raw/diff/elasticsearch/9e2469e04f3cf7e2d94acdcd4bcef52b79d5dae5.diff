[+++ b/src/main/java/org/elasticsearch/index/engine/robin/RobinEngine.java, +            config.setSimilarity(similarityService.similarity());, +            searcher.setSimilarity(similarityService.similarity());, +++ b/src/main/java/org/elasticsearch/index/engine/robin/RobinEngine.java, +            config.setSimilarity(similarityService.similarity());, +            searcher.setSimilarity(similarityService.similarity());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +import org.elasticsearch.index.similarity.SimilarityLookupService;, +    private final SimilarityLookupService similarityLookupService;, +    public DocumentMapperParser(Index index, AnalysisService analysisService, PostingsFormatService postingsFormatService,, +                                SimilarityLookupService similarityLookupService) {, +        this(index, ImmutableSettings.Builder.EMPTY_SETTINGS, analysisService, postingsFormatService, similarityLookupService);, +    public DocumentMapperParser(Index index, @IndexSettings Settings indexSettings, AnalysisService analysisService,, +                                PostingsFormatService postingsFormatService, SimilarityLookupService similarityLookupService) {, +        this.similarityLookupService = similarityLookupService;, +        return new Mapper.TypeParser.ParserContext(postingsFormatService, analysisService, similarityLookupService, typeParsers);, +        Mapper.TypeParser.ParserContext parserContext = new Mapper.TypeParser.ParserContext(postingsFormatService, analysisService, similarityLookupService, typeParsers);, +++ b/src/main/java/org/elasticsearch/index/engine/robin/RobinEngine.java, +            config.setSimilarity(similarityService.similarity());, +            searcher.setSimilarity(similarityService.similarity());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +import org.elasticsearch.index.similarity.SimilarityLookupService;, +    private final SimilarityLookupService similarityLookupService;, +    public DocumentMapperParser(Index index, AnalysisService analysisService, PostingsFormatService postingsFormatService,, +                                SimilarityLookupService similarityLookupService) {, +        this(index, ImmutableSettings.Builder.EMPTY_SETTINGS, analysisService, postingsFormatService, similarityLookupService);, +    public DocumentMapperParser(Index index, @IndexSettings Settings indexSettings, AnalysisService analysisService,, +                                PostingsFormatService postingsFormatService, SimilarityLookupService similarityLookupService) {, +        this.similarityLookupService = similarityLookupService;, +        return new Mapper.TypeParser.ParserContext(postingsFormatService, analysisService, similarityLookupService, typeParsers);, +        Mapper.TypeParser.ParserContext parserContext = new Mapper.TypeParser.ParserContext(postingsFormatService, analysisService, similarityLookupService, typeParsers);, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +import org.elasticsearch.index.similarity.SimilarityProvider;, +     * Similarity used for scoring queries on the field, +     */, +    SimilarityProvider similarity();, +, +    /**, +++ b/src/main/java/org/elasticsearch/index/engine/robin/RobinEngine.java, +            config.setSimilarity(similarityService.similarity());, +            searcher.setSimilarity(similarityService.similarity());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +import org.elasticsearch.index.similarity.SimilarityLookupService;, +    private final SimilarityLookupService similarityLookupService;, +    public DocumentMapperParser(Index index, AnalysisService analysisService, PostingsFormatService postingsFormatService,, +                                SimilarityLookupService similarityLookupService) {, +        this(index, ImmutableSettings.Builder.EMPTY_SETTINGS, analysisService, postingsFormatService, similarityLookupService);, +    public DocumentMapperParser(Index index, @IndexSettings Settings indexSettings, AnalysisService analysisService,, +                                PostingsFormatService postingsFormatService, SimilarityLookupService similarityLookupService) {, +        this.similarityLookupService = similarityLookupService;, +        return new Mapper.TypeParser.ParserContext(postingsFormatService, analysisService, similarityLookupService, typeParsers);, +        Mapper.TypeParser.ParserContext parserContext = new Mapper.TypeParser.ParserContext(postingsFormatService, analysisService, similarityLookupService, typeParsers);, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +import org.elasticsearch.index.similarity.SimilarityProvider;, +     * Similarity used for scoring queries on the field, +     */, +    SimilarityProvider similarity();, +, +    /**, +++ b/src/main/java/org/elasticsearch/index/mapper/Mapper.java, +import org.elasticsearch.index.similarity.SimilarityLookupService;, +            private final SimilarityLookupService similarityLookupService;, +, +            public ParserContext(PostingsFormatService postingsFormatService, AnalysisService analysisService,, +                                 SimilarityLookupService similarityLookupService, ImmutableMap<String, TypeParser> typeParsers) {, +                this.similarityLookupService = similarityLookupService;, +            public SimilarityLookupService similarityLookupService() {, +                return similarityLookupService;, +            }, +, +++ b/src/main/java/org/elasticsearch/index/engine/robin/RobinEngine.java, +            config.setSimilarity(similarityService.similarity());, +            searcher.setSimilarity(similarityService.similarity());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +import org.elasticsearch.index.similarity.SimilarityLookupService;, +    private final SimilarityLookupService similarityLookupService;, +    public DocumentMapperParser(Index index, AnalysisService analysisService, PostingsFormatService postingsFormatService,, +                                SimilarityLookupService similarityLookupService) {, +        this(index, ImmutableSettings.Builder.EMPTY_SETTINGS, analysisService, postingsFormatService, similarityLookupService);, +    public DocumentMapperParser(Index index, @IndexSettings Settings indexSettings, AnalysisService analysisService,, +                                PostingsFormatService postingsFormatService, SimilarityLookupService similarityLookupService) {, +        this.similarityLookupService = similarityLookupService;, +        return new Mapper.TypeParser.ParserContext(postingsFormatService, analysisService, similarityLookupService, typeParsers);, +        Mapper.TypeParser.ParserContext parserContext = new Mapper.TypeParser.ParserContext(postingsFormatService, analysisService, similarityLookupService, typeParsers);, +++ b/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +import org.elasticsearch.index.similarity.SimilarityProvider;, +     * Similarity used for scoring queries on the field, +     */, +    SimilarityProvider similarity();, +, +    /**, +++ b/src/main/java/org/elasticsearch/index/mapper/Mapper.java, +import org.elasticsearch.index.similarity.SimilarityLookupService;, +            private final SimilarityLookupService similarityLookupService;, +, +            public ParserContext(PostingsFormatService postingsFormatService, AnalysisService analysisService,, +                                 SimilarityLookupService similarityLookupService, ImmutableMap<String, TypeParser> typeParsers) {, +                this.similarityLookupService = similarityLookupService;, +            public SimilarityLookupService similarityLookupService() {, +                return similarityLookupService;]