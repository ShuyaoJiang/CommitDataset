[+++ b/plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java, +            List<TransportAddress> dynamicHosts = provider.buildDynamicHosts(null);, +            provider.buildDynamicHosts(null);, +                provider.buildDynamicHosts(null);, +                provider.buildDynamicHosts(null);, +++ b/plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java, +            List<TransportAddress> dynamicHosts = provider.buildDynamicHosts(null);, +            provider.buildDynamicHosts(null);, +                provider.buildDynamicHosts(null);, +                provider.buildDynamicHosts(null);, +++ b/plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java, +            () -> new FileBasedUnicastHostsProvider(new Environment(settings, configPath)));, +++ b/plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java, +            List<TransportAddress> dynamicHosts = provider.buildDynamicHosts(null);, +            provider.buildDynamicHosts(null);, +                provider.buildDynamicHosts(null);, +                provider.buildDynamicHosts(null);, +++ b/plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java, +            () -> new FileBasedUnicastHostsProvider(new Environment(settings, configPath)));, +++ b/plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProvider.java, +    FileBasedUnicastHostsProvider(Environment environment) {, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +        final List<TransportAddress> dynamicHosts = hostsResolver.resolveHosts(hostsList, 1);, +++ b/plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java, +            List<TransportAddress> dynamicHosts = provider.buildDynamicHosts(null);, +            provider.buildDynamicHosts(null);, +                provider.buildDynamicHosts(null);, +                provider.buildDynamicHosts(null);, +++ b/plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java, +            () -> new FileBasedUnicastHostsProvider(new Environment(settings, configPath)));, +++ b/plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProvider.java, +    FileBasedUnicastHostsProvider(Environment environment) {, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +        final List<TransportAddress> dynamicHosts = hostsResolver.resolveHosts(hostsList, 1);, +++ b/plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProviderTests.java, +import org.elasticsearch.common.unit.TimeValue;, +import org.elasticsearch.discovery.zen.UnicastZenPing;, +        final FileBasedUnicastHostsProvider provider = new FileBasedUnicastHostsProvider(environment);, +        final List<TransportAddress> addresses = provider.buildDynamicHosts((hosts, limitPortCounts) ->, +            UnicastZenPing.resolveHostsLists(executorService, logger, hosts, limitPortCounts, transportService,, +                TimeValue.timeValueSeconds(10)));, +                new Environment(settings, configPath)).buildDynamicHosts((hosts, limitPortCounts) ->, +                    UnicastZenPing.resolveHostsLists(executorService, logger, hosts, limitPortCounts, transportService,, +                        TimeValue.timeValueSeconds(10)));, +++ b/plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java, +            List<TransportAddress> dynamicHosts = provider.buildDynamicHosts(null);, +            provider.buildDynamicHosts(null);, +                provider.buildDynamicHosts(null);, +                provider.buildDynamicHosts(null);, +++ b/plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java, +            () -> new FileBasedUnicastHostsProvider(new Environment(settings, configPath)));, +++ b/plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProvider.java, +    FileBasedUnicastHostsProvider(Environment environment) {, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +        final List<TransportAddress> dynamicHosts = hostsResolver.resolveHosts(hostsList, 1);, +++ b/plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProviderTests.java, +import org.elasticsearch.common.unit.TimeValue;, +import org.elasticsearch.discovery.zen.UnicastZenPing;, +        final FileBasedUnicastHostsProvider provider = new FileBasedUnicastHostsProvider(environment);, +        final List<TransportAddress> addresses = provider.buildDynamicHosts((hosts, limitPortCounts) ->, +            UnicastZenPing.resolveHostsLists(executorService, logger, hosts, limitPortCounts, transportService,, +                TimeValue.timeValueSeconds(10)));, +                new Environment(settings, configPath)).buildDynamicHosts((hosts, limitPortCounts) ->, +                    UnicastZenPing.resolveHostsLists(executorService, logger, hosts, limitPortCounts, transportService,, +                        TimeValue.timeValueSeconds(10)));, +++ b/plugins/discovery-gce/src/main/java/org/elasticsearch/discovery/gce/GceUnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java, +    public List<TransportAddress> buildDynamicHosts(HostsResolver hostsResolver) {, +++ b/plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java, +            List<TransportAddress> dynamicHosts = provider.buildDynamicHosts(null);, +            provider.buildDynamicHosts(null);]