[+++ b/src/test/java/org/elasticsearch/cluster/ClusterServiceTests.java, +import com.google.common.base.Predicate;, +        final ClusterService clusterService2 = cluster().getInstance(ClusterService.class, node_1);, +        awaitBusy(new Predicate<Object>() {, +            public boolean apply(Object obj) {, +                return clusterService2.state().nodes().masterNode() == null;, +            }, +        });, +++ b/src/test/java/org/elasticsearch/cluster/ClusterServiceTests.java, +import com.google.common.base.Predicate;, +        final ClusterService clusterService2 = cluster().getInstance(ClusterService.class, node_1);, +        awaitBusy(new Predicate<Object>() {, +            public boolean apply(Object obj) {, +                return clusterService2.state().nodes().masterNode() == null;, +            }, +        });, +++ b/src/test/java/org/elasticsearch/gateway/local/QuorumLocalGatewayTests.java, +        // we are shutting down nodes - make sure we don't have 2 clusters if we test network, +        setMinimumMasterNodes(2);]