[+++ b/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java, +            if (request.upsertRequest() == null) {, +            IndexRequest indexRequest = request.upsertRequest();, +++ b/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java, +            if (request.upsertRequest() == null) {, +            IndexRequest indexRequest = request.upsertRequest();, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +    private IndexRequest upsertRequest;, +    public UpdateRequest upsert(IndexRequest upsertRequest) {, +        this.upsertRequest = upsertRequest;, +    public UpdateRequest upsert(XContentBuilder source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(Map source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(Map source, XContentType contentType) {, +        safeUpsertRequest().source(source, contentType);, +    public UpdateRequest upsert(String source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(byte[] source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(byte[] source, int offset, int length) {, +        safeUpsertRequest().source(source, offset, length);, +    public IndexRequest upsertRequest() {, +        return this.upsertRequest;, +    private IndexRequest safeUpsertRequest() {, +        if (upsertRequest == null) {, +            upsertRequest = new IndexRequest();, +        return upsertRequest;, +            upsertRequest = new IndexRequest();, +            upsertRequest.readFrom(in);, +        if (upsertRequest == null) {, +            upsertRequest.index(index);, +            upsertRequest.type(type);, +            upsertRequest.id(id);, +            upsertRequest.writeTo(out);, +++ b/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java, +            if (request.upsertRequest() == null) {, +            IndexRequest indexRequest = request.upsertRequest();, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +    private IndexRequest upsertRequest;, +    public UpdateRequest upsert(IndexRequest upsertRequest) {, +        this.upsertRequest = upsertRequest;, +    public UpdateRequest upsert(XContentBuilder source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(Map source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(Map source, XContentType contentType) {, +        safeUpsertRequest().source(source, contentType);, +    public UpdateRequest upsert(String source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(byte[] source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(byte[] source, int offset, int length) {, +        safeUpsertRequest().source(source, offset, length);, +    public IndexRequest upsertRequest() {, +        return this.upsertRequest;, +    private IndexRequest safeUpsertRequest() {, +        if (upsertRequest == null) {, +            upsertRequest = new IndexRequest();, +        return upsertRequest;, +            upsertRequest = new IndexRequest();, +            upsertRequest.readFrom(in);, +        if (upsertRequest == null) {, +            upsertRequest.index(index);, +            upsertRequest.type(type);, +            upsertRequest.id(id);, +            upsertRequest.writeTo(out);, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java, +    public UpdateRequestBuilder setUpsert(IndexRequest indexRequest) {, +        request.upsert(indexRequest);, +    public UpdateRequestBuilder setUpsert(XContentBuilder source) {, +        request.upsert(source);, +    public UpdateRequestBuilder setUpsert(Map source) {, +        request.upsert(source);, +    public UpdateRequestBuilder setUpsert(Map source, XContentType contentType) {, +        request.upsert(source, contentType);, +    public UpdateRequestBuilder setUpsert(String source) {, +        request.upsert(source);, +    public UpdateRequestBuilder setUpsert(byte[] source) {, +        request.upsert(source);, +    public UpdateRequestBuilder setUpsert(byte[] source, int offset, int length) {, +        request.upsert(source, offset, length);, +++ b/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java, +            if (request.upsertRequest() == null) {, +            IndexRequest indexRequest = request.upsertRequest();, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +    private IndexRequest upsertRequest;, +    public UpdateRequest upsert(IndexRequest upsertRequest) {, +        this.upsertRequest = upsertRequest;, +    public UpdateRequest upsert(XContentBuilder source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(Map source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(Map source, XContentType contentType) {, +        safeUpsertRequest().source(source, contentType);, +    public UpdateRequest upsert(String source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(byte[] source) {, +        safeUpsertRequest().source(source);, +    public UpdateRequest upsert(byte[] source, int offset, int length) {]