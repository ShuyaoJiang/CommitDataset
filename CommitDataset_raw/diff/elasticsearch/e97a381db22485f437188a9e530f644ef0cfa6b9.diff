[+++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    public AnalyzerMapper analyzerMapper() {, +        return rootMapper(AnalyzerMapper.class);, +    }, +, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    public AnalyzerMapper analyzerMapper() {, +        return rootMapper(AnalyzerMapper.class);, +    }, +, +++ b/src/main/java/org/elasticsearch/index/mapper/internal/AnalyzerMapper.java, +import org.elasticsearch.search.highlight.HighlighterContext;, +    public Analyzer setAnalyzer(HighlighterContext context){, +        if (context.analyzer() != null){, +            return context.analyzer();, +        }, +, +        Analyzer analyzer = null;, +, +        if (path != null) {, +            String analyzerName = (String) context.context.lookup().source().extractValue(path);, +            analyzer = context.context.mapperService().analysisService().analyzer(analyzerName);, +        }, +, +        if (analyzer == null) {, +            analyzer = context.context.mapperService().documentMapper(context.hitContext.hit().type()).mappers().indexAnalyzer();, +        }, +        context.analyzer(analyzer);, +, +        return analyzer;, +    }, +, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    public AnalyzerMapper analyzerMapper() {, +        return rootMapper(AnalyzerMapper.class);, +    }, +, +++ b/src/main/java/org/elasticsearch/index/mapper/internal/AnalyzerMapper.java, +import org.elasticsearch.search.highlight.HighlighterContext;, +    public Analyzer setAnalyzer(HighlighterContext context){, +        if (context.analyzer() != null){, +            return context.analyzer();, +        }, +, +        Analyzer analyzer = null;, +, +        if (path != null) {, +            String analyzerName = (String) context.context.lookup().source().extractValue(path);, +            analyzer = context.context.mapperService().analysisService().analyzer(analyzerName);, +        }, +, +        if (analyzer == null) {, +            analyzer = context.context.mapperService().documentMapper(context.hitContext.hit().type()).mappers().indexAnalyzer();, +        }, +        context.analyzer(analyzer);, +, +        return analyzer;, +    }, +, +++ b/src/main/java/org/elasticsearch/search/highlight/HighlighterContext.java, +import org.apache.lucene.analysis.Analyzer;, +    private Analyzer analyzer;, +, +    public Analyzer analyzer() {, +        return this.analyzer;, +    }, +, +    public void analyzer(Analyzer analyzer) {, +        this.analyzer = analyzer;, +    }, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    public AnalyzerMapper analyzerMapper() {, +        return rootMapper(AnalyzerMapper.class);, +    }, +, +++ b/src/main/java/org/elasticsearch/index/mapper/internal/AnalyzerMapper.java, +import org.elasticsearch.search.highlight.HighlighterContext;, +    public Analyzer setAnalyzer(HighlighterContext context){, +        if (context.analyzer() != null){, +            return context.analyzer();, +        }, +, +        Analyzer analyzer = null;, +, +        if (path != null) {, +            String analyzerName = (String) context.context.lookup().source().extractValue(path);, +            analyzer = context.context.mapperService().analysisService().analyzer(analyzerName);, +        }, +, +        if (analyzer == null) {, +            analyzer = context.context.mapperService().documentMapper(context.hitContext.hit().type()).mappers().indexAnalyzer();, +        }, +        context.analyzer(analyzer);, +, +        return analyzer;, +    }, +, +++ b/src/main/java/org/elasticsearch/search/highlight/HighlighterContext.java, +import org.apache.lucene.analysis.Analyzer;, +    private Analyzer analyzer;]