[+++ b/core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                return currentFieldType.fuzzyQuery(termStr, Fuzziness.build(minSimilarity), fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +        //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed , +        FuzzyQuery query = new FuzzyQuery(term, numEdits, prefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                return currentFieldType.fuzzyQuery(termStr, Fuzziness.build(minSimilarity), fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +        //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed , +        FuzzyQuery query = new FuzzyQuery(term, numEdits, prefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/core/src/main/java/org/elasticsearch/index/query/FuzzyQueryParser.java, +        boolean transpositions = false;, +++ b/core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                return currentFieldType.fuzzyQuery(termStr, Fuzziness.build(minSimilarity), fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +        //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed , +        FuzzyQuery query = new FuzzyQuery(term, numEdits, prefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/core/src/main/java/org/elasticsearch/index/query/FuzzyQueryParser.java, +        boolean transpositions = false;, +++ b/core/src/main/java/org/elasticsearch/index/search/MatchQuery.java, +    //LUCENE 4 UPGRADE we need a default value for this!, +    protected boolean transpositions = false;, +++ b/core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java, +                //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed, +                return currentFieldType.fuzzyQuery(termStr, Fuzziness.build(minSimilarity), fuzzyPrefixLength, settings.fuzzyMaxExpansions(), false);, +        //LUCENE 4 UPGRADE I disabled transpositions here by default - maybe this needs to be changed , +        FuzzyQuery query = new FuzzyQuery(term, numEdits, prefixLength, settings.fuzzyMaxExpansions(), false);, +++ b/core/src/main/java/org/elasticsearch/index/query/FuzzyQueryParser.java, +        boolean transpositions = false;, +++ b/core/src/main/java/org/elasticsearch/index/search/MatchQuery.java, +    //LUCENE 4 UPGRADE we need a default value for this!, +    protected boolean transpositions = false;, +++ b/dev-tools/src/main/resources/ant/integration-tests.xml, +  <!-- this is our working area -->, +  <property name="integ.scratch" location="${project.build.directory}/integ-tests"/>, +, +  <!-- our pid file for easy cleanup -->, +  <property name="integ.pidfile" location="${integ.scratch}/es.pid"/>, +, +  <!-- if this exists, ES is running (maybe) -->, +  <available property="integ.pidfile.exists" file="${integ.pidfile}"/>, +, +  <!-- arguments passed to elasticsearch when running -->, +  <property name="integ.args", +            value="-d -Des.node.name=smoke_tester -Des.cluster.name=prepare_release, +                   -Des.discovery.zen.ping.multicast.enabled=false -Des.script.inline=on, +                   -Des.script.indexed=on -p ${integ.pidfile}"/>, +, +  <target name="start-external-cluster" depends="stop-external-cluster" unless="${shouldskip}">, +    <delete dir="${integ.scratch}"/>, +    <run-script dir="${integ.home}" script="bin/elasticsearch" args="${integ.args} -Des.path.repo=${integ.repo.home}"/>, +  <target name="start-external-cluster-with-plugin" depends="stop-external-cluster" unless="${shouldskip}">, +    <delete dir="${integ.scratch}"/>, +    <run-script dir="${integ.home}" script="bin/elasticsearch" args="${integ.args} -Des.path.repo=${integ.repo.home}"/>, +  <!-- TODO, for some more safety, add back some of the old jps logic, +       and verify the pid is really an ES process! (fail otherwise) -->, +  <target name="stop-external-cluster" if="integ.pidfile.exists">, +    <!-- read contents of the pid file -->, +    <loadfile srcFile="${integ.pidfile}" property="integ.pid">, +      <filterchain>, +        <striplinebreaks/>, +      </filterchain>, +    </loadfile>, +    <echo>Shutting down external cluster PID ${integ.pid}</echo>, +    <exec executable="taskkill" failonerror="true" osfamily="winnt">, +      <arg value="${integ.pid}"/>, +    <exec executable="kill" failonerror="true" osfamily="unix">, +      <arg value="${integ.pid}"/>, +    <delete file="${integ.pidfile}"/>]