[+++ b/test/framework/src/main/java/org/elasticsearch/test/store/MockFSDirectoryService.java, +        delegateService = randomDirectoryService(indexStore, path);, +    private FsDirectoryService randomDirectoryService(IndexStore indexStore, ShardPath path) {, +        final IndexMetaData build = IndexMetaData.builder(indexSettings.getIndexMetaData()), +            .settings(Settings.builder(), +                .put(indexSettings.getSettings().getAsMap()) // do not copy the secure settings as they will be copied again later on!, +                .put(IndexModule.INDEX_STORE_TYPE_SETTING.getKey(),, +                    RandomPicks.randomFrom(random, IndexModule.Type.values()).getSettingsKey())), +            .build();]