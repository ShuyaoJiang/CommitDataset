[+++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +            process = new ProcessStats(in);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +            process = new ProcessStats(in);, +++ b/core/src/main/java/org/elasticsearch/client/transport/support/TransportProxyClient.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +            process = new ProcessStats(in);, +++ b/core/src/main/java/org/elasticsearch/client/transport/support/TransportProxyClient.java, +++ b/core/src/main/java/org/elasticsearch/monitor/process/ProcessProbe.java, +        ProcessStats.Cpu cpu = new ProcessStats.Cpu(getProcessCpuPercent(), getProcessCpuTotalTime());, +        ProcessStats.Mem mem = new ProcessStats.Mem(getTotalVirtualMemorySize());, +        return new ProcessStats(System.currentTimeMillis(), getOpenFileDescriptorCount(), getMaxFileDescriptorCount(), cpu, mem);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +            process = new ProcessStats(in);, +++ b/core/src/main/java/org/elasticsearch/client/transport/support/TransportProxyClient.java, +++ b/core/src/main/java/org/elasticsearch/monitor/process/ProcessProbe.java, +        ProcessStats.Cpu cpu = new ProcessStats.Cpu(getProcessCpuPercent(), getProcessCpuTotalTime());, +        ProcessStats.Mem mem = new ProcessStats.Mem(getTotalVirtualMemorySize());, +        return new ProcessStats(System.currentTimeMillis(), getOpenFileDescriptorCount(), getMaxFileDescriptorCount(), cpu, mem);, +++ b/core/src/main/java/org/elasticsearch/monitor/process/ProcessStats.java, +import org.elasticsearch.common.io.stream.Writeable;, +public class ProcessStats implements Writeable, ToXContent {, +    private final long timestamp;, +    private final long openFileDescriptors;, +    private final long maxFileDescriptors;, +    private final Cpu cpu;, +    private final Mem mem;, +    public ProcessStats(long timestamp, long openFileDescriptors, long maxFileDescriptors, Cpu cpu, Mem mem) {, +        this.timestamp = timestamp;, +        this.openFileDescriptors = openFileDescriptors;, +        this.maxFileDescriptors = maxFileDescriptors;, +        this.cpu = cpu;, +        this.mem = mem;, +    }, +    public ProcessStats(StreamInput in) throws IOException {, +        timestamp = in.readVLong();, +        openFileDescriptors = in.readLong();, +        maxFileDescriptors = in.readLong();, +        cpu = in.readOptionalWriteable(Cpu::new);, +        mem = in.readOptionalWriteable(Mem::new);, +    }, +    @Override, +    public void writeTo(StreamOutput out) throws IOException {, +        out.writeVLong(timestamp);, +        out.writeLong(openFileDescriptors);, +        out.writeLong(maxFileDescriptors);, +        out.writeOptionalWriteable(cpu);, +        out.writeOptionalWriteable(mem);, +    public static class Mem implements Writeable {, +, +        private final long totalVirtual;, +, +        public Mem(long totalVirtual) {, +            this.totalVirtual = totalVirtual;, +        public Mem(StreamInput in) throws IOException {, +    public static class Cpu implements Writeable {, +        private final short percent;, +        private final long total;, +        public Cpu(short percent, long total) {, +            this.percent = percent;, +            this.total = total;, +        public Cpu(StreamInput in) throws IOException {, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +            process = new ProcessStats(in);, +++ b/core/src/main/java/org/elasticsearch/client/transport/support/TransportProxyClient.java, +++ b/core/src/main/java/org/elasticsearch/monitor/process/ProcessProbe.java, +        ProcessStats.Cpu cpu = new ProcessStats.Cpu(getProcessCpuPercent(), getProcessCpuTotalTime());, +        ProcessStats.Mem mem = new ProcessStats.Mem(getTotalVirtualMemorySize());, +        return new ProcessStats(System.currentTimeMillis(), getOpenFileDescriptorCount(), getMaxFileDescriptorCount(), cpu, mem);, +++ b/core/src/main/java/org/elasticsearch/monitor/process/ProcessStats.java, +import org.elasticsearch.common.io.stream.Writeable;, +public class ProcessStats implements Writeable, ToXContent {, +    private final long timestamp;, +    private final long openFileDescriptors;, +    private final long maxFileDescriptors;, +    private final Cpu cpu;, +    private final Mem mem;, +    public ProcessStats(long timestamp, long openFileDescriptors, long maxFileDescriptors, Cpu cpu, Mem mem) {, +        this.timestamp = timestamp;, +        this.openFileDescriptors = openFileDescriptors;, +        this.maxFileDescriptors = maxFileDescriptors;, +        this.cpu = cpu;, +        this.mem = mem;, +    }, +    public ProcessStats(StreamInput in) throws IOException {, +        timestamp = in.readVLong();, +        openFileDescriptors = in.readLong();, +        maxFileDescriptors = in.readLong();, +        cpu = in.readOptionalWriteable(Cpu::new);, +        mem = in.readOptionalWriteable(Mem::new);, +    }, +    @Override, +    public void writeTo(StreamOutput out) throws IOException {, +        out.writeVLong(timestamp);, +        out.writeLong(openFileDescriptors);, +        out.writeLong(maxFileDescriptors);, +        out.writeOptionalWriteable(cpu);, +        out.writeOptionalWriteable(mem);, +    public static class Mem implements Writeable {, +]