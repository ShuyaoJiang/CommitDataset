[+++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/liveness/LivenessResponse.java, +        if (node == null) {, +            out.writeBoolean(false);, +        } else {, +            out.writeBoolean(true);, +            node.writeTo(out);, +        }, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/liveness/LivenessResponse.java, +        if (node == null) {, +            out.writeBoolean(false);, +        } else {, +            out.writeBoolean(true);, +            node.writeTo(out);, +        }, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +import java.util.HashMap;, +import java.util.Map;, +        static final String COORDINATING_ONLY = "coordinating_only";, +, +        private int total;, +        private Map<String, Integer> roles;, +, +        Counts() {, +            roles = new HashMap<>();, +            for (DiscoveryNode.Role role : DiscoveryNode.Role.values()) {, +                roles.put(role.getRoleName(), 0);, +            }, +            roles.put(COORDINATING_ONLY, 0);, +        }, +            if (nodeInfo.getNode().getRoles().size() == 0) {, +                Integer count = roles.get(COORDINATING_ONLY);, +                roles.put(COORDINATING_ONLY, ++count);, +                for (DiscoveryNode.Role role : nodeInfo.getNode().getRoles()) {, +                    Integer count = roles.get(role.getRoleName());, +                    roles.put(role.getRoleName(), ++count);, +        public Map<String, Integer> getRoles() {, +            return roles;, +        @SuppressWarnings("unchecked"), +            roles = (Map<String, Integer>)in.readGenericValue();, +            out.writeGenericValue(roles);, +            for (Map.Entry<String, Integer> entry : roles.entrySet()) {, +                builder.field(entry.getKey(), entry.getValue());, +            }, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/liveness/LivenessResponse.java, +        if (node == null) {, +            out.writeBoolean(false);, +        } else {, +            out.writeBoolean(true);, +            node.writeTo(out);, +        }, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +import java.util.HashMap;, +import java.util.Map;, +        static final String COORDINATING_ONLY = "coordinating_only";, +, +        private int total;, +        private Map<String, Integer> roles;, +, +        Counts() {, +            roles = new HashMap<>();, +            for (DiscoveryNode.Role role : DiscoveryNode.Role.values()) {, +                roles.put(role.getRoleName(), 0);, +            }, +            roles.put(COORDINATING_ONLY, 0);, +        }, +            if (nodeInfo.getNode().getRoles().size() == 0) {, +                Integer count = roles.get(COORDINATING_ONLY);, +                roles.put(COORDINATING_ONLY, ++count);, +                for (DiscoveryNode.Role role : nodeInfo.getNode().getRoles()) {, +                    Integer count = roles.get(role.getRoleName());, +                    roles.put(role.getRoleName(), ++count);, +        public Map<String, Integer> getRoles() {, +            return roles;, +        @SuppressWarnings("unchecked"), +            roles = (Map<String, Integer>)in.readGenericValue();, +            out.writeGenericValue(roles);, +            for (Map.Entry<String, Integer> entry : roles.entrySet()) {, +                builder.field(entry.getKey(), entry.getValue());, +            }, +++ b/core/src/main/java/org/elasticsearch/action/support/ThreadedActionListener.java, +             // Should the action listener be threaded or not by default. Action listeners are automatically threaded for, +            // the transport client in order to make sure client side code is not executed on IO threads., +            this.threadedListener = TransportClient.CLIENT_TYPE.equals(Client.CLIENT_TYPE_SETTING_S.get(settings));, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/liveness/LivenessResponse.java, +        if (node == null) {, +            out.writeBoolean(false);, +        } else {, +            out.writeBoolean(true);, +            node.writeTo(out);, +        }, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +import java.util.HashMap;, +import java.util.Map;, +        static final String COORDINATING_ONLY = "coordinating_only";, +, +        private int total;, +        private Map<String, Integer> roles;, +, +        Counts() {, +            roles = new HashMap<>();]