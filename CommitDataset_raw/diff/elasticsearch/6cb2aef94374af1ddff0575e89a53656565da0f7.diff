[+++ b/docs/reference/ilm/error-handling.asciidoc, +[role="xpack"], +[testenv="basic"], +[[index-lifecycle-error-handling]], +== Index Lifecycle Error Handling, +, +During Index Lifecycle Management's execution of the policy for an index, it's, +possible for a step to encounter an error during its execution. When this, +happens, ILM will move the management state into an "error" step. This halts, +further execution of the policy and gives an administrator the chance to address, +any issues with the policy, index, or cluster., +, +An example will be helpful in illustrating this, imagine the following policy, +has been created by a user:, +, +[source,js], +--------------------------------------------------, +PUT _ilm/policy/shrink-the-index, +{, +  "policy": {, +    "phases": {, +      "warm": {, +        "min_age": "5d",, +        "actions": {, +          "shrink": {, +            "number_of_shards": 4, +          }, +        }, +      }, +    }, +  }, +}, +--------------------------------------------------, +// CONSOLE, +// TEST, +, +This policy waits until the index is at least 5 days old, and then shrinks, +the index to 4 shards., +, +Now imagine that a user creates a new index "myindex" with two primary shards,, +telling it to use the policy they have created:, +, +[source,js], +--------------------------------------------------, +PUT /myindex, +{, +  "settings": {, +    "index.number_of_shards": 2,, +    "index.lifecycle.name": "shrink-the-index", +  }, +}, +--------------------------------------------------, +// CONSOLE, +// TEST[continued], +, +After five days have passed, ILM will attempt to shrink this index from 2, +shards to 4, which is invalid since the shrink action cannot increase the, +number of shards. When this occurs, ILM will move this, +index to the "error" step. Once an index is in this step, information about the, +reason for the error can be retrieved from the <<ilm-explain-lifecycle,ILM Explain API>>:, +, +[source,js], +--------------------------------------------------, +GET /myindex/_ilm/explain, +--------------------------------------------------, +// CONSOLE, +// TEST[continued], +, +Which returns the following information:, +, +[source,js], +--------------------------------------------------, +{, +  "indices" : {, +    "myindex" : {, +      "index" : "myindex",, +      "managed" : true,                         <1>, +      "policy" : "shrink-the-index",            <2>, +      "lifecycle_date_millis" : 1541717265865,, +      "phase" : "warm",                         <3>, +      "phase_time_millis" : 1541717272601,, +      "action" : "shrink",                      <4>, +      "action_time_millis" : 1541717272601,, +      "step" : "ERROR",                         <5>, +      "step_time_millis" : 1541717272688,, +      "failed_step" : "shrink",                 <6>, +      "step_info" : {, +        "type" : "illegal_argument_exception",   <7>, +        "reason" : "the number of target shards [4] must be less that the number of source shards [2]" <8>, +      },, +      "phase_execution" : {, +        "policy" : "shrink-the-index",, +        "phase_definition" : {                   <9>, +          "min_age" : "5d",, +          "actions" : {, +            "shrink" : {, +              "number_of_shards" : 4, +            }, +          }, +        },]