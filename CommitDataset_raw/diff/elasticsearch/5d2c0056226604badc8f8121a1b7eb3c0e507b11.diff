[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/strategy/PreferUnallocatedShardUnassignedStrategy.java, +                if (!(node.canAllocate(routingNodes) && node.canAllocate(shard))) {]