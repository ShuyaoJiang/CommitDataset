[+++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java, +        private final SetOnce<IndexMetaData> writeIndex = new SetOnce<>();, +            return () -> new Iterator<Tuple<String,AliasMetaData>>() {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java, +        private final SetOnce<IndexMetaData> writeIndex = new SetOnce<>();, +            return () -> new Iterator<Tuple<String,AliasMetaData>>() {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AutoExpandReplicas.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java, +        private final SetOnce<IndexMetaData> writeIndex = new SetOnce<>();, +            return () -> new Iterator<Tuple<String,AliasMetaData>>() {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AutoExpandReplicas.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolver.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java, +        private final SetOnce<IndexMetaData> writeIndex = new SetOnce<>();, +            return () -> new Iterator<Tuple<String,AliasMetaData>>() {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AutoExpandReplicas.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolver.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java, +        private final SetOnce<IndexMetaData> writeIndex = new SetOnce<>();, +            return () -> new Iterator<Tuple<String,AliasMetaData>>() {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AutoExpandReplicas.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolver.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java, +        private final SetOnce<IndexMetaData> writeIndex = new SetOnce<>();, +            return () -> new Iterator<Tuple<String,AliasMetaData>>() {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AutoExpandReplicas.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolver.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java, +        public Builder putMapping(String mappingType, CompressedXContent mappingSource) {, +            if (token == XContentParser.Token.START_OBJECT) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java, +        private final SetOnce<IndexMetaData> writeIndex = new SetOnce<>();, +            return () -> new Iterator<Tuple<String,AliasMetaData>>() {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AutoExpandReplicas.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolver.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java, +        public Builder putMapping(String mappingType, CompressedXContent mappingSource) {, +            if (token == XContentParser.Token.START_OBJECT) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java, +    public MappingMetaData(CompressedXContent mapping) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java, +        private final SetOnce<IndexMetaData> writeIndex = new SetOnce<>();, +            return () -> new Iterator<Tuple<String,AliasMetaData>>() {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AutoExpandReplicas.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolver.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java, +        public Builder putMapping(String mappingType, CompressedXContent mappingSource) {, +            if (token == XContentParser.Token.START_OBJECT) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java, +    public MappingMetaData(CompressedXContent mapping) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java, +        private final SetOnce<IndexMetaData> writeIndex = new SetOnce<>();, +            return () -> new Iterator<Tuple<String,AliasMetaData>>() {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AutoExpandReplicas.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolver.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java, +        public Builder putMapping(String mappingType, CompressedXContent mappingSource) {, +            if (token == XContentParser.Token.START_OBJECT) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java, +    public MappingMetaData(CompressedXContent mapping) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java, +        private final SetOnce<IndexMetaData> writeIndex = new SetOnce<>();, +            return () -> new Iterator<Tuple<String,AliasMetaData>>() {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/AutoExpandReplicas.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolver.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java, +        public Builder putMapping(String mappingType, CompressedXContent mappingSource) {, +            if (token == XContentParser.Token.START_OBJECT) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java, +    public MappingMetaData(CompressedXContent mapping) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexStateService.java]