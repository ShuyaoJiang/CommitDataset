[+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ExtractedField.java, +import org.elasticsearch.search.fetch.subphase.DocValueFieldsContext;, +    public String getDocValueFormat() {, +        return DocValueFieldsContext.USE_DEFAULT_FORMAT;, +    }, +, +        private static final String EPOCH_MILLIS_FORMAT = "epoch_millis";, +, +, +        @Override, +        public String getDocValueFormat() {, +            return EPOCH_MILLIS_FORMAT;, +        }, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ExtractedField.java, +import org.elasticsearch.search.fetch.subphase.DocValueFieldsContext;, +    public String getDocValueFormat() {, +        return DocValueFieldsContext.USE_DEFAULT_FORMAT;, +    }, +, +        private static final String EPOCH_MILLIS_FORMAT = "epoch_millis";, +, +, +        @Override, +        public String getDocValueFormat() {, +            return EPOCH_MILLIS_FORMAT;, +        }, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ExtractedFields.java, +    private final List<ExtractedField> docValueFields;, +        this.sourceFields = filterFields(ExtractedField.ExtractionMethod.SOURCE, allFields).stream().map(ExtractedField::getName), +            .toArray(String[]::new);, +    public List<ExtractedField> getDocValueFields() {, +    private static List<ExtractedField> filterFields(ExtractedField.ExtractionMethod method, List<ExtractedField> fields) {, +        return fields.stream().filter(field -> field.getExtractionMethod() == method).collect(Collectors.toList());, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ExtractedField.java, +import org.elasticsearch.search.fetch.subphase.DocValueFieldsContext;, +    public String getDocValueFormat() {, +        return DocValueFieldsContext.USE_DEFAULT_FORMAT;, +    }, +, +        private static final String EPOCH_MILLIS_FORMAT = "epoch_millis";, +, +, +        @Override, +        public String getDocValueFormat() {, +            return EPOCH_MILLIS_FORMAT;, +        }, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ExtractedFields.java, +    private final List<ExtractedField> docValueFields;, +        this.sourceFields = filterFields(ExtractedField.ExtractionMethod.SOURCE, allFields).stream().map(ExtractedField::getName), +            .toArray(String[]::new);, +    public List<ExtractedField> getDocValueFields() {, +    private static List<ExtractedField> filterFields(ExtractedField.ExtractionMethod method, List<ExtractedField> fields) {, +        return fields.stream().filter(field -> field.getExtractionMethod() == method).collect(Collectors.toList());, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ScrollDataExtractor.java, +        for (ExtractedField docValueField : context.extractedFields.getDocValueFields()) {, +            searchRequestBuilder.addDocValueField(docValueField.getName(), docValueField.getDocValueFormat());, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ExtractedField.java, +import org.elasticsearch.search.fetch.subphase.DocValueFieldsContext;, +    public String getDocValueFormat() {, +        return DocValueFieldsContext.USE_DEFAULT_FORMAT;, +    }, +, +        private static final String EPOCH_MILLIS_FORMAT = "epoch_millis";, +, +, +        @Override, +        public String getDocValueFormat() {, +            return EPOCH_MILLIS_FORMAT;, +        }, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ExtractedFields.java, +    private final List<ExtractedField> docValueFields;, +        this.sourceFields = filterFields(ExtractedField.ExtractionMethod.SOURCE, allFields).stream().map(ExtractedField::getName), +            .toArray(String[]::new);, +    public List<ExtractedField> getDocValueFields() {, +    private static List<ExtractedField> filterFields(ExtractedField.ExtractionMethod method, List<ExtractedField> fields) {, +        return fields.stream().filter(field -> field.getExtractionMethod() == method).collect(Collectors.toList());, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ScrollDataExtractor.java, +        for (ExtractedField docValueField : context.extractedFields.getDocValueFields()) {, +            searchRequestBuilder.addDocValueField(docValueField.getName(), docValueField.getDocValueFormat());, +++ b/x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ExtractedFieldTests.java, +import org.elasticsearch.search.fetch.subphase.DocValueFieldsContext;, +, +    public void testGetDocValueFormat() {, +        for (ExtractedField.ExtractionMethod method : ExtractedField.ExtractionMethod.values()) {, +            assertThat(ExtractedField.newField("f", method).getDocValueFormat(), equalTo(DocValueFieldsContext.USE_DEFAULT_FORMAT));, +        }, +        assertThat(ExtractedField.newTimeField("doc_value_time", ExtractedField.ExtractionMethod.DOC_VALUE).getDocValueFormat(),, +            equalTo("epoch_millis"));, +        assertThat(ExtractedField.newTimeField("source_time", ExtractedField.ExtractionMethod.SCRIPT_FIELD).getDocValueFormat(),, +            equalTo("epoch_millis"));, +    }, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/scroll/ExtractedField.java, +import org.elasticsearch.search.fetch.subphase.DocValueFieldsContext;, +    public String getDocValueFormat() {, +        return DocValueFieldsContext.USE_DEFAULT_FORMAT;, +    }, +, +        private static final String EPOCH_MILLIS_FORMAT = "epoch_millis";, +, +]