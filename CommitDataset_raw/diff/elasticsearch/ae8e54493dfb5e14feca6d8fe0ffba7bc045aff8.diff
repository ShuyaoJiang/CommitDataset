[+++ b/server/src/main/java/org/elasticsearch/index/engine/ReadOnlyEngine.java, +import org.apache.lucene.index.SegmentCommitInfo;, +                reader = ElasticsearchDirectoryReader.wrap(open(directory), config.getShardId());, +                this.docsStats = docsStats(lastCommittedSegmentInfos);, +    protected DirectoryReader open(final Directory directory) throws IOException {, +        return DirectoryReader.open(directory);, +    }, +, +    private DocsStats docsStats(final SegmentInfos lastCommittedSegmentInfos) {, +        long numDocs = 0;, +        long numDeletedDocs = 0;, +        long sizeInBytes = 0;, +        if (lastCommittedSegmentInfos != null) {, +            for (SegmentCommitInfo segmentCommitInfo : lastCommittedSegmentInfos) {, +                numDocs += segmentCommitInfo.info.maxDoc() - segmentCommitInfo.getDelCount() - segmentCommitInfo.getSoftDelCount();, +                numDeletedDocs += segmentCommitInfo.getDelCount() + segmentCommitInfo.getSoftDelCount();, +                try {, +                    sizeInBytes += segmentCommitInfo.sizeInBytes();, +                } catch (IOException e) {, +                    throw new UncheckedIOException("Failed to get size for [" + segmentCommitInfo.info.name + "]", e);, +                }, +            }, +        }, +        return new DocsStats(numDocs, numDeletedDocs, sizeInBytes);, +    }, +]