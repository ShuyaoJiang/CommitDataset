[+++ b/qa/shield-audit-tests/build.gradle, +apply plugin: 'elasticsearch.rest-test', +, +dependencies {, +  testCompile project(path: ':x-plugins:shield', configuration: 'runtime'), +}, +, +integTest {, +  cluster {, +    plugin 'license', project(':x-plugins:license:plugin'), +    plugin 'shield', project(':x-plugins:shield'), +    // TODO: these should be settings?, +    systemProperty 'es.shield.audit.enabled', 'true', +    systemProperty 'es.shield.audit.outputs', 'index', +    setupCommand 'setupDummyUser',, +                 'bin/shield/esusers', 'useradd', 'test_user', '-p', 'changeme', '-r', 'admin', +    waitCondition = { node, ant ->, +      File tmpFile = new File(node.cwd, 'wait.success'), +      ant.get(src: "http://localhost:${node.httpPort()}",, +              dest: tmpFile.toString(),, +              username: 'test_user',, +              password: 'changeme',, +              ignoreerrors: true,, +              retries: 10), +      return tmpFile.exists(), +    }, +  }, +}, +, +++ b/qa/shield-audit-tests/build.gradle, +apply plugin: 'elasticsearch.rest-test', +, +dependencies {, +  testCompile project(path: ':x-plugins:shield', configuration: 'runtime'), +}, +, +integTest {, +  cluster {, +    plugin 'license', project(':x-plugins:license:plugin'), +    plugin 'shield', project(':x-plugins:shield'), +    // TODO: these should be settings?, +    systemProperty 'es.shield.audit.enabled', 'true', +    systemProperty 'es.shield.audit.outputs', 'index', +    setupCommand 'setupDummyUser',, +                 'bin/shield/esusers', 'useradd', 'test_user', '-p', 'changeme', '-r', 'admin', +    waitCondition = { node, ant ->, +      File tmpFile = new File(node.cwd, 'wait.success'), +      ant.get(src: "http://localhost:${node.httpPort()}",, +              dest: tmpFile.toString(),, +              username: 'test_user',, +              password: 'changeme',, +              ignoreerrors: true,, +              retries: 10), +      return tmpFile.exists(), +    }, +  }, +}, +, +++ /dev/null, +++ b/qa/shield-audit-tests/build.gradle, +apply plugin: 'elasticsearch.rest-test', +, +dependencies {, +  testCompile project(path: ':x-plugins:shield', configuration: 'runtime'), +}, +, +integTest {, +  cluster {, +    plugin 'license', project(':x-plugins:license:plugin'), +    plugin 'shield', project(':x-plugins:shield'), +    // TODO: these should be settings?, +    systemProperty 'es.shield.audit.enabled', 'true', +    systemProperty 'es.shield.audit.outputs', 'index', +    setupCommand 'setupDummyUser',, +                 'bin/shield/esusers', 'useradd', 'test_user', '-p', 'changeme', '-r', 'admin', +    waitCondition = { node, ant ->, +      File tmpFile = new File(node.cwd, 'wait.success'), +      ant.get(src: "http://localhost:${node.httpPort()}",, +              dest: tmpFile.toString(),, +              username: 'test_user',, +              password: 'changeme',, +              ignoreerrors: true,, +              retries: 10), +      return tmpFile.exists(), +    }, +  }, +}, +, +++ /dev/null, +++ /dev/null, +++ b/qa/shield-audit-tests/build.gradle, +apply plugin: 'elasticsearch.rest-test', +, +dependencies {, +  testCompile project(path: ':x-plugins:shield', configuration: 'runtime'), +}, +, +integTest {, +  cluster {, +    plugin 'license', project(':x-plugins:license:plugin')]