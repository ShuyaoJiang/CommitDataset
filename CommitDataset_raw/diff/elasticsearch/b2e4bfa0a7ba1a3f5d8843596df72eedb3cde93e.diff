[+++ b/core/src/main/java/org/elasticsearch/Build.java, +import org.elasticsearch.common.Booleans;, +            final String buildSnapshot = System.getProperty("build.snapshot");, +            if (buildSnapshot != null) {, +                try {, +                    Class.forName("com.carrotsearch.randomizedtesting.RandomizedContext");, +                } catch (final ClassNotFoundException e) {, +                    // we are not in tests but build.snapshot is set, bail hard, +                    throw new IllegalStateException("build.snapshot set to [" + buildSnapshot + "] but not running tests");, +                }, +                isSnapshot = Booleans.parseBoolean(buildSnapshot);, +            } else {, +        }, +++ b/core/src/main/java/org/elasticsearch/Build.java, +import org.elasticsearch.common.Booleans;, +            final String buildSnapshot = System.getProperty("build.snapshot");, +            if (buildSnapshot != null) {, +                try {, +                    Class.forName("com.carrotsearch.randomizedtesting.RandomizedContext");, +                } catch (final ClassNotFoundException e) {, +                    // we are not in tests but build.snapshot is set, bail hard, +                    throw new IllegalStateException("build.snapshot set to [" + buildSnapshot + "] but not running tests");, +                }, +                isSnapshot = Booleans.parseBoolean(buildSnapshot);, +            } else {, +        }, +++ b/test/framework/src/main/java/org/elasticsearch/test/junit/listeners/ReproduceInfoPrinter.java, +                             "tests.client.ratio", "tests.heap.size", "tests.bwc", "tests.bwc.version", "build.snapshot");]