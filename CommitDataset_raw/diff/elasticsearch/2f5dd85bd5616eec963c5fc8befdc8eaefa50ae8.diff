[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/transport/TransportService.java, +import org.elasticsearch.common.collect.ImmutableMap;, +import org.elasticsearch.common.collect.MapBuilder;, +    volatile ImmutableMap<String, TransportRequestHandler> serverHandlers = ImmutableMap.of();, +    final Object serverHandlersMutex = new Object();, +        synchronized (serverHandlersMutex) {, +            TransportRequestHandler handlerReplaced = serverHandlers.get(action);, +            serverHandlers = MapBuilder.newMapBuilder(serverHandlers).put(action, handler).immutableMap();, +    }, +        synchronized (serverHandlersMutex) {, +            serverHandlers = MapBuilder.newMapBuilder(serverHandlers).remove(action).immutableMap();, +        }]