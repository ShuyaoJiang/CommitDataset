[+++ b/server/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +import org.elasticsearch.common.unit.MemorySizeValue;, +        // We need to make the indexing buffer for this shard at least as large, +        // as the amount of memory that is available for all engines on the, +        // local node so that decisions to flush segments to disk are made by, +        // IndexingMemoryController rather than Lucene., +        // Add an escape hatch in case this change proves problematic - it used, +        // to be a fixed amound of RAM: 256 MB., +        // TODO: Remove this escape hatch in 8.x, +        final String escapeHatchProperty = "es.index.memory.max_index_buffer_size";, +        String maxBufferSize = System.getProperty(escapeHatchProperty);, +        if (maxBufferSize != null) {, +            indexingBufferSize = MemorySizeValue.parseBytesSizeValueOrHeapRatio(maxBufferSize, escapeHatchProperty);, +        } else {, +            indexingBufferSize = IndexingMemoryController.INDEX_BUFFER_SIZE_SETTING.get(indexSettings.getNodeSettings());, +        }]