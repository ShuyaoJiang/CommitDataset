[+++ b/rest-api-spec/src/main/resources/rest-api-spec/test/search/110_field_collapsing.yml, +        body:, +          mappings:, +            test:, +              properties:, +                numeric_group: { type: integer }, +                group_alias: { type: alias, path: numeric_group }, +, +, +---, +"field collapsing on a field alias":, +  - skip:, +      version: " - 6.99.99", +      reason: The associated bugfix is pending backport to 6.x., +  - do:, +      search:, +        index: test, +        body:, +          collapse: { field: group_alias, inner_hits: { name: sub_hits } }, +          sort: [{ sort: desc }], +, +  - match: { hits.total: 6 }, +  - length: { hits.hits: 3 }, +, +  - match: { hits.hits.0.fields.group_alias: [3] }, +  - match: { hits.hits.0.inner_hits.sub_hits.hits.total: 1}, +  - match: { hits.hits.1.fields.group_alias: [1] }, +  - match: { hits.hits.1.inner_hits.sub_hits.hits.total: 3}, +  - match: { hits.hits.2.fields.group_alias: [25] }, +  - match: { hits.hits.2.inner_hits.sub_hits.hits.total: 2}, +++ b/rest-api-spec/src/main/resources/rest-api-spec/test/search/110_field_collapsing.yml, +        body:, +          mappings:, +            test:, +              properties:, +                numeric_group: { type: integer }, +                group_alias: { type: alias, path: numeric_group }, +, +, +---, +"field collapsing on a field alias":, +  - skip:, +      version: " - 6.99.99", +      reason: The associated bugfix is pending backport to 6.x., +  - do:, +      search:, +        index: test, +        body:, +          collapse: { field: group_alias, inner_hits: { name: sub_hits } }, +          sort: [{ sort: desc }], +, +  - match: { hits.total: 6 }, +  - length: { hits.hits: 3 }, +, +  - match: { hits.hits.0.fields.group_alias: [3] }, +  - match: { hits.hits.0.inner_hits.sub_hits.hits.total: 1}, +  - match: { hits.hits.1.fields.group_alias: [1] }, +  - match: { hits.hits.1.inner_hits.sub_hits.hits.total: 3}, +  - match: { hits.hits.2.fields.group_alias: [25] }, +  - match: { hits.hits.2.inner_hits.sub_hits.hits.total: 2}, +++ b/server/src/main/java/org/elasticsearch/search/collapse/CollapseBuilder.java, +        return new CollapseContext(field, fieldType, innerHits);, +++ b/rest-api-spec/src/main/resources/rest-api-spec/test/search/110_field_collapsing.yml, +        body:, +          mappings:, +            test:, +              properties:, +                numeric_group: { type: integer }, +                group_alias: { type: alias, path: numeric_group }, +, +, +---, +"field collapsing on a field alias":, +  - skip:, +      version: " - 6.99.99", +      reason: The associated bugfix is pending backport to 6.x., +  - do:, +      search:, +        index: test, +        body:, +          collapse: { field: group_alias, inner_hits: { name: sub_hits } }, +          sort: [{ sort: desc }], +, +  - match: { hits.total: 6 }, +  - length: { hits.hits: 3 }, +, +  - match: { hits.hits.0.fields.group_alias: [3] }, +  - match: { hits.hits.0.inner_hits.sub_hits.hits.total: 1}, +  - match: { hits.hits.1.fields.group_alias: [1] }, +  - match: { hits.hits.1.inner_hits.sub_hits.hits.total: 3}, +  - match: { hits.hits.2.fields.group_alias: [25] }, +  - match: { hits.hits.2.inner_hits.sub_hits.hits.total: 2}, +++ b/server/src/main/java/org/elasticsearch/search/collapse/CollapseBuilder.java, +        return new CollapseContext(field, fieldType, innerHits);, +++ b/server/src/main/java/org/elasticsearch/search/collapse/CollapseContext.java, +    private final String fieldName;, +    public CollapseContext(String fieldName,, +                           MappedFieldType fieldType,, +                           List<InnerHitBuilder> innerHits) {, +        this.fieldName = fieldName;]