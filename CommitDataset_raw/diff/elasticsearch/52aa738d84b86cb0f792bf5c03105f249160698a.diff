[+++ b/x-pack/plugin/ilm/src/main/java/org/elasticsearch/xpack/indexlifecycle/IndexLifecycleRunner.java, +                IndexMetaData.Builder newIdxMetadata = IndexLifecycleRunner.setPolicyForIndex(newPolicyName,, +                    newPolicy, indexMetadata, nowSupplier);, +                                                           IndexMetaData indexMetadata, LongSupplier nowSupplier) {, +                IndexMetaData.Builder newIdxMetadata = IndexLifecycleRunner.removePolicyForIndex(indexMetadata);, +    private static IndexMetaData.Builder removePolicyForIndex(IndexMetaData indexMetadata) {, +++ b/x-pack/plugin/ilm/src/main/java/org/elasticsearch/xpack/indexlifecycle/IndexLifecycleRunner.java, +                IndexMetaData.Builder newIdxMetadata = IndexLifecycleRunner.setPolicyForIndex(newPolicyName,, +                    newPolicy, indexMetadata, nowSupplier);, +                                                           IndexMetaData indexMetadata, LongSupplier nowSupplier) {, +                IndexMetaData.Builder newIdxMetadata = IndexLifecycleRunner.removePolicyForIndex(indexMetadata);, +    private static IndexMetaData.Builder removePolicyForIndex(IndexMetaData indexMetadata) {, +++ b/x-pack/plugin/ilm/src/main/java/org/elasticsearch/xpack/indexlifecycle/action/TransportPutLifecycleAction.java, +++ b/x-pack/plugin/ilm/src/main/java/org/elasticsearch/xpack/indexlifecycle/IndexLifecycleRunner.java, +                IndexMetaData.Builder newIdxMetadata = IndexLifecycleRunner.setPolicyForIndex(newPolicyName,, +                    newPolicy, indexMetadata, nowSupplier);, +                                                           IndexMetaData indexMetadata, LongSupplier nowSupplier) {, +                IndexMetaData.Builder newIdxMetadata = IndexLifecycleRunner.removePolicyForIndex(indexMetadata);, +    private static IndexMetaData.Builder removePolicyForIndex(IndexMetaData indexMetadata) {, +++ b/x-pack/plugin/ilm/src/main/java/org/elasticsearch/xpack/indexlifecycle/action/TransportPutLifecycleAction.java, +++ b/x-pack/plugin/ilm/src/test/java/org/elasticsearch/xpack/indexlifecycle/IndexLifecycleRunnerTests.java, +        assertTrue(failedIndexes.isEmpty());, +        assertIndexNotManagedByILM(newClusterState, index);]