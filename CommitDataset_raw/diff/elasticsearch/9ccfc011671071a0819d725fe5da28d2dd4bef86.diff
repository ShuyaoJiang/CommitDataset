[+++ b/x-pack/plugin/ccr/src/test/java/org/elasticsearch/xpack/ccr/AutoFollowIT.java, +        long numIndices = randomIntBetween(4, 32);, +        long expectedVal1 = numIndices;, +                assertThat(autoFollowStats[0].getNumberOfSuccessfulFollowIndices(), equalTo(expectedVal1));, +            });, +        } catch (AssertionError ae) {, +            logger.warn("metadata={}", Strings.toString(metaData[0]));, +            logger.warn("auto follow stats={}", Strings.toString(autoFollowStats[0]));, +            throw ae;, +        }, +, +        // Delete auto follow pattern and make sure that in the background the auto follower has stopped, +        // then the leader index created after that should never be auto followed:, +        deleteAutoFollowPatternSetting();, +        try {, +            assertBusy(() -> {, +                metaData[0] = followerClient().admin().cluster().prepareState().get().getState().metaData();, +                autoFollowStats[0] = getAutoFollowStats();, +                assertThat(autoFollowStats[0].getAutoFollowedClusters().size(), equalTo(0));, +            });, +        } catch (AssertionError ae) {, +            logger.warn("metadata={}", Strings.toString(metaData[0]));, +            logger.warn("auto follow stats={}", Strings.toString(autoFollowStats[0]));, +            throw ae;, +        }, +        createLeaderIndex("logs-does-not-count", leaderIndexSettings);, +, +        putAutoFollowPatterns("my-pattern", new String[] {"logs-*"});, +        long i = numIndices;, +        numIndices = numIndices + randomIntBetween(4, 32);, +        for (; i < numIndices; i++) {, +            createLeaderIndex("logs-" + i, leaderIndexSettings);, +        }, +        long expectedVal2 = numIndices;, +, +        try {, +            assertBusy(() -> {, +                metaData[0] = followerClient().admin().cluster().prepareState().get().getState().metaData();, +                autoFollowStats[0] = getAutoFollowStats();, +                long count = Arrays.stream(metaData[0].getConcreteAllIndices()).filter(s -> s.startsWith("copy-")).count();]