[+++ b/src/test/java/org/elasticsearch/test/integration/plugin/SitePluginTests.java, +import org.elasticsearch.http.HttpServerTransport;, +import org.testng.annotations.AfterMethod;, +import org.testng.annotations.BeforeClass;, +import org.testng.annotations.BeforeMethod;, +, +    @BeforeClass, +    public void setupPluginDirectory() {, +        putDefaultSettings(settingsBuilder(), +                .put("path.plugins", "target/test-classes/org/elasticsearch/test/integration/plugin/"), +                .build());, +    }, +, +    @BeforeMethod, +    public void startNodes() {, +        startNode("test");, +    }, +, +    @AfterMethod, +    public void closeNodes() {, +        closeAllNodes();, +    }, +, +    public HttpClient httpClient(String id) {, +        HttpServerTransport httpServerTransport = ((InternalNode) node(id)).injector().getInstance(HttpServerTransport.class);, +        return new HttpClient(httpServerTransport.boundAddress().publishAddress());, +    }, +, +        HttpClientResponse response = httpClient("test").request("/_plugin/dummy");, +        response = httpClient("test").request("/_plugin/dummy/");, +++ b/src/test/java/org/elasticsearch/test/integration/plugin/SitePluginTests.java, +import org.elasticsearch.http.HttpServerTransport;, +import org.testng.annotations.AfterMethod;, +import org.testng.annotations.BeforeClass;, +import org.testng.annotations.BeforeMethod;, +, +    @BeforeClass, +    public void setupPluginDirectory() {, +        putDefaultSettings(settingsBuilder(), +                .put("path.plugins", "target/test-classes/org/elasticsearch/test/integration/plugin/"), +                .build());, +    }, +, +    @BeforeMethod, +    public void startNodes() {, +        startNode("test");, +    }, +, +    @AfterMethod, +    public void closeNodes() {, +        closeAllNodes();, +    }, +, +    public HttpClient httpClient(String id) {, +        HttpServerTransport httpServerTransport = ((InternalNode) node(id)).injector().getInstance(HttpServerTransport.class);, +        return new HttpClient(httpServerTransport.boundAddress().publishAddress());, +    }, +, +        HttpClientResponse response = httpClient("test").request("/_plugin/dummy");, +        response = httpClient("test").request("/_plugin/dummy/");, +++ b/src/test/java/org/elasticsearch/test/integration/rest/helper/HttpClient.java, +import org.elasticsearch.common.transport.InetSocketTransportAddress;, +import org.elasticsearch.common.transport.TransportAddress;, +import java.net.InetSocketAddress;, +    public HttpClient(TransportAddress transportAddress) {, +        InetSocketAddress address = ((InetSocketTransportAddress) transportAddress).address();, +        try {, +            baseUrl = new URL("http", address.getHostName(), address.getPort(), "/");, +        } catch (MalformedURLException e) {, +            throw new ElasticSearchException("", e);, +        }, +    }, +, +    public HttpClient(URL url) {, +        baseUrl = url;, +    }, +]