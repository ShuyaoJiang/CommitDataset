[+++ b/core/src/main/java/org/elasticsearch/action/DocumentWriteRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/DocumentWriteRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +        DocumentWriteRequest<?> itemRequest = request.items()[requestIndex].request();, +            request.items()[requestIndex] = new BulkItemRequest(request.items()[requestIndex].id(),, +                    (DocumentWriteRequest<?>) writeResult.getReplicaRequest());, +                    DocumentWriteRequest<?> documentWriteRequest = request.items()[j].request();, +            DocumentWriteRequest<?> documentWriteRequest = item.request();]