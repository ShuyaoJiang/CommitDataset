[+++ b/src/test/java/org/elasticsearch/percolator/TTLPercolatorTests.java, +import org.elasticsearch.index.AlreadyExpiredException;, +import org.elasticsearch.index.mapper.MapperParsingException;, +import org.hamcrest.Matchers;, +        client().admin().indices().prepareCreate("test"), +            logger.debug("index doc {} ", i);, +            try {, +                client().prepareIndex("test", "type1", "" + i).setSource(jsonBuilder(), +                ).setTTL(randomIntBetween(1, 500)).execute().actionGet();, +            } catch (MapperParsingException e) {, +                logger.info("failed indexing {}", i, e);, +                // if we are unlucky the TTL is so small that we see the expiry date is already in the past when, +                // we parse the doc ignore those..., +                assertThat(e.getCause(), Matchers.instanceOf(AlreadyExpiredException.class));, +            }, +, +                IndicesStatsResponse indicesStatsResponse = client().admin().indices().prepareStats("test").clear().setIndexing(true).get();, +                logger.debug("delete count [{}]", indicesStatsResponse.getIndices().get("test").getTotal().getIndexing().getTotal().getDeleteCount());, +        client().admin().indices().prepareCreate("test")]