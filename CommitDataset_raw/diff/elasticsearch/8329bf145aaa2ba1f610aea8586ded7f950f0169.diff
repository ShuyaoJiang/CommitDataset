[+++ b/core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java, +import org.elasticsearch.index.query.InnerHitBuilder;, +import org.elasticsearch.search.SearchHit;, +import org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder.Field;, +import static org.elasticsearch.index.query.QueryBuilders.hasParentQuery;, +    public void testHasChildInnerHitsHighlighting() throws Exception {, +        assertAcked(prepareCreate("test"), +                .addMapping("parent"), +                .addMapping("child", "_parent", "type=parent"));, +        ensureGreen();, +, +        client().prepareIndex("test", "parent", "1").setSource("p_field", 1).get();, +        client().prepareIndex("test", "child", "2").setParent("1").setSource("c_field", "foo bar").get();, +        client().admin().indices().prepareFlush("test").get();, +, +        SearchResponse searchResponse = client().prepareSearch("test").setQuery(, +                hasChildQuery("child", matchQuery("c_field", "foo"), ScoreMode.None), +                    .innerHit(new InnerHitBuilder().setHighlightBuilder(, +                        new HighlightBuilder().field(new Field("c_field").highlightQuery(QueryBuilders.matchQuery("c_field", "bar")))))), +                .get();, +        assertNoFailures(searchResponse);, +        assertThat(searchResponse.getHits().totalHits(), equalTo(1L));, +        assertThat(searchResponse.getHits().hits()[0].id(), equalTo("1"));, +        SearchHit[] searchHits = searchResponse.getHits().hits()[0].getInnerHits().get("child").hits();, +        assertThat(searchHits.length, equalTo(1));, +        assertThat(searchHits[0].getHighlightFields().get("c_field").getFragments().length, equalTo(1));, +        assertThat(searchHits[0].getHighlightFields().get("c_field").getFragments()[0].string(), equalTo("foo <em>bar</em>"));, +    }, +]