[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/GeoPointFieldData.java, +    public abstract void forEachValueInDoc(int docId, ValueInDocProc proc);, +, +    public static interface ValueInDocProc {, +        void onValue(int docId, double lat, double lon);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/GeoPointFieldData.java, +    public abstract void forEachValueInDoc(int docId, ValueInDocProc proc);, +, +    public static interface ValueInDocProc {, +        void onValue(int docId, double lat, double lon);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/MultiValueGeoPointFieldData.java, +    @Override public void forEachValueInDoc(int docId, ValueInDocProc proc) {, +        for (int[] ordinal : ordinals) {, +            int loc = ordinal[docId];, +            if (loc != 0) {, +                proc.onValue(docId, lat[loc], lon[loc]);, +            }, +        }, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/GeoPointFieldData.java, +    public abstract void forEachValueInDoc(int docId, ValueInDocProc proc);, +, +    public static interface ValueInDocProc {, +        void onValue(int docId, double lat, double lon);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/MultiValueGeoPointFieldData.java, +    @Override public void forEachValueInDoc(int docId, ValueInDocProc proc) {, +        for (int[] ordinal : ordinals) {, +            int loc = ordinal[docId];, +            if (loc != 0) {, +                proc.onValue(docId, lat[loc], lon[loc]);, +            }, +        }, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/SingleValueGeoPointFieldData.java, +    @Override public void forEachValueInDoc(int docId, ValueInDocProc proc) {, +        int loc = ordinals[docId];, +        if (loc == 0) {, +            return;, +        }, +        proc.onValue(docId, lat[loc], lon[loc]);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/GeoPointFieldData.java, +    public abstract void forEachValueInDoc(int docId, ValueInDocProc proc);, +, +    public static interface ValueInDocProc {, +        void onValue(int docId, double lat, double lon);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/MultiValueGeoPointFieldData.java, +    @Override public void forEachValueInDoc(int docId, ValueInDocProc proc) {, +        for (int[] ordinal : ordinals) {, +            int loc = ordinal[docId];, +            if (loc != 0) {, +                proc.onValue(docId, lat[loc], lon[loc]);, +            }, +        }, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/SingleValueGeoPointFieldData.java, +    @Override public void forEachValueInDoc(int docId, ValueInDocProc proc) {, +        int loc = ordinals[docId];, +        if (loc == 0) {, +            return;, +        }, +        proc.onValue(docId, lat[loc], lon[loc]);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/geodistance/GeoDistanceFacet.java, +        /**, +         * internal field used to see if this entry was already found for a doc, +         */, +        boolean foundInDoc = false;, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/GeoPointFieldData.java, +    public abstract void forEachValueInDoc(int docId, ValueInDocProc proc);, +, +    public static interface ValueInDocProc {, +        void onValue(int docId, double lat, double lon);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/MultiValueGeoPointFieldData.java, +    @Override public void forEachValueInDoc(int docId, ValueInDocProc proc) {, +        for (int[] ordinal : ordinals) {, +            int loc = ordinal[docId];, +            if (loc != 0) {, +                proc.onValue(docId, lat[loc], lon[loc]);, +            }, +        }, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/xcontent/geo/SingleValueGeoPointFieldData.java]