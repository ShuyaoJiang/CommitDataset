[+++ b/src/main/java/org/elasticsearch/index/store/fs/DefaultFsDirectoryService.java, +        final MMapDirectory mmapDir = new MMapDirectory(location, lockFactory);, +        return new FileSwitchDirectory(PRIMARY_EXTENSIONS, mmapDir, new NIOFSDirectory(location, lockFactory), true) {, +            @Override, +            public String[] listAll() throws IOException {, +                // Avoid doing listAll twice:, +                return mmapDir.listAll();, +            }, +        };]