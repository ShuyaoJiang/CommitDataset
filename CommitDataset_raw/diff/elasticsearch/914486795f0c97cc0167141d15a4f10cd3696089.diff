[+++ b/core/src/main/java/org/elasticsearch/indices/memory/IndexingMemoryController.java, +    protected boolean shardAvailable(IndexShard shard) {, +        return shard.canIndex() && CAN_UPDATE_INDEX_BUFFER_STATES.contains(shard.state());, +        } catch (EngineClosedException | FlushNotAllowedEngineException e) {]