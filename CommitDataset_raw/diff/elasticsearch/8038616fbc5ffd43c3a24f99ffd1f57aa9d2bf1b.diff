[+++ b/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java, +            generator.writeNumber(value);, +            generator.writeNumber(value);, +    public XContentBuilder field(XContentBuilderString name, BytesReference value) throws IOException {, +        field(name);, +        if (!value.hasArray()) {, +            value = value.toBytesArray();, +        }, +        generator.writeBinary(value.array(), value.arrayOffset(), value.length());, +        return this;, +    }, +, +    public XContentBuilder field(XContentBuilderString name, Text value) throws IOException {, +        field(name);, +        if (value.hasBytes() && value.bytes().hasArray()) {, +            generator.writeUTF8String(value.bytes().array(), value.bytes().arrayOffset(), value.bytes().length());, +            return this;, +        }, +        if (value.hasString()) {, +            generator.writeString(value.string());, +            return this;, +        }, +        // TODO: TextBytesOptimization we can use a buffer here to convert it? maybe add a request to jackson to support InputStream as well?, +        BytesArray bytesArray = value.bytes().toBytesArray();, +        generator.writeUTF8String(bytesArray.array(), bytesArray.arrayOffset(), bytesArray.length());, +        return this;, +    }, +        } else if (value instanceof BytesReference) {, +            field(name, (BytesReference) value);, +        } else if (value instanceof Text) {, +            field(name, (Text) value);]