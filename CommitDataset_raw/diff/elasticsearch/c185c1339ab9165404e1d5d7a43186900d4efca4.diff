[+++ b/core/src/test/java/org/elasticsearch/ingest/IngestClientIT.java, +            //TODO can we remove this?, +                        .field("fail", false), +        source.put("fail", false);, +                .startObject("test"), +            indexRequest.source("field", "value", "fail", i % 2 == 0);, +                BulkItemResponse.Failure failure = itemResponse.getFailure();, +                assertThat(failure.getMessage(), equalTo("java.lang.IllegalArgumentException: test processor failed"));, +            } else {, +                        .startObject("test"), +        client().prepareIndex("test", "type", "1").setSource("field", "value", "fail", false), +        assertThat(doc.get("field"), equalTo("value"));, +        assertThat(doc.get("processed"), equalTo(true));, +                client().prepareIndex("test", "type", "2").setSource("field", "value2", "fail", false), +        assertThat(doc.get("field"), equalTo("value2"));, +        assertThat(doc.get("processed"), equalTo(true));, +                new TestProcessor("test", ingestDocument -> {, +                    ingestDocument.setFieldValue("processed", true);, +                    if (ingestDocument.getFieldValue("fail", Boolean.class)) {, +                        throw new IllegalArgumentException("test processor failed");, +                    }, +                })]