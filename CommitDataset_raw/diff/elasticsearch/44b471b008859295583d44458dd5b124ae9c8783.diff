[+++ b/core/src/main/java/org/elasticsearch/common/cache/Cache.java, +        ReadWriteLock segmentLock = new ReentrantReadWriteLock();, +        ReleasableLock readLock = new ReleasableLock(segmentLock.readLock());, +        ReleasableLock writeLock = new ReleasableLock(segmentLock.writeLock());, +    private ReleasableLock lruLock = new ReleasableLock(new ReentrantLock());, +        try (ReleasableLock ignored = lruLock.acquire()) {, +            try (ReleasableLock ignored = lruLock.acquire()) {, +        Arrays.stream(segments).forEach(segment -> segment.segmentLock.writeLock().lock());, +        try (ReleasableLock ignored = lruLock.acquire()) {, +        Arrays.stream(segments).forEach(segment -> segment.segmentLock.writeLock().unlock());, +        try (ReleasableLock ignored = lruLock.acquire()) {, +                try (ReleasableLock ignored = lruLock.acquire()) {, +        try (ReleasableLock ignored = lruLock.acquire()) {, +        assert lruLock.isHeldByCurrentThread();, +        assert lruLock.isHeldByCurrentThread();, +        assert lruLock.isHeldByCurrentThread();, +        assert lruLock.isHeldByCurrentThread();, +        assert lruLock.isHeldByCurrentThread();]