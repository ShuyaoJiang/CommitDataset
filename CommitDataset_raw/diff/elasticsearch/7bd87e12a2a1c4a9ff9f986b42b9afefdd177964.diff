[+++ b/src/main/java/org/elasticsearch/index/query/IndicesQueryParser.java, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.cluster.metadata.MetaData;, +import org.elasticsearch.common.Nullable;, +    @Nullable, +    private final ClusterService clusterService;, +, +    public IndicesQueryParser(@Nullable ClusterService clusterService) {, +        this.clusterService = clusterService;, +, +        String[] concreteIndices = indices.toArray(new String[indices.size()]);, +        if (clusterService != null) {, +            MetaData metaData = clusterService.state().metaData();, +            concreteIndices = metaData.concreteIndices(indices.toArray(new String[indices.size()]), true, true);, +        }, +, +        for (String index : concreteIndices) {, +++ b/src/main/java/org/elasticsearch/index/query/IndicesQueryParser.java, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.cluster.metadata.MetaData;, +import org.elasticsearch.common.Nullable;, +    @Nullable, +    private final ClusterService clusterService;, +, +    public IndicesQueryParser(@Nullable ClusterService clusterService) {, +        this.clusterService = clusterService;, +, +        String[] concreteIndices = indices.toArray(new String[indices.size()]);, +        if (clusterService != null) {, +            MetaData metaData = clusterService.state().metaData();, +            concreteIndices = metaData.concreteIndices(indices.toArray(new String[indices.size()]), true, true);, +        }, +, +        for (String index : concreteIndices) {, +++ b/src/main/java/org/elasticsearch/indices/query/IndicesQueriesRegistry.java, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.common.Nullable;, +    public IndicesQueriesRegistry(Settings settings, @Nullable ClusterService clusterService) {, +        addQueryParser(queryParsers, new IndicesQueryParser(clusterService));, +++ b/src/main/java/org/elasticsearch/index/query/IndicesQueryParser.java, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.cluster.metadata.MetaData;, +import org.elasticsearch.common.Nullable;, +    @Nullable, +    private final ClusterService clusterService;, +, +    public IndicesQueryParser(@Nullable ClusterService clusterService) {, +        this.clusterService = clusterService;, +, +        String[] concreteIndices = indices.toArray(new String[indices.size()]);, +        if (clusterService != null) {, +            MetaData metaData = clusterService.state().metaData();, +            concreteIndices = metaData.concreteIndices(indices.toArray(new String[indices.size()]), true, true);, +        }, +, +        for (String index : concreteIndices) {, +++ b/src/main/java/org/elasticsearch/indices/query/IndicesQueriesRegistry.java, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.common.Nullable;, +    public IndicesQueriesRegistry(Settings settings, @Nullable ClusterService clusterService) {, +        addQueryParser(queryParsers, new IndicesQueryParser(clusterService));, +++ b/src/test/java/org/elasticsearch/test/unit/index/aliases/IndexAliasesServiceTests.java, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.common.inject.AbstractModule;, +import org.elasticsearch.common.inject.util.Providers;, +                new IndexCacheModule(ImmutableSettings.Builder.EMPTY_SETTINGS),, +                new AbstractModule() {, +                    @Override, +                    protected void configure() {, +                        bind(ClusterService.class).toProvider(Providers.of((ClusterService) null));, +                    }, +                }, +++ b/src/main/java/org/elasticsearch/index/query/IndicesQueryParser.java, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.cluster.metadata.MetaData;, +import org.elasticsearch.common.Nullable;, +    @Nullable, +    private final ClusterService clusterService;, +, +    public IndicesQueryParser(@Nullable ClusterService clusterService) {, +        this.clusterService = clusterService;, +, +        String[] concreteIndices = indices.toArray(new String[indices.size()]);, +        if (clusterService != null) {, +            MetaData metaData = clusterService.state().metaData();, +            concreteIndices = metaData.concreteIndices(indices.toArray(new String[indices.size()]), true, true);, +        }, +, +        for (String index : concreteIndices) {, +++ b/src/main/java/org/elasticsearch/indices/query/IndicesQueriesRegistry.java, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.common.Nullable;, +    public IndicesQueriesRegistry(Settings settings, @Nullable ClusterService clusterService) {, +        addQueryParser(queryParsers, new IndicesQueryParser(clusterService));, +++ b/src/test/java/org/elasticsearch/test/unit/index/aliases/IndexAliasesServiceTests.java, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.common.inject.AbstractModule;, +import org.elasticsearch.common.inject.util.Providers;, +                new IndexCacheModule(ImmutableSettings.Builder.EMPTY_SETTINGS),, +                new AbstractModule() {]