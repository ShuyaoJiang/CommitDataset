[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/Actions.java, +import org.elasticsearch.cluster.node.DiscoveryNode;, +import org.elasticsearch.cluster.node.DiscoveryNodes;, +, +, +    public static boolean isAllNodes(String... nodesIds) {, +        return nodesIds == null || nodesIds.length == 0 || (nodesIds.length == 1 && nodesIds[0].equals("_all"));, +    }, +, +    public static String[] buildNodesIds(DiscoveryNodes nodes, String... nodesIds) {, +        if (isAllNodes(nodesIds)) {, +            int index = 0;, +            nodesIds = new String[nodes.size()];, +            for (DiscoveryNode node : nodes) {, +                nodesIds[index++] = node.id();, +            }, +            return nodesIds;, +        } else {, +            String[] resolvedNodesIds = new String[nodesIds.length];, +            for (int i = 0; i < nodesIds.length; i++) {, +                if (nodesIds[i].equals("_local")) {, +                    resolvedNodesIds[i] = nodes.localNodeId();, +                } else if (nodesIds[i].equals("_master")) {, +                    resolvedNodesIds[i] = nodes.masterNodeId();, +                } else {, +                    resolvedNodesIds[i] = nodesIds[i];, +                }, +            }, +            return resolvedNodesIds;, +        }, +    }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/Actions.java, +import org.elasticsearch.cluster.node.DiscoveryNode;, +import org.elasticsearch.cluster.node.DiscoveryNodes;, +, +, +    public static boolean isAllNodes(String... nodesIds) {, +        return nodesIds == null || nodesIds.length == 0 || (nodesIds.length == 1 && nodesIds[0].equals("_all"));, +    }, +, +    public static String[] buildNodesIds(DiscoveryNodes nodes, String... nodesIds) {, +        if (isAllNodes(nodesIds)) {, +            int index = 0;, +            nodesIds = new String[nodes.size()];, +            for (DiscoveryNode node : nodes) {, +                nodesIds[index++] = node.id();, +            }, +            return nodesIds;, +        } else {, +            String[] resolvedNodesIds = new String[nodesIds.length];, +            for (int i = 0; i < nodesIds.length; i++) {, +                if (nodesIds[i].equals("_local")) {, +                    resolvedNodesIds[i] = nodes.localNodeId();, +                } else if (nodesIds[i].equals("_master")) {, +                    resolvedNodesIds[i] = nodes.masterNodeId();, +                } else {, +                    resolvedNodesIds[i] = nodesIds[i];, +                }, +            }, +            return resolvedNodesIds;, +        }, +    }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +    @Override protected ClusterHealthResponse masterOperation(ClusterHealthRequest request, ClusterState state) throws ElasticSearchException {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/Actions.java, +import org.elasticsearch.cluster.node.DiscoveryNode;, +import org.elasticsearch.cluster.node.DiscoveryNodes;, +, +, +    public static boolean isAllNodes(String... nodesIds) {, +        return nodesIds == null || nodesIds.length == 0 || (nodesIds.length == 1 && nodesIds[0].equals("_all"));, +    }, +, +    public static String[] buildNodesIds(DiscoveryNodes nodes, String... nodesIds) {, +        if (isAllNodes(nodesIds)) {, +            int index = 0;, +            nodesIds = new String[nodes.size()];, +            for (DiscoveryNode node : nodes) {, +                nodesIds[index++] = node.id();, +            }, +            return nodesIds;, +        } else {, +            String[] resolvedNodesIds = new String[nodesIds.length];, +            for (int i = 0; i < nodesIds.length; i++) {, +                if (nodesIds[i].equals("_local")) {, +                    resolvedNodesIds[i] = nodes.localNodeId();, +                } else if (nodesIds[i].equals("_master")) {, +                    resolvedNodesIds[i] = nodes.masterNodeId();, +                } else {, +                    resolvedNodesIds[i] = nodesIds[i];, +                }, +            }, +            return resolvedNodesIds;, +        }, +    }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +    @Override protected ClusterHealthResponse masterOperation(ClusterHealthRequest request, ClusterState state) throws ElasticSearchException {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/node/shutdown/NodesShutdownRequest.java, +import org.elasticsearch.action.ActionRequestValidationException;, +import org.elasticsearch.action.support.master.MasterNodeOperationRequest;]