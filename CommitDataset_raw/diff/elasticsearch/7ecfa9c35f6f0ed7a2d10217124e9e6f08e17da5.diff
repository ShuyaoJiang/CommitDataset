[+++ b/src/main/java/org/elasticsearch/index/cache/filter/weighted/WeightedFilterCache.java, +import org.apache.lucene.index.AtomicReaderContext;, +import org.apache.lucene.util.Bits;, +, +        public DocIdSet getDocIdSet(AtomicReaderContext context, Bits acceptDocs) throws IOException {, +            FilterCacheKey cacheKey = new FilterCacheKey(cache.index().name(), context.reader().getCoreCacheKey(), filterKey);, +                if (!cache.seenReaders.containsKey(context.reader().getCoreCacheKey())) {, +                    Boolean previous = cache.seenReaders.putIfAbsent(context.reader().getCoreCacheKey(), Boolean.TRUE);, +                    if (previous == null && (context.reader() instanceof SegmentReader)) {, +                        ((SegmentReader) context.reader()).addCoreClosedListener(cache);, +                // we pass down the acceptDocs so things like TermFilter will be able to make use of it, +                // but we don't wrap it with accept docs in "our own filters", we rely on it being applied, +                // on the top level, +                cacheValue = DocSets.cacheable(context.reader(), filter.getDocIdSet(context, acceptDocs));]