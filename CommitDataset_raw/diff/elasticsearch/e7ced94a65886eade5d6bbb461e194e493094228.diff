[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/transport/netty4/SecurityNetty4Transport.java, +            super.initChannel(ch);, +            assert ch.pipeline().first() == sslHandler : "SSL handler must be first handler in pipeline";, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/transport/netty4/SecurityNetty4Transport.java, +            super.initChannel(ch);, +            assert ch.pipeline().first() == sslHandler : "SSL handler must be first handler in pipeline";, +++ b/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/transport/SSLEngineUtils.java, +import io.netty.channel.ChannelException;, +            if (handler == null) {, +                if (nettyChannel.isOpen()) {, +                    assert false : "Must have SslHandler";, +                } else {, +                    throw new ChannelException("Channel is closed.");, +                }, +            }]