[+++ b/src/test/java/org/elasticsearch/test/TestCluster.java, +import org.elasticsearch.client.node.NodeClient;, +     * Returns a transport client, +     */, +    public synchronized Client transportClient() {, +        ensureOpen();, +        // randomly return a transport client going to one of the nodes in the cluster, +        return getOrBuildRandomNode().transportClient();, +    }, +, +    /**, +        private Client transportClient;, +                Client maybeNodeClient = client(random);, +                if (client instanceof NodeClient) {, +                    nodeClient = maybeNodeClient;, +                } else {, +            }, +        Client transportClient() {, +            if (closed.get()) {, +                throw new RuntimeException("already closed");, +            }, +            if (transportClient == null) {, +                Client maybeTransportClient = client(random);, +                if (maybeTransportClient instanceof TransportClient) {, +                    transportClient = maybeTransportClient;, +                } else {, +                    transportClient = TransportClientFactory.NO_SNIFF_CLIENT_FACTORY.client(node, clusterName, random);, +                }, +            }, +            return transportClient;, +        }, +, +            if (transportClient != null) {, +                transportClient.close();, +                transportClient = null;, +            }]