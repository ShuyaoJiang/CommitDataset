[+++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/support/AgentUtils.java, +        if (text == null) {, +            return null;, +        }, +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/support/AgentUtils.java, +        if (text == null) {, +            return null;, +        }, +++ b/qa/smoke-test-plugins/integration-tests.xml, +  <!-- redefined to work with auth -->, +  <macrodef name="waitfor-elasticsearch">, +      <attribute name="port"/>, +      <attribute name="timeoutproperty"/>, +    <sequential>, +      <echo>Waiting for elasticsearch to become available on port @{port}...</echo>, +      <waitfor maxwait="30" maxwaitunit="second", +               checkevery="500" checkeveryunit="millisecond", +               timeoutproperty="@{timeoutproperty}">, +        <socket server="127.0.0.1" port="@{port}"/>, +      </waitfor>, +    </sequential>, +  </macrodef>, +, +, +    <local name="home"/>, +    <property name="home" location="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +, +    <echo>Setting up Shield auth</echo>, +    <run-script script="${home}/bin/shield/esusers" args="useradd test_user -p changeme -r admin"/>, +    <run-script script="${home}/bin/shield/esusers" args="useradd marvel_export -p changeme -r marvel_agent"/>, +, +    <startup-elasticsearch additional.args="-Des.marvel.agent.exporter.es.hosts=http://marvel_export:changeme@localhost:${integ.http.port}" />, +, +    <echo>Checking we can connect with basic auth on port ${integ.http.port}...</echo>, +    <local name="temp.file"/>, +    <tempfile property="temp.file" destdir="${java.io.tmpdir}"/>, +    <get src="http://127.0.0.1:${integ.http.port}" dest="${temp.file}" , +         username="test_user" password="changeme" verbose="true" retries="10"/>, +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/support/AgentUtils.java, +        if (text == null) {, +            return null;, +        }, +++ b/qa/smoke-test-plugins/integration-tests.xml, +  <!-- redefined to work with auth -->, +  <macrodef name="waitfor-elasticsearch">, +      <attribute name="port"/>, +      <attribute name="timeoutproperty"/>, +    <sequential>, +      <echo>Waiting for elasticsearch to become available on port @{port}...</echo>, +      <waitfor maxwait="30" maxwaitunit="second", +               checkevery="500" checkeveryunit="millisecond", +               timeoutproperty="@{timeoutproperty}">, +        <socket server="127.0.0.1" port="@{port}"/>, +      </waitfor>, +    </sequential>, +  </macrodef>, +, +, +    <local name="home"/>, +    <property name="home" location="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +, +    <echo>Setting up Shield auth</echo>, +    <run-script script="${home}/bin/shield/esusers" args="useradd test_user -p changeme -r admin"/>, +    <run-script script="${home}/bin/shield/esusers" args="useradd marvel_export -p changeme -r marvel_agent"/>, +, +    <startup-elasticsearch additional.args="-Des.marvel.agent.exporter.es.hosts=http://marvel_export:changeme@localhost:${integ.http.port}" />, +, +    <echo>Checking we can connect with basic auth on port ${integ.http.port}...</echo>, +    <local name="temp.file"/>, +    <tempfile property="temp.file" destdir="${java.io.tmpdir}"/>, +    <get src="http://127.0.0.1:${integ.http.port}" dest="${temp.file}" , +         username="test_user" password="changeme" verbose="true" retries="10"/>, +++ b/qa/smoke-test-plugins/pom.xml, +    <xplugins.list>elasticsearch-license,elasticsearch-marvel,elasticsearch-shield,elasticsearch-watcher</xplugins.list>, +  <dependencies>, +    <dependency>, +      <groupId>org.elasticsearch.plugin</groupId>, +      <artifactId>elasticsearch-shield</artifactId>, +      <version>2.0.0-beta1-SNAPSHOT</version>, +      <scope>test</scope>, +    </dependency>, +  </dependencies>, +, +                 </artifactItem>, +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/support/AgentUtils.java, +        if (text == null) {, +            return null;, +        }, +++ b/qa/smoke-test-plugins/integration-tests.xml, +  <!-- redefined to work with auth -->, +  <macrodef name="waitfor-elasticsearch">, +      <attribute name="port"/>, +      <attribute name="timeoutproperty"/>, +    <sequential>, +      <echo>Waiting for elasticsearch to become available on port @{port}...</echo>, +      <waitfor maxwait="30" maxwaitunit="second", +               checkevery="500" checkeveryunit="millisecond", +               timeoutproperty="@{timeoutproperty}">, +        <socket server="127.0.0.1" port="@{port}"/>, +      </waitfor>]