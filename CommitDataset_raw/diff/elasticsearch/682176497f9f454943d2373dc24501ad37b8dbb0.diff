[+++ b/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java, +import org.elasticsearch.common.unit.TimeValue;, +import org.elasticsearch.index.mapper.internal.TTLFieldMapper;, +        long getDate = System.currentTimeMillis();, +                new String[]{SourceFieldMapper.NAME, RoutingFieldMapper.NAME, ParentFieldMapper.NAME, TTLFieldMapper.NAME}, true);, +        String timestamp = (String) ctx.get("_timestamp");, +        Long ttl = null;, +        Object fetchedTTL = ctx.get("_ttl");, +        if (fetchedTTL != null) {, +            if (fetchedTTL instanceof Number) {, +                ttl = ((Number) fetchedTTL).longValue();, +            } else {, +                ttl = TimeValue.parseTimeValue((String) fetchedTTL, null).millis();, +            }, +        }, +        // No TTL has been given in the update script so we keep previous TTL value if there is one, +        if (ttl == null) {, +            ttl = getResult.fields().containsKey(TTLFieldMapper.NAME) ? (Long) getResult.field(TTLFieldMapper.NAME).value() : null;, +            if (ttl != null) {, +                ttl = ttl - (System.currentTimeMillis() - getDate); // It is an approximation of exact TTL value, could be improved, +            }, +        }, +                    .version(getResult.version()).replicationType(request.replicationType()).consistencyLevel(request.consistencyLevel()), +                    .timestamp(timestamp).ttl(ttl);]