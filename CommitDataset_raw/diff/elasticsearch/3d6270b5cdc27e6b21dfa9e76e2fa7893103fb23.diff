[+++ b/core/src/main/java/org/elasticsearch/ingest/PipelineStore.java, +import java.util.Objects;, +        innerUpdatePipelines(event.previousState(), event.state());, +    void innerUpdatePipelines(ClusterState previousState, ClusterState state) {, +        IngestMetadata previousIngestMetadata = previousState.getMetaData().custom(IngestMetadata.TYPE);, +        if (Objects.equals(ingestMetadata, previousIngestMetadata)) {, +++ b/core/src/main/java/org/elasticsearch/ingest/PipelineStore.java, +import java.util.Objects;, +        innerUpdatePipelines(event.previousState(), event.state());, +    void innerUpdatePipelines(ClusterState previousState, ClusterState state) {, +        IngestMetadata previousIngestMetadata = previousState.getMetaData().custom(IngestMetadata.TYPE);, +        if (Objects.equals(ingestMetadata, previousIngestMetadata)) {, +++ b/core/src/test/java/org/elasticsearch/ingest/PipelineStoreTests.java, +        ClusterState previousClusterState = clusterState;, +        store.innerUpdatePipelines(previousClusterState, clusterState);, +        store.innerUpdatePipelines(previousClusterState, clusterState);, +        ClusterState previousClusterState = clusterState;, +        store.innerUpdatePipelines(previousClusterState, clusterState);, +        previousClusterState = clusterState;, +        store.innerUpdatePipelines(previousClusterState, clusterState);, +        ClusterState previousClusterState = clusterState;, +            store.innerUpdatePipelines(previousClusterState, clusterState);, +        ClusterState clusterState = ClusterState.builder(new ClusterName("_name")).build();, +        ClusterState previousClusterState = clusterState;, +        clusterState = ClusterState.builder(clusterState).metaData(MetaData.builder(), +            .putCustom(IngestMetadata.TYPE, ingestMetadata)).build();, +        store.innerUpdatePipelines(previousClusterState, clusterState);, +        previousClusterState = clusterState;, +        store.innerUpdatePipelines(previousClusterState, clusterState);, +        ClusterState previousClusterState = clusterState;, +        store.innerUpdatePipelines(previousClusterState, clusterState);, +        previousClusterState = clusterState;, +        store.innerUpdatePipelines(previousClusterState, clusterState);]