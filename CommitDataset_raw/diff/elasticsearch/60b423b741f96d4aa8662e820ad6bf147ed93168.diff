[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/filter/FilterFacetCollector.java, +        this.filter = filter;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/filter/FilterFacetCollector.java, +        this.filter = filter;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/query/QueryFacetCollector.java, +            this.filter = possibleFilter;, +            this.filter = new QueryWrapperFilter(query);]