[+++ b/src/test/java/org/elasticsearch/percolator/PercolatorTests.java, +import com.google.common.base.Predicate;, +import org.elasticsearch.action.admin.indices.mapping.get.GetMappingsResponse;, +        assertAcked(client().admin().indices().prepareCreate("test1"));, +        assertAcked(client().admin().indices().prepareCreate("test2"));, +        awaitBusy(new Predicate<Object>() {, +            @Override, +            public boolean apply(Object o) {, +                GetMappingsResponse getMappingsResponse = client().admin().indices().prepareGetMappings("test1", "test2").get();, +                boolean hasPercolatorType = getMappingsResponse.getMappings().get("test1").containsKey(PercolatorService.TYPE_NAME);, +                if (hasPercolatorType) {, +                    return getMappingsResponse.getMappings().get("test2").containsKey(PercolatorService.TYPE_NAME);, +                } else {, +                    return false;, +                }, +            }, +        });, +]