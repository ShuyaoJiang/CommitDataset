[+++ b/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +import org.elasticsearch.ElasticSearchIllegalStateException;, +    private final Object mutex = new Object();, +        synchronized (mutex) {, +            if (closed) {, +                throw new ElasticSearchIllegalStateException("transport client is closed, can't add an address");, +            }, +        }, +        synchronized (mutex) {, +            if (closed) {, +                throw new ElasticSearchIllegalStateException("transport client is closed, can't remove an address");, +            }, +        }, +        synchronized (mutex) {, +            if (closed) {, +                return;, +            }, +    }, +    abstract class NodeSampler {, +        public void sample() {, +            synchronized (mutex) {, +                if (closed) {, +                    return;, +                }, +                doSample();, +            }, +        }, +, +        protected abstract void doSample();, +    class SimpleNodeSampler extends NodeSampler {, +        protected void doSample() {, +    class SniffNodesSampler extends NodeSampler {, +        protected void doSample() {]