[+++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +        // Special handling for broken AWS code which destroys all SSL security, +        // REMOVE THIS when https://github.com/aws/aws-sdk-java/pull/432 is fixed, +        if (permission instanceof RuntimePermission && "accessClassInPackage.sun.security.ssl".equals(permission.getName())) {, +            for (StackTraceElement element : Thread.currentThread().getStackTrace()) {, +                if ("com.amazonaws.http.conn.ssl.SdkTLSSocketFactory".equals(element.getClassName()) &&, +                      "verifyMasterSecret".equals(element.getMethodName())) {, +                    // we found the horrible method: the hack begins!, +                    // force the aws code to back down, by throwing an exception that it catches., +                    rethrow(new IllegalAccessException("no amazon, you cannot do this."));, +                }, +            }, +        }, +, +    /**, +     * Classy puzzler to rethrow any checked exception as an unchecked one., +     */, +    private static class Rethrower<T extends Throwable> {, +        private void rethrow(Throwable t) throws T {, +            throw (T) t;, +        }, +    }, +, +    /**, +     * Rethrows <code>t</code> (identical object)., +     */, +    private void rethrow(Throwable t) {, +        new Rethrower<Error>().rethrow(t);, +    }, +++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +        // Special handling for broken AWS code which destroys all SSL security, +        // REMOVE THIS when https://github.com/aws/aws-sdk-java/pull/432 is fixed, +        if (permission instanceof RuntimePermission && "accessClassInPackage.sun.security.ssl".equals(permission.getName())) {, +            for (StackTraceElement element : Thread.currentThread().getStackTrace()) {, +                if ("com.amazonaws.http.conn.ssl.SdkTLSSocketFactory".equals(element.getClassName()) &&, +                      "verifyMasterSecret".equals(element.getMethodName())) {, +                    // we found the horrible method: the hack begins!, +                    // force the aws code to back down, by throwing an exception that it catches., +                    rethrow(new IllegalAccessException("no amazon, you cannot do this."));, +                }, +            }, +        }, +, +    /**, +     * Classy puzzler to rethrow any checked exception as an unchecked one., +     */, +    private static class Rethrower<T extends Throwable> {, +        private void rethrow(Throwable t) throws T {, +            throw (T) t;, +        }, +    }, +, +    /**, +     * Rethrows <code>t</code> (identical object)., +     */, +    private void rethrow(Throwable t) {, +        new Rethrower<Error>().rethrow(t);, +    }, +++ b/core/src/main/resources/org/elasticsearch/bootstrap/security.policy, +++ b/core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java, +        // Special handling for broken AWS code which destroys all SSL security, +        // REMOVE THIS when https://github.com/aws/aws-sdk-java/pull/432 is fixed, +        if (permission instanceof RuntimePermission && "accessClassInPackage.sun.security.ssl".equals(permission.getName())) {, +            for (StackTraceElement element : Thread.currentThread().getStackTrace()) {, +                if ("com.amazonaws.http.conn.ssl.SdkTLSSocketFactory".equals(element.getClassName()) &&, +                      "verifyMasterSecret".equals(element.getMethodName())) {, +                    // we found the horrible method: the hack begins!, +                    // force the aws code to back down, by throwing an exception that it catches., +                    rethrow(new IllegalAccessException("no amazon, you cannot do this."));, +                }, +            }, +        }, +, +    /**, +     * Classy puzzler to rethrow any checked exception as an unchecked one., +     */, +    private static class Rethrower<T extends Throwable> {, +        private void rethrow(Throwable t) throws T {, +            throw (T) t;, +        }, +    }, +, +    /**, +     * Rethrows <code>t</code> (identical object)., +     */, +    private void rethrow(Throwable t) {, +        new Rethrower<Error>().rethrow(t);, +    }, +++ b/core/src/main/resources/org/elasticsearch/bootstrap/security.policy, +++ b/plugins/repository-s3/rest-api-spec/test/repository_s3/20_repository.yaml]