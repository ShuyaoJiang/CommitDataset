[+++ b/plugin/src/main/java/org/elasticsearch/xpack/security/authc/file/tool/UsersTool.java, +    }, +, +    protected AddUserCommand newAddUserCommand() {, +        return new AddUserCommand();, +    }, +, +    protected DeleteUserCommand newDeleteUserCommand() {, +        return new DeleteUserCommand();, +    }, +, +    protected PasswordCommand newPasswordCommand() {, +        return new PasswordCommand();, +    }, +, +    protected RolesCommand newRolesCommand() {, +        return new RolesCommand();, +    }, +, +    protected ListCommand newListCommand() {, +        return new ListCommand();, +++ b/plugin/src/main/java/org/elasticsearch/xpack/security/authc/file/tool/UsersTool.java, +    }, +, +    protected AddUserCommand newAddUserCommand() {, +        return new AddUserCommand();, +    }, +, +    protected DeleteUserCommand newDeleteUserCommand() {, +        return new DeleteUserCommand();, +    }, +, +    protected PasswordCommand newPasswordCommand() {, +        return new PasswordCommand();, +    }, +, +    protected RolesCommand newRolesCommand() {, +        return new RolesCommand();, +    }, +, +    protected ListCommand newListCommand() {, +        return new ListCommand();, +++ b/plugin/src/test/java/org/elasticsearch/xpack/security/authc/file/tool/UsersToolTests.java, +import org.elasticsearch.cli.EnvironmentAwareCommand;, +import org.elasticsearch.cli.Terminal;, +import org.elasticsearch.xpack.security.authc.UserTokenTests;, +import java.util.Map;, +        return new UsersTool() {, +            @Override, +            protected AddUserCommand newAddUserCommand() {, +                return new AddUserCommand() {, +                    @Override, +                    protected Environment createEnv(Terminal terminal, Map<String, String> settings) throws UserException {, +                        return new Environment(UsersToolTests.this.settings, confDir.getParent());, +                    }, +                };, +            }, +, +            @Override, +            protected DeleteUserCommand newDeleteUserCommand() {, +                return new DeleteUserCommand() {, +                    @Override, +                    protected Environment createEnv(Terminal terminal, Map<String, String> settings) throws UserException {, +                        return new Environment(UsersToolTests.this.settings, confDir.getParent());, +                    }, +                };, +            }, +, +            @Override, +            protected PasswordCommand newPasswordCommand() {, +                return new PasswordCommand() {, +                    @Override, +                    protected Environment createEnv(Terminal terminal, Map<String, String> settings) throws UserException {, +                        return new Environment(UsersToolTests.this.settings, confDir.getParent());, +                    }, +                };, +            }, +, +            @Override, +            protected RolesCommand newRolesCommand() {, +                return new RolesCommand() {, +                    @Override, +                    protected Environment createEnv(Terminal terminal, Map<String, String> settings) throws UserException {, +                        return new Environment(UsersToolTests.this.settings, confDir.getParent());, +                    }, +                };, +            }, +, +            @Override, +            protected ListCommand newListCommand() {, +                return new ListCommand() {, +                    @Override, +                    protected Environment createEnv(Terminal terminal, Map<String, String> settings) throws UserException {, +                        return new Environment(UsersToolTests.this.settings, confDir.getParent());, +                    }, +                };, +            }, +        };]