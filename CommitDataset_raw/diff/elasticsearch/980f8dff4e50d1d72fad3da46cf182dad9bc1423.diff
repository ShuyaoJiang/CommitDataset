[+++ b/server/src/main/java/org/elasticsearch/common/time/DateUtils.java, +        return nowWithMillisResolution(Clock.systemUTC());, +    }, +, +    public static ZonedDateTime nowWithMillisResolution(Clock clock) {, +        Clock millisResolutionClock = Clock.tick(clock, Duration.ofMillis(1));, +++ b/server/src/main/java/org/elasticsearch/common/time/DateUtils.java, +        return nowWithMillisResolution(Clock.systemUTC());, +    }, +, +    public static ZonedDateTime nowWithMillisResolution(Clock clock) {, +        Clock millisResolutionClock = Clock.tick(clock, Duration.ofMillis(1));, +++ b/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/WatcherIndexingListener.java, +import java.time.Instant;, +            ZonedDateTime now = Instant.ofEpochMilli(clock.millis()).atZone(ZoneOffset.UTC);, +++ b/server/src/main/java/org/elasticsearch/common/time/DateUtils.java, +        return nowWithMillisResolution(Clock.systemUTC());, +    }, +, +    public static ZonedDateTime nowWithMillisResolution(Clock clock) {, +        Clock millisResolutionClock = Clock.tick(clock, Duration.ofMillis(1));, +++ b/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/WatcherIndexingListener.java, +import java.time.Instant;, +            ZonedDateTime now = Instant.ofEpochMilli(clock.millis()).atZone(ZoneOffset.UTC);, +++ b/x-pack/plugin/watcher/src/test/java/org/elasticsearch/xpack/watcher/WatcherIndexingListenerTests.java, +import org.elasticsearch.common.time.DateUtils;, +        ZonedDateTime now = DateUtils.nowWithMillisResolution(clock);, +++ b/server/src/main/java/org/elasticsearch/common/time/DateUtils.java, +        return nowWithMillisResolution(Clock.systemUTC());, +    }, +, +    public static ZonedDateTime nowWithMillisResolution(Clock clock) {, +        Clock millisResolutionClock = Clock.tick(clock, Duration.ofMillis(1));, +++ b/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/WatcherIndexingListener.java, +import java.time.Instant;, +            ZonedDateTime now = Instant.ofEpochMilli(clock.millis()).atZone(ZoneOffset.UTC);, +++ b/x-pack/plugin/watcher/src/test/java/org/elasticsearch/xpack/watcher/WatcherIndexingListenerTests.java, +import org.elasticsearch.common.time.DateUtils;, +        ZonedDateTime now = DateUtils.nowWithMillisResolution(clock);, +++ b/x-pack/plugin/watcher/src/test/java/org/elasticsearch/xpack/watcher/actions/index/IndexActionTests.java, +import org.elasticsearch.xpack.core.watcher.support.WatcherDateTimeUtils;, +            assertThat(indexRequest.sourceAsMap(), hasEntry(timestampField, WatcherDateTimeUtils.formatDate(executionTime)));]