[+++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java, +    ScriptProcessor(String tag, Script script, ScriptService scriptService)  {, +        executableScript.run();, +            return new ScriptProcessor(processorTag, script, scriptService);, +++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java, +    ScriptProcessor(String tag, Script script, ScriptService scriptService)  {, +        executableScript.run();, +            return new ScriptProcessor(processorTag, script, scriptService);, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java, +++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java, +    ScriptProcessor(String tag, Script script, ScriptService scriptService)  {, +        executableScript.run();, +            return new ScriptProcessor(processorTag, script, scriptService);, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java, +import org.mockito.stubbing.Answer;, +import static org.mockito.Mockito.doAnswer;, +        int randomBytesIn = randomInt();, +        int randomBytesOut = randomInt();, +        int randomBytesTotal = randomBytesIn + randomBytesOut;, +, +        document.put("bytes_in", randomInt());, +        document.put("bytes_out", randomInt());, +, +        doAnswer(invocationOnMock ->  {, +            ingestDocument.setFieldValue("bytes_total", randomBytesTotal);, +            return null;, +        }).when(executableScript).run();, +, +        ScriptProcessor processor = new ScriptProcessor(randomAsciiOfLength(10), script, scriptService);, +, +        assertThat(ingestDocument.getSourceAndMetadata().get("bytes_total"), is(randomBytesTotal));, +++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java, +    ScriptProcessor(String tag, Script script, ScriptService scriptService)  {, +        executableScript.run();, +            return new ScriptProcessor(processorTag, script, scriptService);, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java, +import org.mockito.stubbing.Answer;, +import static org.mockito.Mockito.doAnswer;, +        int randomBytesIn = randomInt();, +        int randomBytesOut = randomInt();, +        int randomBytesTotal = randomBytesIn + randomBytesOut;, +, +        document.put("bytes_in", randomInt());, +        document.put("bytes_out", randomInt());, +, +        doAnswer(invocationOnMock ->  {, +            ingestDocument.setFieldValue("bytes_total", randomBytesTotal);, +            return null;, +        }).when(executableScript).run();, +, +        ScriptProcessor processor = new ScriptProcessor(randomAsciiOfLength(10), script, scriptService);, +, +        assertThat(ingestDocument.getSourceAndMetadata().get("bytes_total"), is(randomBytesTotal));, +++ b/qa/smoke-test-ingest-with-all-dependencies/src/test/resources/rest-api-spec/test/ingest/50_script_processor_using_painless.yaml, +                  "inline": "ctx.bytes_total = ctx.bytes_in + ctx.bytes_out", +            "script" : "ctx.bytes_total = ctx.bytes_in + ctx.bytes_out", +++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java, +    ScriptProcessor(String tag, Script script, ScriptService scriptService)  {, +        executableScript.run();, +            return new ScriptProcessor(processorTag, script, scriptService);, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java, +import org.mockito.stubbing.Answer;, +import static org.mockito.Mockito.doAnswer;, +        int randomBytesIn = randomInt();, +        int randomBytesOut = randomInt();, +        int randomBytesTotal = randomBytesIn + randomBytesOut;, +, +        document.put("bytes_in", randomInt());, +        document.put("bytes_out", randomInt());, +, +        doAnswer(invocationOnMock ->  {, +            ingestDocument.setFieldValue("bytes_total", randomBytesTotal);, +            return null;, +        }).when(executableScript).run();, +, +        ScriptProcessor processor = new ScriptProcessor(randomAsciiOfLength(10), script, scriptService);, +, +        assertThat(ingestDocument.getSourceAndMetadata().get("bytes_total"), is(randomBytesTotal));, +++ b/qa/smoke-test-ingest-with-all-dependencies/src/test/resources/rest-api-spec/test/ingest/50_script_processor_using_painless.yaml, +                  "inline": "ctx.bytes_total = ctx.bytes_in + ctx.bytes_out", +            "script" : "ctx.bytes_total = ctx.bytes_in + ctx.bytes_out", +++ b/qa/smoke-test-ingest-with-all-dependencies/src/test/resources/scripts/master.painless, +ctx.bytes_total = ctx.bytes_in + ctx.bytes_out]