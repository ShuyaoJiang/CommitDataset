[+++ b/core/src/main/java/org/elasticsearch/transport/netty/MessageChannelHandler.java, +            if (version.onOrAfter(Version.CURRENT.minimumCompatibilityVersion()) == false || version.major != Version.CURRENT.major) {, +                throw new IllegalStateException("Received message from unsupported version: [" + version, +                    + "] minimal compatible version is: [" +Version.CURRENT.minimumCompatibilityVersion() + "]");, +            }, +++ b/core/src/main/java/org/elasticsearch/transport/netty/MessageChannelHandler.java, +            if (version.onOrAfter(Version.CURRENT.minimumCompatibilityVersion()) == false || version.major != Version.CURRENT.major) {, +                throw new IllegalStateException("Received message from unsupported version: [" + version, +                    + "] minimal compatible version is: [" +Version.CURRENT.minimumCompatibilityVersion() + "]");, +            }, +++ b/core/src/test/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java, +    protected static final Version version0 = Version.CURRENT.minimumCompatibilityVersion();, +    protected static final Version version1 = Version.fromId(Version.CURRENT.id+1);, +        CountDownLatch doneLatch = new CountDownLatch(1);, +                    doneLatch.await(sleep.millis(), TimeUnit.MILLISECONDS);, +        doneLatch.countDown();]