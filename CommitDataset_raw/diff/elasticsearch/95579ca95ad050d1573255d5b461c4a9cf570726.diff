[+++ b/build.gradle, +import org.eclipse.jgit.lib.Repository, +import org.eclipse.jgit.lib.RepositoryBuilder, +    nexus {, +      Repository repo = new RepositoryBuilder().findGitDir(new File('.')).build(), +      String shortHash = repo.resolve('HEAD')?.name?.substring(0,7), +      String buildSnapshot = System.getProperty('build.snapshot', 'true'), +      if (buildSnapshot == 'false') {, +        repositoryUrl = project.hasProperty('build.repository') ? project.property('build.repository') : "file://${System.getenv('HOME')}/elasticsearch-releases/${version}-${shortHash}/", +      }, +    }, +    // TODO: add gpg signing prompts, which is tricky, as the buildDeb/buildRpm tasks are executed before this code block, +        // no need for username/password on local deploy, +        if (project.nexus.repositoryUrl.startsWith('file://')) {, +          project.rootProject.allprojects.each {, +            it.ext.nexusUsername = 'foo', +            it.ext.nexusPassword = 'bar', +          }, +        } else {, +}, +++ b/build.gradle, +import org.eclipse.jgit.lib.Repository, +import org.eclipse.jgit.lib.RepositoryBuilder, +    nexus {, +      Repository repo = new RepositoryBuilder().findGitDir(new File('.')).build(), +      String shortHash = repo.resolve('HEAD')?.name?.substring(0,7), +      String buildSnapshot = System.getProperty('build.snapshot', 'true'), +      if (buildSnapshot == 'false') {, +        repositoryUrl = project.hasProperty('build.repository') ? project.property('build.repository') : "file://${System.getenv('HOME')}/elasticsearch-releases/${version}-${shortHash}/", +      }, +    }, +    // TODO: add gpg signing prompts, which is tricky, as the buildDeb/buildRpm tasks are executed before this code block, +        // no need for username/password on local deploy, +        if (project.nexus.repositoryUrl.startsWith('file://')) {, +          project.rootProject.allprojects.each {, +            it.ext.nexusUsername = 'foo', +            it.ext.nexusPassword = 'bar', +          }, +        } else {, +}, +++ b/core/src/main/java/org/elasticsearch/action/percolate/TransportPercolateAction.java, +import java.io.IOException;, +import java.util.Arrays;, +, +            QueryParseContext queryParseContext = new QueryParseContext(queryRegistry);, +            queryParseContext.reset(XContentHelper.createParser(querySource));, +            queryParseContext.parseFieldMatcher(parseFieldMatcher);, +        QueryParseContext context = new QueryParseContext(queryRegistry);, +            context.reset(parser);, +            context.parseFieldMatcher(parseFieldMatcher);, +++ b/build.gradle, +import org.eclipse.jgit.lib.Repository, +import org.eclipse.jgit.lib.RepositoryBuilder, +    nexus {, +      Repository repo = new RepositoryBuilder().findGitDir(new File('.')).build(), +      String shortHash = repo.resolve('HEAD')?.name?.substring(0,7), +      String buildSnapshot = System.getProperty('build.snapshot', 'true'), +      if (buildSnapshot == 'false') {, +        repositoryUrl = project.hasProperty('build.repository') ? project.property('build.repository') : "file://${System.getenv('HOME')}/elasticsearch-releases/${version}-${shortHash}/", +      }, +    }, +    // TODO: add gpg signing prompts, which is tricky, as the buildDeb/buildRpm tasks are executed before this code block, +        // no need for username/password on local deploy, +        if (project.nexus.repositoryUrl.startsWith('file://')) {, +          project.rootProject.allprojects.each {, +            it.ext.nexusUsername = 'foo', +            it.ext.nexusPassword = 'bar', +          }, +        } else {, +}, +++ b/core/src/main/java/org/elasticsearch/action/percolate/TransportPercolateAction.java, +import java.io.IOException;, +import java.util.Arrays;, +, +            QueryParseContext queryParseContext = new QueryParseContext(queryRegistry);, +            queryParseContext.reset(XContentHelper.createParser(querySource));, +            queryParseContext.parseFieldMatcher(parseFieldMatcher);, +        QueryParseContext context = new QueryParseContext(queryRegistry);, +            context.reset(parser);, +            context.parseFieldMatcher(parseFieldMatcher);, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/AliasValidator.java, +import org.elasticsearch.index.Index;, +            queryShardContext.reset(parser);, +            QueryParseContext queryParseContext = queryShardContext.parseContext();, +            queryShardContext.reset(null);, +++ b/build.gradle, +import org.eclipse.jgit.lib.Repository, +import org.eclipse.jgit.lib.RepositoryBuilder, +    nexus {, +      Repository repo = new RepositoryBuilder().findGitDir(new File('.')).build(), +      String shortHash = repo.resolve('HEAD')?.name?.substring(0,7), +      String buildSnapshot = System.getProperty('build.snapshot', 'true'), +      if (buildSnapshot == 'false') {, +        repositoryUrl = project.hasProperty('build.repository') ? project.property('build.repository') : "file://${System.getenv('HOME')}/elasticsearch-releases/${version}-${shortHash}/", +      }, +    }, +    // TODO: add gpg signing prompts, which is tricky, as the buildDeb/buildRpm tasks are executed before this code block, +        // no need for username/password on local deploy, +        if (project.nexus.repositoryUrl.startsWith('file://')) {, +          project.rootProject.allprojects.each {]