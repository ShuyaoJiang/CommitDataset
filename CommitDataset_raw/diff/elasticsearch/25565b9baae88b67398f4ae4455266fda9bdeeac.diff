[+++ b/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/RatedRequest.java, +import java.util.HashSet;, +import java.util.Set;, +        setRatedDocs(ratedDocs);, +    /**, +     * Set a list of rated documents for this query., +     * No documents with same _index/_type/id allowed., +     **/, +        Set<DocumentKey> docKeys = new HashSet<>();, +        for (RatedDocument doc : ratedDocs) {, +            if (docKeys.add(doc.getKey()) == false) {, +                String docKeyToString = doc.getKey().toString().replaceAll("\n", "").replaceAll("  ", " ");, +                throw new IllegalArgumentException(, +                        "Found duplicate rated document key [" + docKeyToString + "]");, +            }, +        }, +++ b/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/RatedRequest.java, +import java.util.HashSet;, +import java.util.Set;, +        setRatedDocs(ratedDocs);, +    /**, +     * Set a list of rated documents for this query., +     * No documents with same _index/_type/id allowed., +     **/, +        Set<DocumentKey> docKeys = new HashSet<>();, +        for (RatedDocument doc : ratedDocs) {, +            if (docKeys.add(doc.getKey()) == false) {, +                String docKeyToString = doc.getKey().toString().replaceAll("\n", "").replaceAll("  ", " ");, +                throw new IllegalArgumentException(, +                        "Found duplicate rated document key [" + docKeyToString + "]");, +            }, +        }, +++ b/modules/rank-eval/src/test/java/org/elasticsearch/index/rankeval/RatedRequestsTests.java, +import java.util.Arrays;, +    public void testDuplicateRatedDocThrowsException() {, +        RatedRequest request = createTestItem(Arrays.asList("index"), Arrays.asList("type"));, +        List<RatedDocument> ratedDocs = Arrays.asList(new RatedDocument(new DocumentKey("index1", "type1", "id1"), 1),, +                new RatedDocument(new DocumentKey("index1", "type1", "id1"), 5));, +        IllegalArgumentException ex = expectThrows(IllegalArgumentException.class, () -> request.setRatedDocs(ratedDocs));, +        assertEquals(, +                "Found duplicate rated document key [{ \"_index\" : \"index1\", \"_type\" : \"type1\", \"_id\" : \"id1\"}]",, +                ex.getMessage());, +    }, +]