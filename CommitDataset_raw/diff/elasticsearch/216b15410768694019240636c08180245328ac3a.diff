[+++ b/server/src/main/java/org/elasticsearch/action/DocWriteResponse.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_SEQ_NO;, +            seqNo = UNASSIGNED_SEQ_NO;, +            primaryTerm = UNASSIGNED_PRIMARY_TERM;, +        protected Long seqNo = UNASSIGNED_SEQ_NO;, +        protected Long primaryTerm = UNASSIGNED_PRIMARY_TERM;, +++ b/server/src/main/java/org/elasticsearch/action/DocWriteResponse.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_SEQ_NO;, +            seqNo = UNASSIGNED_SEQ_NO;, +            primaryTerm = UNASSIGNED_PRIMARY_TERM;, +        protected Long seqNo = UNASSIGNED_SEQ_NO;, +        protected Long primaryTerm = UNASSIGNED_PRIMARY_TERM;, +++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +                long ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +++ b/server/src/main/java/org/elasticsearch/action/DocWriteResponse.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_SEQ_NO;, +            seqNo = UNASSIGNED_SEQ_NO;, +            primaryTerm = UNASSIGNED_PRIMARY_TERM;, +        protected Long seqNo = UNASSIGNED_SEQ_NO;, +        protected Long primaryTerm = UNASSIGNED_PRIMARY_TERM;, +++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +                long ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +++ b/server/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_SEQ_NO;, +    private long ifSeqNo = UNASSIGNED_SEQ_NO;, +    private long ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +        if (ifSeqNo != UNASSIGNED_SEQ_NO && (, +        if (ifPrimaryTerm == UNASSIGNED_PRIMARY_TERM && ifSeqNo != UNASSIGNED_SEQ_NO) {, +        if (ifPrimaryTerm != UNASSIGNED_PRIMARY_TERM && ifSeqNo == UNASSIGNED_SEQ_NO) {, +        if (seqNo < 0 && seqNo != UNASSIGNED_SEQ_NO) {, +            ifSeqNo = UNASSIGNED_SEQ_NO;, +            ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +        } else if (ifSeqNo != UNASSIGNED_SEQ_NO || ifPrimaryTerm != UNASSIGNED_PRIMARY_TERM) {, +++ b/server/src/main/java/org/elasticsearch/action/DocWriteResponse.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_SEQ_NO;, +            seqNo = UNASSIGNED_SEQ_NO;, +            primaryTerm = UNASSIGNED_PRIMARY_TERM;, +        protected Long seqNo = UNASSIGNED_SEQ_NO;, +        protected Long primaryTerm = UNASSIGNED_PRIMARY_TERM;, +++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +                long ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +++ b/server/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_SEQ_NO;, +    private long ifSeqNo = UNASSIGNED_SEQ_NO;, +    private long ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +        if (ifSeqNo != UNASSIGNED_SEQ_NO && (, +        if (ifPrimaryTerm == UNASSIGNED_PRIMARY_TERM && ifSeqNo != UNASSIGNED_SEQ_NO) {, +        if (ifPrimaryTerm != UNASSIGNED_PRIMARY_TERM && ifSeqNo == UNASSIGNED_SEQ_NO) {, +        if (seqNo < 0 && seqNo != UNASSIGNED_SEQ_NO) {, +            ifSeqNo = UNASSIGNED_SEQ_NO;, +            ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +        } else if (ifSeqNo != UNASSIGNED_SEQ_NO || ifPrimaryTerm != UNASSIGNED_PRIMARY_TERM) {, +++ b/server/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_SEQ_NO;, +    private long ifSeqNo = UNASSIGNED_SEQ_NO;, +    private long ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +            if (ifSeqNo != UNASSIGNED_SEQ_NO || ifPrimaryTerm != UNASSIGNED_PRIMARY_TERM) {, +        if (ifSeqNo != UNASSIGNED_SEQ_NO && (, +        if (ifPrimaryTerm == UNASSIGNED_PRIMARY_TERM && ifSeqNo != UNASSIGNED_SEQ_NO) {, +        if (ifPrimaryTerm != UNASSIGNED_PRIMARY_TERM && ifSeqNo == UNASSIGNED_SEQ_NO) {, +        if (seqNo < 0 && seqNo != UNASSIGNED_SEQ_NO) {, +            assert ifSeqNo == UNASSIGNED_SEQ_NO;, +            assert ifPrimaryTerm == UNASSIGNED_PRIMARY_TERM;, +            ifSeqNo = UNASSIGNED_SEQ_NO;, +            ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +        } else if (ifSeqNo != UNASSIGNED_SEQ_NO || ifPrimaryTerm != UNASSIGNED_PRIMARY_TERM) {, +++ b/server/src/main/java/org/elasticsearch/action/DocWriteResponse.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_SEQ_NO;, +            seqNo = UNASSIGNED_SEQ_NO;, +            primaryTerm = UNASSIGNED_PRIMARY_TERM;, +        protected Long seqNo = UNASSIGNED_SEQ_NO;, +        protected Long primaryTerm = UNASSIGNED_PRIMARY_TERM;, +++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +                long ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +++ b/server/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_SEQ_NO;, +    private long ifSeqNo = UNASSIGNED_SEQ_NO;, +    private long ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +        if (ifSeqNo != UNASSIGNED_SEQ_NO && (, +        if (ifPrimaryTerm == UNASSIGNED_PRIMARY_TERM && ifSeqNo != UNASSIGNED_SEQ_NO) {, +        if (ifPrimaryTerm != UNASSIGNED_PRIMARY_TERM && ifSeqNo == UNASSIGNED_SEQ_NO) {, +        if (seqNo < 0 && seqNo != UNASSIGNED_SEQ_NO) {, +            ifSeqNo = UNASSIGNED_SEQ_NO;, +            ifPrimaryTerm = UNASSIGNED_PRIMARY_TERM;, +        } else if (ifSeqNo != UNASSIGNED_SEQ_NO || ifPrimaryTerm != UNASSIGNED_PRIMARY_TERM) {, +++ b/server/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +import static org.elasticsearch.index.seqno.SequenceNumbers.UNASSIGNED_PRIMARY_TERM;]