[+++ b/src/test/java/org/elasticsearch/search/scan/SearchScanTests.java, +import org.elasticsearch.AbstractSharedClusterTest;, +import org.elasticsearch.action.index.IndexRequestBuilder;, +        client().admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards", between(1,5))).execute().actionGet();, +        IndexRequestBuilder[] builders = new IndexRequestBuilder[atLeast(50)];, +        for (int i = 0; i < builders.length/2; i++) {, +            builders[i] = client().prepareIndex("test", "tweet", Integer.toString(i)).setSource(, +                    jsonBuilder().startObject().field("user", "kimchy1").field("postDate", System.currentTimeMillis()).field("message", "test").endObject());, +        for (int i = builders.length/2; i < builders.length; i++) {, +            builders[i] = client().prepareIndex("test", "tweet", Integer.toString(i)).setSource(, +                    jsonBuilder().startObject().field("user", "kimchy2").field("postDate", System.currentTimeMillis()).field("message", "test").endObject());, +        indexRandom(true, builders);, +        assertThat(searchResponse.getHits().totalHits(), equalTo((long)builders.length/2));, +            assertThat(searchResponse.getHits().totalHits(), equalTo((long)builders.length/2));]