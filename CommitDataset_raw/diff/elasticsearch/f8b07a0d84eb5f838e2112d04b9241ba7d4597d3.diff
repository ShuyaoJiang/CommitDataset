[+++ b/server/src/test/java/org/elasticsearch/cluster/metadata/MetaDataMappingServiceTests.java, +, +import org.elasticsearch.cluster.ClusterStateTaskExecutor;, +import org.elasticsearch.index.Index;, +import static org.hamcrest.Matchers.not;, +        request.indices(new Index[] {indexService.index()});, +        request.source("{ \"properties\": { \"field\": { \"type\": \"text\" }}}");, +        final ClusterStateTaskExecutor.ClusterTasksResult<PutMappingClusterStateUpdateRequest> result =, +        // the task completed successfully, +        assertThat(result.executionResults.size(), equalTo(1));, +        assertTrue(result.executionResults.values().iterator().next().isSuccess());, +        // the task really was a mapping update, +        assertThat(, +                indexService.mapperService().documentMapper("type").mappingSource(),, +                not(equalTo(result.resultingState.metaData().index("test").mapping("type").source())));, +        // since we never committed the cluster state update, the in-memory state is unchanged, +]