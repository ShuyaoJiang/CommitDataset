[+++ b/plugins/river/couchdb/.gitignore, +/data, +++ b/plugins/river/couchdb/.gitignore, +/data, +++ b/plugins/river/couchdb/src/main/java/org/elasticsearch/river/couchdb/CouchdbRiver.java, + * @author dadoonet (David Pilato) for attachments filter, +    private final boolean couchIgnoreAttachements;, +            couchIgnoreAttachements = XContentMapValues.nodeBooleanValue(couchSettings.get("ignore_attachments"), false);, +            couchIgnoreAttachements = false;, +        	 if (logger.isTraceEnabled()) {, +        	 }, +            , +			// Remove _attachement from doc if needed, +            // TODO : check if couchDB support now attachment filter : https://issues.apache.org/jira/browse/COUCHDB-1263, +			if (couchIgnoreAttachements) {, +				if (doc.containsKey("_attachments")) {, +					Map<String, Object> _attachments = (Map<String, Object>) doc, +							.get("_attachments");, +					if (_attachments != null) {, +						doc.remove("_attachments");, +						if (logger.isTraceEnabled()) {, +							logger.trace("_attachments found and removed from doc");, +						}, +					}, +				}, +			}, +, +                // TODO : check if couchDB support now attachment filter : https://issues.apache.org/jira/browse/COUCHDB-1263, +                , +++ b/plugins/river/couchdb/.gitignore, +/data, +++ b/plugins/river/couchdb/src/main/java/org/elasticsearch/river/couchdb/CouchdbRiver.java, + * @author dadoonet (David Pilato) for attachments filter, +    private final boolean couchIgnoreAttachements;, +            couchIgnoreAttachements = XContentMapValues.nodeBooleanValue(couchSettings.get("ignore_attachments"), false);, +            couchIgnoreAttachements = false;, +        	 if (logger.isTraceEnabled()) {, +        	 }, +            , +			// Remove _attachement from doc if needed, +            // TODO : check if couchDB support now attachment filter : https://issues.apache.org/jira/browse/COUCHDB-1263, +			if (couchIgnoreAttachements) {, +				if (doc.containsKey("_attachments")) {, +					Map<String, Object> _attachments = (Map<String, Object>) doc, +							.get("_attachments");, +					if (_attachments != null) {, +						doc.remove("_attachments");, +						if (logger.isTraceEnabled()) {, +							logger.trace("_attachments found and removed from doc");, +						}, +					}, +				}, +			}, +, +                // TODO : check if couchDB support now attachment filter : https://issues.apache.org/jira/browse/COUCHDB-1263, +                , +++ b/plugins/river/couchdb/src/test/java/org/elasticsearch/river/couchdb/CouchdbRiverAttachementTest.java, +/*, + * Licensed to Elastic Search and Shay Banon under one, + * or more contributor license agreements.  See the NOTICE file, + * distributed with this work for additional information, + * regarding copyright ownership. Elastic Search licenses this, + * file to you under the Apache License, Version 2.0 (the, + * "License"); you may not use this file except in compliance, + * with the License.  You may obtain a copy of the License at, + *, + *    http://www.apache.org/licenses/LICENSE-2.0, + *, + * Unless required by applicable law or agreed to in writing,, + * software distributed under the License is distributed on an, + * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY, + * KIND, either express or implied.  See the License for the, + * specific language governing permissions and limitations, + * under the License., + */, +, +package org.elasticsearch.river.couchdb;, +, +import static org.elasticsearch.common.xcontent.XContentFactory.jsonBuilder;, +, +import org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;, +import org.elasticsearch.common.settings.ImmutableSettings;, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.indices.IndexMissingException;, +import org.elasticsearch.node.Node;, +import org.elasticsearch.node.NodeBuilder;, +, +/**, + * This is a simple test case for testing attachements removing.<br>, + * You may have a couchdb instance running on localhost:5984 with a mytest database.<br>, + * If you push documents with attachements in it, attachements should be ignored by the river., + * @author dadoonet (David Pilato), + */, +public class CouchdbRiverAttachementTest {, +, +    public static void main(String[] args) throws Exception {, +    	String host = "localhost";, +    	String port = "5984";, +    	String db = "mytest";, +    	boolean ignoreAttachements = true;]