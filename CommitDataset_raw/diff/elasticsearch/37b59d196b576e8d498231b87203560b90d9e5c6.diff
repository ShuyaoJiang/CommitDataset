[+++ b/src/main/java/org/elasticsearch/rest/action/cat/RestSegmentsAction.java, +import org.elasticsearch.action.admin.cluster.state.ClusterStateRequest;, +import org.elasticsearch.action.admin.cluster.state.ClusterStateResponse;, +import org.elasticsearch.cluster.node.DiscoveryNodes;, +import org.elasticsearch.rest.*;, +, +        final ClusterStateRequest clusterStateRequest = new ClusterStateRequest();, +        clusterStateRequest.local(request.paramAsBoolean("local", clusterStateRequest.local()));, +        clusterStateRequest.masterNodeTimeout(request.paramAsTime("master_timeout", clusterStateRequest.masterNodeTimeout()));, +        clusterStateRequest.clear().nodes(true).routingTable(true).indices(indices);, +, +        client.admin().cluster().state(clusterStateRequest, new AbstractRestResponseActionListener<ClusterStateResponse>(request, channel, logger) {, +            @Override, +            public void onResponse(final ClusterStateResponse clusterStateResponse) {, +                            Table tab = buildTable(request, clusterStateResponse, indicesSegments);, +, +            }, +, +            @Override, +            public void onFailure(Throwable e) {, +                try {, +                    channel.sendResponse(new XContentThrowableRestResponse(request, e));, +                } catch (IOException e1) {, +                    logger.error("Failed to send failure response", e1);, +                }, +            }, +        });, +        table.addCell("prirep", "alias:p,pr,primaryOrReplica;default:true;desc:primary or replica");, +        table.addCell("ip", "default:true;desc:ip of node where it lives");, +    private Table buildTable(final RestRequest request, ClusterStateResponse state, Map<String, IndexSegments> indicesSegments) {, +        DiscoveryNodes nodes = state.getState().nodes();, +, +                        table.addCell(shardSegment.getShardRouting().primary() ? "p" : "r");, +                        table.addCell(nodes.get(shardSegment.getShardRouting().currentNodeId()).getHostAddress());]