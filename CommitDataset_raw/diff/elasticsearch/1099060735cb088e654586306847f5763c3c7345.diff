[+++ b/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java, +import org.apache.http.util.EntityUtils;, +                adminClient().performRequest(new Request("DELETE", "*"));, +            if (hasXPack()) {, +                /*, +                 * Delete only templates that xpack doesn't automatically, +                 * recreate. Deleting them doesn't hurt anything, but it, +                 * slows down the test because xpack will just recreate, +                 * them., +                 */, +                Request request = new Request("GET", "_cat/templates");, +                request.addParameter("h", "name");, +                String templates = EntityUtils.toString(adminClient().performRequest(request).getEntity());, +                if (false == "".equals(templates)) {, +                    for (String template : templates.split("\n")) {, +                        if (isXPackTemplate(template)) continue;, +                        if ("".equals(template)) {, +                            throw new IllegalStateException("empty template in templates list:\n" + templates);, +                        }, +                        logger.debug("Clearing template [{}]", template);, +                        adminClient().performRequest(new Request("DELETE", "_template/" + template));, +                    }, +                }, +            } else {, +                logger.debug("Clearing all templates");, +                adminClient().performRequest(new Request("DELETE", "_template/*"));, +            }, +, +    /**, +     * Is this template one that is automatically created by xpack?, +     */, +    private static boolean isXPackTemplate(String name) {, +        if (name.startsWith(".monitoring-")) {, +            return true;, +        }, +        if (name.startsWith(".watch-history-")) {, +            return true;, +        }, +        if (name.startsWith(".ml-")) {, +            return true;, +        }, +        switch (name) {, +        case ".triggered_watches":, +        case ".watches":, +        case "logstash-index-template":, +        case "security_audit_log":, +            return true;, +        default:, +            return false;, +        }, +    }, +]