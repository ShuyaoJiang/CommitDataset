[+++ b/src/main/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineService.java, +                return NativeMap.wrap(scope, (Map) javaObject);, +                return NativeList.wrap(scope, (List) javaObject, staticType);, +++ b/src/main/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineService.java, +                return NativeMap.wrap(scope, (Map) javaObject);, +                return NativeList.wrap(scope, (List) javaObject, staticType);, +++ b/src/main/java/org/elasticsearch/script/javascript/support/NativeList.java, +import org.mozilla.javascript.NativeJavaObject;, +import java.util.Arrays;, +public class NativeList extends NativeJavaObject implements Scriptable, Wrapper {, +    private static final String LENGTH_PROPERTY = "length";, +    private final List<Object> list;, +    public static NativeList wrap(Scriptable scope, List<Object> list, Class<?> staticType) {, +        return new NativeList(scope, list, staticType);, +    private NativeList(Scriptable scope, List<Object> list, Class<?> staticType) {, +        super(scope, list, staticType);, +        if (LENGTH_PROPERTY.equals(name)) {, +            return super.get(name, start);, +        if (has(index, start) == false) {, +        return super.has(name, start) || LENGTH_PROPERTY.equals(name);, +        final Object[] javaObjectIds = super.getIds();, +        final int size = list.size();, +        final Object[] ids = Arrays.copyOf(javaObjectIds, javaObjectIds.length + size);, +            ids[javaObjectIds.length + i] = i;, +++ b/src/main/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineService.java, +                return NativeMap.wrap(scope, (Map) javaObject);, +                return NativeList.wrap(scope, (List) javaObject, staticType);, +++ b/src/main/java/org/elasticsearch/script/javascript/support/NativeList.java, +import org.mozilla.javascript.NativeJavaObject;, +import java.util.Arrays;, +public class NativeList extends NativeJavaObject implements Scriptable, Wrapper {, +    private static final String LENGTH_PROPERTY = "length";, +    private final List<Object> list;, +    public static NativeList wrap(Scriptable scope, List<Object> list, Class<?> staticType) {, +        return new NativeList(scope, list, staticType);, +    private NativeList(Scriptable scope, List<Object> list, Class<?> staticType) {, +        super(scope, list, staticType);, +        if (LENGTH_PROPERTY.equals(name)) {, +            return super.get(name, start);, +        if (has(index, start) == false) {, +        return super.has(name, start) || LENGTH_PROPERTY.equals(name);, +        final Object[] javaObjectIds = super.getIds();, +        final int size = list.size();, +        final Object[] ids = Arrays.copyOf(javaObjectIds, javaObjectIds.length + size);, +            ids[javaObjectIds.length + i] = i;, +++ b/src/main/java/org/elasticsearch/script/javascript/support/NativeMap.java, +    private NativeMap(Scriptable scope, Map<Object, Object> map) {, +++ b/src/main/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineService.java, +                return NativeMap.wrap(scope, (Map) javaObject);, +                return NativeList.wrap(scope, (List) javaObject, staticType);, +++ b/src/main/java/org/elasticsearch/script/javascript/support/NativeList.java, +import org.mozilla.javascript.NativeJavaObject;, +import java.util.Arrays;, +public class NativeList extends NativeJavaObject implements Scriptable, Wrapper {, +    private static final String LENGTH_PROPERTY = "length";, +    private final List<Object> list;, +    public static NativeList wrap(Scriptable scope, List<Object> list, Class<?> staticType) {, +        return new NativeList(scope, list, staticType);, +    private NativeList(Scriptable scope, List<Object> list, Class<?> staticType) {, +        super(scope, list, staticType);, +        if (LENGTH_PROPERTY.equals(name)) {, +            return super.get(name, start);, +        if (has(index, start) == false) {, +        return super.has(name, start) || LENGTH_PROPERTY.equals(name);, +        final Object[] javaObjectIds = super.getIds();, +        final int size = list.size();, +        final Object[] ids = Arrays.copyOf(javaObjectIds, javaObjectIds.length + size);, +            ids[javaObjectIds.length + i] = i;, +++ b/src/main/java/org/elasticsearch/script/javascript/support/NativeMap.java, +    private NativeMap(Scriptable scope, Map<Object, Object> map) {, +++ b/src/main/java/org/elasticsearch/script/javascript/support/ScriptValueConverter.java, +            value = NativeMap.wrap(scope, (Map) value);, +++ b/src/main/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineService.java, +                return NativeMap.wrap(scope, (Map) javaObject);, +                return NativeList.wrap(scope, (List) javaObject, staticType);, +++ b/src/main/java/org/elasticsearch/script/javascript/support/NativeList.java, +import org.mozilla.javascript.NativeJavaObject;, +import java.util.Arrays;, +public class NativeList extends NativeJavaObject implements Scriptable, Wrapper {, +    private static final String LENGTH_PROPERTY = "length";, +    private final List<Object> list;, +    public static NativeList wrap(Scriptable scope, List<Object> list, Class<?> staticType) {, +        return new NativeList(scope, list, staticType);, +    private NativeList(Scriptable scope, List<Object> list, Class<?> staticType) {, +        super(scope, list, staticType);, +        if (LENGTH_PROPERTY.equals(name)) {, +            return super.get(name, start);, +        if (has(index, start) == false) {, +        return super.has(name, start) || LENGTH_PROPERTY.equals(name);, +        final Object[] javaObjectIds = super.getIds();, +        final int size = list.size();, +        final Object[] ids = Arrays.copyOf(javaObjectIds, javaObjectIds.length + size);, +            ids[javaObjectIds.length + i] = i;, +++ b/src/main/java/org/elasticsearch/script/javascript/support/NativeMap.java, +    private NativeMap(Scriptable scope, Map<Object, Object> map) {, +++ b/src/main/java/org/elasticsearch/script/javascript/support/ScriptValueConverter.java, +            value = NativeMap.wrap(scope, (Map) value);, +++ b/src/test/java/org/elasticsearch/script/javascript/JavaScriptScriptSearchTests.java, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertHitCount;, +]