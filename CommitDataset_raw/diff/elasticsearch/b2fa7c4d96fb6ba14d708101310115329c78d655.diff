[+++ b/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/PrecisionAtN.java, +        Collection<RatedDocumentKey> unknownDocIds = new ArrayList<>();, +++ b/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/PrecisionAtN.java, +        Collection<RatedDocumentKey> unknownDocIds = new ArrayList<>();, +++ b/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/ReciprocalRank.java, +        Set<RatedDocumentKey> relevantDocIds = new HashSet<>();, +        Set<RatedDocumentKey> irrelevantDocIds = new HashSet<>();, +                relevantDocIds.add(doc.getKey());, +                irrelevantDocIds.add(doc.getKey());, +        Collection<RatedDocumentKey> unknownDocIds = new ArrayList<>();, +            RatedDocumentKey id = new RatedDocumentKey(hits[i].getIndex(), hits[i].getType(), hits[i].getId());, +++ b/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/PrecisionAtN.java, +        Collection<RatedDocumentKey> unknownDocIds = new ArrayList<>();, +++ b/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/ReciprocalRank.java, +        Set<RatedDocumentKey> relevantDocIds = new HashSet<>();, +        Set<RatedDocumentKey> irrelevantDocIds = new HashSet<>();, +                relevantDocIds.add(doc.getKey());, +                irrelevantDocIds.add(doc.getKey());, +        Collection<RatedDocumentKey> unknownDocIds = new ArrayList<>();, +            RatedDocumentKey id = new RatedDocumentKey(hits[i].getIndex(), hits[i].getType(), hits[i].getId());, +++ b/modules/rank-eval/src/test/java/org/elasticsearch/index/rankeval/ReciprocalRankTests.java, +import org.elasticsearch.index.Index;, +import org.elasticsearch.search.SearchShardTarget;, +        InternalSearchHit[] hits = new InternalSearchHit[10];, +            hits[i].shard(new SearchShardTarget("testnode", new Index("test", "uuid"), 0));, +                ratedDocs.add(new RatedDocument(, +                        new RatedDocumentKey("test", "type", Integer.toString(i)),, +                        Rating.RELEVANT.ordinal()));, +                ratedDocs.add(new RatedDocument(, +                        new RatedDocumentKey("test", "type", Integer.toString(i)),, +                        Rating.IRRELEVANT.ordinal()));, +        InternalSearchHit[] hits = new InternalSearchHit[10];, +            hits[i].shard(new SearchShardTarget("testnode", new Index("test", "uuid"), 0));, +                ratedDocs.add(new RatedDocument(, +                        new RatedDocumentKey("test", "type", Integer.toString(i)),, +                        Rating.RELEVANT.ordinal()));, +                ratedDocs.add(new RatedDocument(, +                        new RatedDocumentKey("test", "type", Integer.toString(i)),, +                        Rating.IRRELEVANT.ordinal()));, +        InternalSearchHit[] hits = new InternalSearchHit[10];, +            hits[i].shard(new SearchShardTarget("testnode", new Index("test", "uuid"), 0));, +++ b/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/PrecisionAtN.java, +        Collection<RatedDocumentKey> unknownDocIds = new ArrayList<>();, +++ b/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/ReciprocalRank.java, +        Set<RatedDocumentKey> relevantDocIds = new HashSet<>();, +        Set<RatedDocumentKey> irrelevantDocIds = new HashSet<>();, +                relevantDocIds.add(doc.getKey());, +                irrelevantDocIds.add(doc.getKey());, +        Collection<RatedDocumentKey> unknownDocIds = new ArrayList<>();, +            RatedDocumentKey id = new RatedDocumentKey(hits[i].getIndex(), hits[i].getType(), hits[i].getId());, +++ b/modules/rank-eval/src/test/java/org/elasticsearch/index/rankeval/ReciprocalRankTests.java, +import org.elasticsearch.index.Index;, +import org.elasticsearch.search.SearchShardTarget;, +        InternalSearchHit[] hits = new InternalSearchHit[10];, +            hits[i].shard(new SearchShardTarget("testnode", new Index("test", "uuid"), 0));, +                ratedDocs.add(new RatedDocument(, +                        new RatedDocumentKey("test", "type", Integer.toString(i)),, +                        Rating.RELEVANT.ordinal()));, +                ratedDocs.add(new RatedDocument(, +                        new RatedDocumentKey("test", "type", Integer.toString(i)),, +                        Rating.IRRELEVANT.ordinal()));, +        InternalSearchHit[] hits = new InternalSearchHit[10];, +            hits[i].shard(new SearchShardTarget("testnode", new Index("test", "uuid"), 0));, +                ratedDocs.add(new RatedDocument(, +                        new RatedDocumentKey("test", "type", Integer.toString(i)),, +                        Rating.RELEVANT.ordinal()));, +                ratedDocs.add(new RatedDocument(, +                        new RatedDocumentKey("test", "type", Integer.toString(i)),, +                        Rating.IRRELEVANT.ordinal()));, +        InternalSearchHit[] hits = new InternalSearchHit[10];, +            hits[i].shard(new SearchShardTarget("testnode", new Index("test", "uuid"), 0));, +++ b/modules/rank-eval/src/test/resources/rest-api-spec/test/rank_eval/10_basic.yaml, +                "ratings": [{"key": {"index": "foo", "type": "bar", "doc_id": "doc4"}, "rating": 1}], +                "ratings": [{"key": {"index": "foo", "type": "bar", "doc_id": "doc4"}, "rating": 1}], +              "ratings": [{"key": {"index": "foo", "type": "bar", "doc_id": "doc4"}, "rating": 1}], +              "ratings": [{"key": {"index": "foo", "type": "bar", "doc_id": "doc4"}, "rating": 1}]]