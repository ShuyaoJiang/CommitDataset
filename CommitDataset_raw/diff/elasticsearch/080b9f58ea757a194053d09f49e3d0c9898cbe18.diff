[+++ b/server/src/test/java/org/elasticsearch/search/profile/query/QueryProfilerIT.java, +import java.util.HashSet;, +import java.util.Set;, +            assertThat(vanillaResponse.getFailedShards(), equalTo(0));, +            assertThat(profileResponse.getFailedShards(), equalTo(0));, +            assertThat(vanillaResponse.getSuccessfulShards(), equalTo(profileResponse.getSuccessfulShards()));, +, +            if (vanillaResponse.getHits().totalHits != profileResponse.getHits().totalHits) {, +                Set<SearchHit> vanillaSet = new HashSet<>(Arrays.asList(vanillaResponse.getHits().getHits()));, +                Set<SearchHit> profileSet = new HashSet<>(Arrays.asList(profileResponse.getHits().getHits()));, +                if (vanillaResponse.getHits().totalHits > profileResponse.getHits().totalHits) {, +                    vanillaSet.removeAll(profileSet);, +                    fail("Vanilla hits were larger than profile hits.  Non-overlapping elements were: ", +                        + vanillaSet.toString());, +                } else {, +                    profileSet.removeAll(vanillaSet);, +                    fail("Profile hits were larger than vanilla hits.  Non-overlapping elements were: ", +                        + profileSet.toString());, +                }, +            }]