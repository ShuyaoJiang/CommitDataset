[+++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/job/persistence/JobDataDeleter.java, +, +        // TODO: remove in 7.0, +        ActionListener<BulkResponse> docDeleteListener = ActionListener.wrap(, +                response -> {, +                    // if the doc delete worked then don't bother trying the old types, +                    if (response.hasFailures() == false) {, +                        listener.onResponse(response);, +                        return;, +                    }, +                        bulkRequestBuilder.execute(ActionListener.wrap(, +                                listener::onResponse,, +                                // ignore problems relating to single type indices - if we're running against a single type, +                                // index then it must be type doc, so just return the response from deleting that type, +                                e -> {, +                                    if (e instanceof IllegalArgumentException, +                                            && e.getMessage().contains("as the final mapping would have more than 1 type")) {, +                                        listener.onResponse(response);, +                                    }, +                                    listener.onFailure(e);, +                                }, +                        ));, +                    } catch (Exception e) {, +                        listener.onFailure(e);, +                    }, +                },, +                listener::onFailure, +        );, +, +        BulkRequestBuilder bulkRequestBuilder = client.prepareBulk();, +        for (ModelSnapshot modelSnapshot : modelSnapshots) {, +            for (String stateDocId : modelSnapshot.stateDocumentIds()) {, +                bulkRequestBuilder.add(client.prepareDelete(stateIndexName, ElasticsearchMappings.DOC_TYPE, stateDocId));, +            }, +, +            bulkRequestBuilder.add(client.prepareDelete(AnomalyDetectorsIndex.jobResultsAliasedName(modelSnapshot.getJobId()),, +                    ElasticsearchMappings.DOC_TYPE, ModelSnapshot.documentId(modelSnapshot)));, +        }, +, +        bulkRequestBuilder.setRefreshPolicy(WriteRequest.RefreshPolicy.IMMEDIATE);, +        try {, +            // TODO: change docDeleteListener to listener in 7.0, +            bulkRequestBuilder.execute(docDeleteListener);]