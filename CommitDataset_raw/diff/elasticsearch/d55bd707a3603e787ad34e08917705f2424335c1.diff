[+++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +        addRecovery(reinitializedShard);, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +        addRecovery(reinitializedShard);, +++ b/core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java, +            Settings.Builder settingsBuilder = Settings.builder(), +                .put(SETTING_NUMBER_OF_REPLICAS, randomInt(2));, +            if (randomBoolean()) {, +                settingsBuilder.put(IndexMetaData.SETTING_SHADOW_REPLICAS, true), +                    .put(IndexMetaData.SETTING_SHARED_FILESYSTEM, true);, +            }, +            CreateIndexRequest request = new CreateIndexRequest(name, settingsBuilder.build()).waitForActiveShards(ActiveShardCount.NONE);]