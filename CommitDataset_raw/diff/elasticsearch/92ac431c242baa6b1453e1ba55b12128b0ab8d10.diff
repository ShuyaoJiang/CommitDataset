[+++ b/server/src/main/java/org/elasticsearch/search/SearchModule.java, +    /**, +     * Constructs a new SearchModule object, +     *, +     * NOTE: This constructor should not be called in production unless an accurate {@link Settings} object is provided., +     *       When constructed, a static flag is set in Lucene {@link BooleanQuery#setMaxClauseCount} according to the settings., +     *, +     * @param settings Current settings, +     * @param transportClient Is this being constructed in the TransportClient or not, +     * @param plugins List of included {@link SearchPlugin} objects., +     */, +++ b/server/src/main/java/org/elasticsearch/search/SearchModule.java, +    /**, +     * Constructs a new SearchModule object, +     *, +     * NOTE: This constructor should not be called in production unless an accurate {@link Settings} object is provided., +     *       When constructed, a static flag is set in Lucene {@link BooleanQuery#setMaxClauseCount} according to the settings., +     *, +     * @param settings Current settings, +     * @param transportClient Is this being constructed in the TransportClient or not, +     * @param plugins List of included {@link SearchPlugin} objects., +     */, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/deprecation/DeprecationInfoAction.java, +import org.elasticsearch.common.xcontent.NamedXContentRegistry;, +import java.util.function.BiFunction;, +                                                          NamedXContentRegistry xContentRegistry,, +                                                          List<BiFunction<DatafeedConfig, NamedXContentRegistry, DeprecationIssue>>, +                                                              mlSettingsCheck) {, +                mlSettingsIssues.addAll(filterChecks(mlSettingsCheck, (c) -> c.apply(config, xContentRegistry)));, +++ b/server/src/main/java/org/elasticsearch/search/SearchModule.java, +    /**, +     * Constructs a new SearchModule object, +     *, +     * NOTE: This constructor should not be called in production unless an accurate {@link Settings} object is provided., +     *       When constructed, a static flag is set in Lucene {@link BooleanQuery#setMaxClauseCount} according to the settings., +     *, +     * @param settings Current settings, +     * @param transportClient Is this being constructed in the TransportClient or not, +     * @param plugins List of included {@link SearchPlugin} objects., +     */, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/deprecation/DeprecationInfoAction.java, +import org.elasticsearch.common.xcontent.NamedXContentRegistry;, +import java.util.function.BiFunction;, +                                                          NamedXContentRegistry xContentRegistry,, +                                                          List<BiFunction<DatafeedConfig, NamedXContentRegistry, DeprecationIssue>>, +                                                              mlSettingsCheck) {, +                mlSettingsIssues.addAll(filterChecks(mlSettingsCheck, (c) -> c.apply(config, xContentRegistry)));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.common.xcontent.NamedXContentRegistry;, +        public Builder putDatafeed(DatafeedConfig datafeedConfig, Map<String, String> headers, NamedXContentRegistry xContentRegistry) {, +            DatafeedJobValidator.validate(datafeedConfig, job, xContentRegistry);, +++ b/server/src/main/java/org/elasticsearch/search/SearchModule.java, +    /**, +     * Constructs a new SearchModule object, +     *, +     * NOTE: This constructor should not be called in production unless an accurate {@link Settings} object is provided., +     *       When constructed, a static flag is set in Lucene {@link BooleanQuery#setMaxClauseCount} according to the settings., +     *, +     * @param settings Current settings, +     * @param transportClient Is this being constructed in the TransportClient or not, +     * @param plugins List of included {@link SearchPlugin} objects., +     */, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/deprecation/DeprecationInfoAction.java, +import org.elasticsearch.common.xcontent.NamedXContentRegistry;, +import java.util.function.BiFunction;, +                                                          NamedXContentRegistry xContentRegistry,, +                                                          List<BiFunction<DatafeedConfig, NamedXContentRegistry, DeprecationIssue>>, +                                                              mlSettingsCheck) {, +                mlSettingsIssues.addAll(filterChecks(mlSettingsCheck, (c) -> c.apply(config, xContentRegistry)));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.common.xcontent.NamedXContentRegistry;, +        public Builder putDatafeed(DatafeedConfig datafeedConfig, Map<String, String> headers, NamedXContentRegistry xContentRegistry) {, +            DatafeedJobValidator.validate(datafeedConfig, job, xContentRegistry);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/AggProvider.java, +/*, + * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one, + * or more contributor license agreements. Licensed under the Elastic License;, + * you may not use this file except in compliance with the Elastic License., + */, +package org.elasticsearch.xpack.core.ml.datafeed;, +, +import org.apache.logging.log4j.LogManager;, +import org.apache.logging.log4j.Logger;, +import org.elasticsearch.ElasticsearchException;, +import org.elasticsearch.Version;, +import org.elasticsearch.common.io.stream.StreamInput;, +import org.elasticsearch.common.io.stream.StreamOutput;, +import org.elasticsearch.common.io.stream.Writeable;, +import org.elasticsearch.common.xcontent.NamedXContentRegistry;, +import org.elasticsearch.common.xcontent.ToXContentObject;, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.common.xcontent.XContentParser;, +import org.elasticsearch.search.aggregations.AggregatorFactories;, +import org.elasticsearch.xpack.core.ml.job.messages.Messages;, +import org.elasticsearch.xpack.core.ml.utils.ExceptionsHelper;, +import org.elasticsearch.xpack.core.ml.utils.XContentObjectTransformer;, +, +import java.io.IOException;, +import java.util.Collections;, +import java.util.LinkedHashMap;]