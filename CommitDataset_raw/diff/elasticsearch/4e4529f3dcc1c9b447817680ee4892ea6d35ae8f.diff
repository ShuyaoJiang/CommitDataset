[+++ b/src/test/java/org/elasticsearch/test/integration/routing/AliasRoutingTests.java, +import org.elasticsearch.action.admin.indices.alias.IndicesAliasesResponse;, +, +        ensureGreen();, +        IndicesAliasesResponse res = run(admin().indices().prepareAliases().addAliasAction(newAddAliasAction("test", "alias0").routing("0")));, +        assertThat(res.isAcknowledged(), equalTo(true));, +        ensureGreen();, +        IndicesAliasesResponse res = run(admin().indices().prepareAliases(), +                .addAliasAction(newAddAliasAction("test", "alias01").searchRouting("0,1")));, +        assertThat(res.isAcknowledged(), equalTo(true));, +        ensureGreen();, +        IndicesAliasesResponse res = run(admin().indices().prepareAliases(), +                .addAliasAction(newAddAliasAction("test-b", "alias-ab").searchRouting("1")));, +        assertThat(res.isAcknowledged(), equalTo(true));, +        ensureGreen(); // wait for events again to make sure we got the aliases on all nodes, +        createIndex("index", "index_2");, +        ensureGreen();, +        IndicesAliasesResponse res = run(admin().indices().prepareAliases(), +                .addAliasAction(newAddAliasAction("index", "index_1").routing("1")));, +        assertThat(res.isAcknowledged(), equalTo(true));, +        run(prepareCreate("test").addMapping(, +                "type1",, +                XContentFactory.jsonBuilder().startObject().startObject("type1").startObject("_routing").field("required", true), +                        .endObject().endObject().endObject()));, +        ensureGreen();, +        createIndex("test");, +        ensureGreen();, +        IndicesAliasesResponse res = run(admin().indices().prepareAliases(), +                .addAliasAction(newAddAliasAction("test", "alias").routing("3")));, +        assertThat(res.isAcknowledged(), equalTo(true));, +        res = run(admin().indices().prepareAliases(), +                .addAliasAction(newAddAliasAction("test", "alias").routing("4")));, +        assertThat(res.isAcknowledged(), equalTo(true));]