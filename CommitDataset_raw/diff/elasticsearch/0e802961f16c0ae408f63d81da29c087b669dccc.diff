[+++ b/plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java, +                return new PrivilegedInstanceProfileCredentialsProvider();, +, +    static class PrivilegedInstanceProfileCredentialsProvider implements AWSCredentialsProvider {, +        private final InstanceProfileCredentialsProvider credentials;, +, +        private PrivilegedInstanceProfileCredentialsProvider() {, +            this.credentials = new InstanceProfileCredentialsProvider();, +        }, +, +        @Override, +        public AWSCredentials getCredentials() {, +            return SocketAccess.doPrivileged(credentials::getCredentials);, +        }, +, +        @Override, +        public void refresh() {, +            SocketAccess.doPrivilegedVoid(credentials::refresh);, +        }, +    }, +++ b/plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java, +                return new PrivilegedInstanceProfileCredentialsProvider();, +, +    static class PrivilegedInstanceProfileCredentialsProvider implements AWSCredentialsProvider {, +        private final InstanceProfileCredentialsProvider credentials;, +, +        private PrivilegedInstanceProfileCredentialsProvider() {, +            this.credentials = new InstanceProfileCredentialsProvider();, +        }, +, +        @Override, +        public AWSCredentials getCredentials() {, +            return SocketAccess.doPrivileged(credentials::getCredentials);, +        }, +, +        @Override, +        public void refresh() {, +            SocketAccess.doPrivilegedVoid(credentials::refresh);, +        }, +    }, +++ b/plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java, +        assertThat(credentialsProvider, instanceOf(InternalAwsS3Service.PrivilegedInstanceProfileCredentialsProvider.class));]