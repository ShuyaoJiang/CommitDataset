[+++ b/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +                    translog.markCommitted(translog.currentId());, +, +++ b/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +                    translog.markCommitted(translog.currentId());, +, +++ b/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java, +import org.apache.lucene.index.*;, +++ b/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +                    translog.markCommitted(translog.currentId());, +, +++ b/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java, +import org.apache.lucene.index.*;, +++ b/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java, +import org.elasticsearch.cluster.metadata.SnapshotMetaData.Entry;, +import org.elasticsearch.cluster.metadata.SnapshotMetaData.ShardSnapshotStatus;, +import static org.elasticsearch.cluster.metadata.IndexMetaData.SETTING_NUMBER_OF_REPLICAS;, +import static org.elasticsearch.cluster.metadata.IndexMetaData.SETTING_NUMBER_OF_SHARDS;, +import static org.elasticsearch.index.shard.IndexShard.INDEX_REFRESH_INTERVAL;, +        assertAllSuccessful(refresh());]