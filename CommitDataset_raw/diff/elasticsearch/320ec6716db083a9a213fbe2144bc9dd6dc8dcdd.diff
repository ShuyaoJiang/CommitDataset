[+++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/AuthorizationService.java, +import org.elasticsearch.action.delete.DeleteAction;, +import org.elasticsearch.action.index.IndexAction;, +    private static String IndexActionSubRequestPrimary = IndexAction.NAME + "[p]";, +    private static String IndexActionSubRequestReplica = IndexAction.NAME + "[r]";, +    private static String DeleteActionSubRequestPrimary = DeleteAction.NAME + "[p]";, +    private static String DeleteActionSubRequestReplica = DeleteAction.NAME + "[r]";, +, +                action.equals(IndexAction.NAME) ||, +                action.equals(DeleteAction.NAME) ||, +                action.equals(IndexActionSubRequestPrimary) ||, +                action.equals(IndexActionSubRequestReplica) ||, +                action.equals(DeleteActionSubRequestPrimary) ||, +                action.equals(DeleteActionSubRequestReplica) ||, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/AuthorizationService.java, +import org.elasticsearch.action.delete.DeleteAction;, +import org.elasticsearch.action.index.IndexAction;, +    private static String IndexActionSubRequestPrimary = IndexAction.NAME + "[p]";, +    private static String IndexActionSubRequestReplica = IndexAction.NAME + "[r]";, +    private static String DeleteActionSubRequestPrimary = DeleteAction.NAME + "[p]";, +    private static String DeleteActionSubRequestReplica = DeleteAction.NAME + "[r]";, +, +                action.equals(IndexAction.NAME) ||, +                action.equals(DeleteAction.NAME) ||, +                action.equals(IndexActionSubRequestPrimary) ||, +                action.equals(IndexActionSubRequestReplica) ||, +                action.equals(DeleteActionSubRequestPrimary) ||, +                action.equals(DeleteActionSubRequestReplica) ||, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/privilege/IndexPrivilege.java, +    private static final Automaton CREATE_AUTOMATON = patterns("indices:data/write/index*", "indices:data/write/bulk*",, +            PutMappingAction.NAME);, +            patterns("indices:data/write/index*", "indices:data/write/bulk*", "indices:data/write/update*", PutMappingAction.NAME);, +    private static final Automaton DELETE_AUTOMATON = patterns("indices:data/write/delete*", "indices:data/write/bulk*");, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/AuthorizationService.java, +import org.elasticsearch.action.delete.DeleteAction;, +import org.elasticsearch.action.index.IndexAction;, +    private static String IndexActionSubRequestPrimary = IndexAction.NAME + "[p]";, +    private static String IndexActionSubRequestReplica = IndexAction.NAME + "[r]";, +    private static String DeleteActionSubRequestPrimary = DeleteAction.NAME + "[p]";, +    private static String DeleteActionSubRequestReplica = DeleteAction.NAME + "[r]";, +, +                action.equals(IndexAction.NAME) ||, +                action.equals(DeleteAction.NAME) ||, +                action.equals(IndexActionSubRequestPrimary) ||, +                action.equals(IndexActionSubRequestReplica) ||, +                action.equals(DeleteActionSubRequestPrimary) ||, +                action.equals(DeleteActionSubRequestReplica) ||, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/privilege/IndexPrivilege.java, +    private static final Automaton CREATE_AUTOMATON = patterns("indices:data/write/index*", "indices:data/write/bulk*",, +            PutMappingAction.NAME);, +            patterns("indices:data/write/index*", "indices:data/write/bulk*", "indices:data/write/update*", PutMappingAction.NAME);, +    private static final Automaton DELETE_AUTOMATON = patterns("indices:data/write/delete*", "indices:data/write/bulk*");, +++ b/elasticsearch/src/test/java/org/elasticsearch/action/MockIndicesRequest.java, +public class MockIndicesRequest extends ActionRequest implements IndicesRequest, CompositeIndicesRequest {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/AuthorizationService.java, +import org.elasticsearch.action.delete.DeleteAction;, +import org.elasticsearch.action.index.IndexAction;, +    private static String IndexActionSubRequestPrimary = IndexAction.NAME + "[p]";, +    private static String IndexActionSubRequestReplica = IndexAction.NAME + "[r]";, +    private static String DeleteActionSubRequestPrimary = DeleteAction.NAME + "[p]";, +    private static String DeleteActionSubRequestReplica = DeleteAction.NAME + "[r]";, +, +                action.equals(IndexAction.NAME) ||, +                action.equals(DeleteAction.NAME) ||, +                action.equals(IndexActionSubRequestPrimary) ||, +                action.equals(IndexActionSubRequestReplica) ||, +                action.equals(DeleteActionSubRequestPrimary) ||, +                action.equals(DeleteActionSubRequestReplica) ||, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/privilege/IndexPrivilege.java, +    private static final Automaton CREATE_AUTOMATON = patterns("indices:data/write/index*", "indices:data/write/bulk*",, +            PutMappingAction.NAME);, +            patterns("indices:data/write/index*", "indices:data/write/bulk*", "indices:data/write/update*", PutMappingAction.NAME);, +    private static final Automaton DELETE_AUTOMATON = patterns("indices:data/write/delete*", "indices:data/write/bulk*");, +++ b/elasticsearch/src/test/java/org/elasticsearch/action/MockIndicesRequest.java, +public class MockIndicesRequest extends ActionRequest implements IndicesRequest, CompositeIndicesRequest {, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/security/authz/AuthorizationServiceTests.java, +        requests.add(new Tuple<>(BulkAction.NAME + "[s]", new DeleteRequest(SecurityTemplateService.SECURITY_INDEX_NAME, "type", "id")));, +        requests.add(new Tuple<>(BulkAction.NAME + "[s]", new IndexRequest(SecurityTemplateService.SECURITY_INDEX_NAME, "type", "id")));, +            requests.add(new Tuple<>(BulkAction.NAME + "[s]",, +                    new DeleteRequest(SecurityTemplateService.SECURITY_INDEX_NAME, "type", "id")));, +            requests.add(new Tuple<>(BulkAction.NAME + "[s]", new IndexRequest(SecurityTemplateService.SECURITY_INDEX_NAME, "type", "id")));, +        switch(randomIntBetween(0, 4)) {, +        logger.info("--> action: {}", action);, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/AuthorizationService.java, +import org.elasticsearch.action.delete.DeleteAction;, +import org.elasticsearch.action.index.IndexAction;, +    private static String IndexActionSubRequestPrimary = IndexAction.NAME + "[p]";, +    private static String IndexActionSubRequestReplica = IndexAction.NAME + "[r]";, +    private static String DeleteActionSubRequestPrimary = DeleteAction.NAME + "[p]";, +    private static String DeleteActionSubRequestReplica = DeleteAction.NAME + "[r]";, +, +                action.equals(IndexAction.NAME) ||, +                action.equals(DeleteAction.NAME) ||, +                action.equals(IndexActionSubRequestPrimary) ||, +                action.equals(IndexActionSubRequestReplica) ||, +                action.equals(DeleteActionSubRequestPrimary) ||, +                action.equals(DeleteActionSubRequestReplica) ||, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/privilege/IndexPrivilege.java, +    private static final Automaton CREATE_AUTOMATON = patterns("indices:data/write/index*", "indices:data/write/bulk*",, +            PutMappingAction.NAME);]