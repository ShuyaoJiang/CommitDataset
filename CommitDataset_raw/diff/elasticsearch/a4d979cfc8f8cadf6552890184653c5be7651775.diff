[+++ b/server/src/main/java/org/elasticsearch/script/ScoreScript.java, +import java.util.Collections;, +import java.util.HashMap;, +    private static final Map<String, String> DEPRECATIONS;, +    static {, +        Map<String, String> deprecations = new HashMap<>();, +        deprecations.put(, +            "doc",, +            "Accessing variable [doc] via [params.doc] from within a score script " +, +                "is deprecated in favor of directly accessing [doc].", +        );, +        deprecations.put(, +            "_doc",, +            "Accessing variable [doc] via [params._doc] from within a score script " +, +                "is deprecated in favor of directly accessing [doc].", +        );, +        DEPRECATIONS = Collections.unmodifiableMap(deprecations);, +    }, +, +        if (lookup == null) {, +            assert params == null;, +            assert leafContext == null;, +            this.params = null;, +            this.leafLookup = null;, +        } else {, +            this.leafLookup = lookup.getLeafSearchLookup(leafContext);, +            params = new HashMap<>(params);, +            params.putAll(leafLookup.asMap());, +            this.params = new ParameterMap(params, DEPRECATIONS);, +        }]