[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            // System assertions (-esa) are disabled for now because of what looks like a, +            // JDK bug triggered by Groovy on JDK7. We should look at re-enabling system, +            // assertions when we upgrade to a new version of Groovy (currently 2.4.4) or, +            // require JDK8. See https://issues.apache.org/jira/browse/GROOVY-7528., +            enableSystemAssertions false, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            // System assertions (-esa) are disabled for now because of what looks like a, +            // JDK bug triggered by Groovy on JDK7. We should look at re-enabling system, +            // assertions when we upgrade to a new version of Groovy (currently 2.4.4) or, +            // require JDK8. See https://issues.apache.org/jira/browse/GROOVY-7528., +            enableSystemAssertions false, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-ea" +, +        " " + "-Xms" + System.getProperty('tests.heap.size', '512m') +, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            // System assertions (-esa) are disabled for now because of what looks like a, +            // JDK bug triggered by Groovy on JDK7. We should look at re-enabling system, +            // assertions when we upgrade to a new version of Groovy (currently 2.4.4) or, +            // require JDK8. See https://issues.apache.org/jira/browse/GROOVY-7528., +            enableSystemAssertions false, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-ea" +, +        " " + "-Xms" + System.getProperty('tests.heap.size', '512m') +, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/NodeInfo.groovy, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            // System assertions (-esa) are disabled for now because of what looks like a, +            // JDK bug triggered by Groovy on JDK7. We should look at re-enabling system, +            // assertions when we upgrade to a new version of Groovy (currently 2.4.4) or, +            // require JDK8. See https://issues.apache.org/jira/browse/GROOVY-7528., +            enableSystemAssertions false, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-ea" +, +        " " + "-Xms" + System.getProperty('tests.heap.size', '512m') +, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/NodeInfo.groovy, +++ b/core/src/main/java/org/elasticsearch/transport/TcpTransport.java, +    public final NodeChannels openConnection(DiscoveryNode node, ConnectionProfile connectionProfile) throws IOException {, +            NodeChannels nodeChannels = connectToChannels(node, connectionProfile);, +            final Channel channel = nodeChannels.getChannels().get(0); // one channel is guaranteed by the connection profile, +            final TimeValue connectTimeout = connectionProfile.getConnectTimeout() == null ?, +                defaultConnectionProfile.getConnectTimeout() :, +                connectionProfile.getConnectTimeout();, +            final TimeValue handshakeTimeout = connectionProfile.getHandshakeTimeout() == null ?, +                connectTimeout : connectionProfile.getHandshakeTimeout();, +            final Version version = executeHandshake(node, channel, handshakeTimeout);, +            return new NodeChannels(nodeChannels, version); // clone the channels - we now have the correct version, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            // System assertions (-esa) are disabled for now because of what looks like a, +            // JDK bug triggered by Groovy on JDK7. We should look at re-enabling system, +            // assertions when we upgrade to a new version of Groovy (currently 2.4.4) or, +            // require JDK8. See https://issues.apache.org/jira/browse/GROOVY-7528., +            enableSystemAssertions false, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-ea" +, +        " " + "-Xms" + System.getProperty('tests.heap.size', '512m') +, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/NodeInfo.groovy, +++ b/core/src/main/java/org/elasticsearch/transport/TcpTransport.java, +    public final NodeChannels openConnection(DiscoveryNode node, ConnectionProfile connectionProfile) throws IOException {, +            NodeChannels nodeChannels = connectToChannels(node, connectionProfile);, +            final Channel channel = nodeChannels.getChannels().get(0); // one channel is guaranteed by the connection profile, +            final TimeValue connectTimeout = connectionProfile.getConnectTimeout() == null ?, +                defaultConnectionProfile.getConnectTimeout() :, +                connectionProfile.getConnectTimeout();, +            final TimeValue handshakeTimeout = connectionProfile.getHandshakeTimeout() == null ?, +                connectTimeout : connectionProfile.getHandshakeTimeout();, +            final Version version = executeHandshake(node, channel, handshakeTimeout);, +            return new NodeChannels(nodeChannels, version); // clone the channels - we now have the correct version, +++ b/test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java, +        public Version getVersion() {, +            return connection.getVersion();, +        }, +, +        @Override, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            // System assertions (-esa) are disabled for now because of what looks like a, +            // JDK bug triggered by Groovy on JDK7. We should look at re-enabling system, +            // assertions when we upgrade to a new version of Groovy (currently 2.4.4) or, +            // require JDK8. See https://issues.apache.org/jira/browse/GROOVY-7528., +            enableSystemAssertions false, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-ea" +, +        " " + "-Xms" + System.getProperty('tests.heap.size', '512m') +, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/NodeInfo.groovy, +++ b/core/src/main/java/org/elasticsearch/transport/TcpTransport.java, +    public final NodeChannels openConnection(DiscoveryNode node, ConnectionProfile connectionProfile) throws IOException {, +            NodeChannels nodeChannels = connectToChannels(node, connectionProfile);, +            final Channel channel = nodeChannels.getChannels().get(0); // one channel is guaranteed by the connection profile, +            final TimeValue connectTimeout = connectionProfile.getConnectTimeout() == null ?, +                defaultConnectionProfile.getConnectTimeout() :, +                connectionProfile.getConnectTimeout();, +            final TimeValue handshakeTimeout = connectionProfile.getHandshakeTimeout() == null ?, +                connectTimeout : connectionProfile.getHandshakeTimeout();, +            final Version version = executeHandshake(node, channel, handshakeTimeout);, +            return new NodeChannels(nodeChannels, version); // clone the channels - we now have the correct version, +++ b/test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java]