[+++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java, +++ b/core/src/main/java/org/elasticsearch/search/internal/ContextIndexSearcher.java, +        final boolean timeoutSet = searchContext.timeoutInMillis() != SearchService.NO_TIMEOUT.millis();, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java, +++ b/core/src/main/java/org/elasticsearch/search/internal/ContextIndexSearcher.java, +        final boolean timeoutSet = searchContext.timeoutInMillis() != SearchService.NO_TIMEOUT.millis();, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/bucket/TopHitsTests.java]