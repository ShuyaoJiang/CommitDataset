[+++ b/core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java, +        final Thread[] writers = new Thread[randomIntBetween(1, 3)];, +        final Thread[] readers = new Thread[randomIntBetween(1, 3)];, +        final int maxOps = randomIntBetween(200, 1000);, +        final Object signalReaderSomeDataWasIndexed = new Object();, +                    while (run.get() && idGenerator.get() < maxOps) {, +                        if (id % flushEveryOps == 0) {, +                            translog.commit(translog.currentFileGeneration());, +                        }, +                        if (id % 7 == 0) {, +                            synchronized (signalReaderSomeDataWasIndexed) {, +                                signalReaderSomeDataWasIndexed.notifyAll();, +                            }, +                        }, +                    while (idGenerator.get() < maxOps) {, +                        synchronized (signalReaderSomeDataWasIndexed) {, +                            if (idGenerator.get() < maxOps){, +                                signalReaderSomeDataWasIndexed.wait();, +                            }, +                        }, +        logger.debug("--> waiting for readers to stop");, +        // force stopping, if all writers crashed, +        synchronized (signalReaderSomeDataWasIndexed) {, +            idGenerator.set(Long.MAX_VALUE);, +            signalReaderSomeDataWasIndexed.notifyAll();, +        }]