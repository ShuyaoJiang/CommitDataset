[+++ b/src/test/java/org/elasticsearch/cluster/UpdateSettingsValidationTests.java, +import java.util.List;, +, +        List<String> nodes = cluster().startNodesAsync(, +                settingsBuilder().put("node.data", false).build(),, +                settingsBuilder().put("node.master", false).build(),, +                settingsBuilder().put("node.master", false).build(), +        ).get();, +        String master = nodes.get(0);, +        String node_1 = nodes.get(1);, +        String node_2 = nodes.get(2);, +++ b/src/test/java/org/elasticsearch/cluster/UpdateSettingsValidationTests.java, +import java.util.List;, +, +        List<String> nodes = cluster().startNodesAsync(, +                settingsBuilder().put("node.data", false).build(),, +                settingsBuilder().put("node.master", false).build(),, +                settingsBuilder().put("node.master", false).build(), +        ).get();, +        String master = nodes.get(0);, +        String node_1 = nodes.get(1);, +        String node_2 = nodes.get(2);, +++ b/src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationTests.java, +import java.util.List;, +        cluster().startNodesAsync(2, ImmutableSettings.settingsBuilder().put(commonSettings).put("node.rack_id", "rack_1").build()).get();, +    public void testAwarenessZones() throws Exception {, +        logger.info("--> starting 4 nodes on different zones");, +        List<String> nodes = cluster().startNodesAsync(, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "a").build(),, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "b").build(),, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "b").build(),, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "a").build(), +        ).get();, +        String A_0 = nodes.get(0);, +        String B_0 = nodes.get(1);, +        String B_1 = nodes.get(2);, +        String A_1 = nodes.get(3);, +    public void testAwarenessZonesIncrementalNodes() throws Exception {, +        List<String> nodes = cluster().startNodesAsync(, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "a").build(),, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "b").build(), +        ).get();, +        String A_0 = nodes.get(0);, +        String B_0 = nodes.get(1);, +++ b/src/test/java/org/elasticsearch/cluster/UpdateSettingsValidationTests.java, +import java.util.List;, +, +        List<String> nodes = cluster().startNodesAsync(, +                settingsBuilder().put("node.data", false).build(),, +                settingsBuilder().put("node.master", false).build(),, +                settingsBuilder().put("node.master", false).build(), +        ).get();, +        String master = nodes.get(0);, +        String node_1 = nodes.get(1);, +        String node_2 = nodes.get(2);, +++ b/src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationTests.java, +import java.util.List;, +        cluster().startNodesAsync(2, ImmutableSettings.settingsBuilder().put(commonSettings).put("node.rack_id", "rack_1").build()).get();, +    public void testAwarenessZones() throws Exception {, +        logger.info("--> starting 4 nodes on different zones");, +        List<String> nodes = cluster().startNodesAsync(, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "a").build(),, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "b").build(),, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "b").build(),, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "a").build(), +        ).get();, +        String A_0 = nodes.get(0);, +        String B_0 = nodes.get(1);, +        String B_1 = nodes.get(2);, +        String A_1 = nodes.get(3);, +    public void testAwarenessZonesIncrementalNodes() throws Exception {, +        List<String> nodes = cluster().startNodesAsync(, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "a").build(),, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "b").build(), +        ).get();, +        String A_0 = nodes.get(0);, +        String B_0 = nodes.get(1);, +++ b/src/test/java/org/elasticsearch/cluster/allocation/ClusterRerouteTests.java, +import java.util.List;, +        List<String> nodesIds = cluster().startNodesAsync(2, commonSettings).get();, +        final String node_1 = nodesIds.get(0);, +        final String node_2 = nodesIds.get(1);, +++ b/src/test/java/org/elasticsearch/cluster/UpdateSettingsValidationTests.java, +import java.util.List;, +, +        List<String> nodes = cluster().startNodesAsync(, +                settingsBuilder().put("node.data", false).build(),, +                settingsBuilder().put("node.master", false).build(),, +                settingsBuilder().put("node.master", false).build(), +        ).get();, +        String master = nodes.get(0);, +        String node_1 = nodes.get(1);, +        String node_2 = nodes.get(2);, +++ b/src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationTests.java, +import java.util.List;, +        cluster().startNodesAsync(2, ImmutableSettings.settingsBuilder().put(commonSettings).put("node.rack_id", "rack_1").build()).get();, +    public void testAwarenessZones() throws Exception {, +        logger.info("--> starting 4 nodes on different zones");, +        List<String> nodes = cluster().startNodesAsync(, +                ImmutableSettings.settingsBuilder().put(commonSettings).put("node.zone", "a").build(),]