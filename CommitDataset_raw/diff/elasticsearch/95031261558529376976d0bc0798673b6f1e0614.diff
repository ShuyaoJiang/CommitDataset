[+++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/http/netty/NettyHttpChannel.java, +import org.elasticsearch.rest.support.RestUtils;, +        if (RestUtils.isBrowser(request.getHeader(HttpHeaders.Names.USER_AGENT))) {, +        String opaque = request.getHeader("X-Opaque-Id");, +        if (opaque != null) {, +            resp.addHeader("X-Opaque-Id", opaque);, +        }, +, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/http/netty/NettyHttpChannel.java, +import org.elasticsearch.rest.support.RestUtils;, +        if (RestUtils.isBrowser(request.getHeader(HttpHeaders.Names.USER_AGENT))) {, +        String opaque = request.getHeader("X-Opaque-Id");, +        if (opaque != null) {, +            resp.addHeader("X-Opaque-Id", opaque);, +        }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/rest/support/RestUtils.java, +import org.elasticsearch.common.Nullable;, +    public static boolean isBrowser(@Nullable String userAgent) {, +        if (userAgent == null) {, +            return false;, +        }, +        // chrome, safari, firefox, ie, +        if (userAgent.startsWith("Mozilla")) {, +            return true;, +        }, +        return false;, +    }, +, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/http/netty/NettyHttpChannel.java, +import org.elasticsearch.rest.support.RestUtils;, +        if (RestUtils.isBrowser(request.getHeader(HttpHeaders.Names.USER_AGENT))) {, +        String opaque = request.getHeader("X-Opaque-Id");, +        if (opaque != null) {, +            resp.addHeader("X-Opaque-Id", opaque);, +        }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/rest/support/RestUtils.java, +import org.elasticsearch.common.Nullable;, +    public static boolean isBrowser(@Nullable String userAgent) {, +        if (userAgent == null) {, +            return false;, +        }, +        // chrome, safari, firefox, ie, +        if (userAgent.startsWith("Mozilla")) {, +            return true;, +        }, +        return false;, +    }, +, +++ b/plugins/transport/wares/src/main/java/org/elasticsearch/wares/NodeServlet.java, +import org.elasticsearch.rest.support.RestUtils;, +            if (RestUtils.isBrowser(restRequest.header("User-Agent"))) {, +            }, +            String opaque = restRequest.header("X-Opaque-Id");, +            if (opaque != null) {, +                resp.addHeader("X-Opaque-Id", opaque);, +            }]