[+++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/ssl/SSLTrustRestrictionsTests.java, +import java.nio.file.AtomicMoveNotSupportedException;, +import static java.nio.file.StandardCopyOption.ATOMIC_MOVE;, +import static java.nio.file.StandardCopyOption.REPLACE_EXISTING;, +    private static Path restrictionsTmpPath;, +        restrictionsTmpPath = configPath.resolve("trust_restrictions.tmp");, +, +            Files.write(restrictionsTmpPath, Collections.singleton("trust.subject_name: \"" + trustedPattern + "\""));, +            try {, +                Files.move(restrictionsTmpPath, restrictionsPath, REPLACE_EXISTING, ATOMIC_MOVE);, +            } catch (final AtomicMoveNotSupportedException e) {, +                Files.move(restrictionsTmpPath, restrictionsPath, REPLACE_EXISTING);, +            }]