[+++ b/src/test/java/org/elasticsearch/mlt/MoreLikeThisActionTests.java, +import org.apache.lucene.util.ArrayUtil;, +import java.util.Comparator;, +                .setSize(texts.length), +        MoreLikeThisRequest mltRequest = moreLikeThisRequest("test").type("type1").searchSize(texts.length).id("0").minTermFreq(1).minDocFreq(1);, +, +        // we have to resort since the results might come from, +        // different shards and docIDs that are used for tie-breaking might not be the same on the shards, +        Comparator<SearchHit> cmp = new Comparator<SearchHit>() {, +, +            @Override, +            public int compare(SearchHit o1, SearchHit o2) {, +                if (Float.compare(o1.getScore(), o2.getScore()) == 0) {, +                    return o1.getId().compareTo(o2.getId());, +                }, +                return Float.compare(o1.getScore(), o2.getScore());, +            }, +        };, +        ArrayUtil.timSort(hitsDSL, cmp);, +        ArrayUtil.timSort(hitsAPI, cmp);]