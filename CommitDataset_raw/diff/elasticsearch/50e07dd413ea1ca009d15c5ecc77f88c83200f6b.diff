[+++ b/server/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java, +        MergePolicyConfig.INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING,, +++ b/server/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java, +        MergePolicyConfig.INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING,, +++ b/server/src/main/java/org/elasticsearch/common/settings/Setting.java, +        return doubleSetting(key, defaultValue, minValue, Double.POSITIVE_INFINITY, properties);, +    }, +, +    public static Setting<Double> doubleSetting(String key, double defaultValue, double minValue, double maxValue, Property... properties) {, +            if (d > maxValue) {, +                throw new IllegalArgumentException("Failed to parse value [" + s + "] for setting [" + key + "] must be <= " + maxValue);, +            }, +++ b/server/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java, +        MergePolicyConfig.INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING,, +++ b/server/src/main/java/org/elasticsearch/common/settings/Setting.java, +        return doubleSetting(key, defaultValue, minValue, Double.POSITIVE_INFINITY, properties);, +    }, +, +    public static Setting<Double> doubleSetting(String key, double defaultValue, double minValue, double maxValue, Property... properties) {, +            if (d > maxValue) {, +                throw new IllegalArgumentException("Failed to parse value [" + s + "] for setting [" + key + "] must be <= " + maxValue);, +            }, +++ b/server/src/main/java/org/elasticsearch/index/EsTieredMergePolicy.java, +, +    public void setDeletesPctAllowed(double deletesPctAllowed) {, +        regularMergePolicy.setDeletesPctAllowed(deletesPctAllowed);, +        forcedMergePolicy.setDeletesPctAllowed(deletesPctAllowed);, +    }, +, +    public double getDeletesPctAllowed() {, +        return regularMergePolicy.getDeletesPctAllowed();, +    }, +++ b/server/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java, +        MergePolicyConfig.INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING,, +++ b/server/src/main/java/org/elasticsearch/common/settings/Setting.java, +        return doubleSetting(key, defaultValue, minValue, Double.POSITIVE_INFINITY, properties);, +    }, +, +    public static Setting<Double> doubleSetting(String key, double defaultValue, double minValue, double maxValue, Property... properties) {, +            if (d > maxValue) {, +                throw new IllegalArgumentException("Failed to parse value [" + s + "] for setting [" + key + "] must be <= " + maxValue);, +            }, +++ b/server/src/main/java/org/elasticsearch/index/EsTieredMergePolicy.java, +, +    public void setDeletesPctAllowed(double deletesPctAllowed) {, +        regularMergePolicy.setDeletesPctAllowed(deletesPctAllowed);, +        forcedMergePolicy.setDeletesPctAllowed(deletesPctAllowed);, +    }, +, +    public double getDeletesPctAllowed() {, +        return regularMergePolicy.getDeletesPctAllowed();, +    }, +++ b/server/src/main/java/org/elasticsearch/index/IndexSettings.java, +        scopedSettings.addSettingsUpdateConsumer(MergePolicyConfig.INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING, mergePolicyConfig::setDeletesPctAllowed);, +++ b/server/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java, +        MergePolicyConfig.INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING,, +++ b/server/src/main/java/org/elasticsearch/common/settings/Setting.java, +        return doubleSetting(key, defaultValue, minValue, Double.POSITIVE_INFINITY, properties);, +    }, +, +    public static Setting<Double> doubleSetting(String key, double defaultValue, double minValue, double maxValue, Property... properties) {, +            if (d > maxValue) {, +                throw new IllegalArgumentException("Failed to parse value [" + s + "] for setting [" + key + "] must be <= " + maxValue);, +            }, +++ b/server/src/main/java/org/elasticsearch/index/EsTieredMergePolicy.java, +, +    public void setDeletesPctAllowed(double deletesPctAllowed) {, +        regularMergePolicy.setDeletesPctAllowed(deletesPctAllowed);, +        forcedMergePolicy.setDeletesPctAllowed(deletesPctAllowed);, +    }, +, +    public double getDeletesPctAllowed() {, +        return regularMergePolicy.getDeletesPctAllowed();, +    }, +++ b/server/src/main/java/org/elasticsearch/index/IndexSettings.java, +        scopedSettings.addSettingsUpdateConsumer(MergePolicyConfig.INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING, mergePolicyConfig::setDeletesPctAllowed);, +++ b/server/src/main/java/org/elasticsearch/index/MergePolicyConfig.java, + * <li><code>index.merge.policy.deletes_pct_allowed</code>:, + *     Controls the maximum percentage of deleted documents that is tolerated in, + *     the index. Lower values make the index more space efficient at the, + *     expense of increased CPU and I/O activity. Values must be between <code>20</code> and, + *     <code>50</code>. Default value is <code>33</code>., +    public static final double          DEFAULT_DELETES_PCT_ALLOWED         = 33.0d;, +    public static final Setting<Double> INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING =, +        Setting.doubleSetting("index.merge.policy.deletes_pct_allowed", DEFAULT_DELETES_PCT_ALLOWED, 20.0d, 50.0d,, +            Property.Dynamic, Property.IndexScope);, +        double deletesPctAllowed = indexSettings.getValue(INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING);, +        mergePolicy.setDeletesPctAllowed(deletesPctAllowed);, +            logger.trace("using [tiered] merge mergePolicy with expunge_deletes_allowed[{}], floor_segment[{}], max_merge_at_once[{}], max_merge_at_once_explicit[{}], max_merged_segment[{}], segments_per_tier[{}], deletes_pct_allowed[{}]",, +                forceMergeDeletesPctAllowed, floorSegment, maxMergeAtOnce, maxMergeAtOnceExplicit, maxMergedSegment, segmentsPerTier, deletesPctAllowed);, +    void setDeletesPctAllowed(Double deletesPctAllowed) {, +        mergePolicy.setDeletesPctAllowed(deletesPctAllowed);, +    }, +, +++ b/server/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java, +        MergePolicyConfig.INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING,, +++ b/server/src/main/java/org/elasticsearch/common/settings/Setting.java, +        return doubleSetting(key, defaultValue, minValue, Double.POSITIVE_INFINITY, properties);, +    }, +]