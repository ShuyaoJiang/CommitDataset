[+++ b/src/test/java/org/elasticsearch/watcher/license/LicenseIntegrationTests.java, +    @Override, +    protected boolean checkWatcherRunningOnlyOnce() {, +        return false;, +    }, +, +++ b/src/test/java/org/elasticsearch/watcher/license/LicenseIntegrationTests.java, +    @Override, +    protected boolean checkWatcherRunningOnlyOnce() {, +        return false;, +    }, +, +++ b/src/test/java/org/elasticsearch/watcher/test/AbstractWatcherIntegrationTests.java, +    protected boolean checkWatcherRunningOnlyOnce() {, +        return true;, +    }, +, +        if (checkWatcherRunningOnlyOnce()) {, +            ensureWatcherOnlyRunningOnce();, +        }, +    protected void ensureWatcherOnlyRunningOnce() {, +        int running = 0;, +        for (WatcherService watcherService : internalTestCluster().getInstances(WatcherService.class)) {, +            if (watcherService.state() == WatcherService.State.STARTED) {, +                running++;, +            }, +        }, +        assertThat("watcher should only run on the elected master node, but it is running on [" + running + "] nodes", running, equalTo(1));, +    }, +, +++ b/src/test/java/org/elasticsearch/watcher/license/LicenseIntegrationTests.java, +    @Override, +    protected boolean checkWatcherRunningOnlyOnce() {, +        return false;, +    }, +, +++ b/src/test/java/org/elasticsearch/watcher/test/AbstractWatcherIntegrationTests.java, +    protected boolean checkWatcherRunningOnlyOnce() {, +        return true;, +    }, +, +        if (checkWatcherRunningOnlyOnce()) {, +            ensureWatcherOnlyRunningOnce();, +        }, +    protected void ensureWatcherOnlyRunningOnce() {, +        int running = 0;, +        for (WatcherService watcherService : internalTestCluster().getInstances(WatcherService.class)) {, +            if (watcherService.state() == WatcherService.State.STARTED) {, +                running++;, +            }, +        }, +        assertThat("watcher should only run on the elected master node, but it is running on [" + running + "] nodes", running, equalTo(1));, +    }, +, +++ b/src/test/java/org/elasticsearch/watcher/test/integration/NoMasterNodeTests.java, +        ensureWatcherOnlyRunningOnce();]