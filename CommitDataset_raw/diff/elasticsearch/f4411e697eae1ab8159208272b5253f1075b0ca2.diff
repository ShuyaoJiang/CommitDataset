[+++ b/src/main/java/org/elasticsearch/http/HttpServer.java, +            // If it's not a dir, we send a 403, +            if (!file.isDirectory()) {, +            // We don't serve dir but if index.html exists in dir we should serve it, +            file = new File(file, "index.html");, +            if (!file.exists() || file.isHidden() || !file.isFile()) {, +                channel.sendResponse(new StringRestResponse(FORBIDDEN));, +                return;, +            }, +        }, +++ b/src/main/java/org/elasticsearch/http/HttpServer.java, +            // If it's not a dir, we send a 403, +            if (!file.isDirectory()) {, +            // We don't serve dir but if index.html exists in dir we should serve it, +            file = new File(file, "index.html");, +            if (!file.exists() || file.isHidden() || !file.isFile()) {, +                channel.sendResponse(new StringRestResponse(FORBIDDEN));, +                return;, +            }, +        }, +++ b/src/test/java/org/elasticsearch/plugin/SitePluginTests.java, +, +    /**, +     * Test direct access to an existing file (index.html), +     */, +    @Test, +    public void testAnyPage() throws Exception {, +        HttpClientResponse response = httpClient("test").request("/_plugin/dummy/index.html");, +        assertThat(response.errorCode(), equalTo(RestStatus.OK.getStatus()));, +        assertThat(response.response(), containsString("<title>Dummy Site Plugin</title>"));, +    }, +, +    /**, +     * Test case for #4845: https://github.com/elasticsearch/elasticsearch/issues/4845, +     * Serving _site plugins do not pick up on index.html for sub directories, +     */, +    @Test, +    public void testWelcomePageInSubDirs() throws Exception {, +        HttpClientResponse response = httpClient("test").request("/_plugin/subdir/dir/");, +        assertThat(response.errorCode(), equalTo(RestStatus.OK.getStatus()));, +        assertThat(response.response(), containsString("<title>Dummy Site Plugin (subdir)</title>"));, +, +        response = httpClient("test").request("/_plugin/subdir/dir_without_index/");, +        assertThat(response.errorCode(), equalTo(RestStatus.FORBIDDEN.getStatus()));, +, +        response = httpClient("test").request("/_plugin/subdir/dir_without_index/page.html");, +        assertThat(response.errorCode(), equalTo(RestStatus.OK.getStatus()));, +        assertThat(response.response(), containsString("<title>Dummy Site Plugin (page)</title>"));, +    }, +++ b/src/main/java/org/elasticsearch/http/HttpServer.java, +            // If it's not a dir, we send a 403, +            if (!file.isDirectory()) {, +            // We don't serve dir but if index.html exists in dir we should serve it, +            file = new File(file, "index.html");, +            if (!file.exists() || file.isHidden() || !file.isFile()) {, +                channel.sendResponse(new StringRestResponse(FORBIDDEN));, +                return;, +            }, +        }, +++ b/src/test/java/org/elasticsearch/plugin/SitePluginTests.java, +, +    /**, +     * Test direct access to an existing file (index.html), +     */, +    @Test, +    public void testAnyPage() throws Exception {, +        HttpClientResponse response = httpClient("test").request("/_plugin/dummy/index.html");, +        assertThat(response.errorCode(), equalTo(RestStatus.OK.getStatus()));, +        assertThat(response.response(), containsString("<title>Dummy Site Plugin</title>"));, +    }, +, +    /**, +     * Test case for #4845: https://github.com/elasticsearch/elasticsearch/issues/4845, +     * Serving _site plugins do not pick up on index.html for sub directories, +     */, +    @Test, +    public void testWelcomePageInSubDirs() throws Exception {, +        HttpClientResponse response = httpClient("test").request("/_plugin/subdir/dir/");, +        assertThat(response.errorCode(), equalTo(RestStatus.OK.getStatus()));, +        assertThat(response.response(), containsString("<title>Dummy Site Plugin (subdir)</title>"));, +, +        response = httpClient("test").request("/_plugin/subdir/dir_without_index/");, +        assertThat(response.errorCode(), equalTo(RestStatus.FORBIDDEN.getStatus()));, +, +        response = httpClient("test").request("/_plugin/subdir/dir_without_index/page.html");, +        assertThat(response.errorCode(), equalTo(RestStatus.OK.getStatus()));, +        assertThat(response.response(), containsString("<title>Dummy Site Plugin (page)</title>"));, +    }, +++ b/src/test/resources/org/elasticsearch/plugin/subdir/_site/dir/index.html, +<!DOCTYPE html>, +<html>, +<head>, +    <title>Dummy Site Plugin (subdir)</title>, +</head>, +<body>, +<p>Welcome to this dummy elasticsearch plugin</p>, +</body>, +</html>, +++ b/src/main/java/org/elasticsearch/http/HttpServer.java, +            // If it's not a dir, we send a 403]