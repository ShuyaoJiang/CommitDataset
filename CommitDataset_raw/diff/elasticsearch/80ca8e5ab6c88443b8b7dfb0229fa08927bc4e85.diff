[+++ b/docs/reference/cat/indices.asciidoc, +, +How much memory is used per index?, +, +[source,shell], +--------------------------------------------------, +% curl 'localhost:9200/_cat/indices?v&h=i,tm', +i     tm, +wiki  8.1gb, +test  30.5kb, +user  1.9mb, +--------------------------------------------------, +++ b/docs/reference/cat/indices.asciidoc, +, +How much memory is used per index?, +, +[source,shell], +--------------------------------------------------, +% curl 'localhost:9200/_cat/indices?v&h=i,tm', +i     tm, +wiki  8.1gb, +test  30.5kb, +user  1.9mb, +--------------------------------------------------, +++ b/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +import org.elasticsearch.common.unit.ByteSizeValue;, +    /**, +     * Utility method which computes total memory by adding, +     * FieldData, IdCache, Percolate, Segments (memory, index writer, version map), +     */, +    public ByteSizeValue getTotalMemory() {, +        long size = 0;, +        if (this.getFieldData() != null) {, +            size += this.getFieldData().getMemorySizeInBytes();, +        }, +        if (this.getFilterCache() != null) {, +            size += this.getFilterCache().getMemorySizeInBytes();, +        }, +        if (this.getIdCache() != null) {, +            size += this.getIdCache().getMemorySizeInBytes();, +        }, +        if (this.getPercolate() != null) {, +            size += this.getPercolate().getMemorySizeInBytes();, +        }, +        if (this.getSegments() != null) {, +            size += this.getSegments().getMemoryInBytes() +, +                    this.getSegments().getIndexWriterMemoryInBytes() +, +                    this.getSegments().getVersionMapMemoryInBytes();, +        }, +, +        return new ByteSizeValue(size);, +    }, +, +++ b/docs/reference/cat/indices.asciidoc, +, +How much memory is used per index?, +, +[source,shell], +--------------------------------------------------, +% curl 'localhost:9200/_cat/indices?v&h=i,tm', +i     tm, +wiki  8.1gb, +test  30.5kb, +user  1.9mb, +--------------------------------------------------, +++ b/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java, +import org.elasticsearch.common.unit.ByteSizeValue;, +    /**, +     * Utility method which computes total memory by adding, +     * FieldData, IdCache, Percolate, Segments (memory, index writer, version map), +     */, +    public ByteSizeValue getTotalMemory() {, +        long size = 0;, +        if (this.getFieldData() != null) {, +            size += this.getFieldData().getMemorySizeInBytes();, +        }, +        if (this.getFilterCache() != null) {, +            size += this.getFilterCache().getMemorySizeInBytes();, +        }, +        if (this.getIdCache() != null) {, +            size += this.getIdCache().getMemorySizeInBytes();, +        }, +        if (this.getPercolate() != null) {, +            size += this.getPercolate().getMemorySizeInBytes();, +        }, +        if (this.getSegments() != null) {, +            size += this.getSegments().getMemoryInBytes() +, +                    this.getSegments().getIndexWriterMemoryInBytes() +, +                    this.getSegments().getVersionMapMemoryInBytes();, +        }, +, +        return new ByteSizeValue(size);, +    }, +, +++ b/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java, +        table.addCell("memory.total", "sibling:pri;alias:tm,memoryTotal;default:false;text-align:right;desc:total used memory");, +        table.addCell("pri.memory.total", "default:false;text-align:right;desc:total user memory");, +            table.addCell(indexStats == null ? null : indexStats.getTotal().getTotalMemory());, +            table.addCell(indexStats == null ? null : indexStats.getPrimaries().getTotalMemory());, +]