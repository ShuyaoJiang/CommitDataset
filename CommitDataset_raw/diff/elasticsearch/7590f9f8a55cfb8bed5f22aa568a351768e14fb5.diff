[+++ b/src/main/java/org/elasticsearch/common/io/stream/CachedStreamInput.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/CachedStreamInput.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +import org.apache.lucene.util.ArrayUtil;, +import org.apache.lucene.util.RamUsageEstimator;, +import java.lang.ref.SoftReference;, +    private static final ThreadLocal<SoftReference<char[]>> charCache = new ThreadLocal<SoftReference<char[]>>();, +, +    private static char[] charCache(int size) {, +        SoftReference<char[]> ref = charCache.get();, +        char[] arr = (ref == null) ? null : ref.get();, +        if (arr == null || arr.length < size) {, +            arr = new char[ArrayUtil.oversize(size, RamUsageEstimator.NUM_BYTES_CHAR)];, +            charCache.set(new SoftReference<char[]>(arr));, +        }, +        return arr;, +    }, +, +        char[] chars = charCache(charCount);]