[+++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/server/src/main/java/org/elasticsearch/plugins/PluginsService.java, +    public PluginsService(, +        Settings settings,, +        Path configPath,, +        Path modulesDirectory,, +        Path pluginsDirectory,, +        Collection<Class<? extends Plugin>> classpathPlugins, +    ) {, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/server/src/main/java/org/elasticsearch/plugins/PluginsService.java, +    public PluginsService(, +        Settings settings,, +        Path configPath,, +        Path modulesDirectory,, +        Path pluginsDirectory,, +        Collection<Class<? extends Plugin>> classpathPlugins, +    ) {, +++ b/server/src/test/java/org/elasticsearch/plugins/PluginsServiceTests.java, +            return Settings.builder(), +                .put("foo.bar", "1"), +                .put(IndexModule.INDEX_STORE_TYPE_SETTING.getKey(), IndexModule.Type.MMAPFS.getSettingsKey()), +                .build();, +        return new PluginsService(, +            settings, null, null,, +            TestEnvironment.newEnvironment(settings).pluginsFile(), Arrays.asList(classpathPlugins), +        );, +        assertEquals(, +            IndexModule.Type.SIMPLEFS.getSettingsKey(),, +            newSettings.get(IndexModule.INDEX_STORE_TYPE_SETTING.getKey()), +        ); // does not override pre existing settings, +        final IllegalStateException e = expectThrows(, +            IllegalStateException.class,, +            () -> newPluginsService(settings, MultiplePublicConstructorsPlugin.class), +        );]