[+++ b/qa/shield-client-tests/build.gradle, +apply plugin: 'elasticsearch.rest-test', +, +dependencies {, +  testCompile project(path: ':x-plugins:shield', configuration: 'runtime'), +}, +, +integTest {, +  cluster {, +    plugin 'license', project(':x-plugins:license:plugin'), +    plugin 'shield', project(':x-plugins:shield'), +    setupCommand 'setupDummyUser',, +                 'bin/shield/esusers', 'useradd', 'test_user', '-p', 'changeme', '-r', 'admin', +    setupCommand 'setupTransportClientUser',, +                 'bin/shield/esusers', 'useradd', 'transport', '-p', 'changeme', '-r', 'transport_client', +    waitCondition = { node, ant ->, +      File tmpFile = new File(node.cwd, 'wait.success'), +      ant.get(src: "http://localhost:${node.httpPort()}",, +              dest: tmpFile.toString(),, +              username: 'test_user',, +              password: 'changeme',, +              ignoreerrors: true,, +              retries: 10), +      return tmpFile.exists(), +    }, +  }, +}, +, +++ b/qa/shield-client-tests/build.gradle, +apply plugin: 'elasticsearch.rest-test', +, +dependencies {, +  testCompile project(path: ':x-plugins:shield', configuration: 'runtime'), +}, +, +integTest {, +  cluster {, +    plugin 'license', project(':x-plugins:license:plugin'), +    plugin 'shield', project(':x-plugins:shield'), +    setupCommand 'setupDummyUser',, +                 'bin/shield/esusers', 'useradd', 'test_user', '-p', 'changeme', '-r', 'admin', +    setupCommand 'setupTransportClientUser',, +                 'bin/shield/esusers', 'useradd', 'transport', '-p', 'changeme', '-r', 'transport_client', +    waitCondition = { node, ant ->, +      File tmpFile = new File(node.cwd, 'wait.success'), +      ant.get(src: "http://localhost:${node.httpPort()}",, +              dest: tmpFile.toString(),, +              username: 'test_user',, +              password: 'changeme',, +              ignoreerrors: true,, +              retries: 10), +      return tmpFile.exists(), +    }, +  }, +}, +, +++ /dev/null, +++ b/qa/shield-client-tests/build.gradle, +apply plugin: 'elasticsearch.rest-test', +, +dependencies {, +  testCompile project(path: ':x-plugins:shield', configuration: 'runtime'), +}, +, +integTest {, +  cluster {, +    plugin 'license', project(':x-plugins:license:plugin'), +    plugin 'shield', project(':x-plugins:shield'), +    setupCommand 'setupDummyUser',, +                 'bin/shield/esusers', 'useradd', 'test_user', '-p', 'changeme', '-r', 'admin', +    setupCommand 'setupTransportClientUser',, +                 'bin/shield/esusers', 'useradd', 'transport', '-p', 'changeme', '-r', 'transport_client', +    waitCondition = { node, ant ->, +      File tmpFile = new File(node.cwd, 'wait.success'), +      ant.get(src: "http://localhost:${node.httpPort()}",, +              dest: tmpFile.toString(),, +              username: 'test_user',, +              password: 'changeme',, +              ignoreerrors: true,, +              retries: 10), +      return tmpFile.exists(), +    }, +  }, +}, +, +++ /dev/null, +++ b/qa/smoke-test-watcher-with-shield/build.gradle, +apply plugin: 'elasticsearch.rest-test', +, +dependencies {, +  testCompile project(path: ':x-plugins:shield', configuration: 'runtime'), +  testCompile project(path: ':x-plugins:watcher', configuration: 'runtime'), +}, +, +// bring in watcher rest test suite, +task copyWatcherRestTests(type: Copy) {, +  into project.sourceSets.test.output.resourcesDir, +  from project(':x-plugins:watcher').sourceSets.test.resources.srcDirs, +  include 'rest-api-spec/test/**', +}]