[+++ b/build.gradle, +import org.elasticsearch.gradle.BuildPlugin, +  plugins.withType(BuildPlugin).whenPluginAdded {, +    project.licenseFile = project.rootProject.file('LICENSE.txt'), +    project.noticeFile = project.rootProject.file('NOTICE.txt'), +  }, +++ b/build.gradle, +import org.elasticsearch.gradle.BuildPlugin, +  plugins.withType(BuildPlugin).whenPluginAdded {, +    project.licenseFile = project.rootProject.file('LICENSE.txt'), +    project.noticeFile = project.rootProject.file('NOTICE.txt'), +  }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +import org.gradle.api.file.CopySpec, +        project.ext.licenseFile = null, +        project.ext.noticeFile = null, +            // add license/notice files, +            project.afterEvaluate {, +                if (project.licenseFile == null || project.noticeFile == null) {, +                    throw new GradleException("Must specify license and notice file for project ${project.path}"), +                }, +                jarTask.into('META-INF') {, +                    from(project.licenseFile.parent) {, +                        include project.licenseFile.name, +                    }, +                    from(project.noticeFile.parent) {, +                        include project.noticeFile.name, +                    }, +                }, +            }]