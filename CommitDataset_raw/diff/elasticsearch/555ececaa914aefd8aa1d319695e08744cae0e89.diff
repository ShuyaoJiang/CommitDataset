[+++ b/dev-tools/build_release.py, +""" , + This tool builds a release from the a given elasticsearch branch., + In order to execute it go in the top level directory and run:, +   $ python3 dev_tools/build_release.py --branch 0.90 --publish --remote origin, +, + By default this script runs in 'dry' mode which essentially simulates a release. If the, + '--publish' option is set the actual release is done. The script takes over almost all, + steps necessary for a release from a high level point of view it does the following things:, +, +  - run prerequisit checks ie. check for Java 1.6 being presend or S3 credentials available as env variables, +  - detect the version to release from the specified branch (--branch) or the current branch, +  - creates a release branch & updates pom.xml and Version.java to point to a release version rather than a snapshot, +  - builds the artifacts and runs smoke-tests on the build zip & tar.gz files, +  - commits the new version and merges the release branch into the source branch, +  - creates a tag and pushes the commit to the specified origin (--remote), +  - publishes the releases to sonar-type and S3, +, +Once it's done it will print all the remaining steps., +, +""", +, +    run('%s; %s -Des.node.name=smoke_tester -Des.cluster.name=prepare_release -Des.discovery.zen.ping.multicast.enabled=false', +         % (java_exe(), es_run_path)), +, +  release_version = "090.7", +    print('  Running maven builds now and publish to sonartype- run-tests [%s]' % run_tests), +    build_release(run_tests=run_tests, dry_run=dry_run, cpus=cpus), +    pending_msg = """, +    Release successful pending steps: , +      * create a version tag on github for version 'v%(version)s', +      * check if there are pending issues for this version (https://github.com/elasticsearch/elasticsearch/issues?labels=v%(version)s&page=1&state=open), +      * publish the maven artifacts on sonartype: https://oss.sonatype.org/index.html, +         - here is a guide: https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide#SonatypeOSSMavenRepositoryUsageGuide-8a.ReleaseIt, +      * check if the release is there https://oss.sonatype.org/content/repositories/releases/org/elasticsearch/elasticsearch/%(version)s, +      * build and publish the RPMs, +      * announce the release on the website / blog post, +      * tweet about the release, +    """, +    print(pending_msg % { 'version' : release_version} )]