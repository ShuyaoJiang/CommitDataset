[+++ b/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramTests.java, +import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertAcked;, +        List<IndexRequestBuilder> builders = new ArrayList<>();, +        for (int i = 0; i < numDocs; i++) {, +            builders.add(client().prepareIndex("idx", "type").setSource(jsonBuilder(), +                    .endObject()));, +        }, +, +        assertAcked(prepareCreate("empty_bucket_idx").addMapping("type", SINGLE_VALUED_FIELD_NAME, "type=integer"));, +        for (int i = 0; i < 2; i++) {, +            builders.add(client().prepareIndex("empty_bucket_idx", "type", "" + i).setSource(jsonBuilder(), +                    .startObject(), +                    .field(SINGLE_VALUED_FIELD_NAME, i * 2), +                    .endObject()));]