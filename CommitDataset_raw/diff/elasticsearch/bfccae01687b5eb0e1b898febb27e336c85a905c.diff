[+++ b/server/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java, +        return new SecureString(Arrays.copyOfRange(charBuffer.array(), charBuffer.position(), charBuffer.limit()));, +++ b/server/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java, +        return new SecureString(Arrays.copyOfRange(charBuffer.array(), charBuffer.position(), charBuffer.limit()));, +++ b/server/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java, +import java.io.CharArrayWriter;, +    public void testAddUtf8String() throws Exception {, +        KeyStoreWrapper.create().save(env.configFile(), new char[0]);, +        final int stringSize = randomIntBetween(8, 16);, +        try (CharArrayWriter secretChars = new CharArrayWriter(stringSize)) {, +            for (int i = 0; i < stringSize; i++) {, +                secretChars.write((char) randomIntBetween(129, 2048));, +            }, +            setInput(secretChars.toString());, +            execute("-x", "foo");, +            assertSecureString("foo", secretChars.toString());, +        }, +    }, +]