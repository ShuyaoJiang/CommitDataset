[+++ b/src/main/java/org/elasticsearch/license/plugin/core/LicensesService.java, +import static org.elasticsearch.license.core.ESLicenses.FeatureType;, +import static org.elasticsearch.license.plugin.core.TrialLicenses.TrialLicense;, +        final Set<FeatureType> featuresToDelete = asFeatureTypes(request.features());, +    private void registerTrialLicense(final TrialLicense trialLicense) {, +                trialLicenses = currentLicenses.getTrialLicenses();, +        // generate one-time trial license, +        // registerTrialLicense(generateTrialLicense(feature, 30, 1000));, +, +        final TrialLicense trialLicense = trialLicenses.getTrialLicense(FeatureType.fromString(feature));, +        if (trialLicense != null) {, +            return trialLicense.expiryDate() > System.currentTimeMillis();, +        }, +        return esLicenseManager.hasLicenseForFeature(FeatureType.fromString(feature));, +    private static Set<FeatureType> asFeatureTypes(Set<String> featureTypeStrings) {, +        Set<FeatureType> featureTypes = new HashSet<>(featureTypeStrings.size());, +            featureTypes.add(FeatureType.fromString(featureString));, +    private TrialLicense generateTrialLicense(String feature, int durationInDays, int maxNodes) {, +                .feature(FeatureType.fromString(feature))]