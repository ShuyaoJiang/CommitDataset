[+++ b/core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java, +import org.elasticsearch.search.internal.InternalSearchHits.StreamContext.ShardTargetType;, +        readFrom(in, InternalSearchHits.streamContext().streamShardTarget(ShardTargetType.STREAM));, +        if (context.streamShardTarget() == ShardTargetType.STREAM) {, +        } else if (context.streamShardTarget() == ShardTargetType.LOOKUP) {, +                ShardTargetType shardTarget = InternalSearchHits.streamContext().streamShardTarget();, +                InternalSearchHits value = InternalSearchHits.readSearchHits(in, InternalSearchHits.streamContext().streamShardTarget(ShardTargetType.NO_STREAM));, +                InternalSearchHits.streamContext().streamShardTarget(shardTarget);, +        writeTo(out, InternalSearchHits.streamContext().streamShardTarget(ShardTargetType.STREAM));, +        if (context.streamShardTarget() == ShardTargetType.STREAM) {, +        } else if (context.streamShardTarget() == ShardTargetType.LOOKUP) {, +                ShardTargetType shardTarget = InternalSearchHits.streamContext().streamShardTarget();, +                entry.getValue().writeTo(out, InternalSearchHits.streamContext().streamShardTarget(ShardTargetType.NO_STREAM));, +                InternalSearchHits.streamContext().streamShardTarget(shardTarget);, +++ b/core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java, +import org.elasticsearch.search.internal.InternalSearchHits.StreamContext.ShardTargetType;, +        readFrom(in, InternalSearchHits.streamContext().streamShardTarget(ShardTargetType.STREAM));, +        if (context.streamShardTarget() == ShardTargetType.STREAM) {, +        } else if (context.streamShardTarget() == ShardTargetType.LOOKUP) {, +                ShardTargetType shardTarget = InternalSearchHits.streamContext().streamShardTarget();, +                InternalSearchHits value = InternalSearchHits.readSearchHits(in, InternalSearchHits.streamContext().streamShardTarget(ShardTargetType.NO_STREAM));, +                InternalSearchHits.streamContext().streamShardTarget(shardTarget);, +        writeTo(out, InternalSearchHits.streamContext().streamShardTarget(ShardTargetType.STREAM));, +        if (context.streamShardTarget() == ShardTargetType.STREAM) {, +        } else if (context.streamShardTarget() == ShardTargetType.LOOKUP) {, +                ShardTargetType shardTarget = InternalSearchHits.streamContext().streamShardTarget();, +                entry.getValue().writeTo(out, InternalSearchHits.streamContext().streamShardTarget(ShardTargetType.NO_STREAM));, +                InternalSearchHits.streamContext().streamShardTarget(shardTarget);, +++ b/core/src/test/java/org/elasticsearch/search/innerhits/InnerHitsIT.java, +            assertThat(response.getHits().getAt(0).getShard(), notNullValue());, +            assertThat(searchHit.getShard(), notNullValue());, +            assertThat(response.getHits().getAt(0).getShard(), notNullValue());, +            assertThat(searchHit.getShard(), notNullValue());]