[+++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/AppendProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/AppendProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/FailProcessorFactoryTests.java, +        config.put("message", "{{error}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/AppendProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/FailProcessorFactoryTests.java, +        config.put("message", "{{error}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/RemoveProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/AppendProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/FailProcessorFactoryTests.java, +        config.put("message", "{{error}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/RemoveProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SetProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/AppendProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/FailProcessorFactoryTests.java, +        config.put("message", "{{error}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/RemoveProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SetProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/server/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java, +            if (scriptService.isLangSupported(DEFAULT_TEMPLATE_LANG) && propertyValue.contains("{{")) {, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/AppendProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/FailProcessorFactoryTests.java, +        config.put("message", "{{error}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/RemoveProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SetProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/server/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java, +            if (scriptService.isLangSupported(DEFAULT_TEMPLATE_LANG) && propertyValue.contains("{{")) {, +++ b/server/src/main/java/org/elasticsearch/ingest/ValueSource.java, +            if (scriptService.isLangSupported(DEFAULT_TEMPLATE_LANG) && ((String) value).contains("{{")) {, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/AppendProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/FailProcessorFactoryTests.java, +        config.put("message", "{{error}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/RemoveProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SetProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/server/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java, +            if (scriptService.isLangSupported(DEFAULT_TEMPLATE_LANG) && propertyValue.contains("{{")) {, +++ b/server/src/main/java/org/elasticsearch/ingest/ValueSource.java, +            if (scriptService.isLangSupported(DEFAULT_TEMPLATE_LANG) && ((String) value).contains("{{")) {, +++ b/server/src/test/java/org/elasticsearch/ingest/ConfigurationUtilsTests.java, +import org.elasticsearch.script.TemplateScript;, +import static org.mockito.Matchers.any;, +import static org.mockito.Matchers.anyString;, +import static org.mockito.Mockito.times;, +import static org.mockito.Mockito.verify;, +import static org.mockito.Mockito.when;, +    public void testNoScriptCompilation() {, +        ScriptService scriptService = mock(ScriptService.class);, +        when(scriptService.isLangSupported(anyString())).thenReturn(true);, +        String propertyValue = randomAlphaOfLength(10);, +        TemplateScript.Factory result;, +        result = ConfigurationUtils.compileTemplate(randomAlphaOfLength(10), randomAlphaOfLength(10), randomAlphaOfLength(10),, +            propertyValue, scriptService);, +        assertThat(result.newInstance(null).execute(), equalTo(propertyValue));, +        verify(scriptService, times(0)).compile(any(), any());, +    }, +, +    public void testScriptShouldCompile() {, +        ScriptService scriptService = mock(ScriptService.class);, +        when(scriptService.isLangSupported(anyString())).thenReturn(true);, +        String propertyValue = "{{" + randomAlphaOfLength(10) + "}}";, +        String compiledValue = randomAlphaOfLength(10);, +        when(scriptService.compile(any(), any())).thenReturn(new TestTemplateService.MockTemplateScript.Factory(compiledValue));, +        TemplateScript.Factory result;, +        result = ConfigurationUtils.compileTemplate(randomAlphaOfLength(10), randomAlphaOfLength(10), randomAlphaOfLength(10),, +            propertyValue, scriptService);, +        assertThat(result.newInstance(null).execute(), equalTo(compiledValue));, +        verify(scriptService, times(1)).compile(any(), any());, +    }, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/AppendProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/FailProcessorFactoryTests.java, +        config.put("message", "{{error}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/RemoveProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SetProcessorFactoryTests.java, +        config.put("field", "{{field1}}");, +++ b/server/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java, +            if (scriptService.isLangSupported(DEFAULT_TEMPLATE_LANG) && propertyValue.contains("{{")) {, +++ b/server/src/main/java/org/elasticsearch/ingest/ValueSource.java, +            if (scriptService.isLangSupported(DEFAULT_TEMPLATE_LANG) && ((String) value).contains("{{")) {, +++ b/server/src/test/java/org/elasticsearch/ingest/ConfigurationUtilsTests.java, +import org.elasticsearch.script.TemplateScript;, +import static org.mockito.Matchers.any;, +import static org.mockito.Matchers.anyString;]