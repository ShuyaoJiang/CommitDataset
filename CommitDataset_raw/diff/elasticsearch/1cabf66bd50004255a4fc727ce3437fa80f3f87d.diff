[+++ b/core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.indices.IndexClosedException;, +     * Cluster level block to check before request execution. Returning null means that no blocks need to be checked., +    @Nullable, +        return null;, +     * Index level block to check before request execution. Returning null means that no blocks need to be checked., +    @Nullable, +        return null;, +            if (indexMetaData.getState() == IndexMetaData.State.CLOSE) {, +                throw new IndexClosedException(indexMetaData.getIndex());, +            }, +            ClusterBlockLevel globalBlockLevel = globalBlockLevel();, +            if (globalBlockLevel != null) {, +                ClusterBlockException blockException = state.blocks().globalBlockedException(globalBlockLevel);, +            }, +            ClusterBlockLevel indexBlockLevel = indexBlockLevel();, +            if (indexBlockLevel != null) {, +                ClusterBlockException blockException = state.blocks().indexBlockedException(indexBlockLevel, concreteIndex(state));, +            }, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.indices.IndexClosedException;, +     * Cluster level block to check before request execution. Returning null means that no blocks need to be checked., +    @Nullable, +        return null;, +     * Index level block to check before request execution. Returning null means that no blocks need to be checked., +    @Nullable, +        return null;, +            if (indexMetaData.getState() == IndexMetaData.State.CLOSE) {, +                throw new IndexClosedException(indexMetaData.getIndex());, +            }, +            ClusterBlockLevel globalBlockLevel = globalBlockLevel();, +            if (globalBlockLevel != null) {, +                ClusterBlockException blockException = state.blocks().globalBlockedException(globalBlockLevel);, +            }, +            ClusterBlockLevel indexBlockLevel = indexBlockLevel();, +            if (indexBlockLevel != null) {, +                ClusterBlockException blockException = state.blocks().indexBlockedException(indexBlockLevel, concreteIndex(state));, +            }, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java, +import org.elasticsearch.cluster.block.ClusterBlockLevel;, +    @Override, +    protected ClusterBlockLevel globalBlockLevel() {, +        return ClusterBlockLevel.WRITE;, +    }, +, +    @Override, +    protected ClusterBlockLevel indexBlockLevel() {, +        return ClusterBlockLevel.WRITE;, +    }, +, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.indices.IndexClosedException;, +     * Cluster level block to check before request execution. Returning null means that no blocks need to be checked., +    @Nullable, +        return null;, +     * Index level block to check before request execution. Returning null means that no blocks need to be checked., +    @Nullable, +        return null;, +            if (indexMetaData.getState() == IndexMetaData.State.CLOSE) {, +                throw new IndexClosedException(indexMetaData.getIndex());, +            }, +            ClusterBlockLevel globalBlockLevel = globalBlockLevel();, +            if (globalBlockLevel != null) {, +                ClusterBlockException blockException = state.blocks().globalBlockedException(globalBlockLevel);, +            }, +            ClusterBlockLevel indexBlockLevel = indexBlockLevel();, +            if (indexBlockLevel != null) {, +                ClusterBlockException blockException = state.blocks().indexBlockedException(indexBlockLevel, concreteIndex(state));, +            }, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java, +import org.elasticsearch.cluster.block.ClusterBlockLevel;, +    @Override, +    protected ClusterBlockLevel globalBlockLevel() {, +        return ClusterBlockLevel.WRITE;, +    }, +, +    @Override, +    protected ClusterBlockLevel indexBlockLevel() {, +        return ClusterBlockLevel.WRITE;, +    }, +, +++ b/core/src/test/java/org/elasticsearch/action/admin/indices/flush/FlushBlocksIT.java, +        for (String blockSetting : Arrays.asList(SETTING_BLOCKS_READ, SETTING_BLOCKS_WRITE, SETTING_READ_ONLY, SETTING_BLOCKS_METADATA)) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +import org.elasticsearch.common.Nullable;, +import org.elasticsearch.indices.IndexClosedException;]