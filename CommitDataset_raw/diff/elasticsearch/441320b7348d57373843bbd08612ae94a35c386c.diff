[+++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +        addAllocationDecider(deciders, new SnapshotInProgressAllocationDecider(settings));, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +        addAllocationDecider(deciders, new SnapshotInProgressAllocationDecider(settings));, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SnapshotInProgressAllocationDecider.java, +        if (shardRouting.primary()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +        addAllocationDecider(deciders, new SnapshotInProgressAllocationDecider(settings));, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SnapshotInProgressAllocationDecider.java, +        if (shardRouting.primary()) {, +++ b/core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java]