[+++ b/core/src/main/java/org/elasticsearch/index/shard/ShardId.java, +        return shardId == shardId1.shardId && index.equals(shardId1.index);, +            int compare = index.getName().compareTo(o.getIndex().getName());, +            if (compare != 0) {, +                return compare;, +            }, +            return index.getUUID().compareTo(o.getIndex().getUUID());, +++ b/core/src/main/java/org/elasticsearch/index/shard/ShardId.java, +        return shardId == shardId1.shardId && index.equals(shardId1.index);, +            int compare = index.getName().compareTo(o.getIndex().getName());, +            if (compare != 0) {, +                return compare;, +            }, +            return index.getUUID().compareTo(o.getIndex().getUUID());, +++ b/core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java, +import org.elasticsearch.index.Index;, +        routing = TestShardRouting.newShardRouting(shard.shardId.getIndex(), shard.shardId.id(), routing.currentNodeId(), null, routing.primary(), ShardRoutingState.INITIALIZING, shard.shardRouting.allocationId(), shard.shardRouting.version() + 1);]