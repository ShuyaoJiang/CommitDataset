[+++ b/server/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodesTests.java, +import org.elasticsearch.common.transport.TransportAddress;, +                final TransportAddress nodeAddress = node.getAddress();, +                node = new DiscoveryNode(node.getName(), node.getId(), node.getEphemeralId(), nodeAddress.address().getHostString(),, +                    nodeAddress.getAddress(), nodeAddress, attrs, node.getRoles(), node.getVersion());, +        if (masterA == null) {, +        } else {, +            assertThat(delta.previousMasterNode().getId(), equalTo(masterAId));, +        }, +        if (masterB == null) {, +            assertThat(delta.newMasterNode().getId(), equalTo(masterBId));, +        }, +, +        if (Objects.equals(masterAId, masterBId)) {, +            assertFalse(delta.masterNodeChanged());, +        } else {]