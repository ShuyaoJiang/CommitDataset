[+++ b/src/main/java/org/elasticsearch/index/store/Store.java, +                    if (version == null) {, +                        // version is written since 3.1+: we should have already hit IndexFormatTooOld., +                        throw new IllegalArgumentException("expected valid version value: " + info.info.toString());, +                    }, +                    if (version.onOrAfter(maxVersion)) {, +                        if (version.onOrAfter(FIRST_LUCENE_CHECKSUM_VERSION)) {, +                            builder.put(file, new StoreFileMetaData(file, directory.fileLength(file), legacyChecksum, version));, +                if (maxVersion.onOrAfter(FIRST_LUCENE_CHECKSUM_VERSION)) {, +                    builder.put(segmentsFile, new StoreFileMetaData(segmentsFile, directory.fileLength(segmentsFile), legacyChecksum, maxVersion, hashFile(directory, segmentsFile)));, +++ b/src/main/java/org/elasticsearch/index/store/Store.java, +                    if (version == null) {, +                        // version is written since 3.1+: we should have already hit IndexFormatTooOld., +                        throw new IllegalArgumentException("expected valid version value: " + info.info.toString());, +                    }, +                    if (version.onOrAfter(maxVersion)) {, +                        if (version.onOrAfter(FIRST_LUCENE_CHECKSUM_VERSION)) {, +                            builder.put(file, new StoreFileMetaData(file, directory.fileLength(file), legacyChecksum, version));, +                if (maxVersion.onOrAfter(FIRST_LUCENE_CHECKSUM_VERSION)) {, +                    builder.put(segmentsFile, new StoreFileMetaData(segmentsFile, directory.fileLength(segmentsFile), legacyChecksum, maxVersion, hashFile(directory, segmentsFile)));, +++ b/src/main/java/org/elasticsearch/index/store/StoreFileMetaData.java, +        return checksum != null && (writtenBy == null || writtenBy.onOrAfter(Version.LUCENE_4_8) == false);]