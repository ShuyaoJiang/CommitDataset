[+++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import java.util.Arrays;, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +                }, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import java.util.Arrays;, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +                }, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java, +import java.util.Arrays;, +            MapperService mapperService = indexService.mapperService();, +            for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                if (mapper != null) {, +            }, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +            }, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +                }, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import java.util.Arrays;, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +                }, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java, +import java.util.Arrays;, +            MapperService mapperService = indexService.mapperService();, +            for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                if (mapper != null) {, +            }, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +            }, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +                }, +++ b/server/src/main/java/org/elasticsearch/index/IndexWarmer.java, +            DocumentMapper docMapper = mapperService.documentMapper();, +            if (docMapper != null) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import java.util.Arrays;, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +                }, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java, +import java.util.Arrays;, +            MapperService mapperService = indexService.mapperService();, +            for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                if (mapper != null) {, +            }, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +            }, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +                }, +++ b/server/src/main/java/org/elasticsearch/index/IndexWarmer.java, +            DocumentMapper docMapper = mapperService.documentMapper();, +            if (docMapper != null) {, +++ b/server/src/main/java/org/elasticsearch/index/cache/bitset/BitsetFilterCache.java, +            DocumentMapper docMapper = mapperService.documentMapper();, +            if (docMapper != null) {, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +import java.util.Arrays;, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +                }, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java, +import java.util.Arrays;, +            MapperService mapperService = indexService.mapperService();, +            for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                if (mapper != null) {, +            }, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +            }, +                for (DocumentMapper mapper : Arrays.asList(mapperService.documentMapper(), mapperService.documentMapper(MapperService.DEFAULT_MAPPING))) {, +                    if (mapper != null) {, +                }, +++ b/server/src/main/java/org/elasticsearch/index/IndexWarmer.java, +            DocumentMapper docMapper = mapperService.documentMapper();, +            if (docMapper != null) {, +++ b/server/src/main/java/org/elasticsearch/index/cache/bitset/BitsetFilterCache.java, +            DocumentMapper docMapper = mapperService.documentMapper();, +            if (docMapper != null) {, +++ b/server/src/main/java/org/elasticsearch/index/mapper/MapperService.java, +import java.util.Arrays;, +import java.util.Objects;, +    private volatile DocumentMapper mapper;, +    private volatile DocumentMapper defaultMapper;, +        Set<String> existingMappers = new HashSet<>();, +        if (mapper != null) {, +            existingMappers.add(mapper.type());, +        }, +        if (defaultMapper != null) {, +            existingMappers.add(DEFAULT_MAPPING);, +        }]