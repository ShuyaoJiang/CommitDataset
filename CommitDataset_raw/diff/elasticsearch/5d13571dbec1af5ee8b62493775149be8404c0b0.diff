[+++ b/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java, +import java.util.ArrayList;, +                // flush any pending cluster states from old master, so it will not be set as master again, +                ArrayList<ProcessClusterState> pendingNewClusterStates = new ArrayList<>();, +                processNewClusterStates.drainTo(pendingNewClusterStates);, +                logger.trace("removed [{}] pending cluster states", pendingNewClusterStates.size());, +, +                            if (potentialState == null) {, +                                // might happen if the queue is drained, +                                break;, +                            }, +]