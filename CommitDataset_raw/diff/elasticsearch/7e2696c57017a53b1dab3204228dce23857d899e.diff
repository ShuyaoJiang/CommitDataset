[+++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java, +import org.elasticsearch.index.query.support.InnerHitsBuilder;, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java, +import org.elasticsearch.index.query.support.InnerHitsBuilder;, +++ b/core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java, +import org.elasticsearch.index.query.support.InnerHitBuilder;, +    private InnerHitBuilder innerHitBuilder;, +    public HasChildQueryBuilder(String type, QueryBuilder query, int maxChildren, int minChildren, ScoreMode scoreMode, InnerHitBuilder innerHitBuilder) {, +        this.innerHitBuilder = innerHitBuilder;, +        if (this.innerHitBuilder != null) {, +            this.innerHitBuilder.setParentChildType(type);, +            this.innerHitBuilder.setQuery(query);, +        }, +    public HasChildQueryBuilder innerHit(InnerHitBuilder innerHitBuilder) {, +        this.innerHitBuilder = Objects.requireNonNull(innerHitBuilder);, +        this.innerHitBuilder.setParentChildType(type);, +        this.innerHitBuilder.setQuery(query);, +    public InnerHitBuilder innerHit() {, +        return innerHitBuilder;, +        if (innerHitBuilder != null) {, +            builder.field(HasChildQueryParser.INNER_HITS_FIELD.getPreferredName(), innerHitBuilder, params);, +        if (innerHitBuilder != null) {, +            context.addInnerHit(innerHitBuilder);, +                && Objects.equals(innerHitBuilder, that.innerHitBuilder);, +        return Objects.hash(query, type, scoreMode, minChildren, maxChildren, innerHitBuilder);, +        innerHitBuilder = InnerHitBuilder.optionalReadFromStream(in);, +        if (innerHitBuilder != null) {, +            innerHitBuilder.writeTo(out);, +            hasChildQueryBuilder.minChildren(minChildren);, +            hasChildQueryBuilder.maxChildren(maxChildren);, +            hasChildQueryBuilder.scoreMode(scoreMode);, +            hasChildQueryBuilder.innerHit(innerHitBuilder);, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java, +import org.elasticsearch.index.query.support.InnerHitsBuilder;, +++ b/core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java, +import org.elasticsearch.index.query.support.InnerHitBuilder;, +    private InnerHitBuilder innerHitBuilder;, +    public HasChildQueryBuilder(String type, QueryBuilder query, int maxChildren, int minChildren, ScoreMode scoreMode, InnerHitBuilder innerHitBuilder) {, +        this.innerHitBuilder = innerHitBuilder;, +        if (this.innerHitBuilder != null) {, +            this.innerHitBuilder.setParentChildType(type);, +            this.innerHitBuilder.setQuery(query);, +        }, +    public HasChildQueryBuilder innerHit(InnerHitBuilder innerHitBuilder) {, +        this.innerHitBuilder = Objects.requireNonNull(innerHitBuilder);, +        this.innerHitBuilder.setParentChildType(type);, +        this.innerHitBuilder.setQuery(query);, +    public InnerHitBuilder innerHit() {, +        return innerHitBuilder;, +        if (innerHitBuilder != null) {, +            builder.field(HasChildQueryParser.INNER_HITS_FIELD.getPreferredName(), innerHitBuilder, params);, +        if (innerHitBuilder != null) {, +            context.addInnerHit(innerHitBuilder);, +                && Objects.equals(innerHitBuilder, that.innerHitBuilder);, +        return Objects.hash(query, type, scoreMode, minChildren, maxChildren, innerHitBuilder);, +        innerHitBuilder = InnerHitBuilder.optionalReadFromStream(in);, +        if (innerHitBuilder != null) {, +            innerHitBuilder.writeTo(out);, +            hasChildQueryBuilder.minChildren(minChildren);, +            hasChildQueryBuilder.maxChildren(maxChildren);, +            hasChildQueryBuilder.scoreMode(scoreMode);, +            hasChildQueryBuilder.innerHit(innerHitBuilder);, +++ b/core/src/main/java/org/elasticsearch/index/query/HasChildQueryParser.java, +import org.elasticsearch.index.query.support.InnerHitBuilder;, +        InnerHitBuilder innerHitBuilder = null;, +                    innerHitBuilder = InnerHitBuilder.fromXContent(parser, parseContext);, +        HasChildQueryBuilder hasChildQueryBuilder = new HasChildQueryBuilder(childType, iqb, maxChildren, minChildren, scoreMode, innerHitBuilder);, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java, +import org.elasticsearch.index.query.support.InnerHitsBuilder;, +++ b/core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java, +import org.elasticsearch.index.query.support.InnerHitBuilder;, +    private InnerHitBuilder innerHitBuilder;, +    public HasChildQueryBuilder(String type, QueryBuilder query, int maxChildren, int minChildren, ScoreMode scoreMode, InnerHitBuilder innerHitBuilder) {, +        this.innerHitBuilder = innerHitBuilder;, +        if (this.innerHitBuilder != null) {, +            this.innerHitBuilder.setParentChildType(type);, +            this.innerHitBuilder.setQuery(query);, +        }, +    public HasChildQueryBuilder innerHit(InnerHitBuilder innerHitBuilder) {, +        this.innerHitBuilder = Objects.requireNonNull(innerHitBuilder);, +        this.innerHitBuilder.setParentChildType(type);, +        this.innerHitBuilder.setQuery(query);, +    public InnerHitBuilder innerHit() {, +        return innerHitBuilder;, +        if (innerHitBuilder != null) {, +            builder.field(HasChildQueryParser.INNER_HITS_FIELD.getPreferredName(), innerHitBuilder, params);, +        if (innerHitBuilder != null) {, +            context.addInnerHit(innerHitBuilder);, +                && Objects.equals(innerHitBuilder, that.innerHitBuilder);, +        return Objects.hash(query, type, scoreMode, minChildren, maxChildren, innerHitBuilder);, +        innerHitBuilder = InnerHitBuilder.optionalReadFromStream(in);, +        if (innerHitBuilder != null) {, +            innerHitBuilder.writeTo(out);, +            hasChildQueryBuilder.minChildren(minChildren);, +            hasChildQueryBuilder.maxChildren(maxChildren);, +            hasChildQueryBuilder.scoreMode(scoreMode);, +            hasChildQueryBuilder.innerHit(innerHitBuilder);, +++ b/core/src/main/java/org/elasticsearch/index/query/HasChildQueryParser.java, +import org.elasticsearch.index.query.support.InnerHitBuilder;, +        InnerHitBuilder innerHitBuilder = null;]