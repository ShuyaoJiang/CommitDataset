[+++ b/src/main/java/org/elasticsearch/action/search/type/TransportSearchDfsQueryAndFetchAction.java, +                            try {, +                            } catch (Throwable t) {, +                                onSecondPhaseFailure(t, querySearchRequest, entry.index, dfsResult, counter);, +                            }, +                    onSecondPhaseFailure(t, querySearchRequest, shardIndex, dfsResult, counter);, +                }, +            });, +        }, +, +        void onSecondPhaseFailure(Throwable t, QuerySearchRequest querySearchRequest, int shardIndex, DfsSearchResult dfsResult, AtomicInteger counter) {, +            this.addShardFailure(shardIndex, dfsResult.shardTarget(), t);, +++ b/src/main/java/org/elasticsearch/action/search/type/TransportSearchDfsQueryAndFetchAction.java, +                            try {, +                            } catch (Throwable t) {, +                                onSecondPhaseFailure(t, querySearchRequest, entry.index, dfsResult, counter);, +                            }, +                    onSecondPhaseFailure(t, querySearchRequest, shardIndex, dfsResult, counter);, +                }, +            });, +        }, +, +        void onSecondPhaseFailure(Throwable t, QuerySearchRequest querySearchRequest, int shardIndex, DfsSearchResult dfsResult, AtomicInteger counter) {, +            this.addShardFailure(shardIndex, dfsResult.shardTarget(), t);, +++ b/src/main/java/org/elasticsearch/action/search/type/TransportSearchDfsQueryThenFetchAction.java, +                            try {, +                            } catch (Throwable t) {, +                                onQueryFailure(t, querySearchRequest, entry.index, dfsResult, counter);, +                            }, +                    onQueryFailure(t, querySearchRequest, shardIndex, dfsResult, counter);, +                }, +            });, +        }, +, +        void onQueryFailure(Throwable t, QuerySearchRequest querySearchRequest, int shardIndex, DfsSearchResult dfsResult, AtomicInteger counter) {, +            this.addShardFailure(shardIndex, dfsResult.shardTarget(), t);, +                            try {, +                            } catch (Throwable t) {, +                                onFetchFailure(t, fetchSearchRequest, entry.index, queryResult.shardTarget(), counter);, +                            }, +                    onFetchFailure(t, fetchSearchRequest, shardIndex, shardTarget, counter);, +                }, +            });, +        }, +, +        void onFetchFailure(Throwable t, FetchSearchRequest fetchSearchRequest, int shardIndex, SearchShardTarget shardTarget, AtomicInteger counter) {, +            this.addShardFailure(shardIndex, shardTarget, t);, +++ b/src/main/java/org/elasticsearch/action/search/type/TransportSearchDfsQueryAndFetchAction.java, +                            try {, +                            } catch (Throwable t) {, +                                onSecondPhaseFailure(t, querySearchRequest, entry.index, dfsResult, counter);, +                            }, +                    onSecondPhaseFailure(t, querySearchRequest, shardIndex, dfsResult, counter);, +                }, +            });, +        }, +, +        void onSecondPhaseFailure(Throwable t, QuerySearchRequest querySearchRequest, int shardIndex, DfsSearchResult dfsResult, AtomicInteger counter) {, +            this.addShardFailure(shardIndex, dfsResult.shardTarget(), t);, +++ b/src/main/java/org/elasticsearch/action/search/type/TransportSearchDfsQueryThenFetchAction.java, +                            try {, +                            } catch (Throwable t) {, +                                onQueryFailure(t, querySearchRequest, entry.index, dfsResult, counter);, +                            }, +                    onQueryFailure(t, querySearchRequest, shardIndex, dfsResult, counter);, +                }, +            });, +        }, +, +        void onQueryFailure(Throwable t, QuerySearchRequest querySearchRequest, int shardIndex, DfsSearchResult dfsResult, AtomicInteger counter) {, +            this.addShardFailure(shardIndex, dfsResult.shardTarget(), t);, +                            try {, +                            } catch (Throwable t) {, +                                onFetchFailure(t, fetchSearchRequest, entry.index, queryResult.shardTarget(), counter);, +                            }, +                    onFetchFailure(t, fetchSearchRequest, shardIndex, shardTarget, counter);, +                }, +            });, +        }, +, +        void onFetchFailure(Throwable t, FetchSearchRequest fetchSearchRequest, int shardIndex, SearchShardTarget shardTarget, AtomicInteger counter) {, +            this.addShardFailure(shardIndex, shardTarget, t);, +++ b/src/main/java/org/elasticsearch/action/search/type/TransportSearchQueryThenFetchAction.java, +                            try {, +                            } catch (Throwable t) {, +                                onFetchFailure(t, fetchSearchRequest, entry.index, queryResult.shardTarget(), counter);, +                            }, +                    onFetchFailure(t, fetchSearchRequest, shardIndex, shardTarget, counter);, +                }, +            });, +        }, +, +        void onFetchFailure(Throwable t, FetchSearchRequest fetchSearchRequest, int shardIndex, SearchShardTarget shardTarget, AtomicInteger counter) {, +            this.addShardFailure(shardIndex, shardTarget, t);, +++ b/src/main/java/org/elasticsearch/action/search/type/TransportSearchDfsQueryAndFetchAction.java, +                            try {, +                            } catch (Throwable t) {, +                                onSecondPhaseFailure(t, querySearchRequest, entry.index, dfsResult, counter);, +                            }, +                    onSecondPhaseFailure(t, querySearchRequest, shardIndex, dfsResult, counter);]