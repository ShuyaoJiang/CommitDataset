[+++ b/docs/reference/search/aggregations.asciidoc, +, +include::aggregations/reducer.asciidoc[], +, +++ b/docs/reference/search/aggregations.asciidoc, +, +include::aggregations/reducer.asciidoc[], +, +++ b/docs/reference/search/aggregations/reducer.asciidoc, +[[search-aggregations-reducer]], +, +include::reducer/derivative.asciidoc[], +++ b/docs/reference/search/aggregations.asciidoc, +, +include::aggregations/reducer.asciidoc[], +, +++ b/docs/reference/search/aggregations/reducer.asciidoc, +[[search-aggregations-reducer]], +, +include::reducer/derivative.asciidoc[], +++ b/docs/reference/search/aggregations/reducer/derivative-aggregation.asciidoc, +[[search-aggregations-reducer-derivative-aggregation]], +=== Derivative Aggregation, +, +A parent reducer aggregation which calculates the derivative of a specified metric in a parent histogram (or date_histogram) , +aggregation. The specified metric must be numeric and the enclosing histogram must have `min_doc_count` set to `0`., +, +The following snippet calculates the derivative of the total monthly `sales`:, +, +[source,js], +--------------------------------------------------, +{, +    "aggs" : {, +        "sales_per_month" : {, +            "date_histogram" : {, +                "field" : "date",, +                "interval" : "month", +            },, +            "aggs": {, +                "sales": {, +                    "sum": {, +                        "field": "price", +                    }, +                },, +                "sales_deriv": {, +                    "derivative": {, +                        "buckets_paths": "sales" <1>, +                    }, +                }, +            }, +        }, +    }, +}, +--------------------------------------------------, +, +<1> `bucket_paths` instructs this derivative aggregation to use the output of the `sales` aggregation for the derivative, +, +And the following may be the response:, +, +[source,js], +--------------------------------------------------, +{, +   "aggregations": {, +      "sales_per_month": {, +         "buckets": [, +            {, +               "key_as_string": "2015/01/01 00:00:00",, +               "key": 1420070400000,, +               "doc_count": 3,, +               "sales": {, +                  "value": 550, +               } <1>, +            },, +            {, +               "key_as_string": "2015/02/01 00:00:00",, +               "key": 1422748800000,, +               "doc_count": 2,, +               "sales": {, +                  "value": 60, +               },, +               "sales_deriv": {, +                  "value": -490 <2>, +               }, +            },, +            {, +               "key_as_string": "2015/03/01 00:00:00",, +               "key": 1425168000000,, +               "doc_count": 2,, +               "sales": {, +                  "value": 375, +               },, +               "sales_deriv": {, +                  "value": 315, +               }, +            }, +         ], +      }, +   }, +}, +--------------------------------------------------]