[+++ b/plugins/repository-s3/build.gradle, +import org.elasticsearch.gradle.BuildPlugin, +if (useFixture) {, +  apply plugin: 'elasticsearch.test.fixtures', +  Task writeDockerFile = project.tasks.create('writeDockerFile') {, +    File minioDockerfile = new File("${project.buildDir}/minio-docker/Dockerfile"), +    outputs.file(minioDockerfile), +    doLast {, +      minioDockerfile.parentFile.mkdirs(), +      minioDockerfile.text = "FROM minio/minio:RELEASE.2019-01-23T23-18-58Z\n" +, +        "RUN mkdir -p /minio/data/${s3PermanentBucket}\n" +, +        "ENV MINIO_ACCESS_KEY ${s3PermanentAccessKey}\n" +, +        "ENV MINIO_SECRET_KEY ${s3PermanentSecretKey}", +    }, +  }, +, +  preProcessFixture.dependsOn(writeDockerFile), +    cluster.dependsOn(postProcessFixture), +      int minioPort = postProcessFixture.ext."test.fixtures.minio-fixture.tcp.9000", +      assert minioPort > 0, +      return 'http://127.0.0.1:' + minioPort, +  integTestMinioRunner.dependsOn(postProcessFixture), +  BuildPlugin.requireDocker(integTestMinio), +++ b/plugins/repository-s3/build.gradle, +import org.elasticsearch.gradle.BuildPlugin, +if (useFixture) {, +  apply plugin: 'elasticsearch.test.fixtures', +  Task writeDockerFile = project.tasks.create('writeDockerFile') {, +    File minioDockerfile = new File("${project.buildDir}/minio-docker/Dockerfile"), +    outputs.file(minioDockerfile), +    doLast {, +      minioDockerfile.parentFile.mkdirs(), +      minioDockerfile.text = "FROM minio/minio:RELEASE.2019-01-23T23-18-58Z\n" +, +        "RUN mkdir -p /minio/data/${s3PermanentBucket}\n" +, +        "ENV MINIO_ACCESS_KEY ${s3PermanentAccessKey}\n" +, +        "ENV MINIO_SECRET_KEY ${s3PermanentSecretKey}", +    }, +  }, +, +  preProcessFixture.dependsOn(writeDockerFile), +    cluster.dependsOn(postProcessFixture), +      int minioPort = postProcessFixture.ext."test.fixtures.minio-fixture.tcp.9000", +      assert minioPort > 0, +      return 'http://127.0.0.1:' + minioPort, +  integTestMinioRunner.dependsOn(postProcessFixture), +  BuildPlugin.requireDocker(integTestMinio), +++ b/plugins/repository-s3/docker-compose.yml, +version: '3', +services:, +  minio-fixture:, +    build:, +      context: ./build/minio-docker, +      dockerfile: Dockerfile, +    ports:, +      - "9000", +    command: ["server", "/minio/data"]]