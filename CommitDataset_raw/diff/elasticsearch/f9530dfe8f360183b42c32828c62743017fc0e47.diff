[+++ /dev/null, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +                            Object fetchSubPhaseBuilder = fetchSubPhaseParser.parse(extParser);, +                            context.putFetchSubPhaseBuilder(currentFieldName, fetchSubPhaseBuilder);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +                            Object fetchSubPhaseBuilder = fetchSubPhaseParser.parse(extParser);, +                            context.putFetchSubPhaseBuilder(currentFieldName, fetchSubPhaseBuilder);, +++ /dev/null, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +                            Object fetchSubPhaseBuilder = fetchSubPhaseParser.parse(extParser);, +                            context.putFetchSubPhaseBuilder(currentFieldName, fetchSubPhaseBuilder);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhaseParser.java, +public interface FetchSubPhaseParser {, +    Object parse(XContentParser parser) throws Exception;, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +                            Object fetchSubPhaseBuilder = fetchSubPhaseParser.parse(extParser);, +                            context.putFetchSubPhaseBuilder(currentFieldName, fetchSubPhaseBuilder);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhaseParser.java, +public interface FetchSubPhaseParser {, +    Object parse(XContentParser parser) throws Exception;, +++ b/core/src/main/java/org/elasticsearch/search/internal/DefaultSearchContext.java, +    private final Map<String, Object> subPhaseBuilders = new HashMap<>();, +    public Object getFetchSubPhaseBuilder(String name) {, +        return subPhaseBuilders.get(name);, +    public void putFetchSubPhaseBuilder(String name, Object fetchSubPhaseBuilder) {, +        subPhaseBuilders.put(name, fetchSubPhaseBuilder);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +                            Object fetchSubPhaseBuilder = fetchSubPhaseParser.parse(extParser);, +                            context.putFetchSubPhaseBuilder(currentFieldName, fetchSubPhaseBuilder);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhaseParser.java, +public interface FetchSubPhaseParser {, +    Object parse(XContentParser parser) throws Exception;, +++ b/core/src/main/java/org/elasticsearch/search/internal/DefaultSearchContext.java, +    private final Map<String, Object> subPhaseBuilders = new HashMap<>();, +    public Object getFetchSubPhaseBuilder(String name) {, +        return subPhaseBuilders.get(name);, +    public void putFetchSubPhaseBuilder(String name, Object fetchSubPhaseBuilder) {, +        subPhaseBuilders.put(name, fetchSubPhaseBuilder);, +++ b/core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java, +    public void putFetchSubPhaseBuilder(String name, Object fetchSubPhaseBuilder) {, +        in.putFetchSubPhaseBuilder(name, fetchSubPhaseBuilder);, +    public Object getFetchSubPhaseBuilder(String name) {, +        return in.getFetchSubPhaseBuilder(name);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +                            Object fetchSubPhaseBuilder = fetchSubPhaseParser.parse(extParser);, +                            context.putFetchSubPhaseBuilder(currentFieldName, fetchSubPhaseBuilder);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhaseParser.java, +public interface FetchSubPhaseParser {, +    Object parse(XContentParser parser) throws Exception;, +++ b/core/src/main/java/org/elasticsearch/search/internal/DefaultSearchContext.java, +    private final Map<String, Object> subPhaseBuilders = new HashMap<>();, +    public Object getFetchSubPhaseBuilder(String name) {, +        return subPhaseBuilders.get(name);, +    public void putFetchSubPhaseBuilder(String name, Object fetchSubPhaseBuilder) {, +        subPhaseBuilders.put(name, fetchSubPhaseBuilder);, +++ b/core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java, +    public void putFetchSubPhaseBuilder(String name, Object fetchSubPhaseBuilder) {, +        in.putFetchSubPhaseBuilder(name, fetchSubPhaseBuilder);, +    public Object getFetchSubPhaseBuilder(String name) {, +        return in.getFetchSubPhaseBuilder(name);, +++ b/core/src/main/java/org/elasticsearch/search/internal/SearchContext.java, +    public abstract void putFetchSubPhaseBuilder(String name, Object fetchSubPhaseBuilder);, +    public abstract Object getFetchSubPhaseBuilder(String name);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +                            Object fetchSubPhaseBuilder = fetchSubPhaseParser.parse(extParser);, +                            context.putFetchSubPhaseBuilder(currentFieldName, fetchSubPhaseBuilder);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhaseParser.java, +public interface FetchSubPhaseParser {, +    Object parse(XContentParser parser) throws Exception;, +++ b/core/src/main/java/org/elasticsearch/search/internal/DefaultSearchContext.java, +    private final Map<String, Object> subPhaseBuilders = new HashMap<>();, +    public Object getFetchSubPhaseBuilder(String name) {, +        return subPhaseBuilders.get(name);, +    public void putFetchSubPhaseBuilder(String name, Object fetchSubPhaseBuilder) {, +        subPhaseBuilders.put(name, fetchSubPhaseBuilder);, +++ b/core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java, +    public void putFetchSubPhaseBuilder(String name, Object fetchSubPhaseBuilder) {, +        in.putFetchSubPhaseBuilder(name, fetchSubPhaseBuilder);, +    public Object getFetchSubPhaseBuilder(String name) {, +        return in.getFetchSubPhaseBuilder(name);, +++ b/core/src/main/java/org/elasticsearch/search/internal/SearchContext.java, +    public abstract void putFetchSubPhaseBuilder(String name, Object fetchSubPhaseBuilder);, +    public abstract Object getFetchSubPhaseBuilder(String name);, +++ b/core/src/test/java/org/elasticsearch/search/fetch/FetchSubPhasePluginIT.java, +import org.elasticsearch.common.ParsingException;, +    @SuppressWarnings("unchecked"), +        private static final String NAME = "term_vectors_fetch";, +            return singletonMap(NAME, new TermVectorsFetchParser());]