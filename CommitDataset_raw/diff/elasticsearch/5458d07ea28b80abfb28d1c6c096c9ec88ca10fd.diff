[+++ /dev/null, +++ /dev/null, +++ b/dev-tools/prepare_release_candidate.py, +# Licensed to Elasticsearch under one or more contributor, +# license agreements. See the NOTICE file distributed with, +# this work for additional information regarding copyright, +# ownership. Elasticsearch licenses this file to you under, +# the Apache License, Version 2.0 (the "License"); you may, +# not use this file except in compliance  with the License., +# You may obtain a copy of the License at, +#, +#     http://www.apache.org/licenses/LICENSE-2.0, +#, +# Unless required by applicable law or agreed to in writing,, +# software distributed under the License is distributed on, +# an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,, +# either express or implied. See the License for the specific, +# language governing permissions and limitations under the License., +, +# Prepare a release, +#, +# 1. Update the Version.java to remove the snapshot bit, +# 2. Remove the -SNAPSHOT suffix in all pom.xml files, +#, +# USAGE:, +#, +# python3 ./dev-tools/prepare-release.py, +#, +# Note: Ensure the script is run from the root directory, +#, +, +import fnmatch, +import argparse, +from prepare_release_update_documentation import update_reference_docs, +import subprocess, +import tempfile, +import re, +import os, +import shutil, +, +VERSION_FILE = 'core/src/main/java/org/elasticsearch/Version.java', +POM_FILE = 'pom.xml', +MAIL_TEMPLATE = """, +Hi all, +, +The new release candidate for %(version)s based on this commit[1]  is now available, including the x-plugins, and RPM/deb repos:, +, +   - ZIP [2], +   - tar.gz [3], +   - RPM [4], +   - deb [5], +, +Plugins can be installed as follows,, +, +    bin/plugin -Des.plugins.staging=true install cloud-aws, +, +The same goes for the x-plugins:, +, +    bin/plugin -Des.plugins.staging=true install license, +    bin/plugin -Des.plugins.staging=true install shield, +    bin/plugin -Des.plugins.staging=true install watcher, +, +To install the deb from an APT repo:, +, +APT line sources.list line:, +, +deb http://download.elasticsearch.org/elasticsearch/staging/%(version)s-%(hash)s/repos/elasticsearch/%(major_minor_version)s/debian/ stable main, +, +To install the RPM, create a YUM file like:, +, +    /etc/yum.repos.d/elasticsearch.repo, +, +containing:, +, +[elasticsearch-2.0], +name=Elasticsearch repository for packages, +baseurl=http://download.elasticsearch.org/elasticsearch/staging/%(version)s-%(hash)s/repos/elasticsearch/%(major_minor_version)s/centos, +gpgcheck=1, +gpgkey=http://packages.elastic.co/GPG-KEY-elasticsearch, +enabled=1, +, +, +[1] https://github.com/elastic/elasticsearch/commit/%(hash)s, +[2] http://download.elasticsearch.org/elasticsearch/staging/%(version)s-%(hash)s/org/elasticsearch/distribution/zip/elasticsearch/%(version)s/elasticsearch-%(version)s.zip, +[3] http://download.elasticsearch.org/elasticsearch/staging/%(version)s-%(hash)s/org/elasticsearch/distribution/tar/elasticsearch/%(version)s/elasticsearch-%(version)s.tar.gz, +[4] http://download.elasticsearch.org/elasticsearch/staging/%(version)s-%(hash)s/org/elasticsearch/distribution/rpm/elasticsearch/%(version)s/elasticsearch-%(version)s.rpm, +[5] http://download.elasticsearch.org/elasticsearch/staging/%(version)s-%(hash)s/org/elasticsearch/distribution/deb/elasticsearch/%(version)s/elasticsearch-%(version)s.deb, +""", +, +def run(command, env_vars=None):, +  if env_vars:, +    for key, value in env_vars.iter_items():, +      os.putenv(key, value), +  if os.system('%s' % (command)):, +    raise RuntimeError('    FAILED: %s' % (command)), +, +def ensure_checkout_is_clean():, +  # Make sure no local mods:, +  s = subprocess.check_output('git diff --shortstat', shell=True).decode('utf-8'), +  if len(s) > 0:]