[+++ b/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java, +++ b/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java, +++ b/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java, +            grid.reduceAndTrimBuckets(reduceContext.cacheRecycler());, +    protected void reduceAndTrimBuckets(CacheRecycler cacheRecycler) {, +, +        if (requiredSize > buckets.size()) { // nothing to trim, +            for (Bucket bucket : buckets) {, +            return;, +, +        List<Bucket> trimmedBuckets = new ArrayList<Bucket>(requiredSize);, +        for (Bucket bucket : buckets) {, +            if (trimmedBuckets.size() >= requiredSize) {, +                break;, +            }, +            bucket.aggregations.reduce(cacheRecycler);, +            trimmedBuckets.add(bucket);, +        }, +        buckets = trimmedBuckets;]