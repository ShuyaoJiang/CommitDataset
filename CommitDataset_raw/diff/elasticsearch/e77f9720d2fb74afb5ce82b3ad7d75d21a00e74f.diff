[+++ b/rest-api-spec/test/indices.put_mapping/all_path_options.yaml, +---, +"post a mapping with default analyzer twice":, +, +  - do:, +      indices.put_mapping:, +        index: test_index1, +        type: test_type, +        body:, +          test_type:, +            dynamic: false, +            properties:, +              text:, +                index:    analyzed, +                analyzer: default, +                type:     string, +, +  - do:, +      indices.put_mapping:, +        index: test_index1, +        type: test_type, +        body:, +          test_type:, +            dynamic: false, +            properties:, +              text:, +                index:    analyzed, +                analyzer: default, +                type:     string, +, +  - do:, +      indices.get_mapping: {}, +, +  - match: {test_index1.mappings.test_type.properties.text.type:     string}, + , +++ b/rest-api-spec/test/indices.put_mapping/all_path_options.yaml, +---, +"post a mapping with default analyzer twice":, +, +  - do:, +      indices.put_mapping:, +        index: test_index1, +        type: test_type, +        body:, +          test_type:, +            dynamic: false, +            properties:, +              text:, +                index:    analyzed, +                analyzer: default, +                type:     string, +, +  - do:, +      indices.put_mapping:, +        index: test_index1, +        type: test_type, +        body:, +          test_type:, +            dynamic: false, +            properties:, +              text:, +                index:    analyzed, +                analyzer: default, +                type:     string, +, +  - do:, +      indices.get_mapping: {}, +, +  - match: {test_index1.mappings.test_type.properties.text.type:     string}, + , +++ b/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java, +        , +        // null and "default"-named index analyzers both mean the default is used, +        if (this.indexAnalyzer == null || "default".equals(this.indexAnalyzer.name())) {, +            if (fieldMergeWith.indexAnalyzer != null && !"default".equals(fieldMergeWith.indexAnalyzer.name())) {, +        } else if (fieldMergeWith.indexAnalyzer == null || "default".equals(fieldMergeWith.indexAnalyzer.name())) {, +        ]