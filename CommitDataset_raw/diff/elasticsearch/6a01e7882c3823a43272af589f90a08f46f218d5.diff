[+++ b/src/test/java/org/elasticsearch/test/integration/indices/store/IndicesStoreTests.java, +import org.elasticsearch.common.unit.TimeValue;, +    public void shardsCleanup() throws Exception {, +        assertThat(waitForShardDeletion(TimeValue.timeValueSeconds(1), "server3", "test", 0), equalTo(false));, +        assertThat(waitForShardDeletion(TimeValue.timeValueSeconds(1), "server2", "test", 0), equalTo(false));, +    private boolean waitForShardDeletion(TimeValue timeout, String server, String index, int shard) throws InterruptedException {, +        long start = System.currentTimeMillis();, +        boolean shardExists;, +        do {, +            shardExists = shardDirectory(server, index, shard).exists();, +        }, +        while (shardExists && (System.currentTimeMillis() - start) < timeout.millis());, +        return shardExists;, +    }, +]