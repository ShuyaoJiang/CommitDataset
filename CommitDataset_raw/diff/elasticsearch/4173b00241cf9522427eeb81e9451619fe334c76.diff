[+++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchType.java, +    QUERY_AND_FETCH((byte) 3);, +     * "query_then_fetch"/"queryThenFetch" and "query_and_fetch"/"queryAndFetch"., +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchType.java, +    QUERY_AND_FETCH((byte) 3);, +     * "query_then_fetch"/"queryThenFetch" and "query_and_fetch"/"queryAndFetch"., +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        if (optimizeSingleShard) {, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchType.java, +    QUERY_AND_FETCH((byte) 3);, +     * "query_then_fetch"/"queryThenFetch" and "query_and_fetch"/"queryAndFetch"., +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        if (optimizeSingleShard) {, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java, +                                       ActionFilters actionFilters,, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchType.java, +    QUERY_AND_FETCH((byte) 3);, +     * "query_then_fetch"/"queryThenFetch" and "query_and_fetch"/"queryAndFetch"., +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        if (optimizeSingleShard) {, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java, +                                       ActionFilters actionFilters,, +++ b/core/src/main/java/org/elasticsearch/action/search/type/ParsedScrollId.java, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchType.java, +    QUERY_AND_FETCH((byte) 3);, +     * "query_then_fetch"/"queryThenFetch" and "query_and_fetch"/"queryAndFetch"., +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        if (optimizeSingleShard) {, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java, +                                       ActionFilters actionFilters,, +++ b/core/src/main/java/org/elasticsearch/action/search/type/ParsedScrollId.java, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchType.java, +    QUERY_AND_FETCH((byte) 3);, +     * "query_then_fetch"/"queryThenFetch" and "query_and_fetch"/"queryAndFetch"., +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        if (optimizeSingleShard) {, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java, +                                       ActionFilters actionFilters,, +++ b/core/src/main/java/org/elasticsearch/action/search/type/ParsedScrollId.java, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchType.java, +    QUERY_AND_FETCH((byte) 3);, +     * "query_then_fetch"/"queryThenFetch" and "query_and_fetch"/"queryAndFetch"., +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        if (optimizeSingleShard) {, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java, +                                       ActionFilters actionFilters,, +++ b/core/src/main/java/org/elasticsearch/action/search/type/ParsedScrollId.java, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchType.java, +    QUERY_AND_FETCH((byte) 3);, +     * "query_then_fetch"/"queryThenFetch" and "query_and_fetch"/"queryAndFetch"., +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        if (optimizeSingleShard) {, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java, +                                       ActionFilters actionFilters,, +++ b/core/src/main/java/org/elasticsearch/action/search/type/ParsedScrollId.java, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java, +++ /dev/null, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchType.java, +    QUERY_AND_FETCH((byte) 3);, +     * "query_then_fetch"/"queryThenFetch" and "query_and_fetch"/"queryAndFetch"., +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +        if (optimizeSingleShard) {, +++ b/core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java, +                                       ActionFilters actionFilters,, +++ b/core/src/main/java/org/elasticsearch/action/search/type/ParsedScrollId.java, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java, +++ /dev/null, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/percolator/PercolateContext.java, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +                TransportSearchQueryAndFetchAction.class]