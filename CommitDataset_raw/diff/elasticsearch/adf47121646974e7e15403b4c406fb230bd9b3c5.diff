[+++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +        stats.addIndexWriterMaxMemoryInBytes(0);, +++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +        stats.addIndexWriterMaxMemoryInBytes(0);, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +        stats.addIndexWriterMaxMemoryInBytes((long) (indexWriter.getConfig().getRAMBufferSizeMB() * 1024 * 1024));, +++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +        stats.addIndexWriterMaxMemoryInBytes(0);, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +        stats.addIndexWriterMaxMemoryInBytes((long) (indexWriter.getConfig().getRAMBufferSizeMB() * 1024 * 1024));, +++ b/core/src/main/java/org/elasticsearch/index/engine/SegmentsStats.java, +    private long indexWriterMaxMemoryInBytes;, +    public void addIndexWriterMaxMemoryInBytes(long indexWriterMaxMemoryInBytes) {, +        this.indexWriterMaxMemoryInBytes += indexWriterMaxMemoryInBytes;, +    }, +, +        addIndexWriterMaxMemoryInBytes(mergeStats.indexWriterMaxMemoryInBytes);, +     * Maximum memory index writer may use before it must write buffered documents to a new segment., +     */, +    public long getIndexWriterMaxMemoryInBytes() {, +        return this.indexWriterMaxMemoryInBytes;, +    }, +, +    public ByteSizeValue getIndexWriterMaxMemory() {, +        return new ByteSizeValue(indexWriterMaxMemoryInBytes);, +    }, +, +    /**, +        builder.byteSizeField(Fields.INDEX_WRITER_MAX_MEMORY_IN_BYTES, Fields.INDEX_WRITER_MAX_MEMORY, indexWriterMaxMemoryInBytes);, +        static final String INDEX_WRITER_MAX_MEMORY = "index_writer_max_memory";, +        static final String INDEX_WRITER_MAX_MEMORY_IN_BYTES = "index_writer_max_memory_in_bytes";, +        indexWriterMaxMemoryInBytes = in.readLong();, +        out.writeLong(indexWriterMaxMemoryInBytes);, +++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +        stats.addIndexWriterMaxMemoryInBytes(0);, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +        stats.addIndexWriterMaxMemoryInBytes((long) (indexWriter.getConfig().getRAMBufferSizeMB() * 1024 * 1024));, +++ b/core/src/main/java/org/elasticsearch/index/engine/SegmentsStats.java, +    private long indexWriterMaxMemoryInBytes;, +    public void addIndexWriterMaxMemoryInBytes(long indexWriterMaxMemoryInBytes) {, +        this.indexWriterMaxMemoryInBytes += indexWriterMaxMemoryInBytes;, +    }, +, +        addIndexWriterMaxMemoryInBytes(mergeStats.indexWriterMaxMemoryInBytes);, +     * Maximum memory index writer may use before it must write buffered documents to a new segment., +     */, +    public long getIndexWriterMaxMemoryInBytes() {, +        return this.indexWriterMaxMemoryInBytes;, +    }, +, +    public ByteSizeValue getIndexWriterMaxMemory() {, +        return new ByteSizeValue(indexWriterMaxMemoryInBytes);, +    }, +, +    /**, +        builder.byteSizeField(Fields.INDEX_WRITER_MAX_MEMORY_IN_BYTES, Fields.INDEX_WRITER_MAX_MEMORY, indexWriterMaxMemoryInBytes);, +        static final String INDEX_WRITER_MAX_MEMORY = "index_writer_max_memory";, +        static final String INDEX_WRITER_MAX_MEMORY_IN_BYTES = "index_writer_max_memory_in_bytes";, +        indexWriterMaxMemoryInBytes = in.readLong();, +        out.writeLong(indexWriterMaxMemoryInBytes);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/ip/LegacyIpFieldMapper.java, +import org.elasticsearch.index.IndexSettings;, +import org.elasticsearch.index.fielddata.IndexFieldDataCache;, +import org.elasticsearch.index.mapper.MapperService;, +import org.elasticsearch.indices.breaker.CircuitBreakerService;, +            return new IndexFieldData.Builder() {, +                @Override, +                public IndexFieldData<?> build(IndexSettings indexSettings,, +                        MappedFieldType fieldType, IndexFieldDataCache cache,, +                        CircuitBreakerService breakerService, MapperService mapperService) {, +                    return new LegacyIpIndexFieldData(indexSettings.getIndex(), name());, +                }, +            };, +++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +        stats.addIndexWriterMaxMemoryInBytes(0);, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +        stats.addIndexWriterMaxMemoryInBytes((long) (indexWriter.getConfig().getRAMBufferSizeMB() * 1024 * 1024));, +++ b/core/src/main/java/org/elasticsearch/index/engine/SegmentsStats.java, +    private long indexWriterMaxMemoryInBytes;, +    public void addIndexWriterMaxMemoryInBytes(long indexWriterMaxMemoryInBytes) {, +        this.indexWriterMaxMemoryInBytes += indexWriterMaxMemoryInBytes;, +    }, +, +        addIndexWriterMaxMemoryInBytes(mergeStats.indexWriterMaxMemoryInBytes);, +     * Maximum memory index writer may use before it must write buffered documents to a new segment., +     */, +    public long getIndexWriterMaxMemoryInBytes() {, +        return this.indexWriterMaxMemoryInBytes;, +    }, +, +    public ByteSizeValue getIndexWriterMaxMemory() {, +        return new ByteSizeValue(indexWriterMaxMemoryInBytes);, +    }, +, +    /**, +        builder.byteSizeField(Fields.INDEX_WRITER_MAX_MEMORY_IN_BYTES, Fields.INDEX_WRITER_MAX_MEMORY, indexWriterMaxMemoryInBytes);, +        static final String INDEX_WRITER_MAX_MEMORY = "index_writer_max_memory";, +        static final String INDEX_WRITER_MAX_MEMORY_IN_BYTES = "index_writer_max_memory_in_bytes";, +        indexWriterMaxMemoryInBytes = in.readLong();, +        out.writeLong(indexWriterMaxMemoryInBytes);]