[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/compress/lzf/impl/UnsafeChunkDecoder.java, +                    moveLong(out, outPos, outEnd, ctrl);, +    /* Note: 'delta' is negative (back ref); dataEnd is the first location AFTER, +     * end of expected uncompressed data (i.e. end marker), +     */, +    private final static void moveLong(byte[] data, int resultOffset, int dataEnd, int delta) {, +        if ((resultOffset + 8) < dataEnd) {, +            final long rawOffset = BYTE_ARRAY_OFFSET + resultOffset;, +            long value = unsafe.getLong(data, rawOffset + delta);, +            unsafe.putLong(data, rawOffset, value);, +            return;, +        }, +        System.arraycopy(data, resultOffset + delta, data, resultOffset, data.length - resultOffset);]