[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedValueHistogramFacetCollector.java, +        final ValueAggregator valueAggregator = new ValueAggregator();, +, +                    entry = new InternalBoundedFullHistogramFacet.FullEntry(index, 1, Double.MAX_VALUE, Double.MIN_VALUE, 0, 0);, +, +                    valueAggregator.entry = entry;, +                    valueFieldData.forEachValueInDoc(docId, valueAggregator);, +                    valueAggregator.entry = entry;, +                    valueFieldData.forEachValueInDoc(docId, valueAggregator);, +, +, +        public static class ValueAggregator implements NumericFieldData.DoubleValueInDocProc {, +, +            InternalBoundedFullHistogramFacet.FullEntry entry;, +, +            @Override public void onValue(int docId, double value) {, +                entry.totalCount++;, +                entry.total += value;, +                if (value < entry.min) {, +                    entry.min = value;, +                }, +                if (value > entry.max) {, +                    entry.max = value;, +                }, +            }, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/bounded/BoundedValueHistogramFacetCollector.java, +        final ValueAggregator valueAggregator = new ValueAggregator();, +, +                    entry = new InternalBoundedFullHistogramFacet.FullEntry(index, 1, Double.MAX_VALUE, Double.MIN_VALUE, 0, 0);, +, +                    valueAggregator.entry = entry;, +                    valueFieldData.forEachValueInDoc(docId, valueAggregator);, +                    valueAggregator.entry = entry;, +                    valueFieldData.forEachValueInDoc(docId, valueAggregator);, +, +, +        public static class ValueAggregator implements NumericFieldData.DoubleValueInDocProc {, +, +            InternalBoundedFullHistogramFacet.FullEntry entry;, +, +            @Override public void onValue(int docId, double value) {, +                entry.totalCount++;, +                entry.total += value;, +                if (value < entry.min) {, +                    entry.min = value;, +                }, +                if (value > entry.max) {, +                    entry.max = value;, +                }, +            }, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/facet/histogram/unbounded/ValueHistogramFacetCollector.java, +        final ValueAggregator valueAggregator = new ValueAggregator();, +, +                    entry = new InternalFullHistogramFacet.FullEntry(bucket, 1, Double.MAX_VALUE, Double.MIN_VALUE, 0, 0);, +                    valueAggregator.entry = entry;, +                    valueFieldData.forEachValueInDoc(docId, valueAggregator);, +                    valueAggregator.entry = entry;, +                    valueFieldData.forEachValueInDoc(docId, valueAggregator);, +, +        public static class ValueAggregator implements NumericFieldData.DoubleValueInDocProc {, +, +            InternalFullHistogramFacet.FullEntry entry;, +, +            @Override public void onValue(int docId, double value) {, +                entry.totalCount++;, +                entry.total += value;, +                if (value < entry.min) {, +                    entry.min = value;, +                }, +                if (value > entry.max) {, +                    entry.max = value;, +                }, +            }, +        }]