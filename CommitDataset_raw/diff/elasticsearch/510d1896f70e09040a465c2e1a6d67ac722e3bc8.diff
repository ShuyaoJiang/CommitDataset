[+++ b/core/src/main/java/org/elasticsearch/index/query/IndexQueryParserService.java, +    public ParsedQuery parse(QueryBuilder queryBuilder) {, +        XContentParser parser = null;, +            BytesReference bytes = queryBuilder.buildAsBytes();, +            parser = XContentFactory.xContent(bytes).createParser(bytes);, +            return innerParse(cache.get(), parser);, +            throw new ParsingException(parser == null ? null : parser.getTokenLocation(), "Failed to parse", e);, +        } finally {, +            if (parser != null) {, +                parser.close();, +            }, +    public QueryBuilder parseInnerQueryBuilder(QueryParseContext parseContext) throws IOException {, +    private static ParsedQuery innerParse(QueryShardContext context, QueryBuilder queryBuilder) throws IOException, QueryShardException {]