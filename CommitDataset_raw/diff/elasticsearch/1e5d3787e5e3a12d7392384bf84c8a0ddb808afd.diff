[+++ b/core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java, +        CountDownLatch started = new CountDownLatch(1);, +        Thread t = new Thread(() -> {, +            SearchResponse searchResponse;, +            started.countDown();, +            do {, +                searchResponse = client().prepareSearch().get();, +            } while (searchResponse.getHits().totalHits != totalNumDocs.get());, +        });, +        t.start();, +        started.await();]