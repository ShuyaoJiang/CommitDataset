[+++ b/src/main/java/org/elasticsearch/script/ScriptService.java, +import org.elasticsearch.common.unit.TimeValue;, +import java.util.concurrent.TimeUnit;, +    private final Cache<CacheKey, CompiledScript> cache;, +        int cacheMaxSize = componentSettings.getAsInt("cache.max_size", 500);, +        TimeValue cacheExpire = componentSettings.getAsTime("cache.expire", null);, +        logger.debug("using script cache with max_size [{}], expire [{}]", cacheMaxSize, cacheExpire);, +, +        CacheBuilder cacheBuilder = CacheBuilder.newBuilder();, +        if (cacheMaxSize >= 0) {, +            cacheBuilder.maximumSize(cacheMaxSize);, +        }, +        if (cacheExpire != null) {, +            cacheBuilder.expireAfterAccess(cacheExpire.nanos(), TimeUnit.NANOSECONDS);, +        }, +        this.cache = cacheBuilder.build();, +]