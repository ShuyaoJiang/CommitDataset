[+++ b/docs/reference/rollup/apis/stop-job.asciidoc, +// TEST[s/_stop/_stop?wait_for_completion=true&timeout=10s/], +++ b/docs/reference/rollup/apis/stop-job.asciidoc, +// TEST[s/_stop/_stop?wait_for_completion=true&timeout=10s/], +++ b/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java, +, +        // Cleanup rollup before deleting indices.  A rollup job might have bulks in-flight,, +        // so we need to fully shut them down first otherwise a job might stall waiting, +        // for a bulk to finish against a non-existing index (and then fail tests), +        if (hasXPack && false == preserveRollupJobsUponCompletion()) {, +            wipeRollupJobs();, +            waitForPendingRollupTasks();, +        }, +]