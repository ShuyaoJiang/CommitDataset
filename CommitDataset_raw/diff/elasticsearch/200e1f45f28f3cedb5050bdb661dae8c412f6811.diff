[+++ b/build.gradle, +wrapper {, +    distributionType = DistributionType.ALL, +    doLast {, +        println "Added checksum to wrapper properties", +      gradleVersion = "4.8.1" // does not default to gradle weapper of project dir, but current version, +++ b/build.gradle, +wrapper {, +    distributionType = DistributionType.ALL, +    doLast {, +        println "Added checksum to wrapper properties", +      gradleVersion = "4.8.1" // does not default to gradle weapper of project dir, but current version, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +        // Only works with  `enableFeaturePreview('STABLE_PUBLISHING')`, +        // https://github.com/gradle/gradle/issues/5696#issuecomment-396965185, +        project.tasks.withType(GenerateMavenPom.class) { GenerateMavenPom generatePOMTask ->, +            // The GenerateMavenPom task is aggressive about setting the destination, instead of fighting it,, +            // just make a copy., +            doLast {, +                project.copy {, +                    from generatePOMTask.destination, +                    into "${project.buildDir}/distributions", +                    rename { "${project.archivesBaseName}-${project.version}.pom" }, +                }, +            }, +            // build poms with assemble (if the assemble task exists), +            Task assemble = project.tasks.findByName('assemble'), +            if (assemble) {, +                assemble.dependsOn(generatePOMTask), +            }, +        }, +++ b/build.gradle, +wrapper {, +    distributionType = DistributionType.ALL, +    doLast {, +        println "Added checksum to wrapper properties", +      gradleVersion = "4.8.1" // does not default to gradle weapper of project dir, but current version, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +        // Only works with  `enableFeaturePreview('STABLE_PUBLISHING')`, +        // https://github.com/gradle/gradle/issues/5696#issuecomment-396965185, +        project.tasks.withType(GenerateMavenPom.class) { GenerateMavenPom generatePOMTask ->, +            // The GenerateMavenPom task is aggressive about setting the destination, instead of fighting it,, +            // just make a copy., +            doLast {, +                project.copy {, +                    from generatePOMTask.destination, +                    into "${project.buildDir}/distributions", +                    rename { "${project.archivesBaseName}-${project.version}.pom" }, +                }, +            }, +            // build poms with assemble (if the assemble task exists), +            Task assemble = project.tasks.findByName('assemble'), +            if (assemble) {, +                assemble.dependsOn(generatePOMTask), +            }, +        }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy, +        clientJar.dependsOn(project.jar, project.tasks.generatePomFileForClientJarPublication, project.javadocJar, project.sourcesJar), +            Files.copy(, +                    project.tasks.generatePomFileForClientJarPublication.outputs.files.singleFile.toPath(),, +                    jarFile.resolveSibling(clientPomFileName),, +                    StandardCopyOption.REPLACE_EXISTING, +            ), +++ b/build.gradle, +wrapper {, +    distributionType = DistributionType.ALL, +    doLast {, +        println "Added checksum to wrapper properties", +      gradleVersion = "4.8.1" // does not default to gradle weapper of project dir, but current version, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +        // Only works with  `enableFeaturePreview('STABLE_PUBLISHING')`, +        // https://github.com/gradle/gradle/issues/5696#issuecomment-396965185, +        project.tasks.withType(GenerateMavenPom.class) { GenerateMavenPom generatePOMTask ->, +            // The GenerateMavenPom task is aggressive about setting the destination, instead of fighting it,, +            // just make a copy., +            doLast {, +                project.copy {, +                    from generatePOMTask.destination, +                    into "${project.buildDir}/distributions", +                    rename { "${project.archivesBaseName}-${project.version}.pom" }, +                }, +            }, +            // build poms with assemble (if the assemble task exists), +            Task assemble = project.tasks.findByName('assemble'), +            if (assemble) {, +                assemble.dependsOn(generatePOMTask), +            }, +        }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy, +        clientJar.dependsOn(project.jar, project.tasks.generatePomFileForClientJarPublication, project.javadocJar, project.sourcesJar), +            Files.copy(, +                    project.tasks.generatePomFileForClientJarPublication.outputs.files.singleFile.toPath(),, +                    jarFile.resolveSibling(clientPomFileName),, +                    StandardCopyOption.REPLACE_EXISTING, +            ), +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/StandaloneRestTestPlugin.groovy, +import org.gradle.api.tasks.compile.JavaCompile, +, +        project.tasks.withType(JavaCompile) {, +            // This will be the default in Gradle 5.0]