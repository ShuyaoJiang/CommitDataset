[+++ b/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java, +    private final CompletionMappingBuilder completionMappingBuilder = new CompletionMappingBuilder();, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        completionMappingBuilder.payloads(true);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        completionMappingBuilder.payloads(true);, +        createIndexAndMapping(completionMappingBuilder);, +        completionMappingBuilder.payloads(true);, +        createIndexAndMapping(completionMappingBuilder);, +        completionMappingBuilder.payloads(true);, +        createIndexAndMapping(completionMappingBuilder);, +        completionMappingBuilder.payloads(false);, +        createIndexAndMapping(completionMappingBuilder);, +        completionMappingBuilder.preserveSeparators(false);, +        createIndexAndMapping(completionMappingBuilder);, +        completionMappingBuilder.preserveSeparators(true);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        completionMappingBuilder.searchAnalyzer("classic").indexAnalyzer("classic").preservePositionIncrements(false);, +        createIndexAndMapping(completionMappingBuilder);, +        completionMappingBuilder.searchAnalyzer("suggest_analyzer_synonyms").indexAnalyzer("suggest_analyzer_synonyms");, +        createIndexAndMappingAndSettings(settingsBuilder, completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        createIndexAndMapping(completionMappingBuilder);, +        CompletionMappingBuilder completionMappingBuilder = new CompletionMappingBuilder();, +        completionMappingBuilder.preserveSeparators(true).preservePositionIncrements(true);, +        completionMappingBuilder.searchAnalyzer("stoptest");, +        completionMappingBuilder.indexAnalyzer("simple");, +        createIndexAndMappingAndSettings(settingsBuilder, completionMappingBuilder);, +        CompletionMappingBuilder completionMappingBuilder = new CompletionMappingBuilder();, +        createIndexAndMapping(completionMappingBuilder);, +    private void createIndexAndMappingAndSettings(Settings.Builder settingsBuilder, CompletionMappingBuilder completionMappingBuilder) throws IOException {, +                .field("index_analyzer", completionMappingBuilder.indexAnalyzer), +                .field("search_analyzer", completionMappingBuilder.searchAnalyzer), +                .field("payloads", completionMappingBuilder.payloads), +                .field("preserve_separators", completionMappingBuilder.preserveSeparators), +                .field("preserve_position_increments", completionMappingBuilder.preservePositionIncrements), +    private void createIndexAndMapping(CompletionMappingBuilder completionMappingBuilder) throws IOException {, +        createIndexAndMappingAndSettings(createDefaultSettings(), completionMappingBuilder);, +        createIndexAndMappingAndSettings(settingsBuilder().put(SETTING_NUMBER_OF_SHARDS, 1).put(SETTING_NUMBER_OF_REPLICAS, 0), completionMappingBuilder);, +, +    private static class CompletionMappingBuilder {, +        private String searchAnalyzer = "simple";, +        private String indexAnalyzer = "simple";, +        private Boolean payloads = getRandom().nextBoolean();, +        private Boolean preserveSeparators = getRandom().nextBoolean();, +        private Boolean preservePositionIncrements = getRandom().nextBoolean();, +, +        public CompletionMappingBuilder searchAnalyzer(String searchAnalyzer) {, +            this.searchAnalyzer = searchAnalyzer;, +            return this;, +        }, +        public CompletionMappingBuilder indexAnalyzer(String indexAnalyzer) {, +            this.indexAnalyzer = indexAnalyzer;, +            return this;, +        }, +        public CompletionMappingBuilder payloads(Boolean payloads) {, +            this.payloads = payloads;, +            return this;, +        }, +        public CompletionMappingBuilder preserveSeparators(Boolean preserveSeparators) {, +            this.preserveSeparators = preserveSeparators;, +            return this;, +        }, +        public CompletionMappingBuilder preservePositionIncrements(Boolean preservePositionIncrements) {, +            this.preservePositionIncrements = preservePositionIncrements;, +            return this;, +        }, +    }]