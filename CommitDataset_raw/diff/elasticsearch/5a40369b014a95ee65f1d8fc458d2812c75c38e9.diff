[+++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java, +import java.time.Clock;, +import java.util.stream.Collectors;, +        final Clock clock = Clock.systemUTC();, +        final List<String> tokens = Collections.synchronizedList(new ArrayList<>());, +        final Instant t1 = clock.instant();, +                    final Instant t2 = clock.instant();, +                    if (t1.plusSeconds(30L).isBefore(t2)){, +                        logger.warn("Tokens [{}], [{}] were received more than 30 seconds after the request, not checking them",, +                            result.getTokenString(), result.getRefreshToken());, +                    } else {, +                        tokens.add(result.getTokenString() + result.getRefreshToken());, +                    }, +        // Assert that we only ever got one access_token/refresh_token pair, +        assertThat(tokens.stream().distinct().collect(Collectors.toList()).size(), equalTo(1));]