[+++ b/src/main/java/org/elasticsearch/index/shard/service/InternalIndexShard.java, +    private final boolean fixIndexOnStartup;, +, +        this.fixIndexOnStartup = indexSettings.getAsBoolean("index.shard.check_on_startup_and_fix", false);, +                if (fixIndexOnStartup) {, +                    if (logger.isDebugEnabled()) {, +                        logger.debug("fixing index, writing new segments file ...");, +                    }, +                    checkIndex.fixIndex(status);, +                    if (logger.isDebugEnabled()) {, +                        logger.debug("index fixed, wrote new segments file \"{}\"", status.segmentsFileName);, +                    }, +                }]