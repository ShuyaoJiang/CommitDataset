[+++ b/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +++ b/src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastOperationAction.java, +import org.elasticsearch.ExceptionsHelper;, +import org.elasticsearch.index.IndexShardMissingException;, +import org.elasticsearch.index.shard.IllegalIndexShardStateException;, +import org.elasticsearch.indices.IndexMissingException;, +    /**, +     * Override this method to ignore specific exception, note, the result should be OR'ed with the call, +     * to super#ignoreException since there is additional logic here...., +     */, +        if (ignoreIllegalShardState()) {, +            Throwable actual = ExceptionsHelper.unwrapCause(t);, +            if (actual instanceof IllegalIndexShardStateException) {, +                return true;, +            }, +            if (actual instanceof IndexMissingException) {, +                return true;, +            }, +            if (actual instanceof IndexShardMissingException) {, +                return true;, +            }, +        }, +    /**, +     * Should non active routing shard state be ignore or node, defaults to false., +     */, +    /**, +     * Should the API ignore illegal shard state cases, for example, if the shard is actually missing on the, +     * target node (cause it hasn't been allocated there for example). Defaults to true., +     */, +    protected boolean ignoreIllegalShardState() {, +        return true;, +    }, +]