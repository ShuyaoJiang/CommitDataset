[+++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc, +* Global repositories settings have been removed. This includes `repositories.s3.bucket`,, +`repositories.s3.server_side_encryption`, `repositories.s3.buffer_size`,, +`repositories.s3.max_retries`, `repositories.s3.use_throttle_retries`,, +`repositories.s3.chunk_size`, `repositories.s3.compress`, `repositories.s3.storage_class`,, +`repositories.s3.canned_acl`, `repositories.s3.base_path`, and , +`repositories.s3.path_style_access`. Instead, these settings should be set directly in the, + settings per repository., + See {plugins}/repository-s3-repository.html[S3 Repository settings]., +* Shared client settings have been removed. This includes  `cloud.aws.access_key`,, + `cloud.aws.secret_key`, `cloud.aws.protocol`, `cloud.aws.proxy.host`,, + `cloud.aws.proxy.port`, `cloud.aws.proxy.username`, `cloud.aws.proxy.password`,, + `cloud.aws.signer`, `cloud.aws.read_timeout`, `cloud.aws.s3.access_key`,, + `cloud.aws.s3.secret_key`, `cloud.aws.s3.protocol`, `cloud.aws.s3.proxy.host`,, + `cloud.aws.s3.proxy.port`, `cloud.aws.s3.proxy.username`, `cloud.aws.s3.proxy.password`,, + `cloud.aws.s3.signer`, `cloud.aws.s3.read_timeout`, `repositories.s3.access_key`,, + `repositories.s3.secret_key`, `repositories.s3.endpoint` and `repositories.s3.protocol`., +Instead, use the new named client settings under `s3.client.CLIENT_NAME.*`., +++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc, +* Global repositories settings have been removed. This includes `repositories.s3.bucket`,, +`repositories.s3.server_side_encryption`, `repositories.s3.buffer_size`,, +`repositories.s3.max_retries`, `repositories.s3.use_throttle_retries`,, +`repositories.s3.chunk_size`, `repositories.s3.compress`, `repositories.s3.storage_class`,, +`repositories.s3.canned_acl`, `repositories.s3.base_path`, and , +`repositories.s3.path_style_access`. Instead, these settings should be set directly in the, + settings per repository., + See {plugins}/repository-s3-repository.html[S3 Repository settings]., +* Shared client settings have been removed. This includes  `cloud.aws.access_key`,, + `cloud.aws.secret_key`, `cloud.aws.protocol`, `cloud.aws.proxy.host`,, + `cloud.aws.proxy.port`, `cloud.aws.proxy.username`, `cloud.aws.proxy.password`,, + `cloud.aws.signer`, `cloud.aws.read_timeout`, `cloud.aws.s3.access_key`,, + `cloud.aws.s3.secret_key`, `cloud.aws.s3.protocol`, `cloud.aws.s3.proxy.host`,, + `cloud.aws.s3.proxy.port`, `cloud.aws.s3.proxy.username`, `cloud.aws.s3.proxy.password`,, + `cloud.aws.s3.signer`, `cloud.aws.s3.read_timeout`, `repositories.s3.access_key`,, + `repositories.s3.secret_key`, `repositories.s3.endpoint` and `repositories.s3.protocol`., +Instead, use the new named client settings under `s3.client.CLIENT_NAME.*`., +++ b/plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java, +            throw new IllegalArgumentException("Unknown s3 client name [" + clientName + "]. Existing client configs: " +, +        logger.debug("creating S3 client with client_name [{}], endpoint [{}]", clientName, clientSettings.endpoint);, +        clientConfiguration.setMaxErrorRetry(clientSettings.maxRetries);, +        clientConfiguration.setUseThrottleRetries(clientSettings.throttleRetries);, +++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc, +* Global repositories settings have been removed. This includes `repositories.s3.bucket`,, +`repositories.s3.server_side_encryption`, `repositories.s3.buffer_size`,, +`repositories.s3.max_retries`, `repositories.s3.use_throttle_retries`,, +`repositories.s3.chunk_size`, `repositories.s3.compress`, `repositories.s3.storage_class`,, +`repositories.s3.canned_acl`, `repositories.s3.base_path`, and , +`repositories.s3.path_style_access`. Instead, these settings should be set directly in the, + settings per repository., + See {plugins}/repository-s3-repository.html[S3 Repository settings]., +* Shared client settings have been removed. This includes  `cloud.aws.access_key`,, + `cloud.aws.secret_key`, `cloud.aws.protocol`, `cloud.aws.proxy.host`,, + `cloud.aws.proxy.port`, `cloud.aws.proxy.username`, `cloud.aws.proxy.password`,, + `cloud.aws.signer`, `cloud.aws.read_timeout`, `cloud.aws.s3.access_key`,, + `cloud.aws.s3.secret_key`, `cloud.aws.s3.protocol`, `cloud.aws.s3.proxy.host`,, + `cloud.aws.s3.proxy.port`, `cloud.aws.s3.proxy.username`, `cloud.aws.s3.proxy.password`,, + `cloud.aws.s3.signer`, `cloud.aws.s3.read_timeout`, `repositories.s3.access_key`,, + `repositories.s3.secret_key`, `repositories.s3.endpoint` and `repositories.s3.protocol`., +Instead, use the new named client settings under `s3.client.CLIENT_NAME.*`., +++ b/plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java, +            throw new IllegalArgumentException("Unknown s3 client name [" + clientName + "]. Existing client configs: " +, +        logger.debug("creating S3 client with client_name [{}], endpoint [{}]", clientName, clientSettings.endpoint);, +        clientConfiguration.setMaxErrorRetry(clientSettings.maxRetries);, +        clientConfiguration.setUseThrottleRetries(clientSettings.throttleRetries);, +++ b/plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3ClientSettings.java, +        key -> Setting.intSetting(key, ClientConfiguration.DEFAULT_RETRY_POLICY.getMaxErrorRetry(), 0, Property.NodeScope));, +        key -> Setting.boolSetting(key, ClientConfiguration.DEFAULT_THROTTLE_RETRIES, Property.NodeScope));, +++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc, +* Global repositories settings have been removed. This includes `repositories.s3.bucket`,, +`repositories.s3.server_side_encryption`, `repositories.s3.buffer_size`,, +`repositories.s3.max_retries`, `repositories.s3.use_throttle_retries`,, +`repositories.s3.chunk_size`, `repositories.s3.compress`, `repositories.s3.storage_class`,, +`repositories.s3.canned_acl`, `repositories.s3.base_path`, and , +`repositories.s3.path_style_access`. Instead, these settings should be set directly in the, + settings per repository., + See {plugins}/repository-s3-repository.html[S3 Repository settings]., +* Shared client settings have been removed. This includes  `cloud.aws.access_key`,, + `cloud.aws.secret_key`, `cloud.aws.protocol`, `cloud.aws.proxy.host`,, + `cloud.aws.proxy.port`, `cloud.aws.proxy.username`, `cloud.aws.proxy.password`,, + `cloud.aws.signer`, `cloud.aws.read_timeout`, `cloud.aws.s3.access_key`,, + `cloud.aws.s3.secret_key`, `cloud.aws.s3.protocol`, `cloud.aws.s3.proxy.host`,, + `cloud.aws.s3.proxy.port`, `cloud.aws.s3.proxy.username`, `cloud.aws.s3.proxy.password`,, + `cloud.aws.s3.signer`, `cloud.aws.s3.read_timeout`, `repositories.s3.access_key`,, + `repositories.s3.secret_key`, `repositories.s3.endpoint` and `repositories.s3.protocol`., +Instead, use the new named client settings under `s3.client.CLIENT_NAME.*`., +++ b/plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java, +            throw new IllegalArgumentException("Unknown s3 client name [" + clientName + "]. Existing client configs: " +, +        logger.debug("creating S3 client with client_name [{}], endpoint [{}]", clientName, clientSettings.endpoint);, +        clientConfiguration.setMaxErrorRetry(clientSettings.maxRetries);, +        clientConfiguration.setUseThrottleRetries(clientSettings.throttleRetries);, +++ b/plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3ClientSettings.java, +        key -> Setting.intSetting(key, ClientConfiguration.DEFAULT_RETRY_POLICY.getMaxErrorRetry(), 0, Property.NodeScope));, +        key -> Setting.boolSetting(key, ClientConfiguration.DEFAULT_THROTTLE_RETRIES, Property.NodeScope));, +++ b/plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java, +    static final String TYPE = "s3";, +    private static final ByteSizeValue DEFAULT_BUFFER_SIZE = new ByteSizeValue(, +, +    static final Setting<String> BUCKET_SETTING = Setting.simpleString("bucket");, +, +     * When set to true files are encrypted on server side using AES256 algorithm.]