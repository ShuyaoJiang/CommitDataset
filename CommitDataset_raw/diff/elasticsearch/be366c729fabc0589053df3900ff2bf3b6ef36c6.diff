[+++ b/core/src/main/java/org/elasticsearch/plugins/PluginsService.java, +import org.apache.lucene.analysis.util.CharFilterFactory;, +import org.apache.lucene.analysis.util.TokenFilterFactory;, +import org.apache.lucene.analysis.util.TokenizerFactory;, +import org.apache.lucene.codecs.Codec;, +import org.apache.lucene.codecs.DocValuesFormat;, +import org.apache.lucene.codecs.PostingsFormat;, +                    // reload lucene SPI with any new services from the plugin, +                    reloadLuceneSPI(loader);, +    /**, +     * Reloads all Lucene SPI implementations using the new classloader., +     * This method must be called after the new classloader has been created to, +     * register the services for use., +     */, +    static void reloadLuceneSPI(ClassLoader loader) {, +        // do NOT change the order of these method calls!, +, +        // Codecs:, +        PostingsFormat.reloadPostingsFormats(loader);, +        DocValuesFormat.reloadDocValuesFormats(loader);, +        Codec.reloadCodecs(loader);, +        // Analysis:, +        CharFilterFactory.reloadCharFilters(loader);, +        TokenFilterFactory.reloadTokenFilters(loader);, +        TokenizerFactory.reloadTokenizers(loader);, +    }, +]