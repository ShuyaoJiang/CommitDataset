[+++ b/src/test/java/org/elasticsearch/cluster/metadata/MetaDataTests.java, +                .put(indexBuilder("foofoo-closed").state(IndexMetaData.State.CLOSE)), +        IndicesOptions[] indicesOptions = new IndicesOptions[]{ IndicesOptions.strictExpandOpen(), IndicesOptions.strictExpand()};, +        for (IndicesOptions options : indicesOptions) {, +            String[] results = md.concreteIndices(new String[]{"foo"}, options);, +        String[] results = md.concreteIndices(Strings.EMPTY_ARRAY, IndicesOptions.strictExpandOpen());, +        assertEquals(3, results.length);, +, +        results = md.concreteIndices(Strings.EMPTY_ARRAY, IndicesOptions.strictExpand());, +        assertEquals(4, results.length);, +, +        results = md.concreteIndices(new String[]{"foofoo*"}, IndicesOptions.strictExpandOpen());, +        assertEquals(1, results.length);, +        assertEquals("foofoo", results[0]);, +, +        results = md.concreteIndices(new String[]{"foofoo*"}, IndicesOptions.strictExpand());, +        assertEquals(2, results.length);, +        assertThat(results, arrayContainingInAnyOrder("foofoo", "foofoo-closed"));, +    }, +, +                .put(indexBuilder("foofoo-closed").state(IndexMetaData.State.CLOSE)), +        IndicesOptions lenientExpand = IndicesOptions.fromOptions(true, true, true, true);, +        IndicesOptions[] indicesOptions = new IndicesOptions[]{ IndicesOptions.lenientExpandOpen(), lenientExpand};, +        for (IndicesOptions options : indicesOptions) {, +            String[] results = md.concreteIndices(new String[]{"foo"}, options);, +        String[] results = md.concreteIndices(Strings.EMPTY_ARRAY, IndicesOptions.lenientExpandOpen());, +        assertEquals(3, results.length);, +, +        results = md.concreteIndices(Strings.EMPTY_ARRAY, lenientExpand);, +        assertEquals(4, results.length);, +, +        results = md.concreteIndices(new String[]{"foofoo*"}, IndicesOptions.lenientExpandOpen());, +        assertEquals(1, results.length);, +        assertEquals("foofoo", results[0]);, +, +        results = md.concreteIndices(new String[]{"foofoo*"}, lenientExpand);, +        assertEquals(2, results.length);, +        assertThat(results, arrayContainingInAnyOrder("foofoo", "foofoo-closed"));, +    }, +, +    public void testIndexOptions_allowUnavailableDisallowEmpty() {, +                .put(indexBuilder("foofoo-closed").state(IndexMetaData.State.CLOSE)), +        IndicesOptions expandOpen = IndicesOptions.fromOptions(true, false, true, false);, +        IndicesOptions expand = IndicesOptions.fromOptions(true, false, true, true);, +        IndicesOptions[] indicesOptions = new IndicesOptions[]{expandOpen, expand};, +        for (IndicesOptions options : indicesOptions) {, +            String[] results = md.concreteIndices(new String[]{"foo"}, options);, +        String[] results = md.concreteIndices(Strings.EMPTY_ARRAY, expandOpen);, +        assertEquals(3, results.length);, +, +        results = md.concreteIndices(Strings.EMPTY_ARRAY, expand);, +        assertEquals(4, results.length);, +    }, +]