[+++ b/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java, +        KeyStoreWrapper keystore = KeyStoreWrapper.create();, +        keystore.save(env.v2().configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java, +        KeyStoreWrapper keystore = KeyStoreWrapper.create();, +        keystore.save(env.v2().configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +            KeyStoreWrapper.upgrade(keystore, initialEnv.configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java, +        KeyStoreWrapper keystore = KeyStoreWrapper.create();, +        keystore.save(env.v2().configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +            KeyStoreWrapper.upgrade(keystore, initialEnv.configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/common/settings/AddFileKeyStoreCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0] /* always use empty passphrase for auto created keystore */);, +        keystore.save(env.configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java, +        KeyStoreWrapper keystore = KeyStoreWrapper.create();, +        keystore.save(env.v2().configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +            KeyStoreWrapper.upgrade(keystore, initialEnv.configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/common/settings/AddFileKeyStoreCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0] /* always use empty passphrase for auto created keystore */);, +        keystore.save(env.configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0] /* always use empty passphrase for auto created keystore */);, +        keystore.save(env.configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java, +        KeyStoreWrapper keystore = KeyStoreWrapper.create();, +        keystore.save(env.v2().configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +            KeyStoreWrapper.upgrade(keystore, initialEnv.configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/common/settings/AddFileKeyStoreCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0] /* always use empty passphrase for auto created keystore */);, +        keystore.save(env.configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0] /* always use empty passphrase for auto created keystore */);, +        keystore.save(env.configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/common/settings/CreateKeyStoreCommand.java, +        KeyStoreWrapper keystore = KeyStoreWrapper.create();, +        keystore.save(env.configFile(), password);, +++ b/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0]);, +++ b/distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java, +        KeyStoreWrapper keystore = KeyStoreWrapper.create();, +        keystore.save(env.v2().configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +            KeyStoreWrapper.upgrade(keystore, initialEnv.configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/common/settings/AddFileKeyStoreCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0] /* always use empty passphrase for auto created keystore */);, +        keystore.save(env.configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java, +            keystore = KeyStoreWrapper.create();, +            keystore.save(env.configFile(), new char[0] /* always use empty passphrase for auto created keystore */);, +        keystore.save(env.configFile(), new char[0]);, +++ b/server/src/main/java/org/elasticsearch/common/settings/CreateKeyStoreCommand.java, +        KeyStoreWrapper keystore = KeyStoreWrapper.create();, +        keystore.save(env.configFile(), password);, +++ b/server/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java, +import javax.crypto.Cipher;, +import javax.crypto.CipherInputStream;, +import javax.crypto.CipherOutputStream;, +import javax.crypto.spec.GCMParameterSpec;, +import javax.crypto.spec.SecretKeySpec;, +import java.io.DataInputStream;, +import java.io.DataOutputStream;, +import java.nio.ByteBuffer;, + * A disk based container for sensitive settings in Elasticsearch., + * in a single thread. Once decrypted, settings may be read in multiple threads., +    /** An identifier for the type of data that may be stored in a keystore entry. */, +    private enum EntryType {, +        STRING,, +        FILE, +    }, +]