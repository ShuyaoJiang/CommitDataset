[+++ b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java, +        final Set<IndexShardRoutingTable> shards = computeTargetedShards(clusterState, indices, concreteIndices, routing);, +        return shards.size();, +, +    @Override, +    public GroupShardsIterator searchShards(ClusterState clusterState, String[] indices, String[] concreteIndices, @Nullable Map<String, Set<String>> routing, @Nullable String preference) throws IndexMissingException {, +        final Set<IndexShardRoutingTable> shards = computeTargetedShards(clusterState, indices, concreteIndices, routing);, +        final Set<ShardIterator> set = new HashSet<ShardIterator>(shards.size());, +        for (IndexShardRoutingTable shard : shards) {, +            ShardIterator iterator = preferenceActiveShardIterator(shard, clusterState.nodes().localNodeId(), clusterState.nodes(), preference);, +            if (iterator != null) {, +                set.add(iterator);, +        return new GroupShardsIterator(set);, +    private Set<IndexShardRoutingTable> computeTargetedShards(ClusterState clusterState, String[] indices, String[] concreteIndices, @Nullable Map<String, Set<String>> routing) throws IndexMissingException {, +        final Set<IndexShardRoutingTable> set = new HashSet<IndexShardRoutingTable>();, +                    set.add(indexShard);, +                    set.add(indexShard);, +        return set;]