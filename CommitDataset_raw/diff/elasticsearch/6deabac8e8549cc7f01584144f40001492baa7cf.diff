[+++ b/core/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +            private final Weight innerFilter;, +            public Nested(BitSetProducer rootFilter, Weight innerFilter) {, +                this.innerFilter = innerFilter;, +                Scorer s = innerFilter.scorer(ctx);, +++ b/core/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +            private final Weight innerFilter;, +            public Nested(BitSetProducer rootFilter, Weight innerFilter) {, +                this.innerFilter = innerFilter;, +                Scorer s = innerFilter.scorer(ctx);, +++ b/core/src/main/java/org/elasticsearch/index/query/support/NestedInnerQueryParseSupport.java, +import org.elasticsearch.search.internal.SearchContext;, +    public NestedInnerQueryParseSupport(XContentParser parser, SearchContext searchContext) {, +        shardContext = searchContext.getQueryShardContext();, +++ b/core/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +            private final Weight innerFilter;, +            public Nested(BitSetProducer rootFilter, Weight innerFilter) {, +                this.innerFilter = innerFilter;, +                Scorer s = innerFilter.scorer(ctx);, +++ b/core/src/main/java/org/elasticsearch/index/query/support/NestedInnerQueryParseSupport.java, +import org.elasticsearch.search.internal.SearchContext;, +    public NestedInnerQueryParseSupport(XContentParser parser, SearchContext searchContext) {, +        shardContext = searchContext.getQueryShardContext();, +++ b/core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java, +public class FieldSortBuilder extends SortBuilder {, +    private SortOrder order;, +, +     * The order of sorting. Defaults to {@link SortOrder#ASC}., +     */, +    @Override, +    public FieldSortBuilder order(SortOrder order) {, +        this.order = order;, +        return this;, +    }, +, +    /**, +        if (order != null) {, +            builder.field("order", order.toString());, +        }, +++ b/core/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +            private final Weight innerFilter;, +            public Nested(BitSetProducer rootFilter, Weight innerFilter) {, +                this.innerFilter = innerFilter;, +                Scorer s = innerFilter.scorer(ctx);, +++ b/core/src/main/java/org/elasticsearch/index/query/support/NestedInnerQueryParseSupport.java, +import org.elasticsearch.search.internal.SearchContext;, +    public NestedInnerQueryParseSupport(XContentParser parser, SearchContext searchContext) {, +        shardContext = searchContext.getQueryShardContext();, +++ b/core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java, +public class FieldSortBuilder extends SortBuilder {, +    private SortOrder order;, +, +     * The order of sorting. Defaults to {@link SortOrder#ASC}., +     */, +    @Override, +    public FieldSortBuilder order(SortOrder order) {, +        this.order = order;, +        return this;, +    }, +, +    /**, +        if (order != null) {, +            builder.field("order", order.toString());, +        }, +++ b/core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java, +public class GeoDistanceSortBuilder extends SortBuilder, +    private SortOrder order = SortOrder.ASC;, +     * The order of sorting. Defaults to {@link SortOrder#ASC}., +     */, +    @Override, +    public GeoDistanceSortBuilder order(SortOrder order) {, +        this.order = order;, +        return this;, +    }, +, +    /** Returns the order of sorting. */, +    public SortOrder order() { , +        return this.order;, +    }, +, +    /**, +    public GeoDistanceSortBuilder setNestedFilter(QueryBuilder nestedFilter) {, +    public QueryBuilder getNestedFilter() {, +        if (order == SortOrder.DESC) {, +            builder.field("reverse", true);, +        } else {, +            builder.field("reverse", false);, +        }, +        boolean reverse = false;, +        QueryBuilder nestedFilter = null;, +                    reverse = parser.booleanValue();, +                    reverse = "desc".equals(parser.text());, +        if (reverse) {, +            result.order(SortOrder.DESC);, +        } else {, +            result.order(SortOrder.ASC);, +        }, +++ b/core/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +            private final Weight innerFilter;, +            public Nested(BitSetProducer rootFilter, Weight innerFilter) {]