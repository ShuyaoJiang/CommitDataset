[+++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (index.equals(".") || index.equals("..")) {, +            throw new InvalidIndexNameException(new Index(index), index, "must not be '.' or '..'");, +        }, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (index.equals(".") || index.equals("..")) {, +            throw new InvalidIndexNameException(new Index(index), index, "must not be '.' or '..'");, +        }, +++ b/core/src/main/java/org/elasticsearch/common/hash/MessageDigests.java, +        return clone(MD5_DIGEST);, +        return clone(SHA_1_DIGEST);, +        return clone(SHA_256_DIGEST);, +    private static MessageDigest clone(MessageDigest messageDigest) {, +            return (MessageDigest) messageDigest.clone();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (index.equals(".") || index.equals("..")) {, +            throw new InvalidIndexNameException(new Index(index), index, "must not be '.' or '..'");, +        }, +++ b/core/src/main/java/org/elasticsearch/common/hash/MessageDigests.java, +        return clone(MD5_DIGEST);, +        return clone(SHA_1_DIGEST);, +        return clone(SHA_256_DIGEST);, +    private static MessageDigest clone(MessageDigest messageDigest) {, +            return (MessageDigest) messageDigest.clone();, +++ b/core/src/test/java/org/elasticsearch/common/hash/MessageDigestsTests.java, +            String zeros = new String(new char[2 * bytes.length]).replace("\0", "0");, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (index.equals(".") || index.equals("..")) {, +            throw new InvalidIndexNameException(new Index(index), index, "must not be '.' or '..'");, +        }, +++ b/core/src/main/java/org/elasticsearch/common/hash/MessageDigests.java, +        return clone(MD5_DIGEST);, +        return clone(SHA_1_DIGEST);, +        return clone(SHA_256_DIGEST);, +    private static MessageDigest clone(MessageDigest messageDigest) {, +            return (MessageDigest) messageDigest.clone();, +++ b/core/src/test/java/org/elasticsearch/common/hash/MessageDigestsTests.java, +            String zeros = new String(new char[2 * bytes.length]).replace("\0", "0");, +++ b/core/src/test/java/org/elasticsearch/indexing/IndexActionIT.java, +    }, +, +    public void testInvalidIndexName() {, +        try {, +            createIndex(".");, +            fail("exception should have been thrown on dot index name");, +        } catch (InvalidIndexNameException e) {, +            assertThat("exception contains message about index name is dot " + e.getMessage(),, +                    e.getMessage().contains("Invalid index name [.], must not be \'.\' or '..'"), equalTo(true));, +        }, +, +        try {, +            createIndex("..");, +            fail("exception should have been thrown on dot index name");, +        } catch (InvalidIndexNameException e) {, +            assertThat("exception contains message about index name is dot " + e.getMessage(),, +                    e.getMessage().contains("Invalid index name [..], must not be \'.\' or '..'"), equalTo(true));, +        }]