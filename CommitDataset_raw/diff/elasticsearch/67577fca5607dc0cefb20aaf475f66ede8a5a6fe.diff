[+++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsAggregator.java, +                        if (i > 0 && previous.get().equals(bytes)) {, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsAggregator.java, +                        if (i > 0 && previous.get().equals(bytes)) {, +++ b/server/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java, +                document.add(new SortedSetDocValuesField("string", new BytesRef("")));, +                document = new Document();, +                document.add(new SortedSetDocValuesField("string", new BytesRef("")));, +                indexWriter.addDocument(document);, +                        assertEquals(5, result.getBuckets().size());, +                        assertEquals("", result.getBuckets().get(0).getKeyAsString());, +                        assertEquals("a", result.getBuckets().get(1).getKeyAsString());, +                        assertEquals("b", result.getBuckets().get(2).getKeyAsString());, +                        assertEquals(2L, result.getBuckets().get(2).getDocCount());, +                        assertEquals("c", result.getBuckets().get(3).getKeyAsString());, +                        assertEquals("d", result.getBuckets().get(4).getKeyAsString());, +                        assertEquals(1L, result.getBuckets().get(4).getDocCount());]