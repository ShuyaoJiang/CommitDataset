[+++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java, +        Iterable<MutableShardRouting> assignedShards = allocation.routingNodes().assignedShards(shardRouting);, +        for (MutableShardRouting assignedShard : assignedShards) {, +            if (node.nodeId().equals(assignedShard.currentNodeId())) {, +                    for (MutableShardRouting assignedShard : assignedShards) {, +                        if (checkNode.nodeId().equals(assignedShard.currentNodeId())) {]