[+++ b/src/test/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java, +import org.elasticsearch.action.ShardOperationFailedException;, +import org.elasticsearch.action.search.ShardSearchFailure;, +import static org.junit.Assert.fail;, +        if (searchResponse.getHits().totalHits() != expectedHitCount) {, +            String msg = "Hit count is " + searchResponse.getHits().totalHits() + " but " + expectedHitCount + " was expected. " +, +                    searchResponse.getFailedShards() + " shard failures:";, +            for (ShardSearchFailure failure : searchResponse.getShardFailures()) {, +                msg += "\n " + failure.toString();, +            }, +            fail(msg);, +        }, +        if (countResponse.getCount() != expectedHitCount) {, +            String msg = "Count is " + countResponse.getCount() + " but " + expectedHitCount + " was expected. " +, +                    countResponse.getFailedShards() + " shard failures:";, +            for (ShardOperationFailedException failure : countResponse.getShardFailures()) {, +                msg += "\n " + failure.toString();, +            }, +            fail(msg);, +        }, +++ b/src/test/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java, +import org.elasticsearch.action.ShardOperationFailedException;, +import org.elasticsearch.action.search.ShardSearchFailure;, +import static org.junit.Assert.fail;, +        if (searchResponse.getHits().totalHits() != expectedHitCount) {, +            String msg = "Hit count is " + searchResponse.getHits().totalHits() + " but " + expectedHitCount + " was expected. " +, +                    searchResponse.getFailedShards() + " shard failures:";, +            for (ShardSearchFailure failure : searchResponse.getShardFailures()) {, +                msg += "\n " + failure.toString();, +            }, +            fail(msg);, +        }, +        if (countResponse.getCount() != expectedHitCount) {, +            String msg = "Count is " + countResponse.getCount() + " but " + expectedHitCount + " was expected. " +, +                    countResponse.getFailedShards() + " shard failures:";, +            for (ShardOperationFailedException failure : countResponse.getShardFailures()) {, +                msg += "\n " + failure.toString();, +            }, +            fail(msg);, +        }, +++ b/src/test/java/org/elasticsearch/test/integration/indices/settings/UpdateNumberOfReplicasTests.java, +                    .endObject()).get();, +            CountResponse countResponse = client().prepareCount().setQuery(matchAllQuery()).get();, +            assertHitCount(countResponse, 10l);, +            CountResponse countResponse = client().prepareCount().setQuery(matchAllQuery()).get();, +            assertHitCount(countResponse, 10l);, +        client().admin().indices().prepareUpdateSettings("test").setSettings(settingsBuilder().put("index.number_of_replicas", 0)).get();, +            assertHitCount(client().prepareSearch().setQuery(matchAllQuery()).get(), 10);]