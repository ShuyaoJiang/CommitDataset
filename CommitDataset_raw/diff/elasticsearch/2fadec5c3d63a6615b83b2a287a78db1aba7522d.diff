[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +        public static final int DEFAULT_AGGREGATION_CHUNKING_BUCKETS = 1000;, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +        public static final int DEFAULT_AGGREGATION_CHUNKING_BUCKETS = 1000;, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/extractor/ExtractorUtils.java, +    public static long validateAndGetCalendarInterval(String calendarInterval) {, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +        public static final int DEFAULT_AGGREGATION_CHUNKING_BUCKETS = 1000;, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/extractor/ExtractorUtils.java, +    public static long validateAndGetCalendarInterval(String calendarInterval) {, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/rollup/action/RollupSearchAction.java, +    public static class RequestBuilder extends ActionRequestBuilder<SearchRequest, SearchResponse> {, +        public RequestBuilder(ElasticsearchClient client, SearchRequest searchRequest) {, +            super(client, INSTANCE, searchRequest);, +        }, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +        public static final int DEFAULT_AGGREGATION_CHUNKING_BUCKETS = 1000;, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/extractor/ExtractorUtils.java, +    public static long validateAndGetCalendarInterval(String calendarInterval) {, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/rollup/action/RollupSearchAction.java, +    public static class RequestBuilder extends ActionRequestBuilder<SearchRequest, SearchResponse> {, +        public RequestBuilder(ElasticsearchClient client, SearchRequest searchRequest) {, +            super(client, INSTANCE, searchRequest);, +        }, +, +++ b/x-pack/plugin/ml/qa/native-multi-node-tests/src/test/java/org/elasticsearch/xpack/ml/integration/DatafeedJobsRestIT.java, +import org.elasticsearch.xpack.core.rollup.job.RollupJob;, +import java.util.concurrent.TimeUnit;, +    private void setupFullAccessRole(String index) throws IOException {, +        Request request = new Request("PUT", "/_xpack/security/role/test_data_access");, +        request.setJsonEntity("{", +            + "  \"indices\" : [", +            + "    { \"names\": [\"" + index + "\"], \"privileges\": [\"all\"] }", +            + "  ]", +            + "}");, +        client().performRequest(request);, +    }, +, +                containsString("user ml_admin lacks permissions on the indices"));, +    }, +, +    public void testInsufficientSearchPrivilegesOnPutWithRollup() throws Exception {, +        setupDataAccessRole("airline-data-aggs-rollup");, +        String jobId = "privs-put-job-rollup";, +        Request createJobRequest = new Request("PUT", MachineLearning.BASE_PATH + "anomaly_detectors/" + jobId);, +        createJobRequest.setJsonEntity("{\n", +            + "  \"description\": \"Aggs job\",\n", +            + "  \"analysis_config\": {\n", +            + "    \"bucket_span\": \"1h\",\n", +            + "    \"summary_count_field_name\": \"doc_count\",\n", +            + "    \"detectors\": [\n", +            + "      {\n", +            + "        \"function\": \"mean\",\n", +            + "        \"field_name\": \"responsetime\",\n", +            + "        \"by_field_name\": \"airline\"\n", +            + "      }\n", +            + "    ]\n", +            + "  },\n", +            + "  \"data_description\": {\"time_field\": \"time stamp\"}\n", +            + "}");, +        client().performRequest(createJobRequest);, +, +        String rollupJobId = "rollup-" + jobId;, +        Request createRollupRequest = new Request("PUT", "/_xpack/rollup/job/" + rollupJobId);, +        createRollupRequest.setJsonEntity("{\n", +            + "\"index_pattern\": \"airline-data-aggs\",\n", +            + "    \"rollup_index\": \"airline-data-aggs-rollup\",\n", +            + "    \"cron\": \"*/30 * * * * ?\",\n", +            + "    \"page_size\" :1000,\n", +            + "    \"groups\" : {\n", +            + "      \"date_histogram\": {\n", +            + "        \"field\": \"time stamp\",\n", +            + "        \"interval\": \"2m\",\n", +            + "        \"delay\": \"7d\"\n", +            + "      },\n", +            + "      \"terms\": {\n", +            + "        \"fields\": [\"airline\"]\n", +            + "      }", +            + "    },\n", +            + "    \"metrics\": [\n", +            + "        {\n", +            + "            \"field\": \"responsetime\",\n", +            + "            \"metrics\": [\"avg\",\"min\",\"max\",\"sum\"]\n", +            + "        },\n", +            + "        {\n", +            + "            \"field\": \"time stamp\",\n", +            + "            \"metrics\": [\"min\",\"max\"]\n", +            + "        }\n", +            + "    ]\n", +            + "}");, +        client().performRequest(createRollupRequest);, +, +        String datafeedId = "datafeed-" + jobId;, +        String aggregations = "{\"buckets\":{\"date_histogram\":{\"field\":\"time stamp\",\"interval\":3600000},", +            + "\"aggregations\":{", +            + "\"time stamp\":{\"max\":{\"field\":\"time stamp\"}},", +            + "\"responsetime\":{\"avg\":{\"field\":\"responsetime\"}}}}}";, +, +]