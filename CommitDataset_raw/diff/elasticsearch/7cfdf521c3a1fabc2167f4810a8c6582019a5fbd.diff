[+++ b/src/main/java/org/elasticsearch/shield/ssl/AbstractSSLService.java, +import org.elasticsearch.ElasticsearchException;, +import org.elasticsearch.shield.ShieldSettingsException;, +import java.util.ArrayList;, +import java.util.LinkedList;, +import java.util.List;, +            sslEngine.setEnabledCipherSuites(supportedCiphers(sslEngine.getSupportedCipherSuites(), ciphers));, +        } catch (ElasticsearchException e) {, +            throw e;, +    String[] supportedCiphers(String[] supportedCiphers, String[] requestedCiphers) {, +        List<String> requestedCiphersList = new ArrayList<>(requestedCiphers.length);, +        List<String> unsupportedCiphers = new LinkedList<>();, +        boolean found;, +        for (String requestedCipher : requestedCiphers) {, +            found = false;, +            for (String supportedCipher : supportedCiphers) {, +                if (supportedCipher.equals(requestedCipher)) {, +                    found = true;, +                    requestedCiphersList.add(requestedCipher);, +                    break;, +                }, +            }, +, +            if (!found) {, +                unsupportedCiphers.add(requestedCipher);, +            }, +        }, +, +        if (requestedCiphersList.isEmpty()) {, +            throw new ShieldSettingsException("none of the ciphers [" + Arrays.asList(requestedCiphers) + "] are supported by this JVM");, +        }, +, +        if (!unsupportedCiphers.isEmpty()) {, +            logger.error("unsupported ciphers [{}] were requested but cannot be used in this JVM. If you are trying to use ciphers\n" +, +                    "with a key length greater than 128 bits on an Oracle JVM, you will need to install the unlimited strength\n" +, +                    "JCE policy files. Additionally, please ensure the PKCS11 provider is enabled for your JVM.", unsupportedCiphers);, +        }, +, +        return requestedCiphersList.toArray(new String[requestedCiphersList.size()]);, +    }, +, +++ b/src/main/java/org/elasticsearch/shield/ssl/AbstractSSLService.java, +import org.elasticsearch.ElasticsearchException;, +import org.elasticsearch.shield.ShieldSettingsException;, +import java.util.ArrayList;, +import java.util.LinkedList;, +import java.util.List;, +            sslEngine.setEnabledCipherSuites(supportedCiphers(sslEngine.getSupportedCipherSuites(), ciphers));, +        } catch (ElasticsearchException e) {, +            throw e;, +    String[] supportedCiphers(String[] supportedCiphers, String[] requestedCiphers) {, +        List<String> requestedCiphersList = new ArrayList<>(requestedCiphers.length);, +        List<String> unsupportedCiphers = new LinkedList<>();, +        boolean found;, +        for (String requestedCipher : requestedCiphers) {, +            found = false;, +            for (String supportedCipher : supportedCiphers) {, +                if (supportedCipher.equals(requestedCipher)) {, +                    found = true;, +                    requestedCiphersList.add(requestedCipher);, +                    break;, +                }, +            }, +, +            if (!found) {, +                unsupportedCiphers.add(requestedCipher);, +            }, +        }, +, +        if (requestedCiphersList.isEmpty()) {, +            throw new ShieldSettingsException("none of the ciphers [" + Arrays.asList(requestedCiphers) + "] are supported by this JVM");, +        }, +, +        if (!unsupportedCiphers.isEmpty()) {, +            logger.error("unsupported ciphers [{}] were requested but cannot be used in this JVM. If you are trying to use ciphers\n" +, +                    "with a key length greater than 128 bits on an Oracle JVM, you will need to install the unlimited strength\n" +, +                    "JCE policy files. Additionally, please ensure the PKCS11 provider is enabled for your JVM.", unsupportedCiphers);, +        }, +, +        return requestedCiphersList.toArray(new String[requestedCiphersList.size()]);, +    }, +, +++ b/src/test/java/org/elasticsearch/shield/ssl/ClientSSLServiceTests.java, +import java.util.ArrayList;, +import java.util.List;, +, +    @Test, +    public void validCiphersAndInvalidCiphersWork() throws Exception {, +        List<String> ciphers = new ArrayList<>(Arrays.asList(AbstractSSLService.DEFAULT_CIPHERS));, +        ciphers.add("foo");, +        ciphers.add("bar");, +        ClientSSLService sslService = new ClientSSLService(settingsBuilder(), +                .putArray("shield.ssl.ciphers", ciphers.toArray(new String[ciphers.size()])), +                .build());, +        SSLEngine engine = sslService.createSSLEngine();, +        assertThat(engine, is(notNullValue()));, +        String[] enabledCiphers = engine.getEnabledCipherSuites();, +        assertThat(Arrays.asList(enabledCiphers), not(contains("foo", "bar")));, +    }, +]