[+++ b/src/test/java/org/elasticsearch/recovery/RecoveryWhileUnderLoadTests.java, +    @Test @TestLogging("action.search.type:TRACE,action.admin.indices.refresh:TRACE"), +    @Test @TestLogging("action.search.type:TRACE,action.admin.indices.refresh:TRACE"), +    private void iterateAssertCount(final int numberOfShards, final long numberOfDocs, final int iterations) throws Exception {, +                logger.info("shard [{}] - count {}, primary {}", shardStats.getShardId(), docsStats.getCount(), shardStats.getShardRouting().primary());, +                    boolean error = false;, +                    for (int i = 0; i < iterations; i++) {, +                        if (searchResponse.getHits().totalHits() != numberOfDocs) {, +                            error = true;, +                    }, +                    return !error;, +                }, +            }, 5, TimeUnit.MINUTES), equalTo(true));]