[+++ b/src/main/java/org/elasticsearch/discovery/Discovery.java, +import org.elasticsearch.common.inject.internal.Nullable;, +import org.elasticsearch.node.service.NodeService;, +     * Here as a hack to solve dep injection problem..., +     */, +    void setNodeService(@Nullable NodeService nodeService);, +, +    /**, +++ b/src/main/java/org/elasticsearch/discovery/Discovery.java, +import org.elasticsearch.common.inject.internal.Nullable;, +import org.elasticsearch.node.service.NodeService;, +     * Here as a hack to solve dep injection problem..., +     */, +    void setNodeService(@Nullable NodeService nodeService);, +, +    /**, +++ b/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java, +import org.elasticsearch.common.inject.internal.Nullable;, +import org.elasticsearch.node.service.NodeService;, +    public void setNodeService(@Nullable NodeService nodeService) {, +        // nothing to do here, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/discovery/Discovery.java, +import org.elasticsearch.common.inject.internal.Nullable;, +import org.elasticsearch.node.service.NodeService;, +     * Here as a hack to solve dep injection problem..., +     */, +    void setNodeService(@Nullable NodeService nodeService);, +, +    /**, +++ b/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java, +import org.elasticsearch.common.inject.internal.Nullable;, +import org.elasticsearch.node.service.NodeService;, +    public void setNodeService(@Nullable NodeService nodeService) {, +        // nothing to do here, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java, +    @Override, +++ b/src/main/java/org/elasticsearch/discovery/Discovery.java, +import org.elasticsearch.common.inject.internal.Nullable;, +import org.elasticsearch.node.service.NodeService;, +     * Here as a hack to solve dep injection problem..., +     */, +    void setNodeService(@Nullable NodeService nodeService);, +, +    /**, +++ b/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java, +import org.elasticsearch.common.inject.internal.Nullable;, +import org.elasticsearch.node.service.NodeService;, +    public void setNodeService(@Nullable NodeService nodeService) {, +        // nothing to do here, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java, +    @Override, +++ b/src/main/java/org/elasticsearch/node/service/NodeService.java, +import org.elasticsearch.discovery.Discovery;, +    public NodeService(Settings settings, MonitorService monitorService, Discovery discovery, ClusterService clusterService, TransportService transportService, IndicesService indicesService) {, +        discovery.setNodeService(this);]