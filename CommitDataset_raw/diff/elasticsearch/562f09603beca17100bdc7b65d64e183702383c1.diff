[+++ b/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +        Path pluginZip = download(terminal, pluginId, env.tmpFile(), isBatch);, +    private Path download(Terminal terminal, String pluginId, Path tmpDir, boolean isBatch) throws Exception {, +            return downloadAndValidate(terminal, url, tmpDir, true, isBatch);, +            return downloadAndValidate(terminal, mavenUrl, tmpDir, false, isBatch);, +        return downloadZip(terminal, pluginId, tmpDir, isBatch);, +    Path downloadZip(Terminal terminal, String urlString, Path tmpDir, boolean isBatch) throws IOException {, +        try (InputStream in = isBatch ? urlConnection.getInputStream() :, +            new TerminalProgressInputStream(urlConnection.getInputStream(),urlConnection.getContentLength(),terminal)) {, +     * @param isBatch        true if the install is running in batch mode, +        final boolean officialPlugin, boolean isBatch) throws IOException, PGPException, UserException {, +        Path zip = downloadZip(terminal, urlString, tmpDir, isBatch);, +++ b/distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +        Path pluginZip = download(terminal, pluginId, env.tmpFile(), isBatch);, +    private Path download(Terminal terminal, String pluginId, Path tmpDir, boolean isBatch) throws Exception {, +            return downloadAndValidate(terminal, url, tmpDir, true, isBatch);, +            return downloadAndValidate(terminal, mavenUrl, tmpDir, false, isBatch);, +        return downloadZip(terminal, pluginId, tmpDir, isBatch);, +    Path downloadZip(Terminal terminal, String urlString, Path tmpDir, boolean isBatch) throws IOException {, +        try (InputStream in = isBatch ? urlConnection.getInputStream() :, +            new TerminalProgressInputStream(urlConnection.getInputStream(),urlConnection.getContentLength(),terminal)) {, +     * @param isBatch        true if the install is running in batch mode, +        final boolean officialPlugin, boolean isBatch) throws IOException, PGPException, UserException {, +        Path zip = downloadZip(terminal, urlString, tmpDir, isBatch);, +++ b/distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java, +        assertThat(terminal.getOutput(), containsString("-> Downloading"));, +        // No progress bar in batch mode, +        assertThat(terminal.getOutput(), not(containsString("100%")));, +            Path downloadZip(Terminal terminal, String urlString, Path tmpDir, boolean isBatch) throws IOException {]