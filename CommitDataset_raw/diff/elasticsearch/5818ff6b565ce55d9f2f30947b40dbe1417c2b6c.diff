[+++ b/core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java, +        return "shard [" + (shardTarget == null ? "_na" : shardTarget) + "], reason [" + reason + "], cause [" +, +                (cause == null ? "_na" : ExceptionsHelper.stackTrace(cause)) + "]";, +        SearchShardTarget searchShardTarget = null;, +        if (nodeId != null) {, +            searchShardTarget = new SearchShardTarget(nodeId,, +                    new ShardId(new Index(indexName, IndexMetaData.INDEX_UUID_NA_VALUE), shardId), null, OriginalIndices.NONE);, +        }, +        return new ShardSearchFailure(exception, searchShardTarget);, +++ b/core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java, +        return "shard [" + (shardTarget == null ? "_na" : shardTarget) + "], reason [" + reason + "], cause [" +, +                (cause == null ? "_na" : ExceptionsHelper.stackTrace(cause)) + "]";, +        SearchShardTarget searchShardTarget = null;, +        if (nodeId != null) {, +            searchShardTarget = new SearchShardTarget(nodeId,, +                    new ShardId(new Index(indexName, IndexMetaData.INDEX_UUID_NA_VALUE), shardId), null, OriginalIndices.NONE);, +        }, +        return new ShardSearchFailure(exception, searchShardTarget);, +++ b/core/src/test/java/org/elasticsearch/action/search/SearchResponseTests.java, +                assertEquals(originalFailure.shard(), parsedFailure.shard());, +++ b/core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java, +        return "shard [" + (shardTarget == null ? "_na" : shardTarget) + "], reason [" + reason + "], cause [" +, +                (cause == null ? "_na" : ExceptionsHelper.stackTrace(cause)) + "]";, +        SearchShardTarget searchShardTarget = null;, +        if (nodeId != null) {, +            searchShardTarget = new SearchShardTarget(nodeId,, +                    new ShardId(new Index(indexName, IndexMetaData.INDEX_UUID_NA_VALUE), shardId), null, OriginalIndices.NONE);, +        }, +        return new ShardSearchFailure(exception, searchShardTarget);, +++ b/core/src/test/java/org/elasticsearch/action/search/SearchResponseTests.java, +                assertEquals(originalFailure.shard(), parsedFailure.shard());, +++ b/core/src/test/java/org/elasticsearch/action/search/ShardSearchFailureTests.java, +import org.elasticsearch.cluster.metadata.IndexMetaData;, +        SearchShardTarget searchShardTarget = null;, +        if (randomBoolean()) {, +            searchShardTarget = new SearchShardTarget(nodeId,, +                    new ShardId(new Index(indexName, IndexMetaData.INDEX_UUID_NA_VALUE), randomInt()), null, null);, +        }, +        return new ShardSearchFailure(ex, searchShardTarget);, +        assertEquals(response.shard(), parsed.shard());, +        /*]