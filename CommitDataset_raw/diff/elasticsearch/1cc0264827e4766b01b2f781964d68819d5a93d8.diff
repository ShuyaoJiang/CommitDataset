[+++ b/benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java, +        initialClusterState = ClusterState.builder(ClusterName.CLUSTER_NAME_SETTING.getDefault(Settings.EMPTY)), +            .metaData(metaData).routingTable(routingTable).nodes, +++ b/benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java, +        initialClusterState = ClusterState.builder(ClusterName.CLUSTER_NAME_SETTING.getDefault(Settings.EMPTY)), +            .metaData(metaData).routingTable(routingTable).nodes, +++ b/buildSrc/build.gradle, +  compile 'de.thetaphi:forbiddenapis:2.2', +++ b/benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java, +        initialClusterState = ClusterState.builder(ClusterName.CLUSTER_NAME_SETTING.getDefault(Settings.EMPTY)), +            .metaData(metaData).routingTable(routingTable).nodes, +++ b/buildSrc/build.gradle, +  compile 'de.thetaphi:forbiddenapis:2.2', +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            body(test, false), +                String body, String catchPart, boolean inSetup) {, +            /* Catch any shard failures. These only cause a non-200 response if, +             * no shard succeeds. But we need to fail the tests on all of these, +             * because they mean invalid syntax or broken queries or something, +             * else that we don't want to teach people to do. The REST test, +             * framework doesn't allow us to has assertions in the setup, +             * section so we have to skip it there. We also have to skip _cat, +             * actions because they don't return json so we can't is_false, +             * them. That is ok because they don't have this, +             * partial-success-is-success thing., +             */, +            if (false == inSetup && false == path.startsWith('_cat')) {, +                current.println("  - is_false: _shards.failures"), +            }, +            body(setup, true), +        private void body(Snippet snippet, boolean inSetup) {, +                emitDo(method, pathAndQuery, body, catchPart, inSetup), +++ b/benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java, +        initialClusterState = ClusterState.builder(ClusterName.CLUSTER_NAME_SETTING.getDefault(Settings.EMPTY)), +            .metaData(metaData).routingTable(routingTable).nodes, +++ b/buildSrc/build.gradle, +  compile 'de.thetaphi:forbiddenapis:2.2', +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            body(test, false), +                String body, String catchPart, boolean inSetup) {, +            /* Catch any shard failures. These only cause a non-200 response if, +             * no shard succeeds. But we need to fail the tests on all of these, +             * because they mean invalid syntax or broken queries or something, +             * else that we don't want to teach people to do. The REST test, +             * framework doesn't allow us to has assertions in the setup, +             * section so we have to skip it there. We also have to skip _cat, +             * actions because they don't return json so we can't is_false, +             * them. That is ok because they don't have this, +             * partial-success-is-success thing., +             */, +            if (false == inSetup && false == path.startsWith('_cat')) {, +                current.println("  - is_false: _shards.failures"), +            }, +            body(setup, true), +        private void body(Snippet snippet, boolean inSetup) {, +                emitDo(method, pathAndQuery, body, catchPart, inSetup), +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java, +        initialClusterState = ClusterState.builder(ClusterName.CLUSTER_NAME_SETTING.getDefault(Settings.EMPTY)), +            .metaData(metaData).routingTable(routingTable).nodes, +++ b/buildSrc/build.gradle, +  compile 'de.thetaphi:forbiddenapis:2.2', +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            body(test, false), +                String body, String catchPart, boolean inSetup) {, +            /* Catch any shard failures. These only cause a non-200 response if, +             * no shard succeeds. But we need to fail the tests on all of these, +             * because they mean invalid syntax or broken queries or something, +             * else that we don't want to teach people to do. The REST test, +             * framework doesn't allow us to has assertions in the setup, +             * section so we have to skip it there. We also have to skip _cat, +             * actions because they don't return json so we can't is_false, +             * them. That is ok because they don't have this, +             * partial-success-is-success thing., +             */, +            if (false == inSetup && false == path.startsWith('_cat')) {, +                current.println("  - is_false: _shards.failures"), +            }, +            body(setup, true), +        private void body(Snippet snippet, boolean inSetup) {, +                emitDo(method, pathAndQuery, body, catchPart, inSetup), +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/buildSrc/src/main/resources/forbidden/es-all-signatures.txt, +@defaultMessage Don't use MethodHandles in slow ways, don't be lenient in tests., +java.lang.invoke.MethodHandle#invoke(java.lang.Object[]), +++ b/benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java, +        initialClusterState = ClusterState.builder(ClusterName.CLUSTER_NAME_SETTING.getDefault(Settings.EMPTY)), +            .metaData(metaData).routingTable(routingTable).nodes, +++ b/buildSrc/build.gradle, +  compile 'de.thetaphi:forbiddenapis:2.2', +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            body(test, false), +                String body, String catchPart, boolean inSetup) {, +            /* Catch any shard failures. These only cause a non-200 response if, +             * no shard succeeds. But we need to fail the tests on all of these, +             * because they mean invalid syntax or broken queries or something, +             * else that we don't want to teach people to do. The REST test, +             * framework doesn't allow us to has assertions in the setup, +             * section so we have to skip it there. We also have to skip _cat, +             * actions because they don't return json so we can't is_false]