[+++ b/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.MultiValueMode;, +    XFieldComparatorSource comparatorSource(@Nullable Object missingValue, MultiValueMode sortMode);, +++ b/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.MultiValueMode;, +    XFieldComparatorSource comparatorSource(@Nullable Object missingValue, MultiValueMode sortMode);, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java, +import org.elasticsearch.search.MultiValueMode;, +    private final MultiValueMode sortMode;, +    public BytesRefFieldComparatorSource(IndexFieldData<?> indexFieldData, Object missingValue, MultiValueMode sortMode) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.MultiValueMode;, +    XFieldComparatorSource comparatorSource(@Nullable Object missingValue, MultiValueMode sortMode);, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java, +import org.elasticsearch.search.MultiValueMode;, +    private final MultiValueMode sortMode;, +    public BytesRefFieldComparatorSource(IndexFieldData<?> indexFieldData, Object missingValue, MultiValueMode sortMode) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefOrdValComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    final MultiValueMode sortMode;, +    public BytesRefOrdValComparator(IndexFieldData.WithOrdinals<?> indexFieldData, int numHits, MultiValueMode sortMode, BytesRef missingValue) {, +    static long getRelevantOrd(Ordinals.Docs readerOrds, int docId, MultiValueMode sortMode) {, +        assert sortMode == MultiValueMode.MAX || sortMode == MultiValueMode.MIN;, +++ b/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.MultiValueMode;, +    XFieldComparatorSource comparatorSource(@Nullable Object missingValue, MultiValueMode sortMode);, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java, +import org.elasticsearch.search.MultiValueMode;, +    private final MultiValueMode sortMode;, +    public BytesRefFieldComparatorSource(IndexFieldData<?> indexFieldData, Object missingValue, MultiValueMode sortMode) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefOrdValComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    final MultiValueMode sortMode;, +    public BytesRefOrdValComparator(IndexFieldData.WithOrdinals<?> indexFieldData, int numHits, MultiValueMode sortMode, BytesRef missingValue) {, +    static long getRelevantOrd(Ordinals.Docs readerOrds, int docId, MultiValueMode sortMode) {, +        assert sortMode == MultiValueMode.MAX || sortMode == MultiValueMode.MIN;, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefValComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    private final MultiValueMode sortMode;, +    BytesRefValComparator(IndexFieldData<?> indexFieldData, int numHits, MultiValueMode sortMode, BytesRef missingValue) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.MultiValueMode;, +    XFieldComparatorSource comparatorSource(@Nullable Object missingValue, MultiValueMode sortMode);, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java, +import org.elasticsearch.search.MultiValueMode;, +    private final MultiValueMode sortMode;, +    public BytesRefFieldComparatorSource(IndexFieldData<?> indexFieldData, Object missingValue, MultiValueMode sortMode) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefOrdValComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    final MultiValueMode sortMode;, +    public BytesRefOrdValComparator(IndexFieldData.WithOrdinals<?> indexFieldData, int numHits, MultiValueMode sortMode, BytesRef missingValue) {, +    static long getRelevantOrd(Ordinals.Docs readerOrds, int docId, MultiValueMode sortMode) {, +        assert sortMode == MultiValueMode.MAX || sortMode == MultiValueMode.MIN;, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefValComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    private final MultiValueMode sortMode;, +    BytesRefValComparator(IndexFieldData<?> indexFieldData, int numHits, MultiValueMode sortMode, BytesRef missingValue) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/DoubleValuesComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    public DoubleValuesComparator(IndexNumericFieldData<?> indexFieldData, double missingValue, int numHits, MultiValueMode sortMode) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.MultiValueMode;, +    XFieldComparatorSource comparatorSource(@Nullable Object missingValue, MultiValueMode sortMode);, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java, +import org.elasticsearch.search.MultiValueMode;, +    private final MultiValueMode sortMode;, +    public BytesRefFieldComparatorSource(IndexFieldData<?> indexFieldData, Object missingValue, MultiValueMode sortMode) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefOrdValComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    final MultiValueMode sortMode;, +    public BytesRefOrdValComparator(IndexFieldData.WithOrdinals<?> indexFieldData, int numHits, MultiValueMode sortMode, BytesRef missingValue) {, +    static long getRelevantOrd(Ordinals.Docs readerOrds, int docId, MultiValueMode sortMode) {, +        assert sortMode == MultiValueMode.MAX || sortMode == MultiValueMode.MIN;, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefValComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    private final MultiValueMode sortMode;, +    BytesRefValComparator(IndexFieldData<?> indexFieldData, int numHits, MultiValueMode sortMode, BytesRef missingValue) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/DoubleValuesComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    public DoubleValuesComparator(IndexNumericFieldData<?> indexFieldData, double missingValue, int numHits, MultiValueMode sortMode) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/DoubleValuesComparatorBase.java, +import org.elasticsearch.search.MultiValueMode;, +    protected final MultiValueMode sortMode;, +    public DoubleValuesComparatorBase(IndexNumericFieldData<?> indexFieldData, double missingValue, MultiValueMode sortMode) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java, +import org.elasticsearch.search.MultiValueMode;, +    XFieldComparatorSource comparatorSource(@Nullable Object missingValue, MultiValueMode sortMode);, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java, +import org.elasticsearch.search.MultiValueMode;, +    private final MultiValueMode sortMode;, +    public BytesRefFieldComparatorSource(IndexFieldData<?> indexFieldData, Object missingValue, MultiValueMode sortMode) {, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefOrdValComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    final MultiValueMode sortMode;, +    public BytesRefOrdValComparator(IndexFieldData.WithOrdinals<?> indexFieldData, int numHits, MultiValueMode sortMode, BytesRef missingValue) {, +    static long getRelevantOrd(Ordinals.Docs readerOrds, int docId, MultiValueMode sortMode) {, +        assert sortMode == MultiValueMode.MAX || sortMode == MultiValueMode.MIN;, +++ b/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefValComparator.java, +import org.elasticsearch.search.MultiValueMode;, +    private final MultiValueMode sortMode;]