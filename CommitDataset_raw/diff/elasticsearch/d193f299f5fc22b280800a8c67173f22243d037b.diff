[+++ b/server/src/main/java/org/elasticsearch/index/seqno/RetentionLeaseActions.java, +import org.elasticsearch.cluster.routing.IndexShardRoutingTable;, +import org.elasticsearch.cluster.routing.PlainShardIterator;, +import java.util.Collections;, +            final IndexShardRoutingTable shardRoutingTable = state, +                    .shardRoutingTable(request.concreteIndex(), request.request().getShardId().id());, +            if (shardRoutingTable.primaryShard().active()) {, +                return shardRoutingTable.primaryShardIt();, +            } else {, +                return new PlainShardIterator(request.request().getShardId(), Collections.emptyList());, +            }, +++ b/server/src/main/java/org/elasticsearch/index/seqno/RetentionLeaseActions.java, +import org.elasticsearch.cluster.routing.IndexShardRoutingTable;, +import org.elasticsearch.cluster.routing.PlainShardIterator;, +import java.util.Collections;, +            final IndexShardRoutingTable shardRoutingTable = state, +                    .shardRoutingTable(request.concreteIndex(), request.request().getShardId().id());, +            if (shardRoutingTable.primaryShard().active()) {, +                return shardRoutingTable.primaryShardIt();, +            } else {, +                return new PlainShardIterator(request.request().getShardId(), Collections.emptyList());, +            }, +++ b/x-pack/plugin/ccr/src/test/java/org/elasticsearch/xpack/ccr/CcrRetentionLeaseIT.java]