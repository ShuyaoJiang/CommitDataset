[+++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +        ingestStats = in.readOptionalWriteable(IngestStats::new);, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +        ingestStats = in.readOptionalWriteable(IngestStats::new);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +        ingestStats = in.readOptionalWriteable(IngestStats::new);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +        concreteIndex = in.readOptionalWriteable(Index::new);, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +        ingestStats = in.readOptionalWriteable(IngestStats::new);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +        concreteIndex = in.readOptionalWriteable(Index::new);, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/ReplicationTask.java, +        public static final String NAME = "replication";, +            return NAME;, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +        ingestStats = in.readOptionalWriteable(IngestStats::new);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +        concreteIndex = in.readOptionalWriteable(Index::new);, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/ReplicationTask.java, +        public static final String NAME = "replication";, +            return NAME;, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableAwareStreamInput.java, +        return namedWriteableRegistry.getReader(categoryClass, name).read(this);, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +        ingestStats = in.readOptionalWriteable(IngestStats::new);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +        concreteIndex = in.readOptionalWriteable(Index::new);, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/ReplicationTask.java, +        public static final String NAME = "replication";, +            return NAME;, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableAwareStreamInput.java, +        return namedWriteableRegistry.getReader(categoryClass, name).read(this);, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableRegistry.java, +     * Register a {@link NamedWriteable} given its category, its name, and a function to read it from the stream., +     *, +     * This method suppresses the rawtypes warning because it intentionally using NamedWriteable instead of {@code NamedWriteable<T>} so it, +     * is easier to use and because we might be able to drop the type parameter from NamedWriteable entirely some day., +    @SuppressWarnings("rawtypes"), +    public synchronized <T extends NamedWriteable> void register(Class<T> categoryClass, String name,, +            Writeable.Reader<? extends T> reader) {, +        innerRegistry.register(name, reader);, +    }, +, +    /**, +     * Registers a {@link NamedWriteable} prototype given its category., +     * @deprecated Prefer {@link #register(Class, String, org.elasticsearch.common.io.stream.Writeable.Reader)}, +     */, +    @Deprecated, +    @SuppressWarnings("rawtypes") // TODO remove this method entirely before 5.0.0 GA, +    public synchronized <T extends NamedWriteable> void registerPrototype(Class<T> categoryClass,, +            NamedWriteable<? extends T> namedWriteable) {, +        register(categoryClass, namedWriteable.getWriteableName(), namedWriteable::readFrom);, +    public synchronized <T> Writeable.Reader<? extends T> getReader(Class<T> categoryClass, String name) {, +        return innerRegistry.getReader(name);, +        private final Map<String, Writeable.Reader<? extends T>> registry = new HashMap<>();, +        private void register(String name, Writeable.Reader<? extends T> reader) {, +            Writeable.Reader<? extends T> existingReader = registry.get(name);, +            if (existingReader != null) {, +                throw new IllegalArgumentException(, +                        "named writeable [" + categoryClass.getName() + "][" + name + "] is already registered by [" + reader + "]");, +            registry.put(name, reader);, +        private Writeable.Reader<? extends T> getReader(String name) {, +            Writeable.Reader<? extends T> reader = registry.get(name);, +            if (reader == null) {, +                throw new IllegalArgumentException("unknown named writeable [" + categoryClass.getName() + "][" + name + "]");, +            return reader;, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java, +        ingestStats = in.readOptionalWriteable(IngestStats::new);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java, +        concreteIndex = in.readOptionalWriteable(Index::new);, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/ReplicationTask.java, +        public static final String NAME = "replication";, +            return NAME;, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableAwareStreamInput.java, +        return namedWriteableRegistry.getReader(categoryClass, name).read(this);, +++ b/core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableRegistry.java, +     * Register a {@link NamedWriteable} given its category, its name, and a function to read it from the stream., +     *, +     * This method suppresses the rawtypes warning because it intentionally using NamedWriteable instead of {@code NamedWriteable<T>} so it, +     * is easier to use and because we might be able to drop the type parameter from NamedWriteable entirely some day., +    @SuppressWarnings("rawtypes"), +    public synchronized <T extends NamedWriteable> void register(Class<T> categoryClass, String name,, +            Writeable.Reader<? extends T> reader) {, +        innerRegistry.register(name, reader);, +    }]