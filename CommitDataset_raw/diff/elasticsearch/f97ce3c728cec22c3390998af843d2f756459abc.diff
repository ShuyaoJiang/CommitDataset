[+++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +        applyDocBoost(context);, +    private static void applyDocBoost(ParseContext.InternalParseContext context) {, +        // apply doc boost, +        if (context.docBoost() != 1.0f) {, +            Set<String> encounteredFields = new HashSet<>();, +            for (ParseContext.Document doc : context.docs()) {, +                encounteredFields.clear();, +                for (IndexableField field : doc) {, +                    if (field.fieldType().indexOptions() != IndexOptions.NONE && !field.fieldType().omitNorms()) {, +                        if (!encounteredFields.contains(field.name())) {, +                            ((Field) field).setBoost(context.docBoost() * field.boost());, +                            encounteredFields.add(field.name());, +                        }, +                    }, +                }, +            }, +        }, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +        applyDocBoost(context);, +    private static void applyDocBoost(ParseContext.InternalParseContext context) {, +        // apply doc boost, +        if (context.docBoost() != 1.0f) {, +            Set<String> encounteredFields = new HashSet<>();, +            for (ParseContext.Document doc : context.docs()) {, +                encounteredFields.clear();, +                for (IndexableField field : doc) {, +                    if (field.fieldType().indexOptions() != IndexOptions.NONE && !field.fieldType().omitNorms()) {, +                        if (!encounteredFields.contains(field.name())) {, +                            ((Field) field).setBoost(context.docBoost() * field.boost());, +                            encounteredFields.add(field.name());, +                        }, +                    }, +                }, +            }, +        }, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +                        && field.fieldType().indexOptions() != IndexOptions.NONE) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +        applyDocBoost(context);, +    private static void applyDocBoost(ParseContext.InternalParseContext context) {, +        // apply doc boost, +        if (context.docBoost() != 1.0f) {, +            Set<String> encounteredFields = new HashSet<>();, +            for (ParseContext.Document doc : context.docs()) {, +                encounteredFields.clear();, +                for (IndexableField field : doc) {, +                    if (field.fieldType().indexOptions() != IndexOptions.NONE && !field.fieldType().omitNorms()) {, +                        if (!encounteredFields.contains(field.name())) {, +                            ((Field) field).setBoost(context.docBoost() * field.boost());, +                            encounteredFields.add(field.name());, +                        }, +                    }, +                }, +            }, +        }, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +                        && field.fieldType().indexOptions() != IndexOptions.NONE) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java, +        return new TermQuery(createTerm(value));, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +        applyDocBoost(context);, +    private static void applyDocBoost(ParseContext.InternalParseContext context) {, +        // apply doc boost, +        if (context.docBoost() != 1.0f) {, +            Set<String> encounteredFields = new HashSet<>();, +            for (ParseContext.Document doc : context.docs()) {, +                encounteredFields.clear();, +                for (IndexableField field : doc) {, +                    if (field.fieldType().indexOptions() != IndexOptions.NONE && !field.fieldType().omitNorms()) {, +                        if (!encounteredFields.contains(field.name())) {, +                            ((Field) field).setBoost(context.docBoost() * field.boost());, +                            encounteredFields.add(field.name());, +                        }, +                    }, +                }, +            }, +        }, +    }, +, +++ b/core/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java, +                        && field.fieldType().indexOptions() != IndexOptions.NONE) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java, +        return new TermQuery(createTerm(value));, +++ b/core/src/main/java/org/elasticsearch/index/mapper/ParseContext.java, +        public float docBoost() {, +            return in.docBoost();, +        }, +, +        @Override, +        public void docBoost(float docBoost) {, +            in.docBoost(docBoost);, +        }, +]