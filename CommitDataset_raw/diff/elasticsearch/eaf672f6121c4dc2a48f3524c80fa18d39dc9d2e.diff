[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.cluster.ClusterState;, +    public static MlMetadata getMlMetadata(ClusterState state) {, +        MlMetadata mlMetadata = (state == null) ? null : state.getMetaData().custom(MLMetadataField.TYPE);, +        if (mlMetadata == null) {, +            return EMPTY_METADATA;, +        }, +        return mlMetadata;, +    }, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.cluster.ClusterState;, +    public static MlMetadata getMlMetadata(ClusterState state) {, +        MlMetadata mlMetadata = (state == null) ? null : state.getMetaData().custom(MLMetadataField.TYPE);, +        if (mlMetadata == null) {, +            return EMPTY_METADATA;, +        }, +        return mlMetadata;, +    }, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/persistence/AnomalyDetectorsIndex.java, +        return MlMetadata.getMlMetadata(state).getJobs().get(jobId).getResultsIndexName();, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.cluster.ClusterState;, +    public static MlMetadata getMlMetadata(ClusterState state) {, +        MlMetadata mlMetadata = (state == null) ? null : state.getMetaData().custom(MLMetadataField.TYPE);, +        if (mlMetadata == null) {, +            return EMPTY_METADATA;, +        }, +        return mlMetadata;, +    }, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/persistence/AnomalyDetectorsIndex.java, +        return MlMetadata.getMlMetadata(state).getJobs().get(jobId).getResultsIndexName();, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearningFeatureSet.java, +        new Retriever(client, MlMetadata.getMlMetadata(state), available(), enabled()).execute(listener);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.cluster.ClusterState;, +    public static MlMetadata getMlMetadata(ClusterState state) {, +        MlMetadata mlMetadata = (state == null) ? null : state.getMetaData().custom(MLMetadataField.TYPE);, +        if (mlMetadata == null) {, +            return EMPTY_METADATA;, +        }, +        return mlMetadata;, +    }, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/persistence/AnomalyDetectorsIndex.java, +        return MlMetadata.getMlMetadata(state).getJobs().get(jobId).getResultsIndexName();, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearningFeatureSet.java, +        new Retriever(client, MlMetadata.getMlMetadata(state), available(), enabled()).execute(listener);, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MlAssignmentNotifier.java, +                DatafeedConfig datafeedConfig = MlMetadata.getMlMetadata(event.state()).getDatafeed(datafeedId);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.cluster.ClusterState;, +    public static MlMetadata getMlMetadata(ClusterState state) {, +        MlMetadata mlMetadata = (state == null) ? null : state.getMetaData().custom(MLMetadataField.TYPE);, +        if (mlMetadata == null) {, +            return EMPTY_METADATA;, +        }, +        return mlMetadata;, +    }, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/persistence/AnomalyDetectorsIndex.java, +        return MlMetadata.getMlMetadata(state).getJobs().get(jobId).getResultsIndexName();, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearningFeatureSet.java, +        new Retriever(client, MlMetadata.getMlMetadata(state), available(), enabled()).execute(listener);, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MlAssignmentNotifier.java, +                DatafeedConfig datafeedConfig = MlMetadata.getMlMetadata(event.state()).getDatafeed(datafeedId);, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MlInitializationService.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.cluster.ClusterState;, +    public static MlMetadata getMlMetadata(ClusterState state) {, +        MlMetadata mlMetadata = (state == null) ? null : state.getMetaData().custom(MLMetadataField.TYPE);, +        if (mlMetadata == null) {, +            return EMPTY_METADATA;, +        }, +        return mlMetadata;, +    }, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/persistence/AnomalyDetectorsIndex.java, +        return MlMetadata.getMlMetadata(state).getJobs().get(jobId).getResultsIndexName();, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearningFeatureSet.java, +        new Retriever(client, MlMetadata.getMlMetadata(state), available(), enabled()).execute(listener);, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MlAssignmentNotifier.java, +                DatafeedConfig datafeedConfig = MlMetadata.getMlMetadata(event.state()).getDatafeed(datafeedId);, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MlInitializationService.java, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportCloseJobAction.java, +        final MlMetadata mlMetadata = MlMetadata.getMlMetadata(state);, +        expandedJobIds.forEach(jobIdProcessor::accept);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +import org.elasticsearch.cluster.ClusterState;, +    public static MlMetadata getMlMetadata(ClusterState state) {, +        MlMetadata mlMetadata = (state == null) ? null : state.getMetaData().custom(MLMetadataField.TYPE);, +        if (mlMetadata == null) {, +            return EMPTY_METADATA;, +        }, +        return mlMetadata;, +    }, +, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/persistence/AnomalyDetectorsIndex.java]