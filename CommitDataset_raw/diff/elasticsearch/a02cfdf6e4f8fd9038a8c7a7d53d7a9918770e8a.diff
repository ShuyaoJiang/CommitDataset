[+++ b/test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java, +import static org.elasticsearch.discovery.DiscoveryModule.DISCOVERY_HOSTS_PROVIDER_SETTING;, +                    .putList(DISCOVERY_HOSTS_PROVIDER_SETTING.getKey(), "file"), +                    .putList(SettingsBasedHostsProvider.DISCOVERY_ZEN_PING_UNICAST_HOSTS_SETTING.getKey()), +                        .putList(DISCOVERY_HOSTS_PROVIDER_SETTING.getKey(), "file"), +                        .putList(SettingsBasedHostsProvider.DISCOVERY_ZEN_PING_UNICAST_HOSTS_SETTING.getKey()), +        final long masterCount = roles.stream().filter(role -> role == MASTER).count();, +            .put(DISCOVERY_ZEN_MINIMUM_MASTER_NODES_SETTING.getKey(), masterCount / 2 + 1), +            .put(INITIAL_MASTER_NODE_COUNT_SETTING.getKey(), masterCount), +            .build();, +, +                    .putList(DISCOVERY_HOSTS_PROVIDER_SETTING.getKey(), "file"), +                    .putList(SettingsBasedHostsProvider.DISCOVERY_ZEN_PING_UNICAST_HOSTS_SETTING.getKey())]