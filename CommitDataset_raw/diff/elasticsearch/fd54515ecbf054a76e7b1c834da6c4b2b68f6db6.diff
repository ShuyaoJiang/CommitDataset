[+++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/action/PostDataAction.java, +import org.elasticsearch.common.xcontent.XContentType;, +        private XContentType xContentType;, +        public XContentType getXContentType() {, +            return xContentType;, +        }, +, +        public void setContent(BytesReference content, XContentType xContentType) {, +            this.xContentType = xContentType;, +            if (in.readBoolean()) {, +                xContentType = XContentType.readFrom(in);, +            }, +            boolean hasXContentType = xContentType != null;, +            out.writeBoolean(hasXContentType);, +            if (hasXContentType) {, +                xContentType.writeTo(out);, +            }, +            return Objects.hash(jobId, resetStart, resetEnd, dataDescription, xContentType);, +                    Objects.equals(dataDescription, other.dataDescription) &&, +                    Objects.equals(xContentType, other.xContentType);, +                DataCounts dataCounts = processManager.processData(request.getJobId(),, +                        request.content.streamInput(), request.getXContentType(), params);, +++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/action/PostDataAction.java, +import org.elasticsearch.common.xcontent.XContentType;, +        private XContentType xContentType;, +        public XContentType getXContentType() {, +            return xContentType;, +        }, +, +        public void setContent(BytesReference content, XContentType xContentType) {, +            this.xContentType = xContentType;, +            if (in.readBoolean()) {, +                xContentType = XContentType.readFrom(in);, +            }, +            boolean hasXContentType = xContentType != null;, +            out.writeBoolean(hasXContentType);, +            if (hasXContentType) {, +                xContentType.writeTo(out);, +            }, +            return Objects.hash(jobId, resetStart, resetEnd, dataDescription, xContentType);, +                    Objects.equals(dataDescription, other.dataDescription) &&, +                    Objects.equals(xContentType, other.xContentType);, +                DataCounts dataCounts = processManager.processData(request.getJobId(),, +                        request.content.streamInput(), request.getXContentType(), params);, +++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/datafeed/DatafeedJob.java, +import org.elasticsearch.common.xcontent.XContentType;, +                    counts = postData(in, XContentType.JSON);, +    private DataCounts postData(InputStream inputStream, XContentType xContentType), +            throws IOException {, +        request.setContent(new BytesArray(outputStream.toByteArray()), xContentType);, +++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/action/PostDataAction.java, +import org.elasticsearch.common.xcontent.XContentType;, +        private XContentType xContentType;, +        public XContentType getXContentType() {, +            return xContentType;, +        }, +, +        public void setContent(BytesReference content, XContentType xContentType) {, +            this.xContentType = xContentType;, +            if (in.readBoolean()) {, +                xContentType = XContentType.readFrom(in);, +            }, +            boolean hasXContentType = xContentType != null;, +            out.writeBoolean(hasXContentType);, +            if (hasXContentType) {, +                xContentType.writeTo(out);, +            }, +            return Objects.hash(jobId, resetStart, resetEnd, dataDescription, xContentType);, +                    Objects.equals(dataDescription, other.dataDescription) &&, +                    Objects.equals(xContentType, other.xContentType);, +                DataCounts dataCounts = processManager.processData(request.getJobId(),, +                        request.content.streamInput(), request.getXContentType(), params);, +++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/datafeed/DatafeedJob.java, +import org.elasticsearch.common.xcontent.XContentType;, +                    counts = postData(in, XContentType.JSON);, +    private DataCounts postData(InputStream inputStream, XContentType xContentType), +            throws IOException {, +        request.setContent(new BytesArray(outputStream.toByteArray()), xContentType);, +++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/datafeed/DatafeedJobRunner.java, +        dataDescription.setFormat(DataDescription.DataFormat.XCONTENT);, +++ b/plugin/src/main/java/org/elasticsearch/xpack/ml/action/PostDataAction.java, +import org.elasticsearch.common.xcontent.XContentType;, +        private XContentType xContentType;, +        public XContentType getXContentType() {, +            return xContentType;, +        }, +, +        public void setContent(BytesReference content, XContentType xContentType) {, +            this.xContentType = xContentType;, +            if (in.readBoolean()) {, +                xContentType = XContentType.readFrom(in);, +            }, +            boolean hasXContentType = xContentType != null;, +            out.writeBoolean(hasXContentType);, +            if (hasXContentType) {, +                xContentType.writeTo(out);, +            }, +            return Objects.hash(jobId, resetStart, resetEnd, dataDescription, xContentType);, +                    Objects.equals(dataDescription, other.dataDescription) &&, +                    Objects.equals(xContentType, other.xContentType);]