[+++ b/Vagrantfile, +    ubuntu_common config, extra: <<-SHELL, +      # Install Jayatana so we can work around it being present., +      [ -f /usr/share/java/jayatanaag.jar ] || install jayatana, +    SHELL, +def ubuntu_common(config, extra: ''), +  deb_common config, 'apt-add-repository -y ppa:openjdk-r/ppa > /dev/null 2>&1', 'openjdk-r-*', extra: extra, +def deb_common(config, add_openjdk_repository_command, openjdk_list, extra: ''), +      #{extra}, +++ b/Vagrantfile, +    ubuntu_common config, extra: <<-SHELL, +      # Install Jayatana so we can work around it being present., +      [ -f /usr/share/java/jayatanaag.jar ] || install jayatana, +    SHELL, +def ubuntu_common(config, extra: ''), +  deb_common config, 'apt-add-repository -y ppa:openjdk-r/ppa > /dev/null 2>&1', 'openjdk-r-*', extra: extra, +def deb_common(config, add_openjdk_repository_command, openjdk_list, extra: ''), +      #{extra}, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +        //      22 was CreateFailedEngineException, +        // 54 was DocumentAlreadyExistsException, which is superseded by VersionConflictEngineException, +++ b/Vagrantfile, +    ubuntu_common config, extra: <<-SHELL, +      # Install Jayatana so we can work around it being present., +      [ -f /usr/share/java/jayatanaag.jar ] || install jayatana, +    SHELL, +def ubuntu_common(config, extra: ''), +  deb_common config, 'apt-add-repository -y ppa:openjdk-r/ppa > /dev/null 2>&1', 'openjdk-r-*', extra: extra, +def deb_common(config, add_openjdk_repository_command, openjdk_list, extra: ''), +      #{extra}, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +        //      22 was CreateFailedEngineException, +        // 54 was DocumentAlreadyExistsException, which is superseded by VersionConflictEngineException, +++ b/core/src/main/java/org/elasticsearch/action/UnavailableShardsException.java, +import org.elasticsearch.common.collect.HppcMaps;, +    public UnavailableShardsException(@Nullable ShardId shardId, String message, Object... args) {, +        super(buildMessage(shardId, message), args);, +++ b/Vagrantfile, +    ubuntu_common config, extra: <<-SHELL, +      # Install Jayatana so we can work around it being present., +      [ -f /usr/share/java/jayatanaag.jar ] || install jayatana, +    SHELL, +def ubuntu_common(config, extra: ''), +  deb_common config, 'apt-add-repository -y ppa:openjdk-r/ppa > /dev/null 2>&1', 'openjdk-r-*', extra: extra, +def deb_common(config, add_openjdk_repository_command, openjdk_list, extra: ''), +      #{extra}, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +        //      22 was CreateFailedEngineException, +        // 54 was DocumentAlreadyExistsException, which is superseded by VersionConflictEngineException, +++ b/core/src/main/java/org/elasticsearch/action/UnavailableShardsException.java, +import org.elasticsearch.common.collect.HppcMaps;, +    public UnavailableShardsException(@Nullable ShardId shardId, String message, Object... args) {, +        super(buildMessage(shardId, message), args);, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +, +                    if (t instanceof VersionConflictEngineException) {, +                    final Engine.Index operation = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA);, +                    indexShard.index(operation);, +++ b/Vagrantfile, +    ubuntu_common config, extra: <<-SHELL, +      # Install Jayatana so we can work around it being present., +      [ -f /usr/share/java/jayatanaag.jar ] || install jayatana, +    SHELL, +def ubuntu_common(config, extra: ''), +  deb_common config, 'apt-add-repository -y ppa:openjdk-r/ppa > /dev/null 2>&1', 'openjdk-r-*', extra: extra, +def deb_common(config, add_openjdk_repository_command, openjdk_list, extra: ''), +      #{extra}, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +        //      22 was CreateFailedEngineException, +        // 54 was DocumentAlreadyExistsException, which is superseded by VersionConflictEngineException, +++ b/core/src/main/java/org/elasticsearch/action/UnavailableShardsException.java, +import org.elasticsearch.common.collect.HppcMaps;, +    public UnavailableShardsException(@Nullable ShardId shardId, String message, Object... args) {, +        super(buildMessage(shardId, message), args);, +++ b/core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +, +                    if (t instanceof VersionConflictEngineException) {, +                    final Engine.Index operation = indexShard.prepareIndex(sourceToParse, indexRequest.version(), indexRequest.versionType(), Engine.Operation.Origin.REPLICA);, +                    indexShard.index(operation);, +++ b/core/src/main/java/org/elasticsearch/action/index/IndexRequest.java, + *, + *, + *, +, +        if (opType() == OpType.CREATE) {, +            if (versionType != VersionType.INTERNAL || version != Versions.MATCH_DELETED) {, +                validationException = addValidationError("create operations do not support versioning. use index instead", validationException);, +                return validationException;, +            }, +        }, +, +     *, +        if (opType == OpType.CREATE) {, +            version(Versions.MATCH_DELETED);, +            versionType(VersionType.INTERNAL);, +        }, +++ b/Vagrantfile, +    ubuntu_common config, extra: <<-SHELL, +      # Install Jayatana so we can work around it being present., +      [ -f /usr/share/java/jayatanaag.jar ] || install jayatana]