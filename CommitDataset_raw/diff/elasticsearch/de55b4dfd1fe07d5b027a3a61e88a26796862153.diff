[+++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java, +import org.elasticsearch.script.DeprecationMap;, +import java.util.Collections;, +import java.util.HashMap;, +    private static final Map<String, String> DEPRECATIONS;, +    static {, +        Map<String, String> deprecations = new HashMap<>();, +        deprecations.put(, +                "_type",, +                "[types removal] Looking up doc types [_type] in scripts is deprecated.", +        );, +        DEPRECATIONS = Collections.unmodifiableMap(deprecations);, +    }, +, +        factory.newInstance(script.getParams()).execute(, +                new DeprecationMap(document.getSourceAndMetadata(), DEPRECATIONS, "script_processor"));, +++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java, +import org.elasticsearch.script.DeprecationMap;, +import java.util.Collections;, +import java.util.HashMap;, +    private static final Map<String, String> DEPRECATIONS;, +    static {, +        Map<String, String> deprecations = new HashMap<>();, +        deprecations.put(, +                "_type",, +                "[types removal] Looking up doc types [_type] in scripts is deprecated.", +        );, +        DEPRECATIONS = Collections.unmodifiableMap(deprecations);, +    }, +, +        factory.newInstance(script.getParams()).execute(, +                new DeprecationMap(document.getSourceAndMetadata(), DEPRECATIONS, "script_processor"));, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java, +, +    public void testTypeDeprecation() throws Exception {, +        String scriptName = "script";, +        ScriptService scriptService = new ScriptService(Settings.builder().build(),, +                Collections.singletonMap(, +                        Script.DEFAULT_SCRIPT_LANG, new MockScriptEngine(, +                                Script.DEFAULT_SCRIPT_LANG,, +                                Collections.singletonMap(, +                                        scriptName, ctx -> {, +                                            ctx.get("_type");, +                                            return null;, +                                        }, +                                ),, +                                Collections.emptyMap(), +                        ), +                ),, +                new HashMap<>(ScriptModule.CORE_CONTEXTS), +        );, +        Script script = new Script(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG, scriptName, Collections.emptyMap());, +        IngestDocument ingestDocument = RandomDocumentPicks.randomIngestDocument(random(), Collections.emptyMap());, +        ScriptProcessor processor = new ScriptProcessor(randomAlphaOfLength(10), script, scriptService);, +        processor.execute(ingestDocument);, +        assertWarnings("[types removal] Looking up doc types [_type] in scripts is deprecated.");, +    }, +++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java, +import org.elasticsearch.script.DeprecationMap;, +import java.util.Collections;, +import java.util.HashMap;, +    private static final Map<String, String> DEPRECATIONS;, +    static {, +        Map<String, String> deprecations = new HashMap<>();, +        deprecations.put(, +                "_type",, +                "[types removal] Looking up doc types [_type] in scripts is deprecated.", +        );, +        DEPRECATIONS = Collections.unmodifiableMap(deprecations);, +    }, +, +        factory.newInstance(script.getParams()).execute(, +                new DeprecationMap(document.getSourceAndMetadata(), DEPRECATIONS, "script_processor"));, +++ b/modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java, +, +    public void testTypeDeprecation() throws Exception {, +        String scriptName = "script";, +        ScriptService scriptService = new ScriptService(Settings.builder().build(),, +                Collections.singletonMap(, +                        Script.DEFAULT_SCRIPT_LANG, new MockScriptEngine(, +                                Script.DEFAULT_SCRIPT_LANG,, +                                Collections.singletonMap(, +                                        scriptName, ctx -> {, +                                            ctx.get("_type");, +                                            return null;, +                                        }, +                                ),, +                                Collections.emptyMap(), +                        ), +                ),, +                new HashMap<>(ScriptModule.CORE_CONTEXTS), +        );, +        Script script = new Script(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG, scriptName, Collections.emptyMap());, +        IngestDocument ingestDocument = RandomDocumentPicks.randomIngestDocument(random(), Collections.emptyMap());, +        ScriptProcessor processor = new ScriptProcessor(randomAlphaOfLength(10), script, scriptService);, +        processor.execute(ingestDocument);, +        assertWarnings("[types removal] Looking up doc types [_type] in scripts is deprecated.");, +    }, +++ b/modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionScriptTestCase.java, +                scriptBody.accept(getCtx());]