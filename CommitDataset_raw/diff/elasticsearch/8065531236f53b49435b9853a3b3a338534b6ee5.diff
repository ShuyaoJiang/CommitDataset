[+++ b/core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java, +import org.elasticsearch.common.bytes.BytesReference;, +import org.elasticsearch.common.io.stream.BytesStreamOutput;, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.common.xcontent.XContentFactory;, +import org.elasticsearch.common.xcontent.XContentType;, +import java.io.IOException;, +, +    public void testSmileIsSupported() throws IOException {, +        XContentType xContentType = XContentType.SMILE;, +        BytesReference data;, +        try (BytesStreamOutput out = new BytesStreamOutput()) {, +            try(XContentBuilder builder = XContentFactory.contentBuilder(xContentType, out)) {, +                builder.startObject();, +                builder.startObject("index");, +                builder.field("_index", "index");, +                builder.field("_type", "type");, +                builder.field("_id", "test");, +                builder.endObject();, +                builder.endObject();, +            }, +            out.write(xContentType.xContent().streamSeparator());, +            try(XContentBuilder builder = XContentFactory.contentBuilder(xContentType, out)) {, +                builder.startObject();, +                builder.field("field", "value");, +                builder.endObject();, +            }, +            out.write(xContentType.xContent().streamSeparator());, +            data = out.bytes();, +        }, +, +        BulkRequest bulkRequest = new BulkRequest();, +        bulkRequest.add(data, null, null);, +        assertEquals(1, bulkRequest.requests().size());, +        DocWriteRequest docWriteRequest = bulkRequest.requests().get(0);, +        assertEquals(DocWriteRequest.OpType.INDEX, docWriteRequest.opType());, +        assertEquals("index", docWriteRequest.index());, +        assertEquals("type", docWriteRequest.type());, +        assertEquals("test", docWriteRequest.id());, +        assertThat(docWriteRequest, instanceOf(IndexRequest.class));, +        IndexRequest request = (IndexRequest) docWriteRequest;, +        assertEquals(1, request.sourceAsMap().size());, +        assertEquals("value", request.sourceAsMap().get("field"));, +    }]