[+++ b/test/framework/src/main/java/org/elasticsearch/index/MockEngineFactoryPlugin.java, +import org.elasticsearch.common.settings.SettingsModule;, +    public void onModule(SettingsModule module) {, +        module.registerSetting(MockEngineSupport.DISABLE_FLUSH_ON_CLOSE);, +        module.registerSetting(MockEngineSupport.WRAP_READER_RATIO);, +    }, +++ b/test/framework/src/main/java/org/elasticsearch/index/MockEngineFactoryPlugin.java, +import org.elasticsearch.common.settings.SettingsModule;, +    public void onModule(SettingsModule module) {, +        module.registerSetting(MockEngineSupport.DISABLE_FLUSH_ON_CLOSE);, +        module.registerSetting(MockEngineSupport.WRAP_READER_RATIO);, +    }, +++ b/test/framework/src/main/java/org/elasticsearch/test/IndexSettingsModule.java, +import org.elasticsearch.common.regex.Regex;, +import org.elasticsearch.common.settings.IndexScopeSettings;, +import org.elasticsearch.common.settings.Setting;, +import java.util.Arrays;, +import java.util.HashSet;, +import java.util.Set;, +    public static IndexSettings newIndexSettings(String index, Settings settings, Setting<?>... setting) {, +        return newIndexSettings(new Index(index), settings, setting);, +    public static IndexSettings newIndexSettings(Index index, Settings settings, Setting<?>... setting) {, +        Set<Setting<?>> settingSet = new HashSet<>(IndexScopeSettings.BUILT_IN_INDEX_SETTINGS);, +        if (setting.length > 0) {, +            settingSet.addAll(Arrays.asList(setting));, +        }, +        return new IndexSettings(metaData, Settings.EMPTY, (idx) -> Regex.simpleMatch(idx, metaData.getIndex()), new IndexScopeSettings(Settings.EMPTY, settingSet));]