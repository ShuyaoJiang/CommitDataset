[+++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java, +        int numUniqueChildValues = scaledRandomIntBetween(100, 2000);, +        int numParentDocs = scaledRandomIntBetween(1, numUniqueChildValues);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java, +        int numUniqueChildValues = scaledRandomIntBetween(100, 2000);, +        int numParentDocs = scaledRandomIntBetween(1, numUniqueChildValues);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenQueryTests.java, +import org.apache.lucene.analysis.MockAnalyzer;, +import org.apache.lucene.util.LuceneTestCase;, +import java.util.Random;, +        final Random r = random();, +        final IndexWriterConfig iwc = LuceneTestCase.newIndexWriterConfig(r,, +                LuceneTestCase.TEST_VERSION_CURRENT, new MockAnalyzer(r)), +                .setMaxBufferedDocs(IndexWriterConfig.DISABLE_AUTO_FLUSH), +                .setRAMBufferSizeMB(scaledRandomIntBetween(16, 64)); // we might index a lot - don't go crazy here, +        RandomIndexWriter indexWriter = new RandomIndexWriter(r, directory, iwc);, +        int numUniqueChildValues = scaledRandomIntBetween(100, 2000);, +        int numParentDocs = scaledRandomIntBetween(1, numUniqueChildValues);, +            int numChildDocs = scaledRandomIntBetween(0, 100);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java, +        int numUniqueChildValues = scaledRandomIntBetween(100, 2000);, +        int numParentDocs = scaledRandomIntBetween(1, numUniqueChildValues);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenQueryTests.java, +import org.apache.lucene.analysis.MockAnalyzer;, +import org.apache.lucene.util.LuceneTestCase;, +import java.util.Random;, +        final Random r = random();, +        final IndexWriterConfig iwc = LuceneTestCase.newIndexWriterConfig(r,, +                LuceneTestCase.TEST_VERSION_CURRENT, new MockAnalyzer(r)), +                .setMaxBufferedDocs(IndexWriterConfig.DISABLE_AUTO_FLUSH), +                .setRAMBufferSizeMB(scaledRandomIntBetween(16, 64)); // we might index a lot - don't go crazy here, +        RandomIndexWriter indexWriter = new RandomIndexWriter(r, directory, iwc);, +        int numUniqueChildValues = scaledRandomIntBetween(100, 2000);, +        int numParentDocs = scaledRandomIntBetween(1, numUniqueChildValues);, +            int numChildDocs = scaledRandomIntBetween(0, 100);, +++ b/src/test/java/org/elasticsearch/index/search/child/ParentConstantScoreQueryTests.java, +        int numUniqueParentValues = scaledRandomIntBetween(100, 2000);, +        int numParentDocs = scaledRandomIntBetween(1, numUniqueParentValues);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java, +        int numUniqueChildValues = scaledRandomIntBetween(100, 2000);, +        int numParentDocs = scaledRandomIntBetween(1, numUniqueChildValues);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenQueryTests.java, +import org.apache.lucene.analysis.MockAnalyzer;, +import org.apache.lucene.util.LuceneTestCase;, +import java.util.Random;, +        final Random r = random();, +        final IndexWriterConfig iwc = LuceneTestCase.newIndexWriterConfig(r,, +                LuceneTestCase.TEST_VERSION_CURRENT, new MockAnalyzer(r)), +                .setMaxBufferedDocs(IndexWriterConfig.DISABLE_AUTO_FLUSH), +                .setRAMBufferSizeMB(scaledRandomIntBetween(16, 64)); // we might index a lot - don't go crazy here, +        RandomIndexWriter indexWriter = new RandomIndexWriter(r, directory, iwc);, +        int numUniqueChildValues = scaledRandomIntBetween(100, 2000);, +        int numParentDocs = scaledRandomIntBetween(1, numUniqueChildValues);, +            int numChildDocs = scaledRandomIntBetween(0, 100);, +++ b/src/test/java/org/elasticsearch/index/search/child/ParentConstantScoreQueryTests.java, +        int numUniqueParentValues = scaledRandomIntBetween(100, 2000);, +        int numParentDocs = scaledRandomIntBetween(1, numUniqueParentValues);, +++ b/src/test/java/org/elasticsearch/index/search/child/ParentQueryTests.java, +import org.apache.lucene.analysis.MockAnalyzer;, +import org.apache.lucene.util.LuceneTestCase;, +import java.util.Random;, +        final Random r = random();, +        final IndexWriterConfig iwc = LuceneTestCase.newIndexWriterConfig(r,, +                LuceneTestCase.TEST_VERSION_CURRENT, new MockAnalyzer(r)), +                .setMaxBufferedDocs(IndexWriterConfig.DISABLE_AUTO_FLUSH), +                .setRAMBufferSizeMB(scaledRandomIntBetween(16, 64)); // we might index a lot - don't go crazy here, +        RandomIndexWriter indexWriter = new RandomIndexWriter(r, directory, iwc);, +        int numUniqueParentValues = scaledRandomIntBetween(100, 2000);, +        int numParentDocs = scaledRandomIntBetween(1, numUniqueParentValues);, +            int numChildDocs = scaledRandomIntBetween(0, 100);, +                int numberOfUpdates = scaledRandomIntBetween(1, 5);]