[+++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    private void refreshSource() throws ElasticsearchGenerationException {, +            mappingSource = new CompressedString(bStream.bytes());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    private void refreshSource() throws ElasticsearchGenerationException {, +            mappingSource = new CompressedString(bStream.bytes());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +        return docBuilder.build(mapperService, this);, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    private void refreshSource() throws ElasticsearchGenerationException {, +            mappingSource = new CompressedString(bStream.bytes());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +        return docBuilder.build(mapperService, this);, +++ b/src/test/java/org/elasticsearch/index/mapper/camelcase/CamelCaseFieldNameTests.java, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    private void refreshSource() throws ElasticsearchGenerationException {, +            mappingSource = new CompressedString(bStream.bytes());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +        return docBuilder.build(mapperService, this);, +++ b/src/test/java/org/elasticsearch/index/mapper/camelcase/CamelCaseFieldNameTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/multifield/MultiFieldTests.java, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    private void refreshSource() throws ElasticsearchGenerationException {, +            mappingSource = new CompressedString(bStream.bytes());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +        return docBuilder.build(mapperService, this);, +++ b/src/test/java/org/elasticsearch/index/mapper/camelcase/CamelCaseFieldNameTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/multifield/MultiFieldTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/source/DefaultSourceMappingTests.java, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    private void refreshSource() throws ElasticsearchGenerationException {, +            mappingSource = new CompressedString(bStream.bytes());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +        return docBuilder.build(mapperService, this);, +++ b/src/test/java/org/elasticsearch/index/mapper/camelcase/CamelCaseFieldNameTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/multifield/MultiFieldTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/source/DefaultSourceMappingTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/timestamp/TimestampMappingTests.java, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    private void refreshSource() throws ElasticsearchGenerationException {, +            mappingSource = new CompressedString(bStream.bytes());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +        return docBuilder.build(mapperService, this);, +++ b/src/test/java/org/elasticsearch/index/mapper/camelcase/CamelCaseFieldNameTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/multifield/MultiFieldTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/source/DefaultSourceMappingTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/timestamp/TimestampMappingTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/ttl/TTLMappingTests.java, +        CompressedString mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        CompressedString mappingAfterCreation = indexService.mapperService().documentMapper("type").mappingSource();, +        CompressedString mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        CompressedString mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +    private void refreshSource() throws ElasticsearchGenerationException {, +            mappingSource = new CompressedString(bStream.bytes());, +++ b/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +        return docBuilder.build(mapperService, this);, +++ b/src/test/java/org/elasticsearch/index/mapper/camelcase/CamelCaseFieldNameTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/multifield/MultiFieldTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/source/DefaultSourceMappingTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/timestamp/TimestampMappingTests.java, +++ b/src/test/java/org/elasticsearch/index/mapper/ttl/TTLMappingTests.java, +        CompressedString mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        CompressedString mappingAfterCreation = indexService.mapperService().documentMapper("type").mappingSource();, +        CompressedString mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        CompressedString mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +        mappingAfterMerge = indexService.mapperService().documentMapper("type").mappingSource();, +++ b/src/test/java/org/elasticsearch/index/mapper/update/UpdateMappingTests.java]