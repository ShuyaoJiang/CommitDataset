[+++ b/src/main/java/org/elasticsearch/alerts/AlertManager.java, +            scheduler.stop();, +++ b/src/main/java/org/elasticsearch/alerts/AlertManager.java, +            scheduler.stop();, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionManager.java, +import org.elasticsearch.ElasticsearchIllegalStateException;, +        if (started.compareAndSet(true, false)) {, +    }, +        ensureStarted();, +    public long getQueueSize() {, +        return actionsToBeProcessed.size();, +    }, +, +    public long getLargestQueueSize() {, +        return largestQueueSize.get();, +    }, +, +        ensureStarted();, +    private void ensureStarted() {, +        if (!started.get()) {, +            throw new ElasticsearchIllegalStateException("not started");, +                        logger.info("Stopping thread to read from the job queue");]