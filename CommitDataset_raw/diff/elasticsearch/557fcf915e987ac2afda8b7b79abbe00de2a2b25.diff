[+++ b/x-pack/plugin/ccr/src/test/java/org/elasticsearch/xpack/ccr/FollowerFailOverIT.java, +import org.elasticsearch.index.mapper.DocumentMapper;, +    public void testReadRequestsReturnLatestMappingVersion() throws Exception {, +        getFollowerCluster().startDataOnlyNode(nodeAttributes);, +        followerClient().execute(PutFollowAction.INSTANCE, putFollow("leader-index", "follower-index")).get();, +        ensureFollowerGreen("follower-index");, +        try {, +            // Make sure the mapping is ready on the shard before we execute the index request; otherwise the index request, +            // will perform a dynamic mapping update which however will be blocked because the latch is remained closed., +            assertBusy(() -> {, +                DocumentMapper mapper = indexShard.mapperService().documentMapper("doc");, +                assertNotNull(mapper);, +                assertNotNull(mapper.mappers().getMapper("balance"));, +            });, +            IndexResponse indexResp = leaderCluster.client().prepareIndex("leader-index", "doc", "1"), +        } finally {, +            latch.countDown(); // no effect if latch was counted down - this makes sure teardown can make progress., +}]