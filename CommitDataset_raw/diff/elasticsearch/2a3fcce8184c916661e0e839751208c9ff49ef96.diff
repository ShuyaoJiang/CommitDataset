[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java, +import org.elasticsearch.cluster.routing.*;, +                RoutingTable routingTable = currentState.routingTable();, +                IndexRoutingTable indexRoutingTable = routingTable.index(shardRouting.index());, +                // if there is no routing table, the index has been deleted while it was being allocated, +                // which is fine, we should just ignore this, +                if (indexRoutingTable == null) {, +                    return currentState;, +                }, +                IndexRoutingTable indexRoutingTable = routingTable.index(shardRouting.index());, +                // if there is no routing table, the index has been deleted while it was being allocated, +                // which is fine, we should just ignore this, +                if (indexRoutingTable == null) {, +                    return currentState;, +                }, +                IndexShardRoutingTable indexShardRoutingTable = indexRoutingTable.shard(shardRouting.id());]