[+++ b/core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java, +    protected boolean cachable = true;, +    public void setCachable(boolean cachabe) {, +        this.cachable = cachabe;, +    }, +        markAsNotCachable();, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java, +    protected boolean cachable = true;, +    public void setCachable(boolean cachabe) {, +        this.cachable = cachabe;, +    }, +        markAsNotCachable();, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java, +    protected boolean cachable = true;, +    public void setCachable(boolean cachabe) {, +        this.cachable = cachabe;, +    }, +        markAsNotCachable();, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/RandomScoreFunctionBuilder.java, +        if (in.readBoolean()) {, +    }, +        if (seed != null) {, +            out.writeBoolean(true);, +        } else {, +            out.writeBoolean(false);, +        }, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java, +    protected boolean cachable = true;, +    public void setCachable(boolean cachabe) {, +        this.cachable = cachabe;, +    }, +        markAsNotCachable();, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/RandomScoreFunctionBuilder.java, +        if (in.readBoolean()) {, +    }, +        if (seed != null) {, +            out.writeBoolean(true);, +        } else {, +            out.writeBoolean(false);, +        }, +++ b/core/src/main/java/org/elasticsearch/search/internal/SearchContext.java, +        getQueryShardContext().setCachable(true);, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java, +    protected boolean cachable = true;, +    public void setCachable(boolean cachabe) {, +        this.cachable = cachabe;, +    }, +        markAsNotCachable();, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/RandomScoreFunctionBuilder.java, +        if (in.readBoolean()) {, +    }, +        if (seed != null) {, +            out.writeBoolean(true);, +        } else {, +            out.writeBoolean(false);, +        }, +++ b/core/src/main/java/org/elasticsearch/search/internal/SearchContext.java, +        getQueryShardContext().setCachable(true);, +++ b/core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java, +        final long nowInMillis = randomPositiveLong();, +            () -> nowInMillis);, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java, +    protected boolean cachable = true;, +    public void setCachable(boolean cachabe) {, +        this.cachable = cachabe;, +    }, +        markAsNotCachable();, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/RandomScoreFunctionBuilder.java, +        if (in.readBoolean()) {, +    }, +        if (seed != null) {, +            out.writeBoolean(true);, +        } else {, +            out.writeBoolean(false);, +        }, +++ b/core/src/main/java/org/elasticsearch/search/internal/SearchContext.java, +        getQueryShardContext().setCachable(true);, +++ b/core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java, +        final long nowInMillis = randomPositiveLong();, +            () -> nowInMillis);, +++ b/core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java, +            if (randomBoolean()) { // sometimes provide no seed, +            }, +            if (builder.getSeed() != null) {, +            }, +            } else if (builder.getScoreFunction() instanceof RandomScoreFunctionBuilder, +                && ((RandomScoreFunctionBuilder) builder.getScoreFunction()).getSeed() == null) {, +                return false;, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java, +    protected boolean cachable = true;, +    public void setCachable(boolean cachabe) {, +        this.cachable = cachabe;, +    }, +        markAsNotCachable();, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java]