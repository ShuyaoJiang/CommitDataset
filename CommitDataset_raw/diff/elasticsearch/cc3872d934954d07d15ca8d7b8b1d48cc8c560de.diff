[+++ b/server/src/main/java/org/elasticsearch/common/bytes/ByteBufferReference.java, + * direct byte buffer. The reference is composed of the space between the {@link ByteBuffer#position()} and, + * {@link ByteBuffer#limit()} at construction time. If the position or limit of the underlying byte buffer is, +++ b/server/src/main/java/org/elasticsearch/common/bytes/ByteBufferReference.java, + * direct byte buffer. The reference is composed of the space between the {@link ByteBuffer#position()} and, + * {@link ByteBuffer#limit()} at construction time. If the position or limit of the underlying byte buffer is, +++ b/server/src/main/java/org/elasticsearch/common/bytes/BytesReference.java, +        int bufferCount = buffers.length;, +        if (bufferCount == 0) {, +            return BytesArray.EMPTY;, +        } else if (bufferCount == 1) {, +            return new ByteBufferReference(buffers[0]);, +        } else {, +            ByteBufferReference[] references = new ByteBufferReference[bufferCount];, +            for (int i = 0; i < bufferCount; ++i) {, +    }, +        return compareIterators(this, other, BytesRef::compareTo);]