[+++ b/src/test/java/org/elasticsearch/bwcompat/BasicBackwardsCompatibilityTest.java, +, +        if (backwardsCluster().numNewDataNodes() == 0) {, +            backwardsCluster().startNewNode();, +        }, +        logger.info(" --> indexing [{}] docs", numDocs);, +, +        if (randomBoolean()) {, +            logger.info(" --> moving index to new nodes");, +        } else {, +            logger.info(" --> allow index to on all nodes");, +            backwardsCluster().allowOnAllNodes("test");, +        }, +, +        logger.info(" --> indexing [{}] more docs", numDocs);, +        // sometimes index while relocating, +        if (randomBoolean()) {, +            for (int i = 0; i < numDocs; i++) {, +                docs[i] = client().prepareIndex("test", "type1", randomRealisticUnicodeOfLength(10) + String.valueOf(numDocs + i)).setSource("field1", English.intToEnglish(numDocs + i));, +            }, +            indexRandom(true, docs);, +            numDocs *= 2;, +        }, +, +        logger.info(" --> waiting for relocation to complete", numDocs);, +        ensureYellow("test");// move all shards to the new node (it waits on relocation), +]