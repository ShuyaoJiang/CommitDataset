[+++ b/docs/reference/search/aggregations/metrics/tophits-aggregation.asciidoc, +, +==== top_hits support in a nested or reverse_nested aggregator, +, +coming[1.5.0], +, +If the `top_hits` aggregator is wrapped in a `nested` or `reverse_nested` aggregator then nested hits are being returned., +Nested hits are in a sense hidden mini documents that are part of regular document where in the mapping a nested field type, +has been configured. The `top_hits` aggregator has the ability to un-hide these documents if it is wrapped in a `nested`, +or `reverse_nested` aggregator. Read more about nested in the <<mapping-nested-type,nested type mapping>>., +, +If nested type has been configured a single document is actually indexed as multiple Lucene documents and they share, +the same id. In order to determine the identity of a nested hit there is more needed than just the id, so that is why, +nested hits also include their nested identity. The nested identity is kept under the `_nested` field in the search hit, +and includes the array field and the offset in the array field the nested hit belongs to. The offset is zero based., +, +Top hits response snippet with a nested hit, which resides in the third slot of array field `nested_field1` in document with id `1`:, +, +[source,js], +--------------------------------------------------, +..., +"hits": {, + "total": 25365,, + "max_score": 1,, + "hits": [, +   {, +     "_index": "a",, +     "_type": "b",, +     "_id": "1",, +     "_score": 1,, +     "_nested" : {, +       "field" : "nested_field1",, +       "offset" : 2, +     }, +     "_source": ..., +   },, +   ..., + ], +}, +..., +--------------------------------------------------, +, +If `_source` is requested then just the part of the source of the nested object is returned, not the entire source of the document., +Also stored fields on the *nested* inner object level are accessible via `top_hits` aggregator residing in a `nested` or `reverse_nested` aggregator., +, +Only nested hits will have a `_nested` field in the hit, non nested (regular) hits will not have a `_nested` field., +, +The information in `_nested` can also be used to parse the original source somewhere else if `_source` isn't enabled., +, +If there are multiple levels of nested object types defined in mappings then the `_nested` information can also be hierarchical, +in order to express the identity of nested hits that are two layers deep or more., +, +In the example below a nested hit resides in the first slot of the field `nested_grand_child_field` which then resides in, +the second slow of the `nested_child_field` field:, +, +[source,js], +--------------------------------------------------, +..., +"hits": {, + "total": 2565,, + "max_score": 1,, + "hits": [, +   {, +     "_index": "a",, +     "_type": "b",, +     "_id": "1",, +     "_score": 1,, +     "_nested" : {, +       "field" : "nested_child_field",, +       "offset" : 1,, +       "_nested" : {, +         "field" : "nested_grand_child_field",, +         "offset" : 0, +       }, +     }, +     "_source": ..., +   },, +   ..., + ], +}, +..., +--------------------------------------------------, +++ b/docs/reference/search/aggregations/metrics/tophits-aggregation.asciidoc, +, +==== top_hits support in a nested or reverse_nested aggregator, +, +coming[1.5.0], +, +If the `top_hits` aggregator is wrapped in a `nested` or `reverse_nested` aggregator then nested hits are being returned., +Nested hits are in a sense hidden mini documents that are part of regular document where in the mapping a nested field type, +has been configured. The `top_hits` aggregator has the ability to un-hide these documents if it is wrapped in a `nested`, +or `reverse_nested` aggregator. Read more about nested in the <<mapping-nested-type,nested type mapping>>., +, +If nested type has been configured a single document is actually indexed as multiple Lucene documents and they share, +the same id. In order to determine the identity of a nested hit there is more needed than just the id, so that is why, +nested hits also include their nested identity. The nested identity is kept under the `_nested` field in the search hit, +and includes the array field and the offset in the array field the nested hit belongs to. The offset is zero based., +, +Top hits response snippet with a nested hit, which resides in the third slot of array field `nested_field1` in document with id `1`:, +]