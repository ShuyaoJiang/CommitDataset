[+++ b/qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/RecoveryIT.java, +            Request shardStatsRequest = new Request("GET", index + "/_stats");, +            shardStatsRequest.addParameter("level", "shards");, +            Response response = client().performRequest(shardStatsRequest);, +            Request indexDoc = new Request("PUT", index + "/test/" + id);, +            indexDoc.setJsonEntity("{\"test\": \"test_" + randomAsciiOfLength(2) + "\"}");, +            client().performRequest(indexDoc);, +        Response response = client().performRequest(new Request("GET", "_nodes"));, +                client().performRequest(new Request("POST", index + "/_refresh"));, +                client().performRequest(new Request("POST", index + "/_refresh"));, +        final Request request = new Request("GET", index + "/_count");, +        request.addParameter("preference", preference);, +        final Response response = client().performRequest(request);, +        Response response = client().performRequest(new Request("GET", "_nodes"));, +                client().performRequest(new Request("POST", index + "/_refresh"));, +                client().performRequest(new Request("POST", index + "/_refresh"));, +                Response response = client().performRequest(new Request("GET", "_nodes"));]