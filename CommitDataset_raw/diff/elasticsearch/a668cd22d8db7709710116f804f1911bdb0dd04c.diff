[+++ b/src/test/java/org/elasticsearch/gateway/local/QuorumLocalGatewayTests.java, +import static org.hamcrest.Matchers.notNullValue;, +        assertThat(awaitBusy(new Predicate<Object>() {, +            @Override, +            public boolean apply(Object input) {, +                return clusterStateResponse.getState() != null;, +            }}), equalTo(true)); // wait until we get a cluster state - could be null if we quick enough., +        final ClusterStateResponse clusterStateResponse = cluster().smartClient().admin().cluster().prepareState().setMasterNodeTimeout("500ms").get();, +        assertThat(clusterStateResponse.getState(), notNullValue());, +        assertThat(clusterStateResponse.getState().routingTable().index("test"), notNullValue());]