[+++ b/src/main/java/org/elasticsearch/common/geo/GeoHashUtils.java, +            // xLimit and YLimit must always be respectively 7 and 3, +            // since x and y semantics are swapping on each level., +            if (nx >= 0 && nx <= 7 && ny >= 0 && ny <= 3) {, +++ b/src/main/java/org/elasticsearch/common/geo/GeoHashUtils.java, +            // xLimit and YLimit must always be respectively 7 and 3, +            // since x and y semantics are swapping on each level., +            if (nx >= 0 && nx <= 7 && ny >= 0 && ny <= 3) {, +++ b/src/test/java/org/elasticsearch/index/search/geo/GeoHashUtilsTests.java, +, +        // Border odd geohash, +        geohash = "u09x";, +        expectedNeighbors = new ArrayList<>();, +        expectedNeighbors.add("u0c2");, +        expectedNeighbors.add("u0c8");, +        expectedNeighbors.add("u0cb");, +        expectedNeighbors.add("u09r");, +        expectedNeighbors.add("u09z");, +        expectedNeighbors.add("u09q");, +        expectedNeighbors.add("u09w");, +        expectedNeighbors.add("u09y");, +        neighbors = new ArrayList<>();, +        GeoHashUtils.addNeighbors(geohash, neighbors );, +        assertEquals(expectedNeighbors, neighbors);, +, +        // Border even geohash, +        geohash = "u09tv";, +        expectedNeighbors = new ArrayList<>();, +        expectedNeighbors.add("u09wh");, +        expectedNeighbors.add("u09wj");, +        expectedNeighbors.add("u09wn");, +        expectedNeighbors.add("u09tu");, +        expectedNeighbors.add("u09ty");, +        expectedNeighbors.add("u09ts");, +        expectedNeighbors.add("u09tt");, +        expectedNeighbors.add("u09tw");, +        neighbors = new ArrayList<>();, +        GeoHashUtils.addNeighbors(geohash, neighbors );, +        assertEquals(expectedNeighbors, neighbors);]