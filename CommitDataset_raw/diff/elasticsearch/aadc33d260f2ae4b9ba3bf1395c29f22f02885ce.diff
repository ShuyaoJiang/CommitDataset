[+++ b/core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java, +            String newOp = (String) context.remove("op");, +            request.setSource((Map<String, Object>) context.remove(SourceFieldMapper.NAME));, +            Object newValue = context.remove(IndexFieldMapper.NAME);, +            newValue = context.remove(TypeFieldMapper.NAME);, +            newValue = context.remove(IdFieldMapper.NAME);, +            newValue = context.remove(VersionFieldMapper.NAME);, +            newValue = context.remove(ParentFieldMapper.NAME);, +            newValue = context.remove(RoutingFieldMapper.NAME);, +            if (false == context.isEmpty()) {, +                throw new IllegalArgumentException("Invalid fields added to context [" + String.join(",", context.keySet()) + ']');, +++ b/core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java, +            String newOp = (String) context.remove("op");, +            request.setSource((Map<String, Object>) context.remove(SourceFieldMapper.NAME));, +            Object newValue = context.remove(IndexFieldMapper.NAME);, +            newValue = context.remove(TypeFieldMapper.NAME);, +            newValue = context.remove(IdFieldMapper.NAME);, +            newValue = context.remove(VersionFieldMapper.NAME);, +            newValue = context.remove(ParentFieldMapper.NAME);, +            newValue = context.remove(RoutingFieldMapper.NAME);, +            if (false == context.isEmpty()) {, +                throw new IllegalArgumentException("Invalid fields added to context [" + String.join(",", context.keySet()) + ']');, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java, +            String newOp = (String) context.remove("op");, +            request.setSource((Map<String, Object>) context.remove(SourceFieldMapper.NAME));, +            Object newValue = context.remove(IndexFieldMapper.NAME);, +            newValue = context.remove(TypeFieldMapper.NAME);, +            newValue = context.remove(IdFieldMapper.NAME);, +            newValue = context.remove(VersionFieldMapper.NAME);, +            newValue = context.remove(ParentFieldMapper.NAME);, +            newValue = context.remove(RoutingFieldMapper.NAME);, +            if (false == context.isEmpty()) {, +                throw new IllegalArgumentException("Invalid fields added to context [" + String.join(",", context.keySet()) + ']');, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +++ b/core/src/main/java/org/elasticsearch/script/ExecutableScript.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java, +            String newOp = (String) context.remove("op");, +            request.setSource((Map<String, Object>) context.remove(SourceFieldMapper.NAME));, +            Object newValue = context.remove(IndexFieldMapper.NAME);, +            newValue = context.remove(TypeFieldMapper.NAME);, +            newValue = context.remove(IdFieldMapper.NAME);, +            newValue = context.remove(VersionFieldMapper.NAME);, +            newValue = context.remove(ParentFieldMapper.NAME);, +            newValue = context.remove(RoutingFieldMapper.NAME);, +            if (false == context.isEmpty()) {, +                throw new IllegalArgumentException("Invalid fields added to context [" + String.join(",", context.keySet()) + ']');, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +++ b/core/src/main/java/org/elasticsearch/script/ExecutableScript.java, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/ScriptFieldsFetchSubPhase.java, +                value = leafScript.run();, +++ b/core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java, +            String newOp = (String) context.remove("op");, +            request.setSource((Map<String, Object>) context.remove(SourceFieldMapper.NAME));, +            Object newValue = context.remove(IndexFieldMapper.NAME);, +            newValue = context.remove(TypeFieldMapper.NAME);, +            newValue = context.remove(IdFieldMapper.NAME);, +            newValue = context.remove(VersionFieldMapper.NAME);, +            newValue = context.remove(ParentFieldMapper.NAME);, +            newValue = context.remove(RoutingFieldMapper.NAME);, +            if (false == context.isEmpty()) {, +                throw new IllegalArgumentException("Invalid fields added to context [" + String.join(",", context.keySet()) + ']');, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +++ b/core/src/main/java/org/elasticsearch/script/ExecutableScript.java, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/ScriptFieldsFetchSubPhase.java, +                value = leafScript.run();, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java, +            String newOp = (String) context.remove("op");, +            request.setSource((Map<String, Object>) context.remove(SourceFieldMapper.NAME));, +            Object newValue = context.remove(IndexFieldMapper.NAME);, +            newValue = context.remove(TypeFieldMapper.NAME);, +            newValue = context.remove(IdFieldMapper.NAME);, +            newValue = context.remove(VersionFieldMapper.NAME);, +            newValue = context.remove(ParentFieldMapper.NAME);, +            newValue = context.remove(RoutingFieldMapper.NAME);, +            if (false == context.isEmpty()) {, +                throw new IllegalArgumentException("Invalid fields added to context [" + String.join(",", context.keySet()) + ']');, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +++ b/core/src/main/java/org/elasticsearch/script/ExecutableScript.java, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/ScriptFieldsFetchSubPhase.java, +                value = leafScript.run();, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java, +++ b/core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java, +            String newOp = (String) context.remove("op");, +            request.setSource((Map<String, Object>) context.remove(SourceFieldMapper.NAME));, +            Object newValue = context.remove(IndexFieldMapper.NAME);, +            newValue = context.remove(TypeFieldMapper.NAME);, +            newValue = context.remove(IdFieldMapper.NAME);, +            newValue = context.remove(VersionFieldMapper.NAME);, +            newValue = context.remove(ParentFieldMapper.NAME);, +            newValue = context.remove(RoutingFieldMapper.NAME);, +            if (false == context.isEmpty()) {, +                throw new IllegalArgumentException("Invalid fields added to context [" + String.join(",", context.keySet()) + ']');, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +++ b/core/src/main/java/org/elasticsearch/script/ExecutableScript.java, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/ScriptFieldsFetchSubPhase.java, +                value = leafScript.run();, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java]