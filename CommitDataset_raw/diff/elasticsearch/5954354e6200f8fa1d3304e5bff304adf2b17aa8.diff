[+++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/ShardFollowNodeTask.java, +            this.fetchExceptions = Objects.requireNonNull(fetchExceptions);, +                    numberOfFailedBulkOperations == that.numberOfFailedBulkOperations &&, +                    numberOfOperationsIndexed == that.numberOfOperationsIndexed &&, +                    /*, +                     * ElasticsearchException does not implement equals so we will assume the fetch exceptions are equal if they are equal, +                     * up to the key set and their messages.  Note that we are relying on the fact that the fetch exceptions are ordered by, +                     * keys., +                     */, +                    fetchExceptions.keySet().equals(that.fetchExceptions.keySet()) &&, +                    getFetchExceptionMessages(this).equals(getFetchExceptionMessages(that));, +                    numberOfFailedBulkOperations,, +                    numberOfOperationsIndexed,, +                    /*, +                     * ElasticsearchException does not implement hash code so we will compute the hash code based on the key set and the, +                     * messages. Note that we are relying on the fact that the fetch exceptions are ordered by keys., +                     */, +                    fetchExceptions.keySet(),, +                    getFetchExceptionMessages(this));, +        }, +        private static List<String> getFetchExceptionMessages(final Status status) {, +            return status.fetchExceptions().values().stream().map(ElasticsearchException::getMessage).collect(Collectors.toList());]