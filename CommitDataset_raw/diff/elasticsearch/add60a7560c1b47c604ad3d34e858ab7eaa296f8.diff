[+++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                    performOnReplica(shard, shard.currentNodeId());, +                    performOnReplica(shard, shard.relocatingNodeId());, +        void performOnReplica(final ShardRouting shard, final String nodeId) {, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                    performOnReplica(shard, shard.currentNodeId());, +                    performOnReplica(shard, shard.relocatingNodeId());, +        void performOnReplica(final ShardRouting shard, final String nodeId) {, +++ b/core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                    performOnReplica(shard, shard.currentNodeId());, +                    performOnReplica(shard, shard.relocatingNodeId());, +        void performOnReplica(final ShardRouting shard, final String nodeId) {, +++ b/core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java, +++ b/core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java, +        assertThat(capturedRequests.length, equalTo(assignedReplicas));, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                    performOnReplica(shard, shard.currentNodeId());, +                    performOnReplica(shard, shard.relocatingNodeId());, +        void performOnReplica(final ShardRouting shard, final String nodeId) {, +++ b/core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java, +++ b/core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java, +        assertThat(capturedRequests.length, equalTo(assignedReplicas));, +++ b/core/src/test/java/org/elasticsearch/percolator/ConcurrentPercolatorIT.java, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                    performOnReplica(shard, shard.currentNodeId());, +                    performOnReplica(shard, shard.relocatingNodeId());, +        void performOnReplica(final ShardRouting shard, final String nodeId) {, +++ b/core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java, +++ b/core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java, +        assertThat(capturedRequests.length, equalTo(assignedReplicas));, +++ b/core/src/test/java/org/elasticsearch/percolator/ConcurrentPercolatorIT.java, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +++ b/core/src/test/java/org/elasticsearch/search/geo/GeoShapeQueryTests.java, +        client().admin().indices().prepareCreate("test").addMapping("type", "location", "type=geo_shape"), +        Rectangle mbr = xRandomRectangle(getRandom(), xRandomPoint(getRandom()));, +        client().admin().indices().prepareCreate("test").addMapping("type", "location", "type=geo_shape"), +                .relation(ShapeRelation.INTERSECTS);, +        client().admin().indices().prepareCreate("test").addMapping("type", "location", "type=geo_shape"), +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                    performOnReplica(shard, shard.currentNodeId());, +                    performOnReplica(shard, shard.relocatingNodeId());, +        void performOnReplica(final ShardRouting shard, final String nodeId) {, +++ b/core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java, +++ b/core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java, +        assertThat(capturedRequests.length, equalTo(assignedReplicas));, +++ b/core/src/test/java/org/elasticsearch/percolator/ConcurrentPercolatorIT.java, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +++ b/core/src/test/java/org/elasticsearch/search/geo/GeoShapeQueryTests.java, +        client().admin().indices().prepareCreate("test").addMapping("type", "location", "type=geo_shape"), +        Rectangle mbr = xRandomRectangle(getRandom(), xRandomPoint(getRandom()));, +        client().admin().indices().prepareCreate("test").addMapping("type", "location", "type=geo_shape"), +                .relation(ShapeRelation.INTERSECTS);, +        client().admin().indices().prepareCreate("test").addMapping("type", "location", "type=geo_shape"), +++ b/core/src/test/java/org/elasticsearch/search/highlight/HighlighterSearchIT.java, +, +        indexRandom(true, client().prepareIndex("test", "type1"), +                .setSource("field1", "this is a test", "field2", "The quick brown fox jumps over the lazy dog"));, +, +        logger.info("--> searching with boundary characters");, +        source = searchSource(), +                .query(matchQuery("field2", "quick")), +                .highlighter(highlight().field("field2", 30, 1).boundaryChars(new char[] {' '}));, +, +        searchResponse = client().prepareSearch("test").setSource(source).get();, +, +        assertHighlight(searchResponse, 0, "field2", 0, 1, equalTo("The <em>quick</em> brown fox jumps over"));, +, +        logger.info("--> searching with boundary characters on the field");, +        source = searchSource(), +                .query(matchQuery("field2", "quick")), +                .highlighter(highlight().field(new Field("field2").fragmentSize(30).numOfFragments(1).boundaryChars(new char[] {' '})));, +, +        searchResponse = client().prepareSearch("test").setSource(source).get();, +, +        assertHighlight(searchResponse, 0, "field2", 0, 1, equalTo("The <em>quick</em> brown fox jumps over"));, +, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +                    performOnReplica(shard, shard.currentNodeId());, +                    performOnReplica(shard, shard.relocatingNodeId());, +        void performOnReplica(final ShardRouting shard, final String nodeId) {, +++ b/core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java, +++ b/core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java, +        assertThat(capturedRequests.length, equalTo(assignedReplicas));, +++ b/core/src/test/java/org/elasticsearch/percolator/ConcurrentPercolatorIT.java, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +                                    assertThat(response.getMatches().length, greaterThanOrEqualTo(atLeastExpected));, +++ b/core/src/test/java/org/elasticsearch/search/geo/GeoShapeQueryTests.java, +        client().admin().indices().prepareCreate("test").addMapping("type", "location", "type=geo_shape"), +        Rectangle mbr = xRandomRectangle(getRandom(), xRandomPoint(getRandom()));, +        client().admin().indices().prepareCreate("test").addMapping("type", "location", "type=geo_shape"), +                .relation(ShapeRelation.INTERSECTS);]