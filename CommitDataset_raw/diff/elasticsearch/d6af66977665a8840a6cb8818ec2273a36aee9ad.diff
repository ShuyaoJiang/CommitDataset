[+++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/CancelTasksRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/CancelTasksRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java, +import org.elasticsearch.tasks.TaskId;, +        if (request.taskId().isSet() == false) {, +            CancellableTask task = taskManager.getCancellableTask(request.taskId().getId());, +                if (taskManager.getTask(request.taskId().getId()) != null) {, +        sendSetBanRequest(nodes,, +            BanParentTaskRequest.createSetBanParentTaskRequest(new TaskId(clusterService.localNode().getId(), task.getId()), reason),, +            banLock);, +        sendRemoveBanRequest(nodes,, +            BanParentTaskRequest.createRemoveBanParentTaskRequest(new TaskId(clusterService.localNode().getId(), task.getId())));, +                logger.debug("Sending ban for tasks with the parent [{}] to the node [{}], ban [{}]", request.parentTaskId, node,, +                    request.ban);, +                logger.debug("Cannot send ban for tasks with the parent [{}] to the node [{}] - the node no longer in the cluster",, +                    request.parentTaskId, node);, +                logger.debug("Sending remove ban for tasks with the parent [{}] to the node [{}]", request.parentTaskId, node);, +                logger.debug("Cannot send remove ban request for tasks with the parent [{}] to the node [{}] - the node no longer in " +, +                    "the cluster", request.parentTaskId, node);, +        private TaskId parentTaskId;, +        static BanParentTaskRequest createSetBanParentTaskRequest(TaskId parentTaskId, String reason) {, +            return new BanParentTaskRequest(parentTaskId, reason);, +        }, +, +        static BanParentTaskRequest createRemoveBanParentTaskRequest(TaskId parentTaskId) {, +            return new BanParentTaskRequest(parentTaskId);, +        }, +, +        private BanParentTaskRequest(TaskId parentTaskId, String reason) {, +        private BanParentTaskRequest(TaskId parentTaskId) {, +            parentTaskId = new TaskId(in);, +            parentTaskId.writeTo(out);, +                logger.debug("Received ban for the parent [{}] on the node [{}], reason: [{}]", request.parentTaskId,, +                    clusterService.localNode().getId(), request.reason);, +                taskManager.setBan(request.parentTaskId, request.reason);, +                logger.debug("Removing ban for the parent [{}] on the node [{}]", request.parentTaskId,, +                taskManager.removeBan(request.parentTaskId);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/CancelTasksRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java, +import org.elasticsearch.tasks.TaskId;, +        if (request.taskId().isSet() == false) {, +            CancellableTask task = taskManager.getCancellableTask(request.taskId().getId());, +                if (taskManager.getTask(request.taskId().getId()) != null) {, +        sendSetBanRequest(nodes,, +            BanParentTaskRequest.createSetBanParentTaskRequest(new TaskId(clusterService.localNode().getId(), task.getId()), reason),, +            banLock);, +        sendRemoveBanRequest(nodes,, +            BanParentTaskRequest.createRemoveBanParentTaskRequest(new TaskId(clusterService.localNode().getId(), task.getId())));, +                logger.debug("Sending ban for tasks with the parent [{}] to the node [{}], ban [{}]", request.parentTaskId, node,, +                    request.ban);, +                logger.debug("Cannot send ban for tasks with the parent [{}] to the node [{}] - the node no longer in the cluster",, +                    request.parentTaskId, node);, +                logger.debug("Sending remove ban for tasks with the parent [{}] to the node [{}]", request.parentTaskId, node);, +                logger.debug("Cannot send remove ban request for tasks with the parent [{}] to the node [{}] - the node no longer in " +, +                    "the cluster", request.parentTaskId, node);, +        private TaskId parentTaskId;, +        static BanParentTaskRequest createSetBanParentTaskRequest(TaskId parentTaskId, String reason) {, +            return new BanParentTaskRequest(parentTaskId, reason);, +        }, +, +        static BanParentTaskRequest createRemoveBanParentTaskRequest(TaskId parentTaskId) {, +            return new BanParentTaskRequest(parentTaskId);, +        }, +, +        private BanParentTaskRequest(TaskId parentTaskId, String reason) {, +        private BanParentTaskRequest(TaskId parentTaskId) {, +            parentTaskId = new TaskId(in);, +            parentTaskId.writeTo(out);, +                logger.debug("Received ban for the parent [{}] on the node [{}], reason: [{}]", request.parentTaskId,, +                    clusterService.localNode().getId(), request.reason);, +                taskManager.setBan(request.parentTaskId, request.reason);, +                logger.debug("Removing ban for the parent [{}] on the node [{}]", request.parentTaskId,, +                taskManager.removeBan(request.parentTaskId);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/ListTasksRequest.java, +     * Should the detailed task information be returned., +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/CancelTasksRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java, +import org.elasticsearch.tasks.TaskId;, +        if (request.taskId().isSet() == false) {, +            CancellableTask task = taskManager.getCancellableTask(request.taskId().getId());, +                if (taskManager.getTask(request.taskId().getId()) != null) {, +        sendSetBanRequest(nodes,, +            BanParentTaskRequest.createSetBanParentTaskRequest(new TaskId(clusterService.localNode().getId(), task.getId()), reason),, +            banLock);, +        sendRemoveBanRequest(nodes,, +            BanParentTaskRequest.createRemoveBanParentTaskRequest(new TaskId(clusterService.localNode().getId(), task.getId())));, +                logger.debug("Sending ban for tasks with the parent [{}] to the node [{}], ban [{}]", request.parentTaskId, node,, +                    request.ban);, +                logger.debug("Cannot send ban for tasks with the parent [{}] to the node [{}] - the node no longer in the cluster",, +                    request.parentTaskId, node);, +                logger.debug("Sending remove ban for tasks with the parent [{}] to the node [{}]", request.parentTaskId, node);, +                logger.debug("Cannot send remove ban request for tasks with the parent [{}] to the node [{}] - the node no longer in " +, +                    "the cluster", request.parentTaskId, node);, +        private TaskId parentTaskId;, +        static BanParentTaskRequest createSetBanParentTaskRequest(TaskId parentTaskId, String reason) {, +            return new BanParentTaskRequest(parentTaskId, reason);, +        }, +, +        static BanParentTaskRequest createRemoveBanParentTaskRequest(TaskId parentTaskId) {, +            return new BanParentTaskRequest(parentTaskId);]