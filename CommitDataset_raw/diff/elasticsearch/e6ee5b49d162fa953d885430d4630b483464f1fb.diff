[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClientStep.java, +    public ClientStep(String name, String action, String phase, String index, StepKey nextStepKey, RequestBuilder requestBuilder,, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClientStep.java, +    public ClientStep(String name, String action, String phase, String index, StepKey nextStepKey, RequestBuilder requestBuilder,, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClusterStateUpdateStep.java, +    public ClusterStateUpdateStep(String name, String index, String phase, String action, StepKey nextStepKey, Function<ClusterState, ClusterState> updateTask) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClientStep.java, +    public ClientStep(String name, String action, String phase, String index, StepKey nextStepKey, RequestBuilder requestBuilder,, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClusterStateUpdateStep.java, +    public ClusterStateUpdateStep(String name, String index, String phase, String action, StepKey nextStepKey, Function<ClusterState, ClusterState> updateTask) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ConditionalWaitStep.java, +    public ConditionalWaitStep(String name, String phase, String action, StepKey nextStepKey, Function<ClusterState, Boolean> condition) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClientStep.java, +    public ClientStep(String name, String action, String phase, String index, StepKey nextStepKey, RequestBuilder requestBuilder,, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClusterStateUpdateStep.java, +    public ClusterStateUpdateStep(String name, String index, String phase, String action, StepKey nextStepKey, Function<ClusterState, ClusterState> updateTask) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ConditionalWaitStep.java, +    public ConditionalWaitStep(String name, String phase, String action, StepKey nextStepKey, Function<ClusterState, Boolean> condition) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/PhaseAfterStep.java, +    public PhaseAfterStep(String phase, String action, String name, TimeValue after, StepKey nextStepKey) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClientStep.java, +    public ClientStep(String name, String action, String phase, String index, StepKey nextStepKey, RequestBuilder requestBuilder,, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClusterStateUpdateStep.java, +    public ClusterStateUpdateStep(String name, String index, String phase, String action, StepKey nextStepKey, Function<ClusterState, ClusterState> updateTask) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ConditionalWaitStep.java, +    public ConditionalWaitStep(String name, String phase, String action, StepKey nextStepKey, Function<ClusterState, Boolean> condition) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/PhaseAfterStep.java, +    public PhaseAfterStep(String phase, String action, String name, TimeValue after, StepKey nextStepKey) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/Step.java, +    private final StepKey nextStepKey;, +    public Step(String name, String action, String phase, StepKey nextStepKey) {, +        this.nextStepKey = nextStepKey;, +    public StepKey getNextStepKey() {, +        return nextStepKey;, +        return nextStepKey != null;, +            .put(LifecycleSettings.LIFECYCLE_PHASE, nextStepKey.getPhase()), +            .put(LifecycleSettings.LIFECYCLE_ACTION, nextStepKey.getAction()), +            .put(LifecycleSettings.LIFECYCLE_STEP, nextStepKey.getName()), +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClientStep.java, +    public ClientStep(String name, String action, String phase, String index, StepKey nextStepKey, RequestBuilder requestBuilder,, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ClusterStateUpdateStep.java, +    public ClusterStateUpdateStep(String name, String index, String phase, String action, StepKey nextStepKey, Function<ClusterState, ClusterState> updateTask) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/ConditionalWaitStep.java, +    public ConditionalWaitStep(String name, String phase, String action, StepKey nextStepKey, Function<ClusterState, Boolean> condition) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/PhaseAfterStep.java, +    public PhaseAfterStep(String phase, String action, String name, TimeValue after, StepKey nextStepKey) {, +        super(name, action, phase, nextStepKey);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/Step.java, +    private final StepKey nextStepKey;, +    public Step(String name, String action, String phase, StepKey nextStepKey) {, +        this.nextStepKey = nextStepKey;, +    public StepKey getNextStepKey() {, +        return nextStepKey;, +        return nextStepKey != null;, +            .put(LifecycleSettings.LIFECYCLE_PHASE, nextStepKey.getPhase()), +            .put(LifecycleSettings.LIFECYCLE_ACTION, nextStepKey.getAction()), +            .put(LifecycleSettings.LIFECYCLE_STEP, nextStepKey.getName()), +++ b/x-pack/plugin/index-lifecycle/src/main/java/org/elasticsearch/xpack/indexlifecycle/IndexLifecycleService.java, +                        return executeStepUntilAsync(policyName, currentStep, clusterState, client, nowSupplier, idxMeta.getIndex());, +    private ClusterState executeStepUntilAsync(String policyName, Step startStep, ClusterState currentState, Client client, LongSupplier nowSupplier, Index index) {, +            startStep = policyRegistry.getStep(policyName, startStep.getNextStepKey());]