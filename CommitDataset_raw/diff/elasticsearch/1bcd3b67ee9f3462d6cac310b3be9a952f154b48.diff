[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/broadcast/TransportBroadcastPingAction.java, +        return clusterService.operationRouting().searchShards(clusterState, request.indices(), request.queryHint(), null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/broadcast/TransportBroadcastPingAction.java, +        return clusterService.operationRouting().searchShards(clusterState, request.indices(), request.queryHint(), null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/count/TransportCountAction.java, +        return clusterService.operationRouting().searchShards(clusterState, request.indices(), request.queryHint(), request.routing(), null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/broadcast/TransportBroadcastPingAction.java, +        return clusterService.operationRouting().searchShards(clusterState, request.indices(), request.queryHint(), null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/count/TransportCountAction.java, +        return clusterService.operationRouting().searchShards(clusterState, request.indices(), request.queryHint(), request.routing(), null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/get/GetRequest.java, +    /**, +     * Sets the preference to execute the search. Defaults to randomize across shards. Can be set to, +     * <tt>_local</tt> to prefer local shards, <tt>_primary</tt> to execute only on primary shards, or, +     * a custom value, which guarantees that the same order will be used across different requests., +     */, +    public GetRequest preference(String preference) {, +        this.preference = preference;, +        return this;, +    }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/broadcast/TransportBroadcastPingAction.java, +        return clusterService.operationRouting().searchShards(clusterState, request.indices(), request.queryHint(), null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/count/TransportCountAction.java, +        return clusterService.operationRouting().searchShards(clusterState, request.indices(), request.queryHint(), request.routing(), null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/get/GetRequest.java, +    /**, +     * Sets the preference to execute the search. Defaults to randomize across shards. Can be set to, +     * <tt>_local</tt> to prefer local shards, <tt>_primary</tt> to execute only on primary shards, or, +     * a custom value, which guarantees that the same order will be used across different requests., +     */, +    public GetRequest preference(String preference) {, +        this.preference = preference;, +        return this;, +    }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/SearchRequest.java, +    @Nullable private String preference;, +     * Sets the preference to execute the search. Defaults to randomize across shards. Can be set to, +     * <tt>_local</tt> to prefer local shards, <tt>_primary</tt> to execute only on primary shards, or, +     * a custom value, which guarantees that the same order will be used across different requests., +     */, +    public SearchRequest preference(String preference) {, +        this.preference = preference;, +        return this;, +    }, +, +    public String preference() {, +        return this.preference;, +    }, +, +    /**, +        if (in.readBoolean()) {, +            preference = in.readUTF();, +        }, +        if (preference == null) {, +            out.writeBoolean(false);, +        } else {, +            out.writeBoolean(true);, +            out.writeUTF(preference);, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/broadcast/TransportBroadcastPingAction.java, +        return clusterService.operationRouting().searchShards(clusterState, request.indices(), request.queryHint(), null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/count/TransportCountAction.java, +        return clusterService.operationRouting().searchShards(clusterState, request.indices(), request.queryHint(), request.routing(), null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/get/GetRequest.java, +    /**, +     * Sets the preference to execute the search. Defaults to randomize across shards. Can be set to, +     * <tt>_local</tt> to prefer local shards, <tt>_primary</tt> to execute only on primary shards, or, +     * a custom value, which guarantees that the same order will be used across different requests., +     */, +    public GetRequest preference(String preference) {, +        this.preference = preference;, +        return this;, +    }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/SearchRequest.java, +    @Nullable private String preference;, +     * Sets the preference to execute the search. Defaults to randomize across shards. Can be set to, +     * <tt>_local</tt> to prefer local shards, <tt>_primary</tt> to execute only on primary shards, or, +     * a custom value, which guarantees that the same order will be used across different requests., +     */, +    public SearchRequest preference(String preference) {, +        this.preference = preference;, +        return this;, +    }, +, +    public String preference() {, +        return this.preference;, +    }, +, +    /**, +        if (in.readBoolean()) {, +            preference = in.readUTF();, +        }, +        if (preference == null) {, +            out.writeBoolean(false);, +        } else {, +            out.writeBoolean(true);, +            out.writeUTF(preference);, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java, +                GroupShardsIterator groupIt = clusterService.operationRouting().searchShards(clusterState, searchRequest.indices(), searchRequest.queryHint(), searchRequest.routing(), searchRequest.preference());]