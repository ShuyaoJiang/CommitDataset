[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/transport/InetSocketTransportAddress.java, +import java.net.Inet6Address;, +        if (in.readByte() == 0) {, +            int len = in.readByte();, +            byte[] a = new byte[len]; // 4 bytes (IPv4) or 16 bytes (IPv6), +            in.readFully(a);, +            InetAddress inetAddress;, +            if (len == 16) {, +                int scope_id = in.readInt();, +                inetAddress = Inet6Address.getByAddress(null, a, scope_id);, +            } else {, +                inetAddress = InetAddress.getByAddress(a);, +            }, +            int port = in.readInt();, +            this.address = new InetSocketAddress(inetAddress, port);, +        } else {, +            this.address = new InetSocketAddress(in.readUTF(), in.readInt());, +        }, +            out.writeByte((byte) 0);, +            byte[] bytes = address().getAddress().getAddress();  // 4 bytes (IPv4) or 16 bytes (IPv6), +            out.writeByte((byte) bytes.length); // 1 byte, +            out.write(bytes, 0, bytes.length);, +            if (address().getAddress() instanceof Inet6Address), +                out.writeInt(((Inet6Address) address.getAddress()).getScopeId());, +            out.writeByte((byte) 1);]