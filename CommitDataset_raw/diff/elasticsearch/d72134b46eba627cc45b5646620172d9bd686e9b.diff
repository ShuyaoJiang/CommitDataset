[+++ b/core/src/main/java/org/elasticsearch/search/suggest/completion2x/CompletionTokenStream.java, +import org.apache.lucene.util.AttributeImpl;, +import org.apache.lucene.util.AttributeReflector;, +import org.apache.lucene.util.CharsRefBuilder;, +    public static interface ToFiniteStrings {, +        public Set<IntsRef> toFiniteStrings(TokenStream stream) throws IOException;, +, +    public static final class ByteTermAttributeImpl extends AttributeImpl implements ByteTermAttribute, TermToBytesRefAttribute {, +        private final BytesRefBuilder bytes = new BytesRefBuilder();, +        private CharsRefBuilder charsRef;, +, +        @Override, +        public BytesRefBuilder builder() {, +            return bytes;, +        }, +, +        @Override, +        public BytesRef getBytesRef() {, +            return bytes.get();, +        }, +, +        @Override, +        public void clear() {, +            bytes.clear();, +        }, +, +        @Override, +        public void reflectWith(AttributeReflector reflector) {, +, +        }, +, +        @Override, +        public void copyTo(AttributeImpl target) {, +            ByteTermAttributeImpl other = (ByteTermAttributeImpl) target;, +            other.bytes.copyBytes(bytes);, +        }, +, +        @Override, +        public CharSequence toUTF16() {, +            if (charsRef == null) {, +                charsRef = new CharsRefBuilder();, +            }, +            charsRef.copyUTF8Bytes(getBytesRef());, +            return charsRef.get();, +        }, +    }]