[+++ b/plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java, +import com.amazonaws.auth.AWSCredentials;, +import org.elasticsearch.cloud.aws.util.SocketAccess;, +                AWSCredentialsProvider credentials = new InstanceProfileCredentialsProvider();, +                return new AWSCredentialsProvider() {, +                    @Override, +                    public AWSCredentials getCredentials() {, +                        return SocketAccess.doPrivileged(credentials::getCredentials);, +                    @Override, +                    public void refresh() {, +                        SocketAccess.doPrivilegedVoid(credentials::refresh);, +                    }, +                };, +            } else {, +                logger.debug("Using basic key/secret credentials");, +                return new StaticCredentialsProvider(new BasicAWSCredentials(key.toString(), secret.toString()));, +            }, +        }]