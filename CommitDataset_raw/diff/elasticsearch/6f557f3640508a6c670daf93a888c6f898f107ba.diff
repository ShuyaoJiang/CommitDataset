[+++ b/marvel/src/test/java/org/elasticsearch/marvel/test/MarvelIntegTestCase.java, +import java.util.Map;, +import static org.hamcrest.Matchers.*;, +    protected Boolean shieldEnabled = enableShield();, +        fail("marvel template should exists");, +                fail("marvel template shouldn't exists");, +    /**, +     * Checks if a field exist in a map of values. If the field contains a dot like 'foo.bar', +     * it checks that 'foo' exists in the map of values and that it points to a sub-map. Then, +     * it recurses to check if 'bar' exists in the sub-map., +     */, +    protected void assertContains(String field, Map<String, Object> values) {, +        assertNotNull("field name should not be null", field);, +        assertNotNull("values map should not be null", values);, +, +        int point = field.indexOf('.');, +        if (point > -1) {, +            assertThat(point, allOf(greaterThan(0), lessThan(field.length())));, +, +            String segment = field.substring(0, point);, +            assertTrue(Strings.hasText(segment));, +, +            boolean fieldExists = values.containsKey(segment);, +            assertTrue("expecting field [" + segment + "] to be present in marvel document", fieldExists);, +, +            Object value = values.get(segment);, +            String next = field.substring(point + 1);, +            if (next.length() > 0) {, +                assertTrue(value instanceof Map);, +                assertContains(next, (Map<String, Object>) value);, +            } else {, +                assertFalse(value instanceof Map);, +            }, +        } else {, +            assertTrue("expecting field [" + field + "] to be present in marvel document", values.containsKey(field));, +        }, +    }, +, +                "  cluster: cluster:monitor/nodes/info, cluster:monitor/nodes/stats, cluster:monitor/state, cluster:monitor/health, cluster:monitor/stats, cluster:admin/settings/update, cluster:admin/repository/delete, cluster:monitor/nodes/liveness, indices:admin/template/get, indices:admin/template/put, indices:admin/template/delete\n" +]