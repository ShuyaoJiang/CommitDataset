[+++ b/src/main/java/org/elasticsearch/alerts/AlertUtils.java, +import org.elasticsearch.alerts.triggers.TriggerResult;, +    private static final String ALERT_NAME_VARIABLE_NAME = "ALERT_NAME";, +    private static final String RESPONSE_VARIABLE_NAME = "response";, +++ b/src/main/java/org/elasticsearch/alerts/AlertUtils.java, +import org.elasticsearch.alerts.triggers.TriggerResult;, +    private static final String ALERT_NAME_VARIABLE_NAME = "ALERT_NAME";, +    private static final String RESPONSE_VARIABLE_NAME = "response";, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionRegistry.java, +                .fPut("email", new SmtpAlertActionFactory(configurationManager, scriptService)), +++ b/src/main/java/org/elasticsearch/alerts/AlertUtils.java, +import org.elasticsearch.alerts.triggers.TriggerResult;, +    private static final String ALERT_NAME_VARIABLE_NAME = "ALERT_NAME";, +    private static final String RESPONSE_VARIABLE_NAME = "response";, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionRegistry.java, +                .fPut("email", new SmtpAlertActionFactory(configurationManager, scriptService)), +++ b/src/main/java/org/elasticsearch/alerts/actions/SmtpAlertAction.java, +    private final String subjectTemplate;, +    private final String messageTemplate;, +    public SmtpAlertAction(String subjectTemplate, String messageTemplate, String... addresses){, +        this.subjectTemplate = subjectTemplate;, +        this.messageTemplate = messageTemplate;, +    public String getMessageTemplate() {, +        return messageTemplate;, +    }, +, +    public String getSubjectTemplate() {, +        return subjectTemplate;, +    }, +, +, +        if (subjectTemplate != null) {, +            builder.field("subject", subjectTemplate);, +, +        if (messageTemplate != null) {, +            builder.field("message", messageTemplate);, +        }, +, +, +        if (!messageTemplate.equals(that.messageTemplate)) return false;, +        if (!subjectTemplate.equals(that.subjectTemplate)) return false;, +        int result = emailAddresses != null ? emailAddresses.hashCode() : 0;, +        result = 31 * result + subjectTemplate.hashCode();, +        result = 31 * result + messageTemplate.hashCode();, +, +, +++ b/src/main/java/org/elasticsearch/alerts/AlertUtils.java, +import org.elasticsearch.alerts.triggers.TriggerResult;, +    private static final String ALERT_NAME_VARIABLE_NAME = "ALERT_NAME";, +    private static final String RESPONSE_VARIABLE_NAME = "response";, +++ b/src/main/java/org/elasticsearch/alerts/actions/AlertActionRegistry.java, +                .fPut("email", new SmtpAlertActionFactory(configurationManager, scriptService)), +++ b/src/main/java/org/elasticsearch/alerts/actions/SmtpAlertAction.java, +    private final String subjectTemplate;, +    private final String messageTemplate;, +    public SmtpAlertAction(String subjectTemplate, String messageTemplate, String... addresses){, +        this.subjectTemplate = subjectTemplate;, +        this.messageTemplate = messageTemplate;, +    public String getMessageTemplate() {, +        return messageTemplate;, +    }, +, +    public String getSubjectTemplate() {, +        return subjectTemplate;, +    }, +, +, +        if (subjectTemplate != null) {, +            builder.field("subject", subjectTemplate);, +, +        if (messageTemplate != null) {, +            builder.field("message", messageTemplate);, +        }, +, +, +        if (!messageTemplate.equals(that.messageTemplate)) return false;, +        if (!subjectTemplate.equals(that.subjectTemplate)) return false;, +        int result = emailAddresses != null ? emailAddresses.hashCode() : 0;, +        result = 31 * result + subjectTemplate.hashCode();, +        result = 31 * result + messageTemplate.hashCode();, +, +, +++ b/src/main/java/org/elasticsearch/alerts/actions/SmtpAlertActionFactory.java, +import org.elasticsearch.common.bytes.BytesReference;, +import org.elasticsearch.script.ExecutableScript;, +import org.elasticsearch.script.ScriptService;, +import java.util.*;, +    private static final String ALERT_NAME_VARIABLE_NAME = "alert_name";, +    private static final String RESPONSE_VARIABLE_NAME = "response";, +, +    private static final String DEFAULT_SUBJECT = "Elasticsearch Alert {{alert_name}} triggered";, +    private static final String DEFAULT_MESSAGE = "{{alert_name}} triggered with {{response.hits.total}} results";, +, +    private final ScriptService scriptService;, +, +    public SmtpAlertActionFactory(ConfigurationManager configurationManager, ScriptService scriptService) {, +        this.scriptService = scriptService;, +        String messageTemplate = DEFAULT_MESSAGE;, +        String subjectTemplate = DEFAULT_SUBJECT;, +]