[+++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/collector/cluster/ClusterStatsCollector.java, +        ClusterStatsResponse clusterStatsResponse = client.admin().cluster().prepareClusterStats().get(marvelSettings.clusterStatsTimeout());, +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/collector/cluster/ClusterStatsCollector.java, +        ClusterStatsResponse clusterStatsResponse = client.admin().cluster().prepareClusterStats().get(marvelSettings.clusterStatsTimeout());, +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/settings/MarvelSettingsService.java, +    public static final String CLUSTER_STATS_TIMEOUT = PREFIX + "cluster.stats.timeout";, +    final TimeValueSetting clusterStatsTimeout = MarvelSetting.timeSetting(CLUSTER_STATS_TIMEOUT, TimeValue.timeValueMinutes(10),, +            "Timeout value when collecting the cluster statistics (default to 10m)");, +, +        builder.add(clusterStatsTimeout);, +    public TimeValue clusterStatsTimeout() {, +        return clusterStatsTimeout.getValue();, +    }, +, +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/collector/cluster/ClusterStatsCollector.java, +        ClusterStatsResponse clusterStatsResponse = client.admin().cluster().prepareClusterStats().get(marvelSettings.clusterStatsTimeout());, +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/settings/MarvelSettingsService.java, +    public static final String CLUSTER_STATS_TIMEOUT = PREFIX + "cluster.stats.timeout";, +    final TimeValueSetting clusterStatsTimeout = MarvelSetting.timeSetting(CLUSTER_STATS_TIMEOUT, TimeValue.timeValueMinutes(10),, +            "Timeout value when collecting the cluster statistics (default to 10m)");, +, +        builder.add(clusterStatsTimeout);, +    public TimeValue clusterStatsTimeout() {, +        return clusterStatsTimeout.getValue();, +    }, +, +++ b/shield/docs/public/reference.asciidoc, +| `files.users`        | no          | `ES_HOME/config/shield/users`      | The location of the <<users-file, users>> file., +| `files.users_roles`  | no          | `ES_HOME/config/shield/users_roles`| The location of the <<users_defining-roles, users_roles>> file., +| `cache.ttl`          | no          | `20m`                              | The time-to-live for cached user entries--user credentials are cached for this configured period of time. Defaults to `20m`. Specify values using the standard Elasticsearch {ref}/common-options.html#time-units[time units]., +| `cache.max_users`    | no          | 100000                             | The maximum number of user entries that can live in the cache at a given time. Defaults to 100,000., +| `cache.hash_algo`    | no          | `ssha256`                          | (Expert Setting) The hashing algorithm that is used for the in-memory cached user credentials. See the <<ref-cache-hash-algo,Cache hash algorithms>> table for all possible values., +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/collector/cluster/ClusterStatsCollector.java, +        ClusterStatsResponse clusterStatsResponse = client.admin().cluster().prepareClusterStats().get(marvelSettings.clusterStatsTimeout());, +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/settings/MarvelSettingsService.java, +    public static final String CLUSTER_STATS_TIMEOUT = PREFIX + "cluster.stats.timeout";, +    final TimeValueSetting clusterStatsTimeout = MarvelSetting.timeSetting(CLUSTER_STATS_TIMEOUT, TimeValue.timeValueMinutes(10),, +            "Timeout value when collecting the cluster statistics (default to 10m)");, +, +        builder.add(clusterStatsTimeout);, +    public TimeValue clusterStatsTimeout() {, +        return clusterStatsTimeout.getValue();, +    }, +, +++ b/shield/docs/public/reference.asciidoc, +| `files.users`        | no          | `ES_HOME/config/shield/users`      | The location of the <<users-file, users>> file., +| `files.users_roles`  | no          | `ES_HOME/config/shield/users_roles`| The location of the <<users_defining-roles, users_roles>> file., +| `cache.ttl`          | no          | `20m`                              | The time-to-live for cached user entries--user credentials are cached for this configured period of time. Defaults to `20m`. Specify values using the standard Elasticsearch {ref}/common-options.html#time-units[time units]., +| `cache.max_users`    | no          | 100000                             | The maximum number of user entries that can live in the cache at a given time. Defaults to 100,000., +| `cache.hash_algo`    | no          | `ssha256`                          | (Expert Setting) The hashing algorithm that is used for the in-memory cached user credentials. See the <<ref-cache-hash-algo,Cache hash algorithms>> table for all possible values., +++ b/watcher/rest-api-spec/test/stats/10_basic.yaml, +  - match: { "manually_stopped": false }, +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/collector/cluster/ClusterStatsCollector.java, +        ClusterStatsResponse clusterStatsResponse = client.admin().cluster().prepareClusterStats().get(marvelSettings.clusterStatsTimeout());, +++ b/marvel/src/main/java/org/elasticsearch/marvel/agent/settings/MarvelSettingsService.java, +    public static final String CLUSTER_STATS_TIMEOUT = PREFIX + "cluster.stats.timeout";, +    final TimeValueSetting clusterStatsTimeout = MarvelSetting.timeSetting(CLUSTER_STATS_TIMEOUT, TimeValue.timeValueMinutes(10),, +            "Timeout value when collecting the cluster statistics (default to 10m)");, +, +        builder.add(clusterStatsTimeout);, +    public TimeValue clusterStatsTimeout() {, +        return clusterStatsTimeout.getValue();, +    }, +, +++ b/shield/docs/public/reference.asciidoc, +| `files.users`        | no          | `ES_HOME/config/shield/users`      | The location of the <<users-file, users>> file., +| `files.users_roles`  | no          | `ES_HOME/config/shield/users_roles`| The location of the <<users_defining-roles, users_roles>> file., +| `cache.ttl`          | no          | `20m`                              | The time-to-live for cached user entries--user credentials are cached for this configured period of time. Defaults to `20m`. Specify values using the standard Elasticsearch {ref}/common-options.html#time-units[time units]., +| `cache.max_users`    | no          | 100000                             | The maximum number of user entries that can live in the cache at a given time. Defaults to 100,000., +| `cache.hash_algo`    | no          | `ssha256`                          | (Expert Setting) The hashing algorithm that is used for the in-memory cached user credentials. See the <<ref-cache-hash-algo,Cache hash algorithms>> table for all possible values., +++ b/watcher/rest-api-spec/test/stats/10_basic.yaml, +  - match: { "manually_stopped": false }, +++ b/watcher/src/main/java/org/elasticsearch/watcher/WatcherLifeCycleService.java, +import org.elasticsearch.action.ActionListener;, +import org.elasticsearch.cluster.*;, +import org.elasticsearch.cluster.ack.AckedRequest;, +import org.elasticsearch.cluster.metadata.MetaData;, +import org.elasticsearch.common.unit.TimeValue;, +import java.util.concurrent.CountDownLatch;, +, +    private volatile WatcherMetaData watcherMetaData;, +    public WatcherLifeCycleService(Settings settings, ThreadPool threadPool, ClusterService clusterService,, +                                   WatcherService watcherService) {, +        this.clusterService = clusterService;, +                stop(false);, +        watcherMetaData = new WatcherMetaData(!settings.getAsBoolean("watcher.start_immediately", true));, +        } else {, +        if (manual) {, +            updateManualStopped(true);, +        }, +    }, +        if (!manual && watcherMetaData.manuallyStopped()) {, +            logger.debug("not starting watcher. watcher was stopped manually and therefore cannot be auto-started");, +        if (watcherService.validate(state)) {, +        } else {, +            logger.debug("not starting watcher. because the cluster isn't ready yet to run watcher");, +        }, +        if (manual) {, +            updateManualStopped(false);, +        }]