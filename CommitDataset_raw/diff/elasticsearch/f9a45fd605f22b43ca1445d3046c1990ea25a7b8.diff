[+++ b/core/src/main/java/org/elasticsearch/cluster/ClusterInfo.java, +import org.elasticsearch.cluster.routing.ShardRouting;, +    private final Map<String, DiskUsage> usages;, +    final Map<String, Long> shardSizes;, +    public ClusterInfo(Map<String, DiskUsage> usages, Map<String, Long> shardSizes) {, +    public Long getShardSize(ShardRouting shardRouting) {, +        return shardSizes.get(shardIdentifierFromRouting(shardRouting));, +    }, +, +    /**, +     * Method that incorporates the ShardId for the shard into a string that, +     * includes a 'p' or 'r' depending on whether the shard is a primary., +     */, +    static String shardIdentifierFromRouting(ShardRouting shardRouting) {, +        return shardRouting.shardId().toString() + "[" + (shardRouting.primary() ? "p" : "r") + "]";, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterInfo.java, +import org.elasticsearch.cluster.routing.ShardRouting;, +    private final Map<String, DiskUsage> usages;, +    final Map<String, Long> shardSizes;, +    public ClusterInfo(Map<String, DiskUsage> usages, Map<String, Long> shardSizes) {, +    public Long getShardSize(ShardRouting shardRouting) {, +        return shardSizes.get(shardIdentifierFromRouting(shardRouting));, +    }, +, +    /**, +     * Method that incorporates the ShardId for the shard into a string that, +     * includes a 'p' or 'r' depending on whether the shard is a primary., +     */, +    static String shardIdentifierFromRouting(ShardRouting shardRouting) {, +        return shardRouting.shardId().toString() + "[" + (shardRouting.primary() ? "p" : "r") + "]";, +++ b/core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java, +                        String sid = ClusterInfo.shardIdentifierFromRouting(s.getShardRouting());, +, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterInfo.java, +import org.elasticsearch.cluster.routing.ShardRouting;, +    private final Map<String, DiskUsage> usages;, +    final Map<String, Long> shardSizes;, +    public ClusterInfo(Map<String, DiskUsage> usages, Map<String, Long> shardSizes) {, +    public Long getShardSize(ShardRouting shardRouting) {, +        return shardSizes.get(shardIdentifierFromRouting(shardRouting));, +    }, +, +    /**, +     * Method that incorporates the ShardId for the shard into a string that, +     * includes a 'p' or 'r' depending on whether the shard is a primary., +     */, +    static String shardIdentifierFromRouting(ShardRouting shardRouting) {, +        return shardRouting.shardId().toString() + "[" + (shardRouting.primary() ? "p" : "r") + "]";, +++ b/core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java, +                        String sid = ClusterInfo.shardIdentifierFromRouting(s.getShardRouting());, +, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +                    if (shardRoutingEntry.initializing() && shardRoutingEntry.relocatingNodeId() != null), +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterInfo.java, +import org.elasticsearch.cluster.routing.ShardRouting;, +    private final Map<String, DiskUsage> usages;, +    final Map<String, Long> shardSizes;, +    public ClusterInfo(Map<String, DiskUsage> usages, Map<String, Long> shardSizes) {, +    public Long getShardSize(ShardRouting shardRouting) {, +        return shardSizes.get(shardIdentifierFromRouting(shardRouting));, +    }, +, +    /**, +     * Method that incorporates the ShardId for the shard into a string that, +     * includes a 'p' or 'r' depending on whether the shard is a primary., +     */, +    static String shardIdentifierFromRouting(ShardRouting shardRouting) {, +        return shardRouting.shardId().toString() + "[" + (shardRouting.primary() ? "p" : "r") + "]";, +++ b/core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java, +                        String sid = ClusterInfo.shardIdentifierFromRouting(s.getShardRouting());, +, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +                    if (shardRoutingEntry.initializing() && shardRoutingEntry.relocatingNodeId() != null), +++ b/core/src/main/java/org/elasticsearch/cluster/routing/ShardRouting.java, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterInfo.java, +import org.elasticsearch.cluster.routing.ShardRouting;, +    private final Map<String, DiskUsage> usages;, +    final Map<String, Long> shardSizes;, +    public ClusterInfo(Map<String, DiskUsage> usages, Map<String, Long> shardSizes) {, +    public Long getShardSize(ShardRouting shardRouting) {, +        return shardSizes.get(shardIdentifierFromRouting(shardRouting));, +    }, +, +    /**, +     * Method that incorporates the ShardId for the shard into a string that, +     * includes a 'p' or 'r' depending on whether the shard is a primary., +     */, +    static String shardIdentifierFromRouting(ShardRouting shardRouting) {, +        return shardRouting.shardId().toString() + "[" + (shardRouting.primary() ? "p" : "r") + "]";, +++ b/core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java, +                        String sid = ClusterInfo.shardIdentifierFromRouting(s.getShardRouting());, +, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +                    if (shardRoutingEntry.initializing() && shardRoutingEntry.relocatingNodeId() != null), +++ b/core/src/main/java/org/elasticsearch/cluster/routing/ShardRouting.java, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java, +            assert startedShard.initializing();, +            if (failedShard.initializing()) {, +            } else if (failedShard.relocating()) {, +                            if (shardRouting.shardId().equals(failedShard.shardId()) && shardRouting.initializing()) {]