[+++ b/core/src/main/java/org/elasticsearch/common/util/iterable/Iterables.java, +++ b/core/src/main/java/org/elasticsearch/common/util/iterable/Iterables.java, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +        context.path().add(currentFieldName);, +            ObjectMapper.Dynamic dynamic = dynamicOrDefault(mapper, context);, +                // remove the current field name from path, since template search and the object builder add it as well..., +                context.path().remove();, +        context.path().remove();, +                    return;, +                }, +            ObjectMapper mapper = context.root();, +            ObjectMapper[] mappers = new ObjectMapper[paths.length-1];, +            if (paths.length > 1) {, +                ObjectMapper parent = context.root();, +                    mapper = context.docMapper().objectMappers().get(context.path().pathAsText(paths[i]));, +                              // Maybe we should log something to tell the user that the copy_to is ignored in this case., +                              break;, +                    mappers[i] = mapper;, +            }, +            parseDynamicValue(context, mapper, fieldName, context.parser().currentToken());, +        }, +++ b/core/src/main/java/org/elasticsearch/common/util/iterable/Iterables.java, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +        context.path().add(currentFieldName);, +            ObjectMapper.Dynamic dynamic = dynamicOrDefault(mapper, context);, +                // remove the current field name from path, since template search and the object builder add it as well..., +                context.path().remove();, +        context.path().remove();, +                    return;, +                }, +            ObjectMapper mapper = context.root();, +            ObjectMapper[] mappers = new ObjectMapper[paths.length-1];, +            if (paths.length > 1) {, +                ObjectMapper parent = context.root();, +                    mapper = context.docMapper().objectMappers().get(context.path().pathAsText(paths[i]));, +                              // Maybe we should log something to tell the user that the copy_to is ignored in this case., +                              break;, +                    mappers[i] = mapper;, +            }, +            parseDynamicValue(context, mapper, fieldName, context.parser().currentToken());, +        }, +++ b/core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java, +                    // Could be while we were checking, more bytes arrived:, +                    totalBytes = bytesWrittenSinceCheck.addAndGet(bytes);, +++ b/core/src/main/java/org/elasticsearch/common/util/iterable/Iterables.java, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +        context.path().add(currentFieldName);, +            ObjectMapper.Dynamic dynamic = dynamicOrDefault(mapper, context);, +                // remove the current field name from path, since template search and the object builder add it as well..., +                context.path().remove();, +        context.path().remove();, +                    return;, +                }, +            ObjectMapper mapper = context.root();, +            ObjectMapper[] mappers = new ObjectMapper[paths.length-1];, +            if (paths.length > 1) {, +                ObjectMapper parent = context.root();, +                    mapper = context.docMapper().objectMappers().get(context.path().pathAsText(paths[i]));, +                              // Maybe we should log something to tell the user that the copy_to is ignored in this case., +                              break;, +                    mappers[i] = mapper;, +            }, +            parseDynamicValue(context, mapper, fieldName, context.parser().currentToken());, +        }, +++ b/core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java, +                    // Could be while we were checking, more bytes arrived:, +                    totalBytes = bytesWrittenSinceCheck.addAndGet(bytes);, +++ b/core/src/main/java/org/elasticsearch/indices/IndicesService.java, +        indexingMemoryController = new IndexingMemoryController(settings, threadPool, Iterables.flatten(this));, +++ b/core/src/main/java/org/elasticsearch/common/util/iterable/Iterables.java, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +        context.path().add(currentFieldName);, +            ObjectMapper.Dynamic dynamic = dynamicOrDefault(mapper, context);, +                // remove the current field name from path, since template search and the object builder add it as well..., +                context.path().remove();, +        context.path().remove();, +                    return;, +                }, +            ObjectMapper mapper = context.root();, +            ObjectMapper[] mappers = new ObjectMapper[paths.length-1];, +            if (paths.length > 1) {, +                ObjectMapper parent = context.root();, +                    mapper = context.docMapper().objectMappers().get(context.path().pathAsText(paths[i]));, +                              // Maybe we should log something to tell the user that the copy_to is ignored in this case., +                              break;, +                    mappers[i] = mapper;, +            }, +            parseDynamicValue(context, mapper, fieldName, context.parser().currentToken());, +        }, +++ b/core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java, +                    // Could be while we were checking, more bytes arrived:, +                    totalBytes = bytesWrittenSinceCheck.addAndGet(bytes);, +++ b/core/src/main/java/org/elasticsearch/indices/IndicesService.java, +        indexingMemoryController = new IndexingMemoryController(settings, threadPool, Iterables.flatten(this));, +++ b/core/src/test/java/org/elasticsearch/common/util/iterable/IterablesTests.java, +import org.elasticsearch.test.ESTestCase;, +, +++ b/core/src/main/java/org/elasticsearch/common/util/iterable/Iterables.java, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +        context.path().add(currentFieldName);]