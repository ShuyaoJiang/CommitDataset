[+++ b/core/pom.xml, +                            <!-- TODO: remove this and the xslt when junit4 is fixed -->, +                            <xslt in="${project.build.directory}/failsafe-reports/failsafe-summary-buggy.xml", +                                  out="${project.build.directory}/failsafe-reports/failsafe-summary.xml", +                                  style="${elasticsearch.tools.directory}/ant/fixup-failsafe-summary.xslt">, +                            </xslt>, +++ b/core/pom.xml, +                            <!-- TODO: remove this and the xslt when junit4 is fixed -->, +                            <xslt in="${project.build.directory}/failsafe-reports/failsafe-summary-buggy.xml", +                                  out="${project.build.directory}/failsafe-reports/failsafe-summary.xml", +                                  style="${elasticsearch.tools.directory}/ant/fixup-failsafe-summary.xslt">, +                            </xslt>, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +++ b/core/pom.xml, +                            <!-- TODO: remove this and the xslt when junit4 is fixed -->, +                            <xslt in="${project.build.directory}/failsafe-reports/failsafe-summary-buggy.xml", +                                  out="${project.build.directory}/failsafe-reports/failsafe-summary.xml", +                                  style="${elasticsearch.tools.directory}/ant/fixup-failsafe-summary.xslt">, +                            </xslt>, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java, +            activePrimaryShards += indexHealth.activePrimaryShards;, +            activeShards += indexHealth.activeShards;, +            relocatingShards += indexHealth.relocatingShards;, +            initializingShards += indexHealth.initializingShards;, +            unassignedShards += indexHealth.unassignedShards;, +++ b/core/pom.xml, +                            <!-- TODO: remove this and the xslt when junit4 is fixed -->, +                            <xslt in="${project.build.directory}/failsafe-reports/failsafe-summary-buggy.xml", +                                  out="${project.build.directory}/failsafe-reports/failsafe-summary.xml", +                                  style="${elasticsearch.tools.directory}/ant/fixup-failsafe-summary.xslt">, +                            </xslt>, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java, +            activePrimaryShards += indexHealth.activePrimaryShards;, +            activeShards += indexHealth.activeShards;, +            relocatingShards += indexHealth.relocatingShards;, +            initializingShards += indexHealth.initializingShards;, +            unassignedShards += indexHealth.unassignedShards;, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthStatus.java, +++ b/core/pom.xml, +                            <!-- TODO: remove this and the xslt when junit4 is fixed -->, +                            <xslt in="${project.build.directory}/failsafe-reports/failsafe-summary-buggy.xml", +                                  out="${project.build.directory}/failsafe-reports/failsafe-summary.xml", +                                  style="${elasticsearch.tools.directory}/ant/fixup-failsafe-summary.xslt">, +                            </xslt>, +++ b/core/src/main/java/org/elasticsearch/action/ActionModule.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java, +            activePrimaryShards += indexHealth.activePrimaryShards;, +            activeShards += indexHealth.activeShards;, +            relocatingShards += indexHealth.relocatingShards;, +            initializingShards += indexHealth.initializingShards;, +            unassignedShards += indexHealth.unassignedShards;, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthStatus.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterIndexHealth.java, +    int activeShards = 0;, +    int relocatingShards = 0;, +    int initializingShards = 0;, +    int unassignedShards = 0;, +    int activePrimaryShards = 0;, +    ClusterHealthStatus status = ClusterHealthStatus.RED;, +    final Map<Integer, ClusterShardHealth> shards = Maps.newHashMap();, +    List<String> validationFailures;, +            ClusterShardHealth shardHealth = new ClusterShardHealth(shardRoutingTable.shardId().id());, +            for (ShardRouting shardRouting : shardRoutingTable) {, +                if (shardRouting.active()) {, +                    shardHealth.activeShards++;, +                    if (shardRouting.relocating()) {, +                        // the shard is relocating, the one it is relocating to will be in initializing state, so we don't count it, +                        shardHealth.relocatingShards++;, +                    }, +                    if (shardRouting.primary()) {, +                        shardHealth.primaryActive = true;, +                    }, +                } else if (shardRouting.initializing()) {, +                    shardHealth.initializingShards++;, +                } else if (shardRouting.unassigned()) {, +                    shardHealth.unassignedShards++;, +                }, +            }, +            if (shardHealth.primaryActive) {, +                if (shardHealth.activeShards == shardRoutingTable.size()) {, +                    shardHealth.status = ClusterHealthStatus.GREEN;, +                } else {, +                    shardHealth.status = ClusterHealthStatus.YELLOW;, +                }, +            } else {, +                shardHealth.status = ClusterHealthStatus.RED;, +            }, +            shards.put(shardHealth.getId(), shardHealth);, +            activeShards += shardHealth.activeShards;, +            relocatingShards += shardHealth.relocatingShards;, +            initializingShards += shardHealth.initializingShards;, +            unassignedShards += shardHealth.unassignedShards;, +++ b/core/pom.xml, +                            <!-- TODO: remove this and the xslt when junit4 is fixed -->, +                            <xslt in="${project.build.directory}/failsafe-reports/failsafe-summary-buggy.xml", +                                  out="${project.build.directory}/failsafe-reports/failsafe-summary.xml", +                                  style="${elasticsearch.tools.directory}/ant/fixup-failsafe-summary.xslt">, +                            </xslt>]