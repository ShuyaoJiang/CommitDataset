[+++ b/docs/reference/mapping/types/parent-join.asciidoc, +                    "my_join_field": "my_parent" <1>, +                    "my_join_field": "my_parent" <2>, +++ b/docs/reference/mapping/types/parent-join.asciidoc, +                    "my_join_field": "my_parent" <1>, +                    "my_join_field": "my_parent" <2>, +++ b/docs/reference/search/request/inner-hits.asciidoc, +++ b/docs/reference/mapping/types/parent-join.asciidoc, +                    "my_join_field": "my_parent" <1>, +                    "my_join_field": "my_parent" <2>, +++ b/docs/reference/search/request/inner-hits.asciidoc, +++ b/modules/parent-join/src/main/java/org/elasticsearch/join/ParentJoinPlugin.java, +, +    public ParentJoinPlugin() {, +    }, +++ b/docs/reference/mapping/types/parent-join.asciidoc, +                    "my_join_field": "my_parent" <1>, +                    "my_join_field": "my_parent" <2>, +++ b/docs/reference/search/request/inner-hits.asciidoc, +++ b/modules/parent-join/src/main/java/org/elasticsearch/join/ParentJoinPlugin.java, +, +    public ParentJoinPlugin() {, +    }, +++ /dev/null, +++ b/docs/reference/mapping/types/parent-join.asciidoc, +                    "my_join_field": "my_parent" <1>, +                    "my_join_field": "my_parent" <2>, +++ b/docs/reference/search/request/inner-hits.asciidoc, +++ b/modules/parent-join/src/main/java/org/elasticsearch/join/ParentJoinPlugin.java, +, +    public ParentJoinPlugin() {, +    }, +++ /dev/null, +++ b/modules/parent-join/src/main/java/org/elasticsearch/join/query/ParentChildInnerHitContextBuilder.java, +import org.apache.lucene.index.ReaderUtil;, +import org.apache.lucene.index.SortedDocValues;, +import org.apache.lucene.util.BytesRef;, +import org.elasticsearch.ExceptionsHelper;, +import java.util.List;, +                String joinName = getSortedDocValue(joinFieldMapper.name(), context, hit.docId());, +                if (joinName == null) {, +                    String parentId = getSortedDocValue(parentIdFieldMapper.name(), context, hit.docId());, +                    q = context.mapperService().fullName(IdFieldMapper.NAME).termQuery(parentId, qsc);, +, +        private String getSortedDocValue(String field, SearchContext context, int docId) {, +            try {, +                List<LeafReaderContext> ctxs = context.searcher().getIndexReader().leaves();, +                LeafReaderContext ctx = ctxs.get(ReaderUtil.subIndex(docId, ctxs));, +                SortedDocValues docValues = ctx.reader().getSortedDocValues(field);, +                int segmentDocId = docId - ctx.docBase;, +                if (docValues == null || docValues.advanceExact(segmentDocId) == false) {, +                    return null;, +                }, +                int ord = docValues.ordValue();, +                BytesRef joinName = docValues.lookupOrd(ord);, +                return joinName.utf8ToString();, +            } catch (IOException e) {, +                throw ExceptionsHelper.convertToElastic(e);, +            }, +        }, +, +++ b/docs/reference/mapping/types/parent-join.asciidoc, +                    "my_join_field": "my_parent" <1>, +                    "my_join_field": "my_parent" <2>, +++ b/docs/reference/search/request/inner-hits.asciidoc, +++ b/modules/parent-join/src/main/java/org/elasticsearch/join/ParentJoinPlugin.java, +, +    public ParentJoinPlugin() {, +    }, +++ /dev/null, +++ b/modules/parent-join/src/main/java/org/elasticsearch/join/query/ParentChildInnerHitContextBuilder.java, +import org.apache.lucene.index.ReaderUtil;, +import org.apache.lucene.index.SortedDocValues;, +import org.apache.lucene.util.BytesRef;, +import org.elasticsearch.ExceptionsHelper;, +import java.util.List;, +                String joinName = getSortedDocValue(joinFieldMapper.name(), context, hit.docId());, +                if (joinName == null) {, +                    String parentId = getSortedDocValue(parentIdFieldMapper.name(), context, hit.docId());, +                    q = context.mapperService().fullName(IdFieldMapper.NAME).termQuery(parentId, qsc);, +, +        private String getSortedDocValue(String field, SearchContext context, int docId) {, +            try {, +                List<LeafReaderContext> ctxs = context.searcher().getIndexReader().leaves();, +                LeafReaderContext ctx = ctxs.get(ReaderUtil.subIndex(docId, ctxs));, +                SortedDocValues docValues = ctx.reader().getSortedDocValues(field);, +                int segmentDocId = docId - ctx.docBase;, +                if (docValues == null || docValues.advanceExact(segmentDocId) == false) {, +                    return null;, +                }, +                int ord = docValues.ordValue();, +                BytesRef joinName = docValues.lookupOrd(ord);, +                return joinName.utf8ToString();, +            } catch (IOException e) {, +                throw ExceptionsHelper.convertToElastic(e);, +            }, +        }, +, +++ /dev/null, +++ b/docs/reference/mapping/types/parent-join.asciidoc]