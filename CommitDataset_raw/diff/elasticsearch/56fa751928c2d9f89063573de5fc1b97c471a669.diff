[+++ b/core/src/main/java/org/elasticsearch/cli/Terminal.java, +import org.elasticsearch.common.SuppressForbidden;, +, +        print(verbosity, msg + lineSeparator);, +    }, +, +    /** Prints message to the terminal at {@code verbosity} level, without a newline. */, +    public final void print(Verbosity verbosity, String msg) {, +            getWriter().print(msg);, +++ b/core/src/main/java/org/elasticsearch/cli/Terminal.java, +import org.elasticsearch.common.SuppressForbidden;, +, +        print(verbosity, msg + lineSeparator);, +    }, +, +    /** Prints message to the terminal at {@code verbosity} level, without a newline. */, +    public final void print(Verbosity verbosity, String msg) {, +            getWriter().print(msg);, +++ b/core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +import joptsimple.OptionSet;, +import joptsimple.OptionSpec;, +import org.apache.lucene.search.spell.LevensteinDistance;, +import org.apache.lucene.util.CollectionUtil;, +import org.apache.lucene.util.IOUtils;, +import org.elasticsearch.Version;, +import org.elasticsearch.bootstrap.JarHell;, +import org.elasticsearch.cli.ExitCodes;, +import org.elasticsearch.cli.SettingCommand;, +import org.elasticsearch.cli.Terminal;, +import org.elasticsearch.cli.UserError;, +import org.elasticsearch.common.collect.Tuple;, +import org.elasticsearch.common.hash.MessageDigests;, +import org.elasticsearch.common.io.FileSystemUtils;, +import org.elasticsearch.common.settings.Settings;, +import org.elasticsearch.env.Environment;, +import org.elasticsearch.node.internal.InternalSettingsPreparer;, +, +import java.net.URLConnection;, +, +        URLConnection urlConnection = url.openConnection();, +        int contentLength = urlConnection.getContentLength();, +        try (InputStream in = new TerminalProgressInputStream(urlConnection.getInputStream(), contentLength, terminal)) {, +    /**, +     * content length might be -1 for unknown and progress only makes sense if the content length is greater than 0, +     */, +    private class TerminalProgressInputStream extends ProgressInputStream {, +, +        private final Terminal terminal;, +        private int width = 50;, +        private final boolean enabled;, +, +        public TerminalProgressInputStream(InputStream is, int expectedTotalSize, Terminal terminal) {, +            super(is, expectedTotalSize);, +            this.terminal = terminal;, +            this.enabled = expectedTotalSize > 0;, +        }, +, +        @Override, +        public void onProgress(int percent) {, +            if (enabled) {, +                int currentPosition = percent * width / 100;, +                StringBuilder sb = new StringBuilder("\r[");, +                sb.append(String.join("=", Collections.nCopies(currentPosition, "")));, +                if (currentPosition > 0 && percent < 100) {, +                    sb.append(">");, +                }, +                sb.append(String.join(" ", Collections.nCopies(width - currentPosition, "")));, +                sb.append("] %s   ");, +                if (percent == 100) {, +                    sb.append("\n");, +                }, +                terminal.print(Terminal.Verbosity.NORMAL, String.format(Locale.ROOT, sb.toString(), percent + "%"));, +            }, +        }, +    }, +, +++ b/core/src/main/java/org/elasticsearch/cli/Terminal.java, +import org.elasticsearch.common.SuppressForbidden;, +, +        print(verbosity, msg + lineSeparator);, +    }, +, +    /** Prints message to the terminal at {@code verbosity} level, without a newline. */, +    public final void print(Verbosity verbosity, String msg) {, +            getWriter().print(msg);, +++ b/core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +import joptsimple.OptionSet;, +import joptsimple.OptionSpec;, +import org.apache.lucene.search.spell.LevensteinDistance;, +import org.apache.lucene.util.CollectionUtil;, +import org.apache.lucene.util.IOUtils;, +import org.elasticsearch.Version;, +import org.elasticsearch.bootstrap.JarHell;, +import org.elasticsearch.cli.ExitCodes;, +import org.elasticsearch.cli.SettingCommand;, +import org.elasticsearch.cli.Terminal;, +import org.elasticsearch.cli.UserError;, +import org.elasticsearch.common.collect.Tuple;, +import org.elasticsearch.common.hash.MessageDigests;, +import org.elasticsearch.common.io.FileSystemUtils;]