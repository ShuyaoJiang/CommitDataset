[+++ b/server/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +, +            if (DiscoveryNode.isMasterNode(settings) || DiscoveryNode.isDataNode(settings)) {, +                ensureAtomicMoveSupported(nodePaths);, +            }, +    private static void ensureAtomicMoveSupported(final NodePath[] nodePaths) throws IOException {, +++ b/server/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +, +            if (DiscoveryNode.isMasterNode(settings) || DiscoveryNode.isDataNode(settings)) {, +                ensureAtomicMoveSupported(nodePaths);, +            }, +    private static void ensureAtomicMoveSupported(final NodePath[] nodePaths) throws IOException {, +++ b/server/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java, +++ b/server/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +, +            if (DiscoveryNode.isMasterNode(settings) || DiscoveryNode.isDataNode(settings)) {, +                ensureAtomicMoveSupported(nodePaths);, +            }, +    private static void ensureAtomicMoveSupported(final NodePath[] nodePaths) throws IOException {, +++ b/server/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java, +++ b/server/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java, +]