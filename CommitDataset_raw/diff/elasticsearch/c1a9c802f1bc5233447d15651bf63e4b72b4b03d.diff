[+++ b/src/main/java/org/elasticsearch/common/xcontent/XContentParser.java, +import org.apache.lucene.util.BytesRef;, +, +    BytesRef bytesOrNull(BytesRef spare) throws IOException;, +    , +    BytesRef bytes(BytesRef spare) throws IOException;, +, +++ b/src/main/java/org/elasticsearch/common/xcontent/XContentParser.java, +import org.apache.lucene.util.BytesRef;, +, +    BytesRef bytesOrNull(BytesRef spare) throws IOException;, +    , +    BytesRef bytes(BytesRef spare) throws IOException;, +, +++ b/src/main/java/org/elasticsearch/common/xcontent/support/AbstractXContentParser.java, +import org.apache.lucene.util.BytesRef;, +    , +, +    @Override, +    public BytesRef bytesOrNull(BytesRef spare) throws IOException {, +      if (currentToken() == Token.VALUE_NULL) {, +        return null;, +      }, +      return bytes(spare);, +    }, +, +    @Override, +    public BytesRef bytes(BytesRef spare) throws IOException {, +      // LUCENE 4 UPGRADE: we can possibly make this more efficient for now I just forward to text, +      if (spare == null) {, +        return new BytesRef(text());, +      } else {, +        spare.copyChars(text());, +        return spare;, +      }, +    }, +]