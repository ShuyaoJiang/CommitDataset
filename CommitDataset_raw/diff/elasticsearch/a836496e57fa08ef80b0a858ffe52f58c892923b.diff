[+++ b/src/test/java/org/elasticsearch/indices/cache/CacheTests.java, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +++ b/src/test/java/org/elasticsearch/indices/cache/CacheTests.java, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +++ b/src/test/java/org/elasticsearch/nested/SimpleNestedTests.java, +++ b/src/test/java/org/elasticsearch/indices/cache/CacheTests.java, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +++ b/src/test/java/org/elasticsearch/nested/SimpleNestedTests.java, +++ b/src/test/java/org/elasticsearch/search/child/SimpleChildQuerySearchTests.java, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(initialCacheSize) : is(initialCacheSize));, +++ b/src/test/java/org/elasticsearch/indices/cache/CacheTests.java, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +++ b/src/test/java/org/elasticsearch/nested/SimpleNestedTests.java, +++ b/src/test/java/org/elasticsearch/search/child/SimpleChildQuerySearchTests.java, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(initialCacheSize) : is(initialCacheSize));, +++ b/src/test/java/org/elasticsearch/search/query/SimpleQueryTests.java, +        assertThat(filtercacheSize, cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(filtercacheSize) : is(filtercacheSize));, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(filtercacheSize) : is(filtercacheSize));, +++ b/src/test/java/org/elasticsearch/indices/cache/CacheTests.java, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +++ b/src/test/java/org/elasticsearch/nested/SimpleNestedTests.java, +++ b/src/test/java/org/elasticsearch/search/child/SimpleChildQuerySearchTests.java, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(initialCacheSize) : is(initialCacheSize));, +++ b/src/test/java/org/elasticsearch/search/query/SimpleQueryTests.java, +        assertThat(filtercacheSize, cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(filtercacheSize) : is(filtercacheSize));, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(filtercacheSize) : is(filtercacheSize));, +++ b/src/test/java/org/elasticsearch/search/scriptfilter/ScriptFilterSearchTests.java, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 3 : 1));, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 0 : 1));, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 3 : 1));, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 0 : 3));, +++ b/src/test/java/org/elasticsearch/indices/cache/CacheTests.java, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +++ b/src/test/java/org/elasticsearch/nested/SimpleNestedTests.java, +++ b/src/test/java/org/elasticsearch/search/child/SimpleChildQuerySearchTests.java, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(initialCacheSize) : is(initialCacheSize));, +++ b/src/test/java/org/elasticsearch/search/query/SimpleQueryTests.java, +        assertThat(filtercacheSize, cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(filtercacheSize) : is(filtercacheSize));, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(filtercacheSize) : is(filtercacheSize));, +++ b/src/test/java/org/elasticsearch/search/scriptfilter/ScriptFilterSearchTests.java, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 3 : 1));, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 0 : 1));, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 3 : 1));, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 0 : 3));, +++ b/src/test/java/org/elasticsearch/test/ExternalTestCluster.java, +, +    @Override, +    public boolean hasFilterCache() {, +        return true; // default, +    }, +++ b/src/test/java/org/elasticsearch/indices/cache/CacheTests.java, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(nodesStats.getNodes()[0].getIndices().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(indicesStats.getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +++ b/src/test/java/org/elasticsearch/nested/SimpleNestedTests.java, +++ b/src/test/java/org/elasticsearch/search/child/SimpleChildQuerySearchTests.java, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(initialCacheSize) : is(initialCacheSize));, +++ b/src/test/java/org/elasticsearch/search/query/SimpleQueryTests.java, +        assertThat(filtercacheSize, cluster().hasFilterCache() ? greaterThan(0l) : is(0L));, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(filtercacheSize) : is(filtercacheSize));, +        assertThat(statsResponse.getIndex("test").getTotal().getFilterCache().getMemorySizeInBytes(), cluster().hasFilterCache() ? greaterThan(filtercacheSize) : is(filtercacheSize));, +++ b/src/test/java/org/elasticsearch/search/scriptfilter/ScriptFilterSearchTests.java, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 3 : 1));, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 0 : 1));, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 3 : 1));, +        assertThat(scriptCounter.get(), equalTo(cluster().hasFilterCache() ? 0 : 3));, +++ b/src/test/java/org/elasticsearch/test/ExternalTestCluster.java, +, +    @Override, +    public boolean hasFilterCache() {, +        return true; // default, +    }, +++ b/src/test/java/org/elasticsearch/test/ImmutableTestCluster.java, +, +    /**, +     * Return whether or not this cluster can cache filters., +     */, +    public abstract boolean hasFilterCache();]