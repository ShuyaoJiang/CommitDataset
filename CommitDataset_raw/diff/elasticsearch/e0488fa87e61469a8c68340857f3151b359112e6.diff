[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/plugins/PluginsService.java, +                if (pluginFile.isDirectory()) {, +                    logger.trace("--- adding expanded plugin [" + pluginFile.getAbsolutePath() + "]");, +                    try {, +                        // add the root, +                        addURL.invoke(classLoader, pluginFile.toURI().toURL());, +                        // if there are jars in it, add it as well, +                        for (File jarToAdd : pluginFile.listFiles()) {, +                            if (!(jarToAdd.getName().endsWith(".jar") || jarToAdd.getName().endsWith(".zip"))) {, +                                continue;, +                            }, +                            addURL.invoke(classLoader, jarToAdd.toURI().toURL());, +                        }, +                    } catch (Exception e) {, +                        logger.warn("failed to add plugin [" + pluginFile + "]", e);, +                    }, +                }, +]