[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java, +    // a flag that should be used only for testing, +    private final boolean sendLeaveRequest;, +, +        this.sendLeaveRequest = componentSettings.getAsBoolean("send_leave_request", true);, +        if (sendLeaveRequest) {, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java, +    // a flag that should be used only for testing, +    private final boolean sendLeaveRequest;, +, +        this.sendLeaveRequest = componentSettings.getAsBoolean("send_leave_request", true);, +        if (sendLeaveRequest) {, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/zen/fd/MasterFaultDetection.java, +    // used mainly for testing, should always be true, +    private final boolean registerConnectionListener;, +, +, +        this.registerConnectionListener = componentSettings.getAsBoolean("register_connection_listener", true);, +        if (registerConnectionListener) {, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java, +    // a flag that should be used only for testing, +    private final boolean sendLeaveRequest;, +, +        this.sendLeaveRequest = componentSettings.getAsBoolean("send_leave_request", true);, +        if (sendLeaveRequest) {, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/zen/fd/MasterFaultDetection.java, +    // used mainly for testing, should always be true, +    private final boolean registerConnectionListener;, +, +, +        this.registerConnectionListener = componentSettings.getAsBoolean("register_connection_listener", true);, +        if (registerConnectionListener) {, +        }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/zen/fd/NodesFaultDetection.java, +    // used mainly for testing, should always be true, +    private final boolean registerConnectionListener;, +, +        this.registerConnectionListener = componentSettings.getAsBoolean("register_connection_listener", true);, +        if (registerConnectionListener) {, +    }]