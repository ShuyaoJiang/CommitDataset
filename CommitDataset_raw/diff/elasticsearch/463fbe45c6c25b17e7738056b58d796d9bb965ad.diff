[+++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +                for (ObjectCursor<DiscoveryNode> cursor : entry.getValue().getState().nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +                for (ObjectCursor<DiscoveryNode> cursor : entry.getValue().getState().nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/health/ClusterStateHealth.java, +        numberOfDataNodes = clusterState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +                for (ObjectCursor<DiscoveryNode> cursor : entry.getValue().getState().nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/health/ClusterStateHealth.java, +        numberOfDataNodes = clusterState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java, +                count += currentState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +                for (ObjectCursor<DiscoveryNode> cursor : entry.getValue().getState().nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/health/ClusterStateHealth.java, +        numberOfDataNodes = clusterState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java, +                count += currentState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java, +        final int dataNodeCount = event.state().nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +                for (ObjectCursor<DiscoveryNode> cursor : entry.getValue().getState().nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/health/ClusterStateHealth.java, +        numberOfDataNodes = clusterState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java, +                count += currentState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java, +        final int dataNodeCount = event.state().nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java, +        return this.dataNodes;, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +                for (ObjectCursor<DiscoveryNode> cursor : entry.getValue().getState().nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/health/ClusterStateHealth.java, +        numberOfDataNodes = clusterState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java, +                count += currentState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java, +        final int dataNodeCount = event.state().nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java, +        return this.dataNodes;, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java, +        if (!nodes.getDataNodes().keys().contains(nodeId)) {, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +                for (ObjectCursor<DiscoveryNode> cursor : entry.getValue().getState().nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/health/ClusterStateHealth.java, +        numberOfDataNodes = clusterState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java, +                count += currentState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java, +        final int dataNodeCount = event.state().nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java, +        return this.dataNodes;, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java, +        if (!nodes.getDataNodes().keys().contains(nodeId)) {, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +        for (ObjectCursor<DiscoveryNode> cursor : clusterState.nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +                for (ObjectCursor<DiscoveryNode> cursor : entry.getValue().getState().nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/health/ClusterStateHealth.java, +        numberOfDataNodes = clusterState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java, +                count += currentState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java, +        final int dataNodeCount = event.state().nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java, +        return this.dataNodes;, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java, +        if (!nodes.getDataNodes().keys().contains(nodeId)) {, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +        for (ObjectCursor<DiscoveryNode> cursor : clusterState.nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java, +        for (ObjectCursor<DiscoveryNode> cursor : allocation.nodes().getDataNodes().values()) {, +            if (allocation.nodes().getDataNodes().containsKey(node.nodeId())) {, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +                for (ObjectCursor<DiscoveryNode> cursor : entry.getValue().getState().nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/health/ClusterStateHealth.java, +        numberOfDataNodes = clusterState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java, +                count += currentState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java, +        final int dataNodeCount = event.state().nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java, +        return this.dataNodes;, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java, +        if (!nodes.getDataNodes().keys().contains(nodeId)) {, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java, +        for (ObjectCursor<DiscoveryNode> cursor : clusterState.nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java, +        for (ObjectCursor<DiscoveryNode> cursor : allocation.nodes().getDataNodes().values()) {, +            if (allocation.nodes().getDataNodes().containsKey(node.nodeId())) {, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDecider.java, +        if (allocation.nodes().getDataNodes().size() <= 1) {, +++ b/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java, +                for (ObjectCursor<DiscoveryNode> cursor : entry.getValue().getState().nodes().getDataNodes().values()) {, +++ b/core/src/main/java/org/elasticsearch/cluster/health/ClusterStateHealth.java, +        numberOfDataNodes = clusterState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java, +                count += currentState.nodes().getDataNodes().size();, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java, +        final int dataNodeCount = event.state().nodes().getDataNodes().size();]