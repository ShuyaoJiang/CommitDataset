[+++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (Files.isDirectory(templatesDir)) {, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (Files.isDirectory(templatesDir)) {, +++ b/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobContainer.java, +        Files.deleteIfExists(blobPath);, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (Files.isDirectory(templatesDir)) {, +++ b/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobContainer.java, +        Files.deleteIfExists(blobPath);, +++ b/src/main/java/org/elasticsearch/common/io/FileSystemUtils.java, +                if (delete) {, +                    Files.deleteIfExists(file);, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (Files.isDirectory(templatesDir)) {, +++ b/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobContainer.java, +        Files.deleteIfExists(blobPath);, +++ b/src/main/java/org/elasticsearch/common/io/FileSystemUtils.java, +                if (delete) {, +                    Files.deleteIfExists(file);, +++ b/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            if (Files.isDirectory(indicesLocation)) {, +            if (Files.isDirectory(location)) {, +        if (Files.isDirectory(indexPath)) {, +                    if (Files.isDirectory(shardPath)) {, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (Files.isDirectory(templatesDir)) {, +++ b/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobContainer.java, +        Files.deleteIfExists(blobPath);, +++ b/src/main/java/org/elasticsearch/common/io/FileSystemUtils.java, +                if (delete) {, +                    Files.deleteIfExists(file);, +++ b/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            if (Files.isDirectory(indicesLocation)) {, +            if (Files.isDirectory(location)) {, +        if (Files.isDirectory(indexPath)) {, +                    if (Files.isDirectory(shardPath)) {, +++ b/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java, +                if (!Files.isDirectory(stateDir)) {, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (Files.isDirectory(templatesDir)) {, +++ b/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobContainer.java, +        Files.deleteIfExists(blobPath);, +++ b/src/main/java/org/elasticsearch/common/io/FileSystemUtils.java, +                if (delete) {, +                    Files.deleteIfExists(file);, +++ b/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            if (Files.isDirectory(indicesLocation)) {, +            if (Files.isDirectory(location)) {, +        if (Files.isDirectory(indexPath)) {, +                    if (Files.isDirectory(shardPath)) {, +++ b/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java, +                if (!Files.isDirectory(stateDir)) {, +++ b/src/main/java/org/elasticsearch/http/HttpServer.java, +, +import java.nio.file.attribute.BasicFileAttributes;, +        , +        BasicFileAttributes attributes = Files.readAttributes(file, BasicFileAttributes.class);, +        if (!attributes.isRegularFile()) {, +            if (!attributes.isDirectory()) {, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (Files.isDirectory(templatesDir)) {, +++ b/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobContainer.java, +        Files.deleteIfExists(blobPath);, +++ b/src/main/java/org/elasticsearch/common/io/FileSystemUtils.java, +                if (delete) {, +                    Files.deleteIfExists(file);, +++ b/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            if (Files.isDirectory(indicesLocation)) {, +            if (Files.isDirectory(location)) {, +        if (Files.isDirectory(indexPath)) {, +                    if (Files.isDirectory(shardPath)) {, +++ b/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java, +                if (!Files.isDirectory(stateDir)) {, +++ b/src/main/java/org/elasticsearch/http/HttpServer.java, +, +import java.nio.file.attribute.BasicFileAttributes;, +        , +        BasicFileAttributes attributes = Files.readAttributes(file, BasicFileAttributes.class);, +        if (!attributes.isRegularFile()) {, +            if (!attributes.isDirectory()) {, +++ b/src/main/java/org/elasticsearch/plugins/PluginManager.java, +        if (Files.isDirectory(binFile)) {, +        if (Files.isDirectory(configFile)) {, +++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java, +        if (Files.isDirectory(templatesDir)) {, +++ b/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobContainer.java, +        Files.deleteIfExists(blobPath);, +++ b/src/main/java/org/elasticsearch/common/io/FileSystemUtils.java, +                if (delete) {, +                    Files.deleteIfExists(file);, +++ b/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            if (Files.isDirectory(indicesLocation)) {, +            if (Files.isDirectory(location)) {, +        if (Files.isDirectory(indexPath)) {, +                    if (Files.isDirectory(shardPath)) {, +++ b/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java, +                if (!Files.isDirectory(stateDir)) {, +++ b/src/main/java/org/elasticsearch/http/HttpServer.java, +]