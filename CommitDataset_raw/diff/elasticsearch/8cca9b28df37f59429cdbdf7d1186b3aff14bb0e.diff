[+++ b/src/main/java/org/elasticsearch/percolator/PercolatorService.java, +            if (parsedDocument.docs().size() > 1) {, +                assert indexShard.mapperService().documentMapper(request.documentType()).hasNestedObjects();, +++ b/src/main/java/org/elasticsearch/percolator/PercolatorService.java, +            if (parsedDocument.docs().size() > 1) {, +                assert indexShard.mapperService().documentMapper(request.documentType()).hasNestedObjects();, +++ b/src/test/java/org/elasticsearch/percolator/PercolatorTests.java, +    public void makeSureNonNestedDocumentDoesNotTriggerAssertion() throws IOException {, +        initNestedIndexAndPercolation();, +        XContentBuilder doc = jsonBuilder();, +        doc.startObject();, +        doc.field("some_unnested_field", "value");, +        PercolateResponse response = client().preparePercolate().setPercolateDoc(new PercolateSourceBuilder.DocBuilder().setDoc(doc)).setIndices("nestedindex").setDocumentType("company").get();, +        assertNoFailures(response);, +    }, +, +    @Test]