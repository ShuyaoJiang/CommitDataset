[+++ b/src/main/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQuery.java, +        final SearchContext searchContext = SearchContext.current();, +        final BytesRefHash parentIds = new BytesRefHash(512, searchContext.bigArrays());, +        boolean releaseParentIds = true;, +        try {, +            final ParentIdCollector collector = new ParentIdCollector(parentType, parentChildIndexFieldData, parentIds);, +            assert rewrittenChildQuery != null;, +            final Query childQuery = rewrittenChildQuery;, +            final ParentWeight parentWeight = new ParentWeight(parentFilter, shortCircuitFilter, parentIds);, +            releaseParentIds = false;, +        } finally {, +           if (releaseParentIds) {, +               Releasables.release(parentIds);, +           }, +        }, +, +, +++ b/src/main/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQuery.java, +        final SearchContext searchContext = SearchContext.current();, +        final BytesRefHash parentIds = new BytesRefHash(512, searchContext.bigArrays());, +        boolean releaseParentIds = true;, +        try {, +            final ParentIdCollector collector = new ParentIdCollector(parentType, parentChildIndexFieldData, parentIds);, +            assert rewrittenChildQuery != null;, +            final Query childQuery = rewrittenChildQuery;, +            final ParentWeight parentWeight = new ParentWeight(parentFilter, shortCircuitFilter, parentIds);, +            releaseParentIds = false;, +        } finally {, +           if (releaseParentIds) {, +               Releasables.release(parentIds);, +           }, +        }, +, +, +++ b/src/main/java/org/elasticsearch/index/search/child/ChildrenQuery.java, +        assert rewrittenChildQuery != null;, +        final Query childQuery = rewrittenChildQuery;, +, +++ b/src/main/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQuery.java, +        final SearchContext searchContext = SearchContext.current();, +        final BytesRefHash parentIds = new BytesRefHash(512, searchContext.bigArrays());, +        boolean releaseParentIds = true;, +        try {, +            final ParentIdCollector collector = new ParentIdCollector(parentType, parentChildIndexFieldData, parentIds);, +            assert rewrittenChildQuery != null;, +            final Query childQuery = rewrittenChildQuery;, +            final ParentWeight parentWeight = new ParentWeight(parentFilter, shortCircuitFilter, parentIds);, +            releaseParentIds = false;, +        } finally {, +           if (releaseParentIds) {, +               Releasables.release(parentIds);, +           }, +        }, +, +, +++ b/src/main/java/org/elasticsearch/index/search/child/ChildrenQuery.java, +        assert rewrittenChildQuery != null;, +        final Query childQuery = rewrittenChildQuery;, +, +++ b/src/main/java/org/elasticsearch/index/search/child/ParentConstantScoreQuery.java, +        final SearchContext searchContext = SearchContext.current();, +        final BytesRefHash parentIds = new BytesRefHash(512, searchContext.bigArrays());, +        boolean releaseParentIds = true;, +        try {, +            assert rewrittenParentQuery != null;, +            final Query parentQuery = rewrittenParentQuery;, +            final ChildrenWeight childrenWeight = new ChildrenWeight(childrenFilter, parentIds);, +            releaseParentIds = false;, +        } finally {, +            if (releaseParentIds) {, +                Releasables.release(parentIds);, +            }, +        }, +++ b/src/main/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQuery.java, +        final SearchContext searchContext = SearchContext.current();, +        final BytesRefHash parentIds = new BytesRefHash(512, searchContext.bigArrays());, +        boolean releaseParentIds = true;, +        try {, +            final ParentIdCollector collector = new ParentIdCollector(parentType, parentChildIndexFieldData, parentIds);, +            assert rewrittenChildQuery != null;, +            final Query childQuery = rewrittenChildQuery;, +            final ParentWeight parentWeight = new ParentWeight(parentFilter, shortCircuitFilter, parentIds);, +            releaseParentIds = false;, +        } finally {, +           if (releaseParentIds) {, +               Releasables.release(parentIds);, +           }, +        }, +, +, +++ b/src/main/java/org/elasticsearch/index/search/child/ChildrenQuery.java, +        assert rewrittenChildQuery != null;, +        final Query childQuery = rewrittenChildQuery;, +, +++ b/src/main/java/org/elasticsearch/index/search/child/ParentConstantScoreQuery.java, +        final SearchContext searchContext = SearchContext.current();, +        final BytesRefHash parentIds = new BytesRefHash(512, searchContext.bigArrays());, +        boolean releaseParentIds = true;, +        try {, +            assert rewrittenParentQuery != null;]