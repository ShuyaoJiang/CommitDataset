[+++ b/docs/reference/migration/migrate_7_0/settings.asciidoc, +[[trial-explicit-security]], +==== Security on Trial Licenses, +, +On trial licenses, `xpack.security.enabled` defaults to `false`., +, +In prior versions, a trial license would automatically enable security if either, +, +* `xpack.security.transport.enabled` was `true`; _or_, +* the trial license was generated on a version of X-Pack from 6.2 or earlier., +, +This behaviour has been now removed, so security is only enabled if:, +, +* `xpack.security.enabled` is `true`; _or_, +* `xpack.security.enabled` is not set, and a gold or platinum license is installed., +, +[float], +++ b/docs/reference/migration/migrate_7_0/settings.asciidoc, +[[trial-explicit-security]], +==== Security on Trial Licenses, +, +On trial licenses, `xpack.security.enabled` defaults to `false`., +, +In prior versions, a trial license would automatically enable security if either, +, +* `xpack.security.transport.enabled` was `true`; _or_, +* the trial license was generated on a version of X-Pack from 6.2 or earlier., +, +This behaviour has been now removed, so security is only enabled if:, +, +* `xpack.security.enabled` is `true`; _or_, +* `xpack.security.enabled` is not set, and a gold or platinum license is installed., +, +[float], +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/XPackLicenseState.java, +        this.isSecurityExplicitlyEnabled = isSecurityEnabled && settings.hasValue(XPackSettings.SECURITY_ENABLED.getKey());, +            isSecurityEnabled(mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(status.mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(status.mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(status.mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +     *             <li>A trial license</li>, +        return status.mode == OperationMode.TRIAL && isSecurityEnabled && isSecurityExplicitlyEnabled == false;, +                                             final boolean isSecurityEnabled) {, +        return mode == OperationMode.TRIAL ? isSecurityExplicitlyEnabled : isSecurityEnabled;, +++ b/docs/reference/migration/migrate_7_0/settings.asciidoc, +[[trial-explicit-security]], +==== Security on Trial Licenses, +, +On trial licenses, `xpack.security.enabled` defaults to `false`., +, +In prior versions, a trial license would automatically enable security if either, +, +* `xpack.security.transport.enabled` was `true`; _or_, +* the trial license was generated on a version of X-Pack from 6.2 or earlier., +, +This behaviour has been now removed, so security is only enabled if:, +, +* `xpack.security.enabled` is `true`; _or_, +* `xpack.security.enabled` is not set, and a gold or platinum license is installed., +, +[float], +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/XPackLicenseState.java, +        this.isSecurityExplicitlyEnabled = isSecurityEnabled && settings.hasValue(XPackSettings.SECURITY_ENABLED.getKey());, +            isSecurityEnabled(mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(status.mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(status.mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +            isSecurityEnabled(status.mode, isSecurityExplicitlyEnabled, isSecurityEnabled);, +     *             <li>A trial license</li>, +        return status.mode == OperationMode.TRIAL && isSecurityEnabled && isSecurityExplicitlyEnabled == false;, +                                             final boolean isSecurityEnabled) {, +        return mode == OperationMode.TRIAL ? isSecurityExplicitlyEnabled : isSecurityEnabled;, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/license/XPackLicenseStateTests.java, +        licenseState = new XPackLicenseState(Settings.EMPTY);, +        assertSecurityNotAllowed(licenseState);, +    }, +, +    public void testTransportSslDoesNotAutomaticallyEnableSecurityOnTrialLicense() {, +        final XPackLicenseState licenseState;, +        assertSecurityNotAllowed(licenseState);, +        assertSecurityNotAllowed(licenseState);, +        assertSecurityNotAllowed(licenseState);, +    }, +, +    private void assertSecurityNotAllowed(XPackLicenseState licenseState) {]