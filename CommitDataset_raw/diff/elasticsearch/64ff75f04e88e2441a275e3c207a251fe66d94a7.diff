[+++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/SecurityDocumentationIT.java, +            // 25 system roles plus the three we created, +            assertThat(roles.size(), equalTo(28));, +++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/SecurityDocumentationIT.java, +            // 25 system roles plus the three we created, +            assertThat(roles.size(), equalTo(28));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStore.java, +                .put("apm_user", new RoleDescriptor("apm_user",, +                    null, new RoleDescriptor.IndicesPrivileges[] {, +                        RoleDescriptor.IndicesPrivileges.builder().indices("apm-*"), +                            .privileges("read", "view_index_metadata").build(),, +                        RoleDescriptor.IndicesPrivileges.builder().indices(".ml-anomalies*"), +                            .privileges("view_index_metadata", "read").build(),, +                    }, null, MetadataUtils.DEFAULT_RESERVED_METADATA)), +++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/SecurityDocumentationIT.java, +            // 25 system roles plus the three we created, +            assertThat(roles.size(), equalTo(28));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStore.java, +                .put("apm_user", new RoleDescriptor("apm_user",, +                    null, new RoleDescriptor.IndicesPrivileges[] {, +                        RoleDescriptor.IndicesPrivileges.builder().indices("apm-*"), +                            .privileges("read", "view_index_metadata").build(),, +                        RoleDescriptor.IndicesPrivileges.builder().indices(".ml-anomalies*"), +                            .privileges("view_index_metadata", "read").build(),, +                    }, null, MetadataUtils.DEFAULT_RESERVED_METADATA)), +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStoreTests.java, +    public void testAPMUserRole() {, +        final TransportRequest request = mock(TransportRequest.class);, +, +        final RoleDescriptor roleDescriptor = new ReservedRolesStore().roleDescriptor("apm_user");, +        assertNotNull(roleDescriptor);, +        assertThat(roleDescriptor.getMetadata(), hasEntry("_reserved", true));, +, +        Role role = Role.builder(roleDescriptor, null).build();, +, +        assertThat(role.runAs().check(randomAlphaOfLengthBetween(1, 12)), is(false));, +, +        assertNoAccessAllowed(role, "foo");, +, +        assertOnlyReadAllowed(role, "apm-" + randomIntBetween(0, 5));, +        assertOnlyReadAllowed(role, AnomalyDetectorsIndexFields.RESULTS_INDEX_PREFIX + AnomalyDetectorsIndexFields.RESULTS_INDEX_DEFAULT);, +    }, +]