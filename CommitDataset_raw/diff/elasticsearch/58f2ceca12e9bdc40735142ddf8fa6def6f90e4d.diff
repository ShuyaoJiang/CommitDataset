[+++ b/src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java, +import org.elasticsearch.ElasticsearchIllegalStateException;, +import org.elasticsearch.search.aggregations.InvalidAggregationPathException;, +, +            Double thisBucketValue = resolveBucketValue(histo, bucket);, +                if (thisBucketValue == null) {, +                    throw new ElasticsearchIllegalStateException("FOUND GAP IN DATA"); // NOCOMMIT deal with gaps in data, +                }, +    private Double resolveBucketValue(InternalHistogram<? extends InternalHistogram.Bucket> histo, InternalHistogram.Bucket bucket) {, +        try {, +        } catch (InvalidAggregationPathException e) {, +            return null;, +        }]