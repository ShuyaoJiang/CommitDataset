[+++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/SecurityDocumentationIT.java, +            // 23 system roles plus the three we created, +            assertThat(roles.size(), equalTo(26));, +++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/SecurityDocumentationIT.java, +            // 23 system roles plus the three we created, +            assertThat(roles.size(), equalTo(26));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStore.java, +                                RoleDescriptor.IndicesPrivileges.builder(), +                                        .indices(".kibana*", ".reporting-*").privileges("all").build(),, +                                        .indices(".management-beats").privileges("create_index", "read", "write").build(),, +                                RoleDescriptor.IndicesPrivileges.builder(), +                                        .indices(".code-*").privileges("all").build(),, +                .put("code_admin", new RoleDescriptor("code_admin", new String[] {},, +                    new RoleDescriptor.IndicesPrivileges[] {, +                        RoleDescriptor.IndicesPrivileges.builder(), +                            .indices(".code-*").privileges("all").build(), +                    }, null, MetadataUtils.DEFAULT_RESERVED_METADATA)), +                .put("code_user", new RoleDescriptor("code_user", new String[] {},, +                    new RoleDescriptor.IndicesPrivileges[] {, +                        RoleDescriptor.IndicesPrivileges.builder(), +                            .indices(".code-*").privileges("read").build(), +                    }, null, MetadataUtils.DEFAULT_RESERVED_METADATA)), +++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/SecurityDocumentationIT.java, +            // 23 system roles plus the three we created, +            assertThat(roles.size(), equalTo(26));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStore.java, +                                RoleDescriptor.IndicesPrivileges.builder(), +                                        .indices(".kibana*", ".reporting-*").privileges("all").build(),, +                                        .indices(".management-beats").privileges("create_index", "read", "write").build(),, +                                RoleDescriptor.IndicesPrivileges.builder(), +                                        .indices(".code-*").privileges("all").build(),, +                .put("code_admin", new RoleDescriptor("code_admin", new String[] {},, +                    new RoleDescriptor.IndicesPrivileges[] {, +                        RoleDescriptor.IndicesPrivileges.builder(), +                            .indices(".code-*").privileges("all").build(), +                    }, null, MetadataUtils.DEFAULT_RESERVED_METADATA)), +                .put("code_user", new RoleDescriptor("code_user", new String[] {},, +                    new RoleDescriptor.IndicesPrivileges[] {, +                        RoleDescriptor.IndicesPrivileges.builder(), +                            .indices(".code-*").privileges("read").build(), +                    }, null, MetadataUtils.DEFAULT_RESERVED_METADATA)), +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStoreTests.java, +        assertThat(ReservedRolesStore.isReserved("code_admin"), is(true));, +        assertThat(ReservedRolesStore.isReserved("code_user"), is(true));, +, +, +    public void testCodeAdminRole() {, +        RoleDescriptor roleDescriptor = new ReservedRolesStore().roleDescriptor("code_admin");, +        assertNotNull(roleDescriptor);, +        assertThat(roleDescriptor.getMetadata(), hasEntry("_reserved", true));, +, +        Role codeAdminRole = Role.builder(roleDescriptor, null).build();, +, +, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(IndexAction.NAME).test("foo"), is(false));, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(IndexAction.NAME).test(".reporting"), is(false));, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(IndexAction.NAME).test(".code-"), is(true));, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher("indices:foo").test(randomAlphaOfLengthBetween(8, 24)),, +            is(false));, +, +        final String index = ".code-" + randomIntBetween(0, 5);, +, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(DeleteAction.NAME).test(index), is(true));, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(DeleteIndexAction.NAME).test(index), is(true));, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(CreateIndexAction.NAME).test(index), is(true));, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(IndexAction.NAME).test(index), is(true));, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(GetAction.NAME).test(index), is(true));, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(SearchAction.NAME).test(index), is(true));, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(MultiSearchAction.NAME).test(index), is(true));, +        assertThat(codeAdminRole.indices().allowedIndicesMatcher(UpdateSettingsAction.NAME).test(index), is(true));, +    }, +, +    public void testCodeUserRole() {, +        RoleDescriptor roleDescriptor = new ReservedRolesStore().roleDescriptor("code_user");, +        assertNotNull(roleDescriptor);, +        assertThat(roleDescriptor.getMetadata(), hasEntry("_reserved", true));, +, +        Role codeUserRole = Role.builder(roleDescriptor, null).build();, +, +, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(SearchAction.NAME).test("foo"), is(false));, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(SearchAction.NAME).test(".reporting"), is(false));, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(SearchAction.NAME).test(".code-"), is(true));, +        assertThat(codeUserRole.indices().allowedIndicesMatcher("indices:foo").test(randomAlphaOfLengthBetween(8, 24)),, +            is(false));, +, +        final String index = ".code-" + randomIntBetween(0, 5);, +, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(DeleteAction.NAME).test(index), is(false));, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(DeleteIndexAction.NAME).test(index), is(false));, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(CreateIndexAction.NAME).test(index), is(false));, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(IndexAction.NAME).test(index), is(false));, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(GetAction.NAME).test(index), is(true));, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(SearchAction.NAME).test(index), is(true));, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(MultiSearchAction.NAME).test(index), is(true));, +        assertThat(codeUserRole.indices().allowedIndicesMatcher(UpdateSettingsAction.NAME).test(index), is(false));, +    }]