[+++ b/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java, +        context.searchContext().addReleasable(this, Lifetime.PHASE);, +++ b/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java, +        context.searchContext().addReleasable(this, Lifetime.PHASE);, +++ b/src/main/java/org/elasticsearch/search/query/QueryPhase.java, +        // Pre-process facets and aggregations as late as possible. In the case of a DFS_Q_T_F, +        // request, preProcess is called on the DFS phase phase, this is why we pre-process them, +        // here to make sure it happens during the QUERY phase, +        facetPhase.preProcess(searchContext);, +        aggregationPhase.preProcess(searchContext);, +]