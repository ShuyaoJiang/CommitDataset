[+++ b/src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java, +    private final ThreadPool threadPool;, +    public IndexShardGateway(ShardId shardId, @IndexSettings Settings indexSettings, ThreadPool threadPool, MappingUpdatedAction mappingUpdatedAction,, +        this.threadPool = threadPool;, +        indexShard.store().incRef();, +                indexShard.store().failIfCorrupted();, +                    si = Lucene.readSegmentInfos(indexShard.store().directory());, +                        files = Arrays.toString(indexShard.store().directory().listAll());, +                        IndexWriter writer = new IndexWriter(indexShard.store().directory(), new IndexWriterConfig(Lucene.STANDARD_ANALYZER).setOpenMode(IndexWriterConfig.OpenMode.CREATE));, +                    final Directory directory = indexShard.store().directory();, +            indexShard.store().decRef();, +++ b/src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java, +    private final ThreadPool threadPool;, +    public IndexShardGateway(ShardId shardId, @IndexSettings Settings indexSettings, ThreadPool threadPool, MappingUpdatedAction mappingUpdatedAction,, +        this.threadPool = threadPool;, +        indexShard.store().incRef();, +                indexShard.store().failIfCorrupted();, +                    si = Lucene.readSegmentInfos(indexShard.store().directory());, +                        files = Arrays.toString(indexShard.store().directory().listAll());, +                        IndexWriter writer = new IndexWriter(indexShard.store().directory(), new IndexWriterConfig(Lucene.STANDARD_ANALYZER).setOpenMode(IndexWriterConfig.OpenMode.CREATE));, +                    final Directory directory = indexShard.store().directory();, +            indexShard.store().decRef();, +++ b/src/main/java/org/elasticsearch/index/store/Store.java, +++ b/src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java, +    private final ThreadPool threadPool;, +    public IndexShardGateway(ShardId shardId, @IndexSettings Settings indexSettings, ThreadPool threadPool, MappingUpdatedAction mappingUpdatedAction,, +        this.threadPool = threadPool;, +        indexShard.store().incRef();, +                indexShard.store().failIfCorrupted();, +                    si = Lucene.readSegmentInfos(indexShard.store().directory());, +                        files = Arrays.toString(indexShard.store().directory().listAll());, +                        IndexWriter writer = new IndexWriter(indexShard.store().directory(), new IndexWriterConfig(Lucene.STANDARD_ANALYZER).setOpenMode(IndexWriterConfig.OpenMode.CREATE));, +                    final Directory directory = indexShard.store().directory();, +            indexShard.store().decRef();, +++ b/src/main/java/org/elasticsearch/index/store/Store.java, +++ b/src/test/java/org/elasticsearch/index/store/CorruptedFileTest.java, +    @AwaitsFix(bugUrl = "https://github.com/elastic/elasticsearch/issues/11226"), +++ b/src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java, +    private final ThreadPool threadPool;, +    public IndexShardGateway(ShardId shardId, @IndexSettings Settings indexSettings, ThreadPool threadPool, MappingUpdatedAction mappingUpdatedAction,, +        this.threadPool = threadPool;, +        indexShard.store().incRef();, +                indexShard.store().failIfCorrupted();, +                    si = Lucene.readSegmentInfos(indexShard.store().directory());, +                        files = Arrays.toString(indexShard.store().directory().listAll());, +                        IndexWriter writer = new IndexWriter(indexShard.store().directory(), new IndexWriterConfig(Lucene.STANDARD_ANALYZER).setOpenMode(IndexWriterConfig.OpenMode.CREATE));, +                    final Directory directory = indexShard.store().directory();, +            indexShard.store().decRef();, +++ b/src/main/java/org/elasticsearch/index/store/Store.java, +++ b/src/test/java/org/elasticsearch/index/store/CorruptedFileTest.java, +    @AwaitsFix(bugUrl = "https://github.com/elastic/elasticsearch/issues/11226"), +++ b/src/test/java/org/elasticsearch/index/store/StoreTest.java]