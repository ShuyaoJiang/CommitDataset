[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java, +        return new PlainShardsIterator(allShards, counter.incrementAndGet());, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java, +        return new PlainShardsIterator(allShards, counter.incrementAndGet());, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/PlainShardsIterator.java, +    private final List<ShardRouting> shards;, +, +    private final int size;, +        this.size = shards.size();, +        return counter < size;, +        return size;, +        while (counter++ < size) {, +        while (counter++ < size) {, +        while (counter++ < size) {, +        while (counter++ < size) {, +    final ShardRouting shardModulo(int counter) {, +        return shards.get((counter % size));]