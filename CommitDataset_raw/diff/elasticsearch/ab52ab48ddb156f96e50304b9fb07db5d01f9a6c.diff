[+++ b/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotTests.java, +import org.junit.Before;, +    @Before, +++ b/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotTests.java, +import org.junit.Before;, +    @Before, +++ b/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java, +        final int numberOfSnapshots = between(5, 15);, +        int[] numberOfFiles = new int[numberOfSnapshots];, +        logger.info("--> creating {} snapshots ", numberOfSnapshots);, +        for (int i = 0; i < numberOfSnapshots; i++) {, +        assertThat(run(client.prepareCount("test-idx")).getCount(), equalTo(10L * numberOfSnapshots));, +        for (int i = 1; i < numberOfSnapshots - 1; i++) {, +        String lastSnapshot = "test-snap-" + (numberOfSnapshots - 1);, +        RestoreSnapshotResponse restoreSnapshotResponse = client.admin().cluster().prepareRestoreSnapshot("test-repo", lastSnapshot).setWaitForCompletion(true).execute().actionGet();, +        assertThat(run(client.prepareCount("test-idx")).getCount(), equalTo(10L * numberOfSnapshots));, +        run(client.admin().cluster().prepareDeleteSnapshot("test-repo", lastSnapshot));, +//    @LuceneTestCase.AwaitsFix(bugUrl="imotov is working on the fix")]