[+++ b/client/rest/src/main/java/org/elasticsearch/client/RestClient.java, +    RestClient(CloseableHttpClient client, long maxRetryTimeoutMillis, Header[] defaultHeaders,, +        private HttpClientConfigCallback httpClientConfigCallback;, +         * Sets the default request headers, to be used sent with every request unless overridden on a per request basis, +            Objects.requireNonNull(defaultHeaders, "defaultHeaders must not be null");, +            Objects.requireNonNull(failureListener, "failureListener must not be null");, +         * Sets the {@link HttpClientConfigCallback} to be used to customize http client configuration, +         */, +        public Builder setHttpClientConfigCallback(HttpClientConfigCallback httpClientConfigCallback) {, +            Objects.requireNonNull(httpClientConfigCallback, "httpClientConfigCallback must not be null");, +            this.httpClientConfigCallback = httpClientConfigCallback;, +            return this;, +        }, +, +        /**, +            CloseableHttpClient httpClient = createHttpClient();, +        private CloseableHttpClient createHttpClient() {, +            //default timeouts are all infinite, +            RequestConfig.Builder requestConfigBuilder = RequestConfig.custom().setConnectTimeout(DEFAULT_CONNECT_TIMEOUT_MILLIS), +                    .setSocketTimeout(DEFAULT_SOCKET_TIMEOUT_MILLIS), +                    .setConnectionRequestTimeout(DEFAULT_CONNECTION_REQUEST_TIMEOUT_MILLIS);, +, +            if (httpClientConfigCallback != null) {, +                httpClientConfigCallback.customizeDefaultRequestConfig(requestConfigBuilder);, +            RequestConfig requestConfig = requestConfigBuilder.build();, +, +            PoolingHttpClientConnectionManager connectionManager = new PoolingHttpClientConnectionManager();, +            HttpClientBuilder httpClientBuilder = HttpClientBuilder.create().setConnectionManager(connectionManager), +                    .setDefaultRequestConfig(requestConfig);, +, +            if (httpClientConfigCallback != null) {, +                httpClientConfigCallback.customizeHttpClient(httpClientBuilder);, +            return httpClientBuilder.build();, +        }, +    }, +, +    /**, +     * Callback used to customize the {@link CloseableHttpClient} instance used by a {@link RestClient} instance., +     * Allows to customize default {@link RequestConfig} being set to the client and any parameter that, +     * can be set through {@link HttpClientBuilder}, +     */, +    public interface HttpClientConfigCallback {, +        /**, +         * Allows to customize the {@link RequestConfig} that will be used with each request., +         * It is common to customize the different timeout values through this method without losing any other useful default, +         * value that the {@link RestClient.Builder} sets internally., +         */, +        void customizeDefaultRequestConfig(RequestConfig.Builder requestConfigBuilder);, +, +        /**, +         * Allows to customize the {@link CloseableHttpClient} being created and used by the {@link RestClient}., +         * It is common to customzie the default {@link org.apache.http.client.CredentialsProvider} through this method,, +         * or the {@link org.apache.http.conn.HttpClientConnectionManager} being used without losing any other useful default, +         * value that the {@link RestClient.Builder} sets internally., +         */, +        void customizeHttpClient(HttpClientBuilder httpClientBuilder);, +++ b/client/rest/src/main/java/org/elasticsearch/client/RestClient.java, +    RestClient(CloseableHttpClient client, long maxRetryTimeoutMillis, Header[] defaultHeaders,, +        private HttpClientConfigCallback httpClientConfigCallback;, +         * Sets the default request headers, to be used sent with every request unless overridden on a per request basis, +            Objects.requireNonNull(defaultHeaders, "defaultHeaders must not be null");, +            Objects.requireNonNull(failureListener, "failureListener must not be null");, +         * Sets the {@link HttpClientConfigCallback} to be used to customize http client configuration, +         */, +        public Builder setHttpClientConfigCallback(HttpClientConfigCallback httpClientConfigCallback) {, +            Objects.requireNonNull(httpClientConfigCallback, "httpClientConfigCallback must not be null");, +            this.httpClientConfigCallback = httpClientConfigCallback;, +            return this;, +        }, +, +        /**, +            CloseableHttpClient httpClient = createHttpClient();, +        private CloseableHttpClient createHttpClient() {, +            //default timeouts are all infinite, +            RequestConfig.Builder requestConfigBuilder = RequestConfig.custom().setConnectTimeout(DEFAULT_CONNECT_TIMEOUT_MILLIS), +                    .setSocketTimeout(DEFAULT_SOCKET_TIMEOUT_MILLIS), +                    .setConnectionRequestTimeout(DEFAULT_CONNECTION_REQUEST_TIMEOUT_MILLIS);, +, +            if (httpClientConfigCallback != null) {, +                httpClientConfigCallback.customizeDefaultRequestConfig(requestConfigBuilder);, +            RequestConfig requestConfig = requestConfigBuilder.build();, +, +            PoolingHttpClientConnectionManager connectionManager = new PoolingHttpClientConnectionManager();, +            HttpClientBuilder httpClientBuilder = HttpClientBuilder.create().setConnectionManager(connectionManager), +                    .setDefaultRequestConfig(requestConfig);, +, +            if (httpClientConfigCallback != null) {, +                httpClientConfigCallback.customizeHttpClient(httpClientBuilder);, +            return httpClientBuilder.build();, +        }, +    }, +, +    /**, +     * Callback used to customize the {@link CloseableHttpClient} instance used by a {@link RestClient} instance., +     * Allows to customize default {@link RequestConfig} being set to the client and any parameter that, +     * can be set through {@link HttpClientBuilder}, +     */, +    public interface HttpClientConfigCallback {, +        /**, +         * Allows to customize the {@link RequestConfig} that will be used with each request.]