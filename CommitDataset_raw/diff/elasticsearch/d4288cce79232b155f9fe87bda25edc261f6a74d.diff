[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-Xms" + System.getProperty('tests.heap.size', '512m') +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-Xms" + System.getProperty('tests.heap.size', '512m') +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-Xms" + System.getProperty('tests.heap.size', '512m') +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +  <suppress files="test[/\\]framework[/\\]src[/\\]main[/\\]java[/\\]org[/\\]elasticsearch[/\\]test[/\\]junit[/\\]listeners[/\\]LoggingListener.java" checks="LineLength" />, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-Xms" + System.getProperty('tests.heap.size', '512m') +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +  <suppress files="test[/\\]framework[/\\]src[/\\]main[/\\]java[/\\]org[/\\]elasticsearch[/\\]test[/\\]junit[/\\]listeners[/\\]LoggingListener.java" checks="LineLength" />, +++ b/core/build.gradle, +  testCompile 'com.google.jimfs:jimfs:1.1', +  testCompile 'com.google.guava:guava:18.0', +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-Xms" + System.getProperty('tests.heap.size', '512m') +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +  <suppress files="test[/\\]framework[/\\]src[/\\]main[/\\]java[/\\]org[/\\]elasticsearch[/\\]test[/\\]junit[/\\]listeners[/\\]LoggingListener.java" checks="LineLength" />, +++ b/core/build.gradle, +  testCompile 'com.google.jimfs:jimfs:1.1', +  testCompile 'com.google.guava:guava:18.0', +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +, +                @Override, +                public boolean runOnlyOnMaster() {, +                    return !request.local();, +            });, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-Xms" + System.getProperty('tests.heap.size', '512m') +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +  <suppress files="test[/\\]framework[/\\]src[/\\]main[/\\]java[/\\]org[/\\]elasticsearch[/\\]test[/\\]junit[/\\]listeners[/\\]LoggingListener.java" checks="LineLength" />, +++ b/core/build.gradle, +  testCompile 'com.google.jimfs:jimfs:1.1', +  testCompile 'com.google.guava:guava:18.0', +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +, +                @Override, +                public boolean runOnlyOnMaster() {, +                    return !request.local();, +            });, +++ b/core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +import org.elasticsearch.common.settings.KeyStoreWrapper;, +    private static KeyStoreWrapper loadKeyStore(Environment env0) throws BootstrapException {, +        final KeyStoreWrapper keystore;, +        try {, +            keystore = KeyStoreWrapper.loadMetadata(env0.configFile());, +        } catch (IOException e) {, +            throw new BootstrapException(e);, +        }, +        if (keystore == null) {, +            return null; // no keystore, +        }, +, +        try {, +            keystore.loadKeystore(new char[0] /* TODO: read password from stdin */);, +        } catch (Exception e) {, +            throw new BootstrapException(e);, +        }, +        return keystore;, +    }, +, +    private static Environment initialEnvironment(boolean foreground, Path pidFile,, +                                                  KeyStoreWrapper keystore, Settings initialSettings) {, +        builder.setKeyStore(keystore);, +            final Environment env0) throws BootstrapException, NodeValidationException, UserException {, +        final KeyStoreWrapper keystore = loadKeyStore(env0);, +        Environment environment = initialEnvironment(foreground, pidFile, keystore, env0.settings());, +            try {, +                // any secure settings must be read during node construction, +                IOUtils.close(keystore);, +            } catch (IOException e) {, +                throw new BootstrapException(e);, +            }, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +    String jvmArgs = "-Xms" + System.getProperty('tests.heap.size', '512m') +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +++ b/buildSrc/src/main/resources/checkstyle_suppressions.xml, +  <suppress files="test[/\\]framework[/\\]src[/\\]main[/\\]java[/\\]org[/\\]elasticsearch[/\\]test[/\\]junit[/\\]listeners[/\\]LoggingListener.java" checks="LineLength" />, +++ b/core/build.gradle, +  testCompile 'com.google.jimfs:jimfs:1.1', +  testCompile 'com.google.guava:guava:18.0', +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +, +                @Override, +                public boolean runOnlyOnMaster() {, +                    return !request.local();, +            });, +++ b/core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java, +import org.elasticsearch.common.settings.KeyStoreWrapper;, +    private static KeyStoreWrapper loadKeyStore(Environment env0) throws BootstrapException {, +        final KeyStoreWrapper keystore;, +        try {, +            keystore = KeyStoreWrapper.loadMetadata(env0.configFile());]