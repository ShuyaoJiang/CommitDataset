[+++ b/modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java, +        assertBusy(() -> assertTrue(ALLOWED_OPERATIONS.availablePermits() == 0 && ALLOWED_OPERATIONS.getQueueLength() == 0));, +++ b/modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java, +        assertBusy(() -> assertTrue(ALLOWED_OPERATIONS.availablePermits() == 0 && ALLOWED_OPERATIONS.getQueueLength() == 0));, +++ b/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java, +        assertBusy(codeBlock, 10, TimeUnit.SECONDS);, +    public static void assertBusy(Runnable codeBlock, long maxWaitTime, TimeUnit unit) throws Exception {, +                codeBlock.run();, +                return;, +            codeBlock.run();]