[+++ b/core/src/test/java/org/elasticsearch/cluster/ClusterServiceIT.java, +    public void testClusterStateBatchedUpdates() throws BrokenBarrierException, InterruptedException {, +        CyclicBarrier barrier = new CyclicBarrier(1 + numberOfThreads);, +                    barrier.await();, +                    barrier.await();, +                } catch (BrokenBarrierException | InterruptedException e) {, +                    throw new AssertionError(e);, +        // wait for all threads to be ready, +        barrier.await();, +        // wait for all threads to finish, +        barrier.await();, +++ b/core/src/test/java/org/elasticsearch/cluster/ClusterServiceIT.java, +    public void testClusterStateBatchedUpdates() throws BrokenBarrierException, InterruptedException {, +        CyclicBarrier barrier = new CyclicBarrier(1 + numberOfThreads);, +                    barrier.await();, +                    barrier.await();, +                } catch (BrokenBarrierException | InterruptedException e) {, +                    throw new AssertionError(e);, +        // wait for all threads to be ready, +        barrier.await();, +        // wait for all threads to finish, +        barrier.await();, +++ b/core/src/test/java/org/elasticsearch/common/cache/CacheTests.java, +import java.util.concurrent.BrokenBarrierException;, +import java.util.concurrent.CyclicBarrier;, +    public void testComputeIfAbsentCallsOnce() throws BrokenBarrierException, InterruptedException {, +, +        CyclicBarrier barrier = new CyclicBarrier(1 + numberOfThreads);, +                    barrier.await();, +                            fail(e.getMessage());, +                    barrier.await();, +                } catch (BrokenBarrierException | InterruptedException e) {, +                    throw new AssertionError(e);, +, +        // wait for all threads to be ready, +        barrier.await();, +        // wait for all threads to finish, +        barrier.await();, +    public void testDependentKeyDeadlock() throws BrokenBarrierException, InterruptedException {, +, +        CyclicBarrier barrier = new CyclicBarrier(1 + numberOfThreads);, +                        barrier.await();, +                    } catch (BrokenBarrierException | InterruptedException e) {, +                        throw new AssertionError(e);, +        barrier.await();, +    public void testCachePollution() throws BrokenBarrierException, InterruptedException {, +, +        CyclicBarrier barrier = new CyclicBarrier(1 + numberOfThreads);, +, +                    barrier.await();, +                    barrier.await();, +                } catch (BrokenBarrierException | InterruptedException e) {, +                    throw new AssertionError(e);, +        // wait for all threads to be ready, +        barrier.await();, +        // wait for all threads to finish, +        barrier.await();, +    public void testTorture() throws BrokenBarrierException, InterruptedException {, +        CyclicBarrier barrier = new CyclicBarrier(1 + numberOfThreads);, +                    barrier.await();, +                    barrier.await();, +                } catch (BrokenBarrierException | InterruptedException e) {, +                    throw new AssertionError(e);, +, +        // wait for all threads to be ready, +        barrier.await();, +        // wait for all threads to finish, +        barrier.await();]