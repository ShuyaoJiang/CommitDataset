[+++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +                ExecutableScript executableScript = scriptService.executable(script, ScriptContext.Standard.UPDATE, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +                ExecutableScript executableScript = scriptService.executable(script, ScriptContext.Standard.UPDATE, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/http/HttpServer.java, +import java.io.ByteArrayOutputStream;, +import java.io.IOException;, +import java.io.InputStream;, +import java.util.concurrent.atomic.AtomicBoolean;, +, +                      CircuitBreakerService circuitBreakerService) {, +            restController.dispatchRequest(request, responseChannel, threadContext);, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +                ExecutableScript executableScript = scriptService.executable(script, ScriptContext.Standard.UPDATE, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/http/HttpServer.java, +import java.io.ByteArrayOutputStream;, +import java.io.IOException;, +import java.io.InputStream;, +import java.util.concurrent.atomic.AtomicBoolean;, +, +                      CircuitBreakerService circuitBreakerService) {, +            restController.dispatchRequest(request, responseChannel, threadContext);, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +                        ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +                ExecutableScript executableScript = scriptService.executable(script, ScriptContext.Standard.UPDATE, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/http/HttpServer.java, +import java.io.ByteArrayOutputStream;, +import java.io.IOException;, +import java.io.InputStream;, +import java.util.concurrent.atomic.AtomicBoolean;, +, +                      CircuitBreakerService circuitBreakerService) {, +            restController.dispatchRequest(request, responseChannel, threadContext);, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +                        ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java, +        return new ScriptQuery(script, context.getScriptService(), context.lookup());, +        public ScriptQuery(Script script, ScriptService scriptService, SearchLookup searchLookup) {, +            this.searchScript = scriptService.search(searchLookup, script, ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +                ExecutableScript executableScript = scriptService.executable(script, ScriptContext.Standard.UPDATE, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/http/HttpServer.java, +import java.io.ByteArrayOutputStream;, +import java.io.IOException;, +import java.io.InputStream;, +import java.util.concurrent.atomic.AtomicBoolean;, +, +                      CircuitBreakerService circuitBreakerService) {, +            restController.dispatchRequest(request, responseChannel, threadContext);, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +                        ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java, +        return new ScriptQuery(script, context.getScriptService(), context.lookup());, +        public ScriptQuery(Script script, ScriptService scriptService, SearchLookup searchLookup) {, +            this.searchScript = scriptService.search(searchLookup, script, ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/index/query/TemplateQueryBuilder.java, +            ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +                ExecutableScript executableScript = scriptService.executable(script, ScriptContext.Standard.UPDATE, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/http/HttpServer.java, +import java.io.ByteArrayOutputStream;, +import java.io.IOException;, +import java.io.InputStream;, +import java.util.concurrent.atomic.AtomicBoolean;, +, +                      CircuitBreakerService circuitBreakerService) {, +            restController.dispatchRequest(request, responseChannel, threadContext);, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +                        ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java, +        return new ScriptQuery(script, context.getScriptService(), context.lookup());, +        public ScriptQuery(Script script, ScriptService scriptService, SearchLookup searchLookup) {, +            this.searchScript = scriptService.search(searchLookup, script, ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/index/query/TemplateQueryBuilder.java, +            ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +                    Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java, +                ExecutableScript executableScript = scriptService.executable(script, ScriptContext.Standard.UPDATE, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/http/HttpServer.java, +import java.io.ByteArrayOutputStream;, +import java.io.IOException;, +import java.io.InputStream;, +import java.util.concurrent.atomic.AtomicBoolean;, +, +                      CircuitBreakerService circuitBreakerService) {, +            restController.dispatchRequest(request, responseChannel, threadContext);, +++ b/core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java, +                        ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java, +        return new ScriptQuery(script, context.getScriptService(), context.lookup());, +        public ScriptQuery(Script script, ScriptService scriptService, SearchLookup searchLookup) {, +            this.searchScript = scriptService.search(searchLookup, script, ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/index/query/TemplateQueryBuilder.java, +            ScriptContext.Standard.SEARCH, Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +                    Collections.emptyMap());, +++ b/core/src/main/java/org/elasticsearch/ingest/InternalTemplateService.java, +                Collections.emptyMap());]