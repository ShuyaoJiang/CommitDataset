[+++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java, +import org.apache.lucene.search.join.ParentChildrenBlockJoinQuery;, +import org.elasticsearch.search.SearchHit;, +            int parentDocId = hitContext.readerContext().docBase + hitContext.docId();, +            Query q = Queries.filtered(query(), new ParentChildrenBlockJoinQuery(parentFilter, childFilter, parentDocId));, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java, +import org.apache.lucene.search.join.ParentChildrenBlockJoinQuery;, +import org.elasticsearch.search.SearchHit;, +            int parentDocId = hitContext.readerContext().docBase + hitContext.docId();, +            Query q = Queries.filtered(query(), new ParentChildrenBlockJoinQuery(parentFilter, childFilter, parentDocId));, +++ /dev/null]