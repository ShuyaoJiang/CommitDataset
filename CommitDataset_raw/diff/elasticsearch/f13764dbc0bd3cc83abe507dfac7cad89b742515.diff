[+++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +import org.elasticsearch.xpack.support.clock.Clock;, +import org.elasticsearch.xpack.support.clock.SystemClock;, +    // overridable by tests, +    protected Clock getClock() {, +        return SystemClock.INSTANCE;, +    }, +, +        modules.add(b -> b.bind(Clock.class).toInstance(getClock()));, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +import org.elasticsearch.xpack.support.clock.Clock;, +import org.elasticsearch.xpack.support.clock.SystemClock;, +    // overridable by tests, +    protected Clock getClock() {, +        return SystemClock.INSTANCE;, +    }, +, +        modules.add(b -> b.bind(Clock.class).toInstance(getClock()));, +++ /dev/null, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +import org.elasticsearch.xpack.support.clock.Clock;, +import org.elasticsearch.xpack.support.clock.SystemClock;, +    // overridable by tests, +    protected Clock getClock() {, +        return SystemClock.INSTANCE;, +    }, +, +        modules.add(b -> b.bind(Clock.class).toInstance(getClock()));, +++ /dev/null, +++ b/elasticsearch/x-pack/src/test/java/org/elasticsearch/xpack/TimeWarpedXPackPlugin.java, +    protected Clock getClock() {, +        return new ClockMock();, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +import org.elasticsearch.xpack.support.clock.Clock;, +import org.elasticsearch.xpack.support.clock.SystemClock;, +    // overridable by tests, +    protected Clock getClock() {, +        return SystemClock.INSTANCE;, +    }, +, +        modules.add(b -> b.bind(Clock.class).toInstance(getClock()));, +++ /dev/null, +++ b/elasticsearch/x-pack/src/test/java/org/elasticsearch/xpack/TimeWarpedXPackPlugin.java, +    protected Clock getClock() {, +        return new ClockMock();, +++ b/elasticsearch/x-pack/src/test/java/org/elasticsearch/xpack/support/clock/ClockMock.java, + * A clock that can be modified for testing., +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +import org.elasticsearch.xpack.support.clock.Clock;, +import org.elasticsearch.xpack.support.clock.SystemClock;, +    // overridable by tests, +    protected Clock getClock() {, +        return SystemClock.INSTANCE;, +    }, +, +        modules.add(b -> b.bind(Clock.class).toInstance(getClock()));, +++ /dev/null, +++ b/elasticsearch/x-pack/src/test/java/org/elasticsearch/xpack/TimeWarpedXPackPlugin.java, +    protected Clock getClock() {, +        return new ClockMock();, +++ b/elasticsearch/x-pack/src/test/java/org/elasticsearch/xpack/support/clock/ClockMock.java, + * A clock that can be modified for testing., +++ b/elasticsearch/x-pack/watcher/src/test/java/org/elasticsearch/xpack/watcher/test/AbstractWatcherIntegrationTestCase.java, +import org.elasticsearch.xpack.support.clock.Clock;, +            timeWarp = new TimeWarp(getInstanceFromMaster(ScheduleTriggerEngineMock.class), (ClockMock)getInstanceFromMaster(Clock.class));, +++ b/elasticsearch/x-pack/src/main/java/org/elasticsearch/xpack/XPackPlugin.java, +import org.elasticsearch.xpack.support.clock.Clock;, +import org.elasticsearch.xpack.support.clock.SystemClock;, +    // overridable by tests, +    protected Clock getClock() {, +        return SystemClock.INSTANCE;, +    }, +, +        modules.add(b -> b.bind(Clock.class).toInstance(getClock()));, +++ /dev/null, +++ b/elasticsearch/x-pack/src/test/java/org/elasticsearch/xpack/TimeWarpedXPackPlugin.java, +    protected Clock getClock() {, +        return new ClockMock();, +++ b/elasticsearch/x-pack/src/test/java/org/elasticsearch/xpack/support/clock/ClockMock.java, + * A clock that can be modified for testing., +++ b/elasticsearch/x-pack/watcher/src/test/java/org/elasticsearch/xpack/watcher/test/AbstractWatcherIntegrationTestCase.java, +import org.elasticsearch.xpack.support.clock.Clock;, +            timeWarp = new TimeWarp(getInstanceFromMaster(ScheduleTriggerEngineMock.class), (ClockMock)getInstanceFromMaster(Clock.class));, +++ b/elasticsearch/x-pack/watcher/src/test/java/org/elasticsearch/xpack/watcher/test/integration/BasicWatcherTests.java]