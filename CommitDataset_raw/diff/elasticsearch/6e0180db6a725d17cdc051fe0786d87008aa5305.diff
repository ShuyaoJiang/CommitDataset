[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +import org.elasticsearch.index.Index;, +import org.elasticsearch.index.shard.ShardId;, +    public File indexLocation(Index index) {, +        return new File(new File(nodeDataLocation(), "indices"), index.name());, +    }, +, +    public File shardLocation(ShardId shardId) {, +        return new File(indexLocation(shardId.index()), Integer.toString(shardId.id()));, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +import org.elasticsearch.index.Index;, +import org.elasticsearch.index.shard.ShardId;, +    public File indexLocation(Index index) {, +        return new File(new File(nodeDataLocation(), "indices"), index.name());, +    }, +, +    public File shardLocation(ShardId shardId) {, +        return new File(indexLocation(shardId.index()), Integer.toString(shardId.id()));, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/store/fs/FsIndexStore.java, +    private final NodeEnvironment nodeEnv;, +, +        this.nodeEnv = nodeEnv;, +            this.location = nodeEnv.indexLocation(index);, +        return nodeEnv.shardLocation(shardId);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +import org.elasticsearch.index.Index;, +import org.elasticsearch.index.shard.ShardId;, +    public File indexLocation(Index index) {, +        return new File(new File(nodeDataLocation(), "indices"), index.name());, +    }, +, +    public File shardLocation(ShardId shardId) {, +        return new File(indexLocation(shardId.index()), Integer.toString(shardId.id()));, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/store/fs/FsIndexStore.java, +    private final NodeEnvironment nodeEnv;, +, +        this.nodeEnv = nodeEnv;, +            this.location = nodeEnv.indexLocation(index);, +        return nodeEnv.shardLocation(shardId);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/translog/fs/FsTranslog.java, +        this.location = new File(nodeEnv.shardLocation(shardId), "translog");, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +import org.elasticsearch.index.Index;, +import org.elasticsearch.index.shard.ShardId;, +    public File indexLocation(Index index) {, +        return new File(new File(nodeDataLocation(), "indices"), index.name());, +    }, +, +    public File shardLocation(ShardId shardId) {, +        return new File(indexLocation(shardId.index()), Integer.toString(shardId.id()));, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/store/fs/FsIndexStore.java, +    private final NodeEnvironment nodeEnv;, +, +        this.nodeEnv = nodeEnv;, +            this.location = nodeEnv.indexLocation(index);, +        return nodeEnv.shardLocation(shardId);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/translog/fs/FsTranslog.java, +        this.location = new File(nodeEnv.shardLocation(shardId), "translog");, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/indices/store/TransportNodesListShardStoreMetaData.java, +        File indexFile = new File(nodeEnv.shardLocation(shardId), "index");]