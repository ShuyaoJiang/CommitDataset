[+++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +import org.elasticsearch.search.profile.Profilers;, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +import org.elasticsearch.search.profile.Profilers;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregator.java, +import java.util.Collections;, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +import org.elasticsearch.search.profile.Profilers;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregator.java, +import java.util.Collections;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregatorFactory.java, +import java.util.Collections;, +        return script == null ? null, +                : context.scriptService().search(context.lookup(), script, ScriptContext.Standard.AGGS, Collections.emptyMap());]