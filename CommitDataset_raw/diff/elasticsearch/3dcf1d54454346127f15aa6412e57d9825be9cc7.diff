[+++ b/core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java, +        // Doesn't make sense to manage shards on non-master and non-data nodes, +        if (DiscoveryNode.isDataNode(settings) || DiscoveryNode.isMasterNode(settings)) {, +    }, +        if (DiscoveryNode.isDataNode(settings) || DiscoveryNode.isMasterNode(settings)) {, +    }, +++ b/core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java, +        // Doesn't make sense to manage shards on non-master and non-data nodes, +        if (DiscoveryNode.isDataNode(settings) || DiscoveryNode.isMasterNode(settings)) {, +    }, +        if (DiscoveryNode.isDataNode(settings) || DiscoveryNode.isMasterNode(settings)) {, +    }, +++ b/core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java, +        // Doesn't make sense to delete shards on non-data nodes, +        if (DiscoveryNode.isDataNode(settings)) {, +            clusterService.add(this);, +        }, +        if (DiscoveryNode.isDataNode(settings)) {, +    }]