[+++ b/modules/ingest-common/src/test/resources/rest-api-spec/test/ingest/200_default_pipeline.yml, +# default pipeline via index, +# default pipeline via alias, +# default pipeline via upsert, +  - do:, +      update:, +        index: test, +        type: test, +        id: 3, +        body:, +          script:, +            source: "ctx._source.ran_script = true", +            lang: "painless", +          upsert: { "bytes_source_field":"1kb" }, +  - do:, +      get:, +        index: test, +        type: test, +        id: 3, +  - match: { _source.bytes_source_field: "1kb" }, +  - match: { _source.bytes_target_field: 1024 }, +# default pipeline via scripted upsert, +  - do:, +      update:, +        index: test, +        type: test, +        id: 4, +        body:, +          script:, +            source: "ctx._source.bytes_source_field = '1kb'", +            lang: "painless", +          upsert : {}, +          scripted_upsert: true, +  - do:, +      get:, +        index: test, +        type: test, +        id: 4, +  - match: { _source.bytes_source_field: "1kb" }, +  - match: { _source.bytes_target_field: 1024 }, +# default pipeline via doc_as_upsert, +  - do:, +      update:, +        index: test, +        type: test, +        id: 5, +        body:, +          doc: { "bytes_source_field":"1kb" }, +          doc_as_upsert: true, +  - do:, +      get:, +        index: test, +        type: test, +        id: 5, +  - match: { _source.bytes_source_field: "1kb" }, +  - match: { _source.bytes_target_field: 1024 }, +# default pipeline via bulk upsert, +# note - bulk scripted upsert's execute the pipeline before the script, so any data referenced by the pipeline, +# needs to be in the upsert, not the script, +  - do:, +      bulk:, +        refresh: true, +        body: |, +          {"update":{"_id":"6","_index":"test","_type":"test"}}, +          {"script":"ctx._source.ran_script = true","upsert":{"bytes_source_field":"1kb"}}, +          {"update":{"_id":"7","_index":"test","_type":"test"}}, +          {"doc":{"bytes_source_field":"2kb"}, "doc_as_upsert":true}, +          {"update":{"_id":"8","_index":"test","_type":"test"}}, +          {"script": "ctx._source.ran_script = true","upsert":{"bytes_source_field":"3kb"}, "scripted_upsert" : true}, +      mget:, +        body:, +          docs:, +          - { _index: "test", _type: "_doc", _id: "6" }, +          - { _index: "test", _type: "_doc", _id: "7" }, +          - { _index: "test", _type: "_doc", _id: "8" }, +  - match: { docs.0._index: "test" }, +  - match: { docs.0._id: "6" }, +  - match: { docs.0._source.bytes_source_field: "1kb" }, +  - match: { docs.0._source.bytes_target_field: 1024 }, +  - is_false: docs.0._source.ran_script, +  - match: { docs.1._index: "test" }, +  - match: { docs.1._id: "7" }, +  - match: { docs.1._source.bytes_source_field: "2kb" }, +  - match: { docs.1._source.bytes_target_field: 2048 }, +  - match: { docs.2._index: "test" }, +  - match: { docs.2._id: "8" }, +  - match: { docs.2._source.bytes_source_field: "3kb" }, +  - match: { docs.2._source.bytes_target_field: 3072 }, +  - match: { docs.2._source.ran_script: true }, +, +# explicit no default pipeline, +  - do:, +        id: 9, +        id: 9, +# bad request, +        id: 10, +++ b/modules/ingest-common/src/test/resources/rest-api-spec/test/ingest/200_default_pipeline.yml, +# default pipeline via index, +# default pipeline via alias, +# default pipeline via upsert]