[+++ b/Vagrantfile, +      # Creates a file to mark the machine as created by vagrant. Tests check, +      # for this file and refuse to run if it is not present so that they can't, +      # be run unexpectedly., +      config.vm.provision "markerfile", type: "shell", inline: <<-SHELL, +        touch /etc/is_vagrant_vm, +      SHELL, +++ b/Vagrantfile, +      # Creates a file to mark the machine as created by vagrant. Tests check, +      # for this file and refuse to run if it is not present so that they can't, +      # be run unexpectedly., +      config.vm.provision "markerfile", type: "shell", inline: <<-SHELL, +        touch /etc/is_vagrant_vm, +      SHELL, +++ b/buildSrc/build.gradle, +, +  task namingConventionsMain(type: org.elasticsearch.gradle.precommit.NamingConventionsTask) {, +    checkForTestsInMain = true, +    testClass = namingConventions.testClass, +    integTestClass = namingConventions.integTestClass, +  }, +  precommit.dependsOn namingConventionsMain, +++ b/Vagrantfile, +      # Creates a file to mark the machine as created by vagrant. Tests check, +      # for this file and refuse to run if it is not present so that they can't, +      # be run unexpectedly., +      config.vm.provision "markerfile", type: "shell", inline: <<-SHELL, +        touch /etc/is_vagrant_vm, +      SHELL, +++ b/buildSrc/build.gradle, +, +  task namingConventionsMain(type: org.elasticsearch.gradle.precommit.NamingConventionsTask) {, +    checkForTestsInMain = true, +    testClass = namingConventions.testClass, +    integTestClass = namingConventions.integTestClass, +  }, +  precommit.dependsOn namingConventionsMain, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/precommit/NamingConventionsTask.groovy, +    File successMarker = new File(project.buildDir, "markers/${this.name}"), +    /**, +     * Should the test also check the main classpath for test classes instead of, +     * doing the usual checks to the test classpath., +     */, +    @Input, +    boolean checkForTestsInMain = false;, +, +        if (false == project.configurations.names.contains('namingConventions')) {, +        }, +        FileCollection classpath = project.sourceSets.test.runtimeClasspath, +        inputs.files(classpath), +        description = "Tests that test classes aren't misnamed or misplaced", +        if (false == checkForTestsInMain) {, +            /* This task is created by default for all subprojects with this, +             * setting and there is no point in running it if the files don't, +             * exist. */, +        }, +, +                if (checkForTestsInMain) {, +                    args('--main'), +                    args('--'), +                    args(project.sourceSets.main.output.classesDir.absolutePath), +                } else {, +                    args('--'), +                    args(project.sourceSets.test.output.classesDir.absolutePath), +                }, +++ b/Vagrantfile, +      # Creates a file to mark the machine as created by vagrant. Tests check, +      # for this file and refuse to run if it is not present so that they can't, +      # be run unexpectedly., +      config.vm.provision "markerfile", type: "shell", inline: <<-SHELL, +        touch /etc/is_vagrant_vm, +      SHELL, +++ b/buildSrc/build.gradle, +, +  task namingConventionsMain(type: org.elasticsearch.gradle.precommit.NamingConventionsTask) {, +    checkForTestsInMain = true, +    testClass = namingConventions.testClass, +    integTestClass = namingConventions.integTestClass, +  }, +  precommit.dependsOn namingConventionsMain, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/precommit/NamingConventionsTask.groovy, +    File successMarker = new File(project.buildDir, "markers/${this.name}"), +    /**, +     * Should the test also check the main classpath for test classes instead of, +     * doing the usual checks to the test classpath., +     */, +    @Input, +    boolean checkForTestsInMain = false;, +, +        if (false == project.configurations.names.contains('namingConventions')) {, +        }, +        FileCollection classpath = project.sourceSets.test.runtimeClasspath, +        inputs.files(classpath), +        description = "Tests that test classes aren't misnamed or misplaced", +        if (false == checkForTestsInMain) {, +            /* This task is created by default for all subprojects with this, +             * setting and there is no point in running it if the files don't, +             * exist. */, +        }, +]