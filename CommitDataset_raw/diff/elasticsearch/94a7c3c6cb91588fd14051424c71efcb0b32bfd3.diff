[+++ b/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/esnative/tool/CommandLineHttpClient.java, +                    throw new IllegalStateException("unable to determine http port from settings");, +        } catch (Exception e) {, +            throw new IllegalStateException("unable to determine default URL from settings, please use the -u option to explicitly " +, +                "provide the url", e);, +++ b/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/esnative/tool/CommandLineHttpClient.java, +                    throw new IllegalStateException("unable to determine http port from settings");, +        } catch (Exception e) {, +            throw new IllegalStateException("unable to determine default URL from settings, please use the -u option to explicitly " +, +                "provide the url", e);, +++ b/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/esnative/tool/CommandLineHttpClientTests.java, +import static org.hamcrest.Matchers.containsString;, +, +    public void testGetDefaultURLFailsWithHelpfulMessage() {, +        Settings settings = Settings.builder(), +            .put("network.host", "_ec2:privateIpv4_"), +            .build();, +        CommandLineHttpClient client = new CommandLineHttpClient(settings, environment);, +        assertThat(expectThrows(IllegalStateException.class, () -> client.getDefaultURL()).getMessage(),, +            containsString("unable to determine default URL from settings, please use the -u option to explicitly provide the url"));, +    }, +]