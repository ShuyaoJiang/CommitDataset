[+++ b/distribution/build.gradle, +, +ext.restTestExpansions = [, +  'expected.modules.count': 0,, +], +    restTestExpansions['expected.modules.count'] += 1, +    includePackaged project.name == 'integ-test-zip', +  processTestResources {, +    inputs.properties(project(':distribution').restTestExpansions), +    MavenFilteringHack.filter(it, project(':distribution').restTestExpansions), +  }, +, +++ b/distribution/build.gradle, +, +ext.restTestExpansions = [, +  'expected.modules.count': 0,, +], +    restTestExpansions['expected.modules.count'] += 1, +    includePackaged project.name == 'integ-test-zip', +  processTestResources {, +    inputs.properties(project(':distribution').restTestExpansions), +    MavenFilteringHack.filter(it, project(':distribution').restTestExpansions), +  }, +, +++ b/distribution/deb/src/test/resources/rest-api-spec/test/smoke_test_plugins/10_modules.yaml, +# Integration tests for distributions with modules, +#, +"Correct Modules Count":, +    - do:, +        cluster.state: {}, +, +    # Get master node id, +    - set: { master_node: master }, +, +    - do:, +        nodes.info: {}, +, +    - length:  { nodes.$master.plugins: ${expected.modules.count}  }, +++ b/distribution/build.gradle, +, +ext.restTestExpansions = [, +  'expected.modules.count': 0,, +], +    restTestExpansions['expected.modules.count'] += 1, +    includePackaged project.name == 'integ-test-zip', +  processTestResources {, +    inputs.properties(project(':distribution').restTestExpansions), +    MavenFilteringHack.filter(it, project(':distribution').restTestExpansions), +  }, +, +++ b/distribution/deb/src/test/resources/rest-api-spec/test/smoke_test_plugins/10_modules.yaml, +# Integration tests for distributions with modules, +#, +"Correct Modules Count":, +    - do:, +        cluster.state: {}, +, +    # Get master node id, +    - set: { master_node: master }, +, +    - do:, +        nodes.info: {}, +, +    - length:  { nodes.$master.plugins: ${expected.modules.count}  }, +++ b/distribution/rpm/src/test/resources/rest-api-spec/test/smoke_test_plugins/10_modules.yaml, +# Integration tests for distributions with modules, +#, +"Correct Modules Count":, +    - do:, +        cluster.state: {}, +, +    # Get master node id, +    - set: { master_node: master }, +, +    - do:, +        nodes.info: {}, +, +    - length:  { nodes.$master.plugins: ${expected.modules.count}  }, +++ b/distribution/build.gradle, +, +ext.restTestExpansions = [, +  'expected.modules.count': 0,, +], +    restTestExpansions['expected.modules.count'] += 1, +    includePackaged project.name == 'integ-test-zip', +  processTestResources {, +    inputs.properties(project(':distribution').restTestExpansions), +    MavenFilteringHack.filter(it, project(':distribution').restTestExpansions), +  }, +, +++ b/distribution/deb/src/test/resources/rest-api-spec/test/smoke_test_plugins/10_modules.yaml, +# Integration tests for distributions with modules, +#, +"Correct Modules Count":, +    - do:, +        cluster.state: {}, +, +    # Get master node id, +    - set: { master_node: master }, +]