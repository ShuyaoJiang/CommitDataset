[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +                javaVersions.put(version, findJavaHome(version.toString()));, +            String gradleJavaVersion = System.getProperty('java.version'), +            String gradleJavaVersionDetails = "${javaVendor} ${gradleJavaVersion}" +, +                println "  Compiler JDK Version  : ${getPaddedMajorVersion(compilerJavaVersionEnum)} (${compilerJavaVersionDetails})", +                println "  Compiler java.home    : ${compilerJavaHome}", +                println "  Runtime JDK Version   : ${getPaddedMajorVersion(runtimeJavaVersionEnum)} (${runtimeJavaVersionDetails})", +                println "  Runtime java.home     : ${runtimeJavaHome}", +                println "  Gradle JDK Version    : ${getPaddedMajorVersion(JavaVersion.toVersion(gradleJavaVersion))} (${gradleJavaVersionDetails})", +                println "  Gradle java.home      : ${gradleJavaHome}", +                println "  JDK Version           : ${getPaddedMajorVersion(JavaVersion.toVersion(gradleJavaVersion))} (${gradleJavaVersionDetails})", +            println '=======================================', +                        "the compiler java.home must be set to a JDK installation directory for Java ${minimumCompilerVersion}" +, +                        "the runtime java.home must be set to a JDK installation directory for Java ${minimumRuntimeVersion}" +, +            project.rootProject.ext.gradleJavaVersion = JavaVersion.toVersion(gradleJavaVersion), +        project.ext.gradleJavaVersion = project.rootProject.ext.gradleJavaVersion, +    }, +, +    private static String getPaddedMajorVersion(JavaVersion compilerJavaVersionEnum) {, +        compilerJavaVersionEnum.getMajorVersion().toString().padLeft(2), +        final String compilerJavaHome = System.getenv('JAVA_HOME'), +        final String compilerJavaProperty = System.getProperty('compiler.java'), +        if (compilerJavaProperty != null) {, +            compilerJavaHome = findJavaHome(compilerJavaProperty), +        }, +        if (compilerJavaHome == null) {, +        return compilerJavaHome, +    private static String findJavaHome(String version) {, +        String versionedVarName = 'JAVA' + version + '_HOME', +        String versionedJavaHome = System.getenv(versionedVarName), +        if (versionedJavaHome == null) {, +            throw new GradleException(, +                    "$versionedVarName must be set to build Elasticsearch. " +, +                            "Note that if the variable was just set you might have to run `./gradlew --stop` for " +, +                            "it to be picked up. See https://github.com/elastic/elasticsearch/issues/31399 details.", +            ), +        }, +        return versionedJavaHome, +        String runtimeJavaProperty = System.getProperty("runtime.java"), +        if (runtimeJavaProperty != null) {, +            return findJavaHome(runtimeJavaProperty), +        }, +            systemProperty 'compiler.java', project.ext.compilerJavaVersion.getMajorVersion(), +            if (project.ext.inFipsJvm) {, +                systemProperty 'runtime.java', project.ext.runtimeJavaVersion.getMajorVersion() + "FIPS", +            } else {, +                systemProperty 'runtime.java', project.ext.runtimeJavaVersion.getMajorVersion(), +            }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +                javaVersions.put(version, findJavaHome(version.toString()));, +            String gradleJavaVersion = System.getProperty('java.version'), +            String gradleJavaVersionDetails = "${javaVendor} ${gradleJavaVersion}" +, +                println "  Compiler JDK Version  : ${getPaddedMajorVersion(compilerJavaVersionEnum)} (${compilerJavaVersionDetails})", +                println "  Compiler java.home    : ${compilerJavaHome}", +                println "  Runtime JDK Version   : ${getPaddedMajorVersion(runtimeJavaVersionEnum)} (${runtimeJavaVersionDetails})", +                println "  Runtime java.home     : ${runtimeJavaHome}", +                println "  Gradle JDK Version    : ${getPaddedMajorVersion(JavaVersion.toVersion(gradleJavaVersion))} (${gradleJavaVersionDetails})", +                println "  Gradle java.home      : ${gradleJavaHome}", +                println "  JDK Version           : ${getPaddedMajorVersion(JavaVersion.toVersion(gradleJavaVersion))} (${gradleJavaVersionDetails})", +            println '=======================================', +                        "the compiler java.home must be set to a JDK installation directory for Java ${minimumCompilerVersion}" +, +                        "the runtime java.home must be set to a JDK installation directory for Java ${minimumRuntimeVersion}" +, +            project.rootProject.ext.gradleJavaVersion = JavaVersion.toVersion(gradleJavaVersion), +        project.ext.gradleJavaVersion = project.rootProject.ext.gradleJavaVersion, +    }, +, +    private static String getPaddedMajorVersion(JavaVersion compilerJavaVersionEnum) {, +        compilerJavaVersionEnum.getMajorVersion().toString().padLeft(2), +        final String compilerJavaHome = System.getenv('JAVA_HOME'), +        final String compilerJavaProperty = System.getProperty('compiler.java'), +        if (compilerJavaProperty != null) {, +            compilerJavaHome = findJavaHome(compilerJavaProperty), +        }, +        if (compilerJavaHome == null) {, +        return compilerJavaHome, +    private static String findJavaHome(String version) {, +        String versionedVarName = 'JAVA' + version + '_HOME', +        String versionedJavaHome = System.getenv(versionedVarName), +        if (versionedJavaHome == null) {, +            throw new GradleException(, +                    "$versionedVarName must be set to build Elasticsearch. " +, +                            "Note that if the variable was just set you might have to run `./gradlew --stop` for " +, +                            "it to be picked up. See https://github.com/elastic/elasticsearch/issues/31399 details.", +            ), +        }, +        return versionedJavaHome, +        String runtimeJavaProperty = System.getProperty("runtime.java"), +        if (runtimeJavaProperty != null) {, +            return findJavaHome(runtimeJavaProperty), +        }, +            systemProperty 'compiler.java', project.ext.compilerJavaVersion.getMajorVersion(), +            if (project.ext.inFipsJvm) {, +                systemProperty 'runtime.java', project.ext.runtimeJavaVersion.getMajorVersion() + "FIPS", +            } else {, +                systemProperty 'runtime.java', project.ext.runtimeJavaVersion.getMajorVersion(), +            }, +++ b/test/framework/src/main/java/org/elasticsearch/test/junit/listeners/ReproduceInfoPrinter.java, +            appendOpt("compiler.java", System.getProperty("compiler.java"));, +            appendOpt("runtime.java", System.getProperty("runtime.java"));, +            appendOpt("javax.net.ssl.keyStorePassword", System.getProperty("javax.net.ssl.keyStorePassword"));]