[+++ b/shield/docs/public/managing-users.asciidoc, +[[managing-users]], +++ b/shield/docs/public/managing-users.asciidoc, +[[managing-users]], +++ b/shield/docs/public/mapping-roles.asciidoc, +.Mapping LDAP Users and Groups to Roles, +.Mapping Active Directory Users and Groups to Roles, +.Mapping PKI Users to Roles, +<2> The distinguished name of a PKI user, +NOTE: For PKI realms, only the DN of a user can be mapped as there is no concept of a group in PKI., +++ b/shield/docs/public/managing-users.asciidoc, +[[managing-users]], +++ b/shield/docs/public/mapping-roles.asciidoc, +.Mapping LDAP Users and Groups to Roles, +.Mapping Active Directory Users and Groups to Roles, +.Mapping PKI Users to Roles, +<2> The distinguished name of a PKI user, +NOTE: For PKI realms, only the DN of a user can be mapped as there is no concept of a group in PKI., +++ b/shield/docs/public/reference.asciidoc, +NOTE: `user_dn_templates` is required to operate in user template mode and `user_search.base_dn` is required to operated in user search mode. Only one is required for a given realm configuration. For more information on the different modes, see <<ldap, ldap realms>>., +++ b/shield/docs/public/managing-users.asciidoc, +[[managing-users]], +++ b/shield/docs/public/mapping-roles.asciidoc, +.Mapping LDAP Users and Groups to Roles, +.Mapping Active Directory Users and Groups to Roles, +.Mapping PKI Users to Roles, +<2> The distinguished name of a PKI user, +NOTE: For PKI realms, only the DN of a user can be mapped as there is no concept of a group in PKI., +++ b/shield/docs/public/reference.asciidoc, +NOTE: `user_dn_templates` is required to operate in user template mode and `user_search.base_dn` is required to operated in user search mode. Only one is required for a given realm configuration. For more information on the different modes, see <<ldap, ldap realms>>., +++ b/shield/docs/public/setting-up-authentication.asciidoc, +, +include::setting-up-authentication/controlling-user-cache.asciidoc[], +, +++ b/shield/docs/public/managing-users.asciidoc, +[[managing-users]], +++ b/shield/docs/public/mapping-roles.asciidoc, +.Mapping LDAP Users and Groups to Roles, +.Mapping Active Directory Users and Groups to Roles, +.Mapping PKI Users to Roles, +<2> The distinguished name of a PKI user, +NOTE: For PKI realms, only the DN of a user can be mapped as there is no concept of a group in PKI., +++ b/shield/docs/public/reference.asciidoc, +NOTE: `user_dn_templates` is required to operate in user template mode and `user_search.base_dn` is required to operated in user search mode. Only one is required for a given realm configuration. For more information on the different modes, see <<ldap, ldap realms>>., +++ b/shield/docs/public/setting-up-authentication.asciidoc, +, +include::setting-up-authentication/controlling-user-cache.asciidoc[], +, +++ b/shield/docs/public/setting-up-authentication/configuring-active-directory-realm.asciidoc, +=== Using Active Directory to Authenticate Users, +You can configure Shield to communicate with Active Directory to authenticate users. To integrate, +with Active Directory, you configure an Active Directory realm and assign Active Directory users , +and groups to Shield roles in the <<mapping-roles, role mapping file>>. , +To protect passwords, communications between Shield and the LDAP server should be encrypted , +using SSL/TLS. Clients and nodes that connect via SSL/TLS to the LDAP server need to have the, +LDAP server's certificate or the server's root CA certificate installed in their keystore or , +truststore. For more information about installing certificates, see <<active-directory-ssl, , +Encrypting Communications Between Shield and Active Directory with SSL/TLS>>., +==== Configuring an Active Directory Realm, +Shield uses LDAP to communicate with Active Directory, so Active Directory realms are similar , +to <<ldap, LDAP realms>>. Like LDAP directories, Active Directory stores users and groups , +hierarchically. The directory's hierarchy is built from containers such as the _organizational , +unit_ (`ou`), _organization_ (`o`), and _domain controller_ (`dc`). , +The path to a entry is a _Distinguished Name_ (DN) that uniquely identifies a user or group. User , +and group  names typically have attributes such as a _common name_ (`cn`) or _unique ID_ (`uid`). , +A DN is specified as a string, for example  `"cn=admin,dc=example,dc=com"`. White space is ignored., +NOTE: When you use Active Directory for authentication, the username entered by the user is expected , +      to match the `sAMAccountName` or `userPrincipalName`, not the common name. , +To configure an Active Directory realm:, +. Add a realm configuration of type `active_directory` to `elasticsearch.yml` in the , +`shield.authc.realms` namespace. At a minimum, you must set the realm , +`type` to `active_directory` and specify the Active Directory `domain_name`. To use SSL/TLS to , +encrypt communications with the Active Directory server, you must also set the `url` attribute and , +specify the LDAPS protocol and secure port number. If you are configuring multiple realms, you , +should also explicitly set the `order` attribute to control the order in which the realms are , +consulted during authentication. See <<ad-settings, Active Directory Realm Settings>>, +for all of the options you can set for an Active Directory realm., ++, +NOTE: Binding to Active Directory fails if the domain name is not mapped in DNS. If DNS is not , +      being provided by a Windows DNS server, add a mapping for the domain in the local , +      `/etc/hosts` file., ++, +For example, the following realm configuration configures Shield to connect to , +`ldaps://example.com:636` to authenticate users through Active Directory. , ++, +        order: 0 <1>, +        domain_name: ad.example.com, +        url: ldaps://ad.example.com:636 <2>, +        unmapped_groups_as_roles: true <3>, +<1> The realm order controls the order in which the configured realms are checked when , +authenticating a user., +<2> If you don't specify the URL, it defaults to `ldap:<domain_name>:389`., +<3> When this option is enabled, Shield automatically maps Active Directory groups to , +roles of the same name defined in `roles.yml`., +, +. Restart Elasticsearch., +===== Active Directory Realm Settings, +| `type`                     | yes       | Indicates the realm type. Must be set to , +                                           `active_directory`., +| `order`                    | no        | Indicates the priority of this realm within the realm ]