[+++ b/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequest.java, +            return httpHeaders.names().stream().map(k -> new Entry<String, List<String>>() {, +, +                @Override, +                public String getKey() {, +                    return k;, +                }, +, +                @Override, +                public List<String> getValue() {, +                    return httpHeaders.getAll(k);, +                }, +, +                @Override, +                public List<String> setValue(List<String> value) {, +                    throw new UnsupportedOperationException("modifications are not supported");, +                }, +            }).collect(Collectors.toSet());, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequest.java, +            return httpHeaders.names().stream().map(k -> new Entry<String, List<String>>() {, +, +                @Override, +                public String getKey() {, +                    return k;, +                }, +, +                @Override, +                public List<String> getValue() {, +                    return httpHeaders.getAll(k);, +                }, +, +                @Override, +                public List<String> setValue(List<String> value) {, +                    throw new UnsupportedOperationException("modifications are not supported");, +                }, +            }).collect(Collectors.toSet());, +++ b/plugins/ingest-attachment/build.gradle, +  exclude '**/*.doc', +  exclude '**/*.vsdx', +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequest.java, +            return httpHeaders.names().stream().map(k -> new Entry<String, List<String>>() {, +, +                @Override, +                public String getKey() {, +                    return k;, +                }, +, +                @Override, +                public List<String> getValue() {, +                    return httpHeaders.getAll(k);, +                }, +, +                @Override, +                public List<String> setValue(List<String> value) {, +                    throw new UnsupportedOperationException("modifications are not supported");, +                }, +            }).collect(Collectors.toSet());, +++ b/plugins/ingest-attachment/build.gradle, +  exclude '**/*.doc', +  exclude '**/*.vsdx', +++ b/plugins/ingest-attachment/src/main/java/org/elasticsearch/ingest/attachment/TikaImpl.java, +import org.apache.tika.mime.MediaType;, +import org.apache.tika.parser.ParserDecorator;, +import java.util.Collections;, +import java.util.Set;, +    /** Exclude some formats */, +    private static final Set<MediaType> EXCLUDES = Collections.singleton(MediaType.application("x-tika-ooxml"));, +, +        ParserDecorator.withoutTypes(new org.apache.tika.parser.microsoft.ooxml.OOXMLParser(), EXCLUDES),, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequest.java, +            return httpHeaders.names().stream().map(k -> new Entry<String, List<String>>() {, +, +                @Override, +                public String getKey() {, +                    return k;, +                }, +, +                @Override, +                public List<String> getValue() {, +                    return httpHeaders.getAll(k);, +                }, +, +                @Override, +                public List<String> setValue(List<String> value) {, +                    throw new UnsupportedOperationException("modifications are not supported");, +                }, +            }).collect(Collectors.toSet());, +++ b/plugins/ingest-attachment/build.gradle, +  exclude '**/*.doc', +  exclude '**/*.vsdx', +++ b/plugins/ingest-attachment/src/main/java/org/elasticsearch/ingest/attachment/TikaImpl.java, +import org.apache.tika.mime.MediaType;, +import org.apache.tika.parser.ParserDecorator;, +import java.util.Collections;, +import java.util.Set;, +    /** Exclude some formats */, +    private static final Set<MediaType> EXCLUDES = Collections.singleton(MediaType.application("x-tika-ooxml"));, +, +        ParserDecorator.withoutTypes(new org.apache.tika.parser.microsoft.ooxml.OOXMLParser(), EXCLUDES),, +++ b/plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java]