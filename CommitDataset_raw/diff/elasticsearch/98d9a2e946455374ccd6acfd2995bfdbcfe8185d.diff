[+++ b/CONTRIBUTING.md, +If you think you have found a bug in Elasticsearch, first make sure that you are testing against the [latest version of Elasticsearch](https://www.elastic.co/downloads/elasticsearch) - your issue may already have been fixed. If not, search our [issues list](https://github.com/elasticsearch/elasticsearch/issues) on GitHub in case a similar issue has already been opened., +++ b/CONTRIBUTING.md, +If you think you have found a bug in Elasticsearch, first make sure that you are testing against the [latest version of Elasticsearch](https://www.elastic.co/downloads/elasticsearch) - your issue may already have been fixed. If not, search our [issues list](https://github.com/elasticsearch/elasticsearch/issues) on GitHub in case a similar issue has already been opened., +++ b/core/src/main/java/org/elasticsearch/transport/netty/MessageChannelHandler.java, +        long requestId = buffer.readLong();, +        byte status = buffer.readByte();, +        Version version = Version.fromId(buffer.readInt());, +, +        StreamInput wrappedStream = null;, +        try {, +                wrappedStream = compressor.streamInput(streamIn);, +            } else {, +                wrappedStream = streamIn;, +            wrappedStream.setVersion(version);, +                String action = handleRequest(ctx.getChannel(), wrappedStream, requestId, version);, +                boolean success = false;, +                try {, +                    final int nextByte = wrappedStream.read();, +                    // calling read() is useful to make sure the message is fully read, even if there is an EOS marker, +                    success = true;, +                } finally {, +                    if (!success) {, +                        buffer.readerIndex(expectedIndexReader);, +                    }, +                }, +                TransportResponseHandler handler = transportServiceAdapter.onResponseReceived(requestId);, +                        handlerResponseError(wrappedStream, handler);, +                        handleResponse(ctx.getChannel(), wrappedStream, handler);, +                    }, +                } else {, +                    // if its null, skip those bytes, +                    buffer.readerIndex(markedReaderIndex + size);, +                boolean success = false;, +                try {, +                    final int nextByte = wrappedStream.read();, +                    success = true;, +                    if (!success) {, +        } finally {, +            IOUtils.close(wrappedStream);, +        }, +    }, +++ b/CONTRIBUTING.md, +If you think you have found a bug in Elasticsearch, first make sure that you are testing against the [latest version of Elasticsearch](https://www.elastic.co/downloads/elasticsearch) - your issue may already have been fixed. If not, search our [issues list](https://github.com/elasticsearch/elasticsearch/issues) on GitHub in case a similar issue has already been opened., +++ b/core/src/main/java/org/elasticsearch/transport/netty/MessageChannelHandler.java, +        long requestId = buffer.readLong();, +        byte status = buffer.readByte();, +        Version version = Version.fromId(buffer.readInt());, +, +        StreamInput wrappedStream = null;, +        try {, +                wrappedStream = compressor.streamInput(streamIn);, +            } else {, +                wrappedStream = streamIn;, +            wrappedStream.setVersion(version);, +                String action = handleRequest(ctx.getChannel(), wrappedStream, requestId, version);, +                boolean success = false;, +                try {, +                    final int nextByte = wrappedStream.read();, +                    // calling read() is useful to make sure the message is fully read, even if there is an EOS marker, +                    success = true;, +                } finally {, +                    if (!success) {, +                        buffer.readerIndex(expectedIndexReader);, +                    }, +                }, +                TransportResponseHandler handler = transportServiceAdapter.onResponseReceived(requestId);, +                        handlerResponseError(wrappedStream, handler);, +                        handleResponse(ctx.getChannel(), wrappedStream, handler);, +                    }, +                } else {, +                    // if its null, skip those bytes, +                    buffer.readerIndex(markedReaderIndex + size);, +                boolean success = false;, +                try {, +                    final int nextByte = wrappedStream.read();, +                    success = true;, +                    if (!success) {, +        } finally {, +            IOUtils.close(wrappedStream);, +        }, +    }, +++ b/core/src/test/java/org/elasticsearch/transport/AbstractSimpleTransportTests.java, +    @AwaitsFix(bugUrl = "@spinscale is looking into failures: http://build-us-00.elastic.co/job/es_core_master_strong/3986/")]