[+++ b/x-pack/plugin/src/main/java/org/elasticsearch/xpack/ccr/action/ShardFollowTasksExecutor.java, +                    Consumer<Exception> handler = e -> {, +                            task.updatePersistentStatus(newStatus, ActionListener.wrap(persistentTask -> prepare(task,, +                                    leaderShard, followerShard, leaderGlobalCheckPoint), task::markAsFailed), +                    };, +                    ChunksCoordinator coordinator =, +                            new ChunksCoordinator(client, ccrExecutor, DEFAULT_BATCH_SIZE, leaderShard, followerShard, handler);]