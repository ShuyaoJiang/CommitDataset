[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/lucene/IndexWriters.java, +import org.apache.lucene.index.SegmentInfos;, +    private static Field rollbackSegmentInfosField;, +, +, +            rollbackSegmentInfosField = IndexWriter.class.getDeclaredField("rollbackSegmentInfos");, +            rollbackSegmentInfosField.setAccessible(true);, +, +            logger.warn("Failed to doc writer fields", e);, +    public static SegmentInfos rollbackSegmentInfos(IndexWriter writer) throws Exception {, +        return (SegmentInfos) rollbackSegmentInfosField.get(writer);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/common/lucene/IndexWriters.java, +import org.apache.lucene.index.SegmentInfos;, +    private static Field rollbackSegmentInfosField;, +, +, +            rollbackSegmentInfosField = IndexWriter.class.getDeclaredField("rollbackSegmentInfos");, +            rollbackSegmentInfosField.setAccessible(true);, +, +            logger.warn("Failed to doc writer fields", e);, +    public static SegmentInfos rollbackSegmentInfos(IndexWriter writer) throws Exception {, +        return (SegmentInfos) rollbackSegmentInfosField.get(writer);, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/engine/robin/RobinEngine.java, +                translog.newTranslog(newTransactionLogId());, +                    translog.newTranslog(newTransactionLogId());, +                    translog.newTranslog(newTransactionLogId());, +    private long newTransactionLogId() throws IOException {, +        try {, +            return IndexWriters.rollbackSegmentInfos(indexWriter).getVersion();, +        } catch (Exception e) {, +            return IndexReader.getCurrentVersion(store.directory());, +        }, +    }, +]