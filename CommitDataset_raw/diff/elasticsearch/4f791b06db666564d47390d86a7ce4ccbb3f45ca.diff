[+++ b/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +                if (request instanceof IndexRequest) {, +                    IndexRequest indexRequest = (IndexRequest) request;, +                    if (!indices.contains(indexRequest.index())) {, +                        indices.add(indexRequest.index());, +                    }, +                } else if (request instanceof DeleteRequest) {, +                    DeleteRequest deleteRequest = (DeleteRequest) request;, +                    if (!indices.contains(deleteRequest.index())) {, +                        indices.add(deleteRequest.index());, +                    }, +                } else if (request instanceof UpdateRequest) {, +                    UpdateRequest updateRequest = (UpdateRequest) request;, +                    if (!indices.contains(updateRequest.index())) {, +                        indices.add(updateRequest.index());, +, +                String concreteIndex = concreteIndices.resolveIfAbsent(indexRequest.index(), indexRequest.indicesOptions());, +            } else if (request instanceof DeleteRequest) {, +                DeleteRequest deleteRequest = (DeleteRequest) request;, +                concreteIndices.resolveIfAbsent(deleteRequest.index(), deleteRequest.indicesOptions());, +                deleteRequest.routing(clusterState.metaData().resolveIndexRouting(deleteRequest.routing(), deleteRequest.index()));, +            } else if (request instanceof UpdateRequest) {, +                UpdateRequest updateRequest = (UpdateRequest) request;, +                concreteIndices.resolveIfAbsent(updateRequest.index(), updateRequest.indicesOptions());, +                updateRequest.routing(clusterState.metaData().resolveIndexRouting(updateRequest.routing(), updateRequest.index()));, +, +++ b/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +                if (request instanceof IndexRequest) {, +                    IndexRequest indexRequest = (IndexRequest) request;, +                    if (!indices.contains(indexRequest.index())) {, +                        indices.add(indexRequest.index());, +                    }, +                } else if (request instanceof DeleteRequest) {, +                    DeleteRequest deleteRequest = (DeleteRequest) request;, +                    if (!indices.contains(deleteRequest.index())) {, +                        indices.add(deleteRequest.index());, +                    }, +                } else if (request instanceof UpdateRequest) {, +                    UpdateRequest updateRequest = (UpdateRequest) request;, +                    if (!indices.contains(updateRequest.index())) {, +                        indices.add(updateRequest.index());, +, +                String concreteIndex = concreteIndices.resolveIfAbsent(indexRequest.index(), indexRequest.indicesOptions());, +            } else if (request instanceof DeleteRequest) {, +                DeleteRequest deleteRequest = (DeleteRequest) request;, +                concreteIndices.resolveIfAbsent(deleteRequest.index(), deleteRequest.indicesOptions());, +                deleteRequest.routing(clusterState.metaData().resolveIndexRouting(deleteRequest.routing(), deleteRequest.index()));, +            } else if (request instanceof UpdateRequest) {, +                UpdateRequest updateRequest = (UpdateRequest) request;, +                concreteIndices.resolveIfAbsent(updateRequest.index(), updateRequest.indicesOptions());, +                updateRequest.routing(clusterState.metaData().resolveIndexRouting(updateRequest.routing(), updateRequest.index()));, +, +++ b/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java, +public class DeleteRequest extends ShardReplicationOperationRequest<DeleteRequest> {, +++ b/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +                if (request instanceof IndexRequest) {, +                    IndexRequest indexRequest = (IndexRequest) request;, +                    if (!indices.contains(indexRequest.index())) {, +                        indices.add(indexRequest.index());, +                    }, +                } else if (request instanceof DeleteRequest) {, +                    DeleteRequest deleteRequest = (DeleteRequest) request;, +                    if (!indices.contains(deleteRequest.index())) {, +                        indices.add(deleteRequest.index());, +                    }, +                } else if (request instanceof UpdateRequest) {, +                    UpdateRequest updateRequest = (UpdateRequest) request;, +                    if (!indices.contains(updateRequest.index())) {, +                        indices.add(updateRequest.index());, +, +                String concreteIndex = concreteIndices.resolveIfAbsent(indexRequest.index(), indexRequest.indicesOptions());, +            } else if (request instanceof DeleteRequest) {, +                DeleteRequest deleteRequest = (DeleteRequest) request;, +                concreteIndices.resolveIfAbsent(deleteRequest.index(), deleteRequest.indicesOptions());, +                deleteRequest.routing(clusterState.metaData().resolveIndexRouting(deleteRequest.routing(), deleteRequest.index()));, +            } else if (request instanceof UpdateRequest) {, +                UpdateRequest updateRequest = (UpdateRequest) request;, +                concreteIndices.resolveIfAbsent(updateRequest.index(), updateRequest.indicesOptions());, +                updateRequest.routing(clusterState.metaData().resolveIndexRouting(updateRequest.routing(), updateRequest.index()));, +, +++ b/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java, +public class DeleteRequest extends ShardReplicationOperationRequest<DeleteRequest> {, +++ b/src/main/java/org/elasticsearch/action/index/IndexRequest.java, +public class IndexRequest extends ShardReplicationOperationRequest<IndexRequest> {, +++ b/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +                if (request instanceof IndexRequest) {, +                    IndexRequest indexRequest = (IndexRequest) request;, +                    if (!indices.contains(indexRequest.index())) {, +                        indices.add(indexRequest.index());, +                    }, +                } else if (request instanceof DeleteRequest) {, +                    DeleteRequest deleteRequest = (DeleteRequest) request;, +                    if (!indices.contains(deleteRequest.index())) {, +                        indices.add(deleteRequest.index());, +                    }, +                } else if (request instanceof UpdateRequest) {, +                    UpdateRequest updateRequest = (UpdateRequest) request;, +                    if (!indices.contains(updateRequest.index())) {, +                        indices.add(updateRequest.index());, +]