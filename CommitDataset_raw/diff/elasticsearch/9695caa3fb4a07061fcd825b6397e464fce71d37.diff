[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            // always wait for yellow before anything is executed, +            current.println(, +                    "  - do:\n" +, +                    "      raw:\n" +, +                    "        method: GET\n" +, +                    "        path: \"_cluster/health\"\n" +, +                    "        wait_for_status: \"yellow\""), +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            // always wait for yellow before anything is executed, +            current.println(, +                    "  - do:\n" +, +                    "      raw:\n" +, +                    "        method: GET\n" +, +                    "        path: \"_cluster/health\"\n" +, +                    "        wait_for_status: \"yellow\""), +++ b/core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java, +                if ((!enforceLimits || (check.isSystemCheck() && ignoreSystemChecks)) && !check.alwaysEnforce()) {, +        checks.add(new OnOutOfMemoryErrorCheck());, +        default boolean alwaysEnforce() {, +            return false;, +        }, +, +    static class OnOutOfMemoryErrorCheck implements BootstrapCheck.Check {, +, +        @Override, +        public boolean check() {, +            final String onOutOfMemoryError = onOutOfMemoryError();, +            return isSeccompInstalled() && onOutOfMemoryError != null && !onOutOfMemoryError.equals("");, +        }, +, +        // visible for testing, +        boolean isSeccompInstalled() {, +            return Natives.isSeccompInstalled();, +        }, +, +        // visible for testing, +        String onOutOfMemoryError() {, +            return JvmInfo.jvmInfo().onOutOfMemoryError();, +        }, +, +        @Override, +        public String errorMessage() {, +            return String.format(, +                Locale.ROOT,, +                "OnOutOfMemoryError [%s] requires forking but is prevented by system call filters ([%s=true]);" +, +                    " upgrade to at least Java 8u92 and use ExitOnOutOfMemoryError",, +                onOutOfMemoryError(),, +                BootstrapSettings.SECCOMP_SETTING.getKey());, +        }, +, +        @Override, +        public boolean isSystemCheck() {, +            return false;, +        }, +, +        @Override, +        public boolean alwaysEnforce() {, +            return true;, +        }, +, +    }, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +            // always wait for yellow before anything is executed, +            current.println(, +                    "  - do:\n" +, +                    "      raw:\n" +, +                    "        method: GET\n" +, +                    "        path: \"_cluster/health\"\n" +, +                    "        wait_for_status: \"yellow\""), +++ b/core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java, +                if ((!enforceLimits || (check.isSystemCheck() && ignoreSystemChecks)) && !check.alwaysEnforce()) {, +        checks.add(new OnOutOfMemoryErrorCheck());, +        default boolean alwaysEnforce() {, +            return false;, +        }, +, +    static class OnOutOfMemoryErrorCheck implements BootstrapCheck.Check {, +, +        @Override, +        public boolean check() {, +            final String onOutOfMemoryError = onOutOfMemoryError();, +            return isSeccompInstalled() && onOutOfMemoryError != null && !onOutOfMemoryError.equals("");, +        }, +, +        // visible for testing, +        boolean isSeccompInstalled() {, +            return Natives.isSeccompInstalled();, +        }, +, +        // visible for testing, +        String onOutOfMemoryError() {, +            return JvmInfo.jvmInfo().onOutOfMemoryError();, +        }, +, +        @Override, +        public String errorMessage() {, +            return String.format(, +                Locale.ROOT,]