[+++ b/benchmarks/build.gradle, +// order of this section matters, see: https://github.com/johnrengelman/shadow/issues/336, +++ b/benchmarks/build.gradle, +// order of this section matters, see: https://github.com/johnrengelman/shadow/issues/336, +++ b/build.gradle, +    if (tasks.findByPath('test') != null && tasks.findByPath('integTest') != null) {, +      integTest.mustRunAfter test, +    }, +, +if (System.properties.get("build.compare") != null) {, +  apply plugin: 'compare-gradle-builds', +  compareGradleBuilds {, +    ext.referenceProject = System.properties.get("build.compare"), +    doFirst {, +      if (file(referenceProject).exists() == false) {, +        throw new GradleException(, +                "Use git worktree to check out a version to compare against to ../elasticsearch_build_reference", +        ), +      }, +    }, +    sourceBuild {, +      gradleVersion = "4.7" // does not default to gradle weapper of project dir, but current version, +      projectDir = referenceProject, +      tasks = ["clean", "assemble"], +      arguments = ["-Dbuild.compare_friendly=true"], +    }, +    targetBuild {, +      tasks = ["clean", "assemble"], +      // use -Dorg.gradle.java.home= to alter jdk versions, +      arguments = ["-Dbuild.compare_friendly=true"], +    }, +  }, +}, +++ b/benchmarks/build.gradle, +// order of this section matters, see: https://github.com/johnrengelman/shadow/issues/336, +++ b/build.gradle, +    if (tasks.findByPath('test') != null && tasks.findByPath('integTest') != null) {, +      integTest.mustRunAfter test, +    }, +, +if (System.properties.get("build.compare") != null) {, +  apply plugin: 'compare-gradle-builds', +  compareGradleBuilds {, +    ext.referenceProject = System.properties.get("build.compare"), +    doFirst {, +      if (file(referenceProject).exists() == false) {, +        throw new GradleException(, +                "Use git worktree to check out a version to compare against to ../elasticsearch_build_reference", +        ), +      }, +    }, +    sourceBuild {, +      gradleVersion = "4.7" // does not default to gradle weapper of project dir, but current version, +      projectDir = referenceProject, +      tasks = ["clean", "assemble"], +      arguments = ["-Dbuild.compare_friendly=true"], +    }, +    targetBuild {, +      tasks = ["clean", "assemble"], +      // use -Dorg.gradle.java.home= to alter jdk versions, +      arguments = ["-Dbuild.compare_friendly=true"], +    }, +  }, +}, +++ b/buildSrc/build.gradle, +, +plugins {, +  id 'java-gradle-plugin', +  id 'groovy', +}, +  compile "com.carrotsearch.randomizedtesting:randomizedtesting-runner:${props.getProperty('randomizedrunner')}", +, +  testCompile "junit:junit:${props.getProperty('junit')}", +, +    testClass = 'org.elasticsearch.gradle.test.GradleUnitTestCase', +    integTestClass = 'org.elasticsearch.gradle.test.GradleIntegrationTestCase', +++ b/benchmarks/build.gradle, +// order of this section matters, see: https://github.com/johnrengelman/shadow/issues/336, +++ b/build.gradle, +    if (tasks.findByPath('test') != null && tasks.findByPath('integTest') != null) {, +      integTest.mustRunAfter test, +    }, +, +if (System.properties.get("build.compare") != null) {, +  apply plugin: 'compare-gradle-builds', +  compareGradleBuilds {, +    ext.referenceProject = System.properties.get("build.compare"), +    doFirst {, +      if (file(referenceProject).exists() == false) {, +        throw new GradleException(, +                "Use git worktree to check out a version to compare against to ../elasticsearch_build_reference", +        ), +      }, +    }, +    sourceBuild {, +      gradleVersion = "4.7" // does not default to gradle weapper of project dir, but current version, +      projectDir = referenceProject, +      tasks = ["clean", "assemble"], +      arguments = ["-Dbuild.compare_friendly=true"], +    }]