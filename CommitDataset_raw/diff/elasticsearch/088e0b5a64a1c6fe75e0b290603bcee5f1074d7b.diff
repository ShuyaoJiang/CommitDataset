[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/indices/memory/IndexingMemoryBufferController.java, +import org.elasticsearch.common.unit.ByteSizeUnit;, +    private final ByteSizeValue minShardIndexBufferSize;, +, +        this.minShardIndexBufferSize = componentSettings.getAsBytesSize("min_shard_index_buffer_size", new ByteSizeValue(4, ByteSizeUnit.MB));, +, +        logger.debug("using index_buffer_size [{}], with min_shard_index_buffer_size [{}]", this.indexingBuffer, this.minShardIndexBufferSize);, +            ByteSizeValue shardIndexingBufferSize = calcShardIndexingBuffer(shardsCount);, +            if (shardIndexingBufferSize == null) {, +            if (shardIndexingBufferSize.bytes() < minShardIndexBufferSize.bytes()) {, +                shardIndexingBufferSize = minShardIndexBufferSize;, +            }, +            logger.debug("recalculating shard indexing buffer (reason={}), total is [{}] with [{}] shards, each shard set to [{}]", reason, indexingBuffer, shardsCount, shardIndexingBufferSize);, +                    ((InternalIndexShard) indexShard).engine().indexingBuffer(shardIndexingBufferSize);]