[+++ b/src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java, +            byte[] masterClusterStateBytes = ClusterState.Builder.toBytes(masterClusterState);, +            // remove local node reference, +            masterClusterState = ClusterState.Builder.fromBytes(masterClusterStateBytes, null);, +                byte[] localClusterStateBytes = ClusterState.Builder.toBytes(localClusterState);, +                // remove local node reference, +                localClusterState = ClusterState.Builder.fromBytes(localClusterStateBytes, null);, +                Map<String, Object> localStateMap = convertToMap(localClusterState);, +                int localClusterStateSize = localClusterStateBytes.length;, +                        assertThat(mapsEqualIgnoringArrayOrder(masterStateMap, localStateMap), equalTo(true));, +++ b/src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java, +            byte[] masterClusterStateBytes = ClusterState.Builder.toBytes(masterClusterState);, +            // remove local node reference, +            masterClusterState = ClusterState.Builder.fromBytes(masterClusterStateBytes, null);, +                byte[] localClusterStateBytes = ClusterState.Builder.toBytes(localClusterState);, +                // remove local node reference, +                localClusterState = ClusterState.Builder.fromBytes(localClusterStateBytes, null);, +                Map<String, Object> localStateMap = convertToMap(localClusterState);, +                int localClusterStateSize = localClusterStateBytes.length;, +                        assertThat(mapsEqualIgnoringArrayOrder(masterStateMap, localStateMap), equalTo(true));, +++ b/src/test/java/org/elasticsearch/test/InternalTestCluster.java]