[+++ b/pom.xml, +        <lucene.snapshot.revision>1675363</lucene.snapshot.revision>, +++ b/pom.xml, +        <lucene.snapshot.revision>1675363</lucene.snapshot.revision>, +++ b/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +        boolean match = in.readBoolean();, +        String description = in.readString();, +        final Explanation[] subExplanations = new Explanation[in.readVInt()];, +        for (int i = 0; i < subExplanations.length; ++i) {, +            subExplanations[i] = readExplanation(in);, +        }, +        if (match) {, +            return Explanation.match(in.readFloat(), description, subExplanations);, +            return Explanation.noMatch(description, subExplanations);, +        out.writeBoolean(explanation.isMatch());, +        if (explanation.isMatch()) {, +            out.writeFloat(explanation.getValue());, +++ b/pom.xml, +        <lucene.snapshot.revision>1675363</lucene.snapshot.revision>, +++ b/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +        boolean match = in.readBoolean();, +        String description = in.readString();, +        final Explanation[] subExplanations = new Explanation[in.readVInt()];, +        for (int i = 0; i < subExplanations.length; ++i) {, +            subExplanations[i] = readExplanation(in);, +        }, +        if (match) {, +            return Explanation.match(in.readFloat(), description, subExplanations);, +            return Explanation.noMatch(description, subExplanations);, +        out.writeBoolean(explanation.isMatch());, +        if (explanation.isMatch()) {, +            out.writeFloat(explanation.getValue());, +++ b/src/main/java/org/elasticsearch/common/lucene/search/Queries.java, +import org.apache.lucene.index.Term;, +import org.apache.lucene.search.PrefixQuery;, +import org.apache.lucene.util.BytesRef;, +import org.elasticsearch.index.mapper.internal.TypeFieldMapper;, +    public static Filter newNestedFilter() {, +        return wrap(new PrefixQuery(new Term(TypeFieldMapper.NAME, new BytesRef("__"))));, +    }, +, +    public static Filter newNonNestedFilter() {, +        return wrap(not(newNestedFilter()));, +    }, +, +++ b/pom.xml, +        <lucene.snapshot.revision>1675363</lucene.snapshot.revision>, +++ b/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +        boolean match = in.readBoolean();, +        String description = in.readString();, +        final Explanation[] subExplanations = new Explanation[in.readVInt()];, +        for (int i = 0; i < subExplanations.length; ++i) {, +            subExplanations[i] = readExplanation(in);, +        }, +        if (match) {, +            return Explanation.match(in.readFloat(), description, subExplanations);, +            return Explanation.noMatch(description, subExplanations);, +        out.writeBoolean(explanation.isMatch());, +        if (explanation.isMatch()) {, +            out.writeFloat(explanation.getValue());, +++ b/src/main/java/org/elasticsearch/common/lucene/search/Queries.java, +import org.apache.lucene.index.Term;, +import org.apache.lucene.search.PrefixQuery;, +import org.apache.lucene.util.BytesRef;, +import org.elasticsearch.index.mapper.internal.TypeFieldMapper;, +    public static Filter newNestedFilter() {, +        return wrap(new PrefixQuery(new Term(TypeFieldMapper.NAME, new BytesRef("__"))));, +    }, +, +    public static Filter newNonNestedFilter() {, +        return wrap(not(newNestedFilter()));, +    }, +, +++ b/src/main/java/org/elasticsearch/common/lucene/search/ResolvableFilter.java, +++ b/pom.xml, +        <lucene.snapshot.revision>1675363</lucene.snapshot.revision>, +++ b/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +        boolean match = in.readBoolean();, +        String description = in.readString();, +        final Explanation[] subExplanations = new Explanation[in.readVInt()];, +        for (int i = 0; i < subExplanations.length; ++i) {, +            subExplanations[i] = readExplanation(in);, +        }, +        if (match) {, +            return Explanation.match(in.readFloat(), description, subExplanations);, +            return Explanation.noMatch(description, subExplanations);, +        out.writeBoolean(explanation.isMatch());, +        if (explanation.isMatch()) {, +            out.writeFloat(explanation.getValue());, +++ b/src/main/java/org/elasticsearch/common/lucene/search/Queries.java, +import org.apache.lucene.index.Term;, +import org.apache.lucene.search.PrefixQuery;, +import org.apache.lucene.util.BytesRef;, +import org.elasticsearch.index.mapper.internal.TypeFieldMapper;, +    public static Filter newNestedFilter() {, +        return wrap(new PrefixQuery(new Term(TypeFieldMapper.NAME, new BytesRef("__"))));, +    }, +, +    public static Filter newNonNestedFilter() {, +        return wrap(not(newNestedFilter()));]