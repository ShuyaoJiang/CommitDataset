[+++ b/core/src/main/java/org/elasticsearch/index/store/Store.java, +                    if (index == footerChecksum.length-1) {, +                        verify();// we have recorded the entire checksum, +                    }, +++ b/core/src/main/java/org/elasticsearch/index/store/Store.java, +                    if (index == footerChecksum.length-1) {, +                        verify();// we have recorded the entire checksum, +                    }, +++ b/core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java, +++ b/core/src/main/java/org/elasticsearch/index/store/Store.java, +                    if (index == footerChecksum.length-1) {, +                        verify();// we have recorded the entire checksum, +                    }, +++ b/core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java, +++ b/core/src/test/java/org/elasticsearch/index/store/StoreTests.java, +        length -= 8; // we write the checksum in the try / catch block below, +            BytesRef checksumBytes = new BytesRef(8);, +            checksumBytes.length = 8;, +            indexInput.readBytes(checksumBytes.bytes, checksumBytes.offset, checksumBytes.length);, +            if (randomBoolean()) {, +                verifyingOutput.writeBytes(checksumBytes.bytes, checksumBytes.offset, checksumBytes.length);, +            } else {, +                for (int i = 0; i < checksumBytes.length; i++) {, +                    verifyingOutput.writeByte(checksumBytes.bytes[i]);, +                }, +            }]