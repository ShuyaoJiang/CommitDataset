[+++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/AutoFollowCoordinator.java, +                Map<String, String> headers = autoFollowMetadata.getHeaders().get(clusterAlias);, +                getLeaderClusterState(headers, clusterAlias, (leaderClusterState, e) -> {, +                            checkAutoFollowPattern(clusterAlias, autoFollowPattern, leaderIndicesToFollow, headers, resultHandler);, +        private void checkAutoFollowPattern(String clusterAlias,, +                                            AutoFollowPattern autoFollowPattern,, +                                            List<Index> leaderIndicesToFollow,, +                                            Map<String, String> headers,, +                                            Consumer<AutoFollowResult> resultHandler) {, +                followLeaderIndex(clusterAlias, indexToFollow, autoFollowPattern, headers, error -> {, +        private void followLeaderIndex(String clusterAlias,, +                                       Index indexToFollow,, +                                       AutoFollowPattern pattern,, +                                       Map<String,String> headers,, +                                       Consumer<Exception> onResult) {, +            createAndFollow(headers, request, successHandler, onResult);, +        static Function<ClusterState, ClusterState> recordLeaderIndexAsFollowFunction(String clusterAlias,, +                                                                                      Index indexToFollow) {, +                AutoFollowMetadata newAutoFollowMetadata = new AutoFollowMetadata(currentAutoFollowMetadata.getPatterns(),, +                    newFollowedIndexUUIDS, currentAutoFollowMetadata.getHeaders());, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/AutoFollowCoordinator.java, +                Map<String, String> headers = autoFollowMetadata.getHeaders().get(clusterAlias);, +                getLeaderClusterState(headers, clusterAlias, (leaderClusterState, e) -> {, +                            checkAutoFollowPattern(clusterAlias, autoFollowPattern, leaderIndicesToFollow, headers, resultHandler);, +        private void checkAutoFollowPattern(String clusterAlias,, +                                            AutoFollowPattern autoFollowPattern,, +                                            List<Index> leaderIndicesToFollow,, +                                            Map<String, String> headers,, +                                            Consumer<AutoFollowResult> resultHandler) {, +                followLeaderIndex(clusterAlias, indexToFollow, autoFollowPattern, headers, error -> {, +        private void followLeaderIndex(String clusterAlias,, +                                       Index indexToFollow,, +                                       AutoFollowPattern pattern,, +                                       Map<String,String> headers,, +                                       Consumer<Exception> onResult) {, +            createAndFollow(headers, request, successHandler, onResult);, +        static Function<ClusterState, ClusterState> recordLeaderIndexAsFollowFunction(String clusterAlias,, +                                                                                      Index indexToFollow) {, +                AutoFollowMetadata newAutoFollowMetadata = new AutoFollowMetadata(currentAutoFollowMetadata.getPatterns(),, +                    newFollowedIndexUUIDS, currentAutoFollowMetadata.getHeaders());, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportDeleteAutoFollowPatternAction.java, +        final Map<String, Map<String, String>> headers = new HashMap<>(currentAutoFollowMetadata.getHeaders());, +        headers.remove(request.getLeaderClusterAlias());, +        AutoFollowMetadata newAutoFollowMetadata = new AutoFollowMetadata(patternsCopy, followedLeaderIndexUUIDSCopy, headers);, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/AutoFollowCoordinator.java, +                Map<String, String> headers = autoFollowMetadata.getHeaders().get(clusterAlias);, +                getLeaderClusterState(headers, clusterAlias, (leaderClusterState, e) -> {, +                            checkAutoFollowPattern(clusterAlias, autoFollowPattern, leaderIndicesToFollow, headers, resultHandler);, +        private void checkAutoFollowPattern(String clusterAlias,, +                                            AutoFollowPattern autoFollowPattern,, +                                            List<Index> leaderIndicesToFollow,, +                                            Map<String, String> headers,, +                                            Consumer<AutoFollowResult> resultHandler) {, +                followLeaderIndex(clusterAlias, indexToFollow, autoFollowPattern, headers, error -> {, +        private void followLeaderIndex(String clusterAlias,, +                                       Index indexToFollow,, +                                       AutoFollowPattern pattern,, +                                       Map<String,String> headers,, +                                       Consumer<Exception> onResult) {, +            createAndFollow(headers, request, successHandler, onResult);, +        static Function<ClusterState, ClusterState> recordLeaderIndexAsFollowFunction(String clusterAlias,, +                                                                                      Index indexToFollow) {, +                AutoFollowMetadata newAutoFollowMetadata = new AutoFollowMetadata(currentAutoFollowMetadata.getPatterns(),, +                    newFollowedIndexUUIDS, currentAutoFollowMetadata.getHeaders());, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportDeleteAutoFollowPatternAction.java, +        final Map<String, Map<String, String>> headers = new HashMap<>(currentAutoFollowMetadata.getHeaders());, +        headers.remove(request.getLeaderClusterAlias());, +        AutoFollowMetadata newAutoFollowMetadata = new AutoFollowMetadata(patternsCopy, followedLeaderIndexUUIDSCopy, headers);, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutAutoFollowPatternAction.java, +        Map<String, Map<String, String>> headers;, +            headers = new HashMap<>(currentAutoFollowMetadata.getHeaders());, +            headers = new HashMap<>();, +        if (filteredHeaders != null) {, +            headers.put(request.getLeaderClusterAlias(), filteredHeaders);, +        }, +, +            request.getPollTimeout());, +            .putCustom(AutoFollowMetadata.TYPE, new AutoFollowMetadata(patterns, followedLeaderIndices, headers)), +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/AutoFollowCoordinator.java, +                Map<String, String> headers = autoFollowMetadata.getHeaders().get(clusterAlias);, +                getLeaderClusterState(headers, clusterAlias, (leaderClusterState, e) -> {, +                            checkAutoFollowPattern(clusterAlias, autoFollowPattern, leaderIndicesToFollow, headers, resultHandler);, +        private void checkAutoFollowPattern(String clusterAlias,, +                                            AutoFollowPattern autoFollowPattern,, +                                            List<Index> leaderIndicesToFollow,, +                                            Map<String, String> headers,, +                                            Consumer<AutoFollowResult> resultHandler) {, +                followLeaderIndex(clusterAlias, indexToFollow, autoFollowPattern, headers, error -> {, +        private void followLeaderIndex(String clusterAlias,, +                                       Index indexToFollow,, +                                       AutoFollowPattern pattern,, +                                       Map<String,String> headers,, +                                       Consumer<Exception> onResult) {, +            createAndFollow(headers, request, successHandler, onResult);, +        static Function<ClusterState, ClusterState> recordLeaderIndexAsFollowFunction(String clusterAlias,, +                                                                                      Index indexToFollow) {, +                AutoFollowMetadata newAutoFollowMetadata = new AutoFollowMetadata(currentAutoFollowMetadata.getPatterns(),, +                    newFollowedIndexUUIDS, currentAutoFollowMetadata.getHeaders());, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportDeleteAutoFollowPatternAction.java, +        final Map<String, Map<String, String>> headers = new HashMap<>(currentAutoFollowMetadata.getHeaders());]