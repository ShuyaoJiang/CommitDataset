[+++ b/src/main/java/org/elasticsearch/index/store/Store.java, +     * are derived from a dedicated checksum file written by older elasticsearch version pre 1.3, +     *, +     * Note: This class will ignore the <tt>segments.gen</tt> file since it's optional and might, +     * change concurrently for safety reasons., +                final String segmentsFile = segmentCommitInfos.getSegmentsFileName();, +                String legacyChecksum = checksumMap.get(segmentsFile);, +                    checksumFromLuceneFile(directory, segmentsFile, builder, logger, maxVersion);, +                    builder.put(segmentsFile, new StoreFileMetaData(segmentsFile, directory.fileLength(segmentsFile), legacyChecksum, null));, +++ b/src/main/java/org/elasticsearch/index/store/Store.java, +     * are derived from a dedicated checksum file written by older elasticsearch version pre 1.3, +     *, +     * Note: This class will ignore the <tt>segments.gen</tt> file since it's optional and might, +     * change concurrently for safety reasons., +                final String segmentsFile = segmentCommitInfos.getSegmentsFileName();, +                String legacyChecksum = checksumMap.get(segmentsFile);, +                    checksumFromLuceneFile(directory, segmentsFile, builder, logger, maxVersion);, +                    builder.put(segmentsFile, new StoreFileMetaData(segmentsFile, directory.fileLength(segmentsFile), legacyChecksum, null));, +++ b/src/test/java/org/elasticsearch/index/store/StoreTest.java, +import org.apache.lucene.index.*;, +            if (file.equals("write.lock") || file.equals(IndexFileNames.SEGMENTS_GEN)) {, +            if (!"write.lock".equals(file) && !IndexFileNames.SEGMENTS_GEN.equals(file) && !Store.isChecksum(file)) {]