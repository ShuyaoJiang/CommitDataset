[+++ b/server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java, +import org.elasticsearch.common.logging.ServerLoggers;, +        final MockDirectoryWrapper directory = newMockDirectory();, +        final Path translogPath = createTempDir("testTranslogReplayWithFailure");, +        try (Store store = createStore(directory)) {, +            try (final InternalEngine engine = createEngine(store, translogPath)) {, +                    Engine.Index firstIndexRequest = new Engine.Index(newUid(doc), doc, SequenceNumbers.UNASSIGNED_SEQ_NO, 0,, +                        Versions.MATCH_DELETED, VersionType.INTERNAL, PRIMARY, System.nanoTime(), -1, false);, +            }, +            final int numIters = randomIntBetween(3, 5);, +                boolean started = false;, +                InternalEngine engine = null;, +                    engine = createEngine(store, translogPath);, +                    logger.trace("exception on open", e);, +                if (started) {, +                    engine.close();, +                }, +            }, +        }]