[+++ b/core/src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java, +        final String message = "[" + this.name + "] Data too large, data for [" +, +                fieldName + "] would be larger than limit of [" +, +        throw new CircuitBreakingException(message,, +                bytesNeeded, this.memoryBytesLimit);, +++ b/core/src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java, +        final String message = "[" + this.name + "] Data too large, data for [" +, +                fieldName + "] would be larger than limit of [" +, +        throw new CircuitBreakingException(message,, +                bytesNeeded, this.memoryBytesLimit);, +++ b/core/src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java, +        final String message = "Data too large, data for field [" + fieldName + "] would be larger than limit of [" +, +++ b/core/src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java, +        final String message = "[" + this.name + "] Data too large, data for [" +, +                fieldName + "] would be larger than limit of [" +, +        throw new CircuitBreakingException(message,, +                bytesNeeded, this.memoryBytesLimit);, +++ b/core/src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java, +        final String message = "Data too large, data for field [" + fieldName + "] would be larger than limit of [" +, +++ b/core/src/main/java/org/elasticsearch/indices/breaker/HierarchyCircuitBreakerService.java, +            throw new CircuitBreakingException("[parent] Data too large, data for [" +, +                            label + "] would be larger than limit of [" +, +                            parentLimit + "/" + new ByteSizeValue(parentLimit) + "]",, +                    totalUsed, parentLimit);, +++ b/core/src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java, +        final String message = "[" + this.name + "] Data too large, data for [" +, +                fieldName + "] would be larger than limit of [" +, +        throw new CircuitBreakingException(message,, +                bytesNeeded, this.memoryBytesLimit);, +++ b/core/src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java, +        final String message = "Data too large, data for field [" + fieldName + "] would be larger than limit of [" +, +++ b/core/src/main/java/org/elasticsearch/indices/breaker/HierarchyCircuitBreakerService.java, +            throw new CircuitBreakingException("[parent] Data too large, data for [" +, +                            label + "] would be larger than limit of [" +, +                            parentLimit + "/" + new ByteSizeValue(parentLimit) + "]",, +                    totalUsed, parentLimit);, +++ b/core/src/test/java/org/elasticsearch/common/breaker/MemoryCircuitBreakerTests.java, +++ b/core/src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java, +        final String message = "[" + this.name + "] Data too large, data for [" +, +                fieldName + "] would be larger than limit of [" +, +        throw new CircuitBreakingException(message,, +                bytesNeeded, this.memoryBytesLimit);, +++ b/core/src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java, +        final String message = "Data too large, data for field [" + fieldName + "] would be larger than limit of [" +, +++ b/core/src/main/java/org/elasticsearch/indices/breaker/HierarchyCircuitBreakerService.java, +            throw new CircuitBreakingException("[parent] Data too large, data for [" +, +                            label + "] would be larger than limit of [" +, +                            parentLimit + "/" + new ByteSizeValue(parentLimit) + "]",, +                    totalUsed, parentLimit);, +++ b/core/src/test/java/org/elasticsearch/common/breaker/MemoryCircuitBreakerTests.java, +++ b/core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceIT.java, +        assertFailures(searchRequest, RestStatus.INTERNAL_SERVER_ERROR,, +                containsString("Data too large, data for [test] would be larger than limit of [100/100b]"));, +        assertFailures(client.prepareSearch("ramtest").setQuery(matchAllQuery()).addSort("test", SortOrder.DESC),, +                RestStatus.INTERNAL_SERVER_ERROR,, +                containsString("Data too large, data for [test] would be larger than limit of [100/100b]"));, +            String errMsg = "[fielddata] Data too large, data for [test] would be larger than limit of [10/10b]";, +            assertThat("Exception: [" + e.toString() + "] should contain a CircuitBreakingException",, +                e.toString(), containsString(errMsg));, +        assertFailures(client.prepareSearch("cb-test").setQuery(matchAllQuery()).addSort("test", SortOrder.DESC),, +                RestStatus.INTERNAL_SERVER_ERROR,, +                containsString("Data too large, data for [test] would be larger than limit of [10/10b]"));, +            assertThat("Exception: [" + e.toString() + "] should contain a CircuitBreakingException",, +                e.toString(), containsString(errMsg));, +            errMsg = "would be larger than limit of [10/10b]]";, +            String errMsg = "CircuitBreakingException[[request] " +, +                    "Data too large, data for [<agg [my_terms]>] would be larger than limit of [100/100b]]";, +            assertThat("Exception: " + e.toString() + " should contain a CircuitBreakingException",, +++ b/core/src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java, +        final String message = "[" + this.name + "] Data too large, data for [" +, +                fieldName + "] would be larger than limit of [" +, +        throw new CircuitBreakingException(message,, +                bytesNeeded, this.memoryBytesLimit);, +++ b/core/src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java, +        final String message = "Data too large, data for field [" + fieldName + "] would be larger than limit of [" +, +++ b/core/src/main/java/org/elasticsearch/indices/breaker/HierarchyCircuitBreakerService.java, +            throw new CircuitBreakingException("[parent] Data too large, data for [" +, +                            label + "] would be larger than limit of [" +, +                            parentLimit + "/" + new ByteSizeValue(parentLimit) + "]",, +                    totalUsed, parentLimit);, +++ b/core/src/test/java/org/elasticsearch/common/breaker/MemoryCircuitBreakerTests.java, +++ b/core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceIT.java, +        assertFailures(searchRequest, RestStatus.INTERNAL_SERVER_ERROR,, +                containsString("Data too large, data for [test] would be larger than limit of [100/100b]"));, +        assertFailures(client.prepareSearch("ramtest").setQuery(matchAllQuery()).addSort("test", SortOrder.DESC),, +                RestStatus.INTERNAL_SERVER_ERROR,, +                containsString("Data too large, data for [test] would be larger than limit of [100/100b]"));, +            String errMsg = "[fielddata] Data too large, data for [test] would be larger than limit of [10/10b]";, +            assertThat("Exception: [" + e.toString() + "] should contain a CircuitBreakingException",, +                e.toString(), containsString(errMsg));, +        assertFailures(client.prepareSearch("cb-test").setQuery(matchAllQuery()).addSort("test", SortOrder.DESC),, +                RestStatus.INTERNAL_SERVER_ERROR,, +                containsString("Data too large, data for [test] would be larger than limit of [10/10b]"));, +            assertThat("Exception: [" + e.toString() + "] should contain a CircuitBreakingException",, +                e.toString(), containsString(errMsg));, +            errMsg = "would be larger than limit of [10/10b]]";, +            String errMsg = "CircuitBreakingException[[request] " +, +                    "Data too large, data for [<agg [my_terms]>] would be larger than limit of [100/100b]]";, +            assertThat("Exception: " + e.toString() + " should contain a CircuitBreakingException",, +++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc]