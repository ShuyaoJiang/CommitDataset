[+++ b/core/pom.xml, +            <!-- execution and integration tests -->, +                    <!-- start up elasticsearch in foreground -->, +                    <execution>, +                        <id>execute</id>, +                        <phase>package</phase>, +                        <goals>, +                            <goal>run</goal>, +                        </goals>, +                        <configuration>, +                            <target if="${run}">, +                                <ant antfile="${elasticsearch.integ.antfile}" target="start-foreground"/>, +                            </target>, +                        </configuration>, +                    </execution>, +++ b/core/pom.xml, +            <!-- execution and integration tests -->, +                    <!-- start up elasticsearch in foreground -->, +                    <execution>, +                        <id>execute</id>, +                        <phase>package</phase>, +                        <goals>, +                            <goal>run</goal>, +                        </goals>, +                        <configuration>, +                            <target if="${run}">, +                                <ant antfile="${elasticsearch.integ.antfile}" target="start-foreground"/>, +                            </target>, +                        </configuration>, +                    </execution>, +++ b/core/src/test/java/org/elasticsearch/action/admin/indices/segments/IndicesShardStoreRequestTests.java, +    @AwaitsFix(bugUrl = "https://github.com/elastic/elasticsearch/issues/12304"), +        List<ShardRouting> unassignedShards = clusterService().state().routingTable().index(index).shardsWithState(ShardRoutingState.UNASSIGNED);, +        assertThat(shardStoresStatuses.size(), equalTo(unassignedShards.size()));, +++ b/core/pom.xml, +            <!-- execution and integration tests -->, +                    <!-- start up elasticsearch in foreground -->, +                    <execution>, +                        <id>execute</id>, +                        <phase>package</phase>, +                        <goals>, +                            <goal>run</goal>, +                        </goals>, +                        <configuration>, +                            <target if="${run}">, +                                <ant antfile="${elasticsearch.integ.antfile}" target="start-foreground"/>, +                            </target>, +                        </configuration>, +                    </execution>, +++ b/core/src/test/java/org/elasticsearch/action/admin/indices/segments/IndicesShardStoreRequestTests.java, +    @AwaitsFix(bugUrl = "https://github.com/elastic/elasticsearch/issues/12304"), +        List<ShardRouting> unassignedShards = clusterService().state().routingTable().index(index).shardsWithState(ShardRoutingState.UNASSIGNED);, +        assertThat(shardStoresStatuses.size(), equalTo(unassignedShards.size()));, +++ b/dev-tools/src/main/resources/ant/integration-tests.xml, +      <element name="nested" optional="true"/>, +        <nested/>, +        <nested/>, +  <!-- run elasticsearch in the foreground (for debugging etc) -->, +  <!-- TODO: doesn't belong here, but we will figure it out -->, +  <target name="start-foreground" depends="stop-external-cluster">, +      <delete dir="${integ.scratch}"/>, +      <unzip src="${project.build.directory}/releases/${project.artifactId}-${project.version}.zip" dest="${integ.scratch}"/>, +      <local name="home"/>, +      <property name="home" location="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +      <run-script dir="${home}" script="bin/elasticsearch" spawn="false", +                  args="${integ.args} -Des.path.repo=${home}/repo">, +        <nested>, +          <env key="JAVA_OPTS" value="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8000"/>, +        </nested>, +      </run-script>, +  </target>, +]