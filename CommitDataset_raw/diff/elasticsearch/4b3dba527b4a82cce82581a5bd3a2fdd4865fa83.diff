[+++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingService.java, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingService.java, +++ b/core/src/main/java/org/elasticsearch/common/transport/DummyTransportAddress.java, +    DummyTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingService.java, +++ b/core/src/main/java/org/elasticsearch/common/transport/DummyTransportAddress.java, +    DummyTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +++ b/core/src/main/java/org/elasticsearch/common/transport/InetSocketTransportAddress.java, +    private InetSocketAddress address;, +    InetSocketTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +        if (in.readByte() == 0) {, +            int len = in.readByte();, +            byte[] a = new byte[len]; // 4 bytes (IPv4) or 16 bytes (IPv6), +            in.readFully(a);, +            InetAddress inetAddress;, +            if (len == 16) {, +                int scope_id = in.readInt();, +                inetAddress = Inet6Address.getByAddress(null, a, scope_id);, +            } else {, +                inetAddress = InetAddress.getByAddress(a);, +            }, +            int port = in.readInt();, +            this.address = new InetSocketAddress(inetAddress, port);, +        } else {, +            this.address = new InetSocketAddress(in.readString(), in.readInt());, +        }, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingService.java, +++ b/core/src/main/java/org/elasticsearch/common/transport/DummyTransportAddress.java, +    DummyTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +++ b/core/src/main/java/org/elasticsearch/common/transport/InetSocketTransportAddress.java, +    private InetSocketAddress address;, +    InetSocketTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +        if (in.readByte() == 0) {, +            int len = in.readByte();, +            byte[] a = new byte[len]; // 4 bytes (IPv4) or 16 bytes (IPv6), +            in.readFully(a);, +            InetAddress inetAddress;, +            if (len == 16) {, +                int scope_id = in.readInt();, +                inetAddress = Inet6Address.getByAddress(null, a, scope_id);, +            } else {, +                inetAddress = InetAddress.getByAddress(a);, +            }, +            int port = in.readInt();, +            this.address = new InetSocketAddress(inetAddress, port);, +        } else {, +            this.address = new InetSocketAddress(in.readString(), in.readInt());, +        }, +++ b/core/src/main/java/org/elasticsearch/common/transport/LocalTransportAddress.java, +    LocalTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +        id = in.readString();, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingService.java, +++ b/core/src/main/java/org/elasticsearch/common/transport/DummyTransportAddress.java, +    DummyTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +++ b/core/src/main/java/org/elasticsearch/common/transport/InetSocketTransportAddress.java, +    private InetSocketAddress address;, +    InetSocketTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +        if (in.readByte() == 0) {, +            int len = in.readByte();, +            byte[] a = new byte[len]; // 4 bytes (IPv4) or 16 bytes (IPv6), +            in.readFully(a);, +            InetAddress inetAddress;, +            if (len == 16) {, +                int scope_id = in.readInt();, +                inetAddress = Inet6Address.getByAddress(null, a, scope_id);, +            } else {, +                inetAddress = InetAddress.getByAddress(a);, +            }, +            int port = in.readInt();, +            this.address = new InetSocketAddress(inetAddress, port);, +        } else {, +            this.address = new InetSocketAddress(in.readString(), in.readInt());, +        }, +++ b/core/src/main/java/org/elasticsearch/common/transport/LocalTransportAddress.java, +    LocalTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +        id = in.readString();, +++ b/core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java, +public interface TransportAddress extends Streamable {, +++ b/core/src/main/java/org/elasticsearch/cluster/routing/RoutingService.java, +++ b/core/src/main/java/org/elasticsearch/common/transport/DummyTransportAddress.java, +    DummyTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +++ b/core/src/main/java/org/elasticsearch/common/transport/InetSocketTransportAddress.java, +    private InetSocketAddress address;, +    InetSocketTransportAddress() {, +    public void readFrom(StreamInput in) throws IOException {, +        if (in.readByte() == 0) {, +            int len = in.readByte();, +            byte[] a = new byte[len]; // 4 bytes (IPv4) or 16 bytes (IPv6), +            in.readFully(a);, +            InetAddress inetAddress;]