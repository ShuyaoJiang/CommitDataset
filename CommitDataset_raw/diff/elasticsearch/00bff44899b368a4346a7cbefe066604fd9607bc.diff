[+++ b/core/src/main/java/org/elasticsearch/action/ActionRequest.java, +++ b/core/src/main/java/org/elasticsearch/action/ActionRequest.java, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/action/ActionRequest.java, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/core/src/main/java/org/elasticsearch/action/ActionRequest.java, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +            iwc.setUseCompoundFile(true); // always use compound on flush - reduces # of file-handles on refresh, +++ b/core/src/main/java/org/elasticsearch/action/ActionRequest.java, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +            iwc.setUseCompoundFile(true); // always use compound on flush - reduces # of file-handles on refresh, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +++ b/core/src/main/java/org/elasticsearch/action/ActionRequest.java, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +            iwc.setUseCompoundFile(true); // always use compound on flush - reduces # of file-handles on refresh, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/action/ActionRequest.java, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +            iwc.setUseCompoundFile(true); // always use compound on flush - reduces # of file-handles on refresh, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +++ /dev/null, +++ b/core/src/test/java/org/elasticsearch/index/engine/InternalEngineSettingsTests.java, +            assertEquals(currentIndexWriterConfig.getUseCompoundFile(), true);, +++ b/core/src/main/java/org/elasticsearch/action/ActionRequest.java, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +            iwc.setUseCompoundFile(true); // always use compound on flush - reduces # of file-handles on refresh, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +++ /dev/null, +++ b/core/src/test/java/org/elasticsearch/index/engine/InternalEngineSettingsTests.java, +            assertEquals(currentIndexWriterConfig.getUseCompoundFile(), true);, +++ b/core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java, +            assertThat(segments.get(0).isCompound(), equalTo(true));, +            assertThat(segments.get(0).isCompound(), equalTo(true));, +            assertThat(segments.get(0).isCompound(), equalTo(true));, +            assertThat(segments.get(1).isCompound(), equalTo(true));, +            assertThat(segments.get(0).isCompound(), equalTo(true));, +            assertThat(segments.get(1).isCompound(), equalTo(true));, +            assertThat(segments.get(0).isCompound(), equalTo(true));, +            assertThat(segments.get(1).isCompound(), equalTo(true));, +++ b/core/src/main/java/org/elasticsearch/action/ActionRequest.java, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +            iwc.setUseCompoundFile(true); // always use compound on flush - reduces # of file-handles on refresh, +++ b/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +++ /dev/null, +++ b/core/src/test/java/org/elasticsearch/index/engine/InternalEngineSettingsTests.java, +            assertEquals(currentIndexWriterConfig.getUseCompoundFile(), true);, +++ b/core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java, +            assertThat(segments.get(0).isCompound(), equalTo(true));, +            assertThat(segments.get(0).isCompound(), equalTo(true));, +            assertThat(segments.get(0).isCompound(), equalTo(true));, +            assertThat(segments.get(1).isCompound(), equalTo(true));, +            assertThat(segments.get(0).isCompound(), equalTo(true));, +            assertThat(segments.get(1).isCompound(), equalTo(true));, +            assertThat(segments.get(0).isCompound(), equalTo(true));, +            assertThat(segments.get(1).isCompound(), equalTo(true));, +++ b/core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java, +        assertTrue(segments.get(0).isCompound());, +        assertThat(segments.get(0).isCompound(), equalTo(true));, +        assertThat(segments.get(0).isCompound(), equalTo(true));, +        assertThat(segments.get(0).isCompound(), equalTo(true));, +        assertThat(segments.get(1).isCompound(), equalTo(true));, +        assertThat(segments.get(0).isCompound(), equalTo(true));, +        assertThat(segments.get(1).isCompound(), equalTo(true));, +        assertThat(segments.get(0).isCompound(), equalTo(true));, +        assertThat(segments.get(1).isCompound(), equalTo(true));, +        assertThat(segments.get(0).isCompound(), equalTo(true));, +        assertThat(segments.get(1).isCompound(), equalTo(true));]