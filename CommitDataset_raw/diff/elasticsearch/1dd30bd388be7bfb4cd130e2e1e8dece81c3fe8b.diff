[+++ b/src/main/java/org/elasticsearch/common/io/stream/AdapterStreamInput.java, +    public String readString() throws IOException {, +        return in.readString();, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/io/stream/AdapterStreamInput.java, +    public String readString() throws IOException {, +        return in.readString();, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/io/stream/AdapterStreamOutput.java, +    public void writeString(String str) throws IOException {, +        out.writeString(str);, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/io/stream/AdapterStreamInput.java, +    public String readString() throws IOException {, +        return in.readString();, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/io/stream/AdapterStreamOutput.java, +    public void writeString(String str) throws IOException {, +        out.writeString(str);, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/io/stream/HandlesStreamInput.java, +    @Deprecated, +    public String readString() throws IOException {, +        byte b = in.readByte();, +        if (b == 0) {, +            // full string with handle, +            int handle = in.readVInt();, +            String s = in.readString();, +            handles.put(handle, s);, +            return s;, +        } else if (b == 1) {, +            return handles.get(in.readVInt());, +        } else if (b == 2) {, +            // full string with handle, +            int handle = in.readVInt();, +            String s = in.readString();, +            identityHandles.put(handle, s);, +            return s;, +        } else if (b == 3) {, +            return identityHandles.get(in.readVInt());, +        } else {, +            throw new IOException("Expected handle header, got [" + b + "]");, +        }, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/io/stream/AdapterStreamInput.java, +    public String readString() throws IOException {, +        return in.readString();, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/io/stream/AdapterStreamOutput.java, +    public void writeString(String str) throws IOException {, +        out.writeString(str);, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/io/stream/HandlesStreamInput.java, +    @Deprecated, +    public String readString() throws IOException {, +        byte b = in.readByte();, +        if (b == 0) {, +            // full string with handle, +            int handle = in.readVInt();, +            String s = in.readString();, +            handles.put(handle, s);, +            return s;, +        } else if (b == 1) {, +            return handles.get(in.readVInt());, +        } else if (b == 2) {, +            // full string with handle, +            int handle = in.readVInt();, +            String s = in.readString();, +            identityHandles.put(handle, s);, +            return s;, +        } else if (b == 3) {, +            return identityHandles.get(in.readVInt());, +        } else {, +            throw new IOException("Expected handle header, got [" + b + "]");, +        }, +    }, +, +    @Override, +++ b/src/main/java/org/elasticsearch/common/io/stream/HandlesStreamOutput.java, +    @Deprecated, +    public void writeString(String s) throws IOException {, +        if (s.length() < identityThreshold) {, +            int handle = handles.get(s);, +            if (handle == -1) {]