[+++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java, +    public static final String PIPELINE_ID_PARAM_CONTEXT_KEY = "__pipeline_id__";, +    public static final String PIPELINE_ID_PARAM = "pipeline";, +    static final String PIPELINE_ALREADY_PROCESSED = "ingest_already_processed";, +, +        String pipelineId = request.getFromContext(PIPELINE_ID_PARAM_CONTEXT_KEY);, +            pipelineId = request.getHeader(PIPELINE_ID_PARAM);, +        if (indexRequest.hasHeader(PIPELINE_ALREADY_PROCESSED)) {, +            indexRequest.putHeader(PIPELINE_ALREADY_PROCESSED, true);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java, +    public static final String PIPELINE_ID_PARAM_CONTEXT_KEY = "__pipeline_id__";, +    public static final String PIPELINE_ID_PARAM = "pipeline";, +    static final String PIPELINE_ALREADY_PROCESSED = "ingest_already_processed";, +, +        String pipelineId = request.getFromContext(PIPELINE_ID_PARAM_CONTEXT_KEY);, +            pipelineId = request.getHeader(PIPELINE_ID_PARAM);, +        if (indexRequest.hasHeader(PIPELINE_ALREADY_PROCESSED)) {, +            indexRequest.putHeader(PIPELINE_ALREADY_PROCESSED, true);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestDisabledActionFilter.java, +        String pipelineId = request.getFromContext(IngestActionFilter.PIPELINE_ID_PARAM_CONTEXT_KEY);, +        pipelineId = request.getHeader(IngestActionFilter.PIPELINE_ID_PARAM);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java, +    public static final String PIPELINE_ID_PARAM_CONTEXT_KEY = "__pipeline_id__";, +    public static final String PIPELINE_ID_PARAM = "pipeline";, +    static final String PIPELINE_ALREADY_PROCESSED = "ingest_already_processed";, +, +        String pipelineId = request.getFromContext(PIPELINE_ID_PARAM_CONTEXT_KEY);, +            pipelineId = request.getHeader(PIPELINE_ID_PARAM);, +        if (indexRequest.hasHeader(PIPELINE_ALREADY_PROCESSED)) {, +            indexRequest.putHeader(PIPELINE_ALREADY_PROCESSED, true);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestDisabledActionFilter.java, +        String pipelineId = request.getFromContext(IngestActionFilter.PIPELINE_ID_PARAM_CONTEXT_KEY);, +        pipelineId = request.getHeader(IngestActionFilter.PIPELINE_ID_PARAM);, +++ b/core/src/main/java/org/elasticsearch/ingest/core/ConfigurationUtils.java, +++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java, +    public static final String PIPELINE_ID_PARAM_CONTEXT_KEY = "__pipeline_id__";, +    public static final String PIPELINE_ID_PARAM = "pipeline";, +    static final String PIPELINE_ALREADY_PROCESSED = "ingest_already_processed";, +, +        String pipelineId = request.getFromContext(PIPELINE_ID_PARAM_CONTEXT_KEY);, +            pipelineId = request.getHeader(PIPELINE_ID_PARAM);, +        if (indexRequest.hasHeader(PIPELINE_ALREADY_PROCESSED)) {, +            indexRequest.putHeader(PIPELINE_ALREADY_PROCESSED, true);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestDisabledActionFilter.java, +        String pipelineId = request.getFromContext(IngestActionFilter.PIPELINE_ID_PARAM_CONTEXT_KEY);, +        pipelineId = request.getHeader(IngestActionFilter.PIPELINE_ID_PARAM);, +++ b/core/src/main/java/org/elasticsearch/ingest/core/ConfigurationUtils.java, +++ b/core/src/main/java/org/elasticsearch/rest/action/ingest/IngestRestFilter.java, +import org.elasticsearch.action.ingest.IngestActionFilter;, +        if (request.hasParam(IngestActionFilter.PIPELINE_ID_PARAM)) {, +            request.putInContext(IngestActionFilter.PIPELINE_ID_PARAM_CONTEXT_KEY, request.param(IngestActionFilter.PIPELINE_ID_PARAM));, +++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java, +    public static final String PIPELINE_ID_PARAM_CONTEXT_KEY = "__pipeline_id__";, +    public static final String PIPELINE_ID_PARAM = "pipeline";, +    static final String PIPELINE_ALREADY_PROCESSED = "ingest_already_processed";, +, +        String pipelineId = request.getFromContext(PIPELINE_ID_PARAM_CONTEXT_KEY);, +            pipelineId = request.getHeader(PIPELINE_ID_PARAM);, +        if (indexRequest.hasHeader(PIPELINE_ALREADY_PROCESSED)) {, +            indexRequest.putHeader(PIPELINE_ALREADY_PROCESSED, true);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestDisabledActionFilter.java, +        String pipelineId = request.getFromContext(IngestActionFilter.PIPELINE_ID_PARAM_CONTEXT_KEY);, +        pipelineId = request.getHeader(IngestActionFilter.PIPELINE_ID_PARAM);, +++ b/core/src/main/java/org/elasticsearch/ingest/core/ConfigurationUtils.java, +++ b/core/src/main/java/org/elasticsearch/rest/action/ingest/IngestRestFilter.java, +import org.elasticsearch.action.ingest.IngestActionFilter;, +        if (request.hasParam(IngestActionFilter.PIPELINE_ID_PARAM)) {, +            request.putInContext(IngestActionFilter.PIPELINE_ID_PARAM_CONTEXT_KEY, request.param(IngestActionFilter.PIPELINE_ID_PARAM));, +++ b/core/src/test/java/org/elasticsearch/action/ingest/IngestActionFilterTests.java, +        indexRequest.putHeader(IngestActionFilter.PIPELINE_ID_PARAM, "_id");, +        indexRequest.putInContext(IngestActionFilter.PIPELINE_ID_PARAM_CONTEXT_KEY, "_id");, +        indexRequest.putHeader(IngestActionFilter.PIPELINE_ID_PARAM, "_id");, +        indexRequest.putHeader(IngestActionFilter.PIPELINE_ALREADY_PROCESSED, true);, +        indexRequest.putHeader(IngestActionFilter.PIPELINE_ID_PARAM, "_id");, +        indexRequest.putHeader(IngestActionFilter.PIPELINE_ID_PARAM, "_id");, +        bulkRequest.putHeader(IngestActionFilter.PIPELINE_ID_PARAM, "_id");, +++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java, +    public static final String PIPELINE_ID_PARAM_CONTEXT_KEY = "__pipeline_id__";, +    public static final String PIPELINE_ID_PARAM = "pipeline";, +    static final String PIPELINE_ALREADY_PROCESSED = "ingest_already_processed";, +, +        String pipelineId = request.getFromContext(PIPELINE_ID_PARAM_CONTEXT_KEY);, +            pipelineId = request.getHeader(PIPELINE_ID_PARAM);, +        if (indexRequest.hasHeader(PIPELINE_ALREADY_PROCESSED)) {, +            indexRequest.putHeader(PIPELINE_ALREADY_PROCESSED, true);, +++ b/core/src/main/java/org/elasticsearch/action/ingest/IngestDisabledActionFilter.java, +        String pipelineId = request.getFromContext(IngestActionFilter.PIPELINE_ID_PARAM_CONTEXT_KEY);, +        pipelineId = request.getHeader(IngestActionFilter.PIPELINE_ID_PARAM);, +++ b/core/src/main/java/org/elasticsearch/ingest/core/ConfigurationUtils.java, +++ b/core/src/main/java/org/elasticsearch/rest/action/ingest/IngestRestFilter.java, +import org.elasticsearch.action.ingest.IngestActionFilter;, +        if (request.hasParam(IngestActionFilter.PIPELINE_ID_PARAM)) {, +            request.putInContext(IngestActionFilter.PIPELINE_ID_PARAM_CONTEXT_KEY, request.param(IngestActionFilter.PIPELINE_ID_PARAM));, +++ b/core/src/test/java/org/elasticsearch/action/ingest/IngestActionFilterTests.java, +        indexRequest.putHeader(IngestActionFilter.PIPELINE_ID_PARAM, "_id");, +        indexRequest.putInContext(IngestActionFilter.PIPELINE_ID_PARAM_CONTEXT_KEY, "_id");, +        indexRequest.putHeader(IngestActionFilter.PIPELINE_ID_PARAM, "_id");, +        indexRequest.putHeader(IngestActionFilter.PIPELINE_ALREADY_PROCESSED, true);, +        indexRequest.putHeader(IngestActionFilter.PIPELINE_ID_PARAM, "_id");, +        indexRequest.putHeader(IngestActionFilter.PIPELINE_ID_PARAM, "_id");]