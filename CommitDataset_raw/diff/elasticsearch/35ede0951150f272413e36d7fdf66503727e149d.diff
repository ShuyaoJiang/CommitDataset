[+++ b/src/main/java/org/elasticsearch/index/search/nested/NestedDocsFilter.java, +/**, + * Filter that returns all nested documents., + * A nested document is a sub documents that belong to a root document., + * Nested documents share the unique id and type and optionally the _source with root documents., + */, +    private final Filter filter = nestedFilter();, +, +    static Filter nestedFilter() {, +        return new PrefixFilter(new Term(TypeFieldMapper.NAME, new BytesRef("__")));, +    }, +, +++ b/src/main/java/org/elasticsearch/index/search/nested/NestedDocsFilter.java, +/**, + * Filter that returns all nested documents., + * A nested document is a sub documents that belong to a root document., + * Nested documents share the unique id and type and optionally the _source with root documents., + */, +    private final Filter filter = nestedFilter();, +, +    static Filter nestedFilter() {, +        return new PrefixFilter(new Term(TypeFieldMapper.NAME, new BytesRef("__")));, +    }, +, +++ b/src/main/java/org/elasticsearch/index/search/nested/NonNestedDocsFilter.java, +import org.elasticsearch.common.lucene.search.NotFilter;, +/**, + * A filter that returns all root (non nested) documents., + * Root documents have an unique id, a type and optionally have a _source and other indexed and stored fields., + */, +    private final Filter filter = new NotFilter(NestedDocsFilter.nestedFilter());, +        return filter.getDocIdSet(context, acceptDocs);]