[+++ b/docs/reference/query-dsl/multi-match-query.asciidoc, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/docs/reference/query-dsl/multi-match-query.asciidoc, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/docs/reference/query-dsl/query-string-query.asciidoc, +combined to build a query when no prefix field is provided., +, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/docs/reference/query-dsl/multi-match-query.asciidoc, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/docs/reference/query-dsl/query-string-query.asciidoc, +combined to build a query when no prefix field is provided., +, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/docs/reference/query-dsl/simple-query-string-query.asciidoc, +the metadata fields., +, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/docs/reference/query-dsl/multi-match-query.asciidoc, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/docs/reference/query-dsl/query-string-query.asciidoc, +combined to build a query when no prefix field is provided., +, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/docs/reference/query-dsl/simple-query-string-query.asciidoc, +the metadata fields., +, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/server/src/main/java/org/elasticsearch/index/search/QueryParserHelper.java, +import org.elasticsearch.search.SearchModule;, +        checkForTooManyFields(resolvedFields, context);, +        checkForTooManyFields(fields, context);, +    private static void checkForTooManyFields(Map<String, Float> fields, QueryShardContext context) {, +        Integer limit = SearchModule.INDICES_MAX_CLAUSE_COUNT_SETTING.get(context.getIndexSettings().getSettings());, +        if (fields.size() > limit) {, +            throw new IllegalArgumentException("field expansion matches too many fields, limit: " + limit + ", got: " + fields.size());, +++ b/docs/reference/query-dsl/multi-match-query.asciidoc, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/docs/reference/query-dsl/query-string-query.asciidoc, +combined to build a query when no prefix field is provided., +, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/docs/reference/query-dsl/simple-query-string-query.asciidoc, +the metadata fields., +, +WARNING: There is a limit on the number of fields that can be queried, +at once. It is defined by the `indices.query.bool.max_clause_count` <<search-settings>>, +which defaults to 1024., +++ b/server/src/main/java/org/elasticsearch/index/search/QueryParserHelper.java, +import org.elasticsearch.search.SearchModule;, +        checkForTooManyFields(resolvedFields, context);, +        checkForTooManyFields(fields, context);, +    private static void checkForTooManyFields(Map<String, Float> fields, QueryShardContext context) {, +        Integer limit = SearchModule.INDICES_MAX_CLAUSE_COUNT_SETTING.get(context.getIndexSettings().getSettings());, +        if (fields.size() > limit) {, +            throw new IllegalArgumentException("field expansion matches too many fields, limit: " + limit + ", got: " + fields.size());, +++ b/server/src/test/java/org/elasticsearch/search/query/QueryStringIT.java, +import org.elasticsearch.search.SearchModule;, +import org.junit.BeforeClass;, +    private static int CLUSTER_MAX_CLAUSE_COUNT;, +, +    @BeforeClass, +    public static void createRandomClusterSetting() {, +        CLUSTER_MAX_CLAUSE_COUNT = randomIntBetween(50, 100);, +    }, +, +    @Override, +    protected Settings nodeSettings(int nodeOrdinal) {, +        return Settings.builder(), +                .put(super.nodeSettings(nodeOrdinal)), +                .put(SearchModule.INDICES_MAX_CLAUSE_COUNT_SETTING.getKey(), CLUSTER_MAX_CLAUSE_COUNT), +                .build();, +    }, +, +        for (int i = 0; i < CLUSTER_MAX_CLAUSE_COUNT + 1; i++) {, +                .setSettings(Settings.builder().put(MapperService.INDEX_MAPPING_TOTAL_FIELDS_LIMIT_SETTING.getKey(),, +                        CLUSTER_MAX_CLAUSE_COUNT + 100)), +        client().prepareIndex("toomanyfields", "type1", "1").setSource("field1", "foo bar baz").get();]