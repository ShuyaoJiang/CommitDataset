[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +            context.reset(parser, new Document(), source, listener);, +            routingFieldMapper.validate(context);, +        context.reset(null, null, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +            context.reset(parser, new Document(), source, listener);, +            routingFieldMapper.validate(context);, +        context.reset(null, null, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/ParseContext.java, +    private SourceToParse sourceToParse;, +    public void reset(XContentParser parser, Document document, SourceToParse source, DocumentMapper.ParseListener listener) {, +        this.sourceToParse = source;, +        this.source = source == null ? null : sourceToParse.source();, +        return sourceToParse.flyweight();, +        return sourceToParse.type();, +    }, +, +    public SourceToParse sourceToParse() {, +        return this.sourceToParse;, +        return source;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +            context.reset(parser, new Document(), source, listener);, +            routingFieldMapper.validate(context);, +        context.reset(null, null, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/ParseContext.java, +    private SourceToParse sourceToParse;, +    public void reset(XContentParser parser, Document document, SourceToParse source, DocumentMapper.ParseListener listener) {, +        this.sourceToParse = source;, +        this.source = source == null ? null : sourceToParse.source();, +        return sourceToParse.flyweight();, +        return sourceToParse.type();, +    }, +, +    public SourceToParse sourceToParse() {, +        return this.sourceToParse;, +        return source;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/internal/ParentFieldMapper.java, +        if (context.sourceToParse().parent() != null) {, +            String parentId = context.sourceToParse().parent();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +            context.reset(parser, new Document(), source, listener);, +            routingFieldMapper.validate(context);, +        context.reset(null, null, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/ParseContext.java, +    private SourceToParse sourceToParse;, +    public void reset(XContentParser parser, Document document, SourceToParse source, DocumentMapper.ParseListener listener) {, +        this.sourceToParse = source;, +        this.source = source == null ? null : sourceToParse.source();, +        return sourceToParse.flyweight();, +        return sourceToParse.type();, +    }, +, +    public SourceToParse sourceToParse() {, +        return this.sourceToParse;, +        return source;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/internal/ParentFieldMapper.java, +        if (context.sourceToParse().parent() != null) {, +            String parentId = context.sourceToParse().parent();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/mapper/internal/RoutingFieldMapper.java, +    public void validate(ParseContext context) throws MapperParsingException {, +        String routing = context.sourceToParse().routing();]