[+++ b/core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java, +import org.elasticsearch.common.xcontent.XContentType;, +    /**, +     * Adds the data from the bytes to be processed by the bulk processor, +     * @deprecated use {@link #add(BytesReference, String, String, XContentType)} instead to avoid content type auto-detection, +     */, +    @Deprecated, +    /**, +     * Adds the data from the bytes to be processed by the bulk processor, +     */, +    public BulkProcessor add(BytesReference data, @Nullable String defaultIndex, @Nullable String defaultType,, +                             XContentType xContentType) throws Exception {, +        return add(data, defaultIndex, defaultType, null, null, xContentType);, +    }, +, +    /**, +     * Adds the data from the bytes to be processed by the bulk processor, +     * @deprecated use {@link #add(BytesReference, String, String, String, Object, XContentType)} instead to avoid content type, +     * auto-detection, +     */, +    @Deprecated, +    public synchronized BulkProcessor add(BytesReference data, @Nullable String defaultIndex, @Nullable String defaultType,, +                                          @Nullable String defaultPipeline, @Nullable Object payload) throws Exception {, +    /**, +     * Adds the data from the bytes to be processed by the bulk processor, +     */, +    public synchronized BulkProcessor add(BytesReference data, @Nullable String defaultIndex, @Nullable String defaultType,, +                                  @Nullable String defaultPipeline, @Nullable Object payload, XContentType xContentType) throws Exception {, +        bulkRequest.add(data, defaultIndex, defaultType, null, null, null, defaultPipeline, payload, true, xContentType);, +        executeIfNeeded();, +        return this;, +    }, +, +++ b/core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java, +import org.elasticsearch.common.xcontent.XContentType;, +    /**, +     * Adds the data from the bytes to be processed by the bulk processor, +     * @deprecated use {@link #add(BytesReference, String, String, XContentType)} instead to avoid content type auto-detection, +     */, +    @Deprecated, +    /**, +     * Adds the data from the bytes to be processed by the bulk processor, +     */, +    public BulkProcessor add(BytesReference data, @Nullable String defaultIndex, @Nullable String defaultType,, +                             XContentType xContentType) throws Exception {, +        return add(data, defaultIndex, defaultType, null, null, xContentType);, +    }, +, +    /**, +     * Adds the data from the bytes to be processed by the bulk processor, +     * @deprecated use {@link #add(BytesReference, String, String, String, Object, XContentType)} instead to avoid content type, +     * auto-detection, +     */, +    @Deprecated, +    public synchronized BulkProcessor add(BytesReference data, @Nullable String defaultIndex, @Nullable String defaultType,, +                                          @Nullable String defaultPipeline, @Nullable Object payload) throws Exception {, +    /**, +     * Adds the data from the bytes to be processed by the bulk processor, +     */, +    public synchronized BulkProcessor add(BytesReference data, @Nullable String defaultIndex, @Nullable String defaultType,, +                                  @Nullable String defaultPipeline, @Nullable Object payload, XContentType xContentType) throws Exception {, +        bulkRequest.add(data, defaultIndex, defaultType, null, null, null, defaultPipeline, payload, true, xContentType);, +        executeIfNeeded();, +        return this;, +    }, +, +++ b/core/src/test/java/org/elasticsearch/action/bulk/BulkProcessorIT.java, +import org.elasticsearch.common.bytes.BytesArray;, +import org.elasticsearch.common.xcontent.XContentType;, +import org.elasticsearch.common.xcontent.json.JsonXContent;, +    public void testThatBulkProcessorCountIsCorrect() throws Exception {, +    public void testBulkProcessorFlush() throws Exception {, +    private static MultiGetRequestBuilder indexDocs(Client client, BulkProcessor processor, int numDocs) throws Exception {, +            if (randomBoolean()) {, +            } else {, +                final String source = "{ \"index\":{\"_index\":\"test\",\"_type\":\"test\",\"_id\":\"" + Integer.toString(i) + "\"} }\n", +                    + JsonXContent.contentBuilder(), +                        .startObject().field("field", randomRealisticUnicodeOfLengthBetween(1, 30)).endObject().string() + "\n";, +                processor.add(new BytesArray(source), null, null, XContentType.JSON);, +            }, +            assertThat("item " + i + " failed with cause: " + bulkItemResponse.getFailureMessage(),, +                bulkItemResponse.isFailed(), equalTo(false));]