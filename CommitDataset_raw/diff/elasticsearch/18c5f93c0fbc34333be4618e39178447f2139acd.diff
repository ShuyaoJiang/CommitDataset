[+++ b/libs/nio/src/main/java/org/elasticsearch/nio/NioSelector.java, +                if (channelContext.selectorShouldClose() == false) {, +                    if (channelContext.selectorShouldClose() == false && (ops & SelectionKey.OP_READ) != 0) {, +            }, +            if (context.selectorShouldClose() == false) {, +            }, +++ b/libs/nio/src/main/java/org/elasticsearch/nio/NioSelector.java, +                if (channelContext.selectorShouldClose() == false) {, +                    if (channelContext.selectorShouldClose() == false && (ops & SelectionKey.OP_READ) != 0) {, +            }, +            if (context.selectorShouldClose() == false) {, +            }, +++ b/libs/nio/src/main/java/org/elasticsearch/nio/SocketChannelContext.java, +        while (isOpen() && bytesConsumed > 0 && channelBuffer.getIndex() > 0) {, +++ b/libs/nio/src/main/java/org/elasticsearch/nio/NioSelector.java, +                if (channelContext.selectorShouldClose() == false) {, +                    if (channelContext.selectorShouldClose() == false && (ops & SelectionKey.OP_READ) != 0) {, +            }, +            if (context.selectorShouldClose() == false) {, +            }, +++ b/libs/nio/src/main/java/org/elasticsearch/nio/SocketChannelContext.java, +        while (isOpen() && bytesConsumed > 0 && channelBuffer.getIndex() > 0) {, +++ b/libs/nio/src/test/java/org/elasticsearch/nio/SocketChannelContextTests.java, +            return isClosing.get();]