[+++ b/src/main/java/org/elasticsearch/client/IndicesAdminClient.java, +++ b/src/main/java/org/elasticsearch/client/IndicesAdminClient.java, +++ b/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +++ b/src/main/java/org/elasticsearch/client/IndicesAdminClient.java, +++ b/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +++ b/src/main/java/org/elasticsearch/client/IndicesAdminClient.java, +++ b/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +++ b/src/main/java/org/elasticsearch/client/IndicesAdminClient.java, +++ b/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +++ b/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java, +++ b/src/main/java/org/elasticsearch/client/IndicesAdminClient.java, +++ b/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +++ b/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public abstract void flush(boolean force, boolean waitIfOngoing) throws EngineException;, +    public abstract void flush() throws EngineException;, +++ b/src/main/java/org/elasticsearch/client/IndicesAdminClient.java, +++ b/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +++ b/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public abstract void flush(boolean force, boolean waitIfOngoing) throws EngineException;, +    public abstract void flush() throws EngineException;, +++ b/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/src/main/java/org/elasticsearch/client/IndicesAdminClient.java, +++ b/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +++ b/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public abstract void flush(boolean force, boolean waitIfOngoing) throws EngineException;, +    public abstract void flush() throws EngineException;, +++ b/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/src/main/java/org/elasticsearch/index/engine/EngineFactory.java, +++ b/src/main/java/org/elasticsearch/client/IndicesAdminClient.java, +++ b/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +++ b/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public abstract void flush(boolean force, boolean waitIfOngoing) throws EngineException;, +    public abstract void flush() throws EngineException;, +++ b/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/src/main/java/org/elasticsearch/index/engine/EngineFactory.java, +++ b/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +    /** When we last pruned expired tombstones from versionMap.deletes: */, +    private final Translog translog;, +        Translog translog = null;, +                translog = new Translog(engineConfig.getShardId(), engineConfig.getIndesSettingService(), engineConfig.getBigArrays(), engineConfig.getTranslogPath(), engineConfig.getThreadPool());, +                    commitIndexWriter(writer, translog.currentId());, +        if (opsRecovered > 0 ||, +                (committedTranslogId != null && translog.currentId() != committedTranslogId)) {, +    public void flush() throws EngineException {, +        flush(true, false, false);, +    public void flush(boolean force, boolean waitIfOngoing) throws EngineException {, +        flush(true, force, waitIfOngoing);, +    private void flush(boolean commitTranslog, boolean force, boolean waitIfOngoing) throws EngineException {, +            } catch (Throwable ignore) {}, +    /** Extended SearcherFactory that warms the segments if needed when acquiring a new searcher */, +, +    private void commitIndexWriter(IndexWriter writer, long translogId) throws IOException {, +            logger.trace("committing writer with translog id [{}] ", translogId);, +            indexWriter.setCommitData(Collections.singletonMap(Translog.TRANSLOG_ID_KEY, Long.toString(translogId)));, +++ b/src/main/java/org/elasticsearch/client/IndicesAdminClient.java, +++ b/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java, +++ b/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java, +++ b/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java, +++ b/src/main/java/org/elasticsearch/index/engine/Engine.java, +    public abstract void flush(boolean force, boolean waitIfOngoing) throws EngineException;, +    public abstract void flush() throws EngineException;, +++ b/src/main/java/org/elasticsearch/index/engine/EngineConfig.java, +++ b/src/main/java/org/elasticsearch/index/engine/EngineFactory.java, +++ b/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +    /** When we last pruned expired tombstones from versionMap.deletes: */, +    private final Translog translog;, +        Translog translog = null;, +                translog = new Translog(engineConfig.getShardId(), engineConfig.getIndesSettingService(), engineConfig.getBigArrays(), engineConfig.getTranslogPath(), engineConfig.getThreadPool());, +                    commitIndexWriter(writer, translog.currentId());, +        if (opsRecovered > 0 ||, +                (committedTranslogId != null && translog.currentId() != committedTranslogId)) {, +    public void flush() throws EngineException {, +        flush(true, false, false);, +    public void flush(boolean force, boolean waitIfOngoing) throws EngineException {, +        flush(true, force, waitIfOngoing);, +    private void flush(boolean commitTranslog, boolean force, boolean waitIfOngoing) throws EngineException {, +            } catch (Throwable ignore) {}, +    /** Extended SearcherFactory that warms the segments if needed when acquiring a new searcher */, +, +    private void commitIndexWriter(IndexWriter writer, long translogId) throws IOException {, +            logger.trace("committing writer with translog id [{}] ", translogId);, +            indexWriter.setCommitData(Collections.singletonMap(Translog.TRANSLOG_ID_KEY, Long.toString(translogId)));]