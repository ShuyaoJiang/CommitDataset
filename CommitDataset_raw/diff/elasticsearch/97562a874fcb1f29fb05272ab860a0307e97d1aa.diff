[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                if (Os.isFamily(Os.FAMILY_WINDOWS)) {, +                    // Having no TMP on Windows defaults to C:\Windows and permission errors, +                    // Since we configure ant to run with a new  environment above, we need to set this to a dir we have access to, +                    File tmpDir = new File(node.baseDir, "tmp"), +                    tmpDir.mkdirs(), +                    env(key: "TMP", value: tmpDir.absolutePath), +                }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                if (Os.isFamily(Os.FAMILY_WINDOWS)) {, +                    // Having no TMP on Windows defaults to C:\Windows and permission errors, +                    // Since we configure ant to run with a new  environment above, we need to set this to a dir we have access to, +                    File tmpDir = new File(node.baseDir, "tmp"), +                    tmpDir.mkdirs(), +                    env(key: "TMP", value: tmpDir.absolutePath), +                }, +++ b/distribution/src/bin/elasticsearch, +ES_JAVA_OPTS="${JVM_OPTIONS//\"\$\{ES_TMPDIR\}\"/$ES_TMPDIR} $ES_JAVA_OPTS", +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                if (Os.isFamily(Os.FAMILY_WINDOWS)) {, +                    // Having no TMP on Windows defaults to C:\Windows and permission errors, +                    // Since we configure ant to run with a new  environment above, we need to set this to a dir we have access to, +                    File tmpDir = new File(node.baseDir, "tmp"), +                    tmpDir.mkdirs(), +                    env(key: "TMP", value: tmpDir.absolutePath), +                }, +++ b/distribution/src/bin/elasticsearch, +ES_JAVA_OPTS="${JVM_OPTIONS//\"\$\{ES_TMPDIR\}\"/$ES_TMPDIR} $ES_JAVA_OPTS", +++ b/distribution/src/config/jvm.options, +-Djava.io.tmpdir="${ES_TMPDIR}"]