[+++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +    private static final Constructor<? extends ElasticsearchException>[] ID_TO_SUPPLIER;, +    private static final Map<Class<? extends ElasticsearchException>, Integer> CLASS_TO_ID;, +    public static ElasticsearchException readException(StreamInput input, int id) throws IOException {, +        Constructor<? extends ElasticsearchException> elasticsearchException = ID_TO_SUPPLIER[id];, +            throw new IllegalStateException("unknown exception for id: " + id);, +            throw new IOException("failed to read exception for id [" + id + "]", e);, +     * Retruns <code>true</code> iff the given class is a registered for an exception to be read., +    public static boolean isRegistered(Class<? extends Throwable> exception) {, +        return CLASS_TO_ID.containsKey(exception);, +    static Set<Class<? extends ElasticsearchException>> getRegisteredKeys() { // for testing, +        return CLASS_TO_ID.keySet();, +    }, +, +    /**, +     * Returns the serialization id the given exception., +     */, +    public static int getId(Class<? extends ElasticsearchException> exception) {, +        return CLASS_TO_ID.get(exception).intValue();, +        // each exception gets an ordinal assigned that must never change. While the exception name can, +        // change due to refactorings etc. like renaming we have to keep the ordinal <--> class mapping, +        // to deserialize the exception coming from another node or from an corruption marker on, +        // a corrupted index., +        final Map<Class<? extends ElasticsearchException>, Integer> exceptions = new HashMap<>();, +        exceptions.put(org.elasticsearch.index.snapshots.IndexShardSnapshotFailedException.class, 0);, +        exceptions.put(org.elasticsearch.search.dfs.DfsPhaseExecutionException.class, 1);, +        exceptions.put(org.elasticsearch.common.util.CancellableThreads.ExecutionCancelledException.class, 2);, +        exceptions.put(org.elasticsearch.discovery.MasterNotDiscoveredException.class, 3);, +        exceptions.put(org.elasticsearch.ElasticsearchSecurityException.class, 4);, +        exceptions.put(org.elasticsearch.index.snapshots.IndexShardRestoreException.class, 5);, +        exceptions.put(org.elasticsearch.indices.IndexClosedException.class, 6);, +        exceptions.put(org.elasticsearch.http.BindHttpException.class, 7);, +        exceptions.put(org.elasticsearch.action.search.ReduceSearchPhaseException.class, 8);, +        exceptions.put(org.elasticsearch.node.NodeClosedException.class, 9);, +        exceptions.put(org.elasticsearch.index.engine.SnapshotFailedEngineException.class, 10);, +        exceptions.put(org.elasticsearch.index.shard.ShardNotFoundException.class, 11);, +        exceptions.put(org.elasticsearch.transport.ConnectTransportException.class, 12);, +        exceptions.put(org.elasticsearch.transport.NotSerializableTransportException.class, 13);, +        exceptions.put(org.elasticsearch.transport.ResponseHandlerFailureTransportException.class, 14);, +        exceptions.put(org.elasticsearch.indices.IndexCreationException.class, 15);, +        exceptions.put(org.elasticsearch.index.IndexNotFoundException.class, 16);, +        exceptions.put(org.elasticsearch.cluster.routing.IllegalShardRoutingStateException.class, 17);, +        exceptions.put(org.elasticsearch.action.support.broadcast.BroadcastShardOperationFailedException.class, 18);, +        exceptions.put(org.elasticsearch.ResourceNotFoundException.class, 19);, +        exceptions.put(org.elasticsearch.transport.ActionTransportException.class, 20);, +        exceptions.put(org.elasticsearch.ElasticsearchGenerationException.class, 21);, +        exceptions.put(org.elasticsearch.index.engine.CreateFailedEngineException.class, 22);, +        exceptions.put(org.elasticsearch.index.shard.IndexShardStartedException.class, 23);, +        exceptions.put(org.elasticsearch.search.SearchContextMissingException.class, 24);, +        exceptions.put(org.elasticsearch.script.ScriptException.class, 25);, +        exceptions.put(org.elasticsearch.index.shard.TranslogRecoveryPerformer.BatchOperationException.class, 26);, +        exceptions.put(org.elasticsearch.snapshots.SnapshotCreationException.class, 27);, +        exceptions.put(org.elasticsearch.index.engine.DeleteFailedEngineException.class, 28);, +        exceptions.put(org.elasticsearch.index.engine.DocumentMissingException.class, 29);, +        exceptions.put(org.elasticsearch.snapshots.SnapshotException.class, 30);, +        exceptions.put(org.elasticsearch.indices.InvalidAliasNameException.class, 31);, +        exceptions.put(org.elasticsearch.indices.InvalidIndexNameException.class, 32);, +        exceptions.put(org.elasticsearch.indices.IndexPrimaryShardNotAllocatedException.class, 33);, +        exceptions.put(org.elasticsearch.transport.TransportException.class, 34);, +        exceptions.put(org.elasticsearch.ElasticsearchParseException.class, 35);, +        exceptions.put(org.elasticsearch.search.SearchException.class, 36);, +        exceptions.put(org.elasticsearch.index.mapper.MapperException.class, 37);, +        exceptions.put(org.elasticsearch.indices.InvalidTypeNameException.class, 38);, +        exceptions.put(org.elasticsearch.snapshots.SnapshotRestoreException.class, 39);, +        exceptions.put(org.elasticsearch.index.query.QueryParsingException.class, 40);, +        exceptions.put(org.elasticsearch.index.shard.IndexShardClosedException.class, 41);, +        exceptions.put(org.elasticsearch.script.expression.ExpressionScriptCompilationException.class, 42);, +        exceptions.put(org.elasticsearch.indices.recovery.RecoverFilesRecoveryException.class, 43);, +        exceptions.put(org.elasticsearch.index.translog.TruncatedTranslogException.class, 44);, +        exceptions.put(org.elasticsearch.indices.recovery.RecoveryFailedException.class, 45);, +        exceptions.put(org.elasticsearch.index.shard.IndexShardRelocatedException.class, 46);, +        exceptions.put(org.elasticsearch.transport.NodeShouldNotConnectException.class, 47);, +        exceptions.put(org.elasticsearch.indices.IndexTemplateAlreadyExistsException.class, 48);, +        exceptions.put(org.elasticsearch.index.translog.TranslogCorruptedException.class, 49);, +        exceptions.put(org.elasticsearch.cluster.block.ClusterBlockException.class, 50);, +        exceptions.put(org.elasticsearch.search.fetch.FetchPhaseExecutionException.class, 51);, +        exceptions.put(org.elasticsearch.index.IndexShardAlreadyExistsException.class, 52);, +        exceptions.put(org.elasticsearch.index.engine.VersionConflictEngineException.class, 53);, +        exceptions.put(org.elasticsearch.index.engine.EngineException.class, 54);, +        exceptions.put(org.elasticsearch.index.engine.DocumentAlreadyExistsException.class, 55);, +        exceptions.put(org.elasticsearch.action.NoSuchNodeException.class, 56);, +        exceptions.put(org.elasticsearch.common.settings.SettingsException.class, 57);, +        exceptions.put(org.elasticsearch.indices.IndexTemplateMissingException.class, 58);, +        exceptions.put(org.elasticsearch.transport.SendRequestTransportException.class, 59);, +        exceptions.put(org.elasticsearch.common.util.concurrent.EsRejectedExecutionException.class, 60);, +        exceptions.put(org.elasticsearch.common.lucene.Lucene.EarlyTerminationException.class, 61);, +        exceptions.put(org.elasticsearch.cluster.routing.RoutingValidationException.class, 62);, +        exceptions.put(org.elasticsearch.common.io.stream.NotSerializableExceptionWrapper.class, 63);, +        exceptions.put(org.elasticsearch.indices.AliasFilterParsingException.class, 64);, +        exceptions.put(org.elasticsearch.index.engine.DeleteByQueryFailedEngineException.class, 65);, +        exceptions.put(org.elasticsearch.gateway.GatewayException.class, 66);, +        exceptions.put(org.elasticsearch.index.shard.IndexShardNotRecoveringException.class, 67);, +        exceptions.put(org.elasticsearch.http.HttpException.class, 68);, +        exceptions.put(org.elasticsearch.ElasticsearchException.class, 69);, +        exceptions.put(org.elasticsearch.snapshots.SnapshotMissingException.class, 70);, +        exceptions.put(org.elasticsearch.action.PrimaryMissingActionException.class, 71);, +        exceptions.put(org.elasticsearch.action.FailedNodeException.class, 72);, +        exceptions.put(org.elasticsearch.search.SearchParseException.class, 73);, +        exceptions.put(org.elasticsearch.snapshots.ConcurrentSnapshotExecutionException.class, 74);, +        exceptions.put(org.elasticsearch.common.blobstore.BlobStoreException.class, 75);]