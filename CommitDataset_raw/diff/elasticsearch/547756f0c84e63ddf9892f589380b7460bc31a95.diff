[+++ b/src/main/java/org/elasticsearch/shield/authc/ldap/ActiveDirectoryConnectionFactory.java, +    static final String MODE_NAME = "active_directory";, +        int port = componentSettings.getAsInt(AD_PORT, 636);, +        String protocol = port == 389 ? "ldap://" : "ldaps://";, +        String[] ldapUrls = componentSettings.getAsArray(URLS_SETTING,  new String[] { protocol + domainName + ":" + port });, +++ b/src/main/java/org/elasticsearch/shield/authc/ldap/ActiveDirectoryConnectionFactory.java, +    static final String MODE_NAME = "active_directory";, +        int port = componentSettings.getAsInt(AD_PORT, 636);, +        String protocol = port == 389 ? "ldap://" : "ldaps://";, +        String[] ldapUrls = componentSettings.getAsArray(URLS_SETTING,  new String[] { protocol + domainName + ":" + port });, +++ b/src/main/java/org/elasticsearch/shield/authc/ldap/LdapModule.java, +import org.elasticsearch.shield.ShieldSettingsException;, +            String mode = settings.getComponentSettings(LdapModule.class).get("mode", StandardLdapConnectionFactory.MODE_NAME);, +            if (StandardLdapConnectionFactory.MODE_NAME.equals(mode)) {, +            } else if (ActiveDirectoryConnectionFactory.MODE_NAME.equals(mode)) {, +            } else {, +                throw new ShieldSettingsException("LDAP is enabled but mode [" + mode + "] does not match [" +, +                    StandardLdapConnectionFactory.MODE_NAME + "] or [" + ActiveDirectoryConnectionFactory.MODE_NAME +"]");, +            bind(LdapRealm.class).toProvider(Providers.<LdapRealm>of(null));, +++ b/src/main/java/org/elasticsearch/shield/authc/ldap/ActiveDirectoryConnectionFactory.java, +    static final String MODE_NAME = "active_directory";, +        int port = componentSettings.getAsInt(AD_PORT, 636);, +        String protocol = port == 389 ? "ldap://" : "ldaps://";, +        String[] ldapUrls = componentSettings.getAsArray(URLS_SETTING,  new String[] { protocol + domainName + ":" + port });, +++ b/src/main/java/org/elasticsearch/shield/authc/ldap/LdapModule.java, +import org.elasticsearch.shield.ShieldSettingsException;, +            String mode = settings.getComponentSettings(LdapModule.class).get("mode", StandardLdapConnectionFactory.MODE_NAME);, +            if (StandardLdapConnectionFactory.MODE_NAME.equals(mode)) {, +            } else if (ActiveDirectoryConnectionFactory.MODE_NAME.equals(mode)) {, +            } else {, +                throw new ShieldSettingsException("LDAP is enabled but mode [" + mode + "] does not match [" +, +                    StandardLdapConnectionFactory.MODE_NAME + "] or [" + ActiveDirectoryConnectionFactory.MODE_NAME +"]");, +            bind(LdapRealm.class).toProvider(Providers.<LdapRealm>of(null));, +++ b/src/main/java/org/elasticsearch/shield/authc/ldap/StandardLdapConnectionFactory.java, +    static final String MODE_NAME = "ldap";, +++ b/src/main/java/org/elasticsearch/shield/authc/ldap/ActiveDirectoryConnectionFactory.java, +    static final String MODE_NAME = "active_directory";, +        int port = componentSettings.getAsInt(AD_PORT, 636);, +        String protocol = port == 389 ? "ldap://" : "ldaps://";, +        String[] ldapUrls = componentSettings.getAsArray(URLS_SETTING,  new String[] { protocol + domainName + ":" + port });, +++ b/src/main/java/org/elasticsearch/shield/authc/ldap/LdapModule.java, +import org.elasticsearch.shield.ShieldSettingsException;, +            String mode = settings.getComponentSettings(LdapModule.class).get("mode", StandardLdapConnectionFactory.MODE_NAME);, +            if (StandardLdapConnectionFactory.MODE_NAME.equals(mode)) {, +            } else if (ActiveDirectoryConnectionFactory.MODE_NAME.equals(mode)) {, +            } else {, +                throw new ShieldSettingsException("LDAP is enabled but mode [" + mode + "] does not match [" +, +                    StandardLdapConnectionFactory.MODE_NAME + "] or [" + ActiveDirectoryConnectionFactory.MODE_NAME +"]");, +            bind(LdapRealm.class).toProvider(Providers.<LdapRealm>of(null));, +++ b/src/main/java/org/elasticsearch/shield/authc/ldap/StandardLdapConnectionFactory.java, +    static final String MODE_NAME = "ldap";, +++ b/src/test/java/org/elasticsearch/shield/test/ShieldIntegrationTest.java]