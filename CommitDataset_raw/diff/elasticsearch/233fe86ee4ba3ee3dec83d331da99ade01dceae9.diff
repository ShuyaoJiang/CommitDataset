[+++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequest.java, +        template = in.readOptionalWriteable(Template::new);, +        out.writeOptionalWriteable(template);, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequest.java, +        template = in.readOptionalWriteable(Template::new);, +        out.writeOptionalWriteable(template);, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequest.java, +        template = in.readOptionalWriteable(Template::new);, +        out.writeOptionalWriteable(template);, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java, +        script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequest.java, +        template = in.readOptionalWriteable(Template::new);, +        out.writeOptionalWriteable(template);, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java, +        script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +        script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequest.java, +        template = in.readOptionalWriteable(Template::new);, +        out.writeOptionalWriteable(template);, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java, +        script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +        script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/rest/action/admin/indices/analyze/RestAnalyzeAction.java, +        public static final ParseField TOKEN_FILTERS = new ParseField("token_filters", "filters");, +        public static final ParseField CHAR_FILTERS = new ParseField("char_filters");, +        analyzeRequest.tokenFilters(request.paramAsStringArray("token_filters", request.paramAsStringArray("filters", analyzeRequest.tokenFilters())));, +        analyzeRequest.charFilters(request.paramAsStringArray("char_filters", analyzeRequest.charFilters()));, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequest.java, +        template = in.readOptionalWriteable(Template::new);, +        out.writeOptionalWriteable(template);, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java, +        script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +        script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/rest/action/admin/indices/analyze/RestAnalyzeAction.java, +        public static final ParseField TOKEN_FILTERS = new ParseField("token_filters", "filters");, +        public static final ParseField CHAR_FILTERS = new ParseField("char_filters");, +        analyzeRequest.tokenFilters(request.paramAsStringArray("token_filters", request.paramAsStringArray("filters", analyzeRequest.tokenFilters())));, +        analyzeRequest.charFilters(request.paramAsStringArray("char_filters", analyzeRequest.charFilters()));, +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +import org.elasticsearch.common.io.stream.Writeable;, +public class Script implements ToXContent, Writeable<Script> {, +    public final Script readFrom(StreamInput in) throws IOException {, +        return new Script(in);, +    }, +, +    public Script(StreamInput in) throws IOException {, +    protected void doWriteTo(StreamOutput out) throws IOException {};, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequest.java, +        template = in.readOptionalWriteable(Template::new);, +        out.writeOptionalWriteable(template);, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java, +        script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +        script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/rest/action/admin/indices/analyze/RestAnalyzeAction.java, +        public static final ParseField TOKEN_FILTERS = new ParseField("token_filters", "filters");, +        public static final ParseField CHAR_FILTERS = new ParseField("char_filters");, +        analyzeRequest.tokenFilters(request.paramAsStringArray("token_filters", request.paramAsStringArray("filters", analyzeRequest.tokenFilters())));, +        analyzeRequest.charFilters(request.paramAsStringArray("char_filters", analyzeRequest.charFilters()));, +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +import org.elasticsearch.common.io.stream.Writeable;, +public class Script implements ToXContent, Writeable<Script> {, +    public final Script readFrom(StreamInput in) throws IOException {, +        return new Script(in);, +    }, +, +    public Script(StreamInput in) throws IOException {, +    protected void doWriteTo(StreamOutput out) throws IOException {};, +++ b/core/src/main/java/org/elasticsearch/script/Template.java, +    public Template(StreamInput in) throws IOException {, +        super(in);, +        if (in.readBoolean()) {, +            this.contentType = XContentType.readFrom(in);, +        }, +        return new Template(in);, +++ b/core/src/main/java/org/elasticsearch/action/search/SearchRequest.java, +        template = in.readOptionalWriteable(Template::new);, +        out.writeOptionalWriteable(template);, +++ b/core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +            script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java, +        script = new Script(in);, +++ b/core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java, +        script = new Script(in);]