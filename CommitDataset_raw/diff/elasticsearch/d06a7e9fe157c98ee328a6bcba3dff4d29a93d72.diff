[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/fetch/script/ScriptFieldsSearchHitPhase.java, +                value = scriptField.script().unwrap(value);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/fetch/script/ScriptFieldsSearchHitPhase.java, +                value = scriptField.script().unwrap(value);, +++ b/plugins/lang/javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineTests.java, +import java.util.List;, +    @Test public void testJavaScriptInnerArrayCreation() {, +        Map<String, Object> ctx = new HashMap<String, Object>();, +        Map<String, Object> doc = new HashMap<String, Object>();, +        ctx.put("doc", doc);, +, +        Object complied = se.compile("ctx.doc.field1 = ['value1', 'value2']");, +        ExecutableScript script = se.executable(complied, new HashMap<String, Object>());, +        script.setNextVar("ctx", ctx);, +        script.run();, +, +        Map<String, Object> unwrap = (Map<String, Object>) script.unwrap(ctx);, +, +        assertThat(((Map) unwrap.get("doc")).get("field1"), instanceOf(List.class));, +    }, +, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/fetch/script/ScriptFieldsSearchHitPhase.java, +                value = scriptField.script().unwrap(value);, +++ b/plugins/lang/javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineTests.java, +import java.util.List;, +    @Test public void testJavaScriptInnerArrayCreation() {, +        Map<String, Object> ctx = new HashMap<String, Object>();, +        Map<String, Object> doc = new HashMap<String, Object>();, +        ctx.put("doc", doc);, +, +        Object complied = se.compile("ctx.doc.field1 = ['value1', 'value2']");, +        ExecutableScript script = se.executable(complied, new HashMap<String, Object>());, +        script.setNextVar("ctx", ctx);, +        script.run();, +, +        Map<String, Object> unwrap = (Map<String, Object>) script.unwrap(ctx);, +, +        assertThat(((Map) unwrap.get("doc")).get("field1"), instanceOf(List.class));, +    }, +, +++ b/plugins/river/couchdb/src/main/java/org/elasticsearch/river/couchdb/CouchdbRiver.java, +                // we need to unwrap the ctx..., +                ctx = (Map<String, Object>) script.unwrap(ctx);]