[+++ b/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/job/config/Job.java, +                Date createTime, Date finishedTime,, +        return Objects.hash(jobId, jobType, groups, description, createTime, finishedTime,, +                id, jobType, groups, description, createTime, finishedTime,, +++ b/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/job/config/Job.java, +                Date createTime, Date finishedTime,, +        return Objects.hash(jobId, jobType, groups, description, createTime, finishedTime,, +                id, jobType, groups, description, createTime, finishedTime,, +++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/ml/job/config/JobTests.java, +++ b/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/job/config/Job.java, +                Date createTime, Date finishedTime,, +        return Objects.hash(jobId, jobType, groups, description, createTime, finishedTime,, +                id, jobType, groups, description, createTime, finishedTime,, +++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/ml/job/config/JobTests.java, +++ b/docs/reference/ml/apis/jobresource.asciidoc, +++ b/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/job/config/Job.java, +                Date createTime, Date finishedTime,, +        return Objects.hash(jobId, jobType, groups, description, createTime, finishedTime,, +                id, jobType, groups, description, createTime, finishedTime,, +++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/ml/job/config/JobTests.java, +++ b/docs/reference/ml/apis/jobresource.asciidoc, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.xpack.core.ml.MlTasks;, +                new NamedWriteableRegistry.Entry(PersistentTaskParams.class, MlTasks.DATAFEED_TASK_NAME,, +                new NamedWriteableRegistry.Entry(PersistentTaskParams.class, MlTasks.JOB_TASK_NAME,, +                new NamedXContentRegistry.Entry(PersistentTaskParams.class, new ParseField(MlTasks.DATAFEED_TASK_NAME),, +                new NamedXContentRegistry.Entry(PersistentTaskParams.class, new ParseField(MlTasks.JOB_TASK_NAME),, +++ b/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/job/config/Job.java, +                Date createTime, Date finishedTime,, +        return Objects.hash(jobId, jobType, groups, description, createTime, finishedTime,, +                id, jobType, groups, description, createTime, finishedTime,, +++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/ml/job/config/JobTests.java, +++ b/docs/reference/ml/apis/jobresource.asciidoc, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.xpack.core.ml.MlTasks;, +                new NamedWriteableRegistry.Entry(PersistentTaskParams.class, MlTasks.DATAFEED_TASK_NAME,, +                new NamedWriteableRegistry.Entry(PersistentTaskParams.class, MlTasks.JOB_TASK_NAME,, +                new NamedXContentRegistry.Entry(PersistentTaskParams.class, new ParseField(MlTasks.DATAFEED_TASK_NAME),, +                new NamedXContentRegistry.Entry(PersistentTaskParams.class, new ParseField(MlTasks.JOB_TASK_NAME),, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetaIndex.java, +++ b/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/job/config/Job.java, +                Date createTime, Date finishedTime,, +        return Objects.hash(jobId, jobType, groups, description, createTime, finishedTime,, +                id, jobType, groups, description, createTime, finishedTime,, +++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/ml/job/config/JobTests.java, +++ b/docs/reference/ml/apis/jobresource.asciidoc, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.xpack.core.ml.MlTasks;, +                new NamedWriteableRegistry.Entry(PersistentTaskParams.class, MlTasks.DATAFEED_TASK_NAME,, +                new NamedWriteableRegistry.Entry(PersistentTaskParams.class, MlTasks.JOB_TASK_NAME,, +                new NamedXContentRegistry.Entry(PersistentTaskParams.class, new ParseField(MlTasks.DATAFEED_TASK_NAME),, +                new NamedXContentRegistry.Entry(PersistentTaskParams.class, new ParseField(MlTasks.JOB_TASK_NAME),, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetaIndex.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +                new DelegatingMapParams(Collections.singletonMap(ToXContentParams.FOR_INTERNAL_STORAGE, "true"), params);, +                    MlMetadataDiff::readDatafeedDiffFrom);, +        /**, +         * Merge the diff with the ML metadata., +         * @param part The current ML metadata., +         * @return The new ML metadata., +         */, +        static Diff<DatafeedConfig> readDatafeedDiffFrom(StreamInput in) throws IOException {, +                throw ExceptionsHelper.datafeedAlreadyExists(datafeedConfig.getId());, +        public Builder putJobs(Collection<Job> jobs) {, +        public Builder putDatafeeds(Collection<DatafeedConfig> datafeeds) {, +++ b/client/rest-high-level/src/main/java/org/elasticsearch/client/ml/job/config/Job.java, +                Date createTime, Date finishedTime,, +        return Objects.hash(jobId, jobType, groups, description, createTime, finishedTime,, +                id, jobType, groups, description, createTime, finishedTime,, +++ b/client/rest-high-level/src/test/java/org/elasticsearch/client/ml/job/config/JobTests.java, +++ b/docs/reference/ml/apis/jobresource.asciidoc, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackClientPlugin.java, +import org.elasticsearch.xpack.core.ml.MlTasks;, +                new NamedWriteableRegistry.Entry(PersistentTaskParams.class, MlTasks.DATAFEED_TASK_NAME,, +                new NamedWriteableRegistry.Entry(PersistentTaskParams.class, MlTasks.JOB_TASK_NAME,, +                new NamedXContentRegistry.Entry(PersistentTaskParams.class, new ParseField(MlTasks.DATAFEED_TASK_NAME),, +                new NamedXContentRegistry.Entry(PersistentTaskParams.class, new ParseField(MlTasks.JOB_TASK_NAME),, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetaIndex.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlMetadata.java, +                new DelegatingMapParams(Collections.singletonMap(ToXContentParams.FOR_INTERNAL_STORAGE, "true"), params);, +                    MlMetadataDiff::readDatafeedDiffFrom);, +        /**, +         * Merge the diff with the ML metadata., +         * @param part The current ML metadata., +         * @return The new ML metadata., +         */, +        static Diff<DatafeedConfig> readDatafeedDiffFrom(StreamInput in) throws IOException {, +                throw ExceptionsHelper.datafeedAlreadyExists(datafeedConfig.getId());, +        public Builder putJobs(Collection<Job> jobs) {, +        public Builder putDatafeeds(Collection<DatafeedConfig> datafeeds) {, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/MlTasks.java, +import java.util.Collections;, +import java.util.List;, +import java.util.Set;, +import java.util.stream.Collectors;, +, +    public static final String JOB_TASK_NAME = "xpack/ml/job";, +    public static final String DATAFEED_TASK_NAME = "xpack/ml/datafeed";, +, +    private static final String JOB_TASK_ID_PREFIX = "job-";]