[+++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +        // If a translog op is replayed on the primary (eg. ccr), we need to use external instead of null for its version type., +        final VersionType versionType = (origin == Engine.Operation.Origin.PRIMARY) ? VersionType.EXTERNAL : null;, +                    versionType, index.getAutoGeneratedIdTimestamp(), true, origin,, +                    versionType, origin);, +++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +        // If a translog op is replayed on the primary (eg. ccr), we need to use external instead of null for its version type., +        final VersionType versionType = (origin == Engine.Operation.Origin.PRIMARY) ? VersionType.EXTERNAL : null;, +                    versionType, index.getAutoGeneratedIdTimestamp(), true, origin,, +                    versionType, origin);, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/index/engine/FollowingEngine.java, +        assert (operation.origin() == Operation.Origin.PRIMARY) == (operation.versionType() == VersionType.EXTERNAL) :, +            "invalid version_type in a following engine; version_type=" + operation.versionType() + "origin=" + operation.origin();]