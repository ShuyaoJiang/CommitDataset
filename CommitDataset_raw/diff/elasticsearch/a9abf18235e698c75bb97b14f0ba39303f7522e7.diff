[+++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +        return new TestSearchContext(threadPool, cacheRecycler, pageCacheRecycler, bigArrays, indexService, filterCache, indexFieldDataService);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +        return new TestSearchContext(threadPool, cacheRecycler, pageCacheRecycler, bigArrays, indexService, filterCache, indexFieldDataService);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +        return new TestSearchContext(threadPool, cacheRecycler, pageCacheRecycler, bigArrays, indexService, filterCache, indexFieldDataService);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/ParentConstantScoreQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +        return new TestSearchContext(threadPool, cacheRecycler, pageCacheRecycler, bigArrays, indexService, filterCache, indexFieldDataService);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/ParentConstantScoreQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/ParentQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +        return new TestSearchContext(threadPool, cacheRecycler, pageCacheRecycler, bigArrays, indexService, filterCache, indexFieldDataService);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/ParentConstantScoreQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/ParentQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/TestSearchContext.java, +import org.elasticsearch.threadpool.ThreadPool;, +import java.util.concurrent.TimeUnit;, +import java.util.concurrent.atomic.AtomicBoolean;, +    final ThreadPool threadPool;, +    private final AtomicBoolean closed = new AtomicBoolean(false);, +    public TestSearchContext(ThreadPool threadPool, CacheRecycler cacheRecycler, PageCacheRecycler pageCacheRecycler, BigArrays bigArrays, IndexService indexService, FilterCache filterCache, IndexFieldDataService indexFieldDataService) {, +        this.threadPool = threadPool;, +        this.threadPool = null;, +        if (closed.compareAndSet(false, true)) {, +            threadPool.shutdownNow();, +            try {, +                threadPool.awaitTermination(10, TimeUnit.SECONDS);, +            } catch (InterruptedException e) {, +                Thread.interrupted();, +            }, +        }, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +        return new TestSearchContext(threadPool, cacheRecycler, pageCacheRecycler, bigArrays, indexService, filterCache, indexFieldDataService);, +++ b/src/test/java/org/elasticsearch/index/search/child/ChildrenQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/ParentConstantScoreQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/ParentQueryTests.java, +import org.elasticsearch.common.lease.Releasables;, +        SearchContext current = SearchContext.current();, +        Releasables.close(current);, +++ b/src/test/java/org/elasticsearch/index/search/child/TestSearchContext.java, +import org.elasticsearch.threadpool.ThreadPool;, +import java.util.concurrent.TimeUnit;, +import java.util.concurrent.atomic.AtomicBoolean;, +    final ThreadPool threadPool;]