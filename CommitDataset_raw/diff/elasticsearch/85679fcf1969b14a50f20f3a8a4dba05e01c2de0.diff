[+++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/graph/rest/action/RestGraphAction.java, +                    currentHop.guidingQuery(context.parseInnerQueryBuilder());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/graph/rest/action/RestGraphAction.java, +                    currentHop.guidingQuery(context.parseInnerQueryBuilder());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/accesscontrol/SecurityIndexSearcherWrapper.java, +                        QueryBuilder queryBuilder = queryShardContext.newParseContext(parser).parseInnerQueryBuilder();, +                        verifyRoleQuery(queryBuilder);, +                        failIfQueryUsesClient(scriptService, queryBuilder, queryShardContext);, +                        ParsedQuery parsedQuery = queryShardContext.toQuery(queryBuilder);, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/graph/rest/action/RestGraphAction.java, +                    currentHop.guidingQuery(context.parseInnerQueryBuilder());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/accesscontrol/SecurityIndexSearcherWrapper.java, +                        QueryBuilder queryBuilder = queryShardContext.newParseContext(parser).parseInnerQueryBuilder();, +                        verifyRoleQuery(queryBuilder);, +                        failIfQueryUsesClient(scriptService, queryBuilder, queryShardContext);, +                        ParsedQuery parsedQuery = queryShardContext.toQuery(queryBuilder);, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/notification/email/attachment/EmailAttachmentParsersTests.java, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/graph/rest/action/RestGraphAction.java, +                    currentHop.guidingQuery(context.parseInnerQueryBuilder());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/accesscontrol/SecurityIndexSearcherWrapper.java, +                        QueryBuilder queryBuilder = queryShardContext.newParseContext(parser).parseInnerQueryBuilder();, +                        verifyRoleQuery(queryBuilder);, +                        failIfQueryUsesClient(scriptService, queryBuilder, queryShardContext);, +                        ParsedQuery parsedQuery = queryShardContext.toQuery(queryBuilder);, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/notification/email/attachment/EmailAttachmentParsersTests.java, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/security/authz/accesscontrol/SecurityIndexSearcherWrapperIntegrationTests.java, +            when(queryParseContext.parseInnerQueryBuilder()).thenReturn(new TermQueryBuilder("field", values[i]));, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/graph/rest/action/RestGraphAction.java, +                    currentHop.guidingQuery(context.parseInnerQueryBuilder());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/accesscontrol/SecurityIndexSearcherWrapper.java, +                        QueryBuilder queryBuilder = queryShardContext.newParseContext(parser).parseInnerQueryBuilder();, +                        verifyRoleQuery(queryBuilder);, +                        failIfQueryUsesClient(scriptService, queryBuilder, queryShardContext);, +                        ParsedQuery parsedQuery = queryShardContext.toQuery(queryBuilder);, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/notification/email/attachment/EmailAttachmentParsersTests.java, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/security/authz/accesscontrol/SecurityIndexSearcherWrapperIntegrationTests.java, +            when(queryParseContext.parseInnerQueryBuilder()).thenReturn(new TermQueryBuilder("field", values[i]));, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/actions/email/EmailActionTests.java, +        }, +, +        if (textBody != null || htmlBody != null) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/graph/rest/action/RestGraphAction.java, +                    currentHop.guidingQuery(context.parseInnerQueryBuilder());, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/accesscontrol/SecurityIndexSearcherWrapper.java, +                        QueryBuilder queryBuilder = queryShardContext.newParseContext(parser).parseInnerQueryBuilder();, +                        verifyRoleQuery(queryBuilder);, +                        failIfQueryUsesClient(scriptService, queryBuilder, queryShardContext);, +                        ParsedQuery parsedQuery = queryShardContext.toQuery(queryBuilder);, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/notification/email/attachment/EmailAttachmentParsersTests.java, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/security/authz/accesscontrol/SecurityIndexSearcherWrapperIntegrationTests.java, +            when(queryParseContext.parseInnerQueryBuilder()).thenReturn(new TermQueryBuilder("field", values[i]));, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/actions/email/EmailActionTests.java, +        }, +, +        if (textBody != null || htmlBody != null) {, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/condition/ArrayCompareConditionTests.java]