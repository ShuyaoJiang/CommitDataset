[+++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +        return new Mapper.TypeParser.ParserContext(type, indexAnalyzers, similarityService::getSimilarity, mapperService, typeParsers::get, indexVersionCreated, parseFieldMatcher, queryShardContextSupplier);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +        return new Mapper.TypeParser.ParserContext(type, indexAnalyzers, similarityService::getSimilarity, mapperService, typeParsers::get, indexVersionCreated, parseFieldMatcher, queryShardContextSupplier);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/Mapper.java, +import java.util.function.Supplier;, +            private final Supplier<QueryShardContext> queryShardContextSupplier;, +            private QueryShardContext queryShardContext;, +                                 Version indexVersionCreated, ParseFieldMatcher parseFieldMatcher,, +                                 Supplier<QueryShardContext> queryShardContextSupplier) {, +                this.queryShardContextSupplier = queryShardContextSupplier;, +                // No need for synchronization, this class must be used in a single thread, +                if (queryShardContext == null) {, +                    queryShardContext = queryShardContextSupplier.get();, +                }, +                    super(in.type(), in.indexAnalyzers, in.similarityLookupService(), in.mapperService(), in.typeParsers(), in.indexVersionCreated(), in.parseFieldMatcher(), in::queryShardContext);]