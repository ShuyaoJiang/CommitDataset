[+++ b/elasticsearch/x-pack/marvel/src/test/java/org/elasticsearch/marvel/agent/exporter/ExportersTests.java, +            final int threadNum = i;, +            final int threadDocs = nbDocs;, +, +            logger.debug("--> exporting thread [{}] exports {} documents", threadNum, threadDocs);, +                    for (int n = 0; n < threadDocs; n++) {, +                    try {, +                        logger.debug("--> thread [{}] successfully exported {} documents", threadNum, threadDocs);, +                    } catch (Exception e) {, +                        logger.debug("--> thread [{}] failed to export {} documents", threadNum, threadDocs);, +                    }, +, +, +        exporters.close();, +            private List<CountingBulk> bulks = new CopyOnWriteArrayList<>();, +                CountingBulk bulk = new CountingBulk(type + "#" + count.getAndIncrement());, +                bulks.add(bulk);, +                int exported = 0;, +                for (CountingBulk bulk : bulks) {, +                    exported += bulk.getCount();, +                }, +                return exported;, +            int getCount() {, +                return count.get();]