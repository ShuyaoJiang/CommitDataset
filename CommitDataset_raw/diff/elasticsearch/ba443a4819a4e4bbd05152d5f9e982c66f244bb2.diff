[+++ b/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsTests.java, +import org.elasticsearch.index.merge.scheduler.ConcurrentMergeSchedulerProvider;, +                                 .put(ConcurrentMergeSchedulerProvider.MAX_THREAD_COUNT, "1"), +                                 .put(ConcurrentMergeSchedulerProvider.MAX_MERGE_COUNT, "2"), +        for(int i=0;i<100;i++) {, +        // Optimize does a waitForMerges, which we must do to make sure all in-flight (throttled) merges finish:, +        client().admin().indices().prepareOptimize("test").get();, +, +        for(int i=0;i<100;i++) {]