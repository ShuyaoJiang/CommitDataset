[+++ b/TESTING.asciidoc, +++ b/TESTING.asciidoc, +++ b/build.gradle, +      javadoc = false, +if (hasProperty('projectsPrefix') == false) {, +  allprojects {, +    project.ext['projectsPrefix'] = '', +  }  , +}, +, +  gradle.projectsEvaluated {, +  configurations {, +    all {, +      resolutionStrategy {, +        dependencySubstitution {, +          substitute module("org.elasticsearch:rest-api-spec:${version}") with project("${projectsPrefix}:rest-api-spec"), +          substitute module("org.elasticsearch:elasticsearch:${version}") with project("${projectsPrefix}:core"), +          substitute module("org.elasticsearch:test-framework:${version}") with project("${projectsPrefix}:test-framework"), +          substitute module("org.elasticsearch.distribution.zip:elasticsearch:${version}") with project("${projectsPrefix}:distribution:zip"), +          substitute module("org.elasticsearch.distribution.tar:elasticsearch:${version}") with project("${projectsPrefix}:distribution:tar"), +if (projectsPrefix.isEmpty()) {, +      languageLevel = org.elasticsearch.gradle.BuildPlugin.minimumJava, +  tasks.cleanIdea {, +    delete '.idea', +task clean(type: GradleBuild) {, +  buildFile = 'buildSrc/build.gradle', +  tasks = ['clean'], +}, +, +++ b/TESTING.asciidoc, +++ b/build.gradle, +      javadoc = false, +if (hasProperty('projectsPrefix') == false) {, +  allprojects {, +    project.ext['projectsPrefix'] = '', +  }  , +}, +, +  gradle.projectsEvaluated {, +  configurations {, +    all {, +      resolutionStrategy {, +        dependencySubstitution {, +          substitute module("org.elasticsearch:rest-api-spec:${version}") with project("${projectsPrefix}:rest-api-spec"), +          substitute module("org.elasticsearch:elasticsearch:${version}") with project("${projectsPrefix}:core"), +          substitute module("org.elasticsearch:test-framework:${version}") with project("${projectsPrefix}:test-framework"), +          substitute module("org.elasticsearch.distribution.zip:elasticsearch:${version}") with project("${projectsPrefix}:distribution:zip"), +          substitute module("org.elasticsearch.distribution.tar:elasticsearch:${version}") with project("${projectsPrefix}:distribution:tar"), +if (projectsPrefix.isEmpty()) {, +      languageLevel = org.elasticsearch.gradle.BuildPlugin.minimumJava, +  tasks.cleanIdea {, +    delete '.idea', +task clean(type: GradleBuild) {, +  buildFile = 'buildSrc/build.gradle', +  tasks = ['clean'], +}, +, +++ b/buildSrc/src/main/groovy/com/carrotsearch/gradle/junit4/RandomizedTestingTask.groovy, +            haltOnFailure: haltOnFailure,, +        def junit4 = NamespaceBuilder.newInstance(ant, 'junit4'), +++ b/TESTING.asciidoc, +++ b/build.gradle, +      javadoc = false, +if (hasProperty('projectsPrefix') == false) {, +  allprojects {, +    project.ext['projectsPrefix'] = '', +  }  , +}, +, +  gradle.projectsEvaluated {, +  configurations {, +    all {, +      resolutionStrategy {, +        dependencySubstitution {, +          substitute module("org.elasticsearch:rest-api-spec:${version}") with project("${projectsPrefix}:rest-api-spec"), +          substitute module("org.elasticsearch:elasticsearch:${version}") with project("${projectsPrefix}:core"), +          substitute module("org.elasticsearch:test-framework:${version}") with project("${projectsPrefix}:test-framework"), +          substitute module("org.elasticsearch.distribution.zip:elasticsearch:${version}") with project("${projectsPrefix}:distribution:zip"), +          substitute module("org.elasticsearch.distribution.tar:elasticsearch:${version}") with project("${projectsPrefix}:distribution:tar"), +if (projectsPrefix.isEmpty()) {, +      languageLevel = org.elasticsearch.gradle.BuildPlugin.minimumJava, +  tasks.cleanIdea {, +    delete '.idea', +task clean(type: GradleBuild) {, +  buildFile = 'buildSrc/build.gradle', +  tasks = ['clean'], +}, +, +++ b/buildSrc/src/main/groovy/com/carrotsearch/gradle/junit4/RandomizedTestingTask.groovy, +            haltOnFailure: haltOnFailure,, +        def junit4 = NamespaceBuilder.newInstance(ant, 'junit4'), +++ b/buildSrc/src/main/groovy/com/carrotsearch/gradle/junit4/TestReportLogger.groovy, +        outStream = new LoggingOutputStream(logger: logger, level: LogLevel.ERROR, prefix: "  1> "), +            emitSuiteStart(LogLevel.INFO, evt.getDescription());, +        if (isPassthrough() && logger.isInfoEnabled()) {, +        try {, +        LogLevel level = e.isSuccessful() ? LogLevel.INFO : LogLevel.ERROR, +    } catch (Exception exc) {, +            logger.lifecycle('EXCEPTION: ', exc), +        }]