[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +                                                    TransportService transportService, IndicesService indicesService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +                                                    TransportService transportService, IndicesService indicesService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCache.java, +    @Inject public NodeCache(Settings settings, ByteBufferCache byteBufferCache, ClusterService clusterService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +                                                    TransportService transportService, IndicesService indicesService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCache.java, +    @Inject public NodeCache(Settings settings, ByteBufferCache byteBufferCache, ClusterService clusterService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCacheModule.java, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +                                                    TransportService transportService, IndicesService indicesService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCache.java, +    @Inject public NodeCache(Settings settings, ByteBufferCache byteBufferCache, ClusterService clusterService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCacheModule.java, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +                                                    TransportService transportService, IndicesService indicesService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCache.java, +    @Inject public NodeCache(Settings settings, ByteBufferCache byteBufferCache, ClusterService clusterService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCacheModule.java, +++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +                                                    TransportService transportService, IndicesService indicesService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCache.java, +    @Inject public NodeCache(Settings settings, ByteBufferCache byteBufferCache, ClusterService clusterService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCacheModule.java, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +                                                    TransportService transportService, IndicesService indicesService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCache.java, +    @Inject public NodeCache(Settings settings, ByteBufferCache byteBufferCache, ClusterService clusterService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCacheModule.java, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +                                                    TransportService transportService, IndicesService indicesService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCache.java, +    @Inject public NodeCache(Settings settings, ByteBufferCache byteBufferCache, ClusterService clusterService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCacheModule.java, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +                                                    TransportService transportService, IndicesService indicesService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCache.java, +    @Inject public NodeCache(Settings settings, ByteBufferCache byteBufferCache, ClusterService clusterService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCacheModule.java, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +                                                    TransportService transportService, IndicesService indicesService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCache.java, +    @Inject public NodeCache(Settings settings, ByteBufferCache byteBufferCache, ClusterService clusterService) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cache/NodeCacheModule.java, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/cache/IndexCache.java, +import org.elasticsearch.ElasticSearchException;, +import org.elasticsearch.cluster.ClusterChangedEvent;, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.cluster.ClusterStateListener;, +import org.elasticsearch.common.component.CloseableComponent;, +import org.elasticsearch.index.cache.query.parser.QueryParserCache;, +import javax.annotation.Nullable;, +, +public class IndexCache extends AbstractIndexComponent implements CloseableComponent, ClusterStateListener {, +    private final QueryParserCache queryParserCache;, +, +    private ClusterService clusterService;, +, +                              QueryParserCache queryParserCache, IdCache idCache) {, +        this.queryParserCache = queryParserCache;, +    @Inject(optional = true), +    public void setClusterService(@Nullable ClusterService clusterService) {, +        this.clusterService = clusterService;, +        if (clusterService != null) {, +            clusterService.add(this);, +        }, +    }, +, +    public QueryParserCache queryParserCache() {, +        return this.queryParserCache;, +    }]