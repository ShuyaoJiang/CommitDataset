[+++ b/server/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java, +import java.util.ArrayList;, +    public static void assertFileCount(Path dir, int expectedCount) throws IOException {, +        final List<Path> found = new ArrayList<>();, +        Files.walkFileTree(dir, new SimpleFileVisitor<Path>() {, +            @Override, +            public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) {, +                found.add(file);, +                return FileVisitResult.CONTINUE;, +            }, +        });, +        assertEquals("Unexpected file count, found: [" + found + "].", expectedCount, found.size());, +    }, +, +++ b/server/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java, +import java.util.ArrayList;, +    public static void assertFileCount(Path dir, int expectedCount) throws IOException {, +        final List<Path> found = new ArrayList<>();, +        Files.walkFileTree(dir, new SimpleFileVisitor<Path>() {, +            @Override, +            public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) {, +                found.add(file);, +                return FileVisitResult.CONTINUE;, +            }, +        });, +        assertEquals("Unexpected file count, found: [" + found + "].", expectedCount, found.size());, +    }, +, +++ b/server/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java, +        assertFileCount(repo, 0);, +        assertFileCount(repo, 4);]