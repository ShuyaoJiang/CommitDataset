[+++ b/rest-api-spec/src/main/resources/rest-api-spec/test/indices.stats/20_translog.yml, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +++ b/rest-api-spec/src/main/resources/rest-api-spec/test/indices.stats/20_translog.yml, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +++ b/server/src/main/java/org/elasticsearch/index/translog/Translog.java, +    long earliestLastModifiedAge() {, +        try (ReleasableLock ignored = readLock.acquire()) {, +            ensureOpen();, +            return findEarliestLastModifiedAge(System.currentTimeMillis(), readers, current);, +        } catch (IOException e) {, +            throw new TranslogException(shardId, "Unable to get the earliest last modified time for the transaction log");, +        }, +    }, +, +    /**, +     * Returns the age of the oldest entry in the translog files in seconds, +     */, +    static long findEarliestLastModifiedAge(long currentTime, Iterable<TranslogReader> readers, TranslogWriter writer) throws IOException {, +        long earliestTime = currentTime;, +        for (BaseTranslogReader r : readers) {, +            earliestTime = Math.min(r.getLastModifiedTime(), earliestTime);, +        }, +        return Math.max(0, currentTime - Math.min(earliestTime, writer.getLastModifiedTime()));, +    }, +, +            return new TranslogStats(totalOperations(), sizeInBytes(), uncommittedOperations(), uncommittedSizeInBytes(), earliestLastModifiedAge());, +++ b/rest-api-spec/src/main/resources/rest-api-spec/test/indices.stats/20_translog.yml, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +++ b/server/src/main/java/org/elasticsearch/index/translog/Translog.java, +    long earliestLastModifiedAge() {, +        try (ReleasableLock ignored = readLock.acquire()) {, +            ensureOpen();, +            return findEarliestLastModifiedAge(System.currentTimeMillis(), readers, current);, +        } catch (IOException e) {, +            throw new TranslogException(shardId, "Unable to get the earliest last modified time for the transaction log");, +        }, +    }, +, +    /**, +     * Returns the age of the oldest entry in the translog files in seconds, +     */, +    static long findEarliestLastModifiedAge(long currentTime, Iterable<TranslogReader> readers, TranslogWriter writer) throws IOException {, +        long earliestTime = currentTime;, +        for (BaseTranslogReader r : readers) {, +            earliestTime = Math.min(r.getLastModifiedTime(), earliestTime);, +        }, +        return Math.max(0, currentTime - Math.min(earliestTime, writer.getLastModifiedTime()));, +    }, +, +            return new TranslogStats(totalOperations(), sizeInBytes(), uncommittedOperations(), uncommittedSizeInBytes(), earliestLastModifiedAge());, +++ b/server/src/main/java/org/elasticsearch/index/translog/TranslogStats.java, +    private long earliestLastModifiedAge;, +    public TranslogStats(int numberOfOperations, long translogSizeInBytes, int uncommittedOperations, long uncommittedSizeInBytes,, +                         long earliestLastModifiedAge) {, +        if (earliestLastModifiedAge < 0) {, +            throw new IllegalArgumentException("earliestLastModifiedAge must be >= 0");, +        }, +        this.earliestLastModifiedAge = earliestLastModifiedAge;, +        this.earliestLastModifiedAge =, +            Math.min(this.earliestLastModifiedAge, translogStats.earliestLastModifiedAge);, +    public long getEarliestLastModifiedAge() { return earliestLastModifiedAge; }, +, +        builder.field("earliest_last_modified_age", earliestLastModifiedAge);, +        if (in.getVersion().onOrAfter(Version.V_7_0_0_alpha1)) {, +            earliestLastModifiedAge = in.readVLong();, +        }, +        if (out.getVersion().onOrAfter(Version.V_7_0_0_alpha1)) {, +            out.writeVLong(earliestLastModifiedAge);, +        }, +++ b/rest-api-spec/src/main/resources/rest-api-spec/test/indices.stats/20_translog.yml, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +  - gte: { indices.test.primaries.translog.earliest_last_modified_age: 0 }, +++ b/server/src/main/java/org/elasticsearch/index/translog/Translog.java, +    long earliestLastModifiedAge() {, +        try (ReleasableLock ignored = readLock.acquire()) {, +            ensureOpen();, +            return findEarliestLastModifiedAge(System.currentTimeMillis(), readers, current);, +        } catch (IOException e) {, +            throw new TranslogException(shardId, "Unable to get the earliest last modified time for the transaction log");, +        }, +    }, +, +    /**, +     * Returns the age of the oldest entry in the translog files in seconds, +     */, +    static long findEarliestLastModifiedAge(long currentTime, Iterable<TranslogReader> readers, TranslogWriter writer) throws IOException {, +        long earliestTime = currentTime;, +        for (BaseTranslogReader r : readers) {, +            earliestTime = Math.min(r.getLastModifiedTime(), earliestTime);, +        }, +        return Math.max(0, currentTime - Math.min(earliestTime, writer.getLastModifiedTime()));, +    }, +]