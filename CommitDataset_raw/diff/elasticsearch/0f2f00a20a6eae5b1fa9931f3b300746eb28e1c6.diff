[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/config/AnalysisConfig.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/config/AnalysisConfig.java, +++ b/x-pack/plugin/ml/qa/basic-multi-node/src/test/java/org/elasticsearch/xpack/ml/integration/MlBasicMultiNodeIT.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/config/AnalysisConfig.java, +++ b/x-pack/plugin/ml/qa/basic-multi-node/src/test/java/org/elasticsearch/xpack/ml/integration/MlBasicMultiNodeIT.java, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearning.java, +import org.elasticsearch.cluster.node.DiscoveryNode;, +    // This is not used in v7 and higher, but users are still prevented from setting it directly to avoid confusion, +    private static final String PRE_V7_ML_ENABLED_NODE_ATTR = "ml.enabled";, +    public static boolean isMlNode(DiscoveryNode node) {, +        Map<String, String> nodeAttributes = node.getAttributes();, +        try {, +            return Integer.parseInt(nodeAttributes.get(MAX_OPEN_JOBS_NODE_ATTR)) > 0;, +        } catch (NumberFormatException e) {, +            return false;, +        }, +    }, +        String mlEnabledNodeAttrName = "node.attr." + PRE_V7_ML_ENABLED_NODE_ATTR;, +            // This is not used in v7 and higher, but users are still prevented from setting it directly to avoid confusion, +            disallowMlNodeAttributes(mlEnabledNodeAttrName);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/config/AnalysisConfig.java, +++ b/x-pack/plugin/ml/qa/basic-multi-node/src/test/java/org/elasticsearch/xpack/ml/integration/MlBasicMultiNodeIT.java, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearning.java, +import org.elasticsearch.cluster.node.DiscoveryNode;, +    // This is not used in v7 and higher, but users are still prevented from setting it directly to avoid confusion, +    private static final String PRE_V7_ML_ENABLED_NODE_ATTR = "ml.enabled";, +    public static boolean isMlNode(DiscoveryNode node) {, +        Map<String, String> nodeAttributes = node.getAttributes();, +        try {, +            return Integer.parseInt(nodeAttributes.get(MAX_OPEN_JOBS_NODE_ATTR)) > 0;, +        } catch (NumberFormatException e) {, +            return false;, +        }, +    }, +        String mlEnabledNodeAttrName = "node.attr." + PRE_V7_ML_ENABLED_NODE_ATTR;, +            // This is not used in v7 and higher, but users are still prevented from setting it directly to avoid confusion, +            disallowMlNodeAttributes(mlEnabledNodeAttrName);, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearningFeatureSet.java, +            if (MachineLearning.isMlNode(node)) {, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/config/AnalysisConfig.java, +++ b/x-pack/plugin/ml/qa/basic-multi-node/src/test/java/org/elasticsearch/xpack/ml/integration/MlBasicMultiNodeIT.java, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearning.java, +import org.elasticsearch.cluster.node.DiscoveryNode;, +    // This is not used in v7 and higher, but users are still prevented from setting it directly to avoid confusion, +    private static final String PRE_V7_ML_ENABLED_NODE_ATTR = "ml.enabled";, +    public static boolean isMlNode(DiscoveryNode node) {, +        Map<String, String> nodeAttributes = node.getAttributes();, +        try {, +            return Integer.parseInt(nodeAttributes.get(MAX_OPEN_JOBS_NODE_ATTR)) > 0;, +        } catch (NumberFormatException e) {, +            return false;, +        }, +    }, +        String mlEnabledNodeAttrName = "node.attr." + PRE_V7_ML_ENABLED_NODE_ATTR;, +            // This is not used in v7 and higher, but users are still prevented from setting it directly to avoid confusion, +            disallowMlNodeAttributes(mlEnabledNodeAttrName);, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearningFeatureSet.java, +            if (MachineLearning.isMlNode(node)) {, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteJobAction.java, +        IdsQueryBuilder query = new IdsQueryBuilder().addIds(Quantiles.documentId(jobId));, +        IdsQueryBuilder query = new IdsQueryBuilder().addIds(CategorizerState.documentId(jobId, docNum));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/OpenJobAction.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/datafeed/DatafeedConfig.java, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/config/AnalysisConfig.java, +++ b/x-pack/plugin/ml/qa/basic-multi-node/src/test/java/org/elasticsearch/xpack/ml/integration/MlBasicMultiNodeIT.java, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearning.java, +import org.elasticsearch.cluster.node.DiscoveryNode;, +    // This is not used in v7 and higher, but users are still prevented from setting it directly to avoid confusion, +    private static final String PRE_V7_ML_ENABLED_NODE_ATTR = "ml.enabled";, +    public static boolean isMlNode(DiscoveryNode node) {, +        Map<String, String> nodeAttributes = node.getAttributes();, +        try {, +            return Integer.parseInt(nodeAttributes.get(MAX_OPEN_JOBS_NODE_ATTR)) > 0;, +        } catch (NumberFormatException e) {, +            return false;, +        }, +    }, +        String mlEnabledNodeAttrName = "node.attr." + PRE_V7_ML_ENABLED_NODE_ATTR;, +            // This is not used in v7 and higher, but users are still prevented from setting it directly to avoid confusion, +            disallowMlNodeAttributes(mlEnabledNodeAttrName);, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MachineLearningFeatureSet.java, +            if (MachineLearning.isMlNode(node)) {, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteJobAction.java, +        IdsQueryBuilder query = new IdsQueryBuilder().addIds(Quantiles.documentId(jobId));, +        IdsQueryBuilder query = new IdsQueryBuilder().addIds(CategorizerState.documentId(jobId, docNum));, +++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportOpenJobAction.java, +                                  JobConfigProvider jobConfigProvider, MlMemoryTracker memoryTracker) {]