[+++ b/core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationTests.java, +import java.util.List;, +        List<String> nodes = internalCluster().startNodesAsync(2).get();, +        final String masterNode = internalCluster().getMasterName();, +        final String nonMasterNode = nodes.get(0).equals(masterNode) ? nodes.get(1) : nodes.get(0);, +, +        final String masterId = internalCluster().clusterService(masterNode).localNode().id();, +        final String nonMasterId = internalCluster().clusterService(nonMasterNode).localNode().id();, +, +        final int numShards = scaledRandomIntBetween(2, 10);, +        RoutingNode routingNode = stateResponse.getState().routingNodes().node(nonMasterId);, +        logger.info("Node [{}] has shards: {}", nonMasterNode, Arrays.toString(node2Shards));, +, +        internalCluster().getInstance(ClusterService.class, nonMasterNode).submitStateUpdateTask("test", Priority.IMMEDIATE, new ClusterStateUpdateTask() {, +                                    .addShard(TestShardRouting.newShardRouting("test", i, masterId, true, ShardRoutingState.STARTED, shardVersions[shardIds[i]])), +            assertTrue(waitForShardDeletion(nonMasterNode, "test", shard));]