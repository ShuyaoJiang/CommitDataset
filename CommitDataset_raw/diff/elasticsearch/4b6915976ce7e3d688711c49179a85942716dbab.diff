[+++ b/TESTING.asciidoc, +Now inside the VM, start the packaging tests from the terminal. There are two packaging, +test projects. The old ones are written with https://github.com/sstephenson/bats[bats], +and only run on linux. To run them do, +The new packaging tests are written in Java and run on both linux and windows. On, +linux (again, inside the VM), +# run the full suite, +sudo bash $PACKAGING_TESTS/run-tests.sh, +, +# run specific test cases, +sudo bash $PACKAGING_TESTS/run-tests.sh \, +  org.elasticsearch.packaging.test.DefaultZipTests \, +  org.elasticsearch.packaging.test.OssZipTests, +or on Windows, from a terminal running as Administrator, +# run the full suite, +, +# run specific test cases, +powershell -File $Env:PACKAGING_TESTS/run-tests.ps1 `, +  org.elasticsearch.packaging.test.DefaultZipTests `, +  org.elasticsearch.packaging.test.OssZipTests, +Note that on Windows boxes when running from inside the GUI, you may have to log out and, +back in to the `vagrant` user (password `vagrant`) for the environment variables that, +locate the packaging tests and distributions to take effect, due to how vagrant provisions, +Windows machines., +, +++ b/TESTING.asciidoc, +Now inside the VM, start the packaging tests from the terminal. There are two packaging, +test projects. The old ones are written with https://github.com/sstephenson/bats[bats], +and only run on linux. To run them do, +The new packaging tests are written in Java and run on both linux and windows. On, +linux (again, inside the VM), +# run the full suite, +sudo bash $PACKAGING_TESTS/run-tests.sh, +, +# run specific test cases, +sudo bash $PACKAGING_TESTS/run-tests.sh \, +  org.elasticsearch.packaging.test.DefaultZipTests \, +  org.elasticsearch.packaging.test.OssZipTests, +or on Windows, from a terminal running as Administrator, +# run the full suite, +, +# run specific test cases, +powershell -File $Env:PACKAGING_TESTS/run-tests.ps1 `, +  org.elasticsearch.packaging.test.DefaultZipTests `, +  org.elasticsearch.packaging.test.OssZipTests, +Note that on Windows boxes when running from inside the GUI, you may have to log out and, +back in to the `vagrant` user (password `vagrant`) for the environment variables that, +locate the packaging tests and distributions to take effect, due to how vagrant provisions, +Windows machines., +, +++ b/Vagrantfile, +    touch /is_vagrant_vm # for consistency between linux and windows, +++ b/TESTING.asciidoc, +Now inside the VM, start the packaging tests from the terminal. There are two packaging, +test projects. The old ones are written with https://github.com/sstephenson/bats[bats], +and only run on linux. To run them do, +The new packaging tests are written in Java and run on both linux and windows. On, +linux (again, inside the VM), +# run the full suite, +sudo bash $PACKAGING_TESTS/run-tests.sh, +, +# run specific test cases, +sudo bash $PACKAGING_TESTS/run-tests.sh \, +  org.elasticsearch.packaging.test.DefaultZipTests \, +  org.elasticsearch.packaging.test.OssZipTests, +or on Windows, from a terminal running as Administrator, +# run the full suite, +, +# run specific test cases, +powershell -File $Env:PACKAGING_TESTS/run-tests.ps1 `, +  org.elasticsearch.packaging.test.DefaultZipTests `, +  org.elasticsearch.packaging.test.OssZipTests, +Note that on Windows boxes when running from inside the GUI, you may have to log out and, +back in to the `vagrant` user (password `vagrant`) for the environment variables that, +locate the packaging tests and distributions to take effect, due to how vagrant provisions, +Windows machines., +, +++ b/Vagrantfile, +    touch /is_vagrant_vm # for consistency between linux and windows, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/vagrant/VagrantTestPlugin.groovy, +            'archives:zip',, +            'archives:oss-zip',, +            contents """\, +                     if [ "\$#" -eq 0 ]; then, +                       test_args=( "${-> project.extensions.esvagrant.testClass}" ), +                     else, +                       test_args=( "\$@" ), +                     fi, +                     java -cp "\$PACKAGING_TESTS/*" org.elasticsearch.packaging.VMTestRunner "\${test_args[@]}", +                     """, +            // the use of $args rather than param() here is deliberate because the syntax for array (multivalued) parameters is likely, +            // a little trappy for those unfamiliar with powershell, +                     if (\$args.Count -eq 0) {, +                       \$testArgs = @("${-> project.extensions.esvagrant.testClass}"), +                     } else {, +                       \$testArgs = \$args, +                     }, +                     java -cp "\$Env:PACKAGING_TESTS/*" org.elasticsearch.packaging.VMTestRunner @testArgs, +                javaPackagingTest.args = ['--command', 'sudo bash "$PACKAGING_TESTS/run-tests.sh"'], +                // winrm commands run as administrator]