[+++ b/server/src/main/java/org/elasticsearch/cluster/service/MasterService.java, +        final Supplier<ThreadContext.StoredContext> supplier = threadContext.newRestorableContext(true);, +++ b/server/src/main/java/org/elasticsearch/cluster/service/MasterService.java, +        final Supplier<ThreadContext.StoredContext> supplier = threadContext.newRestorableContext(true);, +++ b/server/src/test/java/org/elasticsearch/cluster/service/MasterServiceTests.java, +import java.util.Arrays;, +            final Map<String, List<String>> expectedResponseHeaders = Collections.singletonMap("testResponse",, +                Arrays.asList("testResponse"));, +                    threadPool.getThreadContext().addResponseHeader("testResponse", "testResponse");, +                    assertEquals(expectedResponseHeaders, threadPool.getThreadContext().getResponseHeaders());, +                    assertEquals(expectedResponseHeaders, threadPool.getThreadContext().getResponseHeaders());, +                    assertEquals(expectedResponseHeaders, threadPool.getThreadContext().getResponseHeaders());, +                    assertEquals(expectedResponseHeaders, threadPool.getThreadContext().getResponseHeaders());, +                    assertEquals(expectedResponseHeaders, threadPool.getThreadContext().getResponseHeaders());, +            assertEquals(Collections.emptyMap(), threadPool.getThreadContext().getResponseHeaders());]