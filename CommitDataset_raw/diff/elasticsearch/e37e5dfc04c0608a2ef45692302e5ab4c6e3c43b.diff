[+++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/IngestCommonPlugin.java, +import org.elasticsearch.ingest.PipelineProcessor;, +++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/IngestCommonPlugin.java, +import org.elasticsearch.ingest.PipelineProcessor;, +++ /dev/null, +++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/IngestCommonPlugin.java, +import org.elasticsearch.ingest.PipelineProcessor;, +++ /dev/null, +++ /dev/null, +++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/IngestCommonPlugin.java, +import org.elasticsearch.ingest.PipelineProcessor;, +++ /dev/null, +++ /dev/null, +++ b/modules/ingest-common/src/test/resources/rest-api-spec/test/ingest/210_pipeline_processor.yml, +- match: { error.root_cause.0.reason: "java.lang.IllegalArgumentException: java.lang.IllegalStateException: Cycle detected for pipeline: inner" }, +++ b/modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/IngestCommonPlugin.java, +import org.elasticsearch.ingest.PipelineProcessor;, +++ /dev/null, +++ /dev/null, +++ b/modules/ingest-common/src/test/resources/rest-api-spec/test/ingest/210_pipeline_processor.yml, +- match: { error.root_cause.0.reason: "java.lang.IllegalArgumentException: java.lang.IllegalStateException: Cycle detected for pipeline: inner" }, +++ b/modules/ingest-common/src/test/resources/rest-api-spec/test/ingest/90_simulate.yml, +, +---, +"Test verbose simulate with Pipeline Processor with Circular Pipelines":, +- do:, +    ingest.put_pipeline:, +      id: "outer", +      body:  >, +        {, +          "description" : "outer pipeline",, +          "processors" : [, +            {, +              "pipeline" : {, +                "pipeline": "inner", +              }, +            }, +          ], +        }, +- match: { acknowledged: true }, +, +- do:, +    ingest.put_pipeline:, +      id: "inner", +      body:  >, +        {, +          "description" : "inner pipeline",, +          "processors" : [, +            {, +              "pipeline" : {, +                "pipeline": "outer", +              }, +            }, +          ], +        }, +- match: { acknowledged: true }, +, +- do:, +    catch: /illegal_state_exception/, +    ingest.simulate:, +      verbose: true, +      body: >, +        {, +          "pipeline": {, +            "processors" : [, +            {, +              "pipeline" : {, +                "pipeline": "outer", +              }, +            }, +            ], +          }, +          ,, +          "docs": [, +          {, +            "_index": "index",, +            "_type": "type",, +            "_id": "id",, +            "_source": {, +              "field1": "123.42 400 <foo>", +            }, +          }, +          ], +        }, +- match: { error.root_cause.0.type: "illegal_state_exception" }, +- match: { error.root_cause.0.reason: "Cycle detected for pipeline: inner" }, +, +---, +"Test verbose simulate with Pipeline Processor with Multiple Pipelines":, +- do:, +    ingest.put_pipeline:, +      id: "pipeline1", +      body:  >, +        {, +          "processors": [, +          {, +            "set": {, +              "field": "pipeline1",, +              "value": true, +            }]