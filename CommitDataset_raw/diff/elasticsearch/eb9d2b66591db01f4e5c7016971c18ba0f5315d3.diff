[+++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +    public static final class ConcreteShardRequest<R extends TransportRequest> extends TransportRequest {, +++ b/core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java, +    public static final class ConcreteShardRequest<R extends TransportRequest> extends TransportRequest {, +++ b/core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java, +            requestOrWrappedRequest = ((TransportReplicationAction.ConcreteShardRequest<?>)requestOrWrappedRequest).getRequest();, +                new TransportReplicationAction.ConcreteShardRequest<>(, +                        new Request().setShardId(shardId), replicaRouting.allocationId().getId()),, +                new TransportReplicationAction.ConcreteShardRequest<>(request, "_not_a_valid_aid_"),, +            new TransportReplicationAction.ConcreteShardRequest<>(request, "_not_a_valid_aid_"),, +                new TransportReplicationAction.ConcreteShardRequest<>(request, replica.allocationId().getId()),, +        assertThat(((TransportReplicationAction.ConcreteShardRequest<?>) capturedRequest.request).getRequest(), equalTo(request));, +        assertThat(((TransportReplicationAction.ConcreteShardRequest<?>) capturedRequest.request).getTargetAllocationID(),]