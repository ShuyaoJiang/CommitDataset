[+++ b/shield/src/main/java/org/elasticsearch/shield/ShieldPlugin.java, +        return Collections.emptyList();, +            return Collections.<Module>singletonList(new AccessControlShardModule(settings));, +            return Collections.emptyList();, +            return Arrays.<Class<? extends LifecycleComponent>>asList(LicenseService.class, InternalCryptoService.class, FileRolesStore.class, Realms.class, IPFilter.class);, +        return Collections.emptyList();, +++ b/shield/src/main/java/org/elasticsearch/shield/ShieldPlugin.java, +        return Collections.emptyList();, +            return Collections.<Module>singletonList(new AccessControlShardModule(settings));, +            return Collections.emptyList();, +            return Arrays.<Class<? extends LifecycleComponent>>asList(LicenseService.class, InternalCryptoService.class, FileRolesStore.class, Realms.class, IPFilter.class);, +        return Collections.emptyList();, +++ b/shield/src/main/java/org/elasticsearch/shield/authc/AuthenticationModule.java, +    private static final List<String> INTERNAL_REALM_TYPES = Arrays.asList(ESUsersRealm.TYPE, ActiveDirectoryRealm.TYPE, LdapRealm.TYPE, PkiRealm.TYPE);, +++ b/shield/src/main/java/org/elasticsearch/shield/ShieldPlugin.java, +        return Collections.emptyList();, +            return Collections.<Module>singletonList(new AccessControlShardModule(settings));, +            return Collections.emptyList();, +            return Arrays.<Class<? extends LifecycleComponent>>asList(LicenseService.class, InternalCryptoService.class, FileRolesStore.class, Realms.class, IPFilter.class);, +        return Collections.emptyList();, +++ b/shield/src/main/java/org/elasticsearch/shield/authc/AuthenticationModule.java, +    private static final List<String> INTERNAL_REALM_TYPES = Arrays.asList(ESUsersRealm.TYPE, ActiveDirectoryRealm.TYPE, LdapRealm.TYPE, PkiRealm.TYPE);, +++ b/shield/src/main/java/org/elasticsearch/shield/authc/activedirectory/ActiveDirectoryGroupsResolver.java, +        List<String> groupList = new ArrayList<>();, +            groupList.add(entry.getDN());, +++ b/shield/src/main/java/org/elasticsearch/shield/ShieldPlugin.java, +        return Collections.emptyList();, +            return Collections.<Module>singletonList(new AccessControlShardModule(settings));, +            return Collections.emptyList();, +            return Arrays.<Class<? extends LifecycleComponent>>asList(LicenseService.class, InternalCryptoService.class, FileRolesStore.class, Realms.class, IPFilter.class);, +        return Collections.emptyList();, +++ b/shield/src/main/java/org/elasticsearch/shield/authc/AuthenticationModule.java, +    private static final List<String> INTERNAL_REALM_TYPES = Arrays.asList(ESUsersRealm.TYPE, ActiveDirectoryRealm.TYPE, LdapRealm.TYPE, PkiRealm.TYPE);, +++ b/shield/src/main/java/org/elasticsearch/shield/authc/activedirectory/ActiveDirectoryGroupsResolver.java, +        List<String> groupList = new ArrayList<>();, +            groupList.add(entry.getDN());, +++ b/shield/src/main/java/org/elasticsearch/shield/authz/AuthorizationService.java, +import java.util.List;, +, +    List<String> authorizedIndicesAndAliases(User user, String action);, +++ b/shield/src/main/java/org/elasticsearch/shield/ShieldPlugin.java, +        return Collections.emptyList();, +            return Collections.<Module>singletonList(new AccessControlShardModule(settings));, +            return Collections.emptyList();, +            return Arrays.<Class<? extends LifecycleComponent>>asList(LicenseService.class, InternalCryptoService.class, FileRolesStore.class, Realms.class, IPFilter.class);, +        return Collections.emptyList();, +++ b/shield/src/main/java/org/elasticsearch/shield/authc/AuthenticationModule.java, +    private static final List<String> INTERNAL_REALM_TYPES = Arrays.asList(ESUsersRealm.TYPE, ActiveDirectoryRealm.TYPE, LdapRealm.TYPE, PkiRealm.TYPE);, +++ b/shield/src/main/java/org/elasticsearch/shield/authc/activedirectory/ActiveDirectoryGroupsResolver.java, +        List<String> groupList = new ArrayList<>();, +            groupList.add(entry.getDN());, +++ b/shield/src/main/java/org/elasticsearch/shield/authz/AuthorizationService.java, +import java.util.List;, +, +    List<String> authorizedIndicesAndAliases(User user, String action);, +++ b/shield/src/main/java/org/elasticsearch/shield/authz/InternalAuthorizationService.java, +import java.util.*;, +    public List<String> authorizedIndicesAndAliases(User user, String action) {, +            return Collections.emptyList();, +        List<Predicate<String>> predicates = new ArrayList<>();, +        List<String> indicesAndAliases = new ArrayList<>();, +        Predicate<String> predicate = Predicates.or(predicates);, +        return Collections.unmodifiableList(indicesAndAliases);, +++ b/shield/src/main/java/org/elasticsearch/shield/ShieldPlugin.java, +        return Collections.emptyList();, +            return Collections.<Module>singletonList(new AccessControlShardModule(settings));, +            return Collections.emptyList();, +            return Arrays.<Class<? extends LifecycleComponent>>asList(LicenseService.class, InternalCryptoService.class, FileRolesStore.class, Realms.class, IPFilter.class);, +        return Collections.emptyList();, +++ b/shield/src/main/java/org/elasticsearch/shield/authc/AuthenticationModule.java, +    private static final List<String> INTERNAL_REALM_TYPES = Arrays.asList(ESUsersRealm.TYPE, ActiveDirectoryRealm.TYPE, LdapRealm.TYPE, PkiRealm.TYPE);, +++ b/shield/src/main/java/org/elasticsearch/shield/authc/activedirectory/ActiveDirectoryGroupsResolver.java, +        List<String> groupList = new ArrayList<>();, +            groupList.add(entry.getDN());, +++ b/shield/src/main/java/org/elasticsearch/shield/authz/AuthorizationService.java, +import java.util.List;, +, +    List<String> authorizedIndicesAndAliases(User user, String action);, +++ b/shield/src/main/java/org/elasticsearch/shield/authz/InternalAuthorizationService.java, +import java.util.*;, +    public List<String> authorizedIndicesAndAliases(User user, String action) {, +            return Collections.emptyList();, +        List<Predicate<String>> predicates = new ArrayList<>();, +        List<String> indicesAndAliases = new ArrayList<>();, +        Predicate<String> predicate = Predicates.or(predicates);, +        return Collections.unmodifiableList(indicesAndAliases);, +++ b/shield/src/main/java/org/elasticsearch/shield/authz/Permission.java, +import com.google.common.collect.ImmutableMap;, +import com.google.common.collect.ImmutableSet;, +import com.google.common.collect.Iterators;, +import com.google.common.collect.UnmodifiableIterator;, +                private List<Indices.Group> groups = new ArrayList<>();, +                    Indices.Core indices = groups.isEmpty() ? Indices.Core.NONE : new Indices.Core(groups.toArray(new Indices.Group[groups.size()]));, +            public Compound(List<Global> globals) {, +                private List<Global> globals = new ArrayList<>();, +                    return new Compound(Collections.unmodifiableList(globals));, +            private final List<Global> globals;, +            public Globals(List<Global> globals) {, +                            List<String> indices = new ArrayList<>();, +                                    indices.addAll(Arrays.asList(group.indices));]