[+++ b/qa/pom.xml, +                                    <tests.rest.cluster>127.0.0.1:${integ.http.port}</tests.rest.cluster>, +        See: https://github.com/elastic/infra/issues/331, +        <module>shield-tribe-node-tests</module>, +++ b/qa/pom.xml, +                                    <tests.rest.cluster>127.0.0.1:${integ.http.port}</tests.rest.cluster>, +        See: https://github.com/elastic/infra/issues/331, +        <module>shield-tribe-node-tests</module>, +++ b/qa/shield-tribe-node-tests/integration-tests.xml, +<?xml version="1.0"?>, +<!--, +  ~ ELASTICSEARCH CONFIDENTIAL, +  ~ __________________, +  ~, +  ~  [2014] Elasticsearch Incorporated. All Rights Reserved., +  ~, +  ~ NOTICE:  All information contained herein is, and remains, +  ~ the property of Elasticsearch Incorporated and its suppliers,, +  ~ if any.  The intellectual and technical concepts contained, +  ~ herein are proprietary to Elasticsearch Incorporated, +  ~ and its suppliers and may be covered by U.S. and Foreign Patents,, +  ~ patents in process, and are protected by trade secret or copyright law., +  ~ Dissemination of this information or reproduction of this material, +  ~ is strictly forbidden unless prior written permission is obtained, +  ~ from Elasticsearch Incorporated., +  -->, +, +<project name="smoke-test-tribe-node-with-shield", +         xmlns:ac="antlib:net.sf.antcontrib">, +, +    <taskdef name="xhttp" classname="org.elasticsearch.ant.HttpTask" classpath="${test_classpath}" />, +    <typedef name="xhttp" classname="org.elasticsearch.ant.HttpCondition" classpath="${test_classpath}"/>, +, +    <import file="${elasticsearch.integ.antfile.default}"/>, +    <import file="${elasticsearch.tools.directory}/ant/shield-overrides.xml"/>, +, +    <property name="integ.pidfile.2" location="${integ.scratch}/cluster2.pid"/>, +    <available property="integ.pidfile.2.exists" file="${integ.pidfile.2}"/>, +    <property name="integ.pidfile.3" location="${integ.scratch}/cluster3.pid"/>, +    <available property="integ.pidfile.3.exists" file="${integ.pidfile.3}"/>, +, +    <macrodef name="create-index">, +        <attribute name="name" />, +        <attribute name="port" />, +        <sequential>, +            <xhttp uri="http://127.0.0.1:@{port}/@{name}" method="PUT" username="test_admin" password="changeme" />, +            <waitfor maxwait="30" maxwaitunit="second", +                     checkevery="500" checkeveryunit="millisecond", +                     timeoutproperty="@{timeoutproperty}">, +                <xhttp uri="http://127.0.0.1:@{port}/_cluster/health/@{name}?wait_for_status=yellow" username="test_admin" password="changeme" />, +            </waitfor>, +        </sequential>, +    </macrodef>, +, +    <target name="start-tribe-node-and-2-clusters-with-shield" depends="setup-workspace">, +        <ac:for list="${xplugins.list}" param="xplugin.name">, +            <sequential>, +                <fail message="Expected @{xplugin.name}-${version}.zip as a dependency, but could not be found in ${integ.deps}/plugins}">, +                    <condition>, +                        <not>, +                            <available file="${integ.deps}/plugins/@{xplugin.name}-${elasticsearch.version}.zip"/>, +                        </not>, +                    </condition>, +                </fail>, +            </sequential>, +        </ac:for>, +, +        <ac:for param="file">, +            <path>, +                <fileset dir="${integ.deps}/plugins"/>, +            </path>, +            <sequential>, +                <local name="plugin.name"/>, +                <convert-plugin-name file="@{file}" outputproperty="plugin.name"/>, +                <install-plugin name="${plugin.name}" file="@{file}"/>, +            </sequential>, +        </ac:for>, +, +        <local name="home"/>, +        <property name="home" location="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +, +        <echo>Adding roles.yml</echo>, +        <copy file="shield-roles.yml" tofile="${home}/config/shield/roles.yml" overwrite="true"/>, +, +        <echo>Adding shield users...</echo>, +        <run-script script="${home}/bin/shield/esusers">, +            <nested>, +                <arg value="useradd"/>, +                <arg value="test_admin"/>, +                <arg value="-p"/>, +                <arg value="changeme"/>, +                <arg value="-r"/>, +                <arg value="admin"/>, +            </nested>, +        </run-script>, +, +        <echo>Starting two nodes, each node in a different cluster</echo>, +        <ac:trycatch property="failure.message">, +            <ac:try>, +                <startup-elasticsearch es.transport.tcp.port="9600"]