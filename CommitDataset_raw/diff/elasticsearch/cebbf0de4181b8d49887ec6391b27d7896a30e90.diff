[+++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +        public enum Origin {, +            PEER_RECOVERY,, +            LOCAL_TRANSLOG_RECOVERY;, +, +            public boolean isRecovery() {, +                return this == PEER_RECOVERY || this == LOCAL_TRANSLOG_RECOVERY;, +            }, +        public int sizeInBytes() {, +            if (location != null) {, +                return location.size;, +            } else {, +                return estimatedSizeInBytes();, +            }, +        }, +, +        protected abstract int estimatedSizeInBytes();, +, +, +        @Override, +        protected int estimatedSizeInBytes() {, +            return (id().length() + type().length()) * 2 + source().length() + 12;, +        }, +, +, +, +        @Override, +        protected int estimatedSizeInBytes() {, +            return (uid().field().length() + uid().text().length()) * 2 + 20;, +        }, +, +++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +        public enum Origin {, +            PEER_RECOVERY,, +            LOCAL_TRANSLOG_RECOVERY;, +, +            public boolean isRecovery() {, +                return this == PEER_RECOVERY || this == LOCAL_TRANSLOG_RECOVERY;, +            }, +        public int sizeInBytes() {, +            if (location != null) {, +                return location.size;, +            } else {, +                return estimatedSizeInBytes();, +            }, +        }, +, +        protected abstract int estimatedSizeInBytes();, +, +, +        @Override, +        protected int estimatedSizeInBytes() {, +            return (id().length() + type().length()) * 2 + source().length() + 12;, +        }, +, +, +, +        @Override, +        protected int estimatedSizeInBytes() {, +            return (uid().field().length() + uid().text().length()) * 2 + 20;, +        }, +, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +            if (index.origin().isRecovery()) {, +                if (!index.origin().isRecovery()) {, +            if (index.origin() != Operation.Origin.LOCAL_TRANSLOG_RECOVERY) {, +                final Translog.Location translogLocation = translog.add(new Translog.Index(index));, +                versionMap.putUnderLock(index.uid().bytes(), new VersionValue(updatedVersion, index.getTranslogLocation()));, +            }, +, +                if (delete.origin().isRecovery()) {, +, +            if (delete.origin() != Operation.Origin.LOCAL_TRANSLOG_RECOVERY) {, +                final Translog.Location translogLocation = translog.add(new Translog.Delete(delete));, +                versionMap.putUnderLock(delete.uid().bytes(), new DeleteVersionValue(updatedVersion, engineConfig.getThreadPool().estimatedTimeInMillis(), delete.getTranslogLocation()));, +            }, +++ b/core/src/main/java/org/elasticsearch/index/engine/Engine.java, +        public enum Origin {, +            PEER_RECOVERY,, +            LOCAL_TRANSLOG_RECOVERY;, +, +            public boolean isRecovery() {, +                return this == PEER_RECOVERY || this == LOCAL_TRANSLOG_RECOVERY;, +            }, +        public int sizeInBytes() {, +            if (location != null) {, +                return location.size;, +            } else {, +                return estimatedSizeInBytes();, +            }, +        }, +, +        protected abstract int estimatedSizeInBytes();, +, +, +        @Override, +        protected int estimatedSizeInBytes() {, +            return (id().length() + type().length()) * 2 + source().length() + 12;, +        }, +]