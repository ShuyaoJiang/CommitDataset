[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/cache/filter/support/AbstractConcurrentMapFilterCache.java, +    final ConcurrentMap<Object, ConcurrentMap<Filter, DocSet>> cache;, +        if (isCached(filterToCache)) {, +            return filterToCache;, +        }, +        return new FilterCacheFilterWrapper(filterToCache, this);, +    static class FilterCacheFilterWrapper extends Filter {, +        private final AbstractConcurrentMapFilterCache cache;, +, +        FilterCacheFilterWrapper(Filter filter, AbstractConcurrentMapFilterCache cache) {, +            this.cache = cache;, +            ConcurrentMap<Filter, DocSet> cachedFilters = cache.cache.get(reader.getFieldCacheKey());, +                cachedFilters = cache.buildFilterMap();, +                cache.cache.putIfAbsent(reader.getFieldCacheKey(), cachedFilters);]