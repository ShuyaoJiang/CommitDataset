[+++ b/Vagrantfile, +define_opts = {, +  autostart: false, +}.freeze, +, +, +  config.vm.provider 'virtualbox' do |vbox|, +    # Give the box more memory and cpu because our tests are beasts!, +    vbox.memory = Integer(ENV['VAGRANT_MEMORY'] || 8192), +    vbox.cpus = Integer(ENV['VAGRANT_CPUS'] || 4), +, +  # Switch the default share for the project root from /vagrant to, +  # /elasticsearch because /vagrant is confusing when there is a project inside, +  # the elasticsearch project called vagrant...., +  config.vm.synced_folder '.', '/vagrant', disabled: true, +  config.vm.synced_folder '.', '/elasticsearch', +, +  # Expose project directory. Note that VAGRANT_CWD may not be the same as Dir.pwd, +  PROJECT_DIR = ENV['VAGRANT_PROJECT_DIR'] || Dir.pwd, +  config.vm.synced_folder PROJECT_DIR, '/project', +, +  'ubuntu-1404'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/ubuntu-14.04-x86_64', +      deb_common config, box, +    end, +  end, +  'ubuntu-1604'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/ubuntu-16.04-x86_64', +      deb_common config, box, extra: <<-SHELL, +  end, +  'debian-8'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/debian-8-x86_64', +      deb_common config, box, +  'debian-9'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/debian-9-x86_64', +      deb_common config, box, +  'centos-6'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/centos-6-x86_64', +      rpm_common config, box, +  'centos-7'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/centos-7-x86_64', +      rpm_common config, box, +  'oel-6'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/oraclelinux-6-x86_64', +      rpm_common config, box, +  'oel-7'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/oraclelinux-7-x86_64', +      rpm_common config, box, +  end, +  'fedora-26'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/fedora-26-x86_64', +      dnf_common config, box, +    end, +  end, +  'fedora-27'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/fedora-27-x86_64', +      dnf_common config, box, +    end, +  end, +  'opensuse-42'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/opensuse-42-x86_64', +      suse_common config, box, +    end, +  end, +  'sles-12'.tap do |box|, +    config.vm.define box, define_opts do |config|, +      config.vm.box = 'elastic/sles-12-x86_64', +      sles_common config, box, +    end, +  end, +end, +, +def deb_common(config, name, extra: ''), +  # http://foo-o-rama.com/vagrant--stdin-is-not-a-tty--fix.html, +  config.vm.provision 'fix-no-tty', type: 'shell' do |s|, +      s.privileged = false, +      s.inline = "sudo sed -i '/tty/!s/mesg n/tty -s \\&\\& mesg n/' /root/.profile", +  end, +  linux_common(, +    config,, +    name,, +    update_command: 'apt-get update',, +    update_tracking_file: '/var/cache/apt/archives/last_update',, +    install_command: 'apt-get install -y',, +    extra: extra, +  ), +end, +, +def rpm_common(config, name)]