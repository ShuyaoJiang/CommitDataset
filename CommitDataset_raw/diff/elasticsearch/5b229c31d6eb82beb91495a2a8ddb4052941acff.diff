[+++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +            // lets do a refresh to make sure we shrink the version map. This refresh will be either a no-op (just shrink the version map), +            // or we also have uncommitted changes and that causes this syncFlush to fail., +            refresh("sync_flush", SearcherScope.INTERNAL);, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +            // lets do a refresh to make sure we shrink the version map. This refresh will be either a no-op (just shrink the version map), +            // or we also have uncommitted changes and that causes this syncFlush to fail., +            refresh("sync_flush", SearcherScope.INTERNAL);, +++ b/core/src/main/java/org/elasticsearch/index/engine/LiveVersionMap.java, +++ b/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java, +            // lets do a refresh to make sure we shrink the version map. This refresh will be either a no-op (just shrink the version map), +            // or we also have uncommitted changes and that causes this syncFlush to fail., +            refresh("sync_flush", SearcherScope.INTERNAL);, +++ b/core/src/main/java/org/elasticsearch/index/engine/LiveVersionMap.java, +++ b/core/src/test/java/org/elasticsearch/index/engine/LiveVersionMapTests.java]