[+++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ b/build.gradle, +description = 'Builds the Prelert Engine native binaries and Java classes', +, +import org.gradle.internal.os.OperatingSystem, +import org.gradle.plugins.ide.eclipse.model.SourceFolder, +configurations.all {, +    // check for updates every build, +    resolutionStrategy.cacheChangingModulesFor 0, 'seconds', +}, +, +buildscript {, +    repositories {, +        if (System.getProperty("repos.mavenlocal") != null) {, +            // with -Drepos.mavenlocal=true we can force checking the local .m2 repo which is useful for building against, +            // elasticsearch snapshots, +            mavenLocal(), +        }, +        mavenCentral(), +        maven {, +            name 'sonatype-snapshots', +            url "https://oss.sonatype.org/content/repositories/snapshots/", +        }, +        jcenter(), +    }, +    dependencies {, +        classpath group: 'org.elasticsearch.gradle', name: 'build-tools', version: "${elasticsearchVersion}", changing: true, +    }, +boolean isLinux = OperatingSystem.current().isLinux(), +boolean isMacOsX = OperatingSystem.current().isMacOsX(), +boolean isWindows = OperatingSystem.current().isWindows(), +, +project.ext.bash = isWindows ? "C:\\Program Files\\Git\\bin\\bash" : "/bin/bash", +project.ext.make = (isMacOsX || isWindows) ? "gnumake" : (isLinux ? "make" : "gmake"), +project.ext.numCpus = Runtime.runtime.availableProcessors(), +, +task cppClean(type: Exec) {, +    commandLine bash, +    args '-c', 'source cpp/set_env.sh && rm -rf cppdistribution && ' + make + ' clean', +task cppObjCompile(type: Exec) {, +    commandLine bash, +    args '-c', 'source cpp/set_env.sh && ' + make + ' -j' + numCpus + ' objcompile', +task cppMake(type: Exec) {, +    commandLine bash, +    args '-c', 'source cpp/set_env.sh && ' + make + ' -j' + numCpus, +task cppStrip(type: Exec) {, +    commandLine bash, +    args '-c', 'source cpp/set_env.sh && cpp/strip_binaries.sh', +task cppTest(type: Exec) {, +    commandLine bash, +    args '-c', 'source cpp/set_env.sh && ' + make + ' -j' + numCpus + ' test', +}, +, +task cppAll {, +    dependsOn 'cppObjCompile', +    dependsOn 'cppMake', +    dependsOn 'cppStrip', +    dependsOn 'cppTest', +    tasks.findByName('cppMake').mustRunAfter 'cppObjCompile', +    tasks.findByName('cppStrip').mustRunAfter 'cppMake', +    tasks.findByName('cppTest').mustRunAfter 'cppStrip', +}, +, +    apply plugin: 'eclipse', +    apply plugin: 'idea', +    apply plugin: 'maven', +    , +    buildscript {, +        repositories {, +            if (System.getProperty("repos.mavenlocal") != null) {, +                // with -Drepos.mavenlocal=true we can force checking the local .m2 repo which is useful for building against, +                // elasticsearch snapshots, +                mavenLocal(), +            }, +            mavenCentral(), +            maven {, +                name 'sonatype-snapshots', +                url "https://oss.sonatype.org/content/repositories/snapshots/", +            }, +            jcenter(), +        }, +    }, +, +    group = 'org.elasticsearch.prelert', +, +    repositories {, +        if (System.getProperty("repos.mavenlocal") != null) {]