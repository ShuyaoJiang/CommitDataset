[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                setup = configureCopyPluginsTask(taskName(prefix, node, 'copyPlugins'), project, setup, node, prefix), +            setup = configureInstallPluginTask(taskName(prefix, node, actionName), project, setup, node, plugin.getValue(), prefix), +    static Task configureCopyPluginsTask(String name, Project project, Task setup, NodeInfo node, String prefix) {, +            String configurationName = "_plugin_${prefix}_${pluginProject.path}", +            String configurationName = "_plugin_bwc_${prefix}_${pluginProject.path}", +    static Task configureInstallPluginTask(String name, Project project, Task setup, NodeInfo node, Project plugin, String prefix) {, +            pluginZip = project.configurations.getByName("_plugin_bwc_${prefix}_${plugin.path}"), +            pluginZip = project.configurations.getByName("_plugin_${prefix}_${plugin.path}"), +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                setup = configureCopyPluginsTask(taskName(prefix, node, 'copyPlugins'), project, setup, node, prefix), +            setup = configureInstallPluginTask(taskName(prefix, node, actionName), project, setup, node, plugin.getValue(), prefix), +    static Task configureCopyPluginsTask(String name, Project project, Task setup, NodeInfo node, String prefix) {, +            String configurationName = "_plugin_${prefix}_${pluginProject.path}", +            String configurationName = "_plugin_bwc_${prefix}_${pluginProject.path}", +    static Task configureInstallPluginTask(String name, Project project, Task setup, NodeInfo node, Project plugin, String prefix) {, +            pluginZip = project.configurations.getByName("_plugin_bwc_${prefix}_${plugin.path}"), +            pluginZip = project.configurations.getByName("_plugin_${prefix}_${plugin.path}"), +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();, +            Map<String, Object> options = (Map<String, Object>)(Map)this.options;, +            Map<String, Object> options = (Map<String, Object>)(Map)this.options;, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                setup = configureCopyPluginsTask(taskName(prefix, node, 'copyPlugins'), project, setup, node, prefix), +            setup = configureInstallPluginTask(taskName(prefix, node, actionName), project, setup, node, plugin.getValue(), prefix), +    static Task configureCopyPluginsTask(String name, Project project, Task setup, NodeInfo node, String prefix) {, +            String configurationName = "_plugin_${prefix}_${pluginProject.path}", +            String configurationName = "_plugin_bwc_${prefix}_${pluginProject.path}", +    static Task configureInstallPluginTask(String name, Project project, Task setup, NodeInfo node, Project plugin, String prefix) {, +            pluginZip = project.configurations.getByName("_plugin_bwc_${prefix}_${plugin.path}"), +            pluginZip = project.configurations.getByName("_plugin_${prefix}_${plugin.path}"), +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();, +            Map<String, Object> options = (Map<String, Object>)(Map)this.options;, +            Map<String, Object> options = (Map<String, Object>)(Map)this.options;, +++ b/docs/reference/search.asciidoc, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                setup = configureCopyPluginsTask(taskName(prefix, node, 'copyPlugins'), project, setup, node, prefix), +            setup = configureInstallPluginTask(taskName(prefix, node, actionName), project, setup, node, plugin.getValue(), prefix), +    static Task configureCopyPluginsTask(String name, Project project, Task setup, NodeInfo node, String prefix) {, +            String configurationName = "_plugin_${prefix}_${pluginProject.path}", +            String configurationName = "_plugin_bwc_${prefix}_${pluginProject.path}", +    static Task configureInstallPluginTask(String name, Project project, Task setup, NodeInfo node, Project plugin, String prefix) {, +            pluginZip = project.configurations.getByName("_plugin_bwc_${prefix}_${plugin.path}"), +            pluginZip = project.configurations.getByName("_plugin_${prefix}_${plugin.path}"), +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();, +            Map<String, Object> options = (Map<String, Object>)(Map)this.options;, +            Map<String, Object> options = (Map<String, Object>)(Map)this.options;, +++ b/docs/reference/search.asciidoc, +++ /dev/null, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                setup = configureCopyPluginsTask(taskName(prefix, node, 'copyPlugins'), project, setup, node, prefix), +            setup = configureInstallPluginTask(taskName(prefix, node, actionName), project, setup, node, plugin.getValue(), prefix), +    static Task configureCopyPluginsTask(String name, Project project, Task setup, NodeInfo node, String prefix) {, +            String configurationName = "_plugin_${prefix}_${pluginProject.path}", +            String configurationName = "_plugin_bwc_${prefix}_${pluginProject.path}", +    static Task configureInstallPluginTask(String name, Project project, Task setup, NodeInfo node, Project plugin, String prefix) {, +            pluginZip = project.configurations.getByName("_plugin_bwc_${prefix}_${plugin.path}"), +            pluginZip = project.configurations.getByName("_plugin_${prefix}_${plugin.path}"), +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();, +            Map<String, Object> options = (Map<String, Object>)(Map)this.options;, +            Map<String, Object> options = (Map<String, Object>)(Map)this.options;, +++ b/docs/reference/search.asciidoc, +++ /dev/null, +++ /dev/null, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                setup = configureCopyPluginsTask(taskName(prefix, node, 'copyPlugins'), project, setup, node, prefix), +            setup = configureInstallPluginTask(taskName(prefix, node, actionName), project, setup, node, plugin.getValue(), prefix), +    static Task configureCopyPluginsTask(String name, Project project, Task setup, NodeInfo node, String prefix) {, +            String configurationName = "_plugin_${prefix}_${pluginProject.path}", +            String configurationName = "_plugin_bwc_${prefix}_${pluginProject.path}", +    static Task configureInstallPluginTask(String name, Project project, Task setup, NodeInfo node, Project plugin, String prefix) {, +            pluginZip = project.configurations.getByName("_plugin_bwc_${prefix}_${plugin.path}"), +            pluginZip = project.configurations.getByName("_plugin_${prefix}_${plugin.path}"), +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();, +            Map<String, Object> options = (Map<String, Object>)(Map)this.options;, +            Map<String, Object> options = (Map<String, Object>)(Map)this.options;, +++ b/docs/reference/search.asciidoc, +++ /dev/null, +++ /dev/null, +++ /dev/null, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterFormationTasks.groovy, +                setup = configureCopyPluginsTask(taskName(prefix, node, 'copyPlugins'), project, setup, node, prefix), +            setup = configureInstallPluginTask(taskName(prefix, node, actionName), project, setup, node, plugin.getValue(), prefix), +    static Task configureCopyPluginsTask(String name, Project project, Task setup, NodeInfo node, String prefix) {, +            String configurationName = "_plugin_${prefix}_${pluginProject.path}", +            String configurationName = "_plugin_bwc_${prefix}_${pluginProject.path}", +    static Task configureInstallPluginTask(String name, Project project, Task setup, NodeInfo node, Project plugin, String prefix) {, +            pluginZip = project.configurations.getByName("_plugin_bwc_${prefix}_${plugin.path}"), +            pluginZip = project.configurations.getByName("_plugin_${prefix}_${plugin.path}"), +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map<String, String>)(Map)in.readMap();]