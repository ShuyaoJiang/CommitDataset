[+++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java, +            if (query instanceof FunctionScoreQuery) {, +                query = ((FunctionScoreQuery) query).getSubQuery();, +                extract(query, 1F, terms);, +            } else if (query instanceof FiltersFunctionScoreQuery) {, +, +            super.extract(query, boost, terms);, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java, +            if (query instanceof FunctionScoreQuery) {, +                query = ((FunctionScoreQuery) query).getSubQuery();, +                extract(query, 1F, terms);, +            } else if (query instanceof FiltersFunctionScoreQuery) {, +, +            super.extract(query, boost, terms);, +++ b/core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java, +++ b/core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java, +            if (query instanceof FunctionScoreQuery) {, +                query = ((FunctionScoreQuery) query).getSubQuery();, +                extract(query, 1F, terms);, +            } else if (query instanceof FiltersFunctionScoreQuery) {, +, +            super.extract(query, boost, terms);, +++ b/core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java, +++ b/docs/reference/search/search-template.asciidoc, +The `{{#toJson}}parameter{{/toJson}}` function can be used to convert parameters]