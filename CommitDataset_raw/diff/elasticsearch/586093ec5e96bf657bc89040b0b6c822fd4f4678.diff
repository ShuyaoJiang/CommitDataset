[+++ b/server/src/main/java/org/elasticsearch/search/query/TopDocsCollectorContext.java, +import org.apache.lucene.search.TopFieldDocs;, +        private final Collector collector;, +        private final Supplier<TotalHits> totalHitsSupplier;, +        private final Supplier<TopDocs> topDocsSupplier;, +        private final Supplier<Float> maxScoreSupplier;, +        TopDocsAndMaxScore newTopDocs() {, +            TopDocs in = topDocsSupplier.get();, +            float maxScore = maxScoreSupplier.get();, +            final TopDocs newTopDocs;, +            if (in instanceof TopFieldDocs) {, +                TopFieldDocs fieldDocs = (TopFieldDocs) in;, +                newTopDocs = new TopFieldDocs(totalHitsSupplier.get(), fieldDocs.scoreDocs, fieldDocs.fields);, +            } else {, +                newTopDocs = new TopDocs(totalHitsSupplier.get(), in.scoreDocs);, +            }, +            return new TopDocsAndMaxScore(newTopDocs, maxScore);, +        }, +, +            final TopDocsAndMaxScore topDocs = newTopDocs();, +            result.topDocs(topDocs, sortAndFormats == null ? null : sortAndFormats.formats);, +            final TopDocsAndMaxScore topDocs = newTopDocs();, +                scrollContext.totalHits = topDocs.topDocs.totalHits;, +                scrollContext.maxScore = topDocs.maxScore;, +                topDocs.topDocs.totalHits = scrollContext.totalHits;, +                topDocs.maxScore = scrollContext.maxScore;, +                if (topDocs.topDocs.scoreDocs.length > 0) {, +                    scrollContext.lastEmittedDoc = topDocs.topDocs.scoreDocs[topDocs.topDocs.scoreDocs.length - 1];, +            result.topDocs(topDocs, sortAndFormats == null ? null : sortAndFormats.formats);]