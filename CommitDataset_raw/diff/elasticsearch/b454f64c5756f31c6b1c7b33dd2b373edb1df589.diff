[+++ b/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +                                    if (request != null && setResponseFailureIfIndexMatches(responses, i, request, index, e)) {, +++ b/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java, +                                    if (request != null && setResponseFailureIfIndexMatches(responses, i, request, index, e)) {, +++ b/src/test/java/org/elasticsearch/document/BulkTests.java, +import java.util.ArrayList;, +        ArrayList<String> badIndexNames = new ArrayList<>();, +        for (int i = randomIntBetween(1, 5); i > 0; i--) {, +            badIndexNames.add("INVALID.NAME" + i);, +        }, +            String name;, +            if (expectedFailures[i]) {, +                name = randomFrom(badIndexNames);, +            } else {, +                name = "test";, +            }, +            builder.add(client().prepareIndex().setIndex(name).setType("type1").setId("1").setSource("field", 1));]