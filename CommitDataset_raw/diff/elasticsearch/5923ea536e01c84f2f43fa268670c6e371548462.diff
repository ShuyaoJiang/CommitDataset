[+++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java, +import org.elasticsearch.index.IndexSettings;, +                settingsBuilder.put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true);, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java, +import org.elasticsearch.index.IndexSettings;, +                settingsBuilder.put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true);, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportResumeFollowAction.java, +        if (followIndex.getSettings().getAsBoolean(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), false) == false) {, +            throw new IllegalArgumentException("follower index [" + request.getFollowerIndex() + "] does not have soft deletes enabled");, +        }, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java, +import org.elasticsearch.index.IndexSettings;, +                settingsBuilder.put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true);, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportResumeFollowAction.java, +        if (followIndex.getSettings().getAsBoolean(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), false) == false) {, +            throw new IllegalArgumentException("follower index [" + request.getFollowerIndex() + "] does not have soft deletes enabled");, +        }, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/index/engine/FollowingEngine.java, +        if (engineConfig.getIndexSettings().isSoftDeleteEnabled() == false) {, +            throw new IllegalArgumentException("a following engine requires soft deletes to be enabled");, +        }, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java, +import org.elasticsearch.index.IndexSettings;, +                settingsBuilder.put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true);, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportResumeFollowAction.java, +        if (followIndex.getSettings().getAsBoolean(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), false) == false) {, +            throw new IllegalArgumentException("follower index [" + request.getFollowerIndex() + "] does not have soft deletes enabled");, +        }, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/index/engine/FollowingEngine.java, +        if (engineConfig.getIndexSettings().isSoftDeleteEnabled() == false) {, +            throw new IllegalArgumentException("a following engine requires soft deletes to be enabled");, +        }, +++ b/x-pack/plugin/ccr/src/test/java/org/elasticsearch/xpack/ccr/action/TransportResumeFollowActionTests.java, +            // should fail because the follower index does not have soft deletes enabled, +            IndexMetaData leaderIMD = createIMD("index1", 5, Settings.builder(), +                .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), "true").build(), null);, +            IndexMetaData followIMD = createIMD("index2", 5, Settings.EMPTY, customMetaData);, +            Exception e = expectThrows(IllegalArgumentException.class, () -> validate(request, leaderIMD, followIMD, UUIDs, null));, +            assertThat(e.getMessage(), equalTo("follower index [index2] does not have soft deletes enabled"));, +        }, +        {, +            IndexMetaData followIMD = createIMD("index2", 4,, +                Settings.builder().put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), "true").build(), customMetaData);, +            IndexMetaData followIMD = createIMD("index2", State.OPEN, "{}", 5,, +                Settings.builder().put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), "true").build(), customMetaData);, +            IndexMetaData followIMD = createIMD("index2", 1,, +                Settings.builder().put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), "true").build(), customMetaData);, +                Settings.builder().put(CcrSettings.CCR_FOLLOWING_INDEX_SETTING.getKey(), true), +                    .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true).build(), customMetaData);, +                .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true), +            Settings followingIndexSettings = Settings.builder().put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true), +                .put(CcrSettings.CCR_FOLLOWING_INDEX_SETTING.getKey(), false).build();, +                .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true), +                .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true), +                .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true), +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java, +import org.elasticsearch.index.IndexSettings;, +                settingsBuilder.put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true);, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportResumeFollowAction.java, +        if (followIndex.getSettings().getAsBoolean(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), false) == false) {, +            throw new IllegalArgumentException("follower index [" + request.getFollowerIndex() + "] does not have soft deletes enabled");, +        }, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/index/engine/FollowingEngine.java, +        if (engineConfig.getIndexSettings().isSoftDeleteEnabled() == false) {, +            throw new IllegalArgumentException("a following engine requires soft deletes to be enabled");, +        }, +++ b/x-pack/plugin/ccr/src/test/java/org/elasticsearch/xpack/ccr/action/TransportResumeFollowActionTests.java, +            // should fail because the follower index does not have soft deletes enabled, +            IndexMetaData leaderIMD = createIMD("index1", 5, Settings.builder(), +                .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), "true").build(), null);, +            IndexMetaData followIMD = createIMD("index2", 5, Settings.EMPTY, customMetaData);, +            Exception e = expectThrows(IllegalArgumentException.class, () -> validate(request, leaderIMD, followIMD, UUIDs, null));, +            assertThat(e.getMessage(), equalTo("follower index [index2] does not have soft deletes enabled"));, +        }, +        {, +            IndexMetaData followIMD = createIMD("index2", 4,, +                Settings.builder().put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), "true").build(), customMetaData);, +            IndexMetaData followIMD = createIMD("index2", State.OPEN, "{}", 5,, +                Settings.builder().put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), "true").build(), customMetaData);, +            IndexMetaData followIMD = createIMD("index2", 1,, +                Settings.builder().put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), "true").build(), customMetaData);, +                Settings.builder().put(CcrSettings.CCR_FOLLOWING_INDEX_SETTING.getKey(), true), +                    .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true).build(), customMetaData);, +                .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true), +            Settings followingIndexSettings = Settings.builder().put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true), +                .put(CcrSettings.CCR_FOLLOWING_INDEX_SETTING.getKey(), false).build();, +                .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true), +                .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true), +                .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true), +++ b/x-pack/plugin/ccr/src/test/java/org/elasticsearch/xpack/ccr/action/bulk/BulkShardOperationsTests.java, +        final Settings settings = Settings.builder().put(CcrSettings.CCR_FOLLOWING_INDEX_SETTING.getKey(), true), +            .put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true).build();, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java, +import org.elasticsearch.index.IndexSettings;, +                settingsBuilder.put(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true);, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportResumeFollowAction.java, +        if (followIndex.getSettings().getAsBoolean(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), false) == false) {, +            throw new IllegalArgumentException("follower index [" + request.getFollowerIndex() + "] does not have soft deletes enabled");, +        }, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/index/engine/FollowingEngine.java]