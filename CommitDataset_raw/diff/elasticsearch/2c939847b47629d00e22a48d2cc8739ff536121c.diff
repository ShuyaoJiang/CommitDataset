[+++ b/src/main/java/org/elasticsearch/action/percolate/PercolateShardResponse.java, +        return percolatorTypeId == 0x00;, +++ b/src/main/java/org/elasticsearch/action/percolate/PercolateShardResponse.java, +        return percolatorTypeId == 0x00;, +++ b/src/main/java/org/elasticsearch/action/percolate/TransportPercolateAction.java, +                successfulShards++;, +                if (!percolateShardResponse.isEmpty()) {, +                        percolatorTypeId = percolateShardResponse.percolatorTypeId();, +                }, +        if (shardResults == null) {, +++ b/src/main/java/org/elasticsearch/action/percolate/PercolateShardResponse.java, +        return percolatorTypeId == 0x00;, +++ b/src/main/java/org/elasticsearch/action/percolate/TransportPercolateAction.java, +                successfulShards++;, +                if (!percolateShardResponse.isEmpty()) {, +                        percolatorTypeId = percolateShardResponse.percolatorTypeId();, +                }, +        if (shardResults == null) {, +++ b/src/test/java/org/elasticsearch/test/integration/percolator/RecoveryPercolatorTests.java, +                        String preference;, +                        if (node2Id == null && node3Id == null) {, +                            preference = "_local";, +                        } else {, +                            preference = "_prefer_node:" + (randomBoolean() ? node2Id : node3Id);, +                        }, +                            for (int i = 0; i < numPercolateRequest; i++) {, +                                if (randomBoolean()) {, +                                } else {, +                                    builder.add(, +                                            client.preparePercolate(), +                                                    .setPreference(preference), +                                                    .setIndices("test").setDocumentType("type"), +                                                    .setPercolateDoc(docBuilder().setDoc(doc)));, +                                }]