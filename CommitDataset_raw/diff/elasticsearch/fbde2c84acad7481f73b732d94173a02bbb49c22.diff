[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/node/restart/TransportNodesRestartAction.java, +    private volatile boolean restartRequested = false;, +, +        if (restartRequested) {, +            return new NodesRestartResponse.NodeRestartResponse(clusterService.state().nodes().localNode());, +        }, +        restartRequested = true;, +                    } finally {, +                        restartRequested = false;]