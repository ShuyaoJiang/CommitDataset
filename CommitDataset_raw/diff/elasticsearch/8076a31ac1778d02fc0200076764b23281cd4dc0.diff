[+++ b/rest-api-spec/test/search/issue4895.yaml, +---, +setup:, +  - do:, +      indices.create:, +          index:  test, +, +  - do:, +      index:, +          index:  test, +          type:   test, +          id:     1, +          body:, +              user : foo, +              amount : 35, +              data : some, +, +  - do:, +      indices.refresh:, +        index: [test], +, +---, +"Test with _local preference placed in query body - should fail":, +, +  - do:, +      catch: request, +      search:, +          index: test, +          type:  test, +          body:, +              query:, +                  term:, +                      data: some, +                  preference: _local, +              fields: [user,amount], +, +, +++ b/rest-api-spec/test/search/issue4895.yaml, +---, +setup:, +  - do:, +      indices.create:, +          index:  test, +, +  - do:, +      index:, +          index:  test, +          type:   test, +          id:     1, +          body:, +              user : foo, +              amount : 35, +              data : some, +, +  - do:, +      indices.refresh:, +        index: [test], +, +---, +"Test with _local preference placed in query body - should fail":, +, +  - do:, +      catch: request, +      search:, +          index: test, +          type:  test, +          body:, +              query:, +                  term:, +                      data: some, +                  preference: _local, +              fields: [user,amount], +, +, +++ b/src/main/java/org/elasticsearch/search/SearchService.java, +            token = parser.nextToken();, +            if (token != XContentParser.Token.START_OBJECT) {, +                throw new ElasticsearchParseException("Expected START_OBJECT but got " + token.name() + " " + parser.currentName());, +            }, +                } else {, +                    if (token == null) {, +                        throw new ElasticsearchParseException("End of query source reached but query is not complete.");, +                    } else {, +                        throw new ElasticsearchParseException("Expected field name but got " + token.name() + " \"" + parser.currentName() + "\"");, +                    }]