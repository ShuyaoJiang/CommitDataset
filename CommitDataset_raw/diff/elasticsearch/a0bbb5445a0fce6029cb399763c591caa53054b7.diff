[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/highlight/HighlightPhase.java, +import org.apache.lucene.search.vectorhighlight.CustomFieldQuery;, +import org.apache.lucene.search.vectorhighlight.FastVectorHighlighter;, +import org.apache.lucene.search.vectorhighlight.FieldQuery;, +import org.apache.lucene.search.vectorhighlight.FragListBuilder;, +import org.apache.lucene.search.vectorhighlight.FragmentsBuilder;, +import org.apache.lucene.search.vectorhighlight.ScoreOrderFragmentsBuilder;, +import org.apache.lucene.search.vectorhighlight.SimpleFragListBuilder;, +import org.apache.lucene.search.vectorhighlight.SimpleFragmentsBuilder;, +import org.apache.lucene.search.vectorhighlight.SingleFragListBuilder;, +import org.elasticsearch.index.mapper.MapperService;, +import java.util.ArrayList;, +import java.util.Collections;, +import java.util.Comparator;, +import java.util.List;, +import java.util.Map;, +                    MapperService.SmartNameFieldMappers fullMapper = context.mapperService().smartName(field.field());, +                    if (fullMapper == null || !fullMapper.hasDocMapper()) {, +                    if (!fullMapper.docMapper().type().equals(hitContext.hit().type())) {, +                        continue;, +                    }, +                    mapper = fullMapper.mapper();, +                    if (mapper == null) {, +                        continue;, +                    }, +                }]