[+++ b/core/src/test/java/org/elasticsearch/index/percolator/ExtractQueryTermsServiceTests.java, +import org.apache.lucene.index.PrefixCodedTerms;, +        TermsQuery query = (TermsQuery), +                ExtractQueryTermsService.createQueryTermsQuery(indexReader, QUERY_TERMS_FIELD, UNKNOWN_QUERY_FIELD);, +        PrefixCodedTerms terms = query.getTermData();, +        assertThat(terms.size(), equalTo(15L));, +        PrefixCodedTerms.TermIterator termIterator = terms.iterator();, +        assertTermIterator(termIterator, "_field3\u0000me", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "_field3\u0000unhide", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field1\u0000brown", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field1\u0000dog", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field1\u0000fox", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field1\u0000jumps", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field1\u0000lazy", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field1\u0000over", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field1\u0000quick", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field1\u0000the", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field2\u0000more", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field2\u0000some", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field2\u0000text", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "field4\u0000123", QUERY_TERMS_FIELD);, +        assertTermIterator(termIterator, "", UNKNOWN_QUERY_FIELD);, +    private void assertTermIterator(PrefixCodedTerms.TermIterator termIterator, String expectedValue, String expectedField) {, +        assertThat(termIterator.next().utf8ToString(), equalTo(expectedValue));, +        assertThat(termIterator.field(), equalTo(expectedField));]