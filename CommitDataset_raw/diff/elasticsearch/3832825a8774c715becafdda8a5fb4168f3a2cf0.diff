[+++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java, +import java.util.HashSet;, +import java.util.function.Supplier;, +    /** Creates a DiscoveryNode representing the local node. */, +    public static DiscoveryNode createLocal(Settings settings, TransportAddress publishAddress, String nodeIdSupplier) {, +        Map<String, String> attributes = new HashMap<>(Node.NODE_ATTRIBUTES.get(settings).getAsMap());, +        Set<DiscoveryNode.Role> roles = new HashSet<>();, +        if (Node.NODE_INGEST_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.INGEST);, +        }, +        if (Node.NODE_MASTER_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.MASTER);, +        }, +        if (Node.NODE_DATA_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.DATA);, +        }, +, +        return new DiscoveryNode(Node.NODE_NAME_SETTING.get(settings), nodeIdSupplier, publishAddress,, +                                 attributes, roles, Version.CURRENT);, +    }, +, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java, +import java.util.HashSet;, +import java.util.function.Supplier;, +    /** Creates a DiscoveryNode representing the local node. */, +    public static DiscoveryNode createLocal(Settings settings, TransportAddress publishAddress, String nodeIdSupplier) {, +        Map<String, String> attributes = new HashMap<>(Node.NODE_ATTRIBUTES.get(settings).getAsMap());, +        Set<DiscoveryNode.Role> roles = new HashSet<>();, +        if (Node.NODE_INGEST_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.INGEST);, +        }, +        if (Node.NODE_MASTER_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.MASTER);, +        }, +        if (Node.NODE_DATA_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.DATA);, +        }, +, +        return new DiscoveryNode(Node.NODE_NAME_SETTING.get(settings), nodeIdSupplier, publishAddress,, +                                 attributes, roles, Version.CURRENT);, +    }, +, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java, +import java.util.HashSet;, +import java.util.function.Supplier;, +    /** Creates a DiscoveryNode representing the local node. */, +    public static DiscoveryNode createLocal(Settings settings, TransportAddress publishAddress, String nodeIdSupplier) {, +        Map<String, String> attributes = new HashMap<>(Node.NODE_ATTRIBUTES.get(settings).getAsMap());, +        Set<DiscoveryNode.Role> roles = new HashSet<>();, +        if (Node.NODE_INGEST_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.INGEST);, +        }, +        if (Node.NODE_MASTER_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.MASTER);, +        }, +        if (Node.NODE_DATA_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.DATA);, +        }, +, +        return new DiscoveryNode(Node.NODE_NAME_SETTING.get(settings), nodeIdSupplier, publishAddress,, +                                 attributes, roles, Version.CURRENT);, +    }, +, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/node/Node.java, +        DiscoveryNode localNode = DiscoveryNode.createLocal(settings,, +            transportService.boundAddress().publishAddress(), injector.getInstance(NodeEnvironment.class).nodeId());, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java, +++ b/core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java, +import java.util.HashSet;, +import java.util.function.Supplier;, +    /** Creates a DiscoveryNode representing the local node. */, +    public static DiscoveryNode createLocal(Settings settings, TransportAddress publishAddress, String nodeIdSupplier) {, +        Map<String, String> attributes = new HashMap<>(Node.NODE_ATTRIBUTES.get(settings).getAsMap());, +        Set<DiscoveryNode.Role> roles = new HashSet<>();, +        if (Node.NODE_INGEST_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.INGEST);, +        }, +        if (Node.NODE_MASTER_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.MASTER);, +        }, +        if (Node.NODE_DATA_SETTING.get(settings)) {, +            roles.add(DiscoveryNode.Role.DATA);, +        }, +, +        return new DiscoveryNode(Node.NODE_NAME_SETTING.get(settings), nodeIdSupplier, publishAddress,, +                                 attributes, roles, Version.CURRENT);, +    }, +, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/node/Node.java, +        DiscoveryNode localNode = DiscoveryNode.createLocal(settings,, +            transportService.boundAddress().publishAddress(), injector.getInstance(NodeEnvironment.class).nodeId());, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/cluster/ClusterModule.java]