[+++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/AutoFollowCoordinator.java, +import org.elasticsearch.xpack.ccr.Ccr;, +                        final List<Index> leaderIndicesToFollow = getLeaderIndicesToFollow(clusterAlias, autoFollowPattern,, +                            leaderClusterState, followerClusterState, followedIndices);, +        static List<Index> getLeaderIndicesToFollow(String clusterAlias,, +                                                    AutoFollowPattern autoFollowPattern,, +                // If an auto follow pattern has been set up for the local cluster then, +                // we should not automatically follow a leader index that is also a follow index because, +                // this can result into an index creation explosion., +                if (leaderIndexMetaData.getCustomData(Ccr.CCR_CUSTOM_METADATA_KEY) != null &&, +                    clusterAlias.equals("_local_")) {, +                    continue;, +                }, +, +++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/AutoFollowCoordinator.java, +import org.elasticsearch.xpack.ccr.Ccr;, +                        final List<Index> leaderIndicesToFollow = getLeaderIndicesToFollow(clusterAlias, autoFollowPattern,, +                            leaderClusterState, followerClusterState, followedIndices);, +        static List<Index> getLeaderIndicesToFollow(String clusterAlias,, +                                                    AutoFollowPattern autoFollowPattern,, +                // If an auto follow pattern has been set up for the local cluster then, +                // we should not automatically follow a leader index that is also a follow index because, +                // this can result into an index creation explosion., +                if (leaderIndexMetaData.getCustomData(Ccr.CCR_CUSTOM_METADATA_KEY) != null &&, +                    clusterAlias.equals("_local_")) {, +                    continue;, +                }, +, +++ b/x-pack/plugin/ccr/src/test/java/org/elasticsearch/xpack/ccr/action/AutoFollowCoordinatorTests.java, +import org.elasticsearch.xpack.ccr.Ccr;, +        List<Index> result = AutoFollower.getLeaderIndicesToFollow("remote", autoFollowPattern, leaderState, followerState,, +            Collections.emptyList());, +        result = AutoFollower.getLeaderIndicesToFollow("remote", autoFollowPattern, leaderState, followerState, followedIndexUUIDs);, +    public void testGetLeaderIndicesToFollowDoNotSelectFollowIndicesInTheSameCluster() {, +        MetaData.Builder imdBuilder = MetaData.builder();, +        imdBuilder.put(IndexMetaData.builder("metrics-0"), +            .settings(settings(Version.CURRENT)), +            .numberOfShards(1), +            .numberOfReplicas(0));, +        imdBuilder.put(IndexMetaData.builder("metrics-1"), +            .putCustom(Ccr.CCR_CUSTOM_METADATA_KEY, new HashMap<>()), +            .settings(settings(Version.CURRENT)), +            .numberOfShards(1), +            .numberOfReplicas(0));, +, +        AutoFollowPattern autoFollowPattern =, +            new AutoFollowPattern(Collections.singletonList("metrics-*"), null, null, null, null, null, null, null, null);, +        imdBuilder.putCustom(AutoFollowMetadata.TYPE, new AutoFollowMetadata(Collections.singletonMap("remote", autoFollowPattern),, +            Collections.emptyMap(), Collections.emptyMap()));, +, +        ClusterState clusterState = ClusterState.builder(new ClusterName("name")), +            .metaData(imdBuilder), +            .build();, +, +        List<Index> result = AutoFollower.getLeaderIndicesToFollow("_local_", autoFollowPattern, clusterState,, +            clusterState, Collections.emptyList());, +        result.sort(Comparator.comparing(Index::getName));, +        assertThat(result.size(), equalTo(1));, +        assertThat(result.get(0).getName(), equalTo("metrics-0"));, +    }, +]