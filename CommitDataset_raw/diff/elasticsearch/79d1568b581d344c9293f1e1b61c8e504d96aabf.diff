[+++ b/core/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            assert sharedDataPath != null;, +++ b/core/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            assert sharedDataPath != null;, +++ b/core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java, +++ b/core/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            assert sharedDataPath != null;, +++ b/core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java, +++ b/core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java, +++ b/core/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            assert sharedDataPath != null;, +++ b/core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java, +++ b/core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java, +++ b/core/src/test/java/org/elasticsearch/indices/IndicesCustomDataPathIT.java, +++ b/core/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            assert sharedDataPath != null;, +++ b/core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java, +++ b/core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java, +++ b/core/src/test/java/org/elasticsearch/indices/IndicesCustomDataPathIT.java, +++ b/core/src/test/java/org/elasticsearch/test/ESIntegTestCase.java, +++ b/core/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            assert sharedDataPath != null;, +++ b/core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java, +++ b/core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java, +++ b/core/src/test/java/org/elasticsearch/indices/IndicesCustomDataPathIT.java, +++ b/core/src/test/java/org/elasticsearch/test/ESIntegTestCase.java, +++ b/core/src/test/java/org/elasticsearch/test/ESSingleNodeTestCase.java, +++ b/core/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            assert sharedDataPath != null;, +++ b/core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java, +++ b/core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java, +++ b/core/src/test/java/org/elasticsearch/indices/IndicesCustomDataPathIT.java, +++ b/core/src/test/java/org/elasticsearch/test/ESIntegTestCase.java, +++ b/core/src/test/java/org/elasticsearch/test/ESSingleNodeTestCase.java, +++ b/core/src/test/java/org/elasticsearch/test/InternalTestCluster.java, +++ b/core/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            assert sharedDataPath != null;, +++ b/core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java, +++ b/core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java, +++ b/core/src/test/java/org/elasticsearch/indices/IndicesCustomDataPathIT.java, +++ b/core/src/test/java/org/elasticsearch/test/ESIntegTestCase.java, +++ b/core/src/test/java/org/elasticsearch/test/ESSingleNodeTestCase.java, +++ b/core/src/test/java/org/elasticsearch/test/InternalTestCluster.java, +++ b/docs/reference/indices/shadow-replicas.asciidoc, +settings, you need to allow Elasticsearch to use the same data directory for, +multiple instances by setting `node.add_id_to_custom_path` to false in, +elasticsearch.yml:, +++ b/core/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            assert sharedDataPath != null;, +++ b/core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java, +++ b/core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java, +++ b/core/src/test/java/org/elasticsearch/indices/IndicesCustomDataPathIT.java, +++ b/core/src/test/java/org/elasticsearch/test/ESIntegTestCase.java, +++ b/core/src/test/java/org/elasticsearch/test/ESSingleNodeTestCase.java, +++ b/core/src/test/java/org/elasticsearch/test/InternalTestCluster.java, +++ b/docs/reference/indices/shadow-replicas.asciidoc, +settings, you need to allow Elasticsearch to use the same data directory for, +multiple instances by setting `node.add_id_to_custom_path` to false in, +elasticsearch.yml:, +++ b/docs/reference/indices/shard-stores.asciidoc, +++ b/core/src/main/java/org/elasticsearch/env/NodeEnvironment.java, +            assert sharedDataPath != null;, +++ b/core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java, +++ b/core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java, +++ b/core/src/test/java/org/elasticsearch/indices/IndicesCustomDataPathIT.java, +++ b/core/src/test/java/org/elasticsearch/test/ESIntegTestCase.java, +++ b/core/src/test/java/org/elasticsearch/test/ESSingleNodeTestCase.java, +++ b/core/src/test/java/org/elasticsearch/test/InternalTestCluster.java, +++ b/docs/reference/indices/shadow-replicas.asciidoc, +settings, you need to allow Elasticsearch to use the same data directory for, +multiple instances by setting `node.add_id_to_custom_path` to false in, +elasticsearch.yml:, +++ b/docs/reference/indices/shard-stores.asciidoc, +++ b/docs/reference/migration/migrate_2_0.asciidoc, +, +=== Shadow replicas, +, +The `node.enable_custom_paths` setting has been removed and replaced by the, +`path.shared_data` setting to allow shadow replicas with custom paths to work, +with the security manager. For example, if your previous configuration had:, +, +```, +node.enable_custom_paths: true, +```, +, +And you created an index using shadow replicas with `index.data_path` set to, +`/opt/data/my_index` with the following:, +, +[source,js], +--------------------------------------------------, +curl -XPUT 'localhost:9200/my_index' -d ', +{, +    "index" : {, +        "number_of_shards" : 1,, +        "number_of_replicas" : 4,, +        "data_path": "/opt/data/my_index",, +        "shadow_replicas": true, +    }, +}', +--------------------------------------------------]