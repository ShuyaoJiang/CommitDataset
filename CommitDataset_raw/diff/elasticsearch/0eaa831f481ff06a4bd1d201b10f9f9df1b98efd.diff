[+++ b/distribution/build.gradle, +    into('/etc/elasticsearch') {, +      fileType CONFIG | NOREPLACE, +      from "${packagingFiles}/etc/elasticsearch", +      fileType CONFIG | NOREPLACE, +      fileType CONFIG | NOREPLACE, +      fileType CONFIG | NOREPLACE, +      from "${packagingFiles}/init.d/elasticsearch", +      fileType CONFIG | NOREPLACE, +      from "${project.packagingFiles}/env/elasticsearch", +++ b/distribution/build.gradle, +    into('/etc/elasticsearch') {, +      fileType CONFIG | NOREPLACE, +      from "${packagingFiles}/etc/elasticsearch", +      fileType CONFIG | NOREPLACE, +      fileType CONFIG | NOREPLACE, +      fileType CONFIG | NOREPLACE, +      from "${packagingFiles}/init.d/elasticsearch", +      fileType CONFIG | NOREPLACE, +      from "${project.packagingFiles}/env/elasticsearch", +++ b/distribution/src/main/packaging/scripts/postrm, +CONF_DIR="/etc/elasticsearch", +, +    # delete the conf directory if and only if empty, +    if [ -d "$CONF_DIR" ]; then, +        rmdir --ignore-fail-on-non-empty "$CONF_DIR", +    fi, +, +++ b/distribution/build.gradle, +    into('/etc/elasticsearch') {, +      fileType CONFIG | NOREPLACE, +      from "${packagingFiles}/etc/elasticsearch", +      fileType CONFIG | NOREPLACE, +      fileType CONFIG | NOREPLACE, +      fileType CONFIG | NOREPLACE, +      from "${packagingFiles}/init.d/elasticsearch", +      fileType CONFIG | NOREPLACE, +      from "${project.packagingFiles}/env/elasticsearch", +++ b/distribution/src/main/packaging/scripts/postrm, +CONF_DIR="/etc/elasticsearch", +, +    # delete the conf directory if and only if empty, +    if [ -d "$CONF_DIR" ]; then, +        rmdir --ignore-fail-on-non-empty "$CONF_DIR", +    fi, +, +++ b/distribution/src/main/packaging/scripts/prerm, +SCRIPTS_DIR="/etc/elasticsearch/scripts", +# delete the scripts directory if and only if empty, +if [ -d "$SCRIPTS_DIR" ]; then, +    rmdir --ignore-fail-on-non-empty "$SCRIPTS_DIR", +fi, +, +++ b/distribution/build.gradle, +    into('/etc/elasticsearch') {, +      fileType CONFIG | NOREPLACE, +      from "${packagingFiles}/etc/elasticsearch", +      fileType CONFIG | NOREPLACE, +      fileType CONFIG | NOREPLACE, +      fileType CONFIG | NOREPLACE, +      from "${packagingFiles}/init.d/elasticsearch", +      fileType CONFIG | NOREPLACE, +      from "${project.packagingFiles}/env/elasticsearch", +++ b/distribution/src/main/packaging/scripts/postrm, +CONF_DIR="/etc/elasticsearch", +, +    # delete the conf directory if and only if empty, +    if [ -d "$CONF_DIR" ]; then, +        rmdir --ignore-fail-on-non-empty "$CONF_DIR", +    fi, +, +++ b/distribution/src/main/packaging/scripts/prerm, +SCRIPTS_DIR="/etc/elasticsearch/scripts", +# delete the scripts directory if and only if empty, +if [ -d "$SCRIPTS_DIR" ]; then, +    rmdir --ignore-fail-on-non-empty "$SCRIPTS_DIR", +fi, +, +++ b/qa/vagrant/src/test/resources/packaging/scripts/40_rpm_package.bats, +@test "[RPM] reremove package" {, +    echo "# ping" >> "/etc/elasticsearch/elasticsearch.yml", +    echo "# ping" >> "/etc/elasticsearch/jvm.options", +    echo "# ping" >> "/etc/elasticsearch/logging.yml", +    echo "# ping" >> "/etc/elasticsearch/scripts/script", +    rpm -e 'elasticsearch', +@test "[RPM] verify preservation" {, +    # The removal must disable the service, +    # see prerm file, +    if is_systemd; then, +        run systemctl is-enabled elasticsearch.service, +        [ "$status" -eq 1 ], +    fi, +, +    # Those directories are deleted when removing the package, +    # see postrm file, +    assert_file_not_exist "/var/log/elasticsearch", +    assert_file_not_exist "/usr/share/elasticsearch/plugins", +    assert_file_not_exist "/var/run/elasticsearch", +, +    assert_file_not_exist "/etc/elasticsearch/elasticsearch.yml"]