[+++ b/src/test/java/org/elasticsearch/test/integration/search/basic/SearchWhileCreatingIndexTests.java, +import org.elasticsearch.action.admin.indices.refresh.RefreshResponse;, +import java.util.Arrays;, +, +import static org.elasticsearch.common.settings.ImmutableSettings.settingsBuilder;, +import static org.hamcrest.Matchers.equalTo;, +import static org.hamcrest.Matchers.greaterThanOrEqualTo;, +            prepareCreate("test").setSettings(settingsBuilder().put("index.number_of_shards", 10));, +            client().prepareIndex("test", "type1", "id:" + i).setSource("field", "test").execute().actionGet();, +            RefreshResponse refreshResponse = client().admin().indices().prepareRefresh("test").execute().actionGet();, +            assertThat(refreshResponse.getSuccessfulShards(), greaterThanOrEqualTo(1)); // at least one shard should be successful when refreshing, +            assertThat("found unexpected number of hits, shard_failures (we expected to potentially non active ones!):" + Arrays.toString(searchResponse.getShardFailures()) + " id: " + i, searchResponse.getHits().totalHits(), equalTo(1l));]