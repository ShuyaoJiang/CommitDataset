[+++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                                           org.elasticsearch.env.ShardLockObtainFailedException::new, 147, Version.V_5_0_2);, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                                           org.elasticsearch.env.ShardLockObtainFailedException::new, 147, Version.V_5_0_2);, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchParseException.java, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                                           org.elasticsearch.env.ShardLockObtainFailedException::new, 147, Version.V_5_0_2);, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchParseException.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +        final ClusterStateObserver observer = new ClusterStateObserver(clusterService, logger, threadPool.getThreadContext());, +        final ClusterState state = observer.observedState();, +                final ClusterState clusterState = clusterService.state();, +                final ClusterHealthResponse response = getResponse(request, clusterState, concreteWaitFor, true);, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                                           org.elasticsearch.env.ShardLockObtainFailedException::new, 147, Version.V_5_0_2);, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchParseException.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +        final ClusterStateObserver observer = new ClusterStateObserver(clusterService, logger, threadPool.getThreadContext());, +        final ClusterState state = observer.observedState();, +                final ClusterState clusterState = clusterService.state();, +                final ClusterHealthResponse response = getResponse(request, clusterState, concreteWaitFor, true);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java, +            IndexNameExpressionResolver indexNameExpressionResolver, ClusterService clusterService, Client client) {, +        try (XContentParser parser = XContentHelper.createParser(response.getSourceAsBytesRef())) {, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                                           org.elasticsearch.env.ShardLockObtainFailedException::new, 147, Version.V_5_0_2);, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchParseException.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +        final ClusterStateObserver observer = new ClusterStateObserver(clusterService, logger, threadPool.getThreadContext());, +        final ClusterState state = observer.observedState();, +                final ClusterState clusterState = clusterService.state();, +                final ClusterHealthResponse response = getResponse(request, clusterState, concreteWaitFor, true);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java, +            IndexNameExpressionResolver indexNameExpressionResolver, ClusterService clusterService, Client client) {, +        try (XContentParser parser = XContentHelper.createParser(response.getSourceAsBytesRef())) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +        try (XContentParser parser = XContentHelper.createParser(source)) {, +            try (XContentParser parser = XContentFactory.xContent(xContentType).createParser(source)) {, +                source(parser.map());, +            } catch (IOException e) {, +                throw new ElasticsearchParseException("failed to parse source for create index", e);, +            }, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                                           org.elasticsearch.env.ShardLockObtainFailedException::new, 147, Version.V_5_0_2);, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchParseException.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +        final ClusterStateObserver observer = new ClusterStateObserver(clusterService, logger, threadPool.getThreadContext());, +        final ClusterState state = observer.observedState();, +                final ClusterState clusterState = clusterService.state();, +                final ClusterHealthResponse response = getResponse(request, clusterState, concreteWaitFor, true);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java, +            IndexNameExpressionResolver indexNameExpressionResolver, ClusterService clusterService, Client client) {, +        try (XContentParser parser = XContentHelper.createParser(response.getSourceAsBytesRef())) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +        try (XContentParser parser = XContentHelper.createParser(source)) {, +            try (XContentParser parser = XContentFactory.xContent(xContentType).createParser(source)) {, +                source(parser.map());, +            } catch (IOException e) {, +                throw new ElasticsearchParseException("failed to parse source for create index", e);, +            }, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java, +        try (XContentParser parser = XContentFactory.xContent(templateSource).createParser(templateSource)) {, +            return source(parser.mapOrdered());, +        } catch (Exception e) {, +            throw new IllegalArgumentException("failed to parse template source [" + templateSource + "]", e);, +        }, +        try (XContentParser parser = XContentFactory.xContent(source, offset, length).createParser(source, offset, length)) {, +            return source(parser.mapOrdered());, +        } catch (IOException e) {, +            throw new IllegalArgumentException("failed to parse template source", e);, +        }, +        try (XContentParser parser = XContentFactory.xContent(source).createParser(source)) {, +            return source(parser.mapOrdered());, +        } catch (IOException e) {, +            throw new IllegalArgumentException("failed to parse template source", e);, +        }, +        try (XContentParser parser = XContentHelper.createParser(source)) {, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchException.java, +                                           org.elasticsearch.env.ShardLockObtainFailedException::new, 147, Version.V_5_0_2);, +++ b/core/src/main/java/org/elasticsearch/ElasticsearchParseException.java, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java, +        final ClusterStateObserver observer = new ClusterStateObserver(clusterService, logger, threadPool.getThreadContext());, +        final ClusterState state = observer.observedState();, +                final ClusterState clusterState = clusterService.state();, +                final ClusterHealthResponse response = getResponse(request, clusterState, concreteWaitFor, true);, +++ b/core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java, +            IndexNameExpressionResolver indexNameExpressionResolver, ClusterService clusterService, Client client) {, +        try (XContentParser parser = XContentHelper.createParser(response.getSourceAsBytesRef())) {, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java, +        try (XContentParser parser = XContentHelper.createParser(source)) {, +            try (XContentParser parser = XContentFactory.xContent(xContentType).createParser(source)) {, +                source(parser.map());, +            } catch (IOException e) {, +                throw new ElasticsearchParseException("failed to parse source for create index", e);, +            }, +++ b/core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java, +        try (XContentParser parser = XContentFactory.xContent(templateSource).createParser(templateSource)) {, +            return source(parser.mapOrdered());, +        } catch (Exception e) {, +            throw new IllegalArgumentException("failed to parse template source [" + templateSource + "]", e);]