[+++ b/rest-api-spec/test/cat.shards/10_basic.yaml, +, +  - do:, +      indices.create:, +        index: index3, +        body:, +          settings:, +            number_of_shards: "1", +            number_of_replicas: "1", +            shadow_replicas: true, +            shared_filesystem: false, +  - do:, +       cluster.health:, +         wait_for_status: yellow, +         wait_for_relocating_shards: 0, +, +  - do:, +      cat.shards:, +        index: index3, +        v: false, +  - match:, +      $body: |, +               /^(index3 \s+ \d \s+ (p|s) \s+ ((STARTED|INITIALIZING) \s+ (\d \s+ (\d+|\d+[.]\d+)(kb|b) \s+)? \d{1,3}.\d{1,3}.\d{1,3}.\d{1,3} \s+ .+|UNASSIGNED \s+) \n?){2}$/, +               , +++ b/rest-api-spec/test/cat.shards/10_basic.yaml, +, +  - do:, +      indices.create:, +        index: index3, +        body:, +          settings:, +            number_of_shards: "1", +            number_of_replicas: "1", +            shadow_replicas: true, +            shared_filesystem: false, +  - do:, +       cluster.health:, +         wait_for_status: yellow, +         wait_for_relocating_shards: 0, +, +  - do:, +      cat.shards:, +        index: index3, +        v: false, +  - match:, +      $body: |, +               /^(index3 \s+ \d \s+ (p|s) \s+ ((STARTED|INITIALIZING) \s+ (\d \s+ (\d+|\d+[.]\d+)(kb|b) \s+)? \d{1,3}.\d{1,3}.\d{1,3}.\d{1,3} \s+ .+|UNASSIGNED \s+) \n?){2}$/, +               , +++ b/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java, +import org.elasticsearch.cluster.metadata.IndexMetaData;, +        clusterStateRequest.clear().nodes(true).metaData(true).routingTable(true).indices(indices);, +, +            IndexMetaData indexMeta = state.getState().getMetaData().index(shard.index());, +            boolean usesShadowReplicas = false;, +            if (indexMeta != null) {, +                usesShadowReplicas = IndexMetaData.isIndexUsingShadowReplicas(indexMeta.settings());, +            }, +            if (shard.primary()) {, +                table.addCell("p");, +            } else {, +                if (usesShadowReplicas) {, +                    table.addCell("s");, +                } else {, +                    table.addCell("r");, +                }, +            }]