[+++ b/core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java, +++ b/core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java, +++ b/core/src/main/java/org/elasticsearch/common/cli/Terminal.java, +        printError("%s", t.toString());, +++ b/core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java, +++ b/core/src/main/java/org/elasticsearch/common/cli/Terminal.java, +        printError("%s", t.toString());, +++ b/core/src/test/java/org/elasticsearch/common/cli/TerminalTests.java, +import java.nio.file.NoSuchFileException;, +import java.util.List;, +, +    public void testError() throws Exception {, +        try {, +            // actually throw so we have a stacktrace, +            throw new NoSuchFileException("/path/to/some/file");, +        } catch (NoSuchFileException e) {, +            CaptureOutputTerminal terminal = new CaptureOutputTerminal(Terminal.Verbosity.NORMAL);, +            terminal.printError(e);, +            List<String> output = terminal.getTerminalOutput();, +            assertFalse(output.isEmpty());, +            assertTrue(output.get(0), output.get(0).contains("NoSuchFileException")); // exception class, +            assertTrue(output.get(0), output.get(0).contains("/path/to/some/file")); // message, +            assertEquals(1, output.size());, +, +            // TODO: we should test stack trace is printed in debug mode...except debug is a sysprop instead of, +            // a command line param...maybe it should be VERBOSE instead of a separate debug prop?, +        }, +    }, +, +        assertThat(logTerminal.getTerminalOutput(), hasItem(text));, +++ b/core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java, +++ b/core/src/main/java/org/elasticsearch/common/cli/Terminal.java, +        printError("%s", t.toString());, +++ b/core/src/test/java/org/elasticsearch/common/cli/TerminalTests.java, +import java.nio.file.NoSuchFileException;, +import java.util.List;, +, +    public void testError() throws Exception {, +        try {, +            // actually throw so we have a stacktrace, +            throw new NoSuchFileException("/path/to/some/file");, +        } catch (NoSuchFileException e) {, +            CaptureOutputTerminal terminal = new CaptureOutputTerminal(Terminal.Verbosity.NORMAL);, +            terminal.printError(e);, +            List<String> output = terminal.getTerminalOutput();, +            assertFalse(output.isEmpty());, +            assertTrue(output.get(0), output.get(0).contains("NoSuchFileException")); // exception class, +            assertTrue(output.get(0), output.get(0).contains("/path/to/some/file")); // message, +            assertEquals(1, output.size());, +, +            // TODO: we should test stack trace is printed in debug mode...except debug is a sysprop instead of, +            // a command line param...maybe it should be VERBOSE instead of a separate debug prop?, +        }, +    }, +, +        assertThat(logTerminal.getTerminalOutput(), hasItem(text));, +++ b/docs/reference/modules/scripting.asciidoc]