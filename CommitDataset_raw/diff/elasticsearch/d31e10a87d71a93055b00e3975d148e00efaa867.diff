[+++ b/distribution/archives/build.gradle, +      into('lib') {, +      }, +++ b/distribution/archives/build.gradle, +      into('lib') {, +      }, +++ b/distribution/build.gradle, +      // delay by using closures, since they have not yet been configured, so no jar task exists yet, +      into('tools/plugin-cli') {, +        from { project(':distribution:tools:plugin-cli').configurations.runtime }, +      }, +++ b/distribution/archives/build.gradle, +      into('lib') {, +      }, +++ b/distribution/build.gradle, +      // delay by using closures, since they have not yet been configured, so no jar task exists yet, +      into('tools/plugin-cli') {, +        from { project(':distribution:tools:plugin-cli').configurations.runtime }, +      }, +++ b/distribution/packages/build.gradle, +      into('lib') {, +        with copySpec {, +          with libFiles, +          // we need to specify every intermediate directory so we iterate through the parents; duplicate calls with the same part are fine, +          eachFile { FileCopyDetails fcp ->, +            String[] segments = fcp.relativePath.segments, +            for (int i = segments.length - 2; i > 0 && segments[i] != 'lib'; --i) {, +              directory('/' + segments[0..i].join('/'), 0755), +            }, +            fcp.mode = 0644, +          }, +        }, +      }, +          // we need to specify every intermediate directory so we iterate through the parents; duplicate calls with the same part are fine, +++ b/distribution/archives/build.gradle, +      into('lib') {, +      }, +++ b/distribution/build.gradle, +      // delay by using closures, since they have not yet been configured, so no jar task exists yet, +      into('tools/plugin-cli') {, +        from { project(':distribution:tools:plugin-cli').configurations.runtime }, +      }, +++ b/distribution/packages/build.gradle, +      into('lib') {, +        with copySpec {, +          with libFiles, +          // we need to specify every intermediate directory so we iterate through the parents; duplicate calls with the same part are fine, +          eachFile { FileCopyDetails fcp ->, +            String[] segments = fcp.relativePath.segments, +            for (int i = segments.length - 2; i > 0 && segments[i] != 'lib'; --i) {, +              directory('/' + segments[0..i].join('/'), 0755), +            }, +            fcp.mode = 0644, +          }, +        }, +      }, +          // we need to specify every intermediate directory so we iterate through the parents; duplicate calls with the same part are fine, +++ b/distribution/src/bin/elasticsearch-cli, +IFS=';' read -r -a additional_classpath_directories <<< "$ES_ADDITIONAL_CLASSPATH_DIRECTORIES", +for additional_classpath_directory in "${additional_classpath_directories[@]}", +do, +  ES_CLASSPATH="$ES_CLASSPATH:$ES_HOME/$additional_classpath_directory/*", +done, +, +++ b/distribution/archives/build.gradle, +      into('lib') {, +      }, +++ b/distribution/build.gradle, +      // delay by using closures, since they have not yet been configured, so no jar task exists yet, +      into('tools/plugin-cli') {, +        from { project(':distribution:tools:plugin-cli').configurations.runtime }, +      }, +++ b/distribution/packages/build.gradle, +      into('lib') {, +        with copySpec {, +          with libFiles, +          // we need to specify every intermediate directory so we iterate through the parents; duplicate calls with the same part are fine, +          eachFile { FileCopyDetails fcp ->, +            String[] segments = fcp.relativePath.segments, +            for (int i = segments.length - 2; i > 0 && segments[i] != 'lib'; --i) {, +              directory('/' + segments[0..i].join('/'), 0755), +            }, +            fcp.mode = 0644, +          }, +        }, +      }, +          // we need to specify every intermediate directory so we iterate through the parents; duplicate calls with the same part are fine, +++ b/distribution/src/bin/elasticsearch-cli, +IFS=';' read -r -a additional_classpath_directories <<< "$ES_ADDITIONAL_CLASSPATH_DIRECTORIES", +for additional_classpath_directory in "${additional_classpath_directories[@]}", +do, +  ES_CLASSPATH="$ES_CLASSPATH:$ES_HOME/$additional_classpath_directory/*", +done, +, +++ b/distribution/src/bin/elasticsearch-cli.bat, +if defined ES_ADDITIONAL_CLASSPATH_DIRECTORIES (, +  for %%a in ("%ES_ADDITIONAL_CLASSPATH_DIRECTORIES:;=","%") do (, +    set ES_CLASSPATH=!ES_CLASSPATH!;!ES_HOME!/%%a/*, +  ), +)]