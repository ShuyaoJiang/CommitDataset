[+++ /dev/null, +++ /dev/null, +++ b/buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/TestClustersPlugin.java, +import org.gradle.api.artifacts.component.ComponentArtifactIdentifier;, +import org.gradle.api.file.FileTree;, +import org.gradle.api.tasks.Sync;, +import java.util.concurrent.Callable;, +            helperConfiguration.getIncoming().afterResolve(resolvableDependencies -> {, +                Set<ComponentArtifactIdentifier> nonZipComponents = resolvableDependencies.getArtifacts(), +                    .getArtifacts(), +                    .stream(), +                    .filter(artifact -> artifact.getFile().getName().endsWith(".zip") == false), +                    .map(artifact -> artifact.getId()), +                    .collect(Collectors.toSet());, +, +                if(nonZipComponents.isEmpty() == false) {, +                    throw new IllegalStateException("Dependencies with non-zip artifacts found in configuration '" +, +                        TestClustersPlugin.HELPER_CONFIGURATION_NAME + "': " + nonZipComponents, +                    );, +                }, +            });, +            rootProject.getTasks().create(SYNC_ARTIFACTS_TASK_NAME, Sync.class, sync -> {, +                sync.from((Callable<List<FileTree>>) () ->, +                    helperConfiguration.getFiles(), +                        .stream(), +                        .map(project::zipTree), +                        .collect(Collectors.toList()), +                );, +                sync.into(new File(getTestClustersConfigurationExtractDir(project), "zip"));, +            });, +                getTestClustersConfigurationExtractDir(project),, +    static File getTestClustersConfigurationExtractDir(Project project) {, +        return new File(project.getRootProject().getBuildDir(), "testclusters/extract");]