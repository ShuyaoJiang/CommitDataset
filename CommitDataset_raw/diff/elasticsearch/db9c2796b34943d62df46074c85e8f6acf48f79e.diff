[+++ b/core/src/main/java/org/elasticsearch/index/query/AbstractQueryBuilder.java, +    protected abstract QB doReadFrom(StreamInput in) throws IOException;, +    protected abstract void doWriteTo(StreamOutput out) throws IOException;, +    protected abstract boolean doEquals(QB other);, +    protected abstract int doHashCode();, +++ b/core/src/main/java/org/elasticsearch/index/query/AbstractQueryBuilder.java, +    protected abstract QB doReadFrom(StreamInput in) throws IOException;, +    protected abstract void doWriteTo(StreamOutput out) throws IOException;, +    protected abstract boolean doEquals(QB other);, +    protected abstract int doHashCode();, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryBuilder.java, +++ b/core/src/main/java/org/elasticsearch/index/query/AbstractQueryBuilder.java, +    protected abstract QB doReadFrom(StreamInput in) throws IOException;, +    protected abstract void doWriteTo(StreamOutput out) throws IOException;, +    protected abstract boolean doEquals(QB other);, +    protected abstract int doHashCode();, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryBuilder.java, +++ b/core/src/test/java/org/elasticsearch/index/query/WrapperQueryBuilderTests.java, +                return new WrapperQueryBuilder(((AbstractQueryBuilder<?>)wrappedQuery).buildAsBytes().toBytes());, +                return new WrapperQueryBuilder(((AbstractQueryBuilder<?>)wrappedQuery).buildAsBytes());, +++ b/core/src/main/java/org/elasticsearch/index/query/AbstractQueryBuilder.java, +    protected abstract QB doReadFrom(StreamInput in) throws IOException;, +    protected abstract void doWriteTo(StreamOutput out) throws IOException;, +    protected abstract boolean doEquals(QB other);, +    protected abstract int doHashCode();, +++ b/core/src/main/java/org/elasticsearch/index/query/QueryBuilder.java, +++ b/core/src/test/java/org/elasticsearch/index/query/WrapperQueryBuilderTests.java, +                return new WrapperQueryBuilder(((AbstractQueryBuilder<?>)wrappedQuery).buildAsBytes().toBytes());, +                return new WrapperQueryBuilder(((AbstractQueryBuilder<?>)wrappedQuery).buildAsBytes());, +++ b/core/src/test/java/org/elasticsearch/index/query/plugin/DummyQueryParserPlugin.java, +import org.elasticsearch.common.io.stream.StreamInput;, +import org.elasticsearch.common.io.stream.StreamOutput;, +        protected DummyQueryBuilder doReadFrom(StreamInput in) throws IOException {, +            return null;, +        }, +, +        @Override, +        protected void doWriteTo(StreamOutput out) throws IOException {, +, +        }, +, +        @Override, +        protected boolean doEquals(DummyQueryBuilder other) {, +            return false;, +        }, +, +        @Override, +        protected int doHashCode() {, +            return 0;, +        }, +, +        @Override]