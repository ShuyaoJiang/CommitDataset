[+++ b/server/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +                .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/server/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +                .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java, +        if (addTestZenDiscovery() && getUseZen2() == false) {, +            initialNodeSettings.put(TestZenDiscovery.USE_ZEN2.getKey(), false);, +++ b/server/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +                .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java, +        if (addTestZenDiscovery() && getUseZen2() == false) {, +            initialNodeSettings.put(TestZenDiscovery.USE_ZEN2.getKey(), false);, +++ b/test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java, +            .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/server/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +                .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java, +        if (addTestZenDiscovery() && getUseZen2() == false) {, +            initialNodeSettings.put(TestZenDiscovery.USE_ZEN2.getKey(), false);, +++ b/test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java, +            .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java, +    public static void setUseNio() {, +    private static boolean useZen2;, +, +    @BeforeClass, +    public static void setUseZen2() {, +        useZen2 = true;, +    }, +, +    protected static boolean getUseZen2() {, +        return useZen2;, +    }, +, +++ b/server/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +                .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java, +        if (addTestZenDiscovery() && getUseZen2() == false) {, +            initialNodeSettings.put(TestZenDiscovery.USE_ZEN2.getKey(), false);, +++ b/test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java, +            .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java, +    public static void setUseNio() {, +    private static boolean useZen2;, +, +    @BeforeClass, +    public static void setUseZen2() {, +        useZen2 = true;, +    }, +, +    protected static boolean getUseZen2() {, +        return useZen2;, +    }, +, +++ b/test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java, +        Setting.boolSetting("discovery.zen.use_zen2", true, Setting.Property.NodeScope);, +++ b/server/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +                .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java, +        if (addTestZenDiscovery() && getUseZen2() == false) {, +            initialNodeSettings.put(TestZenDiscovery.USE_ZEN2.getKey(), false);, +++ b/test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java, +            .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java, +    public static void setUseNio() {, +    private static boolean useZen2;, +, +    @BeforeClass, +    public static void setUseZen2() {, +        useZen2 = true;, +    }, +, +    protected static boolean getUseZen2() {, +        return useZen2;, +    }, +, +++ b/test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java, +        Setting.boolSetting("discovery.zen.use_zen2", true, Setting.Property.NodeScope);, +++ b/test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java, +import org.elasticsearch.discovery.DiscoveryModule;, +import org.elasticsearch.discovery.zen.SettingsBasedHostsProvider;, +import static org.elasticsearch.cluster.coordination.ClusterBootstrapService.INITIAL_MASTER_NODE_COUNT_SETTING;, +import static org.elasticsearch.test.discovery.TestZenDiscovery.USE_ZEN2;, +                    .put(DiscoveryModule.DISCOVERY_HOSTS_PROVIDER_SETTING.getKey(), "file"), +                    .putList(SettingsBasedHostsProvider.DISCOVERY_ZEN_PING_UNICAST_HOSTS_SETTING.getKey()), +                    settings.put(DISCOVERY_ZEN_MINIMUM_MASTER_NODES_SETTING.getKey(), minNumDataNodes / 2 + 1), +                        .put(INITIAL_MASTER_NODE_COUNT_SETTING.getKey(), minNumDataNodes);, +                    .put(USE_ZEN2.getKey(), false) // full cluster restarts not yet supported, +                        .put(USE_ZEN2.getKey(), false) // full cluster restarts not yet supported, +                    .put(USE_ZEN2.getKey(), false) // full cluster restarts not yet supported, +++ b/server/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +                .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java, +        if (addTestZenDiscovery() && getUseZen2() == false) {, +            initialNodeSettings.put(TestZenDiscovery.USE_ZEN2.getKey(), false);, +++ b/test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java, +            .put(TestZenDiscovery.USE_ZEN2.getKey(), getUseZen2()), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java, +    public static void setUseNio() {, +    private static boolean useZen2;]