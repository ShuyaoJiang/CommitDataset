[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/RoutingNode.java, +    public boolean canAllocate(RoutingNodes nodes) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/RoutingNode.java, +    public boolean canAllocate(RoutingNodes nodes) {, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/strategy/ShardsRoutingStrategy.java, +                    if (lowRoutingNode.canAllocate(routingNodes) && lowRoutingNode.canAllocate(startedShard)) {, +                if (node.canAllocate(routingNodes) && node.canAllocate(shard)) {, +                if (routingNode.canAllocate(routingNodes) && routingNode.canAllocate(shard)) {, +                        target.canAllocate(routingNodes) &&]