[+++ b/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java, +import org.elasticsearch.Version;, +import java.util.TreeSet;, +     * Does any node in the cluster being tested have x-pack installed?, +        if (hasXPack == null) {, +        return hasXPack;, +    private static Boolean hasXPack;, +    private static TreeSet<Version> nodeVersions;, +            assert hasXPack == null;, +            assert nodeVersions == null;, +, +            hasXPack = false;, +            nodeVersions = new TreeSet<>();, +            Map<?, ?> response = entityAsMap(adminClient.performRequest(new Request("GET", "_nodes/plugins")));, +            Map<?, ?> nodes = (Map<?, ?>) response.get("nodes");, +            for (Map.Entry<?, ?> node : nodes.entrySet()) {, +                Map<?, ?> nodeInfo = (Map<?, ?>) node.getValue();, +                nodeVersions.add(Version.fromString(nodeInfo.get("version").toString()));, +                for (Object module: (List<?>) nodeInfo.get("modules")) {, +                    Map<?, ?> moduleInfo = (Map<?, ?>) module;, +                    if (moduleInfo.get("name").toString().startsWith("x-pack-")) {, +                        hasXPack = true;, +                    }, +                }, +            }, +        assert hasXPack != null;, +        assert nodeVersions != null;, +            hasXPack = null;, +            nodeVersions = null;]