[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/SearchPhaseExecutionException.java, +    private static String buildMessage(String phaseName, String msg, ShardSearchFailure[] shardFailures) {, +                if (shardFailure.shard() != null) {, +                } else {, +                    sb.append("{").append(shardFailure.reason()).append("}");, +                }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/SearchPhaseExecutionException.java, +    private static String buildMessage(String phaseName, String msg, ShardSearchFailure[] shardFailures) {, +                if (shardFailure.shard() != null) {, +                } else {, +                    sb.append("{").append(shardFailure.reason()).append("}");, +                }, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/search/SearchShardTarget.java, +import javax.annotation.Nullable;, +    @Nullable public String nodeId() {, +    @Nullable public String getNodeId() {, +        if (in.readBoolean()) {, +        }, +        if (nodeId == null) {, +            out.writeBoolean(false);, +        } else {, +            out.writeBoolean(true);, +        }, +        if (nodeId == null) {, +            return "[_na_][" + index + "][" + shardId + "]";, +        }]