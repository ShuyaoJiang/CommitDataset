[+++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +import org.elasticsearch.common.lucene.index.ElasticsearchDirectoryReader;, +        assert ElasticsearchDirectoryReader.unwrap(searcher.getDirectoryReader()), +            != null : "DirectoryReader must be an instance or ElasticsearchDirectoryReader";, +++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +import org.elasticsearch.common.lucene.index.ElasticsearchDirectoryReader;, +        assert ElasticsearchDirectoryReader.unwrap(searcher.getDirectoryReader()), +            != null : "DirectoryReader must be an instance or ElasticsearchDirectoryReader";, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/index/engine/FrozenEngine.java, +import org.elasticsearch.common.lucene.index.ElasticsearchDirectoryReader;, +            canMatchReader = ElasticsearchDirectoryReader.wrap(new RewriteCachingDirectoryReader(directory, reader.leaves()),, +                config.getShardId());, +++ b/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java, +import org.elasticsearch.common.lucene.index.ElasticsearchDirectoryReader;, +        assert ElasticsearchDirectoryReader.unwrap(searcher.getDirectoryReader()), +            != null : "DirectoryReader must be an instance or ElasticsearchDirectoryReader";, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/index/engine/FrozenEngine.java, +import org.elasticsearch.common.lucene.index.ElasticsearchDirectoryReader;, +            canMatchReader = ElasticsearchDirectoryReader.wrap(new RewriteCachingDirectoryReader(directory, reader.leaves()),, +                config.getShardId());, +++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/index/engine/FrozenEngineTests.java, +                        assertNotNull(ElasticsearchDirectoryReader.getElasticsearchDirectoryReader(searcher.getDirectoryReader()));, +                        assertEquals(config.getShardId(), ElasticsearchDirectoryReader.getElasticsearchDirectoryReader(searcher, +                            .getDirectoryReader()).shardId());, +                        assertNotNull(ElasticsearchDirectoryReader.getElasticsearchDirectoryReader(searcher.getDirectoryReader()));]