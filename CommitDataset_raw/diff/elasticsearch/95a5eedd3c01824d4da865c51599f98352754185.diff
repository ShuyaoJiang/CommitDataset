[+++ b/src/main/java/org/elasticsearch/index/analysis/PatternAnalyzerProvider.java, +import org.apache.lucene.analysis.Analyzer;, +import org.apache.lucene.analysis.TokenStream;, +import org.apache.lucene.analysis.core.LowerCaseFilter;, +import org.apache.lucene.analysis.core.StopFilter;, +import org.apache.lucene.analysis.pattern.PatternTokenizer;, +import java.io.Reader;, +public class PatternAnalyzerProvider extends AbstractIndexAnalyzerProvider<Analyzer> {, +    private static final class PatternAnalyzer extends Analyzer {, +        private final org.apache.lucene.util.Version version;, +        private final Pattern pattern;, +        private final boolean lowercase;, +        private final CharArraySet stopWords;, +, +        PatternAnalyzer(org.apache.lucene.util.Version version, Pattern pattern, boolean lowercase, CharArraySet stopWords) {, +            this.version = version;, +            this.pattern = pattern;, +            this.lowercase = lowercase;, +            this.stopWords = stopWords;, +        }, +, +        @Override, +        protected TokenStreamComponents createComponents(String s, Reader reader) {, +            final TokenStreamComponents source = new TokenStreamComponents(new PatternTokenizer(reader, pattern, -1));, +            TokenStream result = null;, +            if (lowercase) {, +                 result = new LowerCaseFilter(version, source.getTokenStream());, +            }, +            result = new StopFilter(version, (result == null) ? source.getTokenStream() : result, stopWords);, +            return new TokenStreamComponents(source.getTokenizer(), result);, +        }, +    }, +]