[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/metadata/MetaDataStateIndexService.java, +import org.elasticsearch.cluster.routing.allocation.RoutingAllocation;, +import org.elasticsearch.cluster.routing.allocation.ShardsAllocation;, +import static org.elasticsearch.cluster.ClusterState.*;, +, +    private final ShardsAllocation shardsAllocation;, +, +    @Inject public MetaDataStateIndexService(Settings settings, ClusterService clusterService, ShardsAllocation shardsAllocation) {, +        this.shardsAllocation = shardsAllocation;, +                ClusterState updatedState = ClusterState.builder().state(currentState).metaData(mdBuilder).blocks(blocks).build();, +, +                RoutingTable.Builder rtBuilder = RoutingTable.builder().routingTable(updatedState.routingTable());, +                IndexRoutingTable.Builder indexRoutingBuilder = new IndexRoutingTable.Builder(request.index), +                        .initializeEmpty(updatedState.metaData().index(request.index), false);, +                rtBuilder.add(indexRoutingBuilder);, +, +                RoutingAllocation.Result routingResult = shardsAllocation.reroute(newClusterStateBuilder().state(updatedState).routingTable(rtBuilder).build());, +, +                return ClusterState.builder().state(updatedState).routingResult(routingResult).build();]