[+++ b/src/main/java/org/elasticsearch/indices/InternalIndicesService.java, +import org.elasticsearch.index.fielddata.IndexFieldDataService;, +        indexInjector.getInstance(IndexFieldDataService.class).clear();, +++ b/src/main/java/org/elasticsearch/indices/InternalIndicesService.java, +import org.elasticsearch.index.fielddata.IndexFieldDataService;, +        indexInjector.getInstance(IndexFieldDataService.class).clear();, +++ b/src/main/java/org/elasticsearch/search/facet/range/RangeFacetProcessor.java, +import org.elasticsearch.index.fielddata.IndexNumericFieldData;, +        // we have a keyField, +        FieldMapper keyFieldMapper = context.smartNameFieldMapper(keyField);, +        if (keyFieldMapper == null) {, +            throw new FacetPhaseExecutionException(facetName, "No mapping found for key_field [" + keyField + "]");, +        }, +        for (RangeFacet.Entry entry : rangeEntries) {, +            if (entry.fromAsString != null) {, +                entry.from = ((Number) keyFieldMapper.value(entry.fromAsString)).doubleValue();, +            }, +            if (entry.toAsString != null) {, +                entry.to = ((Number) keyFieldMapper.value(entry.toAsString)).doubleValue();, +            }, +        }, +, +        IndexNumericFieldData keyIndexFieldData = context.fieldData().getForField(keyFieldMapper.names(), keyFieldMapper.fieldDataType2());, +]