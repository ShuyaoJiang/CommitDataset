[+++ b/core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java, +++ b/core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java, +++ b/core/src/main/java/org/elasticsearch/indices/TermsLookup.java, +import org.elasticsearch.Version;, +    private final String index;, +        if (index == null) {, +            throw new IllegalArgumentException("[" + TermsQueryBuilder.NAME + "] query lookup element requires specifying the index.");, +        }, +        if (in.getVersion().onOrAfter(Version.V_6_0_0_beta1)) {, +            index = in.readString();, +        } else {, +            if (index == null) {, +                throw new IllegalStateException("index must not be null in a terms lookup");, +            }, +        }, +        if (out.getVersion().onOrAfter(Version.V_6_0_0_beta1)) {, +            out.writeString(index);, +        } else {, +        }, +                    index = parser.text();, +++ b/core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java, +++ b/core/src/main/java/org/elasticsearch/indices/TermsLookup.java, +import org.elasticsearch.Version;, +    private final String index;, +        if (index == null) {, +            throw new IllegalArgumentException("[" + TermsQueryBuilder.NAME + "] query lookup element requires specifying the index.");, +        }, +        if (in.getVersion().onOrAfter(Version.V_6_0_0_beta1)) {, +            index = in.readString();, +        } else {, +            if (index == null) {, +                throw new IllegalStateException("index must not be null in a terms lookup");, +            }, +        }, +        if (out.getVersion().onOrAfter(Version.V_6_0_0_beta1)) {, +            out.writeString(index);, +        } else {, +        }, +                    index = parser.text();, +++ b/core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java, +        return new TermsLookup(randomAlphaOfLength(10), randomAlphaOfLength(10), randomAlphaOfLength(10),, +++ b/core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java, +++ b/core/src/main/java/org/elasticsearch/indices/TermsLookup.java, +import org.elasticsearch.Version;, +    private final String index;, +        if (index == null) {, +            throw new IllegalArgumentException("[" + TermsQueryBuilder.NAME + "] query lookup element requires specifying the index.");, +        }, +        if (in.getVersion().onOrAfter(Version.V_6_0_0_beta1)) {, +            index = in.readString();, +        } else {, +            if (index == null) {, +                throw new IllegalStateException("index must not be null in a terms lookup");, +            }, +        }, +        if (out.getVersion().onOrAfter(Version.V_6_0_0_beta1)) {, +            out.writeString(index);, +        } else {, +        }, +                    index = parser.text();, +++ b/core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java, +        return new TermsLookup(randomAlphaOfLength(10), randomAlphaOfLength(10), randomAlphaOfLength(10),, +++ b/core/src/test/java/org/elasticsearch/indices/TermsLookupTests.java, +        String index = randomAlphaOfLength(5);, +        switch (randomIntBetween(0, 3)) {, +            case 3:, +                index = null;, +                break;, +            default:, +                fail("unknown case");, +            new TermsLookup(index, type, id, path);, +                randomAlphaOfLength(10),, +++ b/core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java, +++ b/core/src/main/java/org/elasticsearch/indices/TermsLookup.java, +import org.elasticsearch.Version;, +    private final String index;, +        if (index == null) {, +            throw new IllegalArgumentException("[" + TermsQueryBuilder.NAME + "] query lookup element requires specifying the index.");, +        }, +        if (in.getVersion().onOrAfter(Version.V_6_0_0_beta1)) {, +            index = in.readString();, +        } else {, +            if (index == null) {, +                throw new IllegalStateException("index must not be null in a terms lookup");, +            }, +        }, +        if (out.getVersion().onOrAfter(Version.V_6_0_0_beta1)) {, +            out.writeString(index);, +        } else {, +        }, +                    index = parser.text();, +++ b/core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java, +        return new TermsLookup(randomAlphaOfLength(10), randomAlphaOfLength(10), randomAlphaOfLength(10),, +++ b/core/src/test/java/org/elasticsearch/indices/TermsLookupTests.java, +        String index = randomAlphaOfLength(5);, +        switch (randomIntBetween(0, 3)) {, +            case 3:, +                index = null;, +                break;, +            default:]