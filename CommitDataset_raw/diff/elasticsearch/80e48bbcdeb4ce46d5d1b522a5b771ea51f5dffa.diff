[+++ b/Vagrantfile, +export PACKAGING_TESTS=/project/build/packaging/tests, +Defaults   env_keep += "PACKAGING_TESTS", +++ b/Vagrantfile, +export PACKAGING_TESTS=/project/build/packaging/tests, +Defaults   env_keep += "PACKAGING_TESTS", +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            /*, +             * Force html5 on projects that support it to silence the warning, +             * that `javadoc` will change its defaults in the future., +             *, +             * But not all of our javadoc is actually valid html5. So we, +             * have to become valid incrementally. We only set html5 on the, +             * projects we have converted so that we still get the annoying, +             * warning on the unconverted ones. That will give us an, +             * incentive to convert them...., +             */, +            List html4Projects = [, +                ':server',, +                ':x-pack:plugin:core',, +            ], +            if (false == html4Projects.contains(project.path)) {, +                javadoc.options.addBooleanOption('html5', true), +            }, +++ b/Vagrantfile, +export PACKAGING_TESTS=/project/build/packaging/tests, +Defaults   env_keep += "PACKAGING_TESTS", +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            /*, +             * Force html5 on projects that support it to silence the warning, +             * that `javadoc` will change its defaults in the future., +             *, +             * But not all of our javadoc is actually valid html5. So we, +             * have to become valid incrementally. We only set html5 on the, +             * projects we have converted so that we still get the annoying, +             * warning on the unconverted ones. That will give us an, +             * incentive to convert them...., +             */, +            List html4Projects = [, +                ':server',, +                ':x-pack:plugin:core',, +            ], +            if (false == html4Projects.contains(project.path)) {, +                javadoc.options.addBooleanOption('html5', true), +            }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/vagrant/VagrantPropertiesExtension.groovy, +    @Input, +    String testClass, +, +++ b/Vagrantfile, +export PACKAGING_TESTS=/project/build/packaging/tests, +Defaults   env_keep += "PACKAGING_TESTS", +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            /*, +             * Force html5 on projects that support it to silence the warning, +             * that `javadoc` will change its defaults in the future., +             *, +             * But not all of our javadoc is actually valid html5. So we, +             * have to become valid incrementally. We only set html5 on the, +             * projects we have converted so that we still get the annoying, +             * warning on the unconverted ones. That will give us an, +             * incentive to convert them...., +             */, +            List html4Projects = [, +                ':server',, +                ':x-pack:plugin:core',, +            ], +            if (false == html4Projects.contains(project.path)) {, +                javadoc.options.addBooleanOption('html5', true), +            }, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/vagrant/VagrantPropertiesExtension.groovy, +    @Input, +    String testClass, +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/vagrant/VagrantTestPlugin.groovy, +    private static final PACKAGING_TEST_CONFIGURATION = 'packagingTest', +        project.configurations.create(PACKAGING_TEST_CONFIGURATION), +        if (project.tasks.findByName('clean') == null) {, +    }, +        File testsDir = new File(packagingDir, 'tests'), +        Copy copyPackagingTests = project.tasks.create('copyPackagingTests', Copy) {, +            into testsDir, +            from project.configurations[PACKAGING_TEST_CONFIGURATION], +        }, +, +        Task createTestRunnerScript = project.tasks.create('createTestRunnerScript', FileContentsTask) {, +            dependsOn copyPackagingTests, +            file "${testsDir}/run-tests.sh", +            contents "java -cp \"\$PACKAGING_TESTS/*\" org.junit.runner.JUnitCore ${-> project.extensions.esvagrant.testClass}", +        }, +, +        vagrantSetUpTask.dependsOn copyPackagingArchives, copyPackagingTests, createTestRunnerScript, +        vagrantSetUpTask.dependsOn createVersionFile, createUpgradeFromFile, createUpgradeIsOssFile, +            Task javaPackagingTest = project.tasks.create("vagrant${boxTask}#javaPackagingTest", VagrantCommandTask) {, +                command 'ssh', +                boxName box, +                environmentVars vagrantEnvVars, +                dependsOn up, setupPackagingTest, +                finalizedBy halt, +                args '--command', "bash \"\$PACKAGING_TESTS/run-tests.sh\""]