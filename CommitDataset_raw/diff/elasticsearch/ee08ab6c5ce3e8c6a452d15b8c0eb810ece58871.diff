[+++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +        Script script = null;, +            if (script != null) {, +                this.script = script;, +            }, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +        Script script = null;, +            if (script != null) {, +                this.script = script;, +            }, +++ b/src/main/java/org/elasticsearch/index/query/TemplateQueryParser.java, +    public static Template parse(String defaultLang, XContentParser parser, String... parameters) throws IOException {, +, +        Map<String, ScriptService.ScriptType> parameterMap = new HashMap<>(parametersToTypes);, +        for (String parameter : parameters) {, +            parameterMap.put(parameter, ScriptService.ScriptType.INLINE);, +        }, +        return Template.parse(parser, parameterMap, defaultLang);, +    }, +, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +        Script script = null;, +            if (script != null) {, +                this.script = script;, +            }, +++ b/src/main/java/org/elasticsearch/index/query/TemplateQueryParser.java, +    public static Template parse(String defaultLang, XContentParser parser, String... parameters) throws IOException {, +, +        Map<String, ScriptService.ScriptType> parameterMap = new HashMap<>(parametersToTypes);, +        for (String parameter : parameters) {, +            parameterMap.put(parameter, ScriptService.ScriptType.INLINE);, +        }, +        return Template.parse(parser, parameterMap, defaultLang);, +    }, +, +++ b/src/main/java/org/elasticsearch/script/AbstractScriptParser.java, +    public S parse(Map<String, Object> config, boolean removeMatchedEntries) {, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +        Script script = null;, +            if (script != null) {, +                this.script = script;, +            }, +++ b/src/main/java/org/elasticsearch/index/query/TemplateQueryParser.java, +    public static Template parse(String defaultLang, XContentParser parser, String... parameters) throws IOException {, +, +        Map<String, ScriptService.ScriptType> parameterMap = new HashMap<>(parametersToTypes);, +        for (String parameter : parameters) {, +            parameterMap.put(parameter, ScriptService.ScriptType.INLINE);, +        }, +        return Template.parse(parser, parameterMap, defaultLang);, +    }, +, +++ b/src/main/java/org/elasticsearch/script/AbstractScriptParser.java, +    public S parse(Map<String, Object> config, boolean removeMatchedEntries) {, +++ b/src/main/java/org/elasticsearch/script/ScriptService.java, +, +            Template template = TemplateQueryParser.parse(scriptLang, parser, "params", "script", "template");, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +        Script script = null;, +            if (script != null) {, +                this.script = script;, +            }, +++ b/src/main/java/org/elasticsearch/index/query/TemplateQueryParser.java, +    public static Template parse(String defaultLang, XContentParser parser, String... parameters) throws IOException {, +, +        Map<String, ScriptService.ScriptType> parameterMap = new HashMap<>(parametersToTypes);, +        for (String parameter : parameters) {, +            parameterMap.put(parameter, ScriptService.ScriptType.INLINE);, +        }, +        return Template.parse(parser, parameterMap, defaultLang);, +    }, +, +++ b/src/main/java/org/elasticsearch/script/AbstractScriptParser.java, +    public S parse(Map<String, Object> config, boolean removeMatchedEntries) {, +++ b/src/main/java/org/elasticsearch/script/ScriptService.java, +, +            Template template = TemplateQueryParser.parse(scriptLang, parser, "params", "script", "template");, +++ b/src/main/java/org/elasticsearch/script/Template.java, +        return new TemplateParser(Collections.EMPTY_MAP, MustacheScriptEngineService.NAME).parse(config, removeMatchedEntries);, +        return new TemplateParser(Collections.EMPTY_MAP, MustacheScriptEngineService.NAME).parse(parser);, +        return new TemplateParser(additionalTemplateFieldNames, MustacheScriptEngineService.NAME).parse(parser);, +    }, +, +    @Deprecated, +    public static Template parse(XContentParser parser, Map<String, ScriptType> additionalTemplateFieldNames, String defaultLang) throws IOException {, +        return new TemplateParser(additionalTemplateFieldNames, defaultLang).parse(parser);, +        private String defaultLang;, +        public TemplateParser(Map<String, ScriptType> additionalTemplateFieldNames, String defaultLang) {, +            this.defaultLang = defaultLang;, +            return new Template(script, type, lang, contentType, params);, +            return defaultLang;, +++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java, +        Script script = null;, +            if (script != null) {, +                this.script = script;, +            }, +++ b/src/main/java/org/elasticsearch/index/query/TemplateQueryParser.java, +    public static Template parse(String defaultLang, XContentParser parser, String... parameters) throws IOException {, +, +        Map<String, ScriptService.ScriptType> parameterMap = new HashMap<>(parametersToTypes);]