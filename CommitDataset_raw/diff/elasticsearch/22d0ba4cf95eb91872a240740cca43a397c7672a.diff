[+++ b/watcher/src/main/java/org/elasticsearch/watcher/shield/ShieldIntegration.java, +import org.elasticsearch.common.HasContext;, +    // TODO this is a hack that needs to go away with proper fixes in core, +    public void putUserInContext(HasContext context) {, +        if (userHolder != null) {, +            context.putInContext("_shield_user", ((WatcherUserHolder) userHolder).user);, +        }, +    }, +, +++ b/watcher/src/main/java/org/elasticsearch/watcher/shield/ShieldIntegration.java, +import org.elasticsearch.common.HasContext;, +    // TODO this is a hack that needs to go away with proper fixes in core, +    public void putUserInContext(HasContext context) {, +        if (userHolder != null) {, +            context.putInContext("_shield_user", ((WatcherUserHolder) userHolder).user);, +        }, +    }, +, +++ b/watcher/src/main/java/org/elasticsearch/watcher/support/init/proxy/ScriptServiceProxy.java, +import org.elasticsearch.common.ContextAndHeaderHolder;, +import org.elasticsearch.watcher.shield.ShieldIntegration;, +    private ContextAndHeaderHolder contextAndHeaderHolder = new ContextAndHeaderHolder();, +        ShieldIntegration shieldIntegration = injector.getInstance(ShieldIntegration.class);, +        if (shieldIntegration != null) {, +            shieldIntegration.putUserInContext(contextAndHeaderHolder);, +        }, +        return service.compile(script, WatcherScriptContext.CTX, contextAndHeaderHolder);, +        return service.executable(script, WatcherScriptContext.CTX, contextAndHeaderHolder);]