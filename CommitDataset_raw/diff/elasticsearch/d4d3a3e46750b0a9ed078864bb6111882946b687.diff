[+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/LicenseStateListener.java, +/*, + * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one, + * or more contributor license agreements. Licensed under the Elastic License;, + * you may not use this file except in compliance with the Elastic License., + */, +, +package org.elasticsearch.license;, +, +import org.elasticsearch.Version;, +, +/**, + * Marker interface for callbacks that are invoked when the license state changes., + */, +@FunctionalInterface, +public interface LicenseStateListener {, +, +    /**, +     * Callback when the license state changes. See {@link XPackLicenseState#update(License.OperationMode, boolean, Version)}., +     */, +    void licenseStateChanged();, +, +}, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/LicenseStateListener.java, +/*, + * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one, + * or more contributor license agreements. Licensed under the Elastic License;, + * you may not use this file except in compliance with the Elastic License., + */, +, +package org.elasticsearch.license;, +, +import org.elasticsearch.Version;, +, +/**, + * Marker interface for callbacks that are invoked when the license state changes., + */, +@FunctionalInterface, +public interface LicenseStateListener {, +, +    /**, +     * Callback when the license state changes. See {@link XPackLicenseState#update(License.OperationMode, boolean, Version)}., +     */, +    void licenseStateChanged();, +, +}, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/XPackLicenseState.java, +    private final List<LicenseStateListener> listeners;, +        listeners.forEach(LicenseStateListener::licenseStateChanged);, +    public void addListener(final LicenseStateListener listener) {, +        listeners.add(Objects.requireNonNull(listener));, +    public void removeListener(final LicenseStateListener listener) {, +        listeners.remove(Objects.requireNonNull(listener));, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/LicenseStateListener.java, +/*, + * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one, + * or more contributor license agreements. Licensed under the Elastic License;, + * you may not use this file except in compliance with the Elastic License., + */, +, +package org.elasticsearch.license;, +, +import org.elasticsearch.Version;, +, +/**, + * Marker interface for callbacks that are invoked when the license state changes., + */, +@FunctionalInterface, +public interface LicenseStateListener {, +, +    /**, +     * Callback when the license state changes. See {@link XPackLicenseState#update(License.OperationMode, boolean, Version)}., +     */, +    void licenseStateChanged();, +, +}, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/XPackLicenseState.java, +    private final List<LicenseStateListener> listeners;, +        listeners.forEach(LicenseStateListener::licenseStateChanged);, +    public void addListener(final LicenseStateListener listener) {, +        listeners.add(Objects.requireNonNull(listener));, +    public void removeListener(final LicenseStateListener listener) {, +        listeners.remove(Objects.requireNonNull(listener));, +++ b/x-pack/plugin/monitoring/src/main/java/org/elasticsearch/xpack/monitoring/exporter/local/LocalExporter.java, +import org.elasticsearch.license.LicenseStateListener;, +public class LocalExporter extends Exporter implements ClusterStateListener, CleanerService.Listener, LicenseStateListener {, +        // if additional listeners are added here, adjust LocalExporterTests#testLocalExporterRemovesListenersOnClose accordingly, +        licenseState.addListener(this);, +    @Override, +    public void licenseStateChanged() {, +            licenseState.removeListener(this);, +++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/LicenseStateListener.java, +/*, + * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one, + * or more contributor license agreements. Licensed under the Elastic License;, + * you may not use this file except in compliance with the Elastic License., + */, +, +package org.elasticsearch.license;, +]