[+++ b/TESTING.asciidoc, +By default the tests run on multiple processes using all the available cores on all , +available CPUs. Not including hyper-threading., +If you want to explicitly specify the number of JVMs you can do so on the command, +++ b/TESTING.asciidoc, +By default the tests run on multiple processes using all the available cores on all , +available CPUs. Not including hyper-threading., +If you want to explicitly specify the number of JVMs you can do so on the command, +++ b/build.gradle, +final boolean bwc_tests_enabled = true, +final String bwc_tests_disabled_issue = "" /* place a PR link here when committing bwc changes */, +++ b/TESTING.asciidoc, +By default the tests run on multiple processes using all the available cores on all , +available CPUs. Not including hyper-threading., +If you want to explicitly specify the number of JVMs you can do so on the command, +++ b/build.gradle, +final boolean bwc_tests_enabled = true, +final String bwc_tests_disabled_issue = "" /* place a PR link here when committing bwc changes */, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +        String defaultParallel = 'auto', +        // Count physical cores on any Linux distro ( don't count hyper-threading ), +        if (project.file("/proc/cpuinfo").exists()) {, +            Map<String, Integer> socketToCore = [:], +            String currentID = "", +            project.file("/proc/cpuinfo").readLines().forEach({ line ->, +                if (line.contains(":")) {, +                    List<String> parts = line.split(":", 2).collect({it.trim()}), +                    String name = parts[0], value = parts[1], +                    // the ID of the CPU socket, +                    if (name == "physical id") {, +                        currentID = value, +                    }, +                    // Number  of cores not including hyper-threading, +                    if (name == "cpu cores") {, +                        assert currentID.isEmpty() == false, +                        socketToCore[currentID] = Integer.valueOf(value), +                        currentID = "", +                    }, +                }, +            }), +            defaultParallel = socketToCore.values().sum().toString();, +        }, +            parallelism System.getProperty('tests.jvms', defaultParallel), +++ b/TESTING.asciidoc, +By default the tests run on multiple processes using all the available cores on all , +available CPUs. Not including hyper-threading., +If you want to explicitly specify the number of JVMs you can do so on the command, +++ b/build.gradle, +final boolean bwc_tests_enabled = true, +final String bwc_tests_disabled_issue = "" /* place a PR link here when committing bwc changes */, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +        String defaultParallel = 'auto', +        // Count physical cores on any Linux distro ( don't count hyper-threading ), +        if (project.file("/proc/cpuinfo").exists()) {, +            Map<String, Integer> socketToCore = [:], +            String currentID = "", +            project.file("/proc/cpuinfo").readLines().forEach({ line ->, +                if (line.contains(":")) {, +                    List<String> parts = line.split(":", 2).collect({it.trim()}), +                    String name = parts[0], value = parts[1], +                    // the ID of the CPU socket, +                    if (name == "physical id") {, +                        currentID = value, +                    }, +                    // Number  of cores not including hyper-threading, +                    if (name == "cpu cores") {, +                        assert currentID.isEmpty() == false, +                        socketToCore[currentID] = Integer.valueOf(value), +                        currentID = "", +                    }, +                }, +            }), +            defaultParallel = socketToCore.values().sum().toString();, +        }, +            parallelism System.getProperty('tests.jvms', defaultParallel), +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/ClusterConfiguration.groovy, +        if (bwcVersion != null && bwcVersion.before("6.5.0")) {, +++ b/TESTING.asciidoc, +By default the tests run on multiple processes using all the available cores on all , +available CPUs. Not including hyper-threading., +If you want to explicitly specify the number of JVMs you can do so on the command, +++ b/build.gradle, +final boolean bwc_tests_enabled = true, +final String bwc_tests_disabled_issue = "" /* place a PR link here when committing bwc changes */, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +        String defaultParallel = 'auto', +        // Count physical cores on any Linux distro ( don't count hyper-threading ), +        if (project.file("/proc/cpuinfo").exists()) {, +            Map<String, Integer> socketToCore = [:], +            String currentID = "", +            project.file("/proc/cpuinfo").readLines().forEach({ line ->, +                if (line.contains(":")) {, +                    List<String> parts = line.split(":", 2).collect({it.trim()}), +                    String name = parts[0], value = parts[1], +                    // the ID of the CPU socket, +                    if (name == "physical id") {, +                        currentID = value, +                    }, +                    // Number  of cores not including hyper-threading, +                    if (name == "cpu cores") {]