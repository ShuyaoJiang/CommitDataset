[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java, +import org.elasticsearch.ElasticSearchIllegalArgumentException;, +import org.elasticsearch.cluster.ClusterChangedEvent;, +import org.elasticsearch.cluster.ClusterService;, +import org.elasticsearch.cluster.ClusterState;, +import org.elasticsearch.cluster.ClusterStateListener;, +import org.elasticsearch.cluster.ProcessedClusterStateUpdateTask;, +        if (settings.get(IndexMetaData.SETTING_NUMBER_OF_SHARDS) != null) {, +            listener.onFailure(new ElasticSearchIllegalArgumentException("can't change the number of shards for an index"));, +            return;, +        }]