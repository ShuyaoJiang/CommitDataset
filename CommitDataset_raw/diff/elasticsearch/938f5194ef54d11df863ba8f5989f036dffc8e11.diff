[+++ b/docs/plugins/repository-azure.asciidoc, +    Container name. Defaults to `elasticsearch-snapshots`, +++ b/docs/plugins/repository-azure.asciidoc, +    Container name. Defaults to `elasticsearch-snapshots`, +++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc, +++ b/docs/plugins/repository-azure.asciidoc, +    Container name. Defaults to `elasticsearch-snapshots`, +++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc, +++ b/docs/reference/search/request-body.asciidoc, +include::request/collapse.asciidoc[], +, +++ b/docs/plugins/repository-azure.asciidoc, +    Container name. Defaults to `elasticsearch-snapshots`, +++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc, +++ b/docs/reference/search/request-body.asciidoc, +include::request/collapse.asciidoc[], +, +++ b/docs/reference/search/request/collapse.asciidoc, +=== Field Collapsing, +==== Expand collapse results, +++ b/docs/plugins/repository-azure.asciidoc, +    Container name. Defaults to `elasticsearch-snapshots`, +++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc, +++ b/docs/reference/search/request-body.asciidoc, +include::request/collapse.asciidoc[], +, +++ b/docs/reference/search/request/collapse.asciidoc, +=== Field Collapsing, +==== Expand collapse results, +++ b/plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobStore.java, +    public void removeContainer(String container) throws URISyntaxException, StorageException, +    {, +        this.client.removeContainer(this.accountName, this.locMode, container);, +    }, +, +    public void createContainer(String container) throws URISyntaxException, StorageException, +    {, +        this.client.createContainer(this.accountName, this.locMode, container);, +    }, +, +++ b/docs/plugins/repository-azure.asciidoc, +    Container name. Defaults to `elasticsearch-snapshots`, +++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc, +++ b/docs/reference/search/request-body.asciidoc, +include::request/collapse.asciidoc[], +, +++ b/docs/reference/search/request/collapse.asciidoc, +=== Field Collapsing, +==== Expand collapse results, +++ b/plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobStore.java, +    public void removeContainer(String container) throws URISyntaxException, StorageException, +    {, +        this.client.removeContainer(this.accountName, this.locMode, container);, +    }, +, +    public void createContainer(String container) throws URISyntaxException, StorageException, +    {, +        this.client.createContainer(this.accountName, this.locMode, container);, +    }, +, +++ b/plugins/repository-azure/src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java, +import java.io.IOException;, +import java.net.URISyntaxException;, +import java.util.List;, +import java.util.Locale;, +import java.util.function.Function;, +, +import org.elasticsearch.common.xcontent.NamedXContentRegistry;, +import org.elasticsearch.repositories.IndexId;, +import org.elasticsearch.snapshots.SnapshotId;, +import org.elasticsearch.repositories.RepositoryVerificationException;, +import org.elasticsearch.snapshots.SnapshotCreationException;, +        try {, +            if (!blobStore.doesContainerExist(blobStore.container())) {, +                logger.debug("container [{}] does not exist. Creating...", blobStore.container());, +                blobStore.createContainer(blobStore.container());, +            super.initializeSnapshot(snapshotId, indices, clusterMetadata);, +        } catch (StorageException | URISyntaxException e) {, +            logger.warn("can not initialize container [{}]: [{}]", blobStore.container(), e.getMessage());, +            throw new SnapshotCreationException(getMetadata().name(), snapshotId, e);, +        }, +    }, +, +    @Override, +    public String startVerification() {, +        if (readonly == false) {, +            try {, +                if (!blobStore.doesContainerExist(blobStore.container())) {, +                    logger.debug("container [{}] does not exist. Creating...", blobStore.container());, +                    blobStore.createContainer(blobStore.container());, +                }, +            } catch (StorageException | URISyntaxException e) {, +                logger.warn("can not initialize container [{}]: [{}]", blobStore.container(), e.getMessage());, +                throw new RepositoryVerificationException(getMetadata().name(), "can not initialize container " + blobStore.container(), e);, +            }, +        }, +        return super.startVerification();, +++ b/docs/plugins/repository-azure.asciidoc, +    Container name. Defaults to `elasticsearch-snapshots`, +++ b/docs/reference/migration/migrate_6_0/plugins.asciidoc]