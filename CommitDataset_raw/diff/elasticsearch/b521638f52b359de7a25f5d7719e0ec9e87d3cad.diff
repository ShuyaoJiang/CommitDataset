[+++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (values.isEmpty() == false) {, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (values.isEmpty() == false) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java, +import org.apache.lucene.index.IndexOptions;, +                                FieldMapper geoHashMapper, MultiFields multiFields, Explicit<Boolean> ignoreMalformed, CopyTo copyTo);, +            FieldMapper geoHashMapper = null;, +                if (context.indexCreatedVersion().onOrAfter(Version.V_5_0_0_alpha1)) {, +                    geoHashMapper = new KeywordFieldMapper.Builder(Names.GEOHASH), +                            .index(true).includeInAll(false).store(fieldType.stored()).build(context);, +                } else {, +                    geoHashMapper = new StringFieldMapper.Builder(Names.GEOHASH), +                            .tokenized(false).index(true).omitNorms(true).indexOptions(IndexOptions.DOCS), +                            .includeInAll(false).store(fieldType.stored()).build(context);, +                }, +    protected FieldMapper geoHashMapper;, +                                      FieldMapper latMapper, FieldMapper lonMapper, FieldMapper geoHashMapper,, +        FieldMapper geoUpdated = geoHashMapper == null ? null : geoHashMapper.updateFieldType(fullNameToFieldType);, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (values.isEmpty() == false) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java, +import org.apache.lucene.index.IndexOptions;, +                                FieldMapper geoHashMapper, MultiFields multiFields, Explicit<Boolean> ignoreMalformed, CopyTo copyTo);, +            FieldMapper geoHashMapper = null;, +                if (context.indexCreatedVersion().onOrAfter(Version.V_5_0_0_alpha1)) {, +                    geoHashMapper = new KeywordFieldMapper.Builder(Names.GEOHASH), +                            .index(true).includeInAll(false).store(fieldType.stored()).build(context);, +                } else {, +                    geoHashMapper = new StringFieldMapper.Builder(Names.GEOHASH), +                            .tokenized(false).index(true).omitNorms(true).indexOptions(IndexOptions.DOCS), +                            .includeInAll(false).store(fieldType.stored()).build(context);, +                }, +    protected FieldMapper geoHashMapper;, +                                      FieldMapper latMapper, FieldMapper lonMapper, FieldMapper geoHashMapper,, +        FieldMapper geoUpdated = geoHashMapper == null ? null : geoHashMapper.updateFieldType(fullNameToFieldType);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java, +                                         FieldMapper lonMapper, FieldMapper geoHashMapper, MultiFields multiFields, Explicit<Boolean> ignoreMalformed,, +                               FieldMapper geoHashMapper, MultiFields multiFields, Explicit<Boolean> ignoreMalformed, CopyTo copyTo) {, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (values.isEmpty() == false) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java, +import org.apache.lucene.index.IndexOptions;, +                                FieldMapper geoHashMapper, MultiFields multiFields, Explicit<Boolean> ignoreMalformed, CopyTo copyTo);, +            FieldMapper geoHashMapper = null;, +                if (context.indexCreatedVersion().onOrAfter(Version.V_5_0_0_alpha1)) {, +                    geoHashMapper = new KeywordFieldMapper.Builder(Names.GEOHASH), +                            .index(true).includeInAll(false).store(fieldType.stored()).build(context);, +                } else {, +                    geoHashMapper = new StringFieldMapper.Builder(Names.GEOHASH), +                            .tokenized(false).index(true).omitNorms(true).indexOptions(IndexOptions.DOCS), +                            .includeInAll(false).store(fieldType.stored()).build(context);, +                }, +    protected FieldMapper geoHashMapper;, +                                      FieldMapper latMapper, FieldMapper lonMapper, FieldMapper geoHashMapper,, +        FieldMapper geoUpdated = geoHashMapper == null ? null : geoHashMapper.updateFieldType(fullNameToFieldType);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java, +                                         FieldMapper lonMapper, FieldMapper geoHashMapper, MultiFields multiFields, Explicit<Boolean> ignoreMalformed,, +                               FieldMapper geoHashMapper, MultiFields multiFields, Explicit<Boolean> ignoreMalformed, CopyTo copyTo) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java, +, +        @Override, +        public Object valueForSearch(Object value) {, +            if (value == null) {, +                return null;, +            }, +            // keywords are internally stored as utf8 bytes, +            BytesRef binaryValue = (BytesRef) value;, +            return binaryValue.utf8ToString();, +        }, +        // convert to utf8 only once before feeding postings/dv/stored fields, +        final BytesRef binaryValue = new BytesRef(value);, +            Field field = new Field(fieldType().name(), binaryValue, fieldType());, +            fields.add(new SortedSetDocValuesField(fieldType().name(), binaryValue));, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (values.isEmpty() == false) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java, +import org.apache.lucene.index.IndexOptions;, +                                FieldMapper geoHashMapper, MultiFields multiFields, Explicit<Boolean> ignoreMalformed, CopyTo copyTo);, +            FieldMapper geoHashMapper = null;, +                if (context.indexCreatedVersion().onOrAfter(Version.V_5_0_0_alpha1)) {, +                    geoHashMapper = new KeywordFieldMapper.Builder(Names.GEOHASH), +                            .index(true).includeInAll(false).store(fieldType.stored()).build(context);, +                } else {, +                    geoHashMapper = new StringFieldMapper.Builder(Names.GEOHASH), +                            .tokenized(false).index(true).omitNorms(true).indexOptions(IndexOptions.DOCS), +                            .includeInAll(false).store(fieldType.stored()).build(context);, +                }, +    protected FieldMapper geoHashMapper;, +                                      FieldMapper latMapper, FieldMapper lonMapper, FieldMapper geoHashMapper,, +        FieldMapper geoUpdated = geoHashMapper == null ? null : geoHashMapper.updateFieldType(fullNameToFieldType);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java, +                                         FieldMapper lonMapper, FieldMapper geoHashMapper, MultiFields multiFields, Explicit<Boolean> ignoreMalformed,, +                               FieldMapper geoHashMapper, MultiFields multiFields, Explicit<Boolean> ignoreMalformed, CopyTo copyTo) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java, +, +        @Override, +        public Object valueForSearch(Object value) {, +            if (value == null) {, +                return null;]