[+++ b/core/src/main/java/org/elasticsearch/discovery/DiscoveryStats.java, +import org.elasticsearch.Version;, +import org.elasticsearch.discovery.zen.PublishClusterStateStats;, +    private final PublishClusterStateStats publishStats;, +    public DiscoveryStats(PendingClusterStateStats queueStats, PublishClusterStateStats publishStats) {, +        this.publishStats = publishStats;, +, +        if (in.getVersion().onOrAfter(Version.V_7_0_0_alpha1)) {, +            publishStats = in.readOptionalWriteable(PublishClusterStateStats::new);, +        } else {, +            publishStats = null;, +        }, +, +        if (out.getVersion().onOrAfter(Version.V_7_0_0_alpha1)) {, +            out.writeOptionalWriteable(publishStats);, +        }, +        if (publishStats != null) {, +            publishStats.toXContent(builder, params);, +        }, +, +    public PublishClusterStateStats getPublishStats() {, +        return publishStats;, +    }, +++ b/core/src/main/java/org/elasticsearch/discovery/DiscoveryStats.java, +import org.elasticsearch.Version;, +import org.elasticsearch.discovery.zen.PublishClusterStateStats;, +    private final PublishClusterStateStats publishStats;, +    public DiscoveryStats(PendingClusterStateStats queueStats, PublishClusterStateStats publishStats) {, +        this.publishStats = publishStats;, +, +        if (in.getVersion().onOrAfter(Version.V_7_0_0_alpha1)) {, +            publishStats = in.readOptionalWriteable(PublishClusterStateStats::new);, +        } else {, +            publishStats = null;, +        }, +, +        if (out.getVersion().onOrAfter(Version.V_7_0_0_alpha1)) {, +            out.writeOptionalWriteable(publishStats);, +        }, +        if (publishStats != null) {, +            publishStats.toXContent(builder, params);, +        }, +, +    public PublishClusterStateStats getPublishStats() {, +        return publishStats;, +    }, +++ b/core/src/main/java/org/elasticsearch/discovery/single/SingleNodeDiscovery.java, +import org.elasticsearch.discovery.zen.PublishClusterStateStats;, +        return new DiscoveryStats(null, null);, +++ b/core/src/main/java/org/elasticsearch/discovery/DiscoveryStats.java, +import org.elasticsearch.Version;, +import org.elasticsearch.discovery.zen.PublishClusterStateStats;, +    private final PublishClusterStateStats publishStats;, +    public DiscoveryStats(PendingClusterStateStats queueStats, PublishClusterStateStats publishStats) {, +        this.publishStats = publishStats;, +, +        if (in.getVersion().onOrAfter(Version.V_7_0_0_alpha1)) {, +            publishStats = in.readOptionalWriteable(PublishClusterStateStats::new);, +        } else {, +            publishStats = null;, +        }, +, +        if (out.getVersion().onOrAfter(Version.V_7_0_0_alpha1)) {, +            out.writeOptionalWriteable(publishStats);, +        }, +        if (publishStats != null) {, +            publishStats.toXContent(builder, params);, +        }, +, +    public PublishClusterStateStats getPublishStats() {, +        return publishStats;, +    }, +++ b/core/src/main/java/org/elasticsearch/discovery/single/SingleNodeDiscovery.java, +import org.elasticsearch.discovery.zen.PublishClusterStateStats;, +        return new DiscoveryStats(null, null);, +++ b/core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java, +import java.util.concurrent.atomic.AtomicLong;, +    private final AtomicLong fullClusterStateReceivedCount = new AtomicLong();, +    private final AtomicLong incompatibleClusterStateDiffReceivedCount = new AtomicLong();, +    private final AtomicLong compatibleClusterStateDiffReceivedCount = new AtomicLong();, +, +                    fullClusterStateReceivedCount.incrementAndGet();, +                    compatibleClusterStateDiffReceivedCount.incrementAndGet();, +        } catch (IncompatibleClusterStateVersionException e) {, +            incompatibleClusterStateDiffReceivedCount.incrementAndGet();, +            throw e;, +, +    public PublishClusterStateStats stats() {, +        return new PublishClusterStateStats(, +            fullClusterStateReceivedCount.get(),, +            incompatibleClusterStateDiffReceivedCount.get(),, +            compatibleClusterStateDiffReceivedCount.get());, +    }, +++ b/core/src/main/java/org/elasticsearch/discovery/DiscoveryStats.java, +import org.elasticsearch.Version;, +import org.elasticsearch.discovery.zen.PublishClusterStateStats;, +    private final PublishClusterStateStats publishStats;, +    public DiscoveryStats(PendingClusterStateStats queueStats, PublishClusterStateStats publishStats) {, +        this.publishStats = publishStats;, +]