[+++ b/plugin/src/test/java/org/elasticsearch/xpack/security/authc/ldap/SearchGroupsResolverInMemoryTests.java, +import org.junit.After;, +    private LDAPConnection connection;, +, +    @After, +    public void closeConnection() {, +        if (connection != null) {, +            connection.close();, +        }, +    }, +, +        connect(options);, +    private void connect(LDAPConnectionOptions options) throws LDAPException {, +        if (connection != null) {, +            throw new IllegalStateException("Already connected (" + connection.getConnectionName() + ' ', +                    + connection.getConnectedAddress() + ')');, +        }, +        final LDAPURL ldapurl = new LDAPURL(ldapUrls()[0]);, +        this.connection = LdapUtils.privilegedConnect(() -> new LDAPConnection(options, ldapurl.getHost(), ldapurl.getPort()));, +    }, +]