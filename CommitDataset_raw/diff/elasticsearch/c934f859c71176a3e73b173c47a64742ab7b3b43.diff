[+++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java, +        public WithHash(String name, AggregatorFactories factories, ValuesSource.Bytes.WithOrdinals valuesSource,, +            if (globalOrds.getValueCount() == segmentOrds.getValueCount()) {, +            } else {, +                mapping = (GlobalOrdinalMapping) globalOrds;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java, +        public WithHash(String name, AggregatorFactories factories, ValuesSource.Bytes.WithOrdinals valuesSource,, +            if (globalOrds.getValueCount() == segmentOrds.getValueCount()) {, +            } else {, +                mapping = (GlobalOrdinalMapping) globalOrds;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java, +                        (ValuesSource.Bytes.WithOrdinals) valuesSource, order, bucketCountThresholds, filter, aggregationContext,, +                if (includeExclude != null || factories.count() > 0, +                        // we need the FieldData impl to be able to extract the, +                        // segment to global ord mapping, +                        || valuesSource.getClass() != ValuesSource.Bytes.FieldData.class) {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java, +        public WithHash(String name, AggregatorFactories factories, ValuesSource.Bytes.WithOrdinals valuesSource,, +            if (globalOrds.getValueCount() == segmentOrds.getValueCount()) {, +            } else {, +                mapping = (GlobalOrdinalMapping) globalOrds;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java, +                        (ValuesSource.Bytes.WithOrdinals) valuesSource, order, bucketCountThresholds, filter, aggregationContext,, +                if (includeExclude != null || factories.count() > 0, +                        // we need the FieldData impl to be able to extract the, +                        // segment to global ord mapping, +                        || valuesSource.getClass() != ValuesSource.Bytes.FieldData.class) {, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/MissingValueIT.java, +import org.elasticsearch.search.aggregations.bucket.terms.TermsAggregatorFactory.ExecutionMode;, +        for (ExecutionMode mode : ExecutionMode.values()) {, +            SearchResponse response = client().prepareSearch("idx").addAggregation(, +                    terms("my_terms"), +                        .field("str"), +                        .executionHint(mode.toString()), +                        .missing("bar")).get();, +    }]