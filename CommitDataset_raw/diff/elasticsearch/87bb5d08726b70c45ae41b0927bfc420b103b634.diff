[+++ b/docs/plugins/repository-s3.asciidoc, +The S3 repository plugin adds support for using AWS S3 as a repository for, +*If you are looking for a hosted solution of Elasticsearch on AWS, please visit, +http://www.elastic.co/cloud.*, +==== Getting Started, +The plugin provides a repository type named `s3` which may be used when creating, +a repository. The repository defaults to using, +https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-iam-roles.html[ECS, +IAM Role] or, +http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html[EC2, +IAM Role] credentials for authentication. The only mandatory setting is the, +bucket name:, +The client that you use to connect to S3 has a number of settings available., +The settings have the form `s3.client.CLIENT_NAME.SETTING_NAME`. By default,, +`s3` repositories use a client named `default`, but this can be modified using, +the <<repository-s3-repository,repository setting>> `client`. For example:, +// TEST[skip:we don't have S3 setup while testing this], +NOTE: In-progress snapshot/restore tasks will not be preempted by a *reload* of, +the client's secure settings. The task will complete using the client as it was, +built when the operation started., +    An S3 access key. The `secret_key` setting must also be specified., +    An S3 secret key. The `access_key` setting must also be specified., +, +    An S3 session token. The `access_key` and `secret_key` settings must also be, +    specified. (Secure), +    The S3 service endpoint to connect to. This defaults to `s3.amazonaws.com`, +    but the, +    http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region[AWS, +    documentation] lists alternative S3 endpoints. If you are using an, +    <<repository-s3-compatible-services,S3-compatible service>> then you should, +    set this to the service's endpoint., +    The protocol to use to connect to S3. Valid values are either `http` or, +    `https`. Defaults to `https`., +    The host name of a proxy to connect to S3 through., +    The port of a proxy to connect to S3 through., +    The socket timeout for connecting to S3. The value should specify the unit., +    For example, a value of `5s` specifies a 5 second timeout. The default value, +    is 50 seconds., +    The number of retries to use when an S3 request fails. The default value is, +    `3`., +    Whether retries should be throttled (i.e. should back off). Must be `true`, +    or `false`. Defaults to `true`., +, +[float], +[[repository-s3-compatible-services]], +===== S3-compatible services, +, +There are a number of storage systems that provide an S3-compatible API, and, +the `repository-s3` plugin allows you to use these systems in place of AWS S3., +To do so, you should set the `s3.client.CLIENT_NAME.endpoint` setting to the, +system's endpoint. This setting accepts IP addresses and hostnames and may, +include a port. For example, the endpoint may be `172.17.0.2` or, +`172.17.0.2:9000`. You may also need to set `s3.client.CLIENT_NAME.protocol` to, +`http` if the endpoint does not support HTTPS., +, +https://minio.io[Minio] is an example of a storage system that provides an, +S3-compatible API. The `repository-s3` plugin allows {es} to work with, +Minio-backed repositories as well as repositories stored on AWS S3. Other, +S3-compatible storage systems may also work with {es}, but these are not tested, +or supported., +The `s3` repository type supports a number of settings to customize how data is, +stored in S3. These can be specified when creating the repository. For example:, +// TEST[skip:we don't have S3 set up while testing this], +    The name of the <<repository-s3-client,S3 client>> to use to connect to S3., +    Defaults to `default`., +    Specifies the path within bucket to repository data. Defaults to value of, +    `repositories.s3.base_path` or to root directory if not set.  Previously,, +    the base_path could take a leading `/` (forward slash).  However, this has, +    been deprecated and setting the base_path now should omit the leading `/`., +    Big files can be broken down into chunks during snapshotting if needed.  The, +    chunk size can be specified in bytes or by using size value notation, i.e., +    `1gb`, `10mb`, `5kb`. Defaults to `1gb`., +    Minimum threshold below which the chunk is uploaded using a single request., +    Beyond this threshold, the S3 repository will use the, +    http://docs.aws.amazon.com/AmazonS3/latest/dev/uploadobjusingmpu.html[AWS, +    Multipart Upload API] to split the chunk into several parts, each of, +    `buffer_size` length, and to upload each part in its own request. Note that, +    setting a buffer size lower than `5mb` is not allowed since it will prevent, +    the use of the Multipart API and may result in upload errors. It is also not, +    possible to set a buffer size greater than `5gb` as it is the maximum upload, +    size allowed by S3. Defaults to the minimum between `100mb` and `5%` of the, +    heap size., +    The S3 repository supports all, +    http://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl[S3, +    canned ACLs] : `private`, `public-read`, `public-read-write`,, +    `authenticated-read`, `log-delivery-write`, `bucket-owner-read`,, +    `bucket-owner-full-control`. Defaults to `private`.  You could specify a, +    canned ACL using the `canned_acl` setting. When the S3 repository creates, +    buckets and objects, it adds the canned ACL into the buckets and objects., +    Values may be `standard`, `reduced_redundancy`, `standard_ia`.  Defaults to, +    `standard`. Changing this setting on an existing repository only affects the, +    storage class for newly created objects, resulting in a mixed usage of, +    storage classes. Additionally, S3 Lifecycle Policies can be used to manage, +    the storage class of existing objects.  Due to the extra complexity with the, +    Glacier class lifecycle, it is not currently supported by the plugin.  For, +    more information about the different classes, see, +    http://docs.aws.amazon.com/AmazonS3/latest/dev/storage-class-intro.html[AWS, +    Storage Classes Guide], +NOTE: The option of defining client settings in the repository settings as, +documented below is considered deprecated, and will be removed in a future]