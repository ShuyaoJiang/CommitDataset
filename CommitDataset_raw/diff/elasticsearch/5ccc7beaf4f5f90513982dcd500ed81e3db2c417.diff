[+++ b/pom.xml, +, +        <dependency>, +            <groupId>commons-cli</groupId>, +            <artifactId>commons-cli</artifactId>, +            <version>1.2</version>, +        </dependency>, +, +                            <include>commons-cli:commons-cli</include>, +                        <relocation>, +                            <pattern>org.apache.commons.cli</pattern>, +                            <shadedPattern>org.elasticsearch.common.cli.commons</shadedPattern>, +                        </relocation>, +                                <exclude>org/elasticsearch/common/http/client/HttpDownloadHelper*</exclude>, +                                <exclude>org/elasticsearch/common/cli/Terminal*</exclude>, +                                <exclude>org/elasticsearch/common/http/client/HttpDownloadHelper.class</exclude>, +++ b/pom.xml, +, +        <dependency>, +            <groupId>commons-cli</groupId>, +            <artifactId>commons-cli</artifactId>, +            <version>1.2</version>, +        </dependency>, +, +                            <include>commons-cli:commons-cli</include>, +                        <relocation>, +                            <pattern>org.apache.commons.cli</pattern>, +                            <shadedPattern>org.elasticsearch.common.cli.commons</shadedPattern>, +                        </relocation>, +                                <exclude>org/elasticsearch/common/http/client/HttpDownloadHelper*</exclude>, +                                <exclude>org/elasticsearch/common/cli/Terminal*</exclude>, +                                <exclude>org/elasticsearch/common/http/client/HttpDownloadHelper.class</exclude>, +++ b/src/main/java/org/elasticsearch/common/cli/CliTool.java, +/*, + * Licensed to Elasticsearch under one or more contributor, + * license agreements. See the NOTICE file distributed with, + * this work for additional information regarding copyright, + * ownership. Elasticsearch licenses this file to you under, + * the Apache License, Version 2.0 (the "License"); you may, + * not use this file except in compliance with the License., + * You may obtain a copy of the License at, + *, + *    http://www.apache.org/licenses/LICENSE-2.0, + *, + * Unless required by applicable law or agreed to in writing,, + * software distributed under the License is distributed on an, + * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY, + * KIND, either express or implied.  See the License for the, + * specific language governing permissions and limitations, + * under the License., + */, +, +package org.elasticsearch.common.cli;, +, +import com.google.common.base.Preconditions;, +import org.apache.commons.cli.CommandLine;, +import org.apache.commons.cli.CommandLineParser;, +import org.apache.commons.cli.GnuParser;, +import org.elasticsearch.ElasticsearchIllegalArgumentException;, +import org.elasticsearch.common.collect.Tuple;, +import org.elasticsearch.common.settings.Settings;, +import org.elasticsearch.env.Environment;, +import org.elasticsearch.node.internal.InternalSettingsPreparer;, +, +import java.io.IOException;, +import java.util.Locale;, +, +import static org.elasticsearch.common.settings.ImmutableSettings.Builder.EMPTY_SETTINGS;, +, +/**, + * A base class for command-line interface tool., + *, + * Two modes are supported:, + *, + * - Single command mode. The tool exposes a single command that can potentially accept arguments (eg. CLI options)., + * - Multi command mode. The tool support multiple commands, each for different tasks, each potentially accepts arguments., + *, + * In a multi-command mode. The first argument must be the command name. For example, the plugin manager, + * can be seen as a multi-command tool with two possible commands: install and uninstall, + *, + * The tool is configured using a {@link CliToolConfig} which encapsulates the tool's commands and their, + * potential options. The tool also comes with out of the box simple help support (the -h/--help option is, + * automatically handled) where the help text is configured in a dedicated *.help files located in the same package, + * as the tool., + */, +public abstract class CliTool {, +, +    // based on sysexits.h, +    public static enum ExitStatus {, +        OK(0),, +        USAGE(64),          /* command line usage error */, +        DATA_ERROR(65),     /* data format error */, +        NO_INPUT(66),       /* cannot open input */, +        NO_USER(67),        /* addressee unknown */, +        NO_HOST(68),        /* host name unknown */, +        UNAVAILABLE(69),    /* service unavailable */, +        CODE_ERROR(70),     /* internal software error */, +        CANT_CREATE(73),    /* can't create (user) output file */, +        IO_ERROR(74),       /* input/output error */, +        TEMP_FAILURE(75),   /* temp failure; user is invited to retry */]