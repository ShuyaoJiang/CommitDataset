[+++ b/core/src/main/java/org/elasticsearch/search/SearchModule.java, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.avg.AvgBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.max.MaxBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.min.MinBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.percentile.PercentilesBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.sum.SumBucketPipelineAggregatorBuilder;, +        registerPipelineAggregation(MaxBucketPipelineAggregatorBuilder::new, MaxBucketPipelineAggregatorBuilder.PARSER,, +                MaxBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(MinBucketPipelineAggregatorBuilder::new, MinBucketPipelineAggregatorBuilder.PARSER,, +                MinBucketPipelineAggregatorBuilder.AGGREGATION_FIELD_NAME);, +        registerPipelineAggregation(AvgBucketPipelineAggregatorBuilder::new, AvgBucketPipelineAggregatorBuilder.PARSER,, +                AvgBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(SumBucketPipelineAggregatorBuilder::new, SumBucketPipelineAggregatorBuilder.PARSER,, +                SumBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(PercentilesBucketPipelineAggregatorBuilder::new, PercentilesBucketPipelineAggregatorBuilder.PARSER,, +                PercentilesBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +++ b/core/src/main/java/org/elasticsearch/search/SearchModule.java, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.avg.AvgBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.max.MaxBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.min.MinBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.percentile.PercentilesBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.sum.SumBucketPipelineAggregatorBuilder;, +        registerPipelineAggregation(MaxBucketPipelineAggregatorBuilder::new, MaxBucketPipelineAggregatorBuilder.PARSER,, +                MaxBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(MinBucketPipelineAggregatorBuilder::new, MinBucketPipelineAggregatorBuilder.PARSER,, +                MinBucketPipelineAggregatorBuilder.AGGREGATION_FIELD_NAME);, +        registerPipelineAggregation(AvgBucketPipelineAggregatorBuilder::new, AvgBucketPipelineAggregatorBuilder.PARSER,, +                AvgBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(SumBucketPipelineAggregatorBuilder::new, SumBucketPipelineAggregatorBuilder.PARSER,, +                SumBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(PercentilesBucketPipelineAggregatorBuilder::new, PercentilesBucketPipelineAggregatorBuilder.PARSER,, +                PercentilesBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/SearchModule.java, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.avg.AvgBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.max.MaxBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.min.MinBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.percentile.PercentilesBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.sum.SumBucketPipelineAggregatorBuilder;, +        registerPipelineAggregation(MaxBucketPipelineAggregatorBuilder::new, MaxBucketPipelineAggregatorBuilder.PARSER,, +                MaxBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(MinBucketPipelineAggregatorBuilder::new, MinBucketPipelineAggregatorBuilder.PARSER,, +                MinBucketPipelineAggregatorBuilder.AGGREGATION_FIELD_NAME);, +        registerPipelineAggregation(AvgBucketPipelineAggregatorBuilder::new, AvgBucketPipelineAggregatorBuilder.PARSER,, +                AvgBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(SumBucketPipelineAggregatorBuilder::new, SumBucketPipelineAggregatorBuilder.PARSER,, +                SumBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(PercentilesBucketPipelineAggregatorBuilder::new, PercentilesBucketPipelineAggregatorBuilder.PARSER,, +                PercentilesBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/avg/AvgBucketPipelineAggregatorBuilder.java, +import org.elasticsearch.common.ParseField;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.BucketMetricsParser;, +    public static final String NAME = AvgBucketPipelineAggregator.TYPE.name();, +    public static final ParseField AGGREGATION_NAME_FIELD = new ParseField(NAME);, +        super(name, AvgBucketPipelineAggregator.TYPE.name(), new String[] { bucketsPath });, +    /**, +     * Read from a stream., +     */, +    public AvgBucketPipelineAggregatorBuilder(StreamInput in) throws IOException {, +        super(in, NAME);, +    }, +, +    @Override, +    protected void innerWriteTo(StreamOutput out) throws IOException {, +        // Do nothing, no extra state to write to stream, +    }, +, +    @Override, +    protected boolean usesNewStyleSerialization() {, +        return true;, +    public static final PipelineAggregator.Parser PARSER = new BucketMetricsParser() {, +        protected AvgBucketPipelineAggregatorBuilder buildFactory(String pipelineAggregatorName,, +                String bucketsPath, Map<String, Object> unparsedParams) {, +            return new AvgBucketPipelineAggregatorBuilder(pipelineAggregatorName, bucketsPath);, +    };, +    @Override, +    public String getWriteableName() {, +        return NAME;, +    }, +++ b/core/src/main/java/org/elasticsearch/search/SearchModule.java, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.avg.AvgBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.max.MaxBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.min.MinBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.percentile.PercentilesBucketPipelineAggregatorBuilder;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.sum.SumBucketPipelineAggregatorBuilder;, +        registerPipelineAggregation(MaxBucketPipelineAggregatorBuilder::new, MaxBucketPipelineAggregatorBuilder.PARSER,, +                MaxBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(MinBucketPipelineAggregatorBuilder::new, MinBucketPipelineAggregatorBuilder.PARSER,, +                MinBucketPipelineAggregatorBuilder.AGGREGATION_FIELD_NAME);, +        registerPipelineAggregation(AvgBucketPipelineAggregatorBuilder::new, AvgBucketPipelineAggregatorBuilder.PARSER,, +                AvgBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(SumBucketPipelineAggregatorBuilder::new, SumBucketPipelineAggregatorBuilder.PARSER,, +                SumBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +        registerPipelineAggregation(PercentilesBucketPipelineAggregatorBuilder::new, PercentilesBucketPipelineAggregatorBuilder.PARSER,, +                PercentilesBucketPipelineAggregatorBuilder.AGGREGATION_NAME_FIELD);, +++ /dev/null, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/avg/AvgBucketPipelineAggregatorBuilder.java, +import org.elasticsearch.common.ParseField;, +import org.elasticsearch.search.aggregations.pipeline.bucketmetrics.BucketMetricsParser;]