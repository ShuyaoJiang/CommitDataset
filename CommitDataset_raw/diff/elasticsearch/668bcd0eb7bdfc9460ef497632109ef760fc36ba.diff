[+++ b/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +        long[] versions = new long[request.items().length];, +                    versions[i] = indexRequest.version();, +                        // restore updated versions..., +                        for (int j = 0; j < i; j++) {, +                            applyVersion(request.items()[j], versions[j]);, +                        }, +                        // restore updated versions..., +                        for (int j = 0; j < i; j++) {, +                            applyVersion(request.items()[j], versions[j]);, +                        }, +, +    private void applyVersion(BulkItemRequest item, long version) {, +        if (item.request() instanceof IndexRequest) {, +            ((IndexRequest) item.request()).version(version);, +        } else if (item.request() instanceof DeleteRequest) {, +            ((DeleteRequest) item.request()).version(version);, +        } else {, +            // log?, +        }, +    }, +++ b/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +        long[] versions = new long[request.items().length];, +                    versions[i] = indexRequest.version();, +                        // restore updated versions..., +                        for (int j = 0; j < i; j++) {, +                            applyVersion(request.items()[j], versions[j]);, +                        }, +                        // restore updated versions..., +                        for (int j = 0; j < i; j++) {, +                            applyVersion(request.items()[j], versions[j]);, +                        }, +, +    private void applyVersion(BulkItemRequest item, long version) {, +        if (item.request() instanceof IndexRequest) {, +            ((IndexRequest) item.request()).version(version);, +        } else if (item.request() instanceof DeleteRequest) {, +            ((DeleteRequest) item.request()).version(version);, +        } else {, +            // log?, +        }, +    }, +++ b/src/test/java/org/elasticsearch/test/integration/recovery/RelocationTests.java, +    @Test, +    public void testPrimaryRelocationWhileBulkIndexingWith1RelocationAnd1Writer() throws Exception {, +        testPrimaryRelocationWhileIndexing(1, 1, true);, +    }, +, +    @Test, +    public void testPrimaryRelocationWhileBulkIndexingWith10RelocationAnd1Writer() throws Exception {, +        testPrimaryRelocationWhileIndexing(10, 1, true);, +    }, +, +    @Test, +    public void testPrimaryRelocationWhileBulkIndexingWith10RelocationAnd5Writers() throws Exception {, +        testPrimaryRelocationWhileIndexing(10, 5, true);, +    }, +    @Test, +    public void testReplicaRelocationWhileBulkIndexingWith1RelocationAnd1Writer() throws Exception {, +        testReplicaRelocationWhileIndexing(1, 1, true);, +    }, +, +    @Test, +    public void testReplicaRelocationWhileBulkIndexingWith10RelocationAnd1Writer() throws Exception {, +        testReplicaRelocationWhileIndexing(10, 1, true);, +    }, +, +    @Test, +    public void testReplicaRelocationWhileBulkIndexingWith10RelocationAnd5Writers() throws Exception {, +        testReplicaRelocationWhileIndexing(10, 5, true);, +    }, +]