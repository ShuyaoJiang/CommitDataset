[+++ b/distribution/archives/build.gradle, +++ b/distribution/archives/build.gradle, +++ b/qa/vagrant/README.md, +Despite the name, commands run with this class are not run in a shell, and any, +familiar features of shells like variables or expansion won't work., +, +If you do need the shell, you must explicitly invoke the shell's command. For, +example to run a command with Bash, use the `bash -c command` syntax. Note that, +the entire script must be in a single string argument, +sh.run("bash", "-c", "echo $foo; echo $bar");, +Similary for powershell - again, the entire powershell script must go in a, +single string argument, +```java, +sh.run("powershell.exe", "-Command", "Write-Host $foo; Write-Host $bar");, +```, +On Linux, most commands you'll want to use will be executable files and will, +work fine without a shell, +, +```java, +sh.run("tar", "-xzpf", "elasticsearch-6.1.0.tar.gz");, +```, +, +On Windows you'll mostly want to use powershell as it can do a lot more and, +gives much better feedback than Windows' legacy command line. Unfortunately that, +means that you'll need to use the `powershell.exe -Command` syntax as, +powershell's [Cmdlets](https://msdn.microsoft.com/en-us/library/ms714395.aspx), +don't correspond to executable files and are not runnable by `Runtime` directly., +, +When writing powershell commands this way, make sure to test them as some types, +of formatting can cause it to return a successful exit code but not run, +anything., +++ b/distribution/archives/build.gradle, +++ b/qa/vagrant/README.md, +Despite the name, commands run with this class are not run in a shell, and any, +familiar features of shells like variables or expansion won't work., +, +If you do need the shell, you must explicitly invoke the shell's command. For, +example to run a command with Bash, use the `bash -c command` syntax. Note that, +the entire script must be in a single string argument, +sh.run("bash", "-c", "echo $foo; echo $bar");, +Similary for powershell - again, the entire powershell script must go in a, +single string argument, +```java, +sh.run("powershell.exe", "-Command", "Write-Host $foo; Write-Host $bar");, +```, +On Linux, most commands you'll want to use will be executable files and will, +work fine without a shell, +, +```java, +sh.run("tar", "-xzpf", "elasticsearch-6.1.0.tar.gz");, +```, +, +On Windows you'll mostly want to use powershell as it can do a lot more and, +gives much better feedback than Windows' legacy command line. Unfortunately that, +means that you'll need to use the `powershell.exe -Command` syntax as, +powershell's [Cmdlets](https://msdn.microsoft.com/en-us/library/ms714395.aspx), +don't correspond to executable files and are not runnable by `Runtime` directly., +, +When writing powershell commands this way, make sure to test them as some types, +of formatting can cause it to return a successful exit code but not run, +anything., +++ b/qa/vagrant/src/main/java/org/elasticsearch/packaging/util/Archives.java, +                sh.run("tar", "-C", baseInstallPath.toString(), "-xzpf", distributionFile.toString());, +                sh.run("unzip", distributionFile.toString(), "-d", baseInstallPath.toString());, +                sh.run("powershell.exe", "-Command",, +                    "[IO.Compression.ZipFile]::ExtractToDirectory('" + distributionFile + "', '" + baseInstallPath + "')");, +        if (sh.runIgnoreExitCode("getent", "group", "elasticsearch").isSuccess() == false) {, +                sh.run("addgroup", "--system", "elasticsearch");, +                sh.run("groupadd", "-r", "elasticsearch");, +        if (sh.runIgnoreExitCode("id", "elasticsearch").isSuccess() == false) {, +                sh.run("adduser",, +                    "--quiet",, +                    "--system",, +                    "--no-create-home",, +                    "--ingroup", "elasticsearch",, +                    "--disabled-password",, +                    "--shell", "/bin/false",, +                sh.run("useradd",, +                    "--system",, +                    "-M",, +                    "--gid", "elasticsearch",, +                    "--shell", "/sbin/nologin",, +                    "--comment", "elasticsearch user",, +        sh.run("chown", "-R", "elasticsearch:elasticsearch", installPath.toString());, +++ b/distribution/archives/build.gradle, +++ b/qa/vagrant/README.md, +Despite the name, commands run with this class are not run in a shell, and any, +familiar features of shells like variables or expansion won't work., +, +If you do need the shell, you must explicitly invoke the shell's command. For, +example to run a command with Bash, use the `bash -c command` syntax. Note that, +the entire script must be in a single string argument, +sh.run("bash", "-c", "echo $foo; echo $bar");, +Similary for powershell - again, the entire powershell script must go in a, +single string argument, +```java, +sh.run("powershell.exe", "-Command", "Write-Host $foo; Write-Host $bar");, +```, +On Linux, most commands you'll want to use will be executable files and will, +work fine without a shell]