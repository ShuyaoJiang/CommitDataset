[+++ b/elasticsearch/qa/messy-test-xpack-with-mustache/build.gradle, +, +/*, + * Messy tests that depend on mustache directly. Fix these!, + */, +, +apply plugin: 'elasticsearch.messy-test', +, +dependencies {, +  testCompile project(path: ':x-plugins:elasticsearch:x-pack', configuration: 'testArtifacts'), +  testCompile project(path: ':modules:lang-mustache', configuration: 'runtime'), +}, +++ b/elasticsearch/qa/messy-test-xpack-with-mustache/build.gradle, +, +/*, + * Messy tests that depend on mustache directly. Fix these!, + */, +, +apply plugin: 'elasticsearch.messy-test', +, +dependencies {, +  testCompile project(path: ':x-plugins:elasticsearch:x-pack', configuration: 'testArtifacts'), +  testCompile project(path: ':modules:lang-mustache', configuration: 'runtime'), +}, +++ b/elasticsearch/qa/messy-test-xpack-with-mustache/src/test/java/org/elasticsearch/messy/tests/SearchInputIT.java, +/*, + * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one, + * or more contributor license agreements. Licensed under the Elastic License;, + * you may not use this file except in compliance with the Elastic License., + */, +package org.elasticsearch.messy.tests;, +, +import org.elasticsearch.action.admin.cluster.storedscripts.PutStoredScriptRequest;, +import org.elasticsearch.action.search.SearchRequest;, +import org.elasticsearch.action.search.SearchType;, +import org.elasticsearch.common.bytes.BytesArray;, +import org.elasticsearch.common.io.Streams;, +import org.elasticsearch.common.settings.Settings;, +import org.elasticsearch.common.unit.TimeValue;, +import org.elasticsearch.common.xcontent.ToXContent;, +import org.elasticsearch.common.xcontent.XContentBuilder;, +import org.elasticsearch.common.xcontent.XContentParser;, +import org.elasticsearch.common.xcontent.json.JsonXContent;, +import org.elasticsearch.common.xcontent.support.XContentMapValues;, +import org.elasticsearch.indices.query.IndicesQueriesRegistry;, +import org.elasticsearch.plugins.Plugin;, +import org.elasticsearch.plugins.ScriptPlugin;, +import org.elasticsearch.script.ScriptContext;, +import org.elasticsearch.script.ScriptService;, +import org.elasticsearch.script.mustache.MustachePlugin;, +import org.elasticsearch.search.aggregations.AggregatorParsers;, +import org.elasticsearch.search.builder.SearchSourceBuilder;, +import org.elasticsearch.search.suggest.Suggesters;, +import org.elasticsearch.test.ESIntegTestCase;, +import org.elasticsearch.test.ESIntegTestCase.ClusterScope;, +import org.elasticsearch.xpack.common.text.TextTemplate;, +import org.elasticsearch.xpack.watcher.actions.ActionWrapper;, +import org.elasticsearch.xpack.watcher.actions.ExecutableActions;, +import org.elasticsearch.xpack.watcher.condition.always.ExecutableAlwaysCondition;, +import org.elasticsearch.xpack.watcher.execution.TriggeredExecutionContext;, +import org.elasticsearch.xpack.watcher.execution.WatchExecutionContext;, +import org.elasticsearch.xpack.watcher.input.Input;, +import org.elasticsearch.xpack.watcher.input.search.ExecutableSearchInput;, +import org.elasticsearch.xpack.watcher.input.search.SearchInput;, +import org.elasticsearch.xpack.watcher.input.search.SearchInputFactory;, +import org.elasticsearch.xpack.watcher.input.simple.ExecutableSimpleInput;, +import org.elasticsearch.xpack.watcher.input.simple.SimpleInput;, +import org.elasticsearch.xpack.watcher.support.WatcherScript;, +import org.elasticsearch.xpack.watcher.support.init.proxy.WatcherClientProxy;, +import org.elasticsearch.xpack.watcher.support.search.WatcherSearchTemplateRequest;, +import org.elasticsearch.xpack.watcher.support.search.WatcherSearchTemplateService;, +import org.elasticsearch.xpack.watcher.support.xcontent.XContentSource;, +import org.elasticsearch.xpack.watcher.trigger.schedule.IntervalSchedule;, +import org.elasticsearch.xpack.watcher.trigger.schedule.ScheduleTrigger;, +import org.elasticsearch.xpack.watcher.trigger.schedule.ScheduleTriggerEvent;, +import org.elasticsearch.xpack.watcher.watch.Payload;, +import org.elasticsearch.xpack.watcher.watch.Watch;, +import org.elasticsearch.xpack.watcher.watch.WatchStatus;, +import org.joda.time.DateTime;, +import org.joda.time.chrono.ISOChronology;, +, +import java.io.IOException;, +import java.io.InputStream;, +import java.io.OutputStream;, +import java.nio.file.Files;, +import java.nio.file.Path;, +import java.util.ArrayList;, +import java.util.Collection;, +import java.util.HashMap;, +import java.util.Map;, +, +import static java.util.Collections.emptyMap;, +import static org.elasticsearch.common.unit.TimeValue.timeValueSeconds;, +import static org.elasticsearch.common.xcontent.XContentFactory.jsonBuilder;, +import static org.elasticsearch.index.query.QueryBuilders.boolQuery;, +import static org.elasticsearch.index.query.QueryBuilders.matchQuery;, +import static org.elasticsearch.index.query.QueryBuilders.rangeQuery;, +import static org.elasticsearch.search.builder.SearchSourceBuilder.searchSource;, +import static org.elasticsearch.test.ESIntegTestCase.Scope.SUITE;, +import static org.elasticsearch.xpack.watcher.test.WatcherTestUtils.getRandomSupportedSearchType;]