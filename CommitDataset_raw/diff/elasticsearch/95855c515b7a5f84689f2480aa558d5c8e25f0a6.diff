[+++ b/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java, +import java.util.*;, +, +        Map<Integer, List<String>> nrReplicasChanged = new HashMap<Integer, List<String>>();, +, +, +                        if (!nrReplicasChanged.containsKey(numberOfReplicas)) {, +                            nrReplicasChanged.put(numberOfReplicas, new ArrayList<String>());, +                        nrReplicasChanged.get(numberOfReplicas).add(indexMetaData.index());, +, +        if (nrReplicasChanged.size() > 0) {, +            for (final Integer fNumberOfReplicas : nrReplicasChanged.keySet()) {, +                Settings settings = ImmutableSettings.settingsBuilder().put(IndexMetaData.SETTING_NUMBER_OF_REPLICAS, fNumberOfReplicas).build();, +                final List<String> indices = nrReplicasChanged.get(fNumberOfReplicas);, +, +                updateSettings(settings, indices.toArray(new String[indices.size()]), TimeValue.timeValueMinutes(10), new Listener() {, +                    @Override, +                    public void onSuccess() {, +                        for (String index : indices) {, +                            logger.info("[{}] auto expanded replicas to [{}]", index, fNumberOfReplicas);, +                        }, +                    }, +, +                    @Override, +                    public void onFailure(Throwable t) {, +                        for (String index : indices) {, +                            logger.warn("[{}] fail to auto expand replicas to [{}]", index, fNumberOfReplicas);, +                        }, +                    }, +                });, +            }, +        }]