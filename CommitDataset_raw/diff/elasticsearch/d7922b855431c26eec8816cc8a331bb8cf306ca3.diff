[+++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java, +                // simply ignore non active shards, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java, +                // simply ignore non active shards, +++ b/src/main/java/org/elasticsearch/action/count/TransportCountAction.java, +                // simply ignore non active shards, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java, +                // simply ignore non active shards, +++ b/src/main/java/org/elasticsearch/action/count/TransportCountAction.java, +                // simply ignore non active shards, +++ b/src/main/java/org/elasticsearch/action/percolate/TransportPercolateAction.java, +                // simply ignore non active shards, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java, +                // simply ignore non active shards, +++ b/src/main/java/org/elasticsearch/action/count/TransportCountAction.java, +                // simply ignore non active shards, +++ b/src/main/java/org/elasticsearch/action/percolate/TransportPercolateAction.java, +                // simply ignore non active shards, +++ b/src/main/java/org/elasticsearch/action/search/SearchResponse.java, +            if (successfulShards == 0 && totalShards > 0) {, +                return RestStatus.SERVICE_UNAVAILABLE;, +            }, +        // if total failure, bubble up the status code to the response level, +            RestStatus status = RestStatus.OK;, +            for (int i = 0; i < shardFailures.length; i++) {, +                RestStatus shardStatus = shardFailures[i].status();, +                if (shardStatus.getStatus() >= status.getStatus()) {, +        // we don't return totalShards - successfulShards, we don't count "no shards available" as a failed shard, just don't, +        // count it in the successful counter, +        return shardFailures.length;, +++ b/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +++ b/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java]