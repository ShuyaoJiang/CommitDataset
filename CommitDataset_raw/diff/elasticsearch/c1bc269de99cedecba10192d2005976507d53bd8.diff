[+++ b/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java, +        final Set<String> mappingTypesToUpdate = Sets.newHashSet();, +                        if (result.mappingTypeToUpdate != null) {, +                            mappingTypesToUpdate.add(result.mappingTypeToUpdate);, +                        if (e.mappingTypeToUpdate != null) {, +                            mappingTypesToUpdate.add(e.mappingTypeToUpdate);, +                        for (String mappingTypeToUpdate : mappingTypesToUpdate) {, +                            DocumentMapper docMapper = indexService.mapperService().documentMapper(mappingTypeToUpdate);, +                                mappingUpdatedAction.updateMappingOnMaster(indexService.index().name(), docMapper, indexService.indexUUID());, +                                if (result.mappingTypeToUpdate != null) {, +                                    mappingTypesToUpdate.add(result.mappingTypeToUpdate);, +        for (String mappingTypToUpdate : mappingTypesToUpdate) {, +            DocumentMapper docMapper = indexService.mapperService().documentMapper(mappingTypToUpdate);, +                mappingUpdatedAction.updateMappingOnMaster(indexService.index().name(), docMapper, indexService.indexUUID());, +        final String mappingTypeToUpdate;, +        WriteResult(Object response, String mappingTypeToUpdate, Engine.IndexingOperation op) {, +            this.mappingTypeToUpdate = mappingTypeToUpdate;, +        final String mappingTypeToUpdate;, +        WriteFailure(Throwable cause, String mappingTypeToUpdate) {, +            this.mappingTypeToUpdate = mappingTypeToUpdate;, +        String mappingTypeToUpdate = null;, +                    mappingTypeToUpdate = indexRequest.type();, +                    mappingTypeToUpdate = indexRequest.type();, +            throw new WriteFailure(t, mappingTypeToUpdate);, +        return new WriteResult(indexResponse, mappingTypeToUpdate, op);]