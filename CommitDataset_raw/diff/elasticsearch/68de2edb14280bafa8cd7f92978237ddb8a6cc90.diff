[+++ b/server/src/main/java/org/elasticsearch/index/shard/RefreshListeners.java, +            List<Tuple<Translog.Location, Consumer<Boolean>>> listeners = refreshListeners;, +            final int maxRefreshes = getMaxRefreshListeners.getAsInt();, +            if (refreshForcers == 0 && maxRefreshes > 0 && (listeners == null || listeners.size() < maxRefreshes)) {, +                if (listeners == null) {, +                    listeners = new ArrayList<>();, +                }, +                refreshListeners = listeners;]