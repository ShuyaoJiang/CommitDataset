[+++ b/src/main/java/org/elasticsearch/common/compress/CompressedDirectory.java, +import com.google.common.collect.ImmutableList;, +            dir.sync(ImmutableList.of(name));, +    public IndexInput openInput(String name, IOContext context) throws IOException {, +            IndexInput in = dir.openInput(name, context);, +        return dir.openInput(name, context);, +    public IndexOutput createOutput(String name, IOContext context) throws IOException {, +            return compressor.indexOutput(dir.createOutput(name, context));, +        return dir.createOutput(name, context);, +++ b/src/main/java/org/elasticsearch/common/compress/CompressedDirectory.java, +import com.google.common.collect.ImmutableList;, +            dir.sync(ImmutableList.of(name));, +    public IndexInput openInput(String name, IOContext context) throws IOException {, +            IndexInput in = dir.openInput(name, context);, +        return dir.openInput(name, context);, +    public IndexOutput createOutput(String name, IOContext context) throws IOException {, +            return compressor.indexOutput(dir.createOutput(name, context));, +        return dir.createOutput(name, context);, +++ b/src/main/java/org/elasticsearch/common/compress/CompressedIndexInput.java, +    public IndexInput clone() {, +++ b/src/main/java/org/elasticsearch/common/compress/CompressedDirectory.java, +import com.google.common.collect.ImmutableList;, +            dir.sync(ImmutableList.of(name));, +    public IndexInput openInput(String name, IOContext context) throws IOException {, +            IndexInput in = dir.openInput(name, context);, +        return dir.openInput(name, context);, +    public IndexOutput createOutput(String name, IOContext context) throws IOException {, +            return compressor.indexOutput(dir.createOutput(name, context));, +        return dir.createOutput(name, context);, +++ b/src/main/java/org/elasticsearch/common/compress/CompressedIndexInput.java, +    public IndexInput clone() {, +++ b/src/main/java/org/elasticsearch/common/lucene/store/SwitchDirectory.java, +import com.google.common.collect.ImmutableList;, +import org.apache.lucene.store.IOContext;, +    public IndexOutput createOutput(String name, IOContext context) throws IOException {, +        return getDirectory(name).createOutput(name, context);, +            dir.sync(ImmutableList.of(name));, +    public IndexInput openInput(String name, IOContext context) throws IOException {, +        return getDirectory(name).openInput(name, context);]