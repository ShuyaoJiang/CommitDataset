[+++ b/plugin/src/main/java/org/elasticsearch/xpack/security/authc/esnative/tool/CommandLineHttpClient.java, +    public static final String HTTP_SSL_SETTING = setting("http.ssl.");, +            Settings sslSettings = settings.getByPrefix(HTTP_SSL_SETTING);, +++ b/plugin/src/main/java/org/elasticsearch/xpack/security/authc/esnative/tool/CommandLineHttpClient.java, +    public static final String HTTP_SSL_SETTING = setting("http.ssl.");, +            Settings sslSettings = settings.getByPrefix(HTTP_SSL_SETTING);, +++ b/plugin/src/main/java/org/elasticsearch/xpack/security/authc/esnative/tool/SetupPasswordTool.java, +import javax.net.ssl.SSLException;, +import java.io.IOException;, +import java.net.HttpURLConnection;, +import java.net.SocketException;, +import java.net.URL;, +import java.nio.charset.StandardCharsets;, +import java.security.SecureRandom;, +import java.util.Arrays;, +import java.util.HashMap;, +import java.util.List;, +import java.util.Map;, +, +            terminal.println(Verbosity.VERBOSE, "Running with configuration path: " + env.configFile());, +            checkElasticKeystorePasswordValid(terminal, env);, +            terminal.println(Verbosity.VERBOSE, "Running with configuration path: " + env.configFile());, +            checkElasticKeystorePasswordValid(terminal, env);, +        void checkElasticKeystorePasswordValid(Terminal terminal, Environment env) throws Exception {, +                terminal.println(Verbosity.VERBOSE, "");, +                    terminal.println("");, +                    terminal.println("Failed to authenticate user '" + elasticUser + "' against " + route.toString());, +                    terminal.println("Possible causes include:");, +                    terminal.println(" * The password for the '" + elasticUser + "' user has already been changed on this cluster");, +                    terminal.println(" * Your elasticsearch node is running against a different keystore");, +                    terminal.println("   This tool used the keystore at " + KeyStoreWrapper.keystorePath(env.configFile()));, +                    terminal.println("");, +                    throw new UserException(ExitCodes.CONFIG, "Failed to verify bootstrap password");, +            } catch (SocketException e) {, +                terminal.println("");, +                terminal.println("Cannot connect to elasticsearch node.");, +                e.printStackTrace(terminal.getWriter());, +                terminal.println("");, +            } catch (SSLException e) {, +                terminal.println("");, +                terminal.println("SSL connection to " + route.toString() + " failed: " + e.getMessage());, +                terminal.println("Please check the elasticsearch SSL settings under " + CommandLineHttpClient.HTTP_SSL_SETTING);, +                terminal.println("");, +                e.printStackTrace(terminal.getWriter());, +                terminal.println("");, +                throw new UserException(ExitCodes.CONFIG,, +                        "Failed to establish SSL connection to elasticsearch at " + route.toString() + ". ", e);]