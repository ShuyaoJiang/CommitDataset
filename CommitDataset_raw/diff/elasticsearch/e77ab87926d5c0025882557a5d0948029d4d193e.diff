[+++ b/client/src/main/java/org/elasticsearch/client/ElasticsearchResponseException.java, +import org.apache.http.client.methods.CloseableHttpResponse;, +    private final CloseableHttpResponse response;, +    public ElasticsearchResponseException(RequestLine requestLine, HttpHost host, CloseableHttpResponse response) {, +        super(buildMessage(requestLine, host, response));, +        this.response = response;, +    private static String buildMessage(RequestLine requestLine, HttpHost host, CloseableHttpResponse response) {, +        return requestLine.getMethod() + " " + host + requestLine.getUri() + ": " + response.getStatusLine().toString();, +        int statusCode = response.getStatusLine().getStatusCode();, +        return statusCode >= 502 && statusCode <= 504;, +     * Returns the {@link CloseableHttpResponse} that was returned by elasticsearch, +    public CloseableHttpResponse getResponse() {, +        return response;, +++ b/client/src/main/java/org/elasticsearch/client/ElasticsearchResponseException.java, +import org.apache.http.client.methods.CloseableHttpResponse;, +    private final CloseableHttpResponse response;, +    public ElasticsearchResponseException(RequestLine requestLine, HttpHost host, CloseableHttpResponse response) {, +        super(buildMessage(requestLine, host, response));, +        this.response = response;, +    private static String buildMessage(RequestLine requestLine, HttpHost host, CloseableHttpResponse response) {, +        return requestLine.getMethod() + " " + host + requestLine.getUri() + ": " + response.getStatusLine().toString();, +        int statusCode = response.getStatusLine().getStatusCode();, +        return statusCode >= 502 && statusCode <= 504;, +     * Returns the {@link CloseableHttpResponse} that was returned by elasticsearch, +    public CloseableHttpResponse getResponse() {, +        return response;, +++ b/client/src/main/java/org/elasticsearch/client/RestClient.java, +            throw new ElasticsearchResponseException(request.getRequestLine(), connection.getHost(), response);, +++ b/client/src/main/java/org/elasticsearch/client/ElasticsearchResponseException.java, +import org.apache.http.client.methods.CloseableHttpResponse;, +    private final CloseableHttpResponse response;, +    public ElasticsearchResponseException(RequestLine requestLine, HttpHost host, CloseableHttpResponse response) {, +        super(buildMessage(requestLine, host, response));, +        this.response = response;, +    private static String buildMessage(RequestLine requestLine, HttpHost host, CloseableHttpResponse response) {, +        return requestLine.getMethod() + " " + host + requestLine.getUri() + ": " + response.getStatusLine().toString();, +        int statusCode = response.getStatusLine().getStatusCode();, +        return statusCode >= 502 && statusCode <= 504;, +     * Returns the {@link CloseableHttpResponse} that was returned by elasticsearch, +    public CloseableHttpResponse getResponse() {, +        return response;, +++ b/client/src/main/java/org/elasticsearch/client/RestClient.java, +            throw new ElasticsearchResponseException(request.getRequestLine(), connection.getHost(), response);, +++ b/client/src/main/java/org/elasticsearch/client/sniff/Sniffer.java, +                throw new ElasticsearchResponseException(httpGet.getRequestLine(), host, response);, +++ b/client/src/main/java/org/elasticsearch/client/ElasticsearchResponseException.java, +import org.apache.http.client.methods.CloseableHttpResponse;, +    private final CloseableHttpResponse response;, +    public ElasticsearchResponseException(RequestLine requestLine, HttpHost host, CloseableHttpResponse response) {, +        super(buildMessage(requestLine, host, response));, +        this.response = response;, +    private static String buildMessage(RequestLine requestLine, HttpHost host, CloseableHttpResponse response) {, +        return requestLine.getMethod() + " " + host + requestLine.getUri() + ": " + response.getStatusLine().toString();, +        int statusCode = response.getStatusLine().getStatusCode();, +        return statusCode >= 502 && statusCode <= 504;, +     * Returns the {@link CloseableHttpResponse} that was returned by elasticsearch, +    public CloseableHttpResponse getResponse() {, +        return response;, +++ b/client/src/main/java/org/elasticsearch/client/RestClient.java, +            throw new ElasticsearchResponseException(request.getRequestLine(), connection.getHost(), response);, +++ b/client/src/main/java/org/elasticsearch/client/sniff/Sniffer.java, +                throw new ElasticsearchResponseException(httpGet.getRequestLine(), host, response);, +++ b/client/src/test/java/org/elasticsearch/client/sniff/SnifferTests.java, +                assertThat(e.getResponse().getStatusLine().getStatusCode(), equalTo(sniffResponse.nodesInfoResponseCode));, +                fail("sniffNodes should have succeeded: " + e.getResponse().getStatusLine());]