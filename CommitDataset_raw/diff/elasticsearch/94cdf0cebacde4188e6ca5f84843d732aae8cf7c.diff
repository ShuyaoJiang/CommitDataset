[+++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            //TODO: remove this once the cname is prepended to the address by default in 7.0, +            systemProperty 'es.http.cname_in_publish_address', 'true', +, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            //TODO: remove this once the cname is prepended to the address by default in 7.0, +            systemProperty 'es.http.cname_in_publish_address', 'true', +, +++ b/docs/build.gradle, +  //TODO: remove this once the cname is prepended to the address by default in 7.0, +  systemProperty 'es.http.cname_in_publish_address', 'true', +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            //TODO: remove this once the cname is prepended to the address by default in 7.0, +            systemProperty 'es.http.cname_in_publish_address', 'true', +, +++ b/docs/build.gradle, +  //TODO: remove this once the cname is prepended to the address by default in 7.0, +  systemProperty 'es.http.cname_in_publish_address', 'true', +++ b/modules/lang-painless/build.gradle, +  systemProperty 'es.http.cname_in_publish_address', 'true', +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            //TODO: remove this once the cname is prepended to the address by default in 7.0, +            systemProperty 'es.http.cname_in_publish_address', 'true', +, +++ b/docs/build.gradle, +  //TODO: remove this once the cname is prepended to the address by default in 7.0, +  systemProperty 'es.http.cname_in_publish_address', 'true', +++ b/modules/lang-painless/build.gradle, +  systemProperty 'es.http.cname_in_publish_address', 'true', +++ b/server/src/main/java/org/elasticsearch/http/HttpInfo.java, +import org.apache.logging.log4j.LogManager;, +import org.elasticsearch.common.logging.DeprecationLogger;, +import org.elasticsearch.common.network.InetAddresses;, +import org.elasticsearch.common.transport.TransportAddress;, +import static org.elasticsearch.common.Booleans.parseBoolean;, +, +    private static final DeprecationLogger DEPRECATION_LOGGER = new DeprecationLogger(LogManager.getLogger(HttpInfo.class));, +, +    /** Whether to add hostname to publish host field when serializing. */, +    private static final boolean CNAME_IN_PUBLISH_HOST =, +        parseBoolean(System.getProperty("es.http.cname_in_publish_address"), false);, +, +    private final boolean cnameInPublishHost;, +        this(BoundTransportAddress.readBoundTransportAddress(in), in.readLong(), CNAME_IN_PUBLISH_HOST);, +    }, +, +    public HttpInfo(BoundTransportAddress address, long maxContentLength) {, +        this(address, maxContentLength, CNAME_IN_PUBLISH_HOST);, +    }, +, +    HttpInfo(BoundTransportAddress address, long maxContentLength, boolean cnameInPublishHost) {, +        this.address = address;, +        this.maxContentLength = maxContentLength;, +        this.cnameInPublishHost = cnameInPublishHost;, +        TransportAddress publishAddress = address.publishAddress();, +        String publishAddressString = publishAddress.toString();, +        String hostString = publishAddress.address().getHostString();, +        if (InetAddresses.isInetAddress(hostString) == false) {, +            if (cnameInPublishHost) {, +                publishAddressString = hostString + '/' + publishAddress.toString();, +            } else {, +                DEPRECATION_LOGGER.deprecated(, +                    "[http.publish_host] was printed as [ip:port] instead of [hostname/ip:port]. ", +                        + "This format is deprecated and will change to [hostname/ip:port] in a future version. ", +                        + "Use -Des.http.cname_in_publish_address=true to enforce non-deprecated formatting.", +                );, +            }, +        }, +        builder.field(Fields.PUBLISH_ADDRESS, publishAddressString);, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +            //TODO: remove this once the cname is prepended to the address by default in 7.0, +            systemProperty 'es.http.cname_in_publish_address', 'true', +, +++ b/docs/build.gradle, +  //TODO: remove this once the cname is prepended to the address by default in 7.0, +  systemProperty 'es.http.cname_in_publish_address', 'true', +++ b/modules/lang-painless/build.gradle, +  systemProperty 'es.http.cname_in_publish_address', 'true', +++ b/server/src/main/java/org/elasticsearch/http/HttpInfo.java, +import org.apache.logging.log4j.LogManager;, +import org.elasticsearch.common.logging.DeprecationLogger;, +import org.elasticsearch.common.network.InetAddresses;, +import org.elasticsearch.common.transport.TransportAddress;, +import static org.elasticsearch.common.Booleans.parseBoolean;, +, +    private static final DeprecationLogger DEPRECATION_LOGGER = new DeprecationLogger(LogManager.getLogger(HttpInfo.class));, +, +    /** Whether to add hostname to publish host field when serializing. */, +    private static final boolean CNAME_IN_PUBLISH_HOST =, +        parseBoolean(System.getProperty("es.http.cname_in_publish_address"), false);, +, +    private final boolean cnameInPublishHost;, +        this(BoundTransportAddress.readBoundTransportAddress(in), in.readLong(), CNAME_IN_PUBLISH_HOST);, +    }, +, +    public HttpInfo(BoundTransportAddress address, long maxContentLength) {, +        this(address, maxContentLength, CNAME_IN_PUBLISH_HOST);, +    }, +, +    HttpInfo(BoundTransportAddress address, long maxContentLength, boolean cnameInPublishHost) {]