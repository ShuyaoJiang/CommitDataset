[+++ b/server/src/main/java/org/elasticsearch/search/aggregations/support/AggregationPath.java, +import org.elasticsearch.search.profile.aggregation.ProfilingAggregator;, +            aggregator = ProfilingAggregator.unwrap(aggregator.subAggregator(token.name));, +        Aggregator aggregator = ProfilingAggregator.unwrap(root.subAggregator(token.name));, +            aggregator = ProfilingAggregator.unwrap(aggregator.subAggregator(pathElements.get(i).name));, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/support/AggregationPath.java, +import org.elasticsearch.search.profile.aggregation.ProfilingAggregator;, +            aggregator = ProfilingAggregator.unwrap(aggregator.subAggregator(token.name));, +        Aggregator aggregator = ProfilingAggregator.unwrap(root.subAggregator(token.name));, +            aggregator = ProfilingAggregator.unwrap(aggregator.subAggregator(pathElements.get(i).name));, +++ b/server/src/main/java/org/elasticsearch/search/profile/aggregation/ProfilingAggregator.java, +, +    public static Aggregator unwrap(Aggregator agg) {, +        if (agg instanceof ProfilingAggregator) {, +            return ((ProfilingAggregator) agg).delegate;, +        }, +        return agg;, +    }, +++ b/server/src/main/java/org/elasticsearch/search/aggregations/support/AggregationPath.java, +import org.elasticsearch.search.profile.aggregation.ProfilingAggregator;, +            aggregator = ProfilingAggregator.unwrap(aggregator.subAggregator(token.name));, +        Aggregator aggregator = ProfilingAggregator.unwrap(root.subAggregator(token.name));, +            aggregator = ProfilingAggregator.unwrap(aggregator.subAggregator(pathElements.get(i).name));, +++ b/server/src/main/java/org/elasticsearch/search/profile/aggregation/ProfilingAggregator.java, +, +    public static Aggregator unwrap(Aggregator agg) {, +        if (agg instanceof ProfilingAggregator) {, +            return ((ProfilingAggregator) agg).delegate;, +        }, +        return agg;, +    }, +++ b/server/src/test/java/org/elasticsearch/search/profile/aggregation/AggregationProfilerIT.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +                .addAggregation(, +                    histogram("histo"), +                        .field(NUMBER_FIELD), +                        .interval(1L), +                        .subAggregation(, +                            terms("terms"), +                                .field(TAG_FIELD), +                                .order(BucketOrder.aggregation("avg", false)), +                                .subAggregation(avg("avg").field(NUMBER_FIELD)), +                        ), +                ).get();]