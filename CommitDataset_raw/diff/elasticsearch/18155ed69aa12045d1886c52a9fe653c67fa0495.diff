[+++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, Object> options = (Map)this.options;, +            Map<String, Object> options = (Map)this.options;, +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, Object> options = (Map)this.options;, +            Map<String, Object> options = (Map)this.options;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, Object> options = (Map)this.options;, +            Map<String, Object> options = (Map)this.options;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, Object> options = (Map)this.options;, +            Map<String, Object> options = (Map)this.options;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, Object> options = (Map)this.options;, +            Map<String, Object> options = (Map)this.options;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/HyperLogLogPlusPlus.java, +    private Set<Object> getComparableData(long bucket) {, +        Set<Object> values = new HashSet<>();, +                values.add(runLens.get((bucket << p) + i));, +                Objects.equals(getComparableData(bucket), getComparableData(bucket));, +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, Object> options = (Map)this.options;, +            Map<String, Object> options = (Map)this.options;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/HyperLogLogPlusPlus.java, +    private Set<Object> getComparableData(long bucket) {, +        Set<Object> values = new HashSet<>();, +                values.add(runLens.get((bucket << p) + i));, +                Objects.equals(getComparableData(bucket), getComparableData(bucket));, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBounds.java, +        return bottom == other.bottom &&, +++ b/core/src/main/java/org/elasticsearch/script/Script.java, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, String> options = (Map)in.readMap();, +            Map<String, Object> options = (Map)this.options;, +            Map<String, Object> options = (Map)this.options;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java, +import org.elasticsearch.search.aggregations.BucketOrder;, +import org.elasticsearch.search.aggregations.InternalOrder;, +import org.elasticsearch.search.aggregations.KeyComparable;, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/HyperLogLogPlusPlus.java, +    private Set<Object> getComparableData(long bucket) {, +        Set<Object> values = new HashSet<>();, +                values.add(runLens.get((bucket << p) + i));, +                Objects.equals(getComparableData(bucket), getComparableData(bucket));]