[+++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4TcpChannel.java, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4TcpChannel.java, +++ b/plugins/transport-nio/src/main/java/org/elasticsearch/transport/nio/NioTcpChannel.java, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4TcpChannel.java, +++ b/plugins/transport-nio/src/main/java/org/elasticsearch/transport/nio/NioTcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpChannel.java, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4TcpChannel.java, +++ b/plugins/transport-nio/src/main/java/org/elasticsearch/transport/nio/NioTcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpTransport.java, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4TcpChannel.java, +++ b/plugins/transport-nio/src/main/java/org/elasticsearch/transport/nio/NioTcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpTransport.java, +++ b/server/src/test/java/org/elasticsearch/transport/TcpTransportTests.java, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4TcpChannel.java, +++ b/plugins/transport-nio/src/main/java/org/elasticsearch/transport/nio/NioTcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpTransport.java, +++ b/server/src/test/java/org/elasticsearch/transport/TcpTransportTests.java, +++ b/test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4TcpChannel.java, +++ b/plugins/transport-nio/src/main/java/org/elasticsearch/transport/nio/NioTcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpTransport.java, +++ b/server/src/test/java/org/elasticsearch/transport/TcpTransportTests.java, +++ b/test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java, +++ b/test/framework/src/main/java/org/elasticsearch/transport/nio/MockNioTransport.java, +import java.io.UncheckedIOException;, +            nioChannel.addConnectListener((v, e) -> {, +                if (e == null) {, +                    if (channel.isConnected()) {, +                        try {, +                            channel.setOption(StandardSocketOptions.SO_LINGER, 0);, +                        } catch (IOException ex) {, +                            throw new UncheckedIOException(new IOException());, +                        }, +                    }, +                }, +            });, +++ b/modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4TcpChannel.java, +++ b/plugins/transport-nio/src/main/java/org/elasticsearch/transport/nio/NioTcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpChannel.java, +++ b/server/src/main/java/org/elasticsearch/transport/TcpTransport.java, +++ b/server/src/test/java/org/elasticsearch/transport/TcpTransportTests.java, +++ b/test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java, +++ b/test/framework/src/main/java/org/elasticsearch/transport/nio/MockNioTransport.java, +import java.io.UncheckedIOException;, +            nioChannel.addConnectListener((v, e) -> {, +                if (e == null) {, +                    if (channel.isConnected()) {, +                        try {, +                            channel.setOption(StandardSocketOptions.SO_LINGER, 0);, +                        } catch (IOException ex) {, +                            throw new UncheckedIOException(new IOException());, +                        }, +                    }, +                }, +            });, +++ b/test/framework/src/test/java/org/elasticsearch/transport/nio/SimpleMockNioTransportTests.java]