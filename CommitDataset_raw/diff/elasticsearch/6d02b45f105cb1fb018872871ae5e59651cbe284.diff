[+++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java, +import org.elasticsearch.common.network.NetworkModule;, +import org.elasticsearch.transport.MockTcpTransportPlugin;, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +        String transport = randomTestTransport();, +                .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +        String transport = randomTestTransport();, +                        .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java, +import org.elasticsearch.common.network.NetworkModule;, +import org.elasticsearch.transport.MockTcpTransportPlugin;, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +        String transport = randomTestTransport();, +                .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +        String transport = randomTestTransport();, +                        .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +, +import java.io.IOException;, +import java.util.Arrays;, +        String transport = randomTestTransport();, +            .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java, +import org.elasticsearch.common.network.NetworkModule;, +import org.elasticsearch.transport.MockTcpTransportPlugin;, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +        String transport = randomTestTransport();, +                .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +        String transport = randomTestTransport();, +                        .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +, +import java.io.IOException;, +import java.util.Arrays;, +        String transport = randomTestTransport();, +            .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientRetryIT.java, +import org.elasticsearch.common.network.NetworkModule;, +import org.elasticsearch.transport.MockTcpTransportPlugin;, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +        String transport = randomTestTransport();, +, +                .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(),transport), +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java, +import org.elasticsearch.common.network.NetworkModule;, +import org.elasticsearch.transport.MockTcpTransportPlugin;, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +        String transport = randomTestTransport();, +                .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +        String transport = randomTestTransport();, +                        .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +, +import java.io.IOException;, +import java.util.Arrays;, +        String transport = randomTestTransport();, +            .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientRetryIT.java, +import org.elasticsearch.common.network.NetworkModule;, +import org.elasticsearch.transport.MockTcpTransportPlugin;, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +        String transport = randomTestTransport();, +, +                .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(),transport), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java, +import org.elasticsearch.transport.MockTcpTransportPlugin;, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +    public static String randomTestTransport() {, +        return randomBoolean() ? NioTransportPlugin.NIO_TRANSPORT_NAME : MockTcpTransportPlugin.MOCK_TCP_TRANSPORT_NAME;, +    }, +, +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java, +import org.elasticsearch.common.network.NetworkModule;, +import org.elasticsearch.transport.MockTcpTransportPlugin;, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +        String transport = randomTestTransport();, +                .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +        String transport = randomTestTransport();, +                        .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +, +import java.io.IOException;, +import java.util.Arrays;, +        String transport = randomTestTransport();, +            .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(), transport), +++ b/core/src/test/java/org/elasticsearch/client/transport/TransportClientRetryIT.java, +import org.elasticsearch.common.network.NetworkModule;, +import org.elasticsearch.transport.MockTcpTransportPlugin;, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +        String transport = randomTestTransport();, +, +                .put(NetworkModule.TRANSPORT_TYPE_SETTING.getKey(),transport), +++ b/test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java, +import org.elasticsearch.transport.MockTcpTransportPlugin;, +import org.elasticsearch.transport.nio.NioTransportPlugin;, +    public static String randomTestTransport() {]