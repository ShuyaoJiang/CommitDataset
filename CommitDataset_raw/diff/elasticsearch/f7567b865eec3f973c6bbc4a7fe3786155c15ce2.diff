[+++ b/server/src/test/java/org/elasticsearch/discovery/MasterDisruptionIT.java, +import static org.hamcrest.Matchers.hasSize;, +        final Map<String, List<Tuple<String, String>>> masters = Collections.synchronizedMap(new HashMap<>());, +            masters.put(node, new ArrayList<>());, +                    public ClusterState execute(ClusterState currentState) {, +            assertThat("[" + nodeName + "] Each node should only record two master node transitions",, +                recordedMasterTransition, hasSize(2));, +            assertThat("[" + nodeName + "] First transition's previous master should be [" + oldMasterNode + "]",, +                recordedMasterTransition.get(0).v1(), equalTo(oldMasterNode));, +            assertThat("[" + nodeName + "] First transition's current master should be [null]",, +                recordedMasterTransition.get(0).v2(), nullValue());, +            assertThat("[" + nodeName + "] Second transition's previous master should be [null]",, +                recordedMasterTransition.get(1).v1(), nullValue());, +    private void assertDiscoveryCompleted(List<String> nodes) throws InterruptedException {]