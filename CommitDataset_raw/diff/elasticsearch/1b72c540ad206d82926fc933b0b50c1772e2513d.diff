[+++ b/elasticsearch/x-pack/build.gradle, +++ b/elasticsearch/x-pack/build.gradle, +++ b/elasticsearch/x-pack/license-plugin/src/test/java/org/elasticsearch/license/LicenseServiceClusterTests.java, +        return Arrays.asList(XPackPlugin.class, MockNetty3Plugin.class);, +++ b/elasticsearch/x-pack/build.gradle, +++ b/elasticsearch/x-pack/license-plugin/src/test/java/org/elasticsearch/license/LicenseServiceClusterTests.java, +        return Arrays.asList(XPackPlugin.class, MockNetty3Plugin.class);, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/agent/settings/MonitoringSettingsTests.java, +++ b/elasticsearch/x-pack/build.gradle, +++ b/elasticsearch/x-pack/license-plugin/src/test/java/org/elasticsearch/license/LicenseServiceClusterTests.java, +        return Arrays.asList(XPackPlugin.class, MockNetty3Plugin.class);, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/agent/settings/MonitoringSettingsTests.java, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/security/MonitoringSettingsFilterTests.java, +++ b/elasticsearch/x-pack/build.gradle, +++ b/elasticsearch/x-pack/license-plugin/src/test/java/org/elasticsearch/license/LicenseServiceClusterTests.java, +        return Arrays.asList(XPackPlugin.class, MockNetty3Plugin.class);, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/agent/settings/MonitoringSettingsTests.java, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/security/MonitoringSettingsFilterTests.java, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/Security.java, +                    .put(NetworkModule.HTTP_TYPE_KEY, "netty3"), +                    .put(NetworkModule.TRANSPORT_TYPE_KEY, "netty3"), +        settingsBuilder.put(NetworkModule.TRANSPORT_TYPE_KEY, Security.NAME);, +        settingsBuilder.put(NetworkModule.HTTP_TYPE_SETTING.getKey(), Security.NAME);, +        SecurityNetty3HttpServerTransport.overrideSettings(settingsBuilder, settings);, +++ b/elasticsearch/x-pack/build.gradle, +++ b/elasticsearch/x-pack/license-plugin/src/test/java/org/elasticsearch/license/LicenseServiceClusterTests.java, +        return Arrays.asList(XPackPlugin.class, MockNetty3Plugin.class);, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/agent/settings/MonitoringSettingsTests.java, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/security/MonitoringSettingsFilterTests.java, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/Security.java, +                    .put(NetworkModule.HTTP_TYPE_KEY, "netty3"), +                    .put(NetworkModule.TRANSPORT_TYPE_KEY, "netty3"), +        settingsBuilder.put(NetworkModule.TRANSPORT_TYPE_KEY, Security.NAME);, +        settingsBuilder.put(NetworkModule.HTTP_TYPE_SETTING.getKey(), Security.NAME);, +        SecurityNetty3HttpServerTransport.overrideSettings(settingsBuilder, settings);, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/rest/SecurityRestFilter.java, +        assert request instanceof Netty3HttpRequest;, +            Certificate[] certs = handler.getEngine().getSession().getPeerCertificates();, +                logger.trace("SSL Peer did not present a certificate on channel [{}]", e, nettyHttpRequest.getChannel());, +                logger.debug("SSL Peer did not present a certificate on channel [{}]", nettyHttpRequest.getChannel());, +++ b/elasticsearch/x-pack/build.gradle, +++ b/elasticsearch/x-pack/license-plugin/src/test/java/org/elasticsearch/license/LicenseServiceClusterTests.java, +        return Arrays.asList(XPackPlugin.class, MockNetty3Plugin.class);, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/agent/settings/MonitoringSettingsTests.java, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/security/MonitoringSettingsFilterTests.java, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/Security.java, +                    .put(NetworkModule.HTTP_TYPE_KEY, "netty3"), +                    .put(NetworkModule.TRANSPORT_TYPE_KEY, "netty3"), +        settingsBuilder.put(NetworkModule.TRANSPORT_TYPE_KEY, Security.NAME);, +        settingsBuilder.put(NetworkModule.HTTP_TYPE_SETTING.getKey(), Security.NAME);, +        SecurityNetty3HttpServerTransport.overrideSettings(settingsBuilder, settings);, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/rest/SecurityRestFilter.java, +        assert request instanceof Netty3HttpRequest;, +            Certificate[] certs = handler.getEngine().getSession().getPeerCertificates();, +                logger.trace("SSL Peer did not present a certificate on channel [{}]", e, nettyHttpRequest.getChannel());, +                logger.debug("SSL Peer did not present a certificate on channel [{}]", nettyHttpRequest.getChannel());, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/transport/SecurityServerTransportService.java, +        if (!(transport instanceof SecurityNetty3Transport)) {, +++ b/elasticsearch/x-pack/build.gradle, +++ b/elasticsearch/x-pack/license-plugin/src/test/java/org/elasticsearch/license/LicenseServiceClusterTests.java, +        return Arrays.asList(XPackPlugin.class, MockNetty3Plugin.class);, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/agent/settings/MonitoringSettingsTests.java, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/security/MonitoringSettingsFilterTests.java, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/Security.java, +                    .put(NetworkModule.HTTP_TYPE_KEY, "netty3"), +                    .put(NetworkModule.TRANSPORT_TYPE_KEY, "netty3"), +        settingsBuilder.put(NetworkModule.TRANSPORT_TYPE_KEY, Security.NAME);, +        settingsBuilder.put(NetworkModule.HTTP_TYPE_SETTING.getKey(), Security.NAME);, +        SecurityNetty3HttpServerTransport.overrideSettings(settingsBuilder, settings);, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/rest/SecurityRestFilter.java, +        assert request instanceof Netty3HttpRequest;, +            Certificate[] certs = handler.getEngine().getSession().getPeerCertificates();, +                logger.trace("SSL Peer did not present a certificate on channel [{}]", e, nettyHttpRequest.getChannel());, +                logger.debug("SSL Peer did not present a certificate on channel [{}]", nettyHttpRequest.getChannel());, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/transport/SecurityServerTransportService.java, +        if (!(transport instanceof SecurityNetty3Transport)) {, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/transport/ServerTransportFilter.java, +            if (extractClientCert && (unwrappedChannel instanceof TcpTransportChannel), +                    && ((TcpTransportChannel) unwrappedChannel).getChannel() instanceof Channel) {, +                    Certificate[] certs = sslHandler.getEngine().getSession().getPeerCertificates();, +, +            Authentication authentication = authcService.authenticate(securityAction, request, null);, +            authzService.authorize(authentication, securityAction, request);, +        }, +++ b/elasticsearch/x-pack/build.gradle, +++ b/elasticsearch/x-pack/license-plugin/src/test/java/org/elasticsearch/license/LicenseServiceClusterTests.java, +        return Arrays.asList(XPackPlugin.class, MockNetty3Plugin.class);, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/agent/settings/MonitoringSettingsTests.java, +++ b/elasticsearch/x-pack/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/security/MonitoringSettingsFilterTests.java, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/Security.java, +                    .put(NetworkModule.HTTP_TYPE_KEY, "netty3"), +                    .put(NetworkModule.TRANSPORT_TYPE_KEY, "netty3"), +        settingsBuilder.put(NetworkModule.TRANSPORT_TYPE_KEY, Security.NAME);, +        settingsBuilder.put(NetworkModule.HTTP_TYPE_SETTING.getKey(), Security.NAME);, +        SecurityNetty3HttpServerTransport.overrideSettings(settingsBuilder, settings);, +++ b/elasticsearch/x-pack/security/src/main/java/org/elasticsearch/xpack/security/rest/SecurityRestFilter.java, +        assert request instanceof Netty3HttpRequest;, +            Certificate[] certs = handler.getEngine().getSession().getPeerCertificates();, +                logger.trace("SSL Peer did not present a certificate on channel [{}]", e, nettyHttpRequest.getChannel());, +                logger.debug("SSL Peer did not present a certificate on channel [{}]", nettyHttpRequest.getChannel());]