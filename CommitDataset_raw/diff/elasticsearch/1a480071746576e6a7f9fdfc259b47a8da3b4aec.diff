[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/gateway/GatewayService.java, +                    boolean ignoreTimeout;, +                    if (expectedNodes == -1 && expectedMasterNodes == -1 && expectedDataNodes == -1) {, +                        // no expected is set, don't ignore the timeout, +                        ignoreTimeout = false;, +                    } else {, +                        // one of the expected is set, see if all of them meet the need, and ignore the timeout in this case, +                        ignoreTimeout = true;, +                        if (expectedNodes != -1 && (nodes.masterAndDataNodes().size() < expectedNodes)) { // does not meet the expected..., +                            ignoreTimeout = false;, +                        }, +                        if (expectedMasterNodes != -1 && (nodes.masterNodes().size() < expectedMasterNodes)) { // does not meet the expected..., +                            ignoreTimeout = false;, +                        }, +                        if (expectedDataNodes != -1 && (nodes.dataNodes().size() < expectedDataNodes)) { // does not meet the expected..., +                            ignoreTimeout = false;, +                        }, +                    }, +                    performStateRecovery(initialStateTimeout, ignoreTimeout);, +        if (event.localNodeMaster() && event.state().blocks().hasGlobalBlock(STATE_NOT_RECOVERED_BLOCK)) {]