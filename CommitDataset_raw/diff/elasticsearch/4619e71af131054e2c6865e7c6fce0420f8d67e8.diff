[+++ b/shield/dev-tools/integration-tests.xml, +  <!-- TODO shield redefines this because the wait for http will fail due to auth -->, +  <macrodef name="startup-elasticsearch">, +    <attribute name="home" default="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +    <attribute name="args" default="${integ.args}"/>, +    <sequential>, +      <run-script dir="@{home}" script="bin/elasticsearch" spawn="true", +                  args="@{args} -Des.path.repo=@{home}/repo" />, +, +      <local name="integ.pid"/>, +      <extract-pid property="integ.pid"/>, +      <echo>External cluster started PID ${integ.pid}</echo>, +    </sequential>, +  </macrodef>, +, +  <target name="start-external-cluster-with-plugin" depends="setup-workspace" unless="${shouldskip}">, +    <install-plugin name="elasticsearch-license" file="${integ.deps}/elasticsearch-license-plugin-${project.version}.zip" />, +    <install-plugin name="${project.artifactId}" file="${project.build.directory}/releases/${project.artifactId}-${project.version}.zip"/>, +    <run-script dir="${integ.scratch}/elasticsearch-${elasticsearch.version}" script="bin/shield/esusers", +                args="useradd test_user -p changeme -r admin"/>, +    <startup-elasticsearch/>, +, +++ b/shield/dev-tools/integration-tests.xml, +  <!-- TODO shield redefines this because the wait for http will fail due to auth -->, +  <macrodef name="startup-elasticsearch">, +    <attribute name="home" default="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +    <attribute name="args" default="${integ.args}"/>, +    <sequential>, +      <run-script dir="@{home}" script="bin/elasticsearch" spawn="true", +                  args="@{args} -Des.path.repo=@{home}/repo" />, +, +      <local name="integ.pid"/>, +      <extract-pid property="integ.pid"/>, +      <echo>External cluster started PID ${integ.pid}</echo>, +    </sequential>, +  </macrodef>, +, +  <target name="start-external-cluster-with-plugin" depends="setup-workspace" unless="${shouldskip}">, +    <install-plugin name="elasticsearch-license" file="${integ.deps}/elasticsearch-license-plugin-${project.version}.zip" />, +    <install-plugin name="${project.artifactId}" file="${project.build.directory}/releases/${project.artifactId}-${project.version}.zip"/>, +    <run-script dir="${integ.scratch}/elasticsearch-${elasticsearch.version}" script="bin/shield/esusers", +                args="useradd test_user -p changeme -r admin"/>, +    <startup-elasticsearch/>, +, +++ b/shield/pom.xml, +, +            <plugin>, +                <groupId>org.apache.maven.plugins</groupId>, +                <artifactId>maven-dependency-plugin</artifactId>, +                <executions>, +                    <execution>, +                        <id>integ-setup-dependencies</id>, +                        <phase>pre-integration-test</phase>, +                        <goals>, +                            <goal>copy</goal>, +                        </goals>, +                        <configuration>, +                            <artifactItems combine.children="append">, +                                <artifactItem>, +                                    <groupId>org.elasticsearch</groupId>, +                                    <artifactId>elasticsearch-license-plugin</artifactId>, +                                    <version>${project.version}</version>, +                                    <type>zip</type>, +                                    <overWrite>true</overWrite>, +                                </artifactItem>, +                            </artifactItems>, +                        </configuration>, +                    </execution>, +                </executions>, +            </plugin>, +, +            <plugin>, +                <groupId>org.apache.maven.plugins</groupId>, +                <artifactId>maven-antrun-plugin</artifactId>, +            </plugin>, +++ b/shield/dev-tools/integration-tests.xml, +  <!-- TODO shield redefines this because the wait for http will fail due to auth -->, +  <macrodef name="startup-elasticsearch">, +    <attribute name="home" default="${integ.scratch}/elasticsearch-${elasticsearch.version}"/>, +    <attribute name="args" default="${integ.args}"/>, +    <sequential>, +      <run-script dir="@{home}" script="bin/elasticsearch" spawn="true", +                  args="@{args} -Des.path.repo=@{home}/repo" />, +, +      <local name="integ.pid"/>, +      <extract-pid property="integ.pid"/>, +      <echo>External cluster started PID ${integ.pid}</echo>, +    </sequential>, +  </macrodef>, +, +  <target name="start-external-cluster-with-plugin" depends="setup-workspace" unless="${shouldskip}">, +    <install-plugin name="elasticsearch-license" file="${integ.deps}/elasticsearch-license-plugin-${project.version}.zip" />, +    <install-plugin name="${project.artifactId}" file="${project.build.directory}/releases/${project.artifactId}-${project.version}.zip"/>, +    <run-script dir="${integ.scratch}/elasticsearch-${elasticsearch.version}" script="bin/shield/esusers", +                args="useradd test_user -p changeme -r admin"/>, +    <startup-elasticsearch/>, +, +++ b/shield/pom.xml, +, +            <plugin>]