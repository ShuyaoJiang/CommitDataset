[+++ b/server/src/main/java/org/elasticsearch/search/lookup/LeafDocLookup.java, +import org.apache.logging.log4j.LogManager;, +import org.elasticsearch.common.logging.DeprecationLogger;, +    private static final DeprecationLogger DEPRECATION_LOGGER, +            = new DeprecationLogger(LogManager.getLogger(LeafDocLookup.class));, +    static final String TYPES_DEPRECATION_KEY = "type-field-doc-lookup";, +    static final String TYPES_DEPRECATION_MESSAGE =, +            "[types removal] Looking up doc types in scripts is deprecated.";, +, +        // deprecate _type, +        if ("_type".equals(key)) {, +            DEPRECATION_LOGGER.deprecatedAndMaybeLog(TYPES_DEPRECATION_KEY, TYPES_DEPRECATION_MESSAGE);, +        }, +++ b/server/src/main/java/org/elasticsearch/search/lookup/LeafDocLookup.java, +import org.apache.logging.log4j.LogManager;, +import org.elasticsearch.common.logging.DeprecationLogger;, +    private static final DeprecationLogger DEPRECATION_LOGGER, +            = new DeprecationLogger(LogManager.getLogger(LeafDocLookup.class));, +    static final String TYPES_DEPRECATION_KEY = "type-field-doc-lookup";, +    static final String TYPES_DEPRECATION_MESSAGE =, +            "[types removal] Looking up doc types in scripts is deprecated.";, +, +        // deprecate _type, +        if ("_type".equals(key)) {, +            DEPRECATION_LOGGER.deprecatedAndMaybeLog(TYPES_DEPRECATION_KEY, TYPES_DEPRECATION_MESSAGE);, +        }, +++ b/server/src/test/java/org/elasticsearch/search/lookup/LeafDocLookupTests.java, +import static org.elasticsearch.search.lookup.LeafDocLookup.TYPES_DEPRECATION_MESSAGE;, +        when(mapperService.fullName("_type")).thenReturn(fieldType);, +, +    public void testTypesDeprecation() {, +        ScriptDocValues<?> fetchedDocValues = docLookup.get("_type");, +        assertEquals(docValues, fetchedDocValues);, +        assertWarnings(TYPES_DEPRECATION_MESSAGE);, +    }]