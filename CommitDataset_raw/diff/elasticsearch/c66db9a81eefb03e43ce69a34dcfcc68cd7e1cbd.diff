[+++ b/docs/build.gradle, +, +// Used by pipeline aggregation docs, +buildRestTests.setups['sales'] = ''', +  - do:, +    indices.create:, +      index: sales, +      body:, +        settings:, +          number_of_shards: 2, +          number_of_replicas: 1, +        mappings:, +          sale:, +            properties:, +              type:, +                type: keyword, +  - do:, +    bulk:, +      index: sales, +      type: sale, +      refresh: true, +      body: |, +        {"index":{}}, +        {"date": "2015/01/01 00:00:00", "price": 200, "type": "hat"}, +        {"index":{}}, +        {"date": "2015/01/01 00:00:00", "price": 200, "type": "t-shirt"}, +        {"index":{}}, +        {"date": "2015/01/01 00:00:00", "price": 150, "type": "bag"}, +        {"index":{}}, +        {"date": "2015/02/01 00:00:00", "price": 50, "type": "hat"}, +        {"index":{}}, +        {"date": "2015/02/01 00:00:00", "price": 10, "type": "t-shirt"}, +        {"index":{}}, +        {"date": "2015/03/01 00:00:00", "price": 200, "type": "hat"}, +        {"index":{}}, +        {"date": "2015/03/01 00:00:00", "price": 175, "type": "t-shirt"}''', +++ b/docs/build.gradle, +, +// Used by pipeline aggregation docs, +buildRestTests.setups['sales'] = ''', +  - do:, +    indices.create:, +      index: sales, +      body:, +        settings:, +          number_of_shards: 2, +          number_of_replicas: 1, +        mappings:, +          sale:, +            properties:, +              type:, +                type: keyword, +  - do:, +    bulk:, +      index: sales, +      type: sale, +      refresh: true, +      body: |, +        {"index":{}}, +        {"date": "2015/01/01 00:00:00", "price": 200, "type": "hat"}, +        {"index":{}}, +        {"date": "2015/01/01 00:00:00", "price": 200, "type": "t-shirt"}, +        {"index":{}}, +        {"date": "2015/01/01 00:00:00", "price": 150, "type": "bag"}, +        {"index":{}}, +        {"date": "2015/02/01 00:00:00", "price": 50, "type": "hat"}, +        {"index":{}}, +        {"date": "2015/02/01 00:00:00", "price": 10, "type": "t-shirt"}, +        {"index":{}}, +        {"date": "2015/03/01 00:00:00", "price": 200, "type": "hat"}, +        {"index":{}}, +        {"date": "2015/03/01 00:00:00", "price": 175, "type": "t-shirt"}''', +++ b/docs/reference/aggregations/pipeline.asciidoc, +POST /_search, +    "aggs": {, +}, +// CONSOLE, +POST /_search, +// CONSOLE, +// TEST[setup:sales], +POST /_search, +    "aggs": {, +}, +// CONSOLE, +POST /sales/_search, +// CONSOLE, +// TEST[setup:sales], +++ b/docs/build.gradle, +, +// Used by pipeline aggregation docs, +buildRestTests.setups['sales'] = ''', +  - do:, +    indices.create:, +      index: sales, +      body:, +        settings:, +          number_of_shards: 2, +          number_of_replicas: 1, +        mappings:, +          sale:]