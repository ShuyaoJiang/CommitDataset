[+++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +    public MetaDataIndexUpgradeService(Settings settings) {, +                try (MapperService mapperService = new MapperService(indexSettings, analysisService, similarityService)) {, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +    public MetaDataIndexUpgradeService(Settings settings) {, +                try (MapperService mapperService = new MapperService(indexSettings, analysisService, similarityService)) {, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (sourceFieldFiltering || sourceFetchFiltering) {, +        } else if (fetchSourceContext.includes().length > 0 || fetchSourceContext.excludes().length > 0) {, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +    public MetaDataIndexUpgradeService(Settings settings) {, +                try (MapperService mapperService = new MapperService(indexSettings, analysisService, similarityService)) {, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (sourceFieldFiltering || sourceFetchFiltering) {, +        } else if (fetchSourceContext.includes().length > 0 || fetchSourceContext.excludes().length > 0) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +            return new DocumentMapper(mapperService, indexSettings, docMapperParser, rootObjectMapper, meta, rootMappers, mapperService.mappingLock);, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +    public MetaDataIndexUpgradeService(Settings settings) {, +                try (MapperService mapperService = new MapperService(indexSettings, analysisService, similarityService)) {, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (sourceFieldFiltering || sourceFetchFiltering) {, +        } else if (fetchSourceContext.includes().length > 0 || fetchSourceContext.excludes().length > 0) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +            return new DocumentMapper(mapperService, indexSettings, docMapperParser, rootObjectMapper, meta, rootMappers, mapperService.mappingLock);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +                                SimilarityService similarityService) {, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +    public MetaDataIndexUpgradeService(Settings settings) {, +                try (MapperService mapperService = new MapperService(indexSettings, analysisService, similarityService)) {, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (sourceFieldFiltering || sourceFetchFiltering) {, +        } else if (fetchSourceContext.includes().length > 0 || fetchSourceContext.excludes().length > 0) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +            return new DocumentMapper(mapperService, indexSettings, docMapperParser, rootObjectMapper, meta, rootMappers, mapperService.mappingLock);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +                                SimilarityService similarityService) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +    public MetaDataIndexUpgradeService(Settings settings) {, +                try (MapperService mapperService = new MapperService(indexSettings, analysisService, similarityService)) {, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (sourceFieldFiltering || sourceFetchFiltering) {, +        } else if (fetchSourceContext.includes().length > 0 || fetchSourceContext.excludes().length > 0) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +            return new DocumentMapper(mapperService, indexSettings, docMapperParser, rootObjectMapper, meta, rootMappers, mapperService.mappingLock);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +                                SimilarityService similarityService) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +++ b/core/src/main/java/org/elasticsearch/index/mapper/MapperService.java, +                         SimilarityService similarityService) {, +        this.documentParser = new DocumentMapperParser(indexSettings, this, analysisService, similarityService);, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +    public MetaDataIndexUpgradeService(Settings settings) {, +                try (MapperService mapperService = new MapperService(indexSettings, analysisService, similarityService)) {, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (sourceFieldFiltering || sourceFetchFiltering) {, +        } else if (fetchSourceContext.includes().length > 0 || fetchSourceContext.excludes().length > 0) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +            return new DocumentMapper(mapperService, indexSettings, docMapperParser, rootObjectMapper, meta, rootMappers, mapperService.mappingLock);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +                                SimilarityService similarityService) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +++ b/core/src/main/java/org/elasticsearch/index/mapper/MapperService.java, +                         SimilarityService similarityService) {, +        this.documentParser = new DocumentMapperParser(indexSettings, this, analysisService, similarityService);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/Mapping.java, +    public Mapping(Version indexCreated, RootObjectMapper rootObjectMapper, MetadataFieldMapper[] metadataMappers, Map<String, Object> meta) {, +        return new Mapping(indexCreated, (RootObjectMapper) rootObjectMapper, metadataMappers, meta);, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +    public MetaDataIndexUpgradeService(Settings settings) {, +                try (MapperService mapperService = new MapperService(indexSettings, analysisService, similarityService)) {, +++ b/core/src/main/java/org/elasticsearch/index/get/ShardGetService.java, +                    if (sourceFieldFiltering || sourceFetchFiltering) {, +        } else if (fetchSourceContext.includes().length > 0 || fetchSourceContext.excludes().length > 0) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java, +            return new DocumentMapper(mapperService, indexSettings, docMapperParser, rootObjectMapper, meta, rootMappers, mapperService.mappingLock);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java, +                                SimilarityService similarityService) {, +++ b/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java, +++ b/core/src/main/java/org/elasticsearch/index/mapper/MapperService.java, +                         SimilarityService similarityService) {, +        this.documentParser = new DocumentMapperParser(indexSettings, this, analysisService, similarityService);, +++ b/core/src/main/java/org/elasticsearch/index/mapper/Mapping.java, +    public Mapping(Version indexCreated, RootObjectMapper rootObjectMapper, MetadataFieldMapper[] metadataMappers, Map<String, Object> meta) {, +        return new Mapping(indexCreated, (RootObjectMapper) rootObjectMapper, metadataMappers, meta);, +++ b/core/src/main/java/org/elasticsearch/script/ScriptContext.java, +        AGGS("aggs"), SEARCH("search"), UPDATE("update");, +++ b/core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java, +++ b/core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java, +    public MetaDataIndexUpgradeService(Settings settings) {]