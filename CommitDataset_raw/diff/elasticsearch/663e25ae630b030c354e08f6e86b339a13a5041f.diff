[+++ b/src/test/java/org/elasticsearch/test/TestCluster.java, +import org.elasticsearch.ElasticsearchIllegalStateException;, +    private static final String CLUSTER_NAME_KEY = "cluster.name";, +                .put(getRandomNodeSettings(nodeSeed));, +            if (settings.get(CLUSTER_NAME_KEY) != null) {, +                throw new ElasticsearchIllegalStateException("Tests must not set a '"+CLUSTER_NAME_KEY+"' as a node setting set '" + CLUSTER_NAME_KEY + "': [" + settings.get(CLUSTER_NAME_KEY) + "]");, +            }, +        builder.put(CLUSTER_NAME_KEY, clusterName);, +    private static Settings getRandomNodeSettings(long seed) {, +                    .put(CLUSTER_NAME_KEY, clusterName).put("client.transport.sniff", sniff).build());]