[+++ b/build.gradle, +    // for transport client, +    "org.elasticsearch.plugin:transport-netty3-client:${version}": ':modules:transport-netty3',, +    "org.elasticsearch.plugin:reindex-client:${version}": ':modules:reindex',, +    "org.elasticsearch.plugin:lang-mustache-client:${version}": ':modules:lang-mustache',, +    "org.elasticsearch.plugin:percolator-client:${version}": ':modules:percolator',, +++ b/build.gradle, +    // for transport client, +    "org.elasticsearch.plugin:transport-netty3-client:${version}": ':modules:transport-netty3',, +    "org.elasticsearch.plugin:reindex-client:${version}": ':modules:reindex',, +    "org.elasticsearch.plugin:lang-mustache-client:${version}": ':modules:lang-mustache',, +    "org.elasticsearch.plugin:percolator-client:${version}": ':modules:percolator',, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +import org.gradle.api.publish.maven.plugins.MavenPublishPlugin, +        project.plugins.withType(MavenPublishPlugin.class).whenPluginAdded {, +++ b/build.gradle, +    // for transport client, +    "org.elasticsearch.plugin:transport-netty3-client:${version}": ':modules:transport-netty3',, +    "org.elasticsearch.plugin:reindex-client:${version}": ':modules:reindex',, +    "org.elasticsearch.plugin:lang-mustache-client:${version}": ':modules:lang-mustache',, +    "org.elasticsearch.plugin:percolator-client:${version}": ':modules:percolator',, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +import org.gradle.api.publish.maven.plugins.MavenPublishPlugin, +        project.plugins.withType(MavenPublishPlugin.class).whenPluginAdded {, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +++ b/build.gradle, +    // for transport client, +    "org.elasticsearch.plugin:transport-netty3-client:${version}": ':modules:transport-netty3',, +    "org.elasticsearch.plugin:reindex-client:${version}": ':modules:reindex',, +    "org.elasticsearch.plugin:lang-mustache-client:${version}": ':modules:lang-mustache',, +    "org.elasticsearch.plugin:percolator-client:${version}": ':modules:percolator',, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy, +import org.gradle.api.publish.maven.plugins.MavenPublishPlugin, +        project.plugins.withType(MavenPublishPlugin.class).whenPluginAdded {, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/doc/RestTestsFromSnippetsTask.groovy, +++ b/buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy, +import org.gradle.api.Task, +import org.gradle.api.XmlProvider, +import org.gradle.api.publish.maven.MavenPublication, +import org.gradle.api.publish.maven.plugins.MavenPublishPlugin, +, +import java.nio.file.Files, +import java.nio.file.Path, +import java.nio.file.StandardCopyOption, +import java.util.regex.Matcher, +import java.util.regex.Pattern, +, +            boolean isModule = project.path.startsWith(':modules:'), +            if (project.pluginProperties.extension.hasClientJar) {, +                // for plugins which work with the transport client, we copy the jar, +                // file to a new name, copy the nebula generated pom to the same name,, +                // and generate a different pom for the zip, +                project.signArchives.enabled = false, +                addJarPomGeneration(project), +                addClientJarTask(project), +                if (isModule == false) {, +                    addZipPomGeneration(project), +                }, +            } else {, +                // no client plugin, so use the pom file from nebula, without jar, for the zip, +                project.ext.set("nebulaPublish.maven.jar", false), +            }, +, +            if (isModule) {, +                project.integTest.clusterConfig.plugin(project.path), +                project.tasks.run.clusterConfig.plugin(project.path), +                addZipPomGeneration(project), +        project.configurations.getByName('default').extendsFrom(project.configurations.getByName('runtime')), +        // also make the zip available as a configuration (used when depending on this project), +        project.configurations.create('zip'), +        project.artifacts.add('zip', bundle), +    /** Adds a task to move jar and associated files to a "-client" name. */, +    protected static void addClientJarTask(Project project) {, +        Task clientJar = project.tasks.create('clientJar'), +        clientJar.dependsOn('generatePomFileForJarPublication', project.jar, project.javadocJar, project.sourcesJar), +        clientJar.doFirst {, +            Path jarFile = project.jar.outputs.files.singleFile.toPath(), +            String clientFileName = jarFile.fileName.toString().replace(project.version, "client-${project.version}"), +            Files.copy(jarFile, jarFile.resolveSibling(clientFileName), StandardCopyOption.REPLACE_EXISTING), +, +            String pomFileName = jarFile.fileName.toString().replace('.jar', '.pom'), +            String clientPomFileName = clientFileName.replace('.jar', '.pom'), +            Files.copy(jarFile.resolveSibling(pomFileName), jarFile.resolveSibling(clientPomFileName),, +                    StandardCopyOption.REPLACE_EXISTING), +, +            String sourcesFileName = jarFile.fileName.toString().replace('.jar', '-sources.jar'), +            String clientSourcesFileName = clientFileName.replace('.jar', '-sources.jar'), +            Files.copy(jarFile.resolveSibling(sourcesFileName), jarFile.resolveSibling(clientSourcesFileName),, +                    StandardCopyOption.REPLACE_EXISTING), +, +            String javadocFileName = jarFile.fileName.toString().replace('.jar', '-javadoc.jar'), +            String clientJavadocFileName = clientFileName.replace('.jar', '-javadoc.jar'), +            Files.copy(jarFile.resolveSibling(javadocFileName), jarFile.resolveSibling(clientJavadocFileName),, +                    StandardCopyOption.REPLACE_EXISTING), +        }, +        project.assemble.dependsOn(clientJar), +    }, +, +    static final Pattern GIT_PATTERN = Pattern.compile(/git@([^:]+):([^\.]+)\.git/), +]