[+++ b/server/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java, +import java.io.CharArrayWriter;, +            try (BufferedReader stdinReader = new BufferedReader(new InputStreamReader(getStdin(), StandardCharsets.UTF_8));, +                 CharArrayWriter writer = new CharArrayWriter()) {, +                int charInt;, +                while ((charInt = stdinReader.read()) != -1) {, +                    if ((char) charInt == '\r' || (char) charInt == '\n') {, +                        break;, +                    }, +                    writer.write((char) charInt);, +                }, +                value = writer.toCharArray();, +            }, +++ b/server/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java, +import java.io.CharArrayWriter;, +            try (BufferedReader stdinReader = new BufferedReader(new InputStreamReader(getStdin(), StandardCharsets.UTF_8));, +                 CharArrayWriter writer = new CharArrayWriter()) {, +                int charInt;, +                while ((charInt = stdinReader.read()) != -1) {, +                    if ((char) charInt == '\r' || (char) charInt == '\n') {, +                        break;, +                    }, +                    writer.write((char) charInt);, +                }, +                value = writer.toCharArray();, +            }, +++ b/server/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java, +    public void testStdinNoInput() throws Exception {, +        KeyStoreWrapper.create().save(env.configFile(), new char[0]);, +        setInput("");, +        execute("-x", "foo");, +        assertSecureString("foo", "");, +    }, +, +    public void testStdinInputWithLineBreaks() throws Exception {, +        KeyStoreWrapper.create().save(env.configFile(), new char[0]);, +        setInput("Typedthisandhitenter\n");, +        execute("-x", "foo");, +        assertSecureString("foo", "Typedthisandhitenter");, +    }, +, +    public void testStdinInputWithCarriageReturn() throws Exception {, +        KeyStoreWrapper.create().save(env.configFile(), new char[0]);, +        setInput("Typedthisandhitenter\r");, +        execute("-x", "foo");, +        assertSecureString("foo", "Typedthisandhitenter");, +    }, +]