[+++ b/core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java, +        IndexSettings.MAX_SCRIPT_FIELDS_SETTING,, +++ b/core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java, +        IndexSettings.MAX_SCRIPT_FIELDS_SETTING,, +++ b/core/src/main/java/org/elasticsearch/index/IndexSettings.java, +, +    /**, +     * Index setting describing the maximum value of allowed `script_fields`that can be retrieved, +     * per search request. The default maximum of 50 is defensive for the reason that retrieving, +     * script fields is a costly operation., +     */, +    public static final Setting<Integer> MAX_SCRIPT_FIELDS_SETTING =, +        Setting.intSetting("index.max_script_fields", 32, 0, Property.Dynamic, Property.IndexScope);, +, +    private volatile int maxScriptFields;, +        maxScriptFields = scopedSettings.get(MAX_SCRIPT_FIELDS_SETTING);, +        scopedSettings.addSettingsUpdateConsumer(MAX_SCRIPT_FIELDS_SETTING, this::setMaxScriptFields);, +     * Returns the maximum number of allowed script_fields to retrieve in a search request, +     */, +    public int getMaxScriptFields() {, +        return this.maxScriptFields;, +    }, +, +    private void setMaxScriptFields(int maxScriptFields) {, +        this.maxScriptFields = maxScriptFields;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java, +        IndexSettings.MAX_SCRIPT_FIELDS_SETTING,, +++ b/core/src/main/java/org/elasticsearch/index/IndexSettings.java, +, +    /**, +     * Index setting describing the maximum value of allowed `script_fields`that can be retrieved, +     * per search request. The default maximum of 50 is defensive for the reason that retrieving, +     * script fields is a costly operation., +     */, +    public static final Setting<Integer> MAX_SCRIPT_FIELDS_SETTING =, +        Setting.intSetting("index.max_script_fields", 32, 0, Property.Dynamic, Property.IndexScope);, +, +    private volatile int maxScriptFields;, +        maxScriptFields = scopedSettings.get(MAX_SCRIPT_FIELDS_SETTING);, +        scopedSettings.addSettingsUpdateConsumer(MAX_SCRIPT_FIELDS_SETTING, this::setMaxScriptFields);, +     * Returns the maximum number of allowed script_fields to retrieve in a search request, +     */, +    public int getMaxScriptFields() {, +        return this.maxScriptFields;, +    }, +, +    private void setMaxScriptFields(int maxScriptFields) {, +        this.maxScriptFields = maxScriptFields;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            int maxAllowedScriptFields = context.mapperService().getIndexSettings().getMaxScriptFields();, +            if (source.scriptFields().size() > maxAllowedScriptFields) {, +                throw new IllegalArgumentException(, +                        "Trying to retrieve too many script_fields. Must be less than or equal to: [" + maxAllowedScriptFields, +                                + "] but was [" + source.scriptFields().size() + "]. This limit can be set by changing the [", +                                + IndexSettings.MAX_SCRIPT_FIELDS_SETTING.getKey() + "] index level setting.");, +            }, +++ b/core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java, +        IndexSettings.MAX_SCRIPT_FIELDS_SETTING,, +++ b/core/src/main/java/org/elasticsearch/index/IndexSettings.java, +, +    /**, +     * Index setting describing the maximum value of allowed `script_fields`that can be retrieved, +     * per search request. The default maximum of 50 is defensive for the reason that retrieving, +     * script fields is a costly operation., +     */, +    public static final Setting<Integer> MAX_SCRIPT_FIELDS_SETTING =, +        Setting.intSetting("index.max_script_fields", 32, 0, Property.Dynamic, Property.IndexScope);, +, +    private volatile int maxScriptFields;, +        maxScriptFields = scopedSettings.get(MAX_SCRIPT_FIELDS_SETTING);, +        scopedSettings.addSettingsUpdateConsumer(MAX_SCRIPT_FIELDS_SETTING, this::setMaxScriptFields);, +     * Returns the maximum number of allowed script_fields to retrieve in a search request, +     */, +    public int getMaxScriptFields() {, +        return this.maxScriptFields;, +    }, +, +    private void setMaxScriptFields(int maxScriptFields) {, +        this.maxScriptFields = maxScriptFields;, +    }, +, +    /**, +++ b/core/src/main/java/org/elasticsearch/search/SearchService.java, +            int maxAllowedScriptFields = context.mapperService().getIndexSettings().getMaxScriptFields();, +            if (source.scriptFields().size() > maxAllowedScriptFields) {, +                throw new IllegalArgumentException(, +                        "Trying to retrieve too many script_fields. Must be less than or equal to: [" + maxAllowedScriptFields, +                                + "] but was [" + source.scriptFields().size() + "]. This limit can be set by changing the [", +                                + IndexSettings.MAX_SCRIPT_FIELDS_SETTING.getKey() + "] index level setting.");, +            }, +++ b/core/src/test/java/org/elasticsearch/index/IndexSettingsTests.java, +    public void testMaxScriptFields() {, +        IndexMetaData metaData = newIndexMeta("index", Settings.builder().put(IndexMetaData.SETTING_VERSION_CREATED, Version.CURRENT), +                .put(IndexSettings.MAX_SCRIPT_FIELDS_SETTING.getKey(), 100).build());]