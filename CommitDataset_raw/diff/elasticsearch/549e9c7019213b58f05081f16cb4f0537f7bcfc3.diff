[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/single/TransportSinglePingAction.java, +                .getShards(clusterService.state(), request.index(), request.type, request.id, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/single/TransportSinglePingAction.java, +                .getShards(clusterService.state(), request.index(), request.type, request.id, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java, +        return clusterState.routingTable().index(request.index()).randomAllActiveShardsIt();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/single/TransportSinglePingAction.java, +                .getShards(clusterService.state(), request.index(), request.type, request.id, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java, +        return clusterState.routingTable().index(request.index()).randomAllActiveShardsIt();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/single/TransportSinglePingAction.java, +                .getShards(clusterService.state(), request.index(), request.type, request.id, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java, +        return clusterState.routingTable().index(request.index()).randomAllActiveShardsIt();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/single/TransportSinglePingAction.java, +                .getShards(clusterService.state(), request.index(), request.type, request.id, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java, +        return clusterState.routingTable().index(request.index()).randomAllActiveShardsIt();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +        return clusterState.routingTable().activePrimaryShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/single/TransportSinglePingAction.java, +                .getShards(clusterService.state(), request.index(), request.type, request.id, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java, +        return clusterState.routingTable().index(request.index()).randomAllActiveShardsIt();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +        return clusterState.routingTable().activePrimaryShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/single/TransportSinglePingAction.java, +                .getShards(clusterService.state(), request.index(), request.type, request.id, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java, +        return clusterState.routingTable().index(request.index()).randomAllActiveShardsIt();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +        return clusterState.routingTable().activePrimaryShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/single/TransportSinglePingAction.java, +                .getShards(clusterService.state(), request.index(), request.type, request.id, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java, +        return clusterState.routingTable().index(request.index()).randomAllActiveShardsIt();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +        return clusterState.routingTable().activePrimaryShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java, +     * Segments goes across *all* active shards., +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/single/TransportSinglePingAction.java, +                .getShards(clusterService.state(), request.index(), request.type, request.id, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java, +        return clusterState.routingTable().index(request.index()).randomAllActiveShardsIt();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/gateway/snapshot/TransportGatewaySnapshotAction.java, +        return clusterState.routingTable().activePrimaryShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/optimize/TransportOptimizeAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java, +     * Segments goes across *all* active shards., +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/status/TransportIndicesStatusAction.java, +        return clusterState.routingTable().allAssignedShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/cluster/ping/single/TransportSinglePingAction.java, +                .getShards(clusterService.state(), request.index(), request.type, request.id, null, null);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java, +        return clusterState.routingTable().index(request.index()).randomAllActiveShardsIt();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/TransportClearIndicesCacheAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportFlushAction.java, +        return clusterState.routingTable().allActiveShardsGrouped(concreteIndices, true);]