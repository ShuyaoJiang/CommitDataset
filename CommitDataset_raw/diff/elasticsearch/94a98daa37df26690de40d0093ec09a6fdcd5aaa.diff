[+++ b/core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java, +                if (value instanceof InetAddress) {, +                    return (InetAddress) value;, +                } else {, +                    if (value instanceof BytesRef) {, +                        value = ((BytesRef) value).utf8ToString();, +                    }, +                    return InetAddresses.forString(value.toString());, +                }, +++ b/core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java, +                if (value instanceof InetAddress) {, +                    return (InetAddress) value;, +                } else {, +                    if (value instanceof BytesRef) {, +                        value = ((BytesRef) value).utf8ToString();, +                    }, +                    return InetAddresses.forString(value.toString());, +                }, +++ b/core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java, +import org.apache.lucene.util.BytesRef;, +import org.elasticsearch.common.network.InetAddresses;, +, +    public void testParseIp() {, +        assertEquals(InetAddresses.forString("::1"), RangeFieldMapper.RangeType.IP.parse(InetAddresses.forString("::1"), randomBoolean()));, +        assertEquals(InetAddresses.forString("::1"), RangeFieldMapper.RangeType.IP.parse("::1", randomBoolean()));, +        assertEquals(InetAddresses.forString("::1"), RangeFieldMapper.RangeType.IP.parse(new BytesRef("::1"), randomBoolean()));, +    }]