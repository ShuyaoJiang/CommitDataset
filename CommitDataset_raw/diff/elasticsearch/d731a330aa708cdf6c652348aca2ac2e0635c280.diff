[+++ b/core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java, +import org.elasticsearch.common.logging.Loggers;, +import org.elasticsearch.common.xcontent.ToXContent;, +import org.elasticsearch.common.xcontent.XContentHelper;, +    private static final ToXContent.Params FORMAT_PARAMS = new ToXContent.MapParams(Collections.singletonMap("pretty", "false"));, +, +, +        boolean lowLevelCancellation = randomBoolean();, +        logger.info("Using lowLevelCancellation: {}", lowLevelCancellation);, +        return Settings.builder().put(SearchService.LOW_LEVEL_CANCELLATION_SETTING.getKey(), lowLevelCancellation).build();, +        for (int i = 0; i < 5; i++) {, +            for (int j = 0; j < 20; j++) {, +                bulkRequestBuilder.add(client().prepareIndex("test", "type", Integer.toString(i * 5 + j)).setSource("field", "value"));, +        logger.info("Segments {}", XContentHelper.toString(client().admin().indices().prepareSegments("test").get(), FORMAT_PARAMS));, +        logger.info("Segments {}", XContentHelper.toString(client().admin().indices().prepareSegments("test").get(), FORMAT_PARAMS));, +                Loggers.getLogger(SearchCancellationIT.class).info("Blocking on the document {}", doc().get("_uid"));]