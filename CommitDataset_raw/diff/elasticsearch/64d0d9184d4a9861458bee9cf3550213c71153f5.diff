[+++ b/core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java, +import java.io.UncheckedIOException;, +import java.util.function.Predicate;, +import java.util.function.Supplier;, +        Translog translog = ShardUtilsTests.getShardEngine(shard).getTranslog();, +        Predicate<Translog> needsSync = (tlog) -> {, +            // we can't use tlog.needsSync() here since it also takes the global checkpoint into account, +            // we explicitly want to check here if our durability checks are taken into account so we only, +            // check if we are synced upto the current write location, +            Translog.Location lastWriteLocation = tlog.getLastWriteLocation();, +            try {, +                // the lastWriteLocaltion has a Integer.MAX_VALUE size so we have to create a new one, +                return tlog.ensureSynced(new Translog.Location(lastWriteLocation.generation, lastWriteLocation.translogLocation, 0));, +            } catch (IOException e) {, +                throw new UncheckedIOException(e);, +            }, +        };, +        assertFalse(needsSync.test(translog));, +        assertTrue(needsSync.test(translog));, +        assertFalse(needsSync.test(translog));, +        assertTrue(translog.syncNeeded());, +        assertFalse(needsSync.test(translog));, +        assertTrue(needsSync.test(translog));]