[+++ b/plugin/src/main/java/org/elasticsearch/xpack/security/authc/esnative/tool/CommandLineHttpClient.java, +import org.elasticsearch.common.Strings;, +import org.elasticsearch.common.network.NetworkService;, +import org.elasticsearch.common.transport.PortsRange;, +import org.elasticsearch.http.HttpTransportSettings;, +import org.elasticsearch.xpack.XPackSettings;, +import java.util.List;, +import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_PUBLISH_HOST;, +import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_PUBLISH_PORT;, +, +    public String getDefaultURL() {, +        final String scheme = XPackSettings.HTTP_SSL_ENABLED.get(settings) ? "https" : "http";, +        List<String> httpPublishHost = SETTING_HTTP_PUBLISH_HOST.get(settings);, +        final String host =, +                (httpPublishHost.isEmpty() ? NetworkService.GLOBAL_NETWORK_PUBLISHHOST_SETTING.get(settings) : httpPublishHost).get(0);, +        final int port = SETTING_HTTP_PUBLISH_PORT.get(settings);, +        return scheme + "://" + host + ":" + port;, +    }, +++ b/plugin/src/main/java/org/elasticsearch/xpack/security/authc/esnative/tool/CommandLineHttpClient.java, +import org.elasticsearch.common.Strings;, +import org.elasticsearch.common.network.NetworkService;, +import org.elasticsearch.common.transport.PortsRange;, +import org.elasticsearch.http.HttpTransportSettings;, +import org.elasticsearch.xpack.XPackSettings;, +import java.util.List;, +import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_PUBLISH_HOST;, +import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_PUBLISH_PORT;, +, +    public String getDefaultURL() {, +        final String scheme = XPackSettings.HTTP_SSL_ENABLED.get(settings) ? "https" : "http";, +        List<String> httpPublishHost = SETTING_HTTP_PUBLISH_HOST.get(settings);, +        final String host =, +                (httpPublishHost.isEmpty() ? NetworkService.GLOBAL_NETWORK_PUBLISHHOST_SETTING.get(settings) : httpPublishHost).get(0);, +        final int port = SETTING_HTTP_PUBLISH_PORT.get(settings);, +        return scheme + "://" + host + ":" + port;, +    }, +++ b/plugin/src/main/java/org/elasticsearch/xpack/security/authc/esnative/tool/SetupPasswordTool.java, +            url = providedUrl == null ? client.getDefaultURL() : providedUrl;, +++ b/plugin/src/main/java/org/elasticsearch/xpack/security/authc/esnative/tool/CommandLineHttpClient.java, +import org.elasticsearch.common.Strings;, +import org.elasticsearch.common.network.NetworkService;, +import org.elasticsearch.common.transport.PortsRange;, +import org.elasticsearch.http.HttpTransportSettings;, +import org.elasticsearch.xpack.XPackSettings;, +import java.util.List;, +import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_PUBLISH_HOST;, +import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_PUBLISH_PORT;, +, +    public String getDefaultURL() {, +        final String scheme = XPackSettings.HTTP_SSL_ENABLED.get(settings) ? "https" : "http";, +        List<String> httpPublishHost = SETTING_HTTP_PUBLISH_HOST.get(settings);, +        final String host =, +                (httpPublishHost.isEmpty() ? NetworkService.GLOBAL_NETWORK_PUBLISHHOST_SETTING.get(settings) : httpPublishHost).get(0);, +        final int port = SETTING_HTTP_PUBLISH_PORT.get(settings);, +        return scheme + "://" + host + ":" + port;, +    }, +++ b/plugin/src/main/java/org/elasticsearch/xpack/security/authc/esnative/tool/SetupPasswordTool.java, +            url = providedUrl == null ? client.getDefaultURL() : providedUrl;, +++ b/plugin/src/test/java/org/elasticsearch/xpack/security/authc/esnative/tool/SetupPasswordToolTests.java, +        when(httpClient.getDefaultURL()).thenReturn("http://localhost:9200");]