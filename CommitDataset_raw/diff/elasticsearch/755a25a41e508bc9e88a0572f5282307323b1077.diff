[+++ b/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +            numDocs += si.info.maxDoc() - si.getDelCount() - si.getSoftDelCount();, +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +            numDocs += si.info.maxDoc() - si.getDelCount() - si.getSoftDelCount();, +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/engine/CommitStats.java, +    public CommitStats(SegmentInfos segmentInfos) {, +        numDocs = Lucene.getNumDocs(segmentInfos);, +++ b/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +            numDocs += si.info.maxDoc() - si.getDelCount() - si.getSoftDelCount();, +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/engine/CommitStats.java, +    public CommitStats(SegmentInfos segmentInfos) {, +        numDocs = Lucene.getNumDocs(segmentInfos);, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        return new CommitStats(getLastCommittedSegmentInfos());, +++ b/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +            numDocs += si.info.maxDoc() - si.getDelCount() - si.getSoftDelCount();, +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/engine/CommitStats.java, +    public CommitStats(SegmentInfos segmentInfos) {, +        numDocs = Lucene.getNumDocs(segmentInfos);, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        return new CommitStats(getLastCommittedSegmentInfos());, +++ b/server/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java, +            .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +            numDocs += si.info.maxDoc() - si.getDelCount() - si.getSoftDelCount();, +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/engine/CommitStats.java, +    public CommitStats(SegmentInfos segmentInfos) {, +        numDocs = Lucene.getNumDocs(segmentInfos);, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        return new CommitStats(getLastCommittedSegmentInfos());, +++ b/server/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java, +            .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/store/Store.java, +                numDocs = Lucene.getNumDocs(segmentCommitInfos);, +            .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +            numDocs += si.info.maxDoc() - si.getDelCount() - si.getSoftDelCount();, +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/engine/CommitStats.java, +    public CommitStats(SegmentInfos segmentInfos) {, +        numDocs = Lucene.getNumDocs(segmentInfos);, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        return new CommitStats(getLastCommittedSegmentInfos());, +++ b/server/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java, +            .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/store/Store.java, +                numDocs = Lucene.getNumDocs(segmentCommitInfos);, +            .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/translog/TruncateTranslogCommand.java, +import org.elasticsearch.common.lucene.Lucene;, +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +            numDocs += si.info.maxDoc() - si.getDelCount() - si.getSoftDelCount();, +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/engine/CommitStats.java, +    public CommitStats(SegmentInfos segmentInfos) {, +        numDocs = Lucene.getNumDocs(segmentInfos);, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        return new CommitStats(getLastCommittedSegmentInfos());, +++ b/server/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java, +            .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/store/Store.java, +                numDocs = Lucene.getNumDocs(segmentCommitInfos);, +            .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/translog/TruncateTranslogCommand.java, +import org.elasticsearch.common.lucene.Lucene;, +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/indices/flush/SyncedFlushService.java, +import org.elasticsearch.index.engine.CommitStats;, +    private PreSyncedFlushResponse performPreSyncedFlush(PreShardSyncedFlushRequest request) {, +        final CommitStats commitStats = indexShard.commitStats();, +        final Engine.CommitId commitId = commitStats.getRawCommitId();, +        logger.trace("{} pre sync flush done. commit id {}, num docs {}", request.shardId(), commitId, commitStats.getNumDocs());, +        return new PreSyncedFlushResponse(commitId, commitStats.getNumDocs(), commitStats.syncId());, +++ b/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +            numDocs += si.info.maxDoc() - si.getDelCount() - si.getSoftDelCount();, +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +                .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/engine/CommitStats.java, +    public CommitStats(SegmentInfos segmentInfos) {, +        numDocs = Lucene.getNumDocs(segmentInfos);, +++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java, +        return new CommitStats(getLastCommittedSegmentInfos());, +++ b/server/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java, +            .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD), +++ b/server/src/main/java/org/elasticsearch/index/store/Store.java, +                numDocs = Lucene.getNumDocs(segmentCommitInfos);, +            .setSoftDeletesField(Lucene.SOFT_DELETE_FIELD)]