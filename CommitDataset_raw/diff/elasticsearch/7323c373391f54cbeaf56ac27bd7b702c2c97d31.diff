[+++ b/core/src/main/java/org/elasticsearch/common/settings/loader/PropertiesSettingsLoader.java, +import java.io.Closeable;, +import java.util.function.Supplier;, +        return load(() -> new FastStringReader(source), (reader, props) -> props.load(reader));, +        return load(() -> StreamInput.wrap(source), (inStream, props) -> props.load(inStream));, +    }, +, +    private final <T extends Closeable> Map<String, String> load(, +            Supplier<T> supplier,, +            IOExceptionThrowingBiConsumer<T, Properties> properties, +    ) throws IOException {, +        T t = null;, +            t = supplier.get();, +            final Properties props = new NoDuplicatesProperties();, +            properties.accept(t, props);, +            final Map<String, String> result = new HashMap<>();, +            IOUtils.closeWhileHandlingException(t);, +    @FunctionalInterface, +    private interface IOExceptionThrowingBiConsumer<T, U> {, +        void accept(T t, U u) throws IOException;, +    }, +, +++ b/core/src/main/java/org/elasticsearch/common/settings/loader/PropertiesSettingsLoader.java, +import java.io.Closeable;, +import java.util.function.Supplier;, +        return load(() -> new FastStringReader(source), (reader, props) -> props.load(reader));, +        return load(() -> StreamInput.wrap(source), (inStream, props) -> props.load(inStream));, +    }, +, +    private final <T extends Closeable> Map<String, String> load(, +            Supplier<T> supplier,, +            IOExceptionThrowingBiConsumer<T, Properties> properties, +    ) throws IOException {, +        T t = null;, +            t = supplier.get();, +            final Properties props = new NoDuplicatesProperties();, +            properties.accept(t, props);, +            final Map<String, String> result = new HashMap<>();, +            IOUtils.closeWhileHandlingException(t);, +    @FunctionalInterface, +    private interface IOExceptionThrowingBiConsumer<T, U> {, +        void accept(T t, U u) throws IOException;, +    }, +, +++ b/qa/vagrant/src/test/resources/packaging/scripts/os_package.bash, +        dpkg -i elasticsearch-$version.deb]