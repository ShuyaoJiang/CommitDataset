[+++ b/core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorTests.java, +import org.apache.lucene.index.DirectoryReader;, +import org.apache.lucene.index.IndexWriter;, +import org.apache.lucene.index.IndexWriterConfig;, +        IndexWriterConfig indexWriterConfig = newIndexWriterConfig();, +        indexWriterConfig.setMaxBufferedDocs(100);, +        indexWriterConfig.setRAMBufferSizeMB(100); // flush on open to have a single segment with predictable docIds, +                IndexWriter w = new IndexWriter(dir, indexWriterConfig)) {, +            try (IndexReader reader = DirectoryReader.open(w)) {, +                assertEquals("test expects a single segment", 1, reader.leaves().size());]