[+++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValue.java, +import java.util.Objects;, +    protected final double value;, +    public InternalSimpleValue doReduce(List<InternalAggregation> aggregations, ReduceContext reduceContext) {, +, +    @Override, +    protected int doHashCode() {, +        return Objects.hash(value);, +    }, +, +    @Override, +    protected boolean doEquals(Object obj) {, +        InternalSimpleValue other = (InternalSimpleValue) obj;, +        return Objects.equals(value, other.value);, +    }, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValue.java, +import java.util.Objects;, +    protected final double value;, +    public InternalSimpleValue doReduce(List<InternalAggregation> aggregations, ReduceContext reduceContext) {, +, +    @Override, +    protected int doHashCode() {, +        return Objects.hash(value);, +    }, +, +    @Override, +    protected boolean doEquals(Object obj) {, +        InternalSimpleValue other = (InternalSimpleValue) obj;, +        return Objects.equals(value, other.value);, +    }, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivative.java, +import java.util.Objects;, +, +    @Override, +    protected int doHashCode() {, +        return Objects.hash(normalizationFactor, value);, +    }, +, +    @Override, +    protected boolean doEquals(Object obj) {, +        InternalDerivative other = (InternalDerivative) obj;, +        return Objects.equals(value, other.value), +                && Objects.equals(normalizationFactor, other.normalizationFactor);, +    }, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValue.java, +import java.util.Objects;, +    protected final double value;, +    public InternalSimpleValue doReduce(List<InternalAggregation> aggregations, ReduceContext reduceContext) {, +, +    @Override, +    protected int doHashCode() {, +        return Objects.hash(value);, +    }, +, +    @Override, +    protected boolean doEquals(Object obj) {, +        InternalSimpleValue other = (InternalSimpleValue) obj;, +        return Objects.equals(value, other.value);, +    }, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivative.java, +import java.util.Objects;, +, +    @Override, +    protected int doHashCode() {, +        return Objects.hash(normalizationFactor, value);, +    }, +, +    @Override, +    protected boolean doEquals(Object obj) {, +        InternalDerivative other = (InternalDerivative) obj;, +        return Objects.equals(value, other.value), +                && Objects.equals(normalizationFactor, other.normalizationFactor);, +    }, +++ b/core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java, +    public void testReduceRandom() {, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValue.java, +import java.util.Objects;, +    protected final double value;, +    public InternalSimpleValue doReduce(List<InternalAggregation> aggregations, ReduceContext reduceContext) {, +, +    @Override, +    protected int doHashCode() {, +        return Objects.hash(value);, +    }, +, +    @Override, +    protected boolean doEquals(Object obj) {, +        InternalSimpleValue other = (InternalSimpleValue) obj;, +        return Objects.equals(value, other.value);, +    }, +++ b/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivative.java, +import java.util.Objects;, +, +    @Override, +    protected int doHashCode() {, +        return Objects.hash(normalizationFactor, value);, +    }, +, +    @Override, +    protected boolean doEquals(Object obj) {]