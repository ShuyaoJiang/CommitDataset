[+++ b/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java, +        if (generator.isClosed()) {, +            return;, +        }, +++ b/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java, +        if (generator.isClosed()) {, +            return;, +        }, +++ b/src/test/java/org/elasticsearch/common/xcontent/builder/XContentBuilderTests.java, +    public void testPrettyWithLfAtEnd() throws Exception {, +        FastCharArrayWriter writer = new FastCharArrayWriter();, +        XContentGenerator generator = XContentFactory.xContent(XContentType.JSON).createGenerator(writer);, +        generator.usePrettyPrint();, +        generator.usePrintLineFeedAtEnd();, +, +        generator.writeStartObject();, +        generator.writeStringField("test", "value");, +        generator.writeEndObject();, +        generator.flush();, +, +        generator.close();, +        // double close, and check there is no error..., +        generator.close();, +, +        assertThat(writer.unsafeCharArray()[writer.size() - 1], equalTo('\n'));, +    }, +, +    @Test]