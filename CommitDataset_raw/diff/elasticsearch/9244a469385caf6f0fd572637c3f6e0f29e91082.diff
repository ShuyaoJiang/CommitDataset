[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchCache.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, + * @author kimchy (shay.banon), +    private final Queue<Collection<ShardSearchFailure>> cacheShardFailures = new LinkedTransferQueue<Collection<ShardSearchFailure>>();, +    private final Queue<Collection<DfsSearchResult>> cacheDfsResults = new LinkedTransferQueue<Collection<DfsSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QuerySearchResultProvider>> cacheQueryResults = new LinkedTransferQueue<Map<SearchShardTarget, QuerySearchResultProvider>>();, +    private final Queue<Map<SearchShardTarget, FetchSearchResult>> cacheFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, FetchSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QueryFetchSearchResult>> cacheQueryFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, QueryFetchSearchResult>>();, +            cacheShardFailures.offer(new LinkedTransferQueue<ShardSearchFailure>());, +            cacheDfsResults.offer(new LinkedTransferQueue<DfsSearchResult>());, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchCache.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, + * @author kimchy (shay.banon), +    private final Queue<Collection<ShardSearchFailure>> cacheShardFailures = new LinkedTransferQueue<Collection<ShardSearchFailure>>();, +    private final Queue<Collection<DfsSearchResult>> cacheDfsResults = new LinkedTransferQueue<Collection<DfsSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QuerySearchResultProvider>> cacheQueryResults = new LinkedTransferQueue<Map<SearchShardTarget, QuerySearchResultProvider>>();, +    private final Queue<Map<SearchShardTarget, FetchSearchResult>> cacheFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, FetchSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QueryFetchSearchResult>> cacheQueryFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, QueryFetchSearchResult>>();, +            cacheShardFailures.offer(new LinkedTransferQueue<ShardSearchFailure>());, +            cacheDfsResults.offer(new LinkedTransferQueue<DfsSearchResult>());, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +import org.elasticsearch.util.concurrent.jsr166y.ThreadLocalRandom;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchCache.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, + * @author kimchy (shay.banon), +    private final Queue<Collection<ShardSearchFailure>> cacheShardFailures = new LinkedTransferQueue<Collection<ShardSearchFailure>>();, +    private final Queue<Collection<DfsSearchResult>> cacheDfsResults = new LinkedTransferQueue<Collection<DfsSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QuerySearchResultProvider>> cacheQueryResults = new LinkedTransferQueue<Map<SearchShardTarget, QuerySearchResultProvider>>();, +    private final Queue<Map<SearchShardTarget, FetchSearchResult>> cacheFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, FetchSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QueryFetchSearchResult>> cacheQueryFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, QueryFetchSearchResult>>();, +            cacheShardFailures.offer(new LinkedTransferQueue<ShardSearchFailure>());, +            cacheDfsResults.offer(new LinkedTransferQueue<DfsSearchResult>());, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +import org.elasticsearch.util.concurrent.jsr166y.ThreadLocalRandom;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, +        private Queue<LocalDiscovery> members = new LinkedTransferQueue<LocalDiscovery>();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchCache.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, + * @author kimchy (shay.banon), +    private final Queue<Collection<ShardSearchFailure>> cacheShardFailures = new LinkedTransferQueue<Collection<ShardSearchFailure>>();, +    private final Queue<Collection<DfsSearchResult>> cacheDfsResults = new LinkedTransferQueue<Collection<DfsSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QuerySearchResultProvider>> cacheQueryResults = new LinkedTransferQueue<Map<SearchShardTarget, QuerySearchResultProvider>>();, +    private final Queue<Map<SearchShardTarget, FetchSearchResult>> cacheFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, FetchSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QueryFetchSearchResult>> cacheQueryFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, QueryFetchSearchResult>>();, +            cacheShardFailures.offer(new LinkedTransferQueue<ShardSearchFailure>());, +            cacheDfsResults.offer(new LinkedTransferQueue<DfsSearchResult>());, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +import org.elasticsearch.util.concurrent.jsr166y.ThreadLocalRandom;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, +        private Queue<LocalDiscovery> members = new LinkedTransferQueue<LocalDiscovery>();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/translog/memory/MemoryTranslog.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, +import java.util.Queue;, +    private final Queue<Operation> operations = new LinkedTransferQueue<Operation>();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchCache.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, + * @author kimchy (shay.banon), +    private final Queue<Collection<ShardSearchFailure>> cacheShardFailures = new LinkedTransferQueue<Collection<ShardSearchFailure>>();, +    private final Queue<Collection<DfsSearchResult>> cacheDfsResults = new LinkedTransferQueue<Collection<DfsSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QuerySearchResultProvider>> cacheQueryResults = new LinkedTransferQueue<Map<SearchShardTarget, QuerySearchResultProvider>>();, +    private final Queue<Map<SearchShardTarget, FetchSearchResult>> cacheFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, FetchSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QueryFetchSearchResult>> cacheQueryFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, QueryFetchSearchResult>>();, +            cacheShardFailures.offer(new LinkedTransferQueue<ShardSearchFailure>());, +            cacheDfsResults.offer(new LinkedTransferQueue<DfsSearchResult>());, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +import org.elasticsearch.util.concurrent.jsr166y.ThreadLocalRandom;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, +        private Queue<LocalDiscovery> members = new LinkedTransferQueue<LocalDiscovery>();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/translog/memory/MemoryTranslog.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, +import java.util.Queue;, +    private final Queue<Operation> operations = new LinkedTransferQueue<Operation>();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/rest/action/main/RestMainAction.java, +import org.elasticsearch.util.concurrent.jsr166y.ThreadLocalRandom;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/action/search/type/TransportSearchCache.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, + * @author kimchy (shay.banon), +    private final Queue<Collection<ShardSearchFailure>> cacheShardFailures = new LinkedTransferQueue<Collection<ShardSearchFailure>>();, +    private final Queue<Collection<DfsSearchResult>> cacheDfsResults = new LinkedTransferQueue<Collection<DfsSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QuerySearchResultProvider>> cacheQueryResults = new LinkedTransferQueue<Map<SearchShardTarget, QuerySearchResultProvider>>();, +    private final Queue<Map<SearchShardTarget, FetchSearchResult>> cacheFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, FetchSearchResult>>();, +    private final Queue<Map<SearchShardTarget, QueryFetchSearchResult>> cacheQueryFetchResults = new LinkedTransferQueue<Map<SearchShardTarget, QueryFetchSearchResult>>();, +            cacheShardFailures.offer(new LinkedTransferQueue<ShardSearchFailure>());, +            cacheDfsResults.offer(new LinkedTransferQueue<DfsSearchResult>());, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java, +import org.elasticsearch.util.concurrent.jsr166y.ThreadLocalRandom;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, +        private Queue<LocalDiscovery> members = new LinkedTransferQueue<LocalDiscovery>();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/index/translog/memory/MemoryTranslog.java, +import org.elasticsearch.util.concurrent.jsr166y.LinkedTransferQueue;, +import java.util.Queue;, +    private final Queue<Operation> operations = new LinkedTransferQueue<Operation>();, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/rest/action/main/RestMainAction.java, +import org.elasticsearch.util.concurrent.jsr166y.ThreadLocalRandom;, +++ b/modules/elasticsearch/src/main/java/org/elasticsearch/util/Names.java, +import org.elasticsearch.util.concurrent.jsr166y.ThreadLocalRandom;]