[+++ b/server/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java, +                mdBuilder.version(currentState.metaData().version());, +++ b/server/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java, +                mdBuilder.version(currentState.metaData().version());, +++ b/server/src/test/java/org/elasticsearch/cluster/SimpleClusterStateIT.java, +import static org.hamcrest.Matchers.greaterThan;, +    public void testMetadataVersion() {, +        createIndex("index-1");, +        createIndex("index-2");, +        long metadataVersion = client().admin().cluster().prepareState().get().getState().metaData().version();, +        assertThat(metadataVersion, greaterThan(0L));, +        assertThat(client().admin().cluster().prepareState().setIndices("index-1").get().getState().metaData().version(),, +            equalTo(metadataVersion));, +        assertThat(client().admin().cluster().prepareState().setIndices("index-2").get().getState().metaData().version(),, +            equalTo(metadataVersion));, +        assertThat(client().admin().cluster().prepareState().setIndices("*").get().getState().metaData().version(),, +            equalTo(metadataVersion));, +        assertThat(client().admin().cluster().prepareState().setIndices("not-found").get().getState().metaData().version(),, +            equalTo(metadataVersion));, +        assertThat(client().admin().cluster().prepareState().clear().setMetaData(false).get().getState().metaData().version(),, +            equalTo(0L));, +    }, +]