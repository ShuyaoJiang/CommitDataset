[+++ b/rest-api-spec/src/main/resources/rest-api-spec/test/search/10_source_filtering.yml, +        - 'There are doc-value fields which are not using a format. The output will change in 7.0 when doc value fields get formatted based on mappings by default. It is recommended to pass [format=use_field_mapping] with a doc value field in order to opt in for the future behaviour and ease the migration to 7.0: [count]', +"multiple docvalue_fields":, +  - skip:, +      version: " - 6.3.99", +      reason: format option was added in 6.4, +      features: warnings, +  - do:, +      warnings:, +        - 'There are doc-value fields which are not using a format. The output will change in 7.0 when doc value fields get formatted based on mappings by default. It is recommended to pass [format=use_field_mapping] with a doc value field in order to opt in for the future behaviour and ease the migration to 7.0: [count, include.field1.keyword]', +      search:, +        body:, +          docvalue_fields: [ "count", "include.field1.keyword" ], +  - match: { hits.hits.0.fields.count: [1] }, +, +---, +        - 'There are doc-value fields which are not using a format. The output will change in 7.0 when doc value fields get formatted based on mappings by default. It is recommended to pass [format=use_field_mapping] with a doc value field in order to opt in for the future behaviour and ease the migration to 7.0: [count]', +++ b/rest-api-spec/src/main/resources/rest-api-spec/test/search/10_source_filtering.yml, +        - 'There are doc-value fields which are not using a format. The output will change in 7.0 when doc value fields get formatted based on mappings by default. It is recommended to pass [format=use_field_mapping] with a doc value field in order to opt in for the future behaviour and ease the migration to 7.0: [count]', +"multiple docvalue_fields":, +  - skip:, +      version: " - 6.3.99", +      reason: format option was added in 6.4, +      features: warnings, +  - do:, +      warnings:, +        - 'There are doc-value fields which are not using a format. The output will change in 7.0 when doc value fields get formatted based on mappings by default. It is recommended to pass [format=use_field_mapping] with a doc value field in order to opt in for the future behaviour and ease the migration to 7.0: [count, include.field1.keyword]', +      search:, +        body:, +          docvalue_fields: [ "count", "include.field1.keyword" ], +  - match: { hits.hits.0.fields.count: [1] }, +, +---, +        - 'There are doc-value fields which are not using a format. The output will change in 7.0 when doc value fields get formatted based on mappings by default. It is recommended to pass [format=use_field_mapping] with a doc value field in order to opt in for the future behaviour and ease the migration to 7.0: [count]', +++ b/server/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsFetchSubPhase.java, +import java.util.stream.Collectors;, +        List<String> noFormatFields = context.docValueFieldsContext().fields().stream().filter(f -> f.format == null).map(f -> f.field), +                .collect(Collectors.toList());, +        if (noFormatFields.isEmpty() == false) {, +            DEPRECATION_LOGGER.deprecated("There are doc-value fields which are not using a format. The output will ", +                    + "change in 7.0 when doc value fields get formatted based on mappings by default. It is recommended to pass ", +                    + "[format={}] with a doc value field in order to opt in for the future behaviour and ease the migration to ", +                    + "7.0: {}", DocValueFieldsContext.USE_DEFAULT_FORMAT, noFormatFields);, +        }, +]