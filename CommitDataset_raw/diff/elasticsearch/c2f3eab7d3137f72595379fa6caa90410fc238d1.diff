[+++ b/src/main/java/org/apache/lucene/search/ShardFieldDocSortedHitQueue.java, +import org.apache.lucene.util.BytesRef;, +     * @param docA ScoreDoc, +     * @param docB ScoreDoc, +                final BytesRef s1 = (BytesRef) docA.fields[i];, +                final BytesRef s2 = (BytesRef) docB.fields[i];, +++ b/src/main/java/org/apache/lucene/search/ShardFieldDocSortedHitQueue.java, +import org.apache.lucene.util.BytesRef;, +     * @param docA ScoreDoc, +     * @param docB ScoreDoc, +                final BytesRef s1 = (BytesRef) docA.fields[i];, +                final BytesRef s2 = (BytesRef) docB.fields[i];, +++ b/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +import org.apache.lucene.util.BytesRef;, +                    } else if (type == 9) {, +                        cFields[j] = in.readBytesRef();, +                        } else if (type == BytesRef.class) {, +                            out.writeByte((byte) 9);, +                            out.writeBytesRef((BytesRef) field);, +++ b/src/main/java/org/apache/lucene/search/ShardFieldDocSortedHitQueue.java, +import org.apache.lucene.util.BytesRef;, +     * @param docA ScoreDoc, +     * @param docB ScoreDoc, +                final BytesRef s1 = (BytesRef) docA.fields[i];, +                final BytesRef s2 = (BytesRef) docB.fields[i];, +++ b/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +import org.apache.lucene.util.BytesRef;, +                    } else if (type == 9) {, +                        cFields[j] = in.readBytesRef();, +                        } else if (type == BytesRef.class) {, +                            out.writeByte((byte) 9);, +                            out.writeBytesRef((BytesRef) field);, +++ b/src/main/java/org/elasticsearch/index/field/data/DocFieldData.java, +    public String stringValue() {, +        BytesRef val = fieldData.stringValue(docId);, +        if (val == null) {, +            return null;, +        }, +        return val.utf8ToString();, +    public String getStringValue() {, +++ b/src/main/java/org/apache/lucene/search/ShardFieldDocSortedHitQueue.java, +import org.apache.lucene.util.BytesRef;, +     * @param docA ScoreDoc, +     * @param docB ScoreDoc, +                final BytesRef s1 = (BytesRef) docA.fields[i];, +                final BytesRef s2 = (BytesRef) docB.fields[i];, +++ b/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +import org.apache.lucene.util.BytesRef;, +                    } else if (type == 9) {, +                        cFields[j] = in.readBytesRef();, +                        } else if (type == BytesRef.class) {, +                            out.writeByte((byte) 9);, +                            out.writeBytesRef((BytesRef) field);, +++ b/src/main/java/org/elasticsearch/index/field/data/DocFieldData.java, +    public String stringValue() {, +        BytesRef val = fieldData.stringValue(docId);, +        if (val == null) {, +            return null;, +        }, +        return val.utf8ToString();, +    public String getStringValue() {, +++ b/src/main/java/org/elasticsearch/index/field/data/strings/StringDocFieldData.java, +    public String getValue() {, +        BytesRef value = fieldData.value(docId);, +        if (value == null) {, +            return null;, +        }, +        return value.utf8ToString();, +    }, +, +    public String[] getValues() {, +        BytesRef[] values = fieldData.values(docId);, +        if (values == null) {, +            return null;, +        }, +        String[] stringValues = new String[values.length];, +        for (int i = 0; i < values.length; i++) {, +            stringValues[i] = values[i].utf8ToString();, +        }, +        return stringValues;, +    }, +, +    public BytesRef getBytesValue() {, +    public BytesRef[] getBytesValues() {, +++ b/src/main/java/org/apache/lucene/search/ShardFieldDocSortedHitQueue.java, +import org.apache.lucene.util.BytesRef;, +     * @param docA ScoreDoc, +     * @param docB ScoreDoc, +                final BytesRef s1 = (BytesRef) docA.fields[i];, +                final BytesRef s2 = (BytesRef) docB.fields[i];, +++ b/src/main/java/org/elasticsearch/common/lucene/Lucene.java, +import org.apache.lucene.util.BytesRef;, +                    } else if (type == 9) {, +                        cFields[j] = in.readBytesRef();, +                        } else if (type == BytesRef.class) {, +                            out.writeByte((byte) 9);, +                            out.writeBytesRef((BytesRef) field);, +++ b/src/main/java/org/elasticsearch/index/field/data/DocFieldData.java, +    public String stringValue() {, +        BytesRef val = fieldData.stringValue(docId);]