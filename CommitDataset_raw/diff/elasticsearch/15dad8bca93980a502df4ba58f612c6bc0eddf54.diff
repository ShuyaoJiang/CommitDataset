[+++ b/plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java, +        return new S3BlobStore(service, bucket, serverSideEncryption, bufferSize, cannedACL, storageClass, metadata);, +++ b/plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java, +        return new S3BlobStore(service, bucket, serverSideEncryption, bufferSize, cannedACL, storageClass, metadata);, +++ b/server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java, +    private final ChecksumBlobStoreFormat<MetaData> globalMetaDataFormat;, +    private final ChecksumBlobStoreFormat<IndexMetaData> indexMetaDataFormat;, +    private final ChecksumBlobStoreFormat<SnapshotInfo> snapshotFormat;, +        globalMetaDataFormat = new ChecksumBlobStoreFormat<>(METADATA_CODEC, METADATA_NAME_FORMAT,, +            MetaData::fromXContent, namedXContentRegistry, compress);, +        indexMetaDataFormat = new ChecksumBlobStoreFormat<>(INDEX_METADATA_CODEC, METADATA_NAME_FORMAT,, +            IndexMetaData::fromXContent, namedXContentRegistry, compress);, +        snapshotFormat = new ChecksumBlobStoreFormat<>(SNAPSHOT_CODEC, SNAPSHOT_NAME_FORMAT,, +            SnapshotInfo::fromXContentInternal, namedXContentRegistry, compress);, +++ b/plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java, +        return new S3BlobStore(service, bucket, serverSideEncryption, bufferSize, cannedACL, storageClass, metadata);, +++ b/server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java, +    private final ChecksumBlobStoreFormat<MetaData> globalMetaDataFormat;, +    private final ChecksumBlobStoreFormat<IndexMetaData> indexMetaDataFormat;, +    private final ChecksumBlobStoreFormat<SnapshotInfo> snapshotFormat;, +        globalMetaDataFormat = new ChecksumBlobStoreFormat<>(METADATA_CODEC, METADATA_NAME_FORMAT,, +            MetaData::fromXContent, namedXContentRegistry, compress);, +        indexMetaDataFormat = new ChecksumBlobStoreFormat<>(INDEX_METADATA_CODEC, METADATA_NAME_FORMAT,, +            IndexMetaData::fromXContent, namedXContentRegistry, compress);, +        snapshotFormat = new ChecksumBlobStoreFormat<>(SNAPSHOT_CODEC, SNAPSHOT_NAME_FORMAT,, +            SnapshotInfo::fromXContentInternal, namedXContentRegistry, compress);, +++ b/server/src/main/java/org/elasticsearch/repositories/fs/FsRepository.java, +    private final ByteSizeValue chunkSize;]