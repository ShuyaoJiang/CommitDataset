[+++ b/src/test/java/org/apache/lucene/analysis/miscellaneous/TruncateTokenFilterTests.java, +import org.apache.lucene.analysis.core.WhitespaceTokenizer;, +        Analyzer analyzer = new Analyzer() {, +        TokenStream test = analyzer.tokenStream("test", new StringReader("a bb ccc dddd eeeee"));, +++ b/src/test/java/org/apache/lucene/analysis/miscellaneous/TruncateTokenFilterTests.java, +import org.apache.lucene.analysis.core.WhitespaceTokenizer;, +        Analyzer analyzer = new Analyzer() {, +        TokenStream test = analyzer.tokenStream("test", new StringReader("a bb ccc dddd eeeee"));, +++ b/src/test/java/org/apache/lucene/analysis/miscellaneous/UniqueTokenFilterTests.java, +import org.apache.lucene.analysis.core.WhitespaceTokenizer;, +        Analyzer analyzer = new Analyzer() {, +        TokenStream test = analyzer.tokenStream("test", new StringReader("this test with test"));, +++ b/src/test/java/org/apache/lucene/analysis/miscellaneous/TruncateTokenFilterTests.java, +import org.apache.lucene.analysis.core.WhitespaceTokenizer;, +        Analyzer analyzer = new Analyzer() {, +        TokenStream test = analyzer.tokenStream("test", new StringReader("a bb ccc dddd eeeee"));, +++ b/src/test/java/org/apache/lucene/analysis/miscellaneous/UniqueTokenFilterTests.java, +import org.apache.lucene.analysis.core.WhitespaceTokenizer;, +        Analyzer analyzer = new Analyzer() {, +        TokenStream test = analyzer.tokenStream("test", new StringReader("this test with test"));, +++ b/src/test/java/org/elasticsearch/benchmark/common/lucene/uidscan/LuceneUidScanBenchmark.java, +import org.apache.lucene.util.BytesRef;, +                            DocsAndPositionsEnum uid = MultiFields.getTermPositionsEnum(reader,, +                                    MultiFields.getLiveDocs(reader),, +                                    "_uid",, +                                    new BytesRef(Long.toString(id)));, +                            uid.nextDoc();, +                            if (uid.getPayload() == null) {, +                            BytesRef payload = uid.getPayload();, +                            if (Numbers.bytesToLong(BytesRef.deepCopyOf(payload).bytes) != id) {, +++ b/src/test/java/org/apache/lucene/analysis/miscellaneous/TruncateTokenFilterTests.java, +import org.apache.lucene.analysis.core.WhitespaceTokenizer;, +        Analyzer analyzer = new Analyzer() {, +        TokenStream test = analyzer.tokenStream("test", new StringReader("a bb ccc dddd eeeee"));, +++ b/src/test/java/org/apache/lucene/analysis/miscellaneous/UniqueTokenFilterTests.java, +import org.apache.lucene.analysis.core.WhitespaceTokenizer;, +        Analyzer analyzer = new Analyzer() {, +        TokenStream test = analyzer.tokenStream("test", new StringReader("this test with test"));, +++ b/src/test/java/org/elasticsearch/benchmark/common/lucene/uidscan/LuceneUidScanBenchmark.java, +import org.apache.lucene.util.BytesRef;, +                            DocsAndPositionsEnum uid = MultiFields.getTermPositionsEnum(reader,, +                                    MultiFields.getLiveDocs(reader),, +                                    "_uid",, +                                    new BytesRef(Long.toString(id)));, +                            uid.nextDoc();, +                            if (uid.getPayload() == null) {, +                            BytesRef payload = uid.getPayload();, +                            if (Numbers.bytesToLong(BytesRef.deepCopyOf(payload).bytes) != id) {, +++ b/src/test/java/org/elasticsearch/test/unit/common/lucene/search/TermsFilterTests.java, +import org.apache.lucene.analysis.core.KeywordAnalyzer;, +import org.apache.lucene.index.*;, +        AtomicReader reader = new SlowCompositeReaderWrapper(DirectoryReader.open(w, true));, +        FixedBitSet bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        AtomicReader reader = new SlowCompositeReaderWrapper(DirectoryReader.open(w, true));, +        FixedBitSet bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +++ b/src/test/java/org/apache/lucene/analysis/miscellaneous/TruncateTokenFilterTests.java, +import org.apache.lucene.analysis.core.WhitespaceTokenizer;, +        Analyzer analyzer = new Analyzer() {, +        TokenStream test = analyzer.tokenStream("test", new StringReader("a bb ccc dddd eeeee"));, +++ b/src/test/java/org/apache/lucene/analysis/miscellaneous/UniqueTokenFilterTests.java, +import org.apache.lucene.analysis.core.WhitespaceTokenizer;, +        Analyzer analyzer = new Analyzer() {, +        TokenStream test = analyzer.tokenStream("test", new StringReader("this test with test"));, +++ b/src/test/java/org/elasticsearch/benchmark/common/lucene/uidscan/LuceneUidScanBenchmark.java, +import org.apache.lucene.util.BytesRef;, +                            DocsAndPositionsEnum uid = MultiFields.getTermPositionsEnum(reader,, +                                    MultiFields.getLiveDocs(reader),, +                                    "_uid",, +                                    new BytesRef(Long.toString(id)));, +                            uid.nextDoc();, +                            if (uid.getPayload() == null) {, +                            BytesRef payload = uid.getPayload();, +                            if (Numbers.bytesToLong(BytesRef.deepCopyOf(payload).bytes) != id) {, +++ b/src/test/java/org/elasticsearch/test/unit/common/lucene/search/TermsFilterTests.java, +import org.apache.lucene.analysis.core.KeywordAnalyzer;, +import org.apache.lucene.index.*;, +        AtomicReader reader = new SlowCompositeReaderWrapper(DirectoryReader.open(w, true));, +        FixedBitSet bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        AtomicReader reader = new SlowCompositeReaderWrapper(DirectoryReader.open(w, true));, +        FixedBitSet bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +        bits = (FixedBitSet) tf.getDocIdSet(reader.getContext(), reader.getLiveDocs());, +++ b/src/test/java/org/elasticsearch/test/unit/index/deletionpolicy/SnapshotDeletionPolicyTests.java, +import org.apache.lucene.index.IndexWriterConfig;, +import org.apache.lucene.util.Version;, +import static org.apache.lucene.index.DirectoryReader.listCommits;, +        // LUCENE 4 UPGRADE: Not sure about version., +        indexWriter = new IndexWriter(dir, new IndexWriterConfig(Version.LUCENE_31, Lucene.STANDARD_ANALYZER), +                .setIndexDeletionPolicy(deletionPolicy), +                .setOpenMode(IndexWriterConfig.OpenMode.CREATE));, +++ b/src/test/java/org/apache/lucene/analysis/miscellaneous/TruncateTokenFilterTests.java, +import org.apache.lucene.analysis.core.WhitespaceTokenizer;]