[+++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndexRecoveryCollector.java, +import java.util.ArrayList;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.List;, +, +            //TODO this if should go away once the empty cluster / empty set of indices behaviour is fixed in the security plugin, +            if (XPackSettings.SECURITY_ENABLED.get(settings)) {, +                //&& IndexNameExpressionResolver.isAllIndices(Arrays.asList(monitoringSettings.indices()))) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndexRecoveryCollector.java, +import java.util.ArrayList;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.List;, +, +            //TODO this if should go away once the empty cluster / empty set of indices behaviour is fixed in the security plugin, +            if (XPackSettings.SECURITY_ENABLED.get(settings)) {, +                //&& IndexNameExpressionResolver.isAllIndices(Arrays.asList(monitoringSettings.indices()))) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndexStatsCollector.java, +import java.util.ArrayList;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.List;, +, +            //TODO this if should go away once the empty cluster / empty set of indices behaviour is fixed in the security plugin, +            if (XPackSettings.SECURITY_ENABLED.get(settings)) {, +                //&& IndexNameExpressionResolver.isAllIndices(Arrays.asList(monitoringSettings.indices()))) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndexRecoveryCollector.java, +import java.util.ArrayList;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.List;, +, +            //TODO this if should go away once the empty cluster / empty set of indices behaviour is fixed in the security plugin, +            if (XPackSettings.SECURITY_ENABLED.get(settings)) {, +                //&& IndexNameExpressionResolver.isAllIndices(Arrays.asList(monitoringSettings.indices()))) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndexStatsCollector.java, +import java.util.ArrayList;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.List;, +, +            //TODO this if should go away once the empty cluster / empty set of indices behaviour is fixed in the security plugin, +            if (XPackSettings.SECURITY_ENABLED.get(settings)) {, +                //&& IndexNameExpressionResolver.isAllIndices(Arrays.asList(monitoringSettings.indices()))) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndicesStatsCollector.java, +import java.util.Collection;, +import java.util.Collections;, +, +            //TODO this if should go away once the empty cluster / empty set of indices behaviour is fixed in the security plugin, +            if (XPackSettings.SECURITY_ENABLED.get(settings)) {, +                //&& IndexNameExpressionResolver.isAllIndices(Arrays.asList(monitoringSettings.indices()))) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndexRecoveryCollector.java, +import java.util.ArrayList;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.List;, +, +            //TODO this if should go away once the empty cluster / empty set of indices behaviour is fixed in the security plugin, +            if (XPackSettings.SECURITY_ENABLED.get(settings)) {, +                //&& IndexNameExpressionResolver.isAllIndices(Arrays.asList(monitoringSettings.indices()))) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndexStatsCollector.java, +import java.util.ArrayList;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.List;, +, +            //TODO this if should go away once the empty cluster / empty set of indices behaviour is fixed in the security plugin, +            if (XPackSettings.SECURITY_ENABLED.get(settings)) {, +                //&& IndexNameExpressionResolver.isAllIndices(Arrays.asList(monitoringSettings.indices()))) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndicesStatsCollector.java, +import java.util.Collection;, +import java.util.Collections;, +, +            //TODO this if should go away once the empty cluster / empty set of indices behaviour is fixed in the security plugin, +            if (XPackSettings.SECURITY_ENABLED.get(settings)) {, +                //&& IndexNameExpressionResolver.isAllIndices(Arrays.asList(monitoringSettings.indices()))) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authz/indicesresolver/DefaultIndicesAndAliasesResolver.java, +import java.util.stream.Collectors;, +            List<String> authorizedIndicesAndAliases = authzService.authorizedIndicesAndAliases(user, action);, +            List<String> replacedIndices = replaceWildcardsWithAuthorizedIndices(indicesRequest.indices(),, +                    indicesRequest.indicesOptions(), metaData, authorizedIndicesAndAliases, replaceWildcards);, +            if (indicesRequest.indicesOptions().ignoreUnavailable()) {, +                //out of all the explicit names (expanded from wildcards and original ones that were left untouched), +                //remove all the ones that the current user is not authorized for and ignore them, +                replacedIndices = replacedIndices.stream().filter(authorizedIndicesAndAliases::contains).collect(Collectors.toList());, +                throwExceptionIfNoIndicesWereResolved(indicesRequest.indices(), replacedIndices);, +            }, +            replaceable.indices(replacedIndices.toArray(new String[replacedIndices.size()]));, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndexRecoveryCollector.java, +import java.util.ArrayList;, +import java.util.Collection;, +import java.util.Collections;, +import java.util.List;, +, +            //TODO this if should go away once the empty cluster / empty set of indices behaviour is fixed in the security plugin, +            if (XPackSettings.SECURITY_ENABLED.get(settings)) {, +                //&& IndexNameExpressionResolver.isAllIndices(Arrays.asList(monitoringSettings.indices()))) {, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/monitoring/collector/indices/IndexStatsCollector.java, +import java.util.ArrayList;]