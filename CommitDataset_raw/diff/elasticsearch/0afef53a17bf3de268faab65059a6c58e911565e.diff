[+++ b/core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java, +        checks.add(new SystemCallFilterCheck(BootstrapSettings.SECCOMP_SETTING.get(settings)));, +    /**, +     * Bootstrap check that if system call filters are enabled, then system call filters must have installed successfully., +     */, +    static class SystemCallFilterCheck implements BootstrapCheck.Check {, +, +        private final boolean areSystemCallFiltersEnabled;, +, +        SystemCallFilterCheck(final boolean areSystemCallFiltersEnabled) {, +            this.areSystemCallFiltersEnabled = areSystemCallFiltersEnabled;, +        }, +, +        @Override, +        public boolean check() {, +            return areSystemCallFiltersEnabled && !isSeccompInstalled();, +        }, +, +        // visible for testing, +        boolean isSeccompInstalled() {, +            return Natives.isSeccompInstalled();, +        }, +, +        @Override, +        public String errorMessage() {, +            return "system call filters failed to install; " +, +                "check the logs and fix your configuration or disable system call filters at your own risk";, +        }, +, +    }, +, +++ b/core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java, +        checks.add(new SystemCallFilterCheck(BootstrapSettings.SECCOMP_SETTING.get(settings)));, +    /**, +     * Bootstrap check that if system call filters are enabled, then system call filters must have installed successfully., +     */, +    static class SystemCallFilterCheck implements BootstrapCheck.Check {, +, +        private final boolean areSystemCallFiltersEnabled;, +, +        SystemCallFilterCheck(final boolean areSystemCallFiltersEnabled) {, +            this.areSystemCallFiltersEnabled = areSystemCallFiltersEnabled;, +        }, +, +        @Override, +        public boolean check() {, +            return areSystemCallFiltersEnabled && !isSeccompInstalled();, +        }, +, +        // visible for testing, +        boolean isSeccompInstalled() {, +            return Natives.isSeccompInstalled();, +        }, +, +        @Override, +        public String errorMessage() {, +            return "system call filters failed to install; " +, +                "check the logs and fix your configuration or disable system call filters at your own risk";, +        }, +, +    }, +, +++ b/core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java, +    public void testSystemCallFilterCheck() throws NodeValidationException {, +        final AtomicBoolean isSecompInstalled = new AtomicBoolean();, +        final BootstrapCheck.SystemCallFilterCheck systemCallFilterEnabledCheck = new BootstrapCheck.SystemCallFilterCheck(true) {, +            @Override, +            boolean isSeccompInstalled() {, +                return isSecompInstalled.get();, +            }, +        };, +, +        final NodeValidationException e = expectThrows(, +            NodeValidationException.class,, +            () -> BootstrapCheck.check(true, Collections.singletonList(systemCallFilterEnabledCheck), "testSystemCallFilterCheck"));, +        assertThat(, +            e.getMessage(),, +            containsString("system call filters failed to install; " +, +                "check the logs and fix your configuration or disable system call filters at your own risk"));, +, +        isSecompInstalled.set(true);, +        BootstrapCheck.check(true, Collections.singletonList(systemCallFilterEnabledCheck), "testSystemCallFilterCheck");, +, +        final BootstrapCheck.SystemCallFilterCheck systemCallFilterNotEnabledCheck = new BootstrapCheck.SystemCallFilterCheck(false) {, +            @Override, +            boolean isSeccompInstalled() {, +                return isSecompInstalled.get();, +            }, +        };, +        isSecompInstalled.set(false);, +        BootstrapCheck.check(true, Collections.singletonList(systemCallFilterNotEnabledCheck), "testSystemCallFilterCheck");, +        isSecompInstalled.set(true);, +        BootstrapCheck.check(true, Collections.singletonList(systemCallFilterNotEnabledCheck), "testSystemCallFilterCheck");, +    }, +, +++ b/core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java, +        checks.add(new SystemCallFilterCheck(BootstrapSettings.SECCOMP_SETTING.get(settings)));, +    /**, +     * Bootstrap check that if system call filters are enabled, then system call filters must have installed successfully., +     */]