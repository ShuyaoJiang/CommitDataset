[+++ b/core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +import java.nio.file.attribute.PosixFileAttributes;, +import java.nio.file.attribute.PosixFilePermissions;, +        Set<PosixFilePermission> perms = new HashSet<>();, +        perms.add(PosixFilePermission.OWNER_EXECUTE);, +        perms.add(PosixFilePermission.OWNER_READ);, +        perms.add(PosixFilePermission.OWNER_WRITE);, +        perms.add(PosixFilePermission.GROUP_READ);, +        perms.add(PosixFilePermission.GROUP_EXECUTE);, +        perms.add(PosixFilePermission.OTHERS_READ);, +        perms.add(PosixFilePermission.OTHERS_EXECUTE);, +        Path target = Files.createTempDirectory(pluginsDir, ".installing-", PosixFilePermissions.asFileAttribute(perms));, +        final PosixFileAttributes destConfigDirAttributes =, +                Files.getFileAttributeView(destConfigDir.getParent(), PosixFileAttributeView.class).readAttributes();, +        setOwnerGroup(destConfigDir, destConfigDirAttributes);, +, +                    setOwnerGroup(destFile, destConfigDirAttributes);, +, +    private static void setOwnerGroup(Path path, PosixFileAttributes attributes) throws IOException {, +        PosixFileAttributeView fileAttributeView = Files.getFileAttributeView(path, PosixFileAttributeView.class);, +        fileAttributeView.setOwner(attributes.owner());, +        fileAttributeView.setGroup(attributes.group());, +    }, +, +++ b/core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +import java.nio.file.attribute.PosixFileAttributes;, +import java.nio.file.attribute.PosixFilePermissions;, +        Set<PosixFilePermission> perms = new HashSet<>();, +        perms.add(PosixFilePermission.OWNER_EXECUTE);, +        perms.add(PosixFilePermission.OWNER_READ);, +        perms.add(PosixFilePermission.OWNER_WRITE);, +        perms.add(PosixFilePermission.GROUP_READ);, +        perms.add(PosixFilePermission.GROUP_EXECUTE);, +        perms.add(PosixFilePermission.OTHERS_READ);, +        perms.add(PosixFilePermission.OTHERS_EXECUTE);, +        Path target = Files.createTempDirectory(pluginsDir, ".installing-", PosixFilePermissions.asFileAttribute(perms));, +        final PosixFileAttributes destConfigDirAttributes =, +                Files.getFileAttributeView(destConfigDir.getParent(), PosixFileAttributeView.class).readAttributes();, +        setOwnerGroup(destConfigDir, destConfigDirAttributes);, +, +                    setOwnerGroup(destFile, destConfigDirAttributes);, +, +    private static void setOwnerGroup(Path path, PosixFileAttributes attributes) throws IOException {, +        PosixFileAttributeView fileAttributeView = Files.getFileAttributeView(path, PosixFileAttributeView.class);, +        fileAttributeView.setOwner(attributes.owner());, +        fileAttributeView.setGroup(attributes.group());, +    }, +, +++ b/distribution/build.gradle, +    Closure suckUpEmptyDirectories = { path, u, g ->, +        user u, +        permissionGroup g, +    suckUpEmptyDirectories('/var/run', 'elasticsearch', 'elasticsearch'), +    suckUpEmptyDirectories('/var/log', 'elasticsearch', 'elasticsearch'), +    suckUpEmptyDirectories('/var/lib', 'elasticsearch', 'elasticsearch'), +    suckUpEmptyDirectories('/usr/share/elasticsearch', 'root', 'root'), +++ b/core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java, +import java.nio.file.attribute.PosixFileAttributes;, +import java.nio.file.attribute.PosixFilePermissions;, +        Set<PosixFilePermission> perms = new HashSet<>();, +        perms.add(PosixFilePermission.OWNER_EXECUTE);, +        perms.add(PosixFilePermission.OWNER_READ);, +        perms.add(PosixFilePermission.OWNER_WRITE);, +        perms.add(PosixFilePermission.GROUP_READ);, +        perms.add(PosixFilePermission.GROUP_EXECUTE);, +        perms.add(PosixFilePermission.OTHERS_READ);, +        perms.add(PosixFilePermission.OTHERS_EXECUTE);, +        Path target = Files.createTempDirectory(pluginsDir, ".installing-", PosixFilePermissions.asFileAttribute(perms));, +        final PosixFileAttributes destConfigDirAttributes =, +                Files.getFileAttributeView(destConfigDir.getParent(), PosixFileAttributeView.class).readAttributes();, +        setOwnerGroup(destConfigDir, destConfigDirAttributes);, +, +                    setOwnerGroup(destFile, destConfigDirAttributes);, +, +    private static void setOwnerGroup(Path path, PosixFileAttributes attributes) throws IOException {, +        PosixFileAttributeView fileAttributeView = Files.getFileAttributeView(path, PosixFileAttributeView.class);, +        fileAttributeView.setOwner(attributes.owner());, +        fileAttributeView.setGroup(attributes.group());, +    }, +, +++ b/distribution/build.gradle, +    Closure suckUpEmptyDirectories = { path, u, g ->, +        user u, +        permissionGroup g, +    suckUpEmptyDirectories('/var/run', 'elasticsearch', 'elasticsearch'), +    suckUpEmptyDirectories('/var/log', 'elasticsearch', 'elasticsearch'), +    suckUpEmptyDirectories('/var/lib', 'elasticsearch', 'elasticsearch'), +    suckUpEmptyDirectories('/usr/share/elasticsearch', 'root', 'root'), +++ b/qa/vagrant/src/test/resources/packaging/scripts/os_package.bash, +    assert_file "$ESPLUGINS" d root root 755]