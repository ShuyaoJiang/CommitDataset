[+++ b/src/main/java/org/elasticsearch/index/merge/policy/IndexUpgraderMergePolicy.java, +            // Find a free field number, +            int fieldNumber = 0;, +            for (FieldInfo fi : fieldInfos) {, +                fieldNumber = Math.max(fieldNumber, fi.number + 1);, +            }, +            newVersionInfo = new FieldInfo(UidFieldMapper.VERSION, false, fieldNumber, false, true, false,, +++ b/src/main/java/org/elasticsearch/index/merge/policy/IndexUpgraderMergePolicy.java, +            // Find a free field number, +            int fieldNumber = 0;, +            for (FieldInfo fi : fieldInfos) {, +                fieldNumber = Math.max(fieldNumber, fi.number + 1);, +            }, +            newVersionInfo = new FieldInfo(UidFieldMapper.VERSION, false, fieldNumber, false, true, false,, +++ b/src/test/java/org/elasticsearch/test/unit/common/lucene/uid/VersionsTests.java, +        // Add a dummy field (enough to trigger #3237), +        document.add(new StringField("a", "b", Store.NO));]