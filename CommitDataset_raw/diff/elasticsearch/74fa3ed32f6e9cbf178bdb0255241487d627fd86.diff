[+++ b/modules/elasticsearch/src/main/java/org/elasticsearch/discovery/zen/ping/multicast/MulticastZenPing.java, +import org.elasticsearch.ElasticSearchIllegalArgumentException;, +import org.elasticsearch.util.network.NetworkUtils;, +    private final NetworkInterface[] networkInterfaces;, +, +    private final InetAddress groupAddress;, +, +, +        try {, +            this.groupAddress = InetAddress.getByName(group);, +        } catch (Exception e) {, +            throw new ElasticSearchIllegalArgumentException("Failed to resolve group address [" + group + "]", e);, +        }, +        try {, +            this.networkInterfaces = NetworkUtils.getAllAvailableInterfaces().toArray(new NetworkInterface[0]);, +        } catch (SocketException e) {, +            throw new ElasticSearchIllegalArgumentException("Failed to get all network interfaces on the machine", e);, +        }, +, +            MulticastSocket multicastSocket;, +            if (NetworkUtils.canBindToMcastAddress()) {, +                try {, +                    multicastSocket = new MulticastSocket(new InetSocketAddress(groupAddress, port));, +                } catch (Exception e) {, +                    logger.debug("Failed to create multicast socket by binding to group address, binding to port", e);, +                    multicastSocket = new MulticastSocket(port);, +                }, +            } else {, +                multicastSocket = new MulticastSocket(port);, +            }, +, +, +, +            if (address == null) {, +                //bind on all interfaces, +                boolean joinedAtLeaseOnInterface = false;, +                Exception lastException = null;, +                for (NetworkInterface inf : NetworkUtils.getAllAvailableInterfaces()) {, +                    try {, +                        multicastSocket.joinGroup(new InetSocketAddress(groupAddress, port), inf);, +                        logger.trace("Joined network interface {} for group {} and port {}", inf, groupAddress, port);, +                        joinedAtLeaseOnInterface = true;, +                    } catch (Exception e) {, +                        lastException = e;, +                        logger.debug("Failed to join on network interface {}", e, inf);, +                    }, +                }, +                if (!joinedAtLeaseOnInterface) {, +                    throw new DiscoveryException("Failed to join any network interface", lastException);, +                }, +            } else {, +                multicastSocket.joinGroup(groupAddress);, +                logger.trace("Joined address {} for group {} and port {}", multicastInterface, groupAddress, port);, +            }, +                datagramPacketSend.setAddress(groupAddress);, +                datagramPacketSend.setPort(port);, +            if (networkInterfaces != null) {, +                Exception lastException = null;, +                boolean sentToAtLeastOne = false;, +                for (NetworkInterface inf : networkInterfaces) {, +                    if (logger.isTraceEnabled()) {, +                        logger.trace("[{}] Sending ping request on interface {}", id, inf);, +                    }, +                        multicastSocket.setNetworkInterface(inf);, +                        sentToAtLeastOne = true;, +                    } catch (Exception e) {, +                        lastException = e;, +                    }, +                }, +                if (!sentToAtLeastOne) {, +                    throw new ZenPingException("Failed to send on any of the network interfaces", lastException);, +                }, +            } else {, +                try {, +                    multicastSocket.send(datagramPacketSend);, +    }]