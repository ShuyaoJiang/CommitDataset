[+++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authc/AuthenticationService.java, +                            user = new User(user, runAsUser);, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authc/AuthenticationService.java, +                            user = new User(user, runAsUser);, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/user/User.java, +    public User(User user, User runAs) {, +        this(user.principal(), user.roles(), user.fullName(), user.email(), user.metadata(), user.enabled(), runAs);, +    }, +, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/authc/AuthenticationService.java, +                            user = new User(user, runAsUser);, +++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/security/user/User.java, +    public User(User user, User runAs) {, +        this(user.principal(), user.roles(), user.fullName(), user.email(), user.metadata(), user.enabled(), runAs);, +    }, +, +++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/security/authc/AuthenticationServiceTests.java, +        final User user = new User("lookup user", new String[]{"user"}, "lookup user", "lookup@foo.foo",, +                Collections.singletonMap("foo", "bar"), true);, +        when(secondRealm.authenticate(token)).thenReturn(user);, +        assertEquals(user.metadata(), authenticated.metadata());, +        assertEquals(user.email(), authenticated.email());, +        assertEquals(user.enabled(), authenticated.enabled());, +        assertEquals(user.fullName(), authenticated.fullName());, +]