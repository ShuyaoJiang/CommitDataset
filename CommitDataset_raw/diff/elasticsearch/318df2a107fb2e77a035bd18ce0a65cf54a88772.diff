[+++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java, +            if (in.getVersion().onOrAfter(Version.V_6_5_0)) {, +            if (out.getVersion().onOrAfter(Version.V_6_5_0)) {, +        if (in.getVersion().onOrAfter(Version.V_6_5_0)) {, +        if (out.getVersion().onOrAfter(Version.V_6_5_0)) {, +            if (Assertions.ENABLED && Version.indexCreated(builder.settings).onOrAfter(Version.V_6_5_0)) {, +                assert mappingVersion : "mapping version should be present for indices created on or after 6.5.0";, +++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java, +            if (in.getVersion().onOrAfter(Version.V_6_5_0)) {, +            if (out.getVersion().onOrAfter(Version.V_6_5_0)) {, +        if (in.getVersion().onOrAfter(Version.V_6_5_0)) {, +        if (out.getVersion().onOrAfter(Version.V_6_5_0)) {, +            if (Assertions.ENABLED && Version.indexCreated(builder.settings).onOrAfter(Version.V_6_5_0)) {, +                assert mappingVersion : "mapping version should be present for indices created on or after 6.5.0";, +++ b/server/src/main/java/org/elasticsearch/index/mapper/MapperService.java, +                && currentIndexMetaData.getCreationVersion().onOrAfter(Version.V_6_5_0)) {]