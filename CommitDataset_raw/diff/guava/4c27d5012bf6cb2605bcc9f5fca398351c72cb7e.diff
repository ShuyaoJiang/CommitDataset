[+++ b/guava-tests/test/com/google/common/io/ByteSourceTest.java, +    suite.addTest(ByteSourceTester.tests("ByteSource.empty[]",, +        SourceSinkFactories.emptyByteSourceFactory(), true));, +++ b/guava-tests/test/com/google/common/io/ByteSourceTest.java, +    suite.addTest(ByteSourceTester.tests("ByteSource.empty[]",, +        SourceSinkFactories.emptyByteSourceFactory(), true));, +++ b/guava-tests/test/com/google/common/io/ByteSourceTester.java, +      // if expected.length == 0, off has to be 0 but length doesn't matter--result will be empty, +      int off = expected.length == 0 ? 0 : random.nextInt(expected.length);, +      int len = expected.length == 0 ? 4 : random.nextInt(expected.length - off);, +++ b/guava-tests/test/com/google/common/io/ByteSourceTest.java, +    suite.addTest(ByteSourceTester.tests("ByteSource.empty[]",, +        SourceSinkFactories.emptyByteSourceFactory(), true));, +++ b/guava-tests/test/com/google/common/io/ByteSourceTester.java, +      // if expected.length == 0, off has to be 0 but length doesn't matter--result will be empty, +      int off = expected.length == 0 ? 0 : random.nextInt(expected.length);, +      int len = expected.length == 0 ? 4 : random.nextInt(expected.length - off);, +++ b/guava-tests/test/com/google/common/io/CharSourceTest.java, +    suite.addTest(CharSourceTester.tests("CharSource.empty[]",, +        SourceSinkFactories.emptyCharSourceFactory()));, +++ b/guava-tests/test/com/google/common/io/ByteSourceTest.java, +    suite.addTest(ByteSourceTester.tests("ByteSource.empty[]",, +        SourceSinkFactories.emptyByteSourceFactory(), true));, +++ b/guava-tests/test/com/google/common/io/ByteSourceTester.java, +      // if expected.length == 0, off has to be 0 but length doesn't matter--result will be empty, +      int off = expected.length == 0 ? 0 : random.nextInt(expected.length);, +      int len = expected.length == 0 ? 4 : random.nextInt(expected.length - off);, +++ b/guava-tests/test/com/google/common/io/CharSourceTest.java, +    suite.addTest(CharSourceTester.tests("CharSource.empty[]",, +        SourceSinkFactories.emptyCharSourceFactory()));, +++ b/guava-tests/test/com/google/common/io/SourceSinkFactories.java, +  public static ByteSourceFactory emptyByteSourceFactory() {, +    return new EmptyByteSourceFactory();, +  }, +, +  public static CharSourceFactory emptyCharSourceFactory() {, +    return new EmptyCharSourceFactory();, +  }, +, +        return new String(factory.getExpected(data.getBytes(Charsets.UTF_8)), Charsets.UTF_8);, +        byte[] baseExpected = factory.getExpected(bytes);, +        return Arrays.copyOfRange(baseExpected, off, Math.min(baseExpected.length, off + len));, +  private static class EmptyCharSourceFactory implements CharSourceFactory {, +, +    @Override, +    public CharSource createSource(String data) throws IOException {, +      return CharSource.empty();, +    }, +, +    @Override, +    public String getExpected(String data) {, +      return "";, +    }, +, +    @Override, +    public void tearDown() throws IOException {, +    }, +  }, +, +  private static class EmptyByteSourceFactory implements ByteSourceFactory {, +, +    @Override, +    public ByteSource createSource(byte[] bytes) throws IOException {, +      return ByteSource.empty();, +    }, +, +    @Override, +    public byte[] getExpected(byte[] bytes) {, +      return new byte[0];, +    }, +, +    @Override, +    public void tearDown() throws IOException {, +    }, +  }, +, +++ b/guava-tests/test/com/google/common/io/ByteSourceTest.java, +    suite.addTest(ByteSourceTester.tests("ByteSource.empty[]",, +        SourceSinkFactories.emptyByteSourceFactory(), true));, +++ b/guava-tests/test/com/google/common/io/ByteSourceTester.java, +      // if expected.length == 0, off has to be 0 but length doesn't matter--result will be empty, +      int off = expected.length == 0 ? 0 : random.nextInt(expected.length);, +      int len = expected.length == 0 ? 4 : random.nextInt(expected.length - off);, +++ b/guava-tests/test/com/google/common/io/CharSourceTest.java, +    suite.addTest(CharSourceTester.tests("CharSource.empty[]",, +        SourceSinkFactories.emptyCharSourceFactory()));, +++ b/guava-tests/test/com/google/common/io/SourceSinkFactories.java, +  public static ByteSourceFactory emptyByteSourceFactory() {, +    return new EmptyByteSourceFactory();, +  }, +, +  public static CharSourceFactory emptyCharSourceFactory() {, +    return new EmptyCharSourceFactory();, +  }, +, +        return new String(factory.getExpected(data.getBytes(Charsets.UTF_8)), Charsets.UTF_8);, +        byte[] baseExpected = factory.getExpected(bytes);, +        return Arrays.copyOfRange(baseExpected, off, Math.min(baseExpected.length, off + len));, +  private static class EmptyCharSourceFactory implements CharSourceFactory {, +]