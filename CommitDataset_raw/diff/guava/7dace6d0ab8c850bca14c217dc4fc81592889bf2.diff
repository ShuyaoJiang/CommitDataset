[+++ b/guava/src/com/google/common/util/concurrent/Futures.java, +import com.google.common.collect.Sets;, +import java.util.Set;, +    final Object seenExceptionsLock = new Object();, +    Set<Throwable> seenExceptions;, +     * {@link #allMustSucceed} is {@code true}, the throwable did not cause, +     * this future to fail, and it is the first time we've seen that particular Throwable., +      boolean visibleFromOutputFuture = false;, +      boolean firstTimeSeeingThisException = true;, +        visibleFromOutputFuture = super.setException(throwable);, +, +        synchronized (seenExceptionsLock) {, +          if (seenExceptions == null) {, +            seenExceptions = Sets.newHashSet();, +          firstTimeSeeingThisException = seenExceptions.add(throwable);, +        }, +      }, +, +      if (throwable instanceof Error, +          || (allMustSucceed && !visibleFromOutputFuture && firstTimeSeeingThisException)) {]