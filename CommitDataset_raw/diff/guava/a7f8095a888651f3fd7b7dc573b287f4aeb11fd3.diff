[+++ b/guava-testlib/src/com/google/common/collect/testing/DerivedCollectionGenerators.java, +    TestContainerGenerator<Map<K, V>, Entry<K, V>> generator = mapGenerator.getInnerGenerator();, +    if (generator instanceof TestSortedMapGenerator, +        && ((TestSortedMapGenerator<K, V>) generator).create().keySet() instanceof SortedSet) {, +++ b/guava-testlib/src/com/google/common/collect/testing/DerivedCollectionGenerators.java, +    TestContainerGenerator<Map<K, V>, Entry<K, V>> generator = mapGenerator.getInnerGenerator();, +    if (generator instanceof TestSortedMapGenerator, +        && ((TestSortedMapGenerator<K, V>) generator).create().keySet() instanceof SortedSet) {, +++ b/guava-testlib/src/com/google/common/collect/testing/SortedMapTestSuiteBuilder.java, +  @Override protected SetTestSuiteBuilder<K> createDerivedKeySetSuite(, +    return keySetGenerator instanceof TestSortedSetGenerator, +        ? SortedSetTestSuiteBuilder.using((TestSortedSetGenerator<K>) keySetGenerator), +        : SetTestSuiteBuilder.using(keySetGenerator);]