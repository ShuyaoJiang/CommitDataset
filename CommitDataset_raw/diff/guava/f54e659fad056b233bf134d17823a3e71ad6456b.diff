[+++ b/guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java, +import com.google.common.testing.GcFinalization;, +, +  public void testFinalizeDeletesFile() throws Exception {, +    byte[] data = newPreFilledByteArray(100);, +    FileBackedOutputStream out = new FileBackedOutputStream(0, true);, +, +    write(out, data, 0, 100, true);, +    final File file = out.getFile();, +    assertEquals(100, file.length());, +    assertTrue(file.exists());, +    out.close();, +, +    // Make sure that finalize deletes the file, +    out = null;, +, +    // times out and throws RuntimeException on failure, +    GcFinalization.awaitDone(new GcFinalization.FinalizationPredicate() {, +      @Override, +      public boolean isDone() {, +        return !file.exists();, +      }, +    });, +  }]