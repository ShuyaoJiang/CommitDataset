[+++ b/build.xml, +  If you build the GWT target, you must:, +  * have GWT_HOME set to a recent GWT SDK directory, or specify this with, +   -Dgwthome=, +  <!-- Only needed for GWT targets. -->, +  <property name="gwthome" value="${env.GWT_HOME}" />, +, +  <target name="gwt.compile", +          description="Compile GWT source.", +          depends="compile">, +    <mkdir dir="build/gwt-classes"/>, +    <javac srcdir="gwt-src", +           debug="on", +           destdir="build/gwt-classes">, +      <compilerarg value="-Xlint:all"/>, +      <classpath>, +        <pathelement location="build/classes" />, +        <pathelement location="lib/jsr305.jar"/>, +        <pathelement location="${gwthome}/gwt.jar"/>, +        <pathelement location="${gwthome}/gwt-dev.jar"/>, +      </classpath>, +    </javac>, +  </target>, +, +  <target name="gwtjar", +          description="Build a jar of GWT source and classfiles of GWT-only classes.", +          depends="jar, gwt.compile">, +    <mkdir dir="build/dist/guava-${release}"/>, +    <jar jarfile="build/dist/guava-${release}/guava-${release}-gwt.jar">, +      <!-- Includes the @GwtCompatible non-emulated source. -->, +      <fileset dir="src">, +        <and>, +          <contains text="@GwtCompatible"/>, +          <not>, +            <contains text="emulated = true"/>, +          </not>, +        </and>, +      </fileset>, +      <fileset dir="gwt-src"/>, +      <fileset dir="build/gwt-classes"/>, +      <fileset dir="gwt-super"/>, +    </jar>, +  </target>, +, +  <target name="gwt.test.compile", +          description="Compile the GWT test sources with javac.", +          depends="gwtjar">, +    <mkdir dir="build/gwt-test-classes"/>, +    <javac srcdir="gwt-test", +           debug="on", +           destdir="build/gwt-test-classes">, +      <compilerarg value="-Xlint:all"/>, +      <classpath>, +        <pathelement location="build/classes" />, +        <pathelement location="build/gwt-classes" />, +        <pathelement location="lib/jsr305.jar"/>, +        <pathelement location="${gwthome}/gwt.jar"/>, +        <pathelement location="${gwthome}/gwt-dev.jar"/>, +      </classpath>, +    </javac>, +  </target>, +, +  <macrodef name="test.gwtc">, +    <attribute name="testmodule" />, +    <sequential>, +      <java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler">, +        <classpath>, +          <!-- The source and classfiles under test.-->, +          <pathelement location="build/dist/guava-${release}/guava-${release}-gwt.jar" />, +          <pathelement location="build/dist/guava-${release}/guava-${release}.jar" />, +, +          <pathelement location="gwt-test" />, +          <pathelement location="build/gwt-test-classes" />, +          <pathelement location="lib/jsr305.jar"/>, +          <pathelement location="${gwthome}/gwt.jar"/>, +          <pathelement location="${gwthome}/gwt-dev.jar"/>, +        </classpath>, +        <!-- add jvmarg -Xss16M or similar if you see a StackOverflowError -->, +        <jvmarg value="-Xmx256M"/>, +        <arg line="-war"/>, +        <arg value="war"/>, +        <arg value="@{testmodule}"/>, +      </java>, +    </sequential>, +  </macrodef>, +, +  <target name="all.gwtc.tests", +          description="Tests by compiling the modules in GWT", +          depends="gwtjar, gwt.test.compile">, +    <test.gwtc testmodule="com.google.common.base.testModule" />, +    <test.gwtc testmodule="com.google.common.primitives.testModule" />, +  </target>, +, +++ b/build.xml, +  If you build the GWT target, you must:, +  * have GWT_HOME set to a recent GWT SDK directory, or specify this with, +   -Dgwthome=, +  <!-- Only needed for GWT targets. -->, +  <property name="gwthome" value="${env.GWT_HOME}" />, +]