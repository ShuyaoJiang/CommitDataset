[+++ b/android/guava-tests/test/com/google/common/io/ByteStreamsTest.java, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +++ b/android/guava-tests/test/com/google/common/io/ByteStreamsTest.java, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +++ b/android/guava/src/com/google/common/io/ByteStreams.java, +    ByteArrayOutputStream out = new ByteArrayOutputStream(Math.max(BUFFER_SIZE, in.available()));, +    copy(in, out);, +    return out.toByteArray();, +    if (expectedSize > Integer.MAX_VALUE) {, +    FastByteArrayOutputStream out = new FastByteArrayOutputStream(BUFFER_SIZE);, +    copy(in, out);, +, +    byte[] result = Arrays.copyOf(bytes, bytes.length + 1 + out.size());, +    result[bytes.length] = (byte) b;, +    out.writeTo(result, bytes.length + 1);, +    return result;, +  }, +, +  /** BAOS that provides limited access to its internal byte array. */, +  private static final class FastByteArrayOutputStream extends ByteArrayOutputStream {, +    FastByteArrayOutputStream(int initialSize) {, +      super(initialSize);, +    }, +, +    /**, +     * Writes the contents of the internal buffer to the given array starting at the given offset., +     * Assumes the array has space to hold count bytes., +     */, +    void writeTo(byte[] b, int off) {, +      System.arraycopy(buf, 0, b, off, count);, +    }, +++ b/android/guava-tests/test/com/google/common/io/ByteStreamsTest.java, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +++ b/android/guava/src/com/google/common/io/ByteStreams.java, +    ByteArrayOutputStream out = new ByteArrayOutputStream(Math.max(BUFFER_SIZE, in.available()));, +    copy(in, out);, +    return out.toByteArray();, +    if (expectedSize > Integer.MAX_VALUE) {, +    FastByteArrayOutputStream out = new FastByteArrayOutputStream(BUFFER_SIZE);, +    copy(in, out);, +, +    byte[] result = Arrays.copyOf(bytes, bytes.length + 1 + out.size());, +    result[bytes.length] = (byte) b;, +    out.writeTo(result, bytes.length + 1);, +    return result;, +  }, +, +  /** BAOS that provides limited access to its internal byte array. */, +  private static final class FastByteArrayOutputStream extends ByteArrayOutputStream {, +    FastByteArrayOutputStream(int initialSize) {, +      super(initialSize);, +    }, +, +    /**, +     * Writes the contents of the internal buffer to the given array starting at the given offset., +     * Assumes the array has space to hold count bytes., +     */, +    void writeTo(byte[] b, int off) {, +      System.arraycopy(buf, 0, b, off, count);, +    }, +++ b/guava-tests/test/com/google/common/io/ByteStreamsTest.java, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +++ b/android/guava-tests/test/com/google/common/io/ByteStreamsTest.java, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +    InputStream in = newTestStream(100);, +    assertEquals(100, b.length);, +++ b/android/guava/src/com/google/common/io/ByteStreams.java]