[+++ b/guava/src/com/google/common/eventbus/EventBus.java, +import com.google.common.util.concurrent.UncheckedExecutionException;, +import java.util.LinkedList;, +import java.util.Queue;, +            public Set<Class<?>> load(Class<?> concreteClass) {, +  private final ThreadLocal<Queue<EventWithHandler>> eventsToDispatch =, +      new ThreadLocal<Queue<EventWithHandler>>() {, +    @Override protected Queue<EventWithHandler> initialValue() {, +      return new LinkedList<EventWithHandler>();, +      Class<?> eventType = entry.getKey();, +        Set<EventHandler> currentHandlers = handlersByType.get(eventType);, +        if (!currentHandlers.containsAll(eventMethodsInListener)) {, +      Queue<EventWithHandler> events = eventsToDispatch.get();, +      EventWithHandler eventWithHandler;, +      while ((eventWithHandler = events.poll()) != null) {, +      return flattenHierarchyCache.getUnchecked(concreteClass);, +    } catch (UncheckedExecutionException e) {]