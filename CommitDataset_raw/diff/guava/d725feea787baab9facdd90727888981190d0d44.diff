[+++ b/guava-tests/test/com/google/common/cache/CacheBuilderTest.java, +import static com.google.common.cache.TestingWeighers.constantWeigher;, +    try {, +      builder.maximumWeight(16);, +      fail();, +    } catch (IllegalStateException expected) {}, +  }, +, +  public void testMaximumWeight_negative() {, +    CacheBuilder<Object, Object> builder = new CacheBuilder<Object, Object>();, +    try {, +      builder.maximumWeight(-1);, +      fail();, +    } catch (IllegalArgumentException expected) {}, +  }, +, +  public void testMaximumWeight_setTwice() {, +    CacheBuilder<Object, Object> builder = new CacheBuilder<Object, Object>().maximumWeight(16);, +    try {, +      // even to the same value is not allowed, +      builder.maximumWeight(16);, +      fail();, +    } catch (IllegalStateException expected) {}, +    try {, +      builder.maximumSize(16);, +      fail();, +    } catch (IllegalStateException expected) {}, +  }, +, +  public void testMaximumWeight_withoutWeigher() {, +    CacheBuilder<Object, Object> builder = new CacheBuilder<Object, Object>(), +        .maximumWeight(1);, +    try {, +      builder.build(identityLoader());, +      fail();, +    } catch (IllegalStateException expected) {}, +  }, +, +  public void testWeigher_withoutMaximumWeight() {, +    CacheBuilder<Object, Object> builder = new CacheBuilder<Object, Object>(), +        .weigher(constantWeigher(42));, +    try {, +      builder.build(identityLoader());, +      fail();, +    } catch (IllegalStateException expected) {}, +  }, +, +  public void testWeigher_withMaximumSize() {, +    try {, +      CacheBuilder<Object, Object> builder = new CacheBuilder<Object, Object>(), +          .weigher(constantWeigher(42)), +          .maximumSize(1);, +      fail();, +    } catch (IllegalStateException expected) {}, +    try {, +      CacheBuilder<Object, Object> builder = new CacheBuilder<Object, Object>(), +          .maximumSize(1), +          .weigher(constantWeigher(42));, +      fail();, +    } catch (IllegalStateException expected) {}, +    try {, +      builder1.softValues();, +      fail();, +    } catch (IllegalStateException expected) {}, +      builder2.weakValues();, +++ b/guava-tests/test/com/google/common/cache/CacheBuilderTest.java, +import static com.google.common.cache.TestingWeighers.constantWeigher;, +    try {, +      builder.maximumWeight(16);, +      fail();, +    } catch (IllegalStateException expected) {}, +  }, +, +  public void testMaximumWeight_negative() {, +    CacheBuilder<Object, Object> builder = new CacheBuilder<Object, Object>();, +    try {, +      builder.maximumWeight(-1);, +      fail();, +    } catch (IllegalArgumentException expected) {}, +  }, +, +  public void testMaximumWeight_setTwice() {, +    CacheBuilder<Object, Object> builder = new CacheBuilder<Object, Object>().maximumWeight(16);, +    try {, +      // even to the same value is not allowed, +      builder.maximumWeight(16);, +      fail();, +    } catch (IllegalStateException expected) {}, +    try {, +      builder.maximumSize(16);, +      fail();, +    } catch (IllegalStateException expected) {}, +  }, +, +  public void testMaximumWeight_withoutWeigher() {, +    CacheBuilder<Object, Object> builder = new CacheBuilder<Object, Object>(), +        .maximumWeight(1);, +    try {, +      builder.build(identityLoader());, +      fail();]