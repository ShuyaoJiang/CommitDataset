[+++ b/guava/src/com/google/common/base/Utf8.java, +    int utf16Length = sequence.length();, +    long utf8Length = utf16Length;  // Optimize for runs of ASCII, +    for (int i = 0; i < utf16Length; i++) {, +      char c = sequence.charAt(i);, +        // already counted, +        utf8Length += 1;, +        utf8Length += 2;, +        // jdk7+: if (Character.isSurrogate(c)) {, +        if (Character.MIN_SURROGATE <= c && c <= Character.MAX_SURROGATE) {, +          int cp = Character.codePointAt(sequence, i);, +            throw new IllegalArgumentException("Unpaired surrogate at index " + i);, +          i++;, +        }]