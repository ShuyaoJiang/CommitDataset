[+++ b/spring-boot-project/spring-boot-test/src/main/java/org/springframework/boot/test/mock/mockito/MockitoPostProcessor.java, +	private static final BeanNameGenerator beanNameGenerator = new DefaultBeanNameGenerator();, +, +		Set<String> existingBeans = getExistingBeans(beanFactory,, +			return MockitoPostProcessor.beanNameGenerator.generateBeanName(beanDefinition,, +					registry);, +	private void copyBeanDefinitionDetails(BeanDefinition from, RootBeanDefinition to) {, +		to.setPrimary(from.isPrimary());, +	}, +, +		Set<String> existingBeans = getExistingBeans(beanFactory,, +	private Set<String> getExistingBeans(ConfigurableListableBeanFactory beanFactory,, +		String typeName = type.resolve(Object.class).getName();, +			if (typeName.equals(beanDefinition.getAttribute(FACTORY_BEAN_OBJECT_TYPE))) {, +		String beanName = MockitoPostProcessor.beanNameGenerator, +				.generateBeanName(beanDefinition, registry);, +	protected final Object createSpyIfNecessary(Object bean, String beanName), +			return this.mockitoPostProcessor.createSpyIfNecessary(bean, beanName);]