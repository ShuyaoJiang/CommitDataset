[+++ b/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/metrics/writer/CodahaleMetricWriter.java, +import java.util.concurrent.ConcurrentHashMap;, +import java.util.concurrent.ConcurrentMap;, +	private final ConcurrentMap<String, Object> gaugeLocks = new ConcurrentHashMap<String, Object>();, +, +			Object lock = null;, +			if (this.gaugeLocks.containsKey(name)) {, +				lock = this.gaugeLocks.get(name);, +			}, +			else {, +				this.gaugeLocks.putIfAbsent(name, new Object());, +				lock = this.gaugeLocks.get(name);, +			}, +			// Ensure we synchronize to avoid another thread pre-empting this thread after, +			// remove causing an error in CodaHale metrics, +			// NOTE: CodaHale provides no way to do this atomically, +			synchronized (lock) {]