[+++ b/spring-boot/src/main/java/org/springframework/boot/builder/ParentContextCloserApplicationListener.java, + * Listener that closes the application context if its parent is closed. It listens for, + * refresh events and grabs the current context from there, and then listens for closed, + * events and propagates it down the hierarchy., + * @author Eric Bottard, +public class ParentContextCloserApplicationListener implements, +		ApplicationListener<ParentContextAvailableEvent>, Ordered {, +	public void onApplicationEvent(ParentContextAvailableEvent event) {, +			ConfigurableApplicationContext parent = (ConfigurableApplicationContext) child, +					.getParent();, +	 * Subclasses may override to create their own subclass of ContextCloserListener. This, +	 * still enforces the use of a weak reference., +	protected ContextCloserListener createContextCloserListener(, +			ConfigurableApplicationContext child) {, +	protected static class ContextCloserListener implements, +			ApplicationListener<ContextClosedEvent> {, +		private WeakReference<ConfigurableApplicationContext> childContext;, +		public ContextCloserListener(ConfigurableApplicationContext childContext) {, +			this.childContext = new WeakReference<ConfigurableApplicationContext>(, +					childContext);, +			ConfigurableApplicationContext context = this.childContext.get();, +			if ((context != null), +					&& (event.getApplicationContext() == context.getParent()), +					&& context.isActive()) {]