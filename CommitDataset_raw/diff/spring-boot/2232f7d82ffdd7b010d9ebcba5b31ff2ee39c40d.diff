[+++ b/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/elasticsearch/ElasticsearchJestHealthIndicator.java, + * @author Brian Clozel, +		if (healthResult.getResponseCode() != 200 || !healthResult.isSucceeded()) {, +			builder.down();, +		}, +		else {, +			if (status.getAsString(), +					.equals(io.searchbox.cluster.Health.Status.RED.getKey())) {, +	}, +++ b/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/elasticsearch/ElasticsearchJestHealthIndicator.java, + * @author Brian Clozel, +		if (healthResult.getResponseCode() != 200 || !healthResult.isSucceeded()) {, +			builder.down();, +		}, +		else {, +			if (status.getAsString(), +					.equals(io.searchbox.cluster.Health.Status.RED.getKey())) {, +	}, +++ b/spring-boot-project/spring-boot-actuator/src/test/java/org/springframework/boot/actuate/elasticsearch/ElasticsearchJestHealthIndicatorTests.java, + * Copyright 2012-2018 the original author or authors., + * @author Brian Clozel, +				.willReturn(createJestResult(200, true, "green"));, +	public void elasticsearchIsDownWhenQueryDidNotSucceed() throws IOException {, +		given(this.jestClient.execute(any(Action.class))), +				.willReturn(createJestResult(200, false, ""));, +		Health health = this.healthIndicator.health();, +		assertThat(health.getStatus()).isEqualTo(Status.DOWN);, +	}, +, +	@SuppressWarnings("unchecked"), +	@Test, +	public void elasticsearchIsDownByResponseCode() throws IOException {, +		given(this.jestClient.execute(any(Action.class))), +				.willReturn(createJestResult(500, false, ""));, +		Health health = this.healthIndicator.health();, +		assertThat(health.getStatus()).isEqualTo(Status.DOWN);, +	}, +, +	@SuppressWarnings("unchecked"), +	@Test, +				.willReturn(createJestResult(200, true, "red"));, +	private static JestResult createJestResult(int responseCode, boolean succeeded,, +			String status) {, +		SearchResult searchResult = new SearchResult(new Gson());, +		String json;, +		if (responseCode == 200) {, +			json = String.format("{\"cluster_name\":\"elasticsearch\",", +		}, +		else {, +			json = "{\n" + "  \"error\": \"Server Error\",\n" + "  \"status\": ", +					+ responseCode + "\n" + "}";, +		}]