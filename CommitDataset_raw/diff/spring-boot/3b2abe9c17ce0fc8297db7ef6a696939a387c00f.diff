[+++ b/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.java, +import org.springframework.beans.factory.BeanClassLoaderAware;, +import org.springframework.boot.autoconfigure.jdbc.EmbeddedDatabaseConnection;, +public class HibernateJpaAutoConfiguration extends JpaBaseConfiguration implements, +		BeanClassLoaderAware {, +	private ClassLoader classLoader;, +, +	@Override, +	public void setBeanClassLoader(ClassLoader classLoader) {, +		this.classLoader = classLoader;, +	}, +, +		String ddlAuto = this.environment.getProperty("ddl-auto", getDefaultDdlAuto());, +, +	private String getDefaultDdlAuto() {, +		EmbeddedDatabaseConnection embeddedDatabaseConnection = EmbeddedDatabaseConnection, +				.get(this.classLoader);, +		if (embeddedDatabaseConnection == EmbeddedDatabaseConnection.NONE) {, +			return "none";, +		}, +		return "create-drop";, +	}, +++ b/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.java, +import org.springframework.beans.factory.BeanClassLoaderAware;, +import org.springframework.boot.autoconfigure.jdbc.EmbeddedDatabaseConnection;, +public class HibernateJpaAutoConfiguration extends JpaBaseConfiguration implements, +		BeanClassLoaderAware {, +	private ClassLoader classLoader;, +, +	@Override, +	public void setBeanClassLoader(ClassLoader classLoader) {, +		this.classLoader = classLoader;, +	}, +, +		String ddlAuto = this.environment.getProperty("ddl-auto", getDefaultDdlAuto());, +, +	private String getDefaultDdlAuto() {, +		EmbeddedDatabaseConnection embeddedDatabaseConnection = EmbeddedDatabaseConnection, +				.get(this.classLoader);, +		if (embeddedDatabaseConnection == EmbeddedDatabaseConnection.NONE) {, +			return "none";, +		}, +		return "create-drop";, +	}, +++ b/spring-boot-samples/spring-boot-sample-data-jpa/src/main/java/org/springframework/boot/sample/data/jpa/service/HotelServiceImpl.java, +++ b/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.java, +import org.springframework.beans.factory.BeanClassLoaderAware;, +import org.springframework.boot.autoconfigure.jdbc.EmbeddedDatabaseConnection;, +public class HibernateJpaAutoConfiguration extends JpaBaseConfiguration implements, +		BeanClassLoaderAware {, +	private ClassLoader classLoader;, +, +	@Override, +	public void setBeanClassLoader(ClassLoader classLoader) {, +		this.classLoader = classLoader;, +	}, +, +		String ddlAuto = this.environment.getProperty("ddl-auto", getDefaultDdlAuto());, +, +	private String getDefaultDdlAuto() {, +		EmbeddedDatabaseConnection embeddedDatabaseConnection = EmbeddedDatabaseConnection, +				.get(this.classLoader);, +		if (embeddedDatabaseConnection == EmbeddedDatabaseConnection.NONE) {, +			return "none";, +		}, +		return "create-drop";, +	}, +++ b/spring-boot-samples/spring-boot-sample-data-jpa/src/main/java/org/springframework/boot/sample/data/jpa/service/HotelServiceImpl.java, +++ /dev/null]