[+++ b/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/metrics/opentsdb/OpenTsdbMetricWriter.java, +import java.util.Collections;, + * @author Thomas Badie, +	private final List<OpenTsdbData> buffer = new ArrayList<OpenTsdbData>(this.bufferSize);, +		synchronized (this.buffer) {, +	}, +	@SuppressWarnings("rawtypes"), +		List<OpenTsdbData> snapshot = getBufferSnapshot();, +		if (snapshot.isEmpty()) {, +		ResponseEntity<Map> response = this.restTemplate.postForEntity(this.url,, +				new HttpEntity<List<OpenTsdbData>>(snapshot, headers), Map.class);, +			logger.warn("Cannot write metrics (discarded " + snapshot.size(), +					+ " values): " + response.getBody());, +		}, +	}, +, +	private List<OpenTsdbData> getBufferSnapshot() {, +		synchronized (this.buffer) {, +			if (this.buffer.isEmpty()) {, +				return Collections.emptyList();, +			}, +			List<OpenTsdbData> snapshot = new ArrayList<OpenTsdbData>(this.buffer);, +			this.buffer.clear();, +			return snapshot;, +++ b/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/metrics/opentsdb/OpenTsdbMetricWriter.java, +import java.util.Collections;, + * @author Thomas Badie, +	private final List<OpenTsdbData> buffer = new ArrayList<OpenTsdbData>(this.bufferSize);, +		synchronized (this.buffer) {, +	}, +	@SuppressWarnings("rawtypes"), +		List<OpenTsdbData> snapshot = getBufferSnapshot();, +		if (snapshot.isEmpty()) {, +		ResponseEntity<Map> response = this.restTemplate.postForEntity(this.url,, +				new HttpEntity<List<OpenTsdbData>>(snapshot, headers), Map.class);, +			logger.warn("Cannot write metrics (discarded " + snapshot.size(), +					+ " values): " + response.getBody());, +		}, +	}, +, +	private List<OpenTsdbData> getBufferSnapshot() {, +		synchronized (this.buffer) {, +			if (this.buffer.isEmpty()) {, +				return Collections.emptyList();, +			}, +			List<OpenTsdbData> snapshot = new ArrayList<OpenTsdbData>(this.buffer);, +			this.buffer.clear();, +			return snapshot;, +++ b/spring-boot-actuator/src/test/java/org/springframework/boot/actuate/metrics/opentsdb/OpenTsdbMetricWriterTests.java, +]