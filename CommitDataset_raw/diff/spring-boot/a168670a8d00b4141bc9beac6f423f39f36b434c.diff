[+++ b/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/autoconfigure/MetricsFilter.java, +import java.util.Collections;, +import java.util.LinkedHashSet;, +import java.util.Set;, +import java.util.regex.Matcher;, +import java.util.regex.Pattern;, +	private static final Set<PatternReplacer> STATUS_REPLACERS;, +	static {, +		Set<PatternReplacer> replacements = new LinkedHashSet<PatternReplacer>();, +		replacements.add(new PatternReplacer("[{}]", 0, "-"));, +		replacements.add(new PatternReplacer("**", Pattern.LITERAL, "-star-star-"));, +		replacements.add(new PatternReplacer("*", Pattern.LITERAL, "-star-"));, +		replacements.add(new PatternReplacer("/-", Pattern.LITERAL, "/"));, +		replacements.add(new PatternReplacer("-/", Pattern.LITERAL, "/"));, +		STATUS_REPLACERS = Collections.unmodifiableSet(replacements);, +	}, +, +	private static final Set<PatternReplacer> KEY_REPLACERS;, +	static {, +		Set<PatternReplacer> replacements = new LinkedHashSet<PatternReplacer>();, +		replacements.add(new PatternReplacer("/", Pattern.LITERAL, "."));, +		replacements.add(new PatternReplacer("..", Pattern.LITERAL, "."));, +		KEY_REPLACERS = Collections.unmodifiableSet(replacements);, +	}, +, +		String result = value;, +		for (PatternReplacer replacer : STATUS_REPLACERS) {, +			result = replacer.apply(result);, +		}, +		String key = string;, +		for (PatternReplacer replacer : KEY_REPLACERS) {, +			key = replacer.apply(key);, +		if (key.endsWith(".")) {, +			key = key + "root";, +		if (key.startsWith("_")) {, +			key = key.substring(1);, +		}, +		return key;, +	private static class PatternReplacer {, +, +		private final Pattern pattern;, +, +		private final String replacement;, +, +		PatternReplacer(String regex, int flags, String replacement) {, +			this.pattern = Pattern.compile(regex, flags);, +			this.replacement = replacement;, +		}, +, +		public String apply(String input) {, +			return this.pattern.matcher(input).replaceAll(, +					Matcher.quoteReplacement(this.replacement));, +		}, +, +	}, +]