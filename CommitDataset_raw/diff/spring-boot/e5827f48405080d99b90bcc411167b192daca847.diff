[+++ b/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/autoconfigure/EndpointWebMvcAutoConfiguration.java, +import java.lang.reflect.Modifier;, +, +import org.springframework.beans.FatalBeanException;, +						new RootBeanDefinition(, +								determineEmbeddedServletContainerFactoryClass()));, +	private Class<?> determineEmbeddedServletContainerFactoryClass(), +			throws NoSuchBeanDefinitionException {, +		Class<?> servletContainerFactoryClass = this.applicationContext, +				.getBean(EmbeddedServletContainerFactory.class).getClass();, +		if (cannotBeInstantiated(servletContainerFactoryClass)) {, +			throw new FatalBeanException("EmbeddedServletContainerFactory implementation ", +					+ servletContainerFactoryClass.getName() + " cannot be instantiated. ", +					+ "To allow a separate management port to be used, a top-level class ", +					+ "or static inner class should be used instead");, +		}, +		return servletContainerFactoryClass;, +	}, +, +	private boolean cannotBeInstantiated(Class<?> clazz) {, +		return clazz.isLocalClass(), +				|| (clazz.isMemberClass() && !Modifier.isStatic(clazz.getModifiers())), +				|| clazz.isAnonymousClass();, +	}, +]