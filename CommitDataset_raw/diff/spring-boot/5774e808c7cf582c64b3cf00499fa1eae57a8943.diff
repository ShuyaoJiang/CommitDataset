[+++ b/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/hornetq/HornetQConnectionFactoryConfiguration.java, +import org.springframework.beans.factory.ListableBeanFactory;, +	public ConnectionFactory jmsConnectionFactory(ListableBeanFactory beanFactory,, +			HornetQProperties properties) {, +		return new HornetQConnectionFactoryFactory(beanFactory, properties), +++ b/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/hornetq/HornetQConnectionFactoryConfiguration.java, +import org.springframework.beans.factory.ListableBeanFactory;, +	public ConnectionFactory jmsConnectionFactory(ListableBeanFactory beanFactory,, +			HornetQProperties properties) {, +		return new HornetQConnectionFactoryFactory(beanFactory, properties), +++ b/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/hornetq/HornetQConnectionFactoryFactory.java, +import org.springframework.beans.factory.ListableBeanFactory;, +	private final ListableBeanFactory beanFactory;, +, +	public HornetQConnectionFactoryFactory(ListableBeanFactory beanFactory,, +			HornetQProperties properties) {, +		Assert.notNull(beanFactory, "BeanFactory must not be null");, +		this.beanFactory = beanFactory;, +			startEmbededJms();, +	private void startEmbededJms() {, +		if (ClassUtils.isPresent(EMBEDDED_JMS_CLASS, null)) {, +			try {, +				this.beanFactory.getBeansOfType(Class.forName(EMBEDDED_JMS_CLASS));, +			}, +			catch (Exception ex) {, +				// Ignore, +			}, +		}, +	}, +, +++ b/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/hornetq/HornetQConnectionFactoryConfiguration.java, +import org.springframework.beans.factory.ListableBeanFactory;, +	public ConnectionFactory jmsConnectionFactory(ListableBeanFactory beanFactory,, +			HornetQProperties properties) {, +		return new HornetQConnectionFactoryFactory(beanFactory, properties), +++ b/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/hornetq/HornetQConnectionFactoryFactory.java, +import org.springframework.beans.factory.ListableBeanFactory;, +	private final ListableBeanFactory beanFactory;, +, +	public HornetQConnectionFactoryFactory(ListableBeanFactory beanFactory,, +			HornetQProperties properties) {, +		Assert.notNull(beanFactory, "BeanFactory must not be null");, +		this.beanFactory = beanFactory;, +			startEmbededJms();, +	private void startEmbededJms() {, +		if (ClassUtils.isPresent(EMBEDDED_JMS_CLASS, null)) {, +			try {, +				this.beanFactory.getBeansOfType(Class.forName(EMBEDDED_JMS_CLASS));, +			}, +			catch (Exception ex) {, +				// Ignore, +			}, +		}, +	}, +, +++ b/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/hornetq/HornetQXAConnectionFactoryConfiguration.java, +import org.springframework.beans.factory.ListableBeanFactory;, +	public ConnectionFactory jmsConnectionFactory(ListableBeanFactory beanFactory,, +			HornetQProperties properties, XAConnectionFactoryWrapper wrapper), +			throws Exception {, +				beanFactory, properties), +				.createConnectionFactory(HornetQXAConnectionFactory.class));]