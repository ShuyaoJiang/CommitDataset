[+++ b/transport/src/main/java/io/netty/channel/socket/aio/AioSocketChannel.java, +import io.netty.channel.ChannelPromise;, +import io.netty.channel.socket.ChannelInputShutdownEvent;, +    private boolean inDoBeginRead;, +    private boolean readAgain;, +        if (inDoBeginRead) {, +            readAgain = true;, +            return;, +        }, +, +        inDoBeginRead = true;, +        try {, +            for (;;) {, +, +                if (readInProgress) {, +                    // JDK decided to read data (or notify handler) later., +                    break;, +                }, +, +                if (readAgain) {, +                    // User requested the read operation., +                    readAgain = false;, +                    continue;, +                }, +, +                break;, +            }, +        } finally {, +            inDoBeginRead = false;, +        }, +            // Update the write counter and notify flush futures only when the handler is called outside of, +            // unsafe().flushNow() because flushNow() will do that for us.]