[+++ b/common/src/main/java/io/netty/util/NetUtil.java, +                        if ((numberOfColons != 6 && !doubleColon) || numberOfColons > 7 ||, +                    if (i == startOffset && (endOffset <= i || ipAddress.charAt(i + 1) != ':')) {, +                    if (numberOfColons > 8) {, +            if (word.length() == 0) {, +                if (ipAddress.charAt(endOffset - 1) == ':' &&, +                    ipAddress.charAt(endOffset - 2) != ':') {, +                    return false;, +                }, +            } else if (numberOfColons == 8 && ipAddress.charAt(startOffset) != ':') {, +                    currentIndex + 1 >= bytes.length ||, +                    begin < 0 && ip.charAt(tmp - 1) != ':' ||, +                    compressBegin > 2 && ip.charAt(0) == ':') {, +++ b/common/src/main/java/io/netty/util/NetUtil.java, +                        if ((numberOfColons != 6 && !doubleColon) || numberOfColons > 7 ||, +                    if (i == startOffset && (endOffset <= i || ipAddress.charAt(i + 1) != ':')) {, +                    if (numberOfColons > 8) {, +            if (word.length() == 0) {, +                if (ipAddress.charAt(endOffset - 1) == ':' &&, +                    ipAddress.charAt(endOffset - 2) != ':') {, +                    return false;, +                }, +            } else if (numberOfColons == 8 && ipAddress.charAt(startOffset) != ':') {, +                    currentIndex + 1 >= bytes.length ||, +                    begin < 0 && ip.charAt(tmp - 1) != ':' ||, +                    compressBegin > 2 && ip.charAt(0) == ':') {, +++ b/common/src/test/java/io/netty/util/NetUtilTest.java, +import static io.netty.util.NetUtil.*;, +            "0:0:0:0::10.0.0.1",                         "00000000000000000000ffff0a000001",, +            "0:0:0:0:0:ffff:10.0.0.1%",                  "00000000000000000000ffff0a000001",, +            "0:0:0:0:0:ffff:10.0.0.1%1",                 "00000000000000000000ffff0a000001",, +            "[0:0:0:0:0:ffff:10.0.0.1%1]",               "00000000000000000000ffff0a000001",, +            "[0:0:0:0:0::10.0.0.1%1]",                   "00000000000000000000ffff0a000001",, +            "[::0:0:0:0:ffff:10.0.0.1%1]",               "00000000000000000000ffff0a000001",, +            "::0:0:0:0:ffff:10.0.0.1%1",                 "00000000000000000000ffff0a000001",, +            "::1%%",                                     "00000000000000000000000000000001",, +            // Tests with leading or trailing compression, +            "0:0:0:0:0:0:0::",                           "00000000000000000000000000000000",, +            "0:0:0:0:0:0::",                             "00000000000000000000000000000000",, +            "0:0:0:0:0::",                               "00000000000000000000000000000000",, +            "0:0:0:0::",                                 "00000000000000000000000000000000",, +            "0:0:0::",                                   "00000000000000000000000000000000",, +            "0:0::",                                     "00000000000000000000000000000000",, +            "0::",                                       "00000000000000000000000000000000",, +            "::",                                        "00000000000000000000000000000000",, +            "::0",                                       "00000000000000000000000000000000",, +            "::0:0",                                     "00000000000000000000000000000000",, +            "::0:0:0",                                   "00000000000000000000000000000000",, +            "::0:0:0:0",                                 "00000000000000000000000000000000",, +            "::0:0:0:0:0",                               "00000000000000000000000000000000",, +            "::0:0:0:0:0:0",                             "00000000000000000000000000000000",, +            "::0:0:0:0:0:0:0",                           "00000000000000000000000000000000");, +            // Compression with : separators trailing, +            "0:1:2:3:4:5::7:",          null,, +            "0:1:2:3:4::7:",            null,, +            "0:1:2:3::7:",              null,, +            "0:1:2::7:",                null,, +            "0:1::7:",                  null,, +            "0::7:",                    null,, +            // Compression at start with : separators trailing, +            "::0:1:2:3:4:5:7:",         null,, +            "::0:1:2:3:4:7:",           null,, +            "::0:1:2:3:7:",             null,, +            "::0:1:2:7:",               null,, +            "::0:1:7:",                 null,, +            "::7:",                     null,, +            // The : separators leading and trailing, +            ":1:2:3:4:5:6:7:",          null,, +            ":1:2:3:4:5:6:",            null,, +            ":1:2:3:4:5:",              null,, +            ":1:2:3:4:",                null,, +            ":1:2:3:",                  null,, +            ":1:2:",                    null,, +            ":1:",                      null,, +            // Compression with : separators leading, +            ":1::2:3:4:5:6:7",          null,, +            ":1::3:4:5:6:7",            null,, +            ":1::4:5:6:7",              null,, +            ":1::5:6:7",                null,, +            ":1::6:7",                  null,, +            ":1::7",                    null,, +            ":1:2:3:4:5:6::7",          null,, +            ":1:3:4:5:6::7",            null,, +            ":1:4:5:6::7",              null,, +            ":1:5:6::7",                null,, +            ":1:6::7",                  null,, +            ":1::",                    null,, +            // Compression trailing with : separators leading, +            ":1:2:3:4:5:6:7::",         null,, +            ":1:3:4:5:6:7::",           null,, +            ":1:4:5:6:7::",             null,, +            ":1:5:6:7::",               null,, +            ":1:6:7::",                 null,, +            ":1:7::",                   null,, +            // Double compression, +            "1::2:3:4:5:6::",           null,, +            "::1:2:3:4:5::6",           null,, +            "::1:2:3:4:5:6::",          null,, +            "::1:2:3:4:5::",            null,, +            "::1:2:3:4::",              null,]