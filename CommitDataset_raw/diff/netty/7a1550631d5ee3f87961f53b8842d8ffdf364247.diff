[+++ b/transport/src/main/java/io/netty/channel/AbstractChannel.java, +import io.netty.buffer.ByteBufUtil;, +                    // Make sure the promise has not been cancelled., +                    if (promise.isCancelled()) {, +                        // If cancelled, release all unwritten messages and recycle., +                        for (int i = messageIndex; i < messageCount; i ++) {, +                            ByteBufUtil.release(messages.get(i));, +                        }, +                        messages.recycle();]