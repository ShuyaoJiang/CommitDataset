[+++ b/src/main/java/org/jboss/netty/example/http/file/HttpStaticFileServerHandler.java, +import org.jboss.netty.channel.ChannelFutureProgressListener;, +import org.jboss.netty.channel.FileRegion;, +import org.jboss.netty.handler.ssl.SslHandler;, +import org.jboss.netty.handler.stream.ChunkedFile;, +        final String path = sanitizeUri(request.getUri());, +        ChannelFuture writeFuture;, +        if (ch.getPipeline().get(SslHandler.class) != null) {, +            // Cannot use zero-copy with HTTPS., +            writeFuture = ch.write(new ChunkedFile(raf, 0, fileLength, 8192));, +        } else {, +            // No encryption - use zero-copy., +            final FileRegion region =, +                new DefaultFileRegion(raf.getChannel(), 0, fileLength);, +            writeFuture = ch.write(region);, +            writeFuture.addListener(new ChannelFutureProgressListener() {, +                public void operationComplete(ChannelFuture future) {, +                    region.releaseExternalResources();, +                }, +, +                public void operationProgressed(, +                        ChannelFuture future, long amount, long current, long total) {, +                    System.out.printf("%s: %d / %d (+%d)%n", path, current, total, amount);, +                }, +            });, +        }]