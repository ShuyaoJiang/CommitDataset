[+++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioDatagramChannel.java, +    boolean inWriteNowLoop;, +    boolean writeSuspended;, +            worker.writeFromTaskLoop(NioDatagramChannel.this);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioDatagramChannel.java, +    boolean inWriteNowLoop;, +    boolean writeSuspended;, +            worker.writeFromTaskLoop(NioDatagramChannel.this);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioDatagramPipelineSink.java, +            channel.worker.writeFromUserCode(channel);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioDatagramChannel.java, +    boolean inWriteNowLoop;, +    boolean writeSuspended;, +            worker.writeFromTaskLoop(NioDatagramChannel.this);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioDatagramPipelineSink.java, +            channel.worker.writeFromUserCode(channel);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioDatagramWorker.java, +                    writeFromSelectorLoop(k);, +    void writeFromUserCode(final NioDatagramChannel channel) {, +        if (scheduleWriteIfNecessary(channel)) {, +            return;, +        }, +, +        // From here, we are sure Thread.currentThread() == workerThread., +, +        if (channel.writeSuspended) {, +            return;, +, +        write0(channel);, +    }, +, +    void writeFromTaskLoop(final NioDatagramChannel ch) {, +        if (!ch.writeSuspended) {, +            write0(ch);, +        }, +    }, +, +    void writeFromSelectorLoop(final SelectionKey k) {, +        NioDatagramChannel ch = (NioDatagramChannel) k.attachment();, +        ch.writeSuspended = false;, +        write0(ch);, +    private void write0(final NioDatagramChannel channel) {, +        final Queue<MessageEvent> writeBuffer = channel.writeBufferQueue;, +        final int writeSpinCount = channel.getConfig().getWriteSpinCount();, +                        channel.writeSuspended = false;, +                        channel.writeSuspended = true;, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioDatagramChannel.java, +    boolean inWriteNowLoop;, +    boolean writeSuspended;, +            worker.writeFromTaskLoop(NioDatagramChannel.this);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioDatagramPipelineSink.java, +            channel.worker.writeFromUserCode(channel);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioDatagramWorker.java, +                    writeFromSelectorLoop(k);, +    void writeFromUserCode(final NioDatagramChannel channel) {, +        if (scheduleWriteIfNecessary(channel)) {, +            return;, +        }, +, +        // From here, we are sure Thread.currentThread() == workerThread., +, +        if (channel.writeSuspended) {, +            return;, +, +        write0(channel);, +    }, +, +    void writeFromTaskLoop(final NioDatagramChannel ch) {, +        if (!ch.writeSuspended) {, +            write0(ch);, +        }, +    }, +, +    void writeFromSelectorLoop(final SelectionKey k) {, +        NioDatagramChannel ch = (NioDatagramChannel) k.attachment();, +        ch.writeSuspended = false;, +        write0(ch);, +    private void write0(final NioDatagramChannel channel) {, +        final Queue<MessageEvent> writeBuffer = channel.writeBufferQueue;, +        final int writeSpinCount = channel.getConfig().getWriteSpinCount();, +                        channel.writeSuspended = false;, +                        channel.writeSuspended = true;, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioWorker.java]