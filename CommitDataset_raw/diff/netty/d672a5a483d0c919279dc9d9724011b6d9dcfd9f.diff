[+++ b/codec-http/src/main/java/io/netty/handler/codec/http/QueryStringEncoder.java, +    private final String charsetName;, +    private final StringBuilder uriBuilder;, +    private boolean hasParams;, +        uriBuilder = new StringBuilder(uri);, +        charsetName = charset.name();, +        if (hasParams) {, +            uriBuilder.append('&');, +        } else {, +            uriBuilder.append('?');, +            hasParams = true;, +        }, +        appendComponent(name, charsetName, uriBuilder);, +        if (value != null) {, +            uriBuilder.append('=');, +            appendComponent(value, charsetName, uriBuilder);, +        }, +        return uriBuilder.toString();, +    private static void appendComponent(String s, String charset, StringBuilder sb) {, +            s = URLEncoder.encode(s, charset);, +            throw new UnsupportedCharsetException(charset);, +        // replace all '+' with "%20", +        int idx = s.indexOf('+');, +        if (idx == -1) {, +            sb.append(s);, +            return;, +        sb.append(s, 0, idx).append("%20");, +        int size = s.length();, +        idx++;, +        for (; idx < size; idx++) {, +            char c = s.charAt(idx);, +            if (c != '+') {, +                sb.append(c);, +            } else {, +                sb.append("%20");, +            }]