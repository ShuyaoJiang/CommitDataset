[+++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpMessageEncoder.java, +import io.netty.handler.codec.http.HttpHeaders.Names;, +import io.netty.handler.codec.http.HttpHeaders.Values;, +            boolean chunked;, +            if (m.isChunked()) {, +                // check if the Transfer-Encoding is set to chunked already., +                // if not add the header to the message, +                if (!HttpCodecUtil.isTransferEncodingChunked(m)) {, +                    m.addHeader(Names.TRANSFER_ENCODING, Values.CHUNKED);, +                }, +                chunked = this.chunked = true;, +            } else {, +                chunked = this.chunked = HttpCodecUtil.isTransferEncodingChunked(m);, +            }]