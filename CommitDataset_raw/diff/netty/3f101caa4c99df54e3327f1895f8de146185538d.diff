[+++ b/transport-native-epoll/src/main/java/io/netty/channel/epoll/Native.java, +import io.netty.channel.unix.Socket;, +        Socket.initialize();, +++ b/transport-native-epoll/src/main/java/io/netty/channel/epoll/Native.java, +import io.netty.channel.unix.Socket;, +        Socket.initialize();, +++ b/transport-native-kqueue/src/main/java/io/netty/channel/kqueue/Native.java, +import io.netty.channel.unix.Socket;, +        Socket.initialize();, +++ b/transport-native-epoll/src/main/java/io/netty/channel/epoll/Native.java, +import io.netty.channel.unix.Socket;, +        Socket.initialize();, +++ b/transport-native-kqueue/src/main/java/io/netty/channel/kqueue/Native.java, +import io.netty.channel.unix.Socket;, +        Socket.initialize();, +++ b/transport-native-unix-common/src/main/c/netty_unix_socket.c, +static int socketType = AF_INET;, +static void netty_unix_socket_initialize(JNIEnv* env, jclass clazz, jboolean ipv4Preferred) {, +        socketType = AF_INET;, +    } else {, +            socketType = errno == EAFNOSUPPORT ? AF_INET : AF_INET6;, +            socketType = res == 0 ? AF_INET6 : AF_INET;, +        }, +, +, +  { "getSoError", "(I)I", (void *) netty_unix_socket_getSoError },, +  { "initialize", "(Z)V", (void *) netty_unix_socket_initialize }, +++ b/transport-native-epoll/src/main/java/io/netty/channel/epoll/Native.java, +import io.netty.channel.unix.Socket;, +        Socket.initialize();, +++ b/transport-native-kqueue/src/main/java/io/netty/channel/kqueue/Native.java, +import io.netty.channel.unix.Socket;, +        Socket.initialize();, +++ b/transport-native-unix-common/src/main/c/netty_unix_socket.c, +static int socketType = AF_INET;, +static void netty_unix_socket_initialize(JNIEnv* env, jclass clazz, jboolean ipv4Preferred) {, +        socketType = AF_INET;, +    } else {, +            socketType = errno == EAFNOSUPPORT ? AF_INET : AF_INET6;, +            socketType = res == 0 ? AF_INET6 : AF_INET;, +        }, +, +, +  { "getSoError", "(I)I", (void *) netty_unix_socket_getSoError },, +  { "initialize", "(Z)V", (void *) netty_unix_socket_initialize }, +++ b/transport-native-unix-common/src/main/java/io/netty/channel/unix/Socket.java, +import io.netty.util.NetUtil;, +import java.util.concurrent.atomic.AtomicBoolean;, +    private static final AtomicBoolean INITIALIZED = new AtomicBoolean();, +, +    public static void initialize() {, +        if (INITIALIZED.compareAndSet(false, true)) {, +            initialize(NetUtil.isIpV4StackPreferred());, +        }, +    }, +, +    private static native void initialize(boolean ipv4Preferred);]