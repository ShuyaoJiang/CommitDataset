[+++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpContentEncoder.java, +, +        // handle the case of single complete message without content, +        if (msg instanceof FullHttpMessage && !((FullHttpMessage) msg).data().readable()) {, +, +            // Remove content encoding, +            String acceptEncoding = acceptEncodingQueue.poll();, +            if (acceptEncoding == null) {, +                throw new IllegalStateException("cannot send more responses than requests");, +            }, +, +            return msg;, +        }, +, +]