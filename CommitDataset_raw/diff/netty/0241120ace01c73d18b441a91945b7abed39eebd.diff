[+++ b/src/main/java/org/jboss/netty/handler/execution/ChannelEventRunnable.java, +    volatile int estimatedSize;, +++ b/src/main/java/org/jboss/netty/handler/execution/ChannelEventRunnable.java, +    volatile int estimatedSize;, +++ b/src/main/java/org/jboss/netty/handler/execution/MemoryAwareThreadPoolExecutor.java, +    private volatile Settings settings = new Settings(0, 0);, +, +    // XXX Can be changed in runtime now.  Make it mutable in 3.1., +        return settings.maxChannelMemorySize;, +        settings = new Settings(maxChannelMemorySize, settings.maxTotalMemorySize);, +        return settings.maxTotalMemorySize;, +        settings = new Settings(settings.maxChannelMemorySize, maxTotalMemorySize);, +        Settings settings = this.settings;, +        int maxTotalMemorySize = settings.maxTotalMemorySize;, +        int maxChannelMemorySize = settings.maxChannelMemorySize;, +, +            ChannelEventRunnable eventTask = (ChannelEventRunnable) task;, +            eventTask.estimatedSize = increment;, +            Channel channel = eventTask.getEvent().getChannel();, +        Settings settings = this.settings;, +        int maxTotalMemorySize = settings.maxTotalMemorySize;, +        int maxChannelMemorySize = settings.maxChannelMemorySize;, +, +        int increment;, +        if (task instanceof ChannelEventRunnable) {, +            increment = ((ChannelEventRunnable) task).estimatedSize;, +        } else {, +            increment = getObjectSizeEstimator().estimateSize(task);, +        }, +, +, +    private static class Settings {, +        final int maxChannelMemorySize;, +        final int maxTotalMemorySize;, +, +        Settings(int maxChannelMemorySize, int maxTotalMemorySize) {, +            this.maxChannelMemorySize = maxChannelMemorySize;, +            this.maxTotalMemorySize = maxTotalMemorySize;, +        }, +    }]