[+++ b/codec-http/src/main/java/io/netty/handler/codec/spdy/SpdySession.java, +        if (state == null) {, +            return -1;, +        }, +        return state.updateReceiveWindowSize(deltaWindowSize);, +++ b/codec-http/src/main/java/io/netty/handler/codec/spdy/SpdySession.java, +        if (state == null) {, +            return -1;, +        }, +        return state.updateReceiveWindowSize(deltaWindowSize);, +++ b/codec-http/src/main/java/io/netty/handler/codec/spdy/SpdySessionHandler.java, +        spdySession.updateSendWindowSize(streamId, deltaWindowSize);, +        while (true) {, +                return;, +            int sendWindowSize = spdySession.getSendWindowSize(writeStreamId);, +            int sessionSendWindowSize = spdySession.getSendWindowSize(SPDY_SESSION_STREAM_ID);, +            sendWindowSize = Math.min(sendWindowSize, sessionSendWindowSize);, +            if (sendWindowSize <= 0) {, +                return;, +            } else if (sendWindowSize < dataFrameSize) {, +                // We can send a partial frame, +                spdySession.updateSendWindowSize(writeStreamId, -1 * sendWindowSize);, +                spdySession.updateSendWindowSize(SPDY_SESSION_STREAM_ID, -1 * sendWindowSize);, +, +                // Create a partial data frame whose length is the current window size, +                SpdyDataFrame partialDataFrame = new DefaultSpdyDataFrame(writeStreamId,, +                        spdyDataFrame.content().readSlice(sendWindowSize).retain());, +, +                // The transfer window size is pre-decremented when sending a data frame downstream., +                // Close the session on write failures that leave the transfer window in a corrupt state., +                ctx.writeAndFlush(partialDataFrame).addListener(new ChannelFutureListener() {, +                    @Override, +                    public void operationComplete(ChannelFuture future) throws Exception {, +                        if (!future.isSuccess()) {, +                            issueSessionError(ctx, SpdySessionStatus.INTERNAL_ERROR);, +                        }, +                    }, +                });, +            } else {, +                spdySession.updateSendWindowSize(writeStreamId, -1 * dataFrameSize);]