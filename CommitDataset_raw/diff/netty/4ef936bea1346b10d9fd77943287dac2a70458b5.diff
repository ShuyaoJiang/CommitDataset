[+++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioAcceptedSocketChannel.java, +        setConnected();, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioAcceptedSocketChannel.java, +        setConnected();, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +            channel.setBound();, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioAcceptedSocketChannel.java, +        setConnected();, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +            channel.setBound();, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioSocketChannel.java, +    private static final int ST_OPEN = 0;, +    private static final int ST_BOUND = 1;, +    private static final int ST_CONNECTED = 2;, +    private static final int ST_CLOSED = -1;, +    private volatile int state = ST_OPEN;, +    final void setBound() {, +        assert state == ST_OPEN;, +        state = ST_BOUND;, +    }, +, +    final void setConnected() {, +        assert state == ST_OPEN || state == ST_BOUND;, +        state = ST_CONNECTED;, +    }, +, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioAcceptedSocketChannel.java, +        setConnected();, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +            channel.setBound();, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioSocketChannel.java, +    private static final int ST_OPEN = 0;, +    private static final int ST_BOUND = 1;, +    private static final int ST_CONNECTED = 2;, +    private static final int ST_CLOSED = -1;, +    private volatile int state = ST_OPEN;, +    final void setBound() {, +        assert state == ST_OPEN;, +        state = ST_BOUND;, +    }, +, +    final void setConnected() {, +        assert state == ST_OPEN || state == ST_BOUND;, +        state = ST_CONNECTED;, +    }, +, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioWorker.java, +import java.nio.channels.ScatteringByteChannel;, +        ScatteringByteChannel ch = (ScatteringByteChannel) k.channel();, +        } catch (AsynchronousCloseException e) {, +        } catch (Throwable t) {, +                } catch (AsynchronousCloseException e) {, +                } catch (Throwable t) {, +                channel.setConnected();]