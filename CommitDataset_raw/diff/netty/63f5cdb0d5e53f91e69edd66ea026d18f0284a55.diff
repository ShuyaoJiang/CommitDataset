[+++ b/buffer/src/main/java/io/netty/buffer/AbstractByteBuf.java, +        final int maxCapacity = maxCapacity();, +        final int writerIndex = writerIndex();, +            if (!force || capacity() == maxCapacity) {, +            capacity(maxCapacity);, +++ b/buffer/src/main/java/io/netty/buffer/AbstractByteBuf.java, +        final int maxCapacity = maxCapacity();, +        final int writerIndex = writerIndex();, +            if (!force || capacity() == maxCapacity) {, +            capacity(maxCapacity);, +++ b/buffer/src/test/java/io/netty/buffer/AbstractByteBufTest.java, +    @Test, +    public void ensureWritableWithForceDoesNotThrow() {, +        ensureWritableDoesNotThrow(true);, +    }, +, +    @Test, +    public void ensureWritableWithOutForceDoesNotThrow() {, +        ensureWritableDoesNotThrow(false);, +    }, +, +    private void ensureWritableDoesNotThrow(boolean force) {, +        final ByteBuf buffer = newBuffer(8);, +        buffer.writerIndex(buffer.capacity());, +        buffer.ensureWritable(8, force);, +        buffer.release();, +    }, +]