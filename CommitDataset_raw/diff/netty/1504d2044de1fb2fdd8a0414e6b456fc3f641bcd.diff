[+++ b/transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollSocketChannel.java, +import io.netty.buffer.CompositeByteBuf;, +                if (buf instanceof CompositeByteBuf) {, +                    // Special handling of CompositeByteBuf to reduce memory copies if some of the Components, +                    // in the CompositeByteBuf are backed by a memoryAddress., +                    CompositeByteBuf comp = (CompositeByteBuf) buf;, +                    if (!comp.isDirect() || comp.nioBufferCount() > Native.IOV_MAX) {, +                        // more then 1024 buffers for gathering writes so just do a memory copy., +                        buf = newDirectBuffer(buf);, +                        assert buf.hasMemoryAddress();, +                    }, +                } else {, +            }, +++ b/transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollSocketChannel.java, +import io.netty.buffer.CompositeByteBuf;, +                if (buf instanceof CompositeByteBuf) {, +                    // Special handling of CompositeByteBuf to reduce memory copies if some of the Components, +                    // in the CompositeByteBuf are backed by a memoryAddress., +                    CompositeByteBuf comp = (CompositeByteBuf) buf;, +                    if (!comp.isDirect() || comp.nioBufferCount() > Native.IOV_MAX) {, +                        // more then 1024 buffers for gathering writes so just do a memory copy., +                        buf = newDirectBuffer(buf);, +                        assert buf.hasMemoryAddress();, +                    }, +                } else {, +            }, +++ b/transport-native-epoll/src/main/java/io/netty/channel/epoll/IovArray.java, +import io.netty.buffer.CompositeByteBuf;, +import java.nio.ByteBuffer;, +, +        add(addr, offset, len);, +        return true;, +    }, +, +    private void add(long addr, int offset, int len) {, +        if (len == 0) {, +            // No need to add an empty buffer., +            return;, +        }, +    }, +, +    private boolean add(CompositeByteBuf buf) {, +        ByteBuffer[] buffers = buf.nioBuffers();, +        if (count + buffers.length >= Native.IOV_MAX) {, +            // No more room!, +            return false;, +        }, +        for (int i = 0; i < buffers.length; i++) {, +            ByteBuffer nioBuffer = buffers[i];, +            int offset = nioBuffer.position();, +            int len = nioBuffer.limit() - nioBuffer.position();, +            if (len == 0) {, +                // No need to add an empty buffer so just continue, +                continue;, +            }, +            long addr = PlatformDependent.directBufferAddress(nioBuffer);, +, +            add(addr, offset, len);, +        }, +        if (msg instanceof ByteBuf) {, +            if (msg instanceof CompositeByteBuf) {, +                return add((CompositeByteBuf) msg);, +            } else {, +                return add((ByteBuf) msg);, +            }, +        }, +        return false;]