[+++ b/handler/src/main/java/io/netty/handler/stream/ChunkedWriteHandler.java, +import java.util.concurrent.atomic.AtomicBoolean;, +    private final AtomicBoolean flush = new AtomicBoolean(false);, +    private void flush(ChannelHandlerContext ctx, boolean fireNow) throws Exception {, +        boolean acquired = false;, +, +        // use CAS to see if the have flush already running, if so we don't need to take futher actions, +        if (acquired = flush.compareAndSet(false, true)) {, +            try {, +        , +                                , +                                        public void operationComplete(ChannelFuture future) throws Exception {, +            } finally {, +                // mark the flush as done, +                flush.set(false);, +            }, +            , +        }, +        , +        if (acquired && !channel.isConnected() || (channel.isWritable() && !queue.isEmpty())) {, +            flush(ctx, fireNow);, +        }]