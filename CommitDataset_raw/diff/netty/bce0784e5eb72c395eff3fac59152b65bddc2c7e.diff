[+++ b/transport/src/test/java/io/netty/channel/ChannelOutboundBufferTest.java, +        final CountDownLatch handlerRemovedLatch = new CountDownLatch(1);, +        ch.pipeline().addLast(executor, "handler", new ChannelOutboundHandlerAdapter() {, +            public void handlerAdded(ChannelHandlerContext ctx) {, +, +            @Override, +            public void handlerRemoved(ChannelHandlerContext ctx) {, +                handlerRemovedLatch.countDown();, +            }, +        while (executor.pendingTasks() != 0) {, +            // Wait until there is no more pending task left., +            Thread.sleep(10);, +        }, +, +        ch.pipeline().remove("handler");, +, +        // Ensure we do not try to shutdown the executor before we handled everything for the Channel. Otherwise, +        // the Executor may reject when the Channel tries to add a task to it., +        handlerRemovedLatch.await();, +, +]