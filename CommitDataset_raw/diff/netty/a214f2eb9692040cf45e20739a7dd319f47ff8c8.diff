[+++ b/resolver-dns/src/main/java/io/netty/resolver/dns/DnsQueryContext.java, +import io.netty.util.concurrent.FutureListener;, +final class DnsQueryContext implements FutureListener<AddressedEnvelope<DnsResponse, InetSocketAddress>> {, +        // Ensure we remove the id from the QueryContextManager once the query completes., +        promise.addListener(this);, +, +                public void operationComplete(ChannelFuture future) {, +, +    @Override, +    public void operationComplete(Future<AddressedEnvelope<DnsResponse, InetSocketAddress>> future) {, +        // Cancel the timeout task., +        final ScheduledFuture<?> timeoutFuture = this.timeoutFuture;, +        if (timeoutFuture != null) {, +            this.timeoutFuture = null;, +            timeoutFuture.cancel(false);, +        }, +, +        // Remove the id from the manager as soon as the query completes. This may be because of success, failure or, +        // cancellation, +        parent.queryContextManager.remove(nameServerAddr, id);, +    }]