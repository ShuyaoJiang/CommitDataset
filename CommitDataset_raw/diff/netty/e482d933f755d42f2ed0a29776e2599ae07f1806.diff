[+++ b/buffer/src/main/java/io/netty/buffer/PoolArena.java, +        private static byte[] newByteArray(int size) {, +            return PlatformDependent.allocateUninitializedArray(size);, +        }, +, +            return new PoolChunk<byte[]>(this, newByteArray(chunkSize), pageSize, maxOrder, pageShifts, chunkSize, 0);, +            return new PoolChunk<byte[]>(this, newByteArray(capacity), capacity, 0);, +++ b/buffer/src/main/java/io/netty/buffer/PoolArena.java, +        private static byte[] newByteArray(int size) {, +            return PlatformDependent.allocateUninitializedArray(size);, +        }, +, +            return new PoolChunk<byte[]>(this, newByteArray(chunkSize), pageSize, maxOrder, pageShifts, chunkSize, 0);, +            return new PoolChunk<byte[]>(this, newByteArray(capacity), capacity, 0);, +++ b/buffer/src/main/java/io/netty/buffer/UnpooledUnsafeHeapByteBuf.java, +    byte[] allocateArray(int initialCapacity) {, +        return PlatformDependent.allocateUninitializedArray(initialCapacity);, +    }, +, +    @Override, +++ b/buffer/src/main/java/io/netty/buffer/PoolArena.java, +        private static byte[] newByteArray(int size) {, +            return PlatformDependent.allocateUninitializedArray(size);, +        }, +, +            return new PoolChunk<byte[]>(this, newByteArray(chunkSize), pageSize, maxOrder, pageShifts, chunkSize, 0);, +            return new PoolChunk<byte[]>(this, newByteArray(capacity), capacity, 0);, +++ b/buffer/src/main/java/io/netty/buffer/UnpooledUnsafeHeapByteBuf.java, +    byte[] allocateArray(int initialCapacity) {, +        return PlatformDependent.allocateUninitializedArray(initialCapacity);, +    }, +, +    @Override, +++ b/common/src/main/java/io/netty/util/internal/PlatformDependent.java, +    private static final int UNINITIALIZED_ARRAY_ALLOCATION_THRESHOLD;, +        logger.debug("-Dio.netty.maxDirectMemory: {} bytes", maxDirectMemory);, +, +        int tryAllocateUninitializedArray =, +                SystemPropertyUtil.getInt("io.netty.uninitializedArrayAllocationThreshold", 1024);, +        UNINITIALIZED_ARRAY_ALLOCATION_THRESHOLD = javaVersion() >= 9 && PlatformDependent0.hasAllocateArrayMethod() ?, +                tryAllocateUninitializedArray : -1;, +        logger.debug("-Dio.netty.uninitializedArrayAllocationThreshold: {}", UNINITIALIZED_ARRAY_ALLOCATION_THRESHOLD);, +    public static byte[] allocateUninitializedArray(int size) {, +        return UNINITIALIZED_ARRAY_ALLOCATION_THRESHOLD < 0 || UNINITIALIZED_ARRAY_ALLOCATION_THRESHOLD > size ?, +                new byte[size] : PlatformDependent0.allocateUninitializedArray(size);, +    }, +, +++ b/buffer/src/main/java/io/netty/buffer/PoolArena.java, +        private static byte[] newByteArray(int size) {, +            return PlatformDependent.allocateUninitializedArray(size);, +        }, +, +            return new PoolChunk<byte[]>(this, newByteArray(chunkSize), pageSize, maxOrder, pageShifts, chunkSize, 0);, +            return new PoolChunk<byte[]>(this, newByteArray(capacity), capacity, 0);, +++ b/buffer/src/main/java/io/netty/buffer/UnpooledUnsafeHeapByteBuf.java, +    byte[] allocateArray(int initialCapacity) {, +        return PlatformDependent.allocateUninitializedArray(initialCapacity);, +    }, +, +    @Override, +++ b/common/src/main/java/io/netty/util/internal/PlatformDependent.java, +    private static final int UNINITIALIZED_ARRAY_ALLOCATION_THRESHOLD;, +        logger.debug("-Dio.netty.maxDirectMemory: {} bytes", maxDirectMemory);, +, +        int tryAllocateUninitializedArray =, +                SystemPropertyUtil.getInt("io.netty.uninitializedArrayAllocationThreshold", 1024);, +        UNINITIALIZED_ARRAY_ALLOCATION_THRESHOLD = javaVersion() >= 9 && PlatformDependent0.hasAllocateArrayMethod() ?, +                tryAllocateUninitializedArray : -1;, +        logger.debug("-Dio.netty.uninitializedArrayAllocationThreshold: {}", UNINITIALIZED_ARRAY_ALLOCATION_THRESHOLD);, +    public static byte[] allocateUninitializedArray(int size) {, +        return UNINITIALIZED_ARRAY_ALLOCATION_THRESHOLD < 0 || UNINITIALIZED_ARRAY_ALLOCATION_THRESHOLD > size ?, +                new byte[size] : PlatformDependent0.allocateUninitializedArray(size);, +    }, +, +++ b/common/src/main/java/io/netty/util/internal/PlatformDependent0.java, +    private static final Method ALLOCATE_ARRAY_METHOD;, +    private static final Object INTERNAL_UNSAFE;, +        Method allocateArrayMethod = null;, +        Object internalUnsafe = null;, +            internalUnsafe = null;, +            ALLOCATE_ARRAY_METHOD = null;, +, +            Object maybeException = AccessController.doPrivileged(new PrivilegedAction<Object>() {, +                @Override, +                public Object run() {, +                    try {, +                        // Java9 has jdk.internal.misc.Unsafe and not all methods are propergated to, +                        // sun.misc.Unsafe, +                        Class<?> internalUnsafeClass = getClassLoader(PlatformDependent0.class), +                                .loadClass("jdk.internal.misc.Unsafe");, +                        Method method = internalUnsafeClass.getDeclaredMethod("getUnsafe");, +                        return method.invoke(null);, +                    } catch (Throwable e) {, +                        return e;, +                }, +            });, +, +            if (!(maybeException instanceof Throwable)) {, +                internalUnsafe = maybeException;, +                final Object finalInternalUnsafe = internalUnsafe;]