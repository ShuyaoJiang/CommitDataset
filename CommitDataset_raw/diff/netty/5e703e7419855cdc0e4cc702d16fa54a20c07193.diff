[+++ b/handler/src/main/java/io/netty/handler/traffic/AbstractTrafficShapingHandler.java, +import io.netty.buffer.ByteBufHolder;, +        long size = calculateSize(msg);, +        if (size > -1 && trafficCounter != null) {, +, +    /**, +     * Calculate the size of the given {@link Object}., +     *, +     * This implementation supports {@link ByteBuf} and {@link ByteBufHolder}. Sub-classes may override this., +     * @param msg       the msg for which the size should be calculated, +     * @return size     the size of the msg or {@code -1} if unknown., +     */, +    protected long calculateSize(Object msg) {, +        if (msg instanceof ByteBuf) {, +            return ((ByteBuf) msg).readableBytes();, +        }, +        if (msg instanceof ByteBufHolder) {, +            return ((ByteBufHolder) msg).content().readableBytes();, +        }, +        return -1;, +    }]