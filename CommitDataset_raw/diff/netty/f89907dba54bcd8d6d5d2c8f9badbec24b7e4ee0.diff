[+++ b/transport/src/main/java/io/netty/channel/ChannelOutboundBuffer.java, +                        nioBuffers = expandNioBufferArray(nioBuffers, neededSpace, nioBufferCount);, +                        NIO_BUFFERS.set(threadLocalMap, nioBuffers);, +    private static ByteBuffer[] expandNioBufferArray(ByteBuffer[] array, int neededSpace, int size) {, +        int newCapacity = array.length;, +        do {, +            // double capacity until it is big enough, +            // See https://github.com/netty/netty/issues/1890, +            newCapacity <<= 1;, +, +            if (newCapacity < 0) {, +                throw new IllegalStateException();, +            }, +, +        } while (neededSpace > newCapacity);, +, +        ByteBuffer[] newArray = new ByteBuffer[newCapacity];, +        System.arraycopy(array, 0, newArray, 0, size);, +, +        return newArray;, +    }, +]