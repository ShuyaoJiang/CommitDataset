[+++ b/testsuite/src/main/java/io/netty/testsuite/transport/socket/AbstractDatagramTest.java, +, +    protected void refreshLocalAddress(Bootstrap bootstrap) {, +        addr = new InetSocketAddress(NetUtil.LOCALHOST4, TestUtils.getFreePort());, +        bootstrap.localAddress(addr);, +    }, +++ b/testsuite/src/main/java/io/netty/testsuite/transport/socket/AbstractDatagramTest.java, +, +    protected void refreshLocalAddress(Bootstrap bootstrap) {, +        addr = new InetSocketAddress(NetUtil.LOCALHOST4, TestUtils.getFreePort());, +        bootstrap.localAddress(addr);, +    }, +++ b/testsuite/src/main/java/io/netty/testsuite/transport/socket/DatagramUnicastTest.java, +import io.netty.channel.ChannelInitializer;, +import java.net.BindException;, +        sb.handler(new ChannelInitializer<Channel>() {, +            @Override, +            protected void initChannel(Channel ch) throws Exception {, +                ch.pipeline().addLast(new SimpleChannelInboundHandler<DatagramPacket>() {, +                        for (byte b: bytes) {, +                            assertEquals(b, buf.readByte());, +            }, +        });, +        Channel sc = null;, +        BindException bindFailureCause = null;, +        for (int i = 0; i < 3; i ++) {, +            try {, +                sc = sb.bind().sync().channel();, +                break;, +            } catch (Exception e) {, +                if (e instanceof BindException) {, +                    logger.warn("Failed to bind to a free port; trying again", e);, +                    bindFailureCause = (BindException) e;, +                    refreshLocalAddress(sb);, +                } else {, +                    throw e;, +                }, +            }, +        }, +, +        if (sc == null) {, +            throw bindFailureCause;, +        }, +]