[+++ b/src/main/java/org/jboss/netty/handler/ssl/SslHandler.java, + * TLS renegotiation has been disabled by default due to a known security issue,, + * <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3555">CVE-2009-3555</a>., + * You can re-enable renegotiation by calling {@link #setEnableRenegotiation(boolean)}, + * with {@code true} at your own risk., + * <p>, + * If {@link #isEnableRenegotiation() enableRenegotiation} is {@code true} and, + * the initial handshake has been done successfully, you can call, + * {@link #handshake()} to trigger the renegotiation., + * <p>, + * If {@link #isEnableRenegotiation() enableRenegotiation} is {@code false},, + * an attempt to trigger renegotiation will result in the connection closure., +    private volatile boolean enableRenegotiation;, +, +        if (handshaken && !isEnableRenegotiation()) {, +            throw new IllegalStateException("renegotiation disabled");, +        }, +, +    /**, +     * Returns {@code true} if and only if TLS renegotiation is enabled., +     */, +    public boolean isEnableRenegotiation() {, +        return enableRenegotiation;, +    }, +, +    /**, +     * Enables or disables TLS renegotiation., +     */, +    public void setEnableRenegotiation(boolean enableRenegotiation) {, +        this.enableRenegotiation = enableRenegotiation;, +    }, +, +                            final HandshakeStatus handshakeStatus = result.getHandshakeStatus();, +                            handleRenegotiation(handshakeStatus);, +                                        handshakeStatus);, +                final HandshakeStatus handshakeStatus = result.getHandshakeStatus();, +                handleRenegotiation(handshakeStatus);, +                switch (handshakeStatus) {, +                            "Unexpected handshake status: " + handshakeStatus);, +                    if (!handshaken && !handshaking &&, +                        !engine.getUseClientMode() &&, +                    final HandshakeStatus handshakeStatus = result.getHandshakeStatus();, +                    handleRenegotiation(handshakeStatus);, +                    switch (handshakeStatus) {, +                                "Unknown handshake status: " + handshakeStatus);, +    private void handleRenegotiation(HandshakeStatus handshakeStatus) {, +        if (handshakeStatus == HandshakeStatus.NOT_HANDSHAKING) {, +            // Not handshaking, +            return;, +        }, +, +        if (!handshaken) {, +            // Not renegotiation, +            return;, +        }, +, +        if (handshaking) {, +            // Renegotiation in progress or failed already., +            // i.e. Renegotiation check has been done already below., +            return;, +        }, +, +        if (engine.isInboundDone() || engine.isOutboundDone()) {, +            // Not handshaking but closing., +            return;, +        }, +, +        if (isEnableRenegotiation()) {, +            // Continue renegotiation., +            handshake();, +        } else {, +            // Prevent reentrance of this method., +            handshaking = true;, +, +            // Raise an exception., +            fireExceptionCaught(, +                    ctx, new SSLException(, +                            "renegotiation attempted by peer; " +, +                            "closing the connection"));, +, +            // Close the connection to stop renegotiation., +            Channels.close(ctx, succeededFuture(ctx.getChannel()));, +        }, +    }, +]