[+++ b/src/main/java/org/jboss/netty/example/http/snoop/HttpRequestHandler.java, +import static org.jboss.netty.handler.codec.http.HttpHeaders.*;, +import static org.jboss.netty.handler.codec.http.HttpHeaders.Names.*;, +, +            responseContent.setLength(0);, +            responseContent.append("HOSTNAME: " + getHost(request, "unknown") + "\r\n");, +        boolean keepAlive = request.isKeepAlive();, +        response.setContent(ChannelBuffers.copiedBuffer(responseContent.toString(), CharsetUtil.UTF_8));, +        response.setHeader(CONTENT_TYPE, "text/plain; charset=UTF-8");, +        if (keepAlive) {, +            // Add 'Content-Length' header only for a keep-alive connection., +            response.setHeader(CONTENT_LENGTH, response.getContent().readableBytes());, +        // Encode the cookie., +                response.addHeader(SET_COOKIE, cookieEncoder.encode());, +        // Close the non-keep-alive connection after the write operation is done., +        if (!keepAlive) {]