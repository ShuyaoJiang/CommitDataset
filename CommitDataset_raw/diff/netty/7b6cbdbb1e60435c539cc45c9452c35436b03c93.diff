[+++ b/buffer/src/main/java/io/netty/buffer/ByteBufInputStream.java, +            if (b == -1 && lineBuf.length() == 0) {, +                return null;, +            }, +++ b/buffer/src/main/java/io/netty/buffer/ByteBufInputStream.java, +            if (b == -1 && lineBuf.length() == 0) {, +                return null;, +            }, +++ b/buffer/src/test/java/io/netty/buffer/ChannelBufferStreamTest.java, +import java.nio.charset.Charset;, +    public void testReadLine() throws Exception {, +        Charset utf8=Charset.forName("UTF-8");, +        ByteBuf buf = Unpooled.buffer();, +        assertNull(s);, +        int charCount=5;//total chars in the string below without new line characters, +        byte[] abc = "a\nb\r\nc\nd\ne".getBytes(utf8);, +        buf.writeBytes(abc);, +        in.mark(charCount);, +        assertEquals("a",in.readLine());, +        assertEquals("b",in.readLine());, +        assertEquals("c",in.readLine());, +        assertEquals("d",in.readLine());, +        assertEquals("e",in.readLine());, +        assertNull(in.readLine());, +, +        in.reset();, +        int count=0;, +        while(in.readLine() != null){, +            ++count;, +            if(count > charCount){, +                fail("readLine() should have returned null");, +            }, +        }, +        assertEquals(charCount,count);]