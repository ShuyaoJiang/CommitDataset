[+++ b/src/main/java/org/jboss/netty/handler/stream/ChunkedWriteHandler.java, +import java.nio.channels.ClosedChannelException;, +    private void discard(ChannelHandlerContext ctx) {, +        ClosedChannelException cause = null;, +        boolean fireExceptionCaught = false;, +        synchronized (this) {, +                }, +                if (cause == null) {, +                    cause = new ClosedChannelException();, +                currentEvent.getFuture().setFailure(cause);, +                fireExceptionCaught = true;, +, +        if (fireExceptionCaught) {, +            Channels.fireExceptionCaught(currentEvent.getChannel(), cause);, +        }, +    }, +]