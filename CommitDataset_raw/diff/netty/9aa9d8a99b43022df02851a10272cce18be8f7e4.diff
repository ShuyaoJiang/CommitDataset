[+++ b/transport/src/main/java/io/netty/channel/DefaultChannelHandlerContext.java, +++ b/transport/src/main/java/io/netty/channel/DefaultChannelHandlerContext.java, +++ b/transport/src/main/java/io/netty/channel/DefaultChannelPipeline.java, +import io.netty.channel.Channel.Unsafe;, +            headHandler = new ByteHeadHandler(channel.unsafe());, +            headHandler = new MessageHeadHandler(channel.unsafe());, +    static abstract class HeadHandler implements ChannelOutboundHandler {, +        protected final Unsafe unsafe;, +        protected HeadHandler(Unsafe unsafe) {, +            this.unsafe = unsafe;, +        }, +, +    private static final class ByteHeadHandler extends HeadHandler {, +, +        private ByteHeadHandler(Unsafe unsafe) {, +            super(unsafe);, +        }, +, +    private static final class MessageHeadHandler extends HeadHandler {, +, +        private MessageHeadHandler(Unsafe unsafe) {, +            super(unsafe);, +        }, +]