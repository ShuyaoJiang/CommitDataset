[+++ b/src/main/java/org/jboss/netty/example/http/HttpClient.java, +        CookieEncoder httpCookieEncoder = new CookieEncoder(false);, +++ b/src/main/java/org/jboss/netty/example/http/HttpClient.java, +        CookieEncoder httpCookieEncoder = new CookieEncoder(false);, +++ b/src/main/java/org/jboss/netty/example/http/HttpRequestHandler.java, +                CookieEncoder cookieEncoder = new CookieEncoder(true);, +++ b/src/main/java/org/jboss/netty/example/http/HttpClient.java, +        CookieEncoder httpCookieEncoder = new CookieEncoder(false);, +++ b/src/main/java/org/jboss/netty/example/http/HttpRequestHandler.java, +                CookieEncoder cookieEncoder = new CookieEncoder(true);, +++ b/src/main/java/org/jboss/netty/handler/codec/http/CookieEncoder.java, +    private final boolean server;, +    public CookieEncoder(boolean server) {, +        this(server, QueryStringDecoder.DEFAULT_CHARSET);, +    public CookieEncoder(boolean server, String charset) {, +        this.server = server;, +        if (server) {, +            return encodeServerSide();, +        } else {, +            return encodeClientSide();, +        }, +    }, +, +    private String encodeServerSide() {, +        StringBuilder sb = new StringBuilder();, +    private String encodeClientSide() {, +        StringBuilder sb = new StringBuilder();, +, +        for (Cookie cookie: cookies) {, +            if (cookie.getVersion() >= 1) {, +                add(sb, '$' + CookieHeaderNames.VERSION, 1);, +            }, +, +            add(sb, cookie.getName(), QueryStringEncoder.encodeComponent(cookie.getValue(), charset));, +, +            if (cookie.getPath() != null) {, +                add(sb, '$' + CookieHeaderNames.PATH, cookie.getPath());, +            }, +, +            if (cookie.getDomain() != null) {, +                add(sb, '$' + CookieHeaderNames.DOMAIN, cookie.getDomain());, +            }, +, +            if (cookie.getVersion() >= 1) {, +                if(!cookie.getPorts().isEmpty()) {, +                    sb.append('$');, +                    sb.append(CookieHeaderNames.PORT);, +                    sb.append((char) HttpCodecUtil.EQUALS);, +                    sb.append((char) HttpCodecUtil.DOUBLE_QUOTE);, +                    for (int port: cookie.getPorts()) {, +                        sb.append(port);, +                        sb.append((char) HttpCodecUtil.COMMA);, +                    }, +                    sb.setCharAt(sb.length() - 1, (char) HttpCodecUtil.DOUBLE_QUOTE);, +                    sb.append((char) HttpCodecUtil.SEMICOLON);, +                }, +            }, +        }, +        return sb.toString();, +    }, +, +    private static void add(StringBuilder sb, String name, String val) {, +    private static void addQuoted(StringBuilder sb, String name, String val) {, +    private static void add(StringBuilder sb, String name, int val) {, +++ b/src/main/java/org/jboss/netty/example/http/HttpClient.java, +        CookieEncoder httpCookieEncoder = new CookieEncoder(false);, +++ b/src/main/java/org/jboss/netty/example/http/HttpRequestHandler.java, +                CookieEncoder cookieEncoder = new CookieEncoder(true);, +++ b/src/main/java/org/jboss/netty/handler/codec/http/CookieEncoder.java, +    private final boolean server;, +    public CookieEncoder(boolean server) {, +        this(server, QueryStringDecoder.DEFAULT_CHARSET);, +    public CookieEncoder(boolean server, String charset) {, +        this.server = server;, +        if (server) {, +            return encodeServerSide();, +        } else {, +            return encodeClientSide();, +        }, +    }, +, +    private String encodeServerSide() {, +        StringBuilder sb = new StringBuilder();, +    private String encodeClientSide() {, +        StringBuilder sb = new StringBuilder();, +, +        for (Cookie cookie: cookies) {, +            if (cookie.getVersion() >= 1) {, +                add(sb, '$' + CookieHeaderNames.VERSION, 1);, +            }, +, +            add(sb, cookie.getName(), QueryStringEncoder.encodeComponent(cookie.getValue(), charset));, +, +            if (cookie.getPath() != null) {, +                add(sb, '$' + CookieHeaderNames.PATH, cookie.getPath());, +            }, +, +            if (cookie.getDomain() != null) {, +                add(sb, '$' + CookieHeaderNames.DOMAIN, cookie.getDomain());, +            }]