[+++ b/codec/src/main/java/io/netty/handler/codec/ByteToMessageDecoder.java, +            final ByteBuf buffer;, +                    || cumulation.refCnt() > 1 || cumulation.isReadOnly()) {, +                // duplicate().retain() or if its read-only., +++ b/codec/src/main/java/io/netty/handler/codec/ByteToMessageDecoder.java, +            final ByteBuf buffer;, +                    || cumulation.refCnt() > 1 || cumulation.isReadOnly()) {, +                // duplicate().retain() or if its read-only., +++ b/codec/src/test/java/io/netty/handler/codec/ByteToMessageDecoderTest.java, +, +    @Test, +    public void testReadOnlyBuffer() {, +        EmbeddedChannel channel = new EmbeddedChannel(new ByteToMessageDecoder() {, +            @Override, +            protected void decode(ChannelHandlerContext ctx, ByteBuf in, List<Object> out) throws Exception {, +            }, +        });, +        assertFalse(channel.writeInbound(Unpooled.buffer(8).writeByte(1).asReadOnly()));, +        assertFalse(channel.writeInbound(Unpooled.wrappedBuffer(new byte[] { (byte) 2 })));, +        assertFalse(channel.finish());, +    }]