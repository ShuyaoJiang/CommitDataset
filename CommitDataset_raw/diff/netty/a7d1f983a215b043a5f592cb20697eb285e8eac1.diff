[+++ b/transport/src/main/java/io/netty/channel/socket/nio/NioSocketChannel.java, +            int size = in.size();, +            if (size == 0) {, +                // All written so clear OP_WRITE, +                clearOpWrite();, +                break;, +            long writtenBytes = 0;, +            boolean done = false;, +            boolean setOpWrite = false;, +            long expectedWrittenBytes = in.nioBufferSize();, +            SocketChannel ch = javaChannel();, +            // Always us nioBuffers() to workaround data-corruption., +            // See https://github.com/netty/netty/issues/2761, +            switch (nioBufferCnt) {, +                case 0:, +                    return;, +                case 1:, +                    // Only one ByteBuf so use non-gathering write, +                    ByteBuffer nioBuffer = nioBuffers[0];, +                    for (int i = config().getWriteSpinCount() - 1; i >= 0; i --) {, +                        final int localWrittenBytes = ch.write(nioBuffer);, +                        if (localWrittenBytes == 0) {, +                            setOpWrite = true;, +                        expectedWrittenBytes -= localWrittenBytes;, +                        writtenBytes += localWrittenBytes;, +                        if (expectedWrittenBytes == 0) {, +                            done = true;, +                            break;, +                        }, +                    }, +                    break;, +                default:, +                    break;, +            }, +                for (int i = size; i > 0; i --) {]