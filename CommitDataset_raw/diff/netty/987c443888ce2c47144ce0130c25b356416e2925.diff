[+++ b/handler/src/main/java/io/netty/handler/ssl/OpenSsl.java, +import io.netty.buffer.ByteBufAllocator;, +                            certBio = ReferenceCountedOpenSslContext.toBIO(ByteBufAllocator.DEFAULT, cert.cert());, +++ b/handler/src/main/java/io/netty/handler/ssl/OpenSsl.java, +import io.netty.buffer.ByteBufAllocator;, +                            certBio = ReferenceCountedOpenSslContext.toBIO(ByteBufAllocator.DEFAULT, cert.cert());, +++ b/handler/src/main/java/io/netty/handler/ssl/OpenSslKeyMaterialManager.java, +                    setKeyMaterial(ssl, alias, engine.alloc);, +            keyCertChainBio = toBIO(engine.alloc, certificates);, +                keyBio = toBIO(engine.alloc, key);, +    private void setKeyMaterial(long ssl, String alias, ByteBufAllocator allocator) throws SSLException {, +            PemEncoded encoded = PemX509Certificate.toPEM(allocator, true, certificates);, +                keyCertChainBio = toBIO(allocator, encoded.retain());, +                keyCertChainBio2 = toBIO(allocator, encoded.retain());, +                    keyBio = toBIO(allocator, key);, +++ b/handler/src/main/java/io/netty/handler/ssl/OpenSsl.java, +import io.netty.buffer.ByteBufAllocator;, +                            certBio = ReferenceCountedOpenSslContext.toBIO(ByteBufAllocator.DEFAULT, cert.cert());, +++ b/handler/src/main/java/io/netty/handler/ssl/OpenSslKeyMaterialManager.java, +                    setKeyMaterial(ssl, alias, engine.alloc);, +            keyCertChainBio = toBIO(engine.alloc, certificates);, +                keyBio = toBIO(engine.alloc, key);, +    private void setKeyMaterial(long ssl, String alias, ByteBufAllocator allocator) throws SSLException {, +            PemEncoded encoded = PemX509Certificate.toPEM(allocator, true, certificates);, +                keyCertChainBio = toBIO(allocator, encoded.retain());, +                keyCertChainBio2 = toBIO(allocator, encoded.retain());, +                    keyBio = toBIO(allocator, key);, +++ b/handler/src/main/java/io/netty/handler/ssl/ReferenceCountedOpenSslContext.java, +                keyBio = toBIO(ByteBufAllocator.DEFAULT, key);, +    static long toBIO(ByteBufAllocator allocator, PrivateKey key) throws Exception {, +    static long toBIO(ByteBufAllocator allocator, X509Certificate... certChain) throws Exception {, +++ b/handler/src/main/java/io/netty/handler/ssl/OpenSsl.java, +import io.netty.buffer.ByteBufAllocator;, +                            certBio = ReferenceCountedOpenSslContext.toBIO(ByteBufAllocator.DEFAULT, cert.cert());, +++ b/handler/src/main/java/io/netty/handler/ssl/OpenSslKeyMaterialManager.java, +                    setKeyMaterial(ssl, alias, engine.alloc);, +            keyCertChainBio = toBIO(engine.alloc, certificates);, +                keyBio = toBIO(engine.alloc, key);, +    private void setKeyMaterial(long ssl, String alias, ByteBufAllocator allocator) throws SSLException {, +            PemEncoded encoded = PemX509Certificate.toPEM(allocator, true, certificates);, +                keyCertChainBio = toBIO(allocator, encoded.retain());, +                keyCertChainBio2 = toBIO(allocator, encoded.retain());, +                    keyBio = toBIO(allocator, key);, +++ b/handler/src/main/java/io/netty/handler/ssl/ReferenceCountedOpenSslContext.java, +                keyBio = toBIO(ByteBufAllocator.DEFAULT, key);, +    static long toBIO(ByteBufAllocator allocator, PrivateKey key) throws Exception {, +    static long toBIO(ByteBufAllocator allocator, X509Certificate... certChain) throws Exception {, +++ b/handler/src/main/java/io/netty/handler/ssl/ReferenceCountedOpenSslEngine.java, +    final ByteBufAllocator alloc;, +++ b/handler/src/main/java/io/netty/handler/ssl/OpenSsl.java, +import io.netty.buffer.ByteBufAllocator;, +                            certBio = ReferenceCountedOpenSslContext.toBIO(ByteBufAllocator.DEFAULT, cert.cert());, +++ b/handler/src/main/java/io/netty/handler/ssl/OpenSslKeyMaterialManager.java, +                    setKeyMaterial(ssl, alias, engine.alloc);, +            keyCertChainBio = toBIO(engine.alloc, certificates);, +                keyBio = toBIO(engine.alloc, key);, +    private void setKeyMaterial(long ssl, String alias, ByteBufAllocator allocator) throws SSLException {, +            PemEncoded encoded = PemX509Certificate.toPEM(allocator, true, certificates);, +                keyCertChainBio = toBIO(allocator, encoded.retain());, +                keyCertChainBio2 = toBIO(allocator, encoded.retain());, +                    keyBio = toBIO(allocator, key);, +++ b/handler/src/main/java/io/netty/handler/ssl/ReferenceCountedOpenSslContext.java, +                keyBio = toBIO(ByteBufAllocator.DEFAULT, key);, +    static long toBIO(ByteBufAllocator allocator, PrivateKey key) throws Exception {, +    static long toBIO(ByteBufAllocator allocator, X509Certificate... certChain) throws Exception {, +++ b/handler/src/main/java/io/netty/handler/ssl/ReferenceCountedOpenSslEngine.java, +    final ByteBufAllocator alloc;, +++ b/handler/src/main/java/io/netty/handler/ssl/ReferenceCountedOpenSslServerContext.java, +import io.netty.buffer.ByteBufAllocator;, +                    bio = toBIO(ByteBufAllocator.DEFAULT, issuers);]