[+++ b/handler/src/main/java/io/netty/handler/ssl/SslHandler.java, +        ByteBufAllocator alloc = ctx.alloc();, +                SSLEngineResult result = wrap(alloc, engine, buf, out);, +        ByteBufAllocator alloc = ctx.alloc();, +                SSLEngineResult result = wrap(alloc, engine, Unpooled.EMPTY_BUFFER, out);, +    private SSLEngineResult wrap(ByteBufAllocator alloc, SSLEngine engine, ByteBuf in, ByteBuf out), +            throws SSLException {, +        ByteBuf newDirectIn = null;, +        try {, +            final ByteBuffer in0;, +            if (in.isDirect()) {, +                in0 = in.nioBuffer();, +            } else {, +                int readableBytes = in.readableBytes();, +                newDirectIn = alloc.directBuffer(readableBytes);, +                newDirectIn.writeBytes(in, in.readerIndex(), readableBytes);, +                in0 = newDirectIn.internalNioBuffer(0, readableBytes);, +        } finally {, +            if (newDirectIn != null) {, +                newDirectIn.release();, +            }, +        }]