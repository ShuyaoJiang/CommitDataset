[+++ b/codec-http/src/main/java/io/netty/handler/codec/spdy/SpdySessionHandler.java, +    private ChannelFutureListener closeSessionFutureListener;, +                halfCloseStream(streamId, true, ctx.newSucceededFuture());, +                halfCloseStream(streamId, true, ctx.newSucceededFuture());, +            removeStream(spdyRstStreamFrame.getStreamId(), ctx.newSucceededFuture());, +                halfCloseStream(streamId, true, ctx.newSucceededFuture());, +            removeStream(streamId, ctx.newSucceededFuture());, +                halfCloseStream(streamId, false, promise);, +                halfCloseStream(streamId, false, promise);, +            removeStream(spdyRstStreamFrame.getStreamId(), promise);, +                halfCloseStream(streamId, false, promise);, +        ChannelPromise promise = ctx.newPromise();, +        removeStream(streamId, promise);, +        ctx.writeAndFlush(spdyRstStreamFrame, promise);, +    private void halfCloseStream(int streamId, boolean remote, ChannelFuture future) {, +        if (closeSessionFutureListener != null && spdySession.noActiveStreams()) {, +            future.addListener(closeSessionFutureListener);, +    private void removeStream(int streamId, ChannelFuture future) {, +        if (closeSessionFutureListener != null && spdySession.noActiveStreams()) {, +            future.addListener(closeSessionFutureListener);, +                        halfCloseStream(streamId, false, pendingWrite.promise);, +            closeSessionFutureListener = new ClosingChannelFutureListener(ctx, future);]