[+++ b/resolver-dns/src/test/java/io/netty/resolver/dns/DnsNameResolverTest.java, +import java.net.UnknownHostException;, +import static org.hamcrest.Matchers.hasSize;, +import static org.hamcrest.Matchers.instanceOf;, +import static org.junit.Assert.fail;, +    @Test(timeout = 5000), +    public void testNegativeTtl() throws Exception {, +        final int oldNegativeTtl = resolver.negativeTtl();, +        resolver.setNegativeTtl(10);, +        try {, +            resolveNonExistentDomain();, +, +            // If negative cache works, this loop should be done really quickly., +            final List<UnknownHostException> exceptions = new ArrayList<UnknownHostException>();, +            final int size = 10000;, +, +            for (int i = 0; i < size; i++) {, +                exceptions.add(resolveNonExistentDomain());, +            }, +, +            assertThat(exceptions, hasSize(size));, +        } finally {, +            resolver.setNegativeTtl(oldNegativeTtl);, +        }, +    }, +, +    private static UnknownHostException resolveNonExistentDomain() {, +        try {, +            resolver.resolve("non-existent.netty.io", 0).sync();, +            fail();, +            return null;, +        } catch (Exception e) {, +            assertThat(e, is(instanceOf(UnknownHostException.class)));, +            return (UnknownHostException) e;, +        }, +    }, +]