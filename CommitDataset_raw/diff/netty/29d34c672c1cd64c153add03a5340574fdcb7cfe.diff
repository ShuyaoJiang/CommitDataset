[+++ b/handler/src/main/java/io/netty/handler/stream/ChunkedWriteHandler.java, +import io.netty.buffer.ByteBuf;, +import io.netty.buffer.ByteBufHolder;, +                final int amount = amount(message);, +                            currentWrite.progress(amount);, +                                currentWrite.progress(amount);, +                                currentWrite.progress(amount);, +        void progress(int amount) {, +            progress += amount;, +, +    private static int amount(Object msg) {, +        if (msg instanceof ByteBuf) {, +            return ((ByteBuf) msg).readableBytes();, +        }, +        if (msg instanceof ByteBufHolder) {, +            return ((ByteBufHolder) msg).content().readableBytes();, +        }, +        return 1;, +    }]