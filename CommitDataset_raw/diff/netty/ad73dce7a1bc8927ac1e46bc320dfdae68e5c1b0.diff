[+++ b/handler/src/main/java/io/netty/handler/ssl/SslHandler.java, +        ChannelPromise promise = null;, +                PendingWrite pending = pendingUnencryptedWrites.peek();, +                    promise = pending.promise;, +                } else {, +                    promise = null;, +                            if (promise != null) {, +                                ctx.write(out, promise);, +                                promise = null;, +                if (promise != null) {, +                    ctx.write(out, promise);, +            } else if (promise != null) {, +                promise.trySuccess();, +++ b/handler/src/main/java/io/netty/handler/ssl/SslHandler.java, +        ChannelPromise promise = null;, +                PendingWrite pending = pendingUnencryptedWrites.peek();, +                    promise = pending.promise;, +                } else {, +                    promise = null;, +                            if (promise != null) {, +                                ctx.write(out, promise);, +                                promise = null;, +                if (promise != null) {, +                    ctx.write(out, promise);, +            } else if (promise != null) {, +                promise.trySuccess();, +++ b/testsuite/src/test/java/io/netty/testsuite/transport/socket/SocketSslEchoTest.java, +import io.netty.channel.ChannelFuture;, +            ChannelFuture future = cc.write(Unpooled.wrappedBuffer(data, i, length));, +            // TODO: Remove me as it seems like ChunkWriteHandler has a bug which let it hang here, +            if (!chunkWriteHandler) {, +                future.sync();, +            }]