[+++ b/handler/src/main/java/io/netty/handler/ssl/SslHandler.java, +import javax.net.ssl.SSLEngineResult.HandshakeStatus;, +        pendingUnencryptedWrites.add(PendingWrite.newInstance(msg, promise));, +                packetLength = buffer.getUnsignedShort(first + 3) + 5;, +        int totalProduced = 0;, +, +                final SSLEngineResult result = unwrap(engine, packet, decodeOut);, +                final Status status = result.getStatus();, +                final HandshakeStatus handshakeStatus = result.getHandshakeStatus();, +                final int produced = result.bytesProduced();, +                final int consumed = result.bytesConsumed();, +, +                totalProduced += produced;, +                if (status == Status.CLOSED) {, +                switch (handshakeStatus) {, +                        throw new IllegalStateException("Unknown handshake status: " + handshakeStatus);, +                if (status == Status.BUFFER_UNDERFLOW || consumed == 0 && produced == 0) {, +            if (totalProduced > 0) {]