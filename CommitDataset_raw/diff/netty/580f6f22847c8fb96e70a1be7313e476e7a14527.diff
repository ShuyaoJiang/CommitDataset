[+++ b/src/main/java/org/jboss/netty/handler/ssl/SslHandler.java, +    private boolean initialHandshake;, +    private boolean handshaking;, +                runDelegatedTasks();, +                    if (!Thread.holdsLock(handshakeLock)) {, +                        // unwrap shouldn't be called when this method was, +                        // called by unwrap - unwrap will keep running after, +                        // this method returns., +                    }, +            boolean needsWrap = false;, +                    if (initialHandshake && !engine.getUseClientMode() &&, +                        !engine.isInboundDone() && !engine.isOutboundDone()) {, +                        handshake(channel);, +                        initialHandshake = false;, +                    try {, +                    } catch (SSLException e) {, +                        System.err.println(engine.getUseClientMode());, +                        throw e;, +                        needsWrap = true;, +                        needsWrap = true;, +            }, +, +            if (needsWrap) {, +                wrap(ctx, channel);, +            }, +        for (;;) {, +            final Runnable task;, +            synchronized (handshakeLock) {, +                task = engine.getDelegatedTask();, +            }, +, +            if (task == null) {, +                break;, +            }, +, +                        task.run();, +            if (!handshaking) {, +                return;, +            }]