[+++ b/buffer/src/main/java/io/netty/buffer/ByteBufUtil.java, +            return PlatformDependent.allocateUninitializedArray(MAX_TL_ARRAY_LEN);, +    static final int MAX_TL_ARRAY_LEN = 1024;, +, +    /**, +     * Allocates a new array if minLength > {@link ByteBufUtil#MAX_TL_ARRAY_LEN}, +     */, +    static byte[] threadLocalTempArray(int minLength) {, +        return minLength <= MAX_TL_ARRAY_LEN ? BYTE_ARRAYS.get(), +            : PlatformDependent.allocateUninitializedArray(minLength);, +    }, +, +            array = threadLocalTempArray(len);, +            if (length <= MAX_TL_ARRAY_LEN || !allocator.isDirectBufferPooled()) {, +                getBytes(buffer, threadLocalTempArray(length), 0, chunkLen, out, length);, +            } else {, +++ b/buffer/src/main/java/io/netty/buffer/ByteBufUtil.java, +            return PlatformDependent.allocateUninitializedArray(MAX_TL_ARRAY_LEN);, +    static final int MAX_TL_ARRAY_LEN = 1024;, +, +    /**, +     * Allocates a new array if minLength > {@link ByteBufUtil#MAX_TL_ARRAY_LEN}, +     */, +    static byte[] threadLocalTempArray(int minLength) {, +        return minLength <= MAX_TL_ARRAY_LEN ? BYTE_ARRAYS.get(), +            : PlatformDependent.allocateUninitializedArray(minLength);, +    }, +, +            array = threadLocalTempArray(len);, +            if (length <= MAX_TL_ARRAY_LEN || !allocator.isDirectBufferPooled()) {, +                getBytes(buffer, threadLocalTempArray(length), 0, chunkLen, out, length);, +            } else {, +++ b/buffer/src/main/java/io/netty/buffer/PooledDirectByteBuf.java, +        byte[] tmp = ByteBufUtil.threadLocalTempArray(length);, +        int readBytes = in.read(tmp, 0, length);, +++ b/buffer/src/main/java/io/netty/buffer/ByteBufUtil.java, +            return PlatformDependent.allocateUninitializedArray(MAX_TL_ARRAY_LEN);, +    static final int MAX_TL_ARRAY_LEN = 1024;, +, +    /**, +     * Allocates a new array if minLength > {@link ByteBufUtil#MAX_TL_ARRAY_LEN}, +     */, +    static byte[] threadLocalTempArray(int minLength) {, +        return minLength <= MAX_TL_ARRAY_LEN ? BYTE_ARRAYS.get(), +            : PlatformDependent.allocateUninitializedArray(minLength);, +    }, +, +            array = threadLocalTempArray(len);, +            if (length <= MAX_TL_ARRAY_LEN || !allocator.isDirectBufferPooled()) {, +                getBytes(buffer, threadLocalTempArray(length), 0, chunkLen, out, length);, +            } else {, +++ b/buffer/src/main/java/io/netty/buffer/PooledDirectByteBuf.java, +        byte[] tmp = ByteBufUtil.threadLocalTempArray(length);, +        int readBytes = in.read(tmp, 0, length);, +++ b/buffer/src/main/java/io/netty/buffer/ReadOnlyByteBufferBuf.java, +            byte[] tmp = ByteBufUtil.threadLocalTempArray(length);, +            tmpBuf.get(tmp, 0, length);, +            out.write(tmp, 0, length);, +++ b/buffer/src/main/java/io/netty/buffer/ByteBufUtil.java, +            return PlatformDependent.allocateUninitializedArray(MAX_TL_ARRAY_LEN);, +    static final int MAX_TL_ARRAY_LEN = 1024;, +, +    /**, +     * Allocates a new array if minLength > {@link ByteBufUtil#MAX_TL_ARRAY_LEN}, +     */, +    static byte[] threadLocalTempArray(int minLength) {, +        return minLength <= MAX_TL_ARRAY_LEN ? BYTE_ARRAYS.get(), +            : PlatformDependent.allocateUninitializedArray(minLength);, +    }, +, +            array = threadLocalTempArray(len);, +            if (length <= MAX_TL_ARRAY_LEN || !allocator.isDirectBufferPooled()) {, +                getBytes(buffer, threadLocalTempArray(length), 0, chunkLen, out, length);, +            } else {, +++ b/buffer/src/main/java/io/netty/buffer/PooledDirectByteBuf.java, +        byte[] tmp = ByteBufUtil.threadLocalTempArray(length);, +        int readBytes = in.read(tmp, 0, length);, +++ b/buffer/src/main/java/io/netty/buffer/ReadOnlyByteBufferBuf.java, +            byte[] tmp = ByteBufUtil.threadLocalTempArray(length);, +            tmpBuf.get(tmp, 0, length);, +            out.write(tmp, 0, length);, +++ b/buffer/src/main/java/io/netty/buffer/UnpooledDirectByteBuf.java, +            byte[] tmp = ByteBufUtil.threadLocalTempArray(length);, +            int readBytes = in.read(tmp, 0, length);, +++ b/buffer/src/main/java/io/netty/buffer/ByteBufUtil.java, +            return PlatformDependent.allocateUninitializedArray(MAX_TL_ARRAY_LEN);, +    static final int MAX_TL_ARRAY_LEN = 1024;, +, +    /**, +     * Allocates a new array if minLength > {@link ByteBufUtil#MAX_TL_ARRAY_LEN}, +     */, +    static byte[] threadLocalTempArray(int minLength) {, +        return minLength <= MAX_TL_ARRAY_LEN ? BYTE_ARRAYS.get(), +            : PlatformDependent.allocateUninitializedArray(minLength);, +    }, +, +            array = threadLocalTempArray(len);, +            if (length <= MAX_TL_ARRAY_LEN || !allocator.isDirectBufferPooled()) {, +                getBytes(buffer, threadLocalTempArray(length), 0, chunkLen, out, length);, +            } else {]