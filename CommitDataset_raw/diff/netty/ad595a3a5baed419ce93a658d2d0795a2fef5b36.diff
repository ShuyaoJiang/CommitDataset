[+++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioAcceptedSocketChannel.java, +final class NioAcceptedSocketChannel extends NioSocketChannel {, +        super(parent, factory, pipeline, sink, socket, worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioAcceptedSocketChannel.java, +final class NioAcceptedSocketChannel extends NioSocketChannel {, +        super(parent, factory, pipeline, sink, socket, worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketChannel.java, +final class NioClientSocketChannel extends NioSocketChannel {, +            ChannelFactory factory, ChannelPipeline pipeline,, +            ChannelSink sink, NioWorker worker) {, +        super(null, factory, pipeline, sink, newSocket(), worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioAcceptedSocketChannel.java, +final class NioAcceptedSocketChannel extends NioSocketChannel {, +        super(parent, factory, pipeline, sink, socket, worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketChannel.java, +final class NioClientSocketChannel extends NioSocketChannel {, +            ChannelFactory factory, ChannelPipeline pipeline,, +            ChannelSink sink, NioWorker worker) {, +        super(null, factory, pipeline, sink, newSocket(), worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketChannelFactory.java, +    private final NioClientSocketPipelineSink sink;, +        return new NioClientSocketChannel(this, pipeline, sink, sink.nextWorker());, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioAcceptedSocketChannel.java, +final class NioAcceptedSocketChannel extends NioSocketChannel {, +        super(parent, factory, pipeline, sink, socket, worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketChannel.java, +final class NioClientSocketChannel extends NioSocketChannel {, +            ChannelFactory factory, ChannelPipeline pipeline,, +            ChannelSink sink, NioWorker worker) {, +        super(null, factory, pipeline, sink, newSocket(), worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketChannelFactory.java, +    private final NioClientSocketPipelineSink sink;, +        return new NioClientSocketChannel(this, pipeline, sink, sink.nextWorker());, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +                channel.worker.register(channel, future);, +                    ch.worker.register(ch, ch.connectFuture);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioAcceptedSocketChannel.java, +final class NioAcceptedSocketChannel extends NioSocketChannel {, +        super(parent, factory, pipeline, sink, socket, worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketChannel.java, +final class NioClientSocketChannel extends NioSocketChannel {, +            ChannelFactory factory, ChannelPipeline pipeline,, +            ChannelSink sink, NioWorker worker) {, +        super(null, factory, pipeline, sink, newSocket(), worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketChannelFactory.java, +    private final NioClientSocketPipelineSink sink;, +        return new NioClientSocketChannel(this, pipeline, sink, sink.nextWorker());, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +                channel.worker.register(channel, future);, +                    ch.worker.register(ch, ch.connectFuture);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioSocketChannel.java, +class NioSocketChannel extends AbstractChannel, +    final NioWorker worker;, +            SocketChannel socket, NioWorker worker) {, +        this.worker = worker;, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioAcceptedSocketChannel.java, +final class NioAcceptedSocketChannel extends NioSocketChannel {, +        super(parent, factory, pipeline, sink, socket, worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketChannel.java, +final class NioClientSocketChannel extends NioSocketChannel {, +            ChannelFactory factory, ChannelPipeline pipeline,, +            ChannelSink sink, NioWorker worker) {, +        super(null, factory, pipeline, sink, newSocket(), worker);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketChannelFactory.java, +    private final NioClientSocketPipelineSink sink;, +        return new NioClientSocketChannel(this, pipeline, sink, sink.nextWorker());, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +                channel.worker.register(channel, future);, +                    ch.worker.register(ch, ch.connectFuture);, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioSocketChannel.java, +class NioSocketChannel extends AbstractChannel, +    final NioWorker worker;, +            SocketChannel socket, NioWorker worker) {, +        this.worker = worker;, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioWorker.java, +            NioWorker worker = channel.worker;, +            if (workerThread == null || Thread.currentThread() != workerThread) {, +                setOpWrite(channel, mightNeedWakeup);, +                clearOpWrite(channel, mightNeedWakeup);, +    private static void setOpWrite(NioSocketChannel channel, boolean mightNeedWakeup) {, +        NioWorker worker = channel.worker;, +        }, +, +        if (changed) {, +            channel.setRawInterestOpsNow(interestOps);, +        }, +    }, +, +    private static void clearOpWrite(NioSocketChannel channel, boolean mightNeedWakeup) {, +        NioWorker worker = channel.worker;, +        Selector selector = worker.selector;, +        SelectionKey key = channel.socket.keyFor(selector);, +        if (key == null) {, +            return;, +        }, +        if (!key.isValid()) {, +            close(key);, +            return;, +        }, +        int interestOps;]