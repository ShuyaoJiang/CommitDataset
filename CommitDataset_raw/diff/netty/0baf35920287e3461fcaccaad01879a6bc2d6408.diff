[+++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpCodecUtil.java, +    static void removeTransferEncodingChunked(HttpMessage m) {, +        List<String> values = m.getHeaders(HttpHeaders.Names.TRANSFER_ENCODING);, +        values.remove(HttpHeaders.Values.CHUNKED);, +        m.setHeader(HttpHeaders.Names.TRANSFER_ENCODING, values);, +    }, +, +    static boolean isContentLengthSet(HttpMessage m) {, +        List<String> contentLength = m.getHeaders(HttpHeaders.Names.CONTENT_LENGTH);, +        return !contentLength.isEmpty();, +    }, +, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpCodecUtil.java, +    static void removeTransferEncodingChunked(HttpMessage m) {, +        List<String> values = m.getHeaders(HttpHeaders.Names.TRANSFER_ENCODING);, +        values.remove(HttpHeaders.Values.CHUNKED);, +        m.setHeader(HttpHeaders.Names.TRANSFER_ENCODING, values);, +    }, +, +    static boolean isContentLengthSet(HttpMessage m) {, +        List<String> contentLength = m.getHeaders(HttpHeaders.Names.CONTENT_LENGTH);, +        return !contentLength.isEmpty();, +    }, +, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpMessageEncoder.java, +    private boolean transferEncodingChunked;, +            boolean contentMustBeEmmpty;, +                // if Content-Length is set then the message can't be HTTP chunked, +                if (HttpCodecUtil.isContentLengthSet(m)) {, +                    contentMustBeEmmpty = false;, +                    transferEncodingChunked = false;, +                } else {, +                    contentMustBeEmmpty = true;, +                    transferEncodingChunked = true;, +            } else {, +                transferEncodingChunked = contentMustBeEmmpty = HttpCodecUtil.isTransferEncodingChunked(m);, +            }, +, +                if (contentMustBeEmmpty) {, +                            "HttpMessage.content must be empty if Transfer-Encoding is chunked.");, +            if (transferEncodingChunked) {, +                    transferEncodingChunked = false;]