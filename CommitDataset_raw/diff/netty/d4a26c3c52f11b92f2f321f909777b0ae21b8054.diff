[+++ b/codec/src/main/java/io/netty/handler/codec/StreamToMessageDecoder.java, +import io.netty.channel.ChannelInboundHandler;, +import io.netty.channel.ChannelPipeline;, +    private ChannelInboundHandlerContext<Byte> ctx;, +, +        this.ctx = ctx;, +    /**, +     * Replace this decoder in the {@link ChannelPipeline} with the given handler., +     * All remaining bytes in the inbound buffer will be forwarded to the new handler's, +     * inbound buffer., +     */, +    public void replace(String newHandlerName, ChannelInboundHandler<Byte> newHandler) {, +        if (!ctx.channel().eventLoop().inEventLoop()) {, +            throw new IllegalStateException("not in event loop");, +        }, +, +        // We do not use ChannelPipeline.replace() here so that the current context points, +        // the new handler., +        ctx.pipeline().addAfter(ctx.name(), newHandlerName, newHandler);, +, +        ChannelBuffer in = ctx.in().byteBuffer();, +        try {, +            if (in.readable()) {, +                ctx.nextIn().byteBuffer().writeBytes(ctx.in().byteBuffer());, +                ctx.fireInboundBufferUpdated();, +            }, +        } finally {, +            ctx.pipeline().remove(this);, +        }, +    }, +]