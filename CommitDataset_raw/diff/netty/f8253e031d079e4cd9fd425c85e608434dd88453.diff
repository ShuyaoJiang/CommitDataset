[+++ b/handler/src/main/java/io/netty/handler/timeout/IdleStateHandler.java, +        State state = state(ctx);, +, +        // Avoid the case where destroy() is called before scheduling timeouts., +        // See: https://github.com/netty/netty/issues/143, +        if (state.destroyed) {, +            return;, +        }, +        State state;, +, +        synchronized (ctx) {, +            state = state(ctx);, +            state.destroyed = true;, +        }, +, +    , +    private State state(ChannelHandlerContext ctx) {, +        State state;, +        synchronized (ctx) {, +            // FIXME: It could have been better if there is setAttachmentIfAbsent()., +            state = (State) ctx.getAttachment();, +            if (state != null) {, +                return state;, +            }, +            state = new State();, +            ctx.setAttachment(state);, +        }, +        return state;, +, +        volatile boolean destroyed;]