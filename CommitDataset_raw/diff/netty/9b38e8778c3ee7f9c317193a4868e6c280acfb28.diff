[+++ b/codec-http/src/main/java/io/netty/handler/codec/http/multipart/HttpPostRequestEncoder.java, +import static io.netty.buffer.Unpooled.*;, +, +                    StringBuilder replacement = new StringBuilder(, +                            139 + multipartMixedBoundary.length() * 2 +, +                                    fileUpload.getName().length() + fileUpload.getFilename().length());, +, +                    replacement.append(HttpPostBodyUtil.CONTENT_DISPOSITION);, +                    replacement.append(": ");, +                    replacement.append(HttpPostBodyUtil.FORM_DATA);, +                    replacement.append("; ");, +                    replacement.append(HttpPostBodyUtil.NAME);, +                    replacement.append("=\"");, +                    replacement.append(fileUpload.getName());, +                    replacement.append("\"\r\n");, +, +                    replacement.append(HttpHeaders.Names.CONTENT_TYPE);, +                    replacement.append(": ");, +                    replacement.append(HttpPostBodyUtil.MULTIPART_MIXED);, +                    replacement.append("; ");, +                    replacement.append(HttpHeaders.Values.BOUNDARY);, +                    replacement.append('=');, +                    replacement.append(multipartMixedBoundary);, +                    replacement.append("\r\n\r\n");, +, +                    replacement.append("--");, +                    replacement.append(multipartMixedBoundary);, +                    replacement.append("\r\n");, +                    replacement.append(HttpPostBodyUtil.CONTENT_DISPOSITION);, +                    replacement.append(": ");, +                    replacement.append(HttpPostBodyUtil.FILE);, +                    replacement.append("; ");, +                    replacement.append(HttpPostBodyUtil.FILENAME);, +                    replacement.append("=\"");, +                    replacement.append(fileUpload.getFilename());, +                    replacement.append("\"\r\n");, +, +                String lowercased = contentType.toLowerCase();, +                if (lowercased.startsWith(HttpHeaders.Values.MULTIPART_FORM_DATA) ||, +                    lowercased.startsWith(HttpHeaders.Values.APPLICATION_X_WWW_FORM_URLENCODED)) {]