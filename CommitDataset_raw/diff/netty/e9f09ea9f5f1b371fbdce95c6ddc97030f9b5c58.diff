[+++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpObjectDecoder.java, +        BAD_MESSAGE,, +        UPGRADED, +            break;, +        }, +        case UPGRADED: {, +            // Do not touch anything read - other handler will replace this codec with the upgraded protocol codec to, +            // take the trafic over., +            break;, +        HttpMessage message = this.message;, +        this.message = null;, +, +        if (!isDecodingRequest()) {, +            HttpResponse res = (HttpResponse) message;, +            if (res != null && res.getStatus().code() == 101) {, +                checkpoint(State.UPGRADED);, +                return;, +            }, +        }, +, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpObjectDecoder.java, +        BAD_MESSAGE,, +        UPGRADED, +            break;, +        }, +        case UPGRADED: {, +            // Do not touch anything read - other handler will replace this codec with the upgraded protocol codec to, +            // take the trafic over., +            break;, +        HttpMessage message = this.message;, +        this.message = null;, +, +        if (!isDecodingRequest()) {, +            HttpResponse res = (HttpResponse) message;, +            if (res != null && res.getStatus().code() == 101) {, +                checkpoint(State.UPGRADED);, +                return;, +            }, +        }, +, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketClientHandshaker.java, +]