[+++ b/src/main/java/org/jboss/netty/handler/timeout/IdleStateHandler.java, +    final long allIdleTimeMillis;, +    volatile Timeout allIdleTimeout;, +    private volatile AllIdleTimeoutTask allIdleTimeoutTask;, +            long allIdleTimeMillis) {, +             readerIdleTimeMillis, writerIdleTimeMillis, allIdleTimeMillis,, +            long readerIdleTime, long writerIdleTime, long allIdleTime,, +        allIdleTimeMillis = unit.toMillis(allIdleTime);, +        lastReadTime = System.currentTimeMillis();, +            lastWriteTime = System.currentTimeMillis();, +        lastReadTime = lastWriteTime = System.currentTimeMillis();, +        if (allIdleTimeMillis > 0) {, +            allIdleTimeout = timer.newTimeout(, +                    allIdleTimeoutTask, allIdleTimeMillis, TimeUnit.MILLISECONDS);, +        if (allIdleTimeout != null) {, +            allIdleTimeout.cancel();, +        allIdleTimeout = null;, +        allIdleTimeoutTask = null;, +    private final class AllIdleTimeoutTask implements TimerTask {, +        AllIdleTimeoutTask(ChannelHandlerContext ctx) {, +            long lastIoTime = Math.max(lastReadTime, lastWriteTime);, +            long nextDelay = allIdleTimeMillis - (currentTime - lastIoTime);, +                allIdleTimeout =, +                    timer.newTimeout(this, allIdleTimeMillis, TimeUnit.MILLISECONDS);, +                allIdleTimeout =]