[+++ b/handler/src/main/java/io/netty/handler/stream/ChunkedWriteHandler.java, +import io.netty.util.concurrent.Promise;, +            final Promise<Void> currentPromise = this.currentWrite.promise();, +                            if (future.isSuccess()) {, +                                if (!currentPromise.isDone()) {, +                                }, +                            } else {, +                                if (!currentPromise.isDone()) {, +                                    currentWrite.failAndRecycle(future.cause());, +                                }, +                            }, +, +                                if (!currentPromise.isDone()) {, +                                    // only recycle if not done before, +                                }, +                                if (!currentPromise.isDone()) {, +                                    // only recycle if not done before, +                                }]