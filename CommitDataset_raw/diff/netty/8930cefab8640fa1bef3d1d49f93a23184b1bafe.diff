[+++ b/codec/src/main/java/io/netty/handler/codec/ByteToMessageDecoder.java, +    private boolean first;, +        if (msg instanceof ByteBuf) {, +                first = cumulation == null;, +                if (first) {, +                        expandCumulation(ctx, data.readableBytes());, +                callDecode(ctx, cumulation, out);, +                if (cumulation != null && !cumulation.isReadable()) {, +                    cumulation.release();, +                    cumulation = null;, +                }, +                decodeWasNull = size == 0;, +, +        } else {, +            ctx.fireChannelRead(msg);, +        }, +    }, +, +    private void expandCumulation(ChannelHandlerContext ctx, int readable) {, +        ByteBuf oldCumulation = cumulation;, +        cumulation = ctx.alloc().buffer(oldCumulation.readableBytes() + readable);, +        cumulation.writeBytes(oldCumulation);, +        oldCumulation.release();, +        if (cumulation != null && !first) {, +            // discard some bytes if possible to make more room in the, +            // buffer, +            cumulation.discardSomeReadBytes();, +        }]