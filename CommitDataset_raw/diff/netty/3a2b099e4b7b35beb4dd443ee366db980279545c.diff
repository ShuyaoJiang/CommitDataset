[+++ b/testsuite-osgi/testsuite-osgi-deps/pom.xml, +      <!-- feature doesn't invoke maven-compile-plugin unless specified explicitly. -->, +      <plugin>, +        <artifactId>maven-compiler-plugin</artifactId>, +        <executions>, +          <execution>, +            <id>compile</id>, +            <phase>compile</phase>, +            <goals>, +              <goal>compile</goal>, +            </goals>, +          </execution>, +          <execution>, +            <id>test-compile</id>, +            <phase>test-compile</phase>, +            <goals>, +              <goal>testCompile</goal>, +            </goals>, +          </execution>, +        </executions>, +      </plugin>, +++ b/testsuite-osgi/testsuite-osgi-deps/pom.xml, +      <!-- feature doesn't invoke maven-compile-plugin unless specified explicitly. -->, +      <plugin>, +        <artifactId>maven-compiler-plugin</artifactId>, +        <executions>, +          <execution>, +            <id>compile</id>, +            <phase>compile</phase>, +            <goals>, +              <goal>compile</goal>, +            </goals>, +          </execution>, +          <execution>, +            <id>test-compile</id>, +            <phase>test-compile</phase>, +            <goals>, +              <goal>testCompile</goal>, +            </goals>, +          </execution>, +        </executions>, +      </plugin>, +++ b/testsuite-osgi/testsuite-osgi-deps/src/test/java/io/netty/verify/osgi/DependencyIT.java, +import io.netty.util.internal.StringUtil;, +import io.netty.util.internal.logging.InternalLogger;, +import io.netty.util.internal.logging.InternalLoggerFactory;, +import java.io.File;, +import java.util.regex.Matcher;, +import java.util.regex.Pattern;, +, +import static org.junit.Assert.*;, +, +    private static final InternalLogger logger = InternalLoggerFactory.getInstance(DependencyIT.class);, +, +    private static final Pattern WRAPPED_MODULE_PATTERN = Pattern.compile("wrap:mvn:io\\.netty/");, +        String text = FileUtils.readFileToString(new File(FEATURE));, +        // Ignore wrap:mvn:io.netty - it occurs when Maven didn't give the Netty modules to karaf-maven-plugin, +        // as class directories., +        Matcher matcher = WRAPPED_MODULE_PATTERN.matcher(text);, +        if (matcher.find()) {, +            text = matcher.replaceAll("mvn:io.netty/");, +            logger.info("Ignored wrap:mvn:io.netty");, +        }, +            fail(, +                    "feature.xml generated by karaf-maven-plugin contains 'wrap:' protocol; " +, +                    "some transitive dependencies are not OSGi bundles: " + StringUtil.NEWLINE +, +                    text, +            );, +            logger.info("All transitive dependencies are OSGi bundles.");]