[+++ b/transport/src/test/java/io/netty/channel/local/LocalChannelTest.java, +import io.netty.channel.SimpleChannelInboundHandler;, +    @Test, +    public void testServerCloseChannelSameEventLoop() throws Exception {, +        LocalAddress addr = new LocalAddress(LOCAL_ADDR_ID);, +        LocalEventLoopGroup group = new LocalEventLoopGroup(1);, +        final CountDownLatch latch = new CountDownLatch(1);, +        ServerBootstrap sb = new ServerBootstrap(), +                .group(group), +                .channel(LocalServerChannel.class), +                .childHandler(new SimpleChannelInboundHandler<Object>() {, +                    @Override, +                    protected void channelRead0(ChannelHandlerContext ctx, Object msg) throws Exception {, +                        ctx.close();, +                        latch.countDown();, +                    }, +                });, +        sb.bind(addr).sync();, +, +        Bootstrap b = new Bootstrap(), +                .group(group), +                .channel(LocalChannel.class), +                .handler(new SimpleChannelInboundHandler<Object>() {, +                    @Override, +                    protected void channelRead0(ChannelHandlerContext ctx, Object msg) throws Exception {, +                        // discard, +                    }, +                });, +        Channel channel = b.connect(addr).sync().channel();, +        channel.writeAndFlush(new Object());, +        latch.await();, +        group.shutdownGracefully();, +        group.terminationFuture().sync();, +    }, +]