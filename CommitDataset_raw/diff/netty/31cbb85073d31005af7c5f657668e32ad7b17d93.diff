[+++ b/handler/src/main/java/io/netty/handler/ssl/SslHandler.java, +    public ChannelFuture close(final ChannelPromise promise) {, +                    flush(ctx, promise);, +                    if (!promise.tryFailure(e)) {, +        return promise;, +            firedChannelRead = unwrap(ctx, in, startOffset, totalLength) || firedChannelRead;, +        ChannelPromise closeNotifyPromise = ctx.newPromise();, +            flush(ctx, closeNotifyPromise);, +            safeClose(ctx, closeNotifyPromise, promise);, +    private void flush(ChannelHandlerContext ctx, ChannelPromise promise) throws Exception {, +        pendingUnencryptedWrites.add(Unpooled.EMPTY_BUFFER, promise);, +        flush(ctx);, +    }, +, +        if (!flushFuture.isDone()) {, +        } else {, +            timeoutFuture = null;, +        }]