[+++ b/codec/src/main/java/io/netty/handler/codec/xml/XmlFrameDecoder.java, +        boolean inCDATASection = false;, +            } else if (!inCDATASection && readByte == '<') {, +                    } else if (peekAheadByte == '!') {, +                        if (isCommentBlockStart(in, i)) {, +                        } else if (isCDATABlockStart(in, i)) {, +                            // <![CDATA[ start found, +                            openBracketsCount++;, +                            inCDATASection = true;, +                        }, +            } else if (!inCDATASection && readByte == '/') {, +                    if (!inCDATASection) {, +                    } else if (peekBehindByte == ']' && i - 2 > -1 && in.getByte(i - 2) == ']') {, +                        // a <![CDATA[...]]> block was closed, +                        openBracketsCount--;, +                        inCDATASection = false;, +                    }, +            if (length >= bufferLength) {, +, +    private static boolean isCommentBlockStart(final ByteBuf in, final int i) {, +        return i < in.writerIndex() - 3, +                && in.getByte(i + 2) == '-', +                && in.getByte(i + 3) == '-';, +    }, +, +    private static boolean isCDATABlockStart(final ByteBuf in, final int i) {, +        return i < in.writerIndex() - 8, +                && in.getByte(i + 2) == '[', +                && in.getByte(i + 3) == 'C', +                && in.getByte(i + 4) == 'D', +                && in.getByte(i + 5) == 'A', +                && in.getByte(i + 6) == 'T', +                && in.getByte(i + 7) == 'A', +                && in.getByte(i + 8) == '[';, +    }, +, +++ b/codec/src/main/java/io/netty/handler/codec/xml/XmlFrameDecoder.java, +        boolean inCDATASection = false;, +            } else if (!inCDATASection && readByte == '<') {, +                    } else if (peekAheadByte == '!') {, +                        if (isCommentBlockStart(in, i)) {, +                        } else if (isCDATABlockStart(in, i)) {, +                            // <![CDATA[ start found, +                            openBracketsCount++;, +                            inCDATASection = true;, +                        }, +            } else if (!inCDATASection && readByte == '/') {, +                    if (!inCDATASection) {, +                    } else if (peekBehindByte == ']' && i - 2 > -1 && in.getByte(i - 2) == ']') {, +                        // a <![CDATA[...]]> block was closed, +                        openBracketsCount--;, +                        inCDATASection = false;, +                    }, +            if (length >= bufferLength) {, +, +    private static boolean isCommentBlockStart(final ByteBuf in, final int i) {, +        return i < in.writerIndex() - 3, +                && in.getByte(i + 2) == '-', +                && in.getByte(i + 3) == '-';, +    }, +, +    private static boolean isCDATABlockStart(final ByteBuf in, final int i) {, +        return i < in.writerIndex() - 8, +                && in.getByte(i + 2) == '[', +                && in.getByte(i + 3) == 'C', +                && in.getByte(i + 4) == 'D', +                && in.getByte(i + 5) == 'A', +                && in.getByte(i + 6) == 'T', +                && in.getByte(i + 7) == 'A', +                && in.getByte(i + 8) == '[';, +    }, +, +++ b/codec/src/test/java/io/netty/handler/codec/xml/XmlFrameDecoderTest.java, +        xmlSamples = Arrays.asList(, +                sample("01"), sample("02"), sample("03"),, +                sample("04"), sample("05"), sample("06"), +        );, +    public void testDecodeWithCDATABlock() {, +        final String xml = "<book>" +, +                "<![CDATA[K&R, a.k.a. Kernighan & Ritchie]]>" +, +                "</book>";, +        testDecodeWithXml(xml, xml);, +    }, +, +    @Test, +    public void testDecodeWithCDATABlockContainingNestedUnbalancedXml() {, +        // <br> isn't closed, also <a> should have been </a>, +        final String xml = "<info>" +, +                "<![CDATA[Copyright 2012-2013,<br><a href=\"http://www.acme.com\">ACME Inc.<a>]]>" +, +                "</info>";, +        testDecodeWithXml(xml, xml);, +    }, +, +    @Test, +        final String input = "<root xmlns=\"http://www.acme.com/acme\" status=\"loginok\" " +, +                "timestamp=\"1362410583776\"/>\n\n" +, +                "msgnr=\"2\"/>\n</root>";, +        final String frame1 = "<root xmlns=\"http://www.acme.com/acme\" status=\"loginok\" " +, +                "timestamp=\"1362410583776\"/>";, +        final String frame2 = "<root xmlns=\"http://www.acme.com/acme\" status=\"start\" time=\"0\" " +]