[+++ b/codec-http/src/main/java/io/netty/handler/codec/http/multipart/HttpPostRequestEncoder.java, +                InternalAttribute internal = new InternalAttribute(charset);, +            InternalAttribute internal = new InternalAttribute(charset);, +            InternalAttribute internal = new InternalAttribute(charset);, +                    internal = new InternalAttribute(charset);, +                InternalAttribute internal = new InternalAttribute(charset);, +            buffer = ((InternalAttribute) currentData).toByteBuf();, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/multipart/HttpPostRequestEncoder.java, +                InternalAttribute internal = new InternalAttribute(charset);, +            InternalAttribute internal = new InternalAttribute(charset);, +            InternalAttribute internal = new InternalAttribute(charset);, +                    internal = new InternalAttribute(charset);, +                InternalAttribute internal = new InternalAttribute(charset);, +            buffer = ((InternalAttribute) currentData).toByteBuf();, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/multipart/InternalAttribute.java, +import io.netty.buffer.ByteBuf;, +import io.netty.buffer.Unpooled;, +, +import java.nio.charset.Charset;, +    private final List<ByteBuf> value = new ArrayList<ByteBuf>();, +    private final Charset charset;, +    private int size;, +    public InternalAttribute(Charset charset) {, +        this.charset = charset;, +    }, +        ByteBuf buf = Unpooled.copiedBuffer(value, charset);, +        this.value.add(buf);, +        size += buf.readableBytes();, +        ByteBuf buf = Unpooled.copiedBuffer(value, charset);, +        this.value.add(rank, buf);, +        size += buf.readableBytes();, +        ByteBuf buf = Unpooled.copiedBuffer(value, charset);, +        ByteBuf old = this.value.set(rank, buf);, +        if (old != null) {, +            size -= old.readableBytes();, +        }, +        size += buf.readableBytes();, +        for (ByteBuf elt : value) {, +            result.append(elt.toString(charset));, +    public int size() {, +        return size;, +    }, +, +    public ByteBuf toByteBuf() {, +        return Unpooled.compositeBuffer().addComponents(value).writerIndex(size()).readerIndex(0);, +    }, +]