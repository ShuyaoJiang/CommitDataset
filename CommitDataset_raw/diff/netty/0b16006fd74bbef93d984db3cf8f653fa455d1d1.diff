[+++ b/src/main/java/org/jboss/netty/example/factorial/BigIntegerDecoder.java, +import org.jboss.netty.handler.codec.frame.CorruptedFrameException;, + * Decodes the binary representation of a {@link BigInteger} prepended, + * with a magic number ('F' or 0x46) and a 32-bit integer length prefix into a, + * {@link BigInteger} instance.  For example, { 'F', 0, 0, 0, 1, 42 } will be, + * decoded into new BigInteger("42")., +        if (buffer.readableBytes() < 5) {, +        buffer.markReaderIndex();, +, +        // Check the magic number., +        int magicNumber = buffer.readUnsignedByte();, +        if (magicNumber != 'F') {, +            buffer.resetReaderIndex();, +            throw new CorruptedFrameException(, +                    "Invalid magic number: " + magicNumber);, +        }, +        int dataLength = buffer.readInt();, +        if (buffer.readableBytes() < dataLength) {, +            buffer.resetReaderIndex();, +++ b/src/main/java/org/jboss/netty/example/factorial/BigIntegerDecoder.java, +import org.jboss.netty.handler.codec.frame.CorruptedFrameException;, + * Decodes the binary representation of a {@link BigInteger} prepended, + * with a magic number ('F' or 0x46) and a 32-bit integer length prefix into a, + * {@link BigInteger} instance.  For example, { 'F', 0, 0, 0, 1, 42 } will be, + * decoded into new BigInteger("42")., +        if (buffer.readableBytes() < 5) {, +        buffer.markReaderIndex();, +, +        // Check the magic number., +        int magicNumber = buffer.readUnsignedByte();, +        if (magicNumber != 'F') {, +            buffer.resetReaderIndex();, +            throw new CorruptedFrameException(, +                    "Invalid magic number: " + magicNumber);, +        }, +        int dataLength = buffer.readInt();, +        if (buffer.readableBytes() < dataLength) {, +            buffer.resetReaderIndex();, +++ b/src/main/java/org/jboss/netty/example/factorial/NumberEncoder.java, + * Encodes a {@link Number} into the binary representation prepended with, + * a magic number ('F' or 0x46) and a 32-bit length prefix.  For example, 42, + * will be encoded to { 'F', 0, 0, 0, 1, 42 }., +        // Construct a message., +        buf.writeByte((byte) 'F'); // magic number, +        buf.writeInt(dataLength);  // data length, +        buf.writeBytes(data);      // data]