[+++ b/transport/src/test/java/io/netty/channel/ChannelInitializerTest.java, +import io.netty.channel.embedded.EmbeddedChannel;, +import java.util.concurrent.atomic.AtomicBoolean;, +import static org.junit.Assert.assertTrue;, +    @Test, +    public void testAddFirstChannelInitializer() {, +        testAddChannelInitializer(true);, +    }, +, +    @Test, +    public void testAddLastChannelInitializer() {, +        testAddChannelInitializer(false);, +    }, +, +    private static void testAddChannelInitializer(final boolean first) {, +        final AtomicBoolean called = new AtomicBoolean();, +        EmbeddedChannel channel = new EmbeddedChannel(new ChannelInitializer<Channel>() {, +            @Override, +            protected void initChannel(Channel ch) throws Exception {, +                ChannelHandler handler = new ChannelInitializer<Channel>() {, +                    @Override, +                    protected void initChannel(Channel ch) throws Exception {, +                        called.set(true);, +                    }, +                };, +                if (first) {, +                    ch.pipeline().addFirst(handler);, +                } else {, +                    ch.pipeline().addLast(handler);, +                }, +            }, +        });, +        channel.finish();, +        assertTrue(called.get());, +    }, +]