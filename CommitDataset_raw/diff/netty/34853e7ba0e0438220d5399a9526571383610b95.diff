[+++ b/transport/src/main/java/io/netty/channel/nio/NioEventLoop.java, +    private static final int SELECTOR_AUTO_REBUILD_THRESHOLD;, +        int selectorAutoRebuildThreshold = SystemPropertyUtil.getInt("io.netty.selectorAutoRebuildThreshold", 16);, +        if (selectorAutoRebuildThreshold < 2) {, +            selectorAutoRebuildThreshold = 0;, +        }, +, +        SELECTOR_AUTO_REBUILD_THRESHOLD = selectorAutoRebuildThreshold;, +, +    private boolean oldWakenUp;, +    @Override, +    protected boolean hasTasks() {, +        // ConcurrentLinkedQueue.isEmpty() is not accurate enough when tasks are added from different threads., +        return peekTask() != null;, +    }, +, +            oldWakenUp = wakenUp.getAndSet(false);, +                    if (oldWakenUp || wakenUp.get() || hasTasks()) {, +, +                logger.debug(CancelledKeyException.class.getSimpleName() + " raised by a Selector - JDK bug?", e);, +        if (prematureSelectorReturns > 1) {]