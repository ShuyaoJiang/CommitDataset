[+++ b/src/main/java/org/jboss/netty/handler/codec/http/DefaultHttpMessage.java, +, +        // 0 - the previous character was neither CR nor LF, +        // 1 - the previous character was CR, +        // 2 - the previous character was LF, +        int state = 0;, +, +, +            // Check the absolutely prohibited characters., +            case '\f':, +                throw new IllegalArgumentException(, +                        "value contains a prohibited character '\\f': " + value);, +                        "value contains a prohibited character '\\v': " + value);, +, +            // Check the CRLF (HT | SP) pattern, +            switch (state) {, +            case 0:, +                switch (c) {, +                case '\r':, +                    state = 1;, +                    break;, +                case '\n':, +                    state = 2;, +                    break;, +                }, +                break;, +            case 1:, +                switch (c) {, +                case '\n':, +                    state = 2;, +                    break;, +                default:, +                    throw new IllegalArgumentException(, +                            "Only '\\n' is allowed after '\\r': " + value);, +                }, +                break;, +            case 2:, +                switch (c) {, +                case ' ': case '\t':, +                    state = 0;, +                    break;, +                default:, +                    throw new IllegalArgumentException(, +                            "Only ' ' and '\\t' are allowed after '\\n': " + value);, +                }, +            }, +        }, +, +        if (state != 0) {, +            throw new IllegalArgumentException(, +                    "value must not end with '\\r' or '\\n':" + value);]