[+++ b/common/src/main/java/io/netty/util/Recycler.java, +        private final AtomicInteger availableSharedCapacity;, +, +            // Its important that we not store the Stack itself in the WeakOrderQueue as the Stack also is used in, +            // the WeakHashMap as key. So just store the enclosed AtomicInteger which should allow to have the, +            // Stack itself GCed., +            availableSharedCapacity = stack.availableSharedCapacity;, +, +            boolean reserved = reserveSpace(LINK_CAPACITY);, +        private boolean reserveSpace(int space) {, +            assert space >= 0;, +            for (;;) {, +                int available = availableSharedCapacity.get();, +                if (available < space) {, +                    return false;, +                }, +                if (availableSharedCapacity.compareAndSet(available, available - space)) {, +                    return true;, +                }, +            }, +        }, +, +        private void reclaimSpace(int space) {, +            assert space >= 0;, +            availableSharedCapacity.addAndGet(space);, +        }, +, +                if (!reserveSpace(LINK_CAPACITY)) {, +                    reclaimSpace(LINK_CAPACITY);, +        final AtomicInteger availableSharedCapacity;]