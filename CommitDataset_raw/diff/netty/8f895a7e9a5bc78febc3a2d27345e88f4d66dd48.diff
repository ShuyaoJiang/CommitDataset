[+++ b/common/src/main/java/io/netty/util/internal/TypeParameterMatcher.java, +import java.util.ArrayList;, +import java.util.Collections;, +import java.util.List;, +                    if (types.length - 1 < typeParamIndex) {, +                        List<Type> typeList = new ArrayList<Type>(types.length);, +                        Collections.addAll(typeList, types);, +                                "invalid typeParamIndex: " + typeParamIndex + " (typeParams: " + typeList + ')');, +                    Type t = types[typeParamIndex];, +                    Class<?> messageType;, +                    if (t instanceof Class) {, +                        messageType = (Class<?>) t;, +                    } else if (t instanceof ParameterizedType) {, +                        messageType = (Class<?>) ((ParameterizedType) t).getRawType();, +                    } else {, +                        throw new IllegalStateException(, +                                "cannot determine the type of the type parameter of " +, +                                thisClass.getSimpleName() + ": " + t);, +                    }, +]