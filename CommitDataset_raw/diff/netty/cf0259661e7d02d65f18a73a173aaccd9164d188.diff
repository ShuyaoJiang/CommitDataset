[+++ b/transport/src/main/java/io/netty/channel/AbstractChannel.java, +    protected void doPreClose() throws Exception {, +        // NOOP by default, +    }, +, +    private final class CloseFuture extends DefaultChannelFuture implements ChannelFuture.Unsafe {, +            try {, +                doPreClose();, +            } catch (Exception e) {, +                logger.warn("doPreClose() raised an exception.", e);, +            }, +++ b/transport/src/main/java/io/netty/channel/AbstractChannel.java, +    protected void doPreClose() throws Exception {, +        // NOOP by default, +    }, +, +    private final class CloseFuture extends DefaultChannelFuture implements ChannelFuture.Unsafe {, +            try {, +                doPreClose();, +            } catch (Exception e) {, +                logger.warn("doPreClose() raised an exception.", e);, +            }, +++ b/transport/src/main/java/io/netty/channel/local/LocalChannel.java, +import io.netty.channel.ChannelBufferType;, +    protected void doPreClose() throws Exception {, +        // Update all internal state before the closeFuture is notified., +    }, +, +    @Override, +    protected void doClose() throws Exception {, +++ b/transport/src/main/java/io/netty/channel/AbstractChannel.java, +    protected void doPreClose() throws Exception {, +        // NOOP by default, +    }, +, +    private final class CloseFuture extends DefaultChannelFuture implements ChannelFuture.Unsafe {, +            try {, +                doPreClose();, +            } catch (Exception e) {, +                logger.warn("doPreClose() raised an exception.", e);, +            }, +++ b/transport/src/main/java/io/netty/channel/local/LocalChannel.java, +import io.netty.channel.ChannelBufferType;, +    protected void doPreClose() throws Exception {, +        // Update all internal state before the closeFuture is notified., +    }, +, +    @Override, +    protected void doClose() throws Exception {, +++ b/transport/src/main/java/io/netty/channel/local/LocalServerChannel.java, +    protected void doPreClose() throws Exception {, +        // Update all internal state before the closeFuture is notified., +    protected void doClose() throws Exception {, +        // All internal state was updated already at doPreClose()., +    }, +, +    @Override]