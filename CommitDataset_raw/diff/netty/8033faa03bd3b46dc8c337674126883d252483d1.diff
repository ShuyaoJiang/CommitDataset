[+++ b/handler/src/test/java/io/netty/handler/ssl/SniHandlerTest.java, +import io.netty.channel.ChannelInboundHandlerAdapter;, +import javax.net.ssl.HandshakeCompletedEvent;, +        final CountDownLatch serverApnDoneLatch = new CountDownLatch(1);, +        final CountDownLatch clientApnDoneLatch = new CountDownLatch(1);, +                    // Server side SNI., +                    // Catch the notification event that APN has completed successfully., +                            serverApnDoneLatch.countDown();, +                    // Simulate client side SNI (which is currently not supported)., +                    // Add a SslHandler so we can do the client side of the handshake., +                    // Catch the notification event that APN has completed successfully., +                    ch.pipeline().addLast(new ApplicationProtocolNegotiationHandler("foo") {, +                        @Override, +                        protected void configurePipeline(ChannelHandlerContext ctx, String protocol) throws Exception {, +                            clientApnDoneLatch.countDown();, +                        }, +                    });, +            assertTrue(serverApnDoneLatch.await(5, TimeUnit.SECONDS));, +            assertTrue(clientApnDoneLatch.await(5, TimeUnit.SECONDS));]