[+++ b/transport/src/test/java/io/netty/channel/CoalescingBufferQueueTest.java, +import io.netty.util.CharsetUtil;, +        cat = Unpooled.wrappedBuffer("cat".getBytes(CharsetUtil.US_ASCII));, +        mouse = Unpooled.wrappedBuffer("mouse".getBytes(CharsetUtil.US_ASCII));, +        assertEquals("catmouse", dequeue(8, aggregatePromise));, +        assertEquals("catm", dequeue(4, newPromise()));, +        assertEquals("ouse", dequeue(4, newPromise()));, +        assertEquals("catm", dequeue(4, aggregatePromise));, +        assertEquals("ouse", dequeue(Integer.MAX_VALUE, aggregatePromise));, +        assertEquals("", dequeue(Integer.MAX_VALUE, aggregatePromise));, +        assertEquals("", dequeue(Integer.MAX_VALUE, aggregatePromise));, +        ByteBuf empty = Unpooled.buffer(0, 1);, +        assertEquals("cat", dequeue(3, aggregatePromise));, +        assertEquals("catmouse", dequeue(8, aggregatePromise));, +, +    private String dequeue(int numBytes, ChannelPromise aggregatePromise) {, +        ByteBuf removed = writeQueue.remove(numBytes, aggregatePromise);, +        String result = removed.toString(CharsetUtil.US_ASCII);, +        ReferenceCountUtil.safeRelease(removed);, +        return result;, +    }]