[+++ b/codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2ConnectionEncoder.java, +                    //, +                    // This just sets internal stream state which is used elsewhere in the codec and doesn't, +                    // necessarily mean the write will complete successfully., +, +                    if (!future.isSuccess()) {, +                        // Either the future is not done or failed in the meantime., +                        notifyLifecycleManagerOnError(future, ctx);, +                    }, +                // This just sets internal stream state which is used elsewhere in the codec and doesn't, +                // necessarily mean the write will complete successfully., +, +                if (!future.isSuccess()) {, +                    // Either the future is not done or failed in the meantime., +                    notifyLifecycleManagerOnError(future, ctx);, +                }, +    private void notifyLifecycleManagerOnError(ChannelFuture future, final ChannelHandlerContext ctx) {, +        future.addListener(new ChannelFutureListener() {, +            @Override, +            public void operationComplete(ChannelFuture future) throws Exception {, +                Throwable cause = future.cause();, +                if (cause != null) {, +                    lifecycleManager.onError(ctx, true, cause);, +                }, +            }, +        });, +    }, +, +                // This just sets internal stream state which is used elsewhere in the codec and doesn't, +                // necessarily mean the write will complete successfully.]