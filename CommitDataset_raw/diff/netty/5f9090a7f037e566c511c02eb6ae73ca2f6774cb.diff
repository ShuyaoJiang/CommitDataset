[+++ b/buffer/src/main/java/io/netty/buffer/DefaultCompositeByteBuf.java, +import java.util.ArrayDeque;, +import java.util.Queue;, +    private Queue<UnsafeByteBuf> suspendedDeallocations;, +    private final class Component {, +            if (suspendedDeallocations == null) {, +                buf.free(); // We should not get a NPE here. If so, it must be a bug., +            } else {, +                suspendedDeallocations.add(buf);, +            }, +        }, +    }, +    @Override, +        resumeIntermediaryDeallocations();, +    public void suspendIntermediaryDeallocations() {, +        if (suspendedDeallocations == null) {, +            suspendedDeallocations = new ArrayDeque<UnsafeByteBuf>(2);, +        }, +    }, +, +    @Override, +    public void resumeIntermediaryDeallocations() {, +        if (suspendedDeallocations == null) {, +            return;, +        }, +, +        Queue<UnsafeByteBuf> suspendedDeallocations = this.suspendedDeallocations;, +        this.suspendedDeallocations = null;, +, +        for (UnsafeByteBuf buf: suspendedDeallocations) {, +            buf.free();, +        }, +    }, +, +    @Override, +++ b/buffer/src/main/java/io/netty/buffer/DefaultCompositeByteBuf.java, +import java.util.ArrayDeque;, +import java.util.Queue;, +    private Queue<UnsafeByteBuf> suspendedDeallocations;, +    private final class Component {, +            if (suspendedDeallocations == null) {, +                buf.free(); // We should not get a NPE here. If so, it must be a bug., +            } else {, +                suspendedDeallocations.add(buf);, +            }, +        }, +    }, +    @Override, +        resumeIntermediaryDeallocations();, +    public void suspendIntermediaryDeallocations() {, +        if (suspendedDeallocations == null) {, +            suspendedDeallocations = new ArrayDeque<UnsafeByteBuf>(2);, +        }, +    }, +, +    @Override, +    public void resumeIntermediaryDeallocations() {, +        if (suspendedDeallocations == null) {, +            return;, +        }, +, +        Queue<UnsafeByteBuf> suspendedDeallocations = this.suspendedDeallocations;, +        this.suspendedDeallocations = null;, +, +        for (UnsafeByteBuf buf: suspendedDeallocations) {, +            buf.free();, +        }, +    }, +, +    @Override, +++ b/buffer/src/main/java/io/netty/buffer/DuplicatedByteBuf.java, +    public void free() { }, +    @Override, +    public void suspendIntermediaryDeallocations() { }, +, +    @Override, +    public void resumeIntermediaryDeallocations() { }, +++ b/buffer/src/main/java/io/netty/buffer/DefaultCompositeByteBuf.java, +import java.util.ArrayDeque;, +import java.util.Queue;, +    private Queue<UnsafeByteBuf> suspendedDeallocations;, +    private final class Component {, +            if (suspendedDeallocations == null) {, +                buf.free(); // We should not get a NPE here. If so, it must be a bug., +            } else {, +                suspendedDeallocations.add(buf);, +            }, +        }, +    }, +    @Override, +        resumeIntermediaryDeallocations();, +    public void suspendIntermediaryDeallocations() {, +        if (suspendedDeallocations == null) {, +            suspendedDeallocations = new ArrayDeque<UnsafeByteBuf>(2);, +        }, +    }, +, +    @Override, +    public void resumeIntermediaryDeallocations() {, +        if (suspendedDeallocations == null) {]