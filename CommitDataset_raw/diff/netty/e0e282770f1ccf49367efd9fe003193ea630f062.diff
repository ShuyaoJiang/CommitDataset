[+++ b/src/main/java/org/jboss/netty/channel/DefaultChannelPipeline.java, +    private final class DefaultChannelHandlerContext implements ChannelHandlerContext {, +++ b/src/main/java/org/jboss/netty/channel/DefaultChannelPipeline.java, +    private final class DefaultChannelHandlerContext implements ChannelHandlerContext {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +    private final class Boss implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/DefaultChannelPipeline.java, +    private final class DefaultChannelHandlerContext implements ChannelHandlerContext {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +    private final class Boss implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioProviderMetadata.java, +    private static final class ConstraintLevelAutodetector {, +    private static final class SelectorLoop implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/DefaultChannelPipeline.java, +    private final class DefaultChannelHandlerContext implements ChannelHandlerContext {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +    private final class Boss implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioProviderMetadata.java, +    private static final class ConstraintLevelAutodetector {, +    private static final class SelectorLoop implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioServerSocketPipelineSink.java, +    private final class Boss implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/DefaultChannelPipeline.java, +    private final class DefaultChannelHandlerContext implements ChannelHandlerContext {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +    private final class Boss implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioProviderMetadata.java, +    private static final class ConstraintLevelAutodetector {, +    private static final class SelectorLoop implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioServerSocketPipelineSink.java, +    private final class Boss implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioSocketChannel.java, +    final Queue<MessageEvent> writeBuffer = new WriteBuffer();, +    private final class WriteBuffer extends LinkedTransferQueue<MessageEvent> {, +        WriteBuffer() {, +            super();, +        }, +, +        @Override, +        public boolean offer(MessageEvent e) {, +            boolean success = super.offer(e);, +            assert success;, +            writeBufferSize.addAndGet(, +                    ((ChannelBuffer) e.getMessage()).readableBytes());, +            return true;, +        }, +, +        @Override, +        public MessageEvent poll() {, +            MessageEvent e = super.poll();, +            if (e != null) {, +                int newWriteBufferSize = writeBufferSize.addAndGet(, +                        -((ChannelBuffer) e.getMessage()).readableBytes());, +                if (newWriteBufferSize <= getConfig().getWriteBufferLowWaterMark()) {, +                    mightNeedToNotifyUnwritability = true;, +                }, +            }, +            return e;, +        }, +    }, +, +    private final class WriteTask implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/DefaultChannelPipeline.java, +    private final class DefaultChannelHandlerContext implements ChannelHandlerContext {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioClientSocketPipelineSink.java, +    private final class Boss implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioProviderMetadata.java, +    private static final class ConstraintLevelAutodetector {, +    private static final class SelectorLoop implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioServerSocketPipelineSink.java, +    private final class Boss implements Runnable {, +++ b/src/main/java/org/jboss/netty/channel/socket/nio/NioSocketChannel.java, +    final Queue<MessageEvent> writeBuffer = new WriteBuffer();, +    private final class WriteBuffer extends LinkedTransferQueue<MessageEvent> {, +        WriteBuffer() {, +            super();, +        }, +, +        @Override, +        public boolean offer(MessageEvent e) {, +            boolean success = super.offer(e);, +            assert success;, +            writeBufferSize.addAndGet(, +                    ((ChannelBuffer) e.getMessage()).readableBytes());, +            return true;, +        }, +, +        @Override, +        public MessageEvent poll() {, +            MessageEvent e = super.poll();, +            if (e != null) {, +                int newWriteBufferSize = writeBufferSize.addAndGet(, +                        -((ChannelBuffer) e.getMessage()).readableBytes());, +                if (newWriteBufferSize <= getConfig().getWriteBufferLowWaterMark()) {, +                    mightNeedToNotifyUnwritability = true;, +                }, +            }, +            return e;, +        }, +    }]