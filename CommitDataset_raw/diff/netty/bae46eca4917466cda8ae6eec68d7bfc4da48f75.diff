[+++ b/src/main/java/org/jboss/netty/handler/codec/frame/DelimiterBasedFrameDecoder.java, +import org.jboss.netty.channel.Channels;, +    private int tooLongFrameLength;, +                // Go back to the initial state., +, +                // TODO Let user choose when the exception should be raised - early or late?, +                //      If early, fail() should be called when discardingTooLongFrame is set to true., +                int tooLongFrameLength = this.tooLongFrameLength;, +                this.tooLongFrameLength = 0;, +                fail(ctx, tooLongFrameLength);, +                return null;, +                fail(ctx, minFrameLength);, +                return null;, +            if (!discardingTooLongFrame) {, +            } else {, +                // Still discarding the buffer since a delimiter is not found., +                tooLongFrameLength += buffer.readableBytes();, +                buffer.skipBytes(buffer.readableBytes());, +            }, +    private void fail(ChannelHandlerContext ctx, long frameLength) {, +        if (frameLength > 0) {, +            Channels.fireExceptionCaught(, +                    ctx.getChannel(),, +                    new TooLongFrameException(, +                            "The frame length exceeds " + maxFrameLength +, +                            ": " + frameLength + " - discarded"));, +        } else {, +            Channels.fireExceptionCaught(, +                    ctx.getChannel(),, +                    new TooLongFrameException(, +                            "The frame length exceeds " + maxFrameLength +, +                            " - discarding"));, +        }]