[+++ b/buffer/src/main/java/io/netty/buffer/DefaultCompositeByteBuf.java, +        addComponent0(components.size(), buffer);, +        addComponent0(cIndex, buffer);, +    private int addComponent0(int cIndex, ByteBuf buffer) {, +        Component c = new Component(buffer.order(ByteOrder.BIG_ENDIAN).slice());, +                cIndex = addComponent0(cIndex, b) + 1;, +            Component c = new Component(consolidated);, +                addComponent0(0, padding);, +                addComponent0(components.size(), padding);, +                Component newC = new Component(c.buf.slice(0, c.length - bytesToTrim));, +        components.add(new Component(consolidated));, +        components.set(cIndex, new Component(consolidated));, +            Component newC = new Component(c.buf.slice(adjustment, c.length - adjustment));, +        Component(ByteBuf buf) {, +++ b/buffer/src/main/java/io/netty/buffer/DefaultCompositeByteBuf.java, +        addComponent0(components.size(), buffer);, +        addComponent0(cIndex, buffer);, +    private int addComponent0(int cIndex, ByteBuf buffer) {, +        Component c = new Component(buffer.order(ByteOrder.BIG_ENDIAN).slice());, +                cIndex = addComponent0(cIndex, b) + 1;, +            Component c = new Component(consolidated);, +                addComponent0(0, padding);, +                addComponent0(components.size(), padding);, +                Component newC = new Component(c.buf.slice(0, c.length - bytesToTrim));, +        components.add(new Component(consolidated));, +        components.set(cIndex, new Component(consolidated));, +            Component newC = new Component(c.buf.slice(adjustment, c.length - adjustment));, +        Component(ByteBuf buf) {, +++ b/buffer/src/main/java/io/netty/buffer/DefaultMessageBuf.java, +        int head = this.head;, +        int tail = this.tail;, +        if (head != tail) {, +            this.head = this.tail = 0;, +            final int mask = elements.length - 1;, +            int i = head;, +            do {, +                BufUtil.release(elements[i]);, +                elements[i] = null;, +                i = i + 1 & mask;, +            } while (i != tail);, +        }, +, +        this.head = 0;, +        this.tail = 0;, +++ b/buffer/src/main/java/io/netty/buffer/DefaultCompositeByteBuf.java, +        addComponent0(components.size(), buffer);, +        addComponent0(cIndex, buffer);, +    private int addComponent0(int cIndex, ByteBuf buffer) {, +        Component c = new Component(buffer.order(ByteOrder.BIG_ENDIAN).slice());, +                cIndex = addComponent0(cIndex, b) + 1;, +            Component c = new Component(consolidated);, +                addComponent0(0, padding);, +                addComponent0(components.size(), padding);, +                Component newC = new Component(c.buf.slice(0, c.length - bytesToTrim));, +        components.add(new Component(consolidated));, +        components.set(cIndex, new Component(consolidated));, +            Component newC = new Component(c.buf.slice(adjustment, c.length - adjustment));, +        Component(ByteBuf buf) {, +++ b/buffer/src/main/java/io/netty/buffer/DefaultMessageBuf.java, +        int head = this.head;, +        int tail = this.tail;, +        if (head != tail) {, +            this.head = this.tail = 0;, +            final int mask = elements.length - 1;, +            int i = head;, +            do {, +                BufUtil.release(elements[i]);, +                elements[i] = null;, +                i = i + 1 & mask;, +            } while (i != tail);, +        }, +, +        this.head = 0;, +        this.tail = 0;, +++ b/buffer/src/main/java/io/netty/buffer/QueueBackedMessageBuf.java, +        for (T e: queue) {, +            BufUtil.release(e);, +        }, +++ b/buffer/src/main/java/io/netty/buffer/DefaultCompositeByteBuf.java, +        addComponent0(components.size(), buffer);, +        addComponent0(cIndex, buffer);, +    private int addComponent0(int cIndex, ByteBuf buffer) {, +        Component c = new Component(buffer.order(ByteOrder.BIG_ENDIAN).slice());, +                cIndex = addComponent0(cIndex, b) + 1;, +            Component c = new Component(consolidated);, +                addComponent0(0, padding);, +                addComponent0(components.size(), padding);, +                Component newC = new Component(c.buf.slice(0, c.length - bytesToTrim));, +        components.add(new Component(consolidated));, +        components.set(cIndex, new Component(consolidated));, +            Component newC = new Component(c.buf.slice(adjustment, c.length - adjustment));, +        Component(ByteBuf buf) {, +++ b/buffer/src/main/java/io/netty/buffer/DefaultMessageBuf.java, +        int head = this.head;, +        int tail = this.tail;, +        if (head != tail) {, +            this.head = this.tail = 0;, +            final int mask = elements.length - 1;, +            int i = head;, +            do {]