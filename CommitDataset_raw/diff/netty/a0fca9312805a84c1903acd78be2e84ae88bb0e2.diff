[+++ b/codec/src/main/java/io/netty/handler/codec/MessageToMessageEncoder.java, +import io.netty.channel.ChannelHandlerUtil;, +            Object encoded = encode(ctx, msg);, +            // Handle special case when the encoded output is a ByteBuf and the next handler in the pipeline, +            // accept bytes. Related to #1222, +            ChannelHandlerUtil.addToNextOutboundBuffer(ctx, encoded);, +]