[+++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpClientCodec.java, +import io.netty.util.ReferenceCountUtil;, +     * Prepares to upgrade to another protocol from HTTP. Disables the {@link Encoder}., +     */, +    @Override, +    public void prepareUpgradeFrom(ChannelHandlerContext ctx) {, +        ((Encoder) outboundHandler()).upgraded = true;, +    }, +, +    /**, +        boolean upgraded;, +, +, +            if (upgraded) {, +                out.add(ReferenceCountUtil.retain(msg));, +                return;, +            }, +, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpClientCodec.java, +import io.netty.util.ReferenceCountUtil;, +     * Prepares to upgrade to another protocol from HTTP. Disables the {@link Encoder}., +     */, +    @Override, +    public void prepareUpgradeFrom(ChannelHandlerContext ctx) {, +        ((Encoder) outboundHandler()).upgraded = true;, +    }, +, +    /**, +        boolean upgraded;, +, +, +            if (upgraded) {, +                out.add(ReferenceCountUtil.retain(msg));, +                return;, +            }, +, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpClientUpgradeHandler.java, +, +        /**, +         * Removes or disables the encoder of this codec so that the {@link UpgradeCodec} can send an initial greeting, +         * (if any)., +         */, +        void prepareUpgradeFrom(ChannelHandlerContext ctx);, +, +            sourceCodec.prepareUpgradeFrom(ctx);, +            sourceCodec.upgradeFrom(ctx);, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpClientCodec.java, +import io.netty.util.ReferenceCountUtil;, +     * Prepares to upgrade to another protocol from HTTP. Disables the {@link Encoder}., +     */, +    @Override, +    public void prepareUpgradeFrom(ChannelHandlerContext ctx) {, +        ((Encoder) outboundHandler()).upgraded = true;, +    }, +, +    /**, +        boolean upgraded;, +, +, +            if (upgraded) {, +                out.add(ReferenceCountUtil.retain(msg));, +                return;, +            }, +, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpClientUpgradeHandler.java, +, +        /**, +         * Removes or disables the encoder of this codec so that the {@link UpgradeCodec} can send an initial greeting, +         * (if any)., +         */, +        void prepareUpgradeFrom(ChannelHandlerContext ctx);, +, +            sourceCodec.prepareUpgradeFrom(ctx);, +            sourceCodec.upgradeFrom(ctx);, +++ b/codec-http2/src/main/java/io/netty/handler/codec/http2/Http2ConnectionHandler.java, +                        logger.debug("{} Sent GOAWAY: lastStreamId '{}', errorCode '{}', " +, +                                     "debugData '{}'. Forcing shutdown of the connection.",, +                                     ctx.channel(), lastStreamId, errorCode, debugData.toString(UTF_8), future.cause());, +                    logger.error("{} Sending GOAWAY failed: lastStreamId '{}', errorCode '{}', " +, +                                 "debugData '{}'. Forcing shutdown of the connection.",, +                                 ctx.channel(), lastStreamId, errorCode, debugData.toString(UTF_8), future.cause());]