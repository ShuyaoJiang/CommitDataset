[+++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpObjectDecoder.java, +import io.netty.handler.codec.PrematureChannelClosureException;, +    @Override, +    protected void decodeLast(ChannelHandlerContext ctx, ByteBuf in, MessageList<Object> out) throws Exception {, +        decode(ctx, in, out);, +, +        // Handle the last unfinished message., +        if (message != null) {, +            // Get the length of the content received so far for the last message., +            HttpMessage message = this.message;, +            int actualContentLength;, +            if (content != null) {, +                actualContentLength = content.readableBytes();, +            } else {, +                actualContentLength = 0;, +            }, +, +            // Add the last message (and its content) to the output., +            reset(out);, +, +            // Check if this situation where the connection has been closed before decoding the last message completely, +            // is expected or not.  If unexpected, set decoder result as failure., +            boolean prematureClosure;, +            if (isDecodingRequest()) {, +                // The last request did not wait for a response., +                prematureClosure = true;, +            } else {, +                // Compare the length of the received content and the 'Content-Length' header., +                // If the 'Content-Length' header is absent, the length of the content is determined by the end of the, +                // connection, so it is perfectly fine., +                long expectedContentLength = HttpHeaders.getContentLength(message, -1);, +                prematureClosure = expectedContentLength >= 0 && actualContentLength != expectedContentLength;, +            }, +, +            if (prematureClosure) {, +                message.setDecoderResult(DecoderResult.failure(new PrematureChannelClosureException()));, +            }, +        }, +    }, +, +    private void reset(MessageList<Object> out) {, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpObjectDecoder.java, +import io.netty.handler.codec.PrematureChannelClosureException;, +    @Override, +    protected void decodeLast(ChannelHandlerContext ctx, ByteBuf in, MessageList<Object> out) throws Exception {, +        decode(ctx, in, out);, +, +        // Handle the last unfinished message., +        if (message != null) {, +            // Get the length of the content received so far for the last message., +            HttpMessage message = this.message;, +            int actualContentLength;, +            if (content != null) {, +                actualContentLength = content.readableBytes();, +            } else {, +                actualContentLength = 0;, +            }, +, +            // Add the last message (and its content) to the output., +            reset(out);, +, +            // Check if this situation where the connection has been closed before decoding the last message completely, +            // is expected or not.  If unexpected, set decoder result as failure., +            boolean prematureClosure;, +            if (isDecodingRequest()) {, +                // The last request did not wait for a response., +                prematureClosure = true;, +            } else {, +                // Compare the length of the received content and the 'Content-Length' header., +                // If the 'Content-Length' header is absent, the length of the content is determined by the end of the, +                // connection, so it is perfectly fine., +                long expectedContentLength = HttpHeaders.getContentLength(message, -1);, +                prematureClosure = expectedContentLength >= 0 && actualContentLength != expectedContentLength;, +            }, +, +            if (prematureClosure) {, +                message.setDecoderResult(DecoderResult.failure(new PrematureChannelClosureException()));, +            }, +        }, +    }, +, +    private void reset(MessageList<Object> out) {, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpResponseDecoder.java, +++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpObjectDecoder.java, +import io.netty.handler.codec.PrematureChannelClosureException;, +    @Override, +    protected void decodeLast(ChannelHandlerContext ctx, ByteBuf in, MessageList<Object> out) throws Exception {, +        decode(ctx, in, out);, +, +        // Handle the last unfinished message., +        if (message != null) {, +            // Get the length of the content received so far for the last message., +            HttpMessage message = this.message;, +            int actualContentLength;, +            if (content != null) {, +                actualContentLength = content.readableBytes();, +            } else {, +                actualContentLength = 0;, +            }, +]