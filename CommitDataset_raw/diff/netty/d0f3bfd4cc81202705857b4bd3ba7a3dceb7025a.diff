[+++ b/common/src/main/java/io/netty/util/DefaultAttributeMap.java, +                    return attr;, +                } else {, +                    curr = next;, +++ b/common/src/main/java/io/netty/util/DefaultAttributeMap.java, +                    return attr;, +                } else {, +                    curr = next;, +++ b/common/src/test/java/io/netty/util/DefaultAttributeMapTest.java, +, +    // See https://github.com/netty/netty/issues/2523, +    @Test, +    public void testSetRemove() {, +        AttributeKey<Integer> key = AttributeKey.valueOf("key");, +, +        map.attr(key).set(1);, +        assertSame(1, map.attr(key).getAndRemove());, +, +        map.attr(key).set(2);, +        assertSame(2, map.attr(key).get());, +    }]