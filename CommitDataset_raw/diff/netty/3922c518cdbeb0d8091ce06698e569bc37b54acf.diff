[+++ b/transport/src/main/java/io/netty/channel/AbstractChannel.java, +                            "Force-closing a channel whose registration task was not accepted by an event loop: {}",, +            boolean wasActive = isActive();, +            try {, +            } catch (Throwable t) {, +                closeIfClosed();, +                promise.setFailure(t);, +                return;, +            }, +                invokeLater(new Runnable() {, +                    @Override, +                    public void run() {, +                });, +            promise.setSuccess();, +            try {, +            } catch (Throwable t) {, +                closeIfClosed();, +                promise.setFailure(t);, +                return;, +            }, +            closeIfClosed(); // doDisconnect() might have closed the channel, +            promise.setSuccess();, +++ b/transport/src/main/java/io/netty/channel/AbstractChannel.java, +                            "Force-closing a channel whose registration task was not accepted by an event loop: {}",, +            boolean wasActive = isActive();, +            try {, +            } catch (Throwable t) {, +                closeIfClosed();, +                promise.setFailure(t);, +                return;, +            }, +                invokeLater(new Runnable() {, +                    @Override, +                    public void run() {, +                });, +            promise.setSuccess();, +            try {, +            } catch (Throwable t) {, +                closeIfClosed();, +                promise.setFailure(t);, +                return;, +            }, +            closeIfClosed(); // doDisconnect() might have closed the channel, +            promise.setSuccess();, +++ b/transport/src/main/java/io/netty/channel/nio/AbstractNioChannel.java]