[+++ b/src/main/java/org/jboss/netty/channel/ChannelLocal.java, +    private final ChannelFutureListener remover = new ChannelFutureListener() {, +        @Override, +        public void operationComplete(ChannelFuture future) throws Exception {, +            remove(future.getChannel());, +        }, +    };, +, +    private final boolean removeOnClose;, +    , +     * Creates a {@link Channel} local variable by calling {@link #ChannelLocal(boolean)} with <code>true</code>, +        this(true);, +     * Creates a {@link Channel} local variable. , +     * , +     * @param removeOnClose if <code>true</code> the {@link ChannelLocal} will remove a {@link Channel} from it own once the {@link Channel} was closed., +     */, +    public ChannelLocal(boolean removeOnClose) {, +        this.removeOnClose = removeOnClose;, +    }, +    , +, +, +    /**, +            T old =  map.put(channel, value);, +            if (removeOnClose) {, +                channel.getCloseFuture().addListener(remover);, +            }, +            return old;, +            T mapping =  map.putIfAbsent(channel, value);, +            , +            if (removeOnClose && mapping == null) {, +                channel.getCloseFuture().addListener(remover);, +            }, +            return mapping;, +            if (removeOnClose) {, +                channel.getCloseFuture().removeListener(remover);, +            }]