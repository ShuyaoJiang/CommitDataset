[+++ b/codec/src/main/java/io/netty/handler/codec/compression/JdkZlibDecoder.java, +import java.nio.ByteOrder;, +                        crc.update(outArray, outIndex, outputLength);, +                    if (in.readableBytes() < 4) {, +                    verifyCrc(in);, +        verifyCrc(buf);, +, +        // read ISIZE and verify, +        int dataLength = 0;, +        for (int i = 0; i < 4; ++i) {, +            dataLength |= buf.readUnsignedByte() << (i * 8);, +        }, +, +    private void verifyCrc(ByteBuf in) {, +        long crcValue = 0;, +        for (int i = 0; i < 4; ++i) {, +            crcValue |= (long) in.readUnsignedByte() << (i * 8);, +        }, +        long readCrc = crc.getValue();, +        if (crcValue != readCrc) {, +            throw new CompressionException(, +                    "CRC value missmatch. Expected: " + crcValue + ", Got: " + readCrc);, +        }, +    }, +++ b/codec/src/main/java/io/netty/handler/codec/compression/JdkZlibDecoder.java, +import java.nio.ByteOrder;, +                        crc.update(outArray, outIndex, outputLength);, +                    if (in.readableBytes() < 4) {, +                    verifyCrc(in);, +        verifyCrc(buf);, +, +        // read ISIZE and verify, +        int dataLength = 0;, +        for (int i = 0; i < 4; ++i) {, +            dataLength |= buf.readUnsignedByte() << (i * 8);, +        }, +, +    private void verifyCrc(ByteBuf in) {, +        long crcValue = 0;, +        for (int i = 0; i < 4; ++i) {, +            crcValue |= (long) in.readUnsignedByte() << (i * 8);, +        }, +        long readCrc = crc.getValue();, +        if (crcValue != readCrc) {, +            throw new CompressionException(, +                    "CRC value missmatch. Expected: " + crcValue + ", Got: " + readCrc);, +        }, +    }, +++ b/codec/src/test/java/io/netty/handler/codec/compression/JZlibTest.java, +import static org.junit.Assert.assertEquals;, +public class JZlibTest extends ZlibTest {, +, +    @Override, +    protected ZlibEncoder createEncoder(ZlibWrapper wrapper) {, +        return new JZlibEncoder(wrapper);, +    }, +, +    @Override, +    protected ZlibDecoder createDecoder(ZlibWrapper wrapper) {, +        return new JZlibDecoder(wrapper);, +    }, +    public void testZLIB_OR_NONE() throws Exception {, +        EmbeddedChannel chEncoder = new EmbeddedChannel(new JZlibEncoder(ZlibWrapper.NONE));, +    public void testZLIB_OR_NONE2() throws Exception {, +        EmbeddedChannel chEncoder = new EmbeddedChannel(new JZlibEncoder(ZlibWrapper.ZLIB));, +        EmbeddedChannel chDecoderZlibOrNone = new EmbeddedChannel(new JZlibDecoder(ZlibWrapper.ZLIB_OR_NONE));, +    public void testZLIB_OR_NONE3() throws Exception {, +        EmbeddedChannel chDecoderZlibOrNone = new EmbeddedChannel(new JZlibDecoder(ZlibWrapper.ZLIB_OR_NONE));, +++ b/codec/src/main/java/io/netty/handler/codec/compression/JdkZlibDecoder.java, +import java.nio.ByteOrder;, +                        crc.update(outArray, outIndex, outputLength);, +                    if (in.readableBytes() < 4) {, +                    verifyCrc(in);, +        verifyCrc(buf);, +, +        // read ISIZE and verify, +        int dataLength = 0;, +        for (int i = 0; i < 4; ++i) {, +            dataLength |= buf.readUnsignedByte() << (i * 8);, +        }, +, +    private void verifyCrc(ByteBuf in) {, +        long crcValue = 0;, +        for (int i = 0; i < 4; ++i) {, +            crcValue |= (long) in.readUnsignedByte() << (i * 8);, +        }, +        long readCrc = crc.getValue();, +        if (crcValue != readCrc) {, +            throw new CompressionException(, +                    "CRC value missmatch. Expected: " + crcValue + ", Got: " + readCrc);, +        }, +    }, +++ b/codec/src/test/java/io/netty/handler/codec/compression/JZlibTest.java, +import static org.junit.Assert.assertEquals;, +public class JZlibTest extends ZlibTest {, +, +    @Override, +    protected ZlibEncoder createEncoder(ZlibWrapper wrapper) {, +        return new JZlibEncoder(wrapper);, +    }]