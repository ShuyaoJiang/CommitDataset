[+++ b/handler/src/main/java/io/netty/handler/ssl/SslHandler.java, +                HandshakeStatus status = result.getHandshakeStatus();, +                switch (status) {, +                if (result.bytesProduced() == 0 && status != HandshakeStatus.NEED_TASK) {, +                if (status == Status.BUFFER_UNDERFLOW ||, +                        // If we processed NEED_TASK we should try again even we did not consume or produce anything., +                        handshakeStatus != HandshakeStatus.NEED_TASK && consumed == 0 && produced == 0) {, +                        if (inUnwrap) {, +                            // If we were in the unwrap call when the task was processed we should also try to unwrap, +                            // non app data first as there may not anything left in the inbound buffer to process., +                            unwrapNonAppData(ctx);, +                        }, +                            if (!wrapNonAppData(ctx, false) && inUnwrap) {, +                                // The handshake finished in wrapNonAppData(...), we need to try call, +                                // unwrapNonAppData(...) as we may have some alert that we should read., +                                //, +                                // This mimics what we would do when we are calling this method while in unwrap(...)., +                                unwrapNonAppData(ctx);, +                            }, +, +                            // Flush now as we may have written some data as part of the wrap call., +                             forceFlush(ctx);, +++ b/handler/src/main/java/io/netty/handler/ssl/SslHandler.java, +                HandshakeStatus status = result.getHandshakeStatus();, +                switch (status) {, +                if (result.bytesProduced() == 0 && status != HandshakeStatus.NEED_TASK) {, +                if (status == Status.BUFFER_UNDERFLOW ||, +                        // If we processed NEED_TASK we should try again even we did not consume or produce anything., +                        handshakeStatus != HandshakeStatus.NEED_TASK && consumed == 0 && produced == 0) {, +                        if (inUnwrap) {, +                            // If we were in the unwrap call when the task was processed we should also try to unwrap, +                            // non app data first as there may not anything left in the inbound buffer to process., +                            unwrapNonAppData(ctx);, +                        }, +                            if (!wrapNonAppData(ctx, false) && inUnwrap) {, +                                // The handshake finished in wrapNonAppData(...), we need to try call, +                                // unwrapNonAppData(...) as we may have some alert that we should read., +                                //, +                                // This mimics what we would do when we are calling this method while in unwrap(...)., +                                unwrapNonAppData(ctx);, +                            }, +, +                            // Flush now as we may have written some data as part of the wrap call., +                             forceFlush(ctx);, +++ b/handler/src/test/java/io/netty/handler/ssl/SSLEngineTest.java, +            assertTrue(sendChannel.writeAndFlush(message).await(5, TimeUnit.SECONDS));]