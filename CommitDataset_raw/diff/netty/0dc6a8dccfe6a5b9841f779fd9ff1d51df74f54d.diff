[+++ b/buffer/src/main/java/io/netty/buffer/ByteBufUtil.java, +        return encodeString0(alloc, false, src, charset);, +    }, +, +    static ByteBuf encodeString0(ByteBufAllocator alloc, boolean enforceHeap, CharBuffer src, Charset charset) {, +        final ByteBuf dst;, +        if (enforceHeap) {, +            dst = alloc.heapBuffer(length);, +        } else {, +            dst = alloc.buffer(length);, +        }, +++ b/buffer/src/main/java/io/netty/buffer/ByteBufUtil.java, +        return encodeString0(alloc, false, src, charset);, +    }, +, +    static ByteBuf encodeString0(ByteBufAllocator alloc, boolean enforceHeap, CharBuffer src, Charset charset) {, +        final ByteBuf dst;, +        if (enforceHeap) {, +            dst = alloc.heapBuffer(length);, +        } else {, +            dst = alloc.buffer(length);, +        }, +++ b/buffer/src/main/java/io/netty/buffer/Unpooled.java, +            ByteBuf copy = buffer(readable);, +        if (array == null) {, +            throw new NullPointerException("array");, +        }, +        return ByteBufUtil.encodeString0(ALLOC, true, buffer, charset);]