[+++ b/codec-http2/src/main/java/io/netty/handler/codec/http2/Http2FrameCodec.java, +        // The LocalFlowController is responsible for detecting over/under flow., +        connection().local().flowController().incrementWindowSize(connection().connectionStream(), deltaBytes);, +++ b/codec-http2/src/main/java/io/netty/handler/codec/http2/Http2FrameCodec.java, +        // The LocalFlowController is responsible for detecting over/under flow., +        connection().local().flowController().incrementWindowSize(connection().connectionStream(), deltaBytes);, +++ b/codec-http2/src/test/java/io/netty/handler/codec/http2/Http2FrameCodecTest.java, +    public void streamZeroWindowUpdateIncrementsConnectionWindow() throws Http2Exception {, +        Http2Stream connectionStream = connection.connectionStream();, +        int connectionWindowSizeBefore = localFlow.windowSize(connectionStream);, +        // We only replenish the flow control window after the amount consumed drops below the following threshold., +        // We make the threshold very "high" so that window updates will be sent when the delta is relatively small., +        ((DefaultHttp2LocalFlowController) localFlow).windowUpdateRatio(connectionStream, .999f);, +        // The initial window size is only changed by Http2Settings, so it shouldn't change., +        assertEquals(initialWindowSizeBefore, localFlow.initialWindowSize());, +        // The connection window should be increased by the delta amount., +        assertEquals(connectionWindowSizeBefore + windowUpdate, localFlow.windowSize(connectionStream));, +    }, +, +    @Test, +    public void windowUpdateDoesNotOverflowConnectionWindow() {, +        Http2Connection connection = frameCodec.connection();, +        Http2LocalFlowController localFlow = connection.local().flowController();, +        int initialWindowSizeBefore = localFlow.initialWindowSize();, +, +        channel.write(new DefaultHttp2WindowUpdateFrame(Integer.MAX_VALUE));, +, +        // The initial window size is only changed by Http2Settings, so it shouldn't change., +        assertEquals(initialWindowSizeBefore, localFlow.initialWindowSize());, +        // The connection window should be increased by the delta amount., +        assertEquals(Integer.MAX_VALUE, localFlow.windowSize(connection.connectionStream()));]