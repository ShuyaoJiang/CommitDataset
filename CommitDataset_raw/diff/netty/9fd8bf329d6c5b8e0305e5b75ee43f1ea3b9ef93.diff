[+++ b/transport/src/main/java/io/netty/channel/nio/AbstractNioByteChannel.java, +    private Runnable flushTask;, +, +, +                boolean setOpWrite = false;, +                        setOpWrite = true;, +                    incompleteWrite(setOpWrite);, +                boolean setOpWrite = false;, +                        setOpWrite = true;, +                    incompleteWrite(setOpWrite);, +    protected final void incompleteWrite(boolean setOpWrite) {, +        // Did not write completely., +        if (setOpWrite) {, +            setOpWrite();, +        } else {, +            // Schedule flush again later so other tasks can be picked up in the meantime, +            Runnable flushTask = this.flushTask;, +            if (flushTask == null) {, +                flushTask = this.flushTask = new Runnable() {, +                    @Override, +                    public void run() {, +                        flush();, +                    }, +                };, +            }, +            eventLoop().execute(flushTask);, +        }, +    }, +, +++ b/transport/src/main/java/io/netty/channel/nio/AbstractNioByteChannel.java, +    private Runnable flushTask;, +, +, +                boolean setOpWrite = false;, +                        setOpWrite = true;, +                    incompleteWrite(setOpWrite);, +                boolean setOpWrite = false;, +                        setOpWrite = true;, +                    incompleteWrite(setOpWrite);, +    protected final void incompleteWrite(boolean setOpWrite) {, +        // Did not write completely., +        if (setOpWrite) {, +            setOpWrite();, +        } else {, +            // Schedule flush again later so other tasks can be picked up in the meantime, +            Runnable flushTask = this.flushTask;, +            if (flushTask == null) {, +                flushTask = this.flushTask = new Runnable() {, +                    @Override, +                    public void run() {, +                        flush();, +                    }, +                };, +            }, +            eventLoop().execute(flushTask);, +        }, +    }, +, +++ b/transport/src/main/java/io/netty/channel/socket/nio/NioSocketChannel.java, +            boolean setOpWrite = false;, +                    setOpWrite = true;, +                incompleteWrite(setOpWrite);]