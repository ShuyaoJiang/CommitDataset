[+++ b/handler/src/main/java/io/netty/handler/ssl/ReferenceCountedOpenSslEngine.java, +                    if (bytesProduced <= 0) {, +                        return newResultMayFinishHandshake(NOT_HANDSHAKING, 0, 0);, +                    }, +                    // It is possible when the outbound was closed there was not enough room in the non-application, +                    // buffers to hold the close_notify. We should keep trying to close until we consume all the data, +                    // OpenSSL can give us., +                    boolean didShutdown = doSSLShutdown();, +                    bytesProduced = bioLengthBefore - SSL.bioLengthByteBuffer(networkBIO);, +                    return newResultMayFinishHandshake(didShutdown ? NEED_WRAP : NOT_HANDSHAKING, 0, bytesProduced);, +                        // TODO(scott): It is possible that when the handshake failed there was not enough room in the, +                        // non-application buffers to hold the alert. We should get all the data before progressing on., +                        // However I'm not aware of a way to do this with the OpenSSL APIs., +                        // See https://github.com/netty/netty/issues/6385., +, +            int mode = SSL.getShutdown(ssl);, +            if ((mode & SSL.SSL_SENT_SHUTDOWN) != SSL.SSL_SENT_SHUTDOWN) {, +                doSSLShutdown();, +            }, +        } else {, +            // engine closing before initial handshake, +            shutdown();, +        }, +    }, +, +    private boolean doSSLShutdown() {, +            return false;, +                return false;, +            }, +        return true;]