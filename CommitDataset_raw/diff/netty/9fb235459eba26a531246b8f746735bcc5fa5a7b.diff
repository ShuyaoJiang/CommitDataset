[+++ b/codec/src/main/java/io/netty/handler/codec/compression/JdkZlibDecoder.java, +    private Inflater inflater;, +    private boolean decideZlibOrNone;, +, +            case ZLIB_OR_NONE:, +                // Postpone the decision until decode(...) is called., +                decideZlibOrNone = true;, +                crc = null;, +                break;, +        if (decideZlibOrNone) {, +            // First two bytes are needed to decide if it's a ZLIB stream., +            if (in.readableBytes() < 2) {, +                return;, +            }, +, +            boolean nowrap = !looksLikeZlib(in.getShort(0));, +            inflater = new Inflater(nowrap);, +            decideZlibOrNone = false;, +        }, +, +        if (inflater != null) {, +    }, +, +    /*, +     * Returns true if the cmf_flg parameter (think: first two bytes of a zlib stream), +     * indicates that this is a zlib stream., +     * <p>, +     * You can lookup the details in the ZLIB RFC:, +     * <a href="http://tools.ietf.org/html/rfc1950#section-2.2">RFC 1950</a>., +     */, +    private boolean looksLikeZlib(short cmf_flg) {, +        return (cmf_flg & 0x7800) == 0x7800 &&, +                cmf_flg % 31 == 0;, +    }, +++ b/codec/src/main/java/io/netty/handler/codec/compression/JdkZlibDecoder.java, +    private Inflater inflater;, +    private boolean decideZlibOrNone;, +, +            case ZLIB_OR_NONE:, +                // Postpone the decision until decode(...) is called., +                decideZlibOrNone = true;, +                crc = null;, +                break;, +        if (decideZlibOrNone) {, +            // First two bytes are needed to decide if it's a ZLIB stream., +            if (in.readableBytes() < 2) {, +                return;, +            }, +, +            boolean nowrap = !looksLikeZlib(in.getShort(0));, +            inflater = new Inflater(nowrap);, +            decideZlibOrNone = false;, +        }, +, +        if (inflater != null) {, +    }, +, +    /*, +     * Returns true if the cmf_flg parameter (think: first two bytes of a zlib stream), +     * indicates that this is a zlib stream., +     * <p>, +     * You can lookup the details in the ZLIB RFC:, +     * <a href="http://tools.ietf.org/html/rfc1950#section-2.2">RFC 1950</a>., +     */, +    private boolean looksLikeZlib(short cmf_flg) {, +        return (cmf_flg & 0x7800) == 0x7800 &&, +                cmf_flg % 31 == 0;, +    }, +++ b/codec/src/main/java/io/netty/handler/codec/compression/ZlibCodecFactory.java, +++ b/codec/src/main/java/io/netty/handler/codec/compression/JdkZlibDecoder.java, +    private Inflater inflater;, +    private boolean decideZlibOrNone;, +, +            case ZLIB_OR_NONE:, +                // Postpone the decision until decode(...) is called., +                decideZlibOrNone = true;, +                crc = null;, +                break;, +        if (decideZlibOrNone) {, +            // First two bytes are needed to decide if it's a ZLIB stream., +            if (in.readableBytes() < 2) {, +                return;, +            }, +, +            boolean nowrap = !looksLikeZlib(in.getShort(0));, +            inflater = new Inflater(nowrap);, +            decideZlibOrNone = false;, +        }, +, +        if (inflater != null) {, +    }, +, +    /*, +     * Returns true if the cmf_flg parameter (think: first two bytes of a zlib stream), +     * indicates that this is a zlib stream., +     * <p>, +     * You can lookup the details in the ZLIB RFC:, +     * <a href="http://tools.ietf.org/html/rfc1950#section-2.2">RFC 1950</a>., +     */, +    private boolean looksLikeZlib(short cmf_flg) {]