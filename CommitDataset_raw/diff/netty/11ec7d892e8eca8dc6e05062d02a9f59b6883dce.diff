[+++ b/handler/src/main/java/io/netty/handler/ssl/SslHandler.java, +import io.netty.util.concurrent.PromiseNotifier;, +                handshake();, +            applyHandshakeTimeout();, +                    renegotiateOnEventLoop(promise);, +        renegotiateOnEventLoop(promise);, +    private void renegotiateOnEventLoop(final Promise<Channel> newHandshakePromise) {, +            oldHandshakePromise.addListener(new PromiseNotifier<Channel, Future<Channel>>(newHandshakePromise));, +            handshakePromise = newHandshakePromise;, +            handshake();, +            applyHandshakeTimeout();, +    /**, +     * Performs TLS (re)negotiation., +     */, +    private void handshake() {, +        if (engine.getHandshakeStatus() != HandshakeStatus.NOT_HANDSHAKING) {, +    private void applyHandshakeTimeout() {, +        final Promise<Channel> localHandshakePromise = this.handshakePromise;, +, +        if (handshakeTimeoutMillis <= 0 || localHandshakePromise.isDone()) {, +                if (localHandshakePromise.isDone()) {, +                    if (localHandshakePromise.tryFailure(HANDSHAKE_TIMED_OUT)) {, +        localHandshakePromise.addListener(new FutureListener<Channel>() {]