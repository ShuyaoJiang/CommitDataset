[+++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/ErrorCode.java, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/ErrorCode.java, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/HpackDraft05.java, +import java.util.ListIterator;, +  static final int PREFIX_5_BITS = 0x1f;, +    // Visible for testing., +    void reset() {, +      bytesLeft = 0;, +      headerTableSize = 0;, +      maxHeaderTableSize = 4096;, +      staticReferenceSet.clear();, +      headerTable.clear();, +      emittedHeaders.clear();, +    }, +, +            emptyReferenceSet();, +          throw new AssertionError();, +    private void emptyReferenceSet() {, +      for (ListIterator<HeaderEntry> li = headerTable.listIterator(headerTable.size());, +          li.hasPrevious(); ) {, +        li.previous().addTo(emittedHeaders);, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/ErrorCode.java, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/HpackDraft05.java, +import java.util.ListIterator;, +  static final int PREFIX_5_BITS = 0x1f;, +    // Visible for testing., +    void reset() {, +      bytesLeft = 0;, +      headerTableSize = 0;, +      maxHeaderTableSize = 4096;, +      staticReferenceSet.clear();, +      headerTable.clear();, +      emittedHeaders.clear();, +    }, +, +            emptyReferenceSet();, +          throw new AssertionError();, +    private void emptyReferenceSet() {, +      for (ListIterator<HeaderEntry> li = headerTable.listIterator(headerTable.size());, +          li.hasPrevious(); ) {, +        li.previous().addTo(emittedHeaders);, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/Http20Draft09.java, +import java.util.Locale;, +          List<String> namesAndValues = hpackReader.getAndReset();, +          // TODO: throw malformed if any present:, +          // Connection, Keep-Alive, Proxy-Connection, TE, Transfer-Encoding, Encoding, Upgrade., +          handler.headers(false, inFinished, streamId, -1, priority, namesAndValues,, +        String headerName = nameValueBlock.get(i).toLowerCase(Locale.US);, +        if (":host".equals(headerName)) headerName = ":authority";, +        nameValueBlock.set(i, headerName);, +      // TODO: throw malformed if any present:, +      // Connection, Keep-Alive, Proxy-Connection, TE, Transfer-Encoding, Encoding, Upgrade., +      out.writeInt(errorCode.spdyRstCode);, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/ErrorCode.java, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/HpackDraft05.java, +import java.util.ListIterator;, +  static final int PREFIX_5_BITS = 0x1f;, +    // Visible for testing., +    void reset() {, +      bytesLeft = 0;, +      headerTableSize = 0;, +      maxHeaderTableSize = 4096;, +      staticReferenceSet.clear();, +      headerTable.clear();, +      emittedHeaders.clear();, +    }, +, +            emptyReferenceSet();, +          throw new AssertionError();, +    private void emptyReferenceSet() {, +      for (ListIterator<HeaderEntry> li = headerTable.listIterator(headerTable.size());, +          li.hasPrevious(); ) {, +        li.previous().addTo(emittedHeaders);, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/Http20Draft09.java, +import java.util.Locale;, +          List<String> namesAndValues = hpackReader.getAndReset();, +          // TODO: throw malformed if any present:, +          // Connection, Keep-Alive, Proxy-Connection, TE, Transfer-Encoding, Encoding, Upgrade., +          handler.headers(false, inFinished, streamId, -1, priority, namesAndValues,, +        String headerName = nameValueBlock.get(i).toLowerCase(Locale.US);, +        if (":host".equals(headerName)) headerName = ":authority";, +        nameValueBlock.set(i, headerName);, +      // TODO: throw malformed if any present:, +      // Connection, Keep-Alive, Proxy-Connection, TE, Transfer-Encoding, Encoding, Upgrade., +      out.writeInt(errorCode.spdyRstCode);, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/Settings.java, +  /** http/2: An endpoint must not send a PUSH_PROMISE frame this is 0. */, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/ErrorCode.java, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/HpackDraft05.java, +import java.util.ListIterator;, +  static final int PREFIX_5_BITS = 0x1f;, +    // Visible for testing., +    void reset() {, +      bytesLeft = 0;, +      headerTableSize = 0;, +      maxHeaderTableSize = 4096;, +      staticReferenceSet.clear();, +      headerTable.clear();, +      emittedHeaders.clear();, +    }]