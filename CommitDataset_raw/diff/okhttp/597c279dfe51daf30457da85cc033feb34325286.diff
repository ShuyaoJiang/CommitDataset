[+++ b/okhttp-tests/src/test/java/com/squareup/okhttp/HttpUrlTest.java, +  @Test public void toUriSpecialQueryCharacters() throws Exception {, +    HttpUrl httpUrl = HttpUrl.parse("http://host/?d=abc!@[]^`{}|\\");, +    URI uri = httpUrl.uri();, +    assertEquals("http://host/?d=abc!@[]%5E%60%7B%7D%7C%5C", uri.toString());, +  }, +, +++ b/okhttp-tests/src/test/java/com/squareup/okhttp/HttpUrlTest.java, +  @Test public void toUriSpecialQueryCharacters() throws Exception {, +    HttpUrl httpUrl = HttpUrl.parse("http://host/?d=abc!@[]^`{}|\\");, +    URI uri = httpUrl.uri();, +    assertEquals("http://host/?d=abc!@[]%5E%60%7B%7D%7C%5C", uri.toString());, +  }, +, +++ b/okhttp/src/main/java/com/squareup/okhttp/HttpUrl.java, +  static final String QUERY_COMPONENT_ENCODE_SET = " \"'<>#&=";, +  static final String CONVERT_TO_URI_ENCODE_SET = "^`{}|\\";, +      String uriSafeUrl = canonicalize(url, CONVERT_TO_URI_ENCODE_SET, true, false);, +      return new URI(uriSafeUrl);]