[+++ b/CHANGELOG.md, +Version 1.1.1 *(2013-06-23)*, +----------------------------, +, + * Fix: ClassCastException when caching responses that were redirected from, +   HTTP to HTTPS., +, +, +++ b/CHANGELOG.md, +Version 1.1.1 *(2013-06-23)*, +----------------------------, +, + * Fix: ClassCastException when caching responses that were redirected from, +   HTTP to HTTPS., +, +, +++ b/okhttp-apache/pom.xml, +    <version>1.1.2-SNAPSHOT</version>, +++ b/CHANGELOG.md, +Version 1.1.1 *(2013-06-23)*, +----------------------------, +, + * Fix: ClassCastException when caching responses that were redirected from, +   HTTP to HTTPS., +, +, +++ b/okhttp-apache/pom.xml, +    <version>1.1.2-SNAPSHOT</version>, +++ b/okhttp/pom.xml, +    <version>1.1.2-SNAPSHOT</version>, +++ b/CHANGELOG.md, +Version 1.1.1 *(2013-06-23)*, +----------------------------, +, + * Fix: ClassCastException when caching responses that were redirected from, +   HTTP to HTTPS., +, +, +++ b/okhttp-apache/pom.xml, +    <version>1.1.2-SNAPSHOT</version>, +++ b/okhttp/pom.xml, +    <version>1.1.2-SNAPSHOT</version>, +++ b/okhttp/src/main/java/com/squareup/okhttp/HttpResponseCache.java, +import javax.net.ssl.SSLSocket;, +      SSLSocket sslSocket = getSslSocket(httpConnection);, +      if (sslSocket != null) {, +        cipherSuite = sslSocket.getSession().getCipherSuite();, +          peerCertificatesNonFinal = sslSocket.getSession().getPeerCertificates();, +        localCertificates = sslSocket.getSession().getLocalCertificates();, +    /**, +     * Returns the SSL socket used by {@code httpConnection} for HTTPS, nor null, +     * if the connection isn't using HTTPS. Since we permit redirects across, +     * protocols (HTTP to HTTPS or vice versa), the implementation type of the, +     * connection doesn't necessarily match the implementation type of its HTTP, +     * engine., +     */, +    private SSLSocket getSslSocket(HttpURLConnection httpConnection) {, +      HttpEngine engine = httpConnection instanceof HttpsURLConnectionImpl, +          ? ((HttpsURLConnectionImpl) httpConnection).getHttpEngine(), +          : ((HttpURLConnectionImpl) httpConnection).getHttpEngine();, +      return engine instanceof HttpsURLConnectionImpl.HttpsEngine, +          ? ((HttpsURLConnectionImpl.HttpsEngine) engine).getSslSocket(), +          : null;, +    }, +, +++ b/CHANGELOG.md, +Version 1.1.1 *(2013-06-23)*, +----------------------------, +, + * Fix: ClassCastException when caching responses that were redirected from, +   HTTP to HTTPS., +, +, +++ b/okhttp-apache/pom.xml, +    <version>1.1.2-SNAPSHOT</version>, +++ b/okhttp/pom.xml, +    <version>1.1.2-SNAPSHOT</version>, +++ b/okhttp/src/main/java/com/squareup/okhttp/HttpResponseCache.java, +import javax.net.ssl.SSLSocket;, +      SSLSocket sslSocket = getSslSocket(httpConnection);, +      if (sslSocket != null) {, +        cipherSuite = sslSocket.getSession().getCipherSuite();, +          peerCertificatesNonFinal = sslSocket.getSession().getPeerCertificates();, +        localCertificates = sslSocket.getSession().getLocalCertificates();, +    /**, +     * Returns the SSL socket used by {@code httpConnection} for HTTPS, nor null, +     * if the connection isn't using HTTPS. Since we permit redirects across, +     * protocols (HTTP to HTTPS or vice versa), the implementation type of the, +     * connection doesn't necessarily match the implementation type of its HTTP, +     * engine., +     */, +    private SSLSocket getSslSocket(HttpURLConnection httpConnection) {, +      HttpEngine engine = httpConnection instanceof HttpsURLConnectionImpl, +          ? ((HttpsURLConnectionImpl) httpConnection).getHttpEngine(), +          : ((HttpURLConnectionImpl) httpConnection).getHttpEngine();, +      return engine instanceof HttpsURLConnectionImpl.HttpsEngine, +          ? ((HttpsURLConnectionImpl.HttpsEngine) engine).getSslSocket(), +          : null;, +    }, +]