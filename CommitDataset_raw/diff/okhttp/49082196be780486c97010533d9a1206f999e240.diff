[+++ b/src/main/java/com/squareup/okhttp/internal/http/HttpURLConnectionImpl.java, +     * How many redirects should we follow? Chrome follows 21; Firefox, curl,, +     * and wget follow 20; Safari follows 16; and HTTP/1.0 recommends 5., +    private static final int MAX_REDIRECTS = 20;, +            if (routeSelector == null) {, +                throw e; // Without a route selector, we can't retry., +            } else if (httpEngine.connection != null) {, +            if (routeSelector.hasNext() && isRecoverable(e), +                throw new ProtocolException("Too many redirects: " + redirectionCount);, +++ b/src/main/java/com/squareup/okhttp/internal/http/HttpURLConnectionImpl.java, +     * How many redirects should we follow? Chrome follows 21; Firefox, curl,, +     * and wget follow 20; Safari follows 16; and HTTP/1.0 recommends 5., +    private static final int MAX_REDIRECTS = 20;, +            if (routeSelector == null) {, +                throw e; // Without a route selector, we can't retry., +            } else if (httpEngine.connection != null) {, +            if (routeSelector.hasNext() && isRecoverable(e), +                throw new ProtocolException("Too many redirects: " + redirectionCount);, +++ b/src/test/java/com/squareup/okhttp/internal/http/URLConnectionTest.java, +    @Test public void serverShutdownOutput() throws Exception {, +    @Test public void follow20Redirects() throws Exception {, +        for (int i = 0; i < 20; i++) {, +            server.enqueue(new MockResponse(), +                    .setResponseCode(HttpURLConnection.HTTP_MOVED_TEMP), +                    .addHeader("Location: /" + (i + 1)), +                    .setBody("Redirecting to /" + (i + 1)));, +        }, +        server.enqueue(new MockResponse().setBody("Success!"));, +        server.play();, +, +        HttpURLConnection connection = client.open(server.getUrl("/0"));, +        assertContent("Success!", connection);, +        assertEquals(server.getUrl("/20"), connection.getURL());, +    }, +, +    @Test public void doesNotFollow21Redirects() throws Exception {, +        for (int i = 0; i < 21; i++) {, +            server.enqueue(new MockResponse(), +                    .setResponseCode(HttpURLConnection.HTTP_MOVED_TEMP), +                    .addHeader("Location: /" + (i + 1)), +                    .setBody("Redirecting to /" + (i + 1)));, +        }, +        server.play();, +, +        HttpURLConnection connection = client.open(server.getUrl("/0"));, +        try {, +            connection.getInputStream();, +            fail();, +        } catch (ProtocolException expected) {, +            assertEquals(HttpURLConnection.HTTP_MOVED_TEMP, connection.getResponseCode());, +            assertEquals("Too many redirects: 21", expected.getMessage());, +            assertContent("Redirecting to /21", connection);, +            assertEquals(server.getUrl("/20"), connection.getURL());, +        }, +    }, +]