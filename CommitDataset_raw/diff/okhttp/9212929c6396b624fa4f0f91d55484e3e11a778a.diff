[+++ b/okhttp-tests/src/test/java/okhttp3/CallTest.java, +import okhttp3.mockwebserver.internal.tls.HeldCertificate;, +import okhttp3.mockwebserver.internal.tls.SslClient;, +import static org.junit.Assert.assertNotNull;, +  /**, +   * We had a bug where we were passing a null route to the authenticator., +   * https://github.com/square/okhttp/issues/3809, +   */, +  @Test public void authenticateWithNoConnection() throws Exception {, +    server.enqueue(new MockResponse(), +        .addHeader("Connection: close"), +        .setResponseCode(401), +        .setSocketPolicy(SocketPolicy.DISCONNECT_AT_END));, +, +    RecordingOkAuthenticator authenticator = new RecordingOkAuthenticator(null);, +, +    client = client.newBuilder(), +        .authenticator(authenticator), +        .build();, +, +    executeSynchronously("/"), +        .assertCode(401);, +, +    assertNotNull(authenticator.onlyRoute());, +  }, +, +++ b/okhttp-tests/src/test/java/okhttp3/CallTest.java, +import okhttp3.mockwebserver.internal.tls.HeldCertificate;, +import okhttp3.mockwebserver.internal.tls.SslClient;, +import static org.junit.Assert.assertNotNull;, +  /**, +   * We had a bug where we were passing a null route to the authenticator., +   * https://github.com/square/okhttp/issues/3809, +   */, +  @Test public void authenticateWithNoConnection() throws Exception {, +    server.enqueue(new MockResponse(), +        .addHeader("Connection: close"), +        .setResponseCode(401), +        .setSocketPolicy(SocketPolicy.DISCONNECT_AT_END));, +, +    RecordingOkAuthenticator authenticator = new RecordingOkAuthenticator(null);, +, +    client = client.newBuilder(), +        .authenticator(authenticator), +        .build();, +, +    executeSynchronously("/"), +        .assertCode(401);, +, +    assertNotNull(authenticator.onlyRoute());, +  }, +, +++ b/okhttp-tests/src/test/java/okhttp3/URLConnectionTest.java, +import okhttp3.mockwebserver.internal.tls.SslClient;, +    assertEquals(Proxy.NO_PROXY, authenticator.onlyRoute().proxy());, +  @Test public void authenticateNoConnection() throws Exception {, +    server.enqueue(new MockResponse(), +        .addHeader("Connection: close"), +        .setResponseCode(401), +        .setSocketPolicy(SocketPolicy.DISCONNECT_AT_END));, +, +    Authenticator.setDefault(new RecordingAuthenticator(null));, +    urlFactory.setClient(urlFactory.client().newBuilder(), +        .authenticator(new JavaNetAuthenticator()), +        .build());, +    connection = urlFactory.open(server.url("/").url());, +    assertEquals(401, connection.getResponseCode());, +  }, +, +++ b/okhttp-tests/src/test/java/okhttp3/CallTest.java, +import okhttp3.mockwebserver.internal.tls.HeldCertificate;, +import okhttp3.mockwebserver.internal.tls.SslClient;, +import static org.junit.Assert.assertNotNull;, +  /**, +   * We had a bug where we were passing a null route to the authenticator., +   * https://github.com/square/okhttp/issues/3809, +   */, +  @Test public void authenticateWithNoConnection() throws Exception {, +    server.enqueue(new MockResponse(), +        .addHeader("Connection: close"), +        .setResponseCode(401), +        .setSocketPolicy(SocketPolicy.DISCONNECT_AT_END));, +, +    RecordingOkAuthenticator authenticator = new RecordingOkAuthenticator(null);, +, +    client = client.newBuilder(), +        .authenticator(authenticator), +        .build();, +, +    executeSynchronously("/"), +        .assertCode(401);, +, +    assertNotNull(authenticator.onlyRoute());, +  }, +, +++ b/okhttp-tests/src/test/java/okhttp3/URLConnectionTest.java, +import okhttp3.mockwebserver.internal.tls.SslClient;, +    assertEquals(Proxy.NO_PROXY, authenticator.onlyRoute().proxy());, +  @Test public void authenticateNoConnection() throws Exception {, +    server.enqueue(new MockResponse()]