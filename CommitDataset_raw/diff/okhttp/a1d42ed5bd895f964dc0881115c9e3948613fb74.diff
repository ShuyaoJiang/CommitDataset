[+++ b/okhttp/src/main/java/com/squareup/okhttp/Connection.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/Connection.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpAuthenticator.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/Connection.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpAuthenticator.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/Connection.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpAuthenticator.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpURLConnectionImpl.java, +    Proxy proxy = client.getProxy();, +++ b/okhttp/src/main/java/com/squareup/okhttp/Connection.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpAuthenticator.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpURLConnectionImpl.java, +    Proxy proxy = client.getProxy();, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpsEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/Connection.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpAuthenticator.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpURLConnectionImpl.java, +    Proxy proxy = client.getProxy();, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpsEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpsURLConnectionImpl.java, +    if (delegate.httpEngine == null || delegate.httpEngine.sentRequestMillis == -1) {, +++ b/okhttp/src/main/java/com/squareup/okhttp/Connection.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpAuthenticator.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpURLConnectionImpl.java, +    Proxy proxy = client.getProxy();, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpsEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpsURLConnectionImpl.java, +    if (delegate.httpEngine == null || delegate.httpEngine.sentRequestMillis == -1) {, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/Policy.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/Connection.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpAuthenticator.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpURLConnectionImpl.java, +    Proxy proxy = client.getProxy();, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpsEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpsURLConnectionImpl.java, +    if (delegate.httpEngine == null || delegate.httpEngine.sentRequestMillis == -1) {, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/Policy.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/RequestHeaders.java, +                if (!entry.getValue().isEmpty()) {, +                    headers.add(key, buildCookieHeader(entry.getValue()));, +, +    // format has defined here:  http://tools.ietf.org/html/rfc6265#section-4.2.1, +    private String buildCookieHeader(List<String> cookies) {, +        StringBuilder sb = new StringBuilder();, +        boolean isFirst = true;, +        for (String cookie : cookies) {, +            if (isFirst) {, +                isFirst = false;, +            } else {, +                sb.append(';');, +            }, +            sb.append(cookie);, +        }, +        return sb.toString();, +    }, +, +}, +++ b/okhttp/src/main/java/com/squareup/okhttp/Connection.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpAuthenticator.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpURLConnectionImpl.java, +    Proxy proxy = client.getProxy();, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpsEngine.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/HttpsURLConnectionImpl.java, +    if (delegate.httpEngine == null || delegate.httpEngine.sentRequestMillis == -1) {, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/Policy.java, +++ b/okhttp/src/main/java/com/squareup/okhttp/internal/http/RequestHeaders.java, +                if (!entry.getValue().isEmpty()) {, +                    headers.add(key, buildCookieHeader(entry.getValue()));, +, +    // format has defined here:  http://tools.ietf.org/html/rfc6265#section-4.2.1, +    private String buildCookieHeader(List<String> cookies) {, +        StringBuilder sb = new StringBuilder();, +        boolean isFirst = true;, +        for (String cookie : cookies) {, +            if (isFirst) {, +                isFirst = false;, +            } else {, +                sb.append(';');, +            }, +            sb.append(cookie);, +        }, +        return sb.toString();, +    }, +, +}, +++ b/okhttp/src/test/java/com/squareup/okhttp/internal/http/URLConnectionTest.java, +    assertEquals(1, calls.size());, +    String call = calls.get(0);, +    assertTrue(call, call.contains("scheme=Foo"));, +    assertTrue(call, call.contains("prompt=Bar"));, +    assertEquals(1, calls.size());, +    String call = calls.get(0);, +    assertTrue(call, call.contains("scheme=Digest"));]