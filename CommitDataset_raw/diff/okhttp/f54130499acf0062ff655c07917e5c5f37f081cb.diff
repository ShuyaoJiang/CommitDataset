[+++ b/mockwebserver/src/main/java/okhttp3/mockwebserver/MockWebServer.java, +import org.junit.rules.ExternalResource;, +public final class MockWebServer extends ExternalResource implements Closeable {, +  @Override protected synchronized void before() {, +    before();, +    before();, +    before();, +  @Override protected synchronized void after() {, +    try {, +      shutdown();, +    } catch (IOException e) {, +      logger.log(Level.WARNING, "MockWebServer shutdown failed", e);, +    }, +  }, +, +++ b/mockwebserver/src/main/java/okhttp3/mockwebserver/MockWebServer.java, +import org.junit.rules.ExternalResource;, +public final class MockWebServer extends ExternalResource implements Closeable {, +  @Override protected synchronized void before() {, +    before();, +    before();, +    before();, +  @Override protected synchronized void after() {, +    try {, +      shutdown();, +    } catch (IOException e) {, +      logger.log(Level.WARNING, "MockWebServer shutdown failed", e);, +    }, +  }, +, +++ b/okhttp-tests/src/test/java/okhttp3/URLConnectionTest.java, +import java.io.File;, +import java.io.FileNotFoundException;, +import java.net.CookieHandler;, +import java.nio.charset.Charset;, +, +++ b/mockwebserver/src/main/java/okhttp3/mockwebserver/MockWebServer.java, +import org.junit.rules.ExternalResource;, +public final class MockWebServer extends ExternalResource implements Closeable {, +  @Override protected synchronized void before() {, +    before();, +    before();, +    before();, +  @Override protected synchronized void after() {, +    try {, +      shutdown();, +    } catch (IOException e) {, +      logger.log(Level.WARNING, "MockWebServer shutdown failed", e);, +    }, +  }, +, +++ b/okhttp-tests/src/test/java/okhttp3/URLConnectionTest.java, +import java.io.File;, +import java.io.FileNotFoundException;, +import java.net.CookieHandler;, +import java.nio.charset.Charset;, +, +++ b/okhttp-tests/src/test/java/okhttp3/internal/ws/RealWebSocketTest.java, +  @After public void tearDown() {, +++ b/mockwebserver/src/main/java/okhttp3/mockwebserver/MockWebServer.java, +import org.junit.rules.ExternalResource;, +public final class MockWebServer extends ExternalResource implements Closeable {, +  @Override protected synchronized void before() {, +    before();, +    before();, +    before();, +  @Override protected synchronized void after() {, +    try {, +      shutdown();, +    } catch (IOException e) {, +      logger.log(Level.WARNING, "MockWebServer shutdown failed", e);, +    }, +  }, +, +++ b/okhttp-tests/src/test/java/okhttp3/URLConnectionTest.java, +import java.io.File;, +import java.io.FileNotFoundException;, +import java.net.CookieHandler;, +import java.nio.charset.Charset;, +, +++ b/okhttp-tests/src/test/java/okhttp3/internal/ws/RealWebSocketTest.java, +  @After public void tearDown() {, +++ b/okhttp/src/main/java/okhttp3/internal/ws/RealWebSocket.java, +  void failWebSocket(Exception e, Response response) {]