[+++ b/okhttp-tests/src/test/java/com/squareup/okhttp/CallTest.java, +import java.net.URL;, +  @Ignore // Cache requests not populated properly. https://github.com/square/okhttp/issues/805, +    server.enqueue(new MockResponse(), +        .addHeader("ETag: v1"), +        .addHeader("Vary: Accept-Charset"), +        .addHeader("Donut: a"), +        .setBody("A"));, +        .addHeader("Donut: b"), +    // Store a response in the cache., +    URL url = server.getUrl("/");, +    Request cacheStoreRequest = new Request.Builder(), +        .url(url), +        .addHeader("Accept-Language", "fr-CA"), +        .addHeader("Accept-Charset", "UTF-8"), +        .build();, +    executeSynchronously(cacheStoreRequest), +        .assertCode(200), +        .assertHeader("Donut", "a"), +        .assertBody("A");, +    // Hit that stored response., +    Request cacheHitRequest = new Request.Builder(), +        .url(url), +        .addHeader("Accept-Language", "en-US") // Different, but Vary says it doesn't matter., +        .addHeader("Accept-Charset", "UTF-8"), +        .build();, +    RecordedResponse cacheHit = executeSynchronously(cacheHitRequest);, +, +    // Check the merged response. The request is the application's original request., +    cacheHit.assertCode(200), +        .assertBody("A"), +        .assertHeader("Donut", "b"), +        .assertRequestUrl(cacheStoreRequest.url()), +        .assertRequestHeader("Accept-Language", "en-US"), +        .assertRequestHeader("Accept-Charset", "UTF-8"), +        .assertRequestHeader("If-None-Match"); // No If-None-Match on the cache hit's request., +, +    // Check the cached response. Its request contains only the saved Vary headers., +    cacheHit.cacheResponse(), +        .assertCode(200), +        .assertHeader("Donut", "a"), +        .assertHeader("ETag", "v1"), +        .assertRequestUrl(cacheStoreRequest.url()), +        .assertRequestHeader("Accept-Language") // No Vary on Accept-Language., +        .assertRequestHeader("Accept-Charset", "UTF-8") // Because of Vary on Accept-Charset., +        .assertRequestHeader("If-None-Match"); // This wasn't present in the original request., +, +    // Check the network response. Its has the caller's request, plus some caching headers., +    cacheHit.networkResponse(), +        .assertCode(304), +        .assertHeader("Donut", "b"), +        .assertRequestHeader("Accept-Language", "en-US"), +        .assertRequestHeader("Accept-Charset", "UTF-8"), +        .assertRequestHeader("If-None-Match", "v1"); // If-None-Match in the validation request., +        .priorResponse(), +        .priorResponse(), +        .priorResponse(), +        .priorResponse(), +++ b/okhttp-tests/src/test/java/com/squareup/okhttp/CallTest.java, +import java.net.URL;, +  @Ignore // Cache requests not populated properly. https://github.com/square/okhttp/issues/805, +    server.enqueue(new MockResponse(), +        .addHeader("ETag: v1"), +        .addHeader("Vary: Accept-Charset"), +        .addHeader("Donut: a"), +        .setBody("A"));, +        .addHeader("Donut: b"), +    // Store a response in the cache., +    URL url = server.getUrl("/");, +    Request cacheStoreRequest = new Request.Builder(), +        .url(url), +        .addHeader("Accept-Language", "fr-CA"), +        .addHeader("Accept-Charset", "UTF-8"), +        .build();, +    executeSynchronously(cacheStoreRequest), +        .assertCode(200), +        .assertHeader("Donut", "a"), +        .assertBody("A");, +    // Hit that stored response., +    Request cacheHitRequest = new Request.Builder(), +        .url(url), +        .addHeader("Accept-Language", "en-US") // Different, but Vary says it doesn't matter., +        .addHeader("Accept-Charset", "UTF-8"), +        .build();, +    RecordedResponse cacheHit = executeSynchronously(cacheHitRequest);, +, +    // Check the merged response. The request is the application's original request., +    cacheHit.assertCode(200), +        .assertBody("A"), +        .assertHeader("Donut", "b"), +        .assertRequestUrl(cacheStoreRequest.url()), +        .assertRequestHeader("Accept-Language", "en-US"), +        .assertRequestHeader("Accept-Charset", "UTF-8"), +        .assertRequestHeader("If-None-Match"); // No If-None-Match on the cache hit's request., +, +    // Check the cached response. Its request contains only the saved Vary headers., +    cacheHit.cacheResponse(), +        .assertCode(200), +        .assertHeader("Donut", "a"), +        .assertHeader("ETag", "v1")]