[+++ b/okhttp-tests/src/test/java/okhttp3/internal/ws/WebSocketHttpTest.java, +    WebSocket server = serverListener.assertOpen();, +    closeWebSockets(webSocket, server);, +    WebSocket server = serverListener.assertOpen();, +    closeWebSockets(webSocket, server);, +    WebSocket server = serverListener.assertOpen();, +    closeWebSockets(webSocket, server);, +    WebSocket server = serverListener.assertOpen();, +    closeWebSockets(webSocket, server);, +    WebSocket webSocket = newWebSocket();, +    closeWebSockets(webSocket, server);, +, +    // TODO: fix connection leak, +    closeWebSockets(webSocket, server);, +    closeWebSockets(webSocket, server);, +    WebSocket webSocket = newWebSocket();, +    closeWebSockets(webSocket, server);, +    closeWebSockets(webSocket, server);, +    closeWebSockets(webSocket, server);, +    WebSocket webSocket = newWebSocket();, +    closeWebSockets(webSocket, server);, +    WebSocket server = serverListener.assertOpen();, +, +    closeWebSockets(webSocket, server);, +, +  private void closeWebSockets(WebSocket webSocket, WebSocket server) {, +    server.close(1001, "");, +    clientListener.assertClosing(1001, "");, +    webSocket.close(1000, "");, +    serverListener.assertClosing(1000, "");, +    clientListener.assertClosed(1001, "");, +    serverListener.assertClosed(1000, "");, +    clientListener.assertExhausted();, +    serverListener.assertExhausted();, +  }, +++ b/okhttp-tests/src/test/java/okhttp3/internal/ws/WebSocketHttpTest.java, +    WebSocket server = serverListener.assertOpen();, +    closeWebSockets(webSocket, server);, +    WebSocket server = serverListener.assertOpen();, +    closeWebSockets(webSocket, server);, +    WebSocket server = serverListener.assertOpen();, +    closeWebSockets(webSocket, server);, +    WebSocket server = serverListener.assertOpen();, +    closeWebSockets(webSocket, server);, +    WebSocket webSocket = newWebSocket();, +    closeWebSockets(webSocket, server);, +, +    // TODO: fix connection leak, +    closeWebSockets(webSocket, server);, +    closeWebSockets(webSocket, server);, +    WebSocket webSocket = newWebSocket();, +    closeWebSockets(webSocket, server);, +    closeWebSockets(webSocket, server);, +    closeWebSockets(webSocket, server);, +    WebSocket webSocket = newWebSocket();, +    closeWebSockets(webSocket, server);, +    WebSocket server = serverListener.assertOpen();, +, +    closeWebSockets(webSocket, server);, +, +  private void closeWebSockets(WebSocket webSocket, WebSocket server) {, +    server.close(1001, "");, +    clientListener.assertClosing(1001, "");, +    webSocket.close(1000, "");, +    serverListener.assertClosing(1000, "");, +    clientListener.assertClosed(1001, "");, +    serverListener.assertClosed(1000, "");, +    clientListener.assertExhausted();, +    serverListener.assertExhausted();, +  }, +++ b/okhttp/src/main/java/okhttp3/internal/ws/RealWebSocket.java, +          listener.onOpen(RealWebSocket.this, response);]