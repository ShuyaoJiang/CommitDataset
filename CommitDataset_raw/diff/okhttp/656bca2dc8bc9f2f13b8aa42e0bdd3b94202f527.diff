[+++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/ErrorCode.java, +// TODO: revisit for http/2 draft 9, +// http://tools.ietf.org/html/draft-ietf-httpbis-http2-09#section-7, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/ErrorCode.java, +// TODO: revisit for http/2 draft 9, +// http://tools.ietf.org/html/draft-ietf-httpbis-http2-09#section-7, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/HpackDraft05.java, +            clearReferenceSet();, +          // TODO: we should throw something that we can coerce to a PROTOCOL_ERROR, +          throw new AssertionError("unhandled byte: " + Integer.toBinaryString(b));, +    private void clearReferenceSet() {, +      for (int i = headerTable.size() - 1; i != -1; i--) {, +        headerTable.get(i).addTo(emittedHeaders);, +      } else {, +        // TODO: we should throw something that we can coerce to a PROTOCOL_ERROR, +        throw new AssertionError("invalid index " + index);, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/ErrorCode.java, +// TODO: revisit for http/2 draft 9, +// http://tools.ietf.org/html/draft-ietf-httpbis-http2-09#section-7, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/HpackDraft05.java, +            clearReferenceSet();, +          // TODO: we should throw something that we can coerce to a PROTOCOL_ERROR, +          throw new AssertionError("unhandled byte: " + Integer.toBinaryString(b));, +    private void clearReferenceSet() {, +      for (int i = headerTable.size() - 1; i != -1; i--) {, +        headerTable.get(i).addTo(emittedHeaders);, +      } else {, +        // TODO: we should throw something that we can coerce to a PROTOCOL_ERROR, +        throw new AssertionError("invalid index " + index);, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/Http20Draft09.java, +          // not filtering out illegal headers on read., +          List<String> nameValueBlock = hpackReader.getAndReset();, +          handler.headers(false, inFinished, streamId, -1, priority, nameValueBlock,, +        String name = nameValueBlock.get(i);, +        // TODO: is :authority literally the same value as :host?, +        // https://github.com/http2/http2-spec/issues/334, +        if (":host".equals(name)) {, +          nameValueBlock.set(i, ":authority");, +        } else if (shouldDropHeader(name)) {, +          //TODO: Avoid creating headers like these., +          nameValueBlock.remove(i);, +          nameValueBlock.remove(i);, +          i -= 2;, +      }, +      out.writeInt(errorCode.httpCode);, +      // TODO: Implement looping strategy., +, +  /**, +   * Leniently drop as opposed to throwing malformed., +   * http://tools.ietf.org/html/draft-ietf-httpbis-http2-09#section-8.1.3, +   */, +  private static boolean shouldDropHeader(String name) {, +    return name.equals("connection"), +        || name.equals("host") // host is not supported in http/2, +        || name.equals("keep-alive"), +        || name.equals("proxy-connection"), +        || name.equals("te"), +        || name.equals("transfer-encoding"), +        || name.equals("encoding"), +        || name.equals("upgrade");, +  }, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/ErrorCode.java, +// TODO: revisit for http/2 draft 9, +// http://tools.ietf.org/html/draft-ietf-httpbis-http2-09#section-7, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/HpackDraft05.java, +            clearReferenceSet();, +          // TODO: we should throw something that we can coerce to a PROTOCOL_ERROR, +          throw new AssertionError("unhandled byte: " + Integer.toBinaryString(b));, +    private void clearReferenceSet() {, +      for (int i = headerTable.size() - 1; i != -1; i--) {, +        headerTable.get(i).addTo(emittedHeaders);, +      } else {, +        // TODO: we should throw something that we can coerce to a PROTOCOL_ERROR, +        throw new AssertionError("invalid index " + index);, +++ b/okhttp-protocols/src/main/java/com/squareup/okhttp/internal/spdy/Http20Draft09.java, +          // not filtering out illegal headers on read., +          List<String> nameValueBlock = hpackReader.getAndReset();, +          handler.headers(false, inFinished, streamId, -1, priority, nameValueBlock,, +        String name = nameValueBlock.get(i);, +        // TODO: is :authority literally the same value as :host?, +        // https://github.com/http2/http2-spec/issues/334, +        if (":host".equals(name)) {, +          nameValueBlock.set(i, ":authority");, +        } else if (shouldDropHeader(name)) {, +          //TODO: Avoid creating headers like these., +          nameValueBlock.remove(i);, +          nameValueBlock.remove(i);, +          i -= 2;, +      }, +      out.writeInt(errorCode.httpCode);, +      // TODO: Implement looping strategy., +, +  /**, +   * Leniently drop as opposed to throwing malformed., +   * http://tools.ietf.org/html/draft-ietf-httpbis-http2-09#section-8.1.3, +   */, +  private static boolean shouldDropHeader(String name) {, +    return name.equals("connection"), +        || name.equals("host") // host is not supported in http/2, +        || name.equals("keep-alive")]