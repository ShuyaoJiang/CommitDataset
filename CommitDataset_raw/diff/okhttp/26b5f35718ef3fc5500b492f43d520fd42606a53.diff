[+++ b/mockwebserver/src/main/java/com/squareup/okhttp/mockwebserver/MockWebServer.java, +import okio.OkBuffer;, +      OkBuffer body = new OkBuffer();, +      if (response.getBody() != null) {, +        body.write(response.getBody());, +      }, +      boolean closeStreamAfterHeaders = body.size() > 0 || !response.getPushPromises().isEmpty();, +      if (body.size() > 0) {, +        if (response.getThrottleBytesPerPeriod() == Integer.MAX_VALUE) {, +          sink.write(body, body.size());, +          sink.flush();, +        } else {, +          while (body.size() > 0) {, +            long toWrite = Math.min(body.size(), response.getThrottleBytesPerPeriod());, +            sink.write(body, toWrite);, +            sink.flush();, +            try {, +              long delayMs = response.getThrottleUnit().toMillis(response.getThrottlePeriod());, +              if (delayMs != 0) Thread.sleep(delayMs);, +            } catch (InterruptedException e) {, +              throw new AssertionError();, +            }, +          }, +        }]