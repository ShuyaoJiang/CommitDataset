[+++ b/ChangeLog, +2010-02-09  David Gilbert  <david.gilbert@object-refinery.com>, +, +    Bug 2947660:, +    * source/org/jfree/chart/renderer/category/AbstractCategoryRenderer.java, +    (getLegendItems): Fix null check., +, +++ b/ChangeLog, +2010-02-09  David Gilbert  <david.gilbert@object-refinery.com>, +, +    Bug 2947660:, +    * source/org/jfree/chart/renderer/category/AbstractCategoryRenderer.java, +    (getLegendItems): Fix null check., +, +++ b/source/org/jfree/chart/renderer/category/AbstractCategoryItemRenderer.java, + * (C) Copyright 2000-2010, by Object Refinery Limited and Contributors., + * (C) Copyright 2002-2010, by Object Refinery Limited., + * 09-Feb-2010 : Fixed bug 2947660 (DG);, +        if (dataset == null) {, +++ b/ChangeLog, +2010-02-09  David Gilbert  <david.gilbert@object-refinery.com>, +, +    Bug 2947660:, +    * source/org/jfree/chart/renderer/category/AbstractCategoryRenderer.java, +    (getLegendItems): Fix null check., +, +++ b/source/org/jfree/chart/renderer/category/AbstractCategoryItemRenderer.java, + * (C) Copyright 2000-2010, by Object Refinery Limited and Contributors., + * (C) Copyright 2002-2010, by Object Refinery Limited., + * 09-Feb-2010 : Fixed bug 2947660 (DG);, +        if (dataset == null) {, +++ b/tests/org/jfree/chart/renderer/category/junit/AbstractCategoryItemRendererTests.java, + * (C) Copyright 2000-2010, by Object Refinery Limited and Contributors., + * (C) Copyright 2004-2010, by Object Refinery Limited and Contributors., + * 09-Feb-2010 : Added test2947660() (DG);, +import org.jfree.chart.LegendItemCollection;, +import org.jfree.chart.plot.CategoryPlot;, +    /**, +     * A test that reproduces the problem reported in bug 2947660., +     */, +    public void test2947660() {, +        AbstractCategoryItemRenderer r = new LineAndShapeRenderer();, +        assertNotNull(r.getLegendItems());, +        assertEquals(0, r.getLegendItems().getItemCount());, +, +        DefaultCategoryDataset dataset = new DefaultCategoryDataset();, +        CategoryPlot plot = new CategoryPlot();, +        plot.setDataset(dataset);, +        plot.setRenderer(r);, +        assertEquals(0, r.getLegendItems().getItemCount());, +, +        dataset.addValue(1.0, "S1", "C1");, +        LegendItemCollection lic = r.getLegendItems();, +        assertEquals(1, lic.getItemCount());, +        assertEquals("S1", lic.get(0).getLabel());, +    }, +]