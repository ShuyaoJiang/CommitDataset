[+++ b/spring-web/src/main/java/org/springframework/http/server/ServerHttpRequest.java, +++ b/spring-web/src/main/java/org/springframework/http/server/ServerHttpRequest.java, +++ b/spring-web/src/main/java/org/springframework/http/server/ServletServerHttpRequest.java, +++ b/spring-web/src/main/java/org/springframework/http/server/ServerHttpRequest.java, +++ b/spring-web/src/main/java/org/springframework/http/server/ServletServerHttpRequest.java, +++ b/spring-web/src/test/java/org/springframework/http/server/ServletServerHttpRequestTests.java, +++ b/spring-web/src/main/java/org/springframework/http/server/ServerHttpRequest.java, +++ b/spring-web/src/main/java/org/springframework/http/server/ServletServerHttpRequest.java, +++ b/spring-web/src/test/java/org/springframework/http/server/ServletServerHttpRequestTests.java, +++ b/spring-websocket/src/main/java/org/springframework/web/socket/sockjs/transport/handler/AbstractHttpSendingTransportHandler.java, +import java.io.UnsupportedEncodingException;, +import org.springframework.util.MultiValueMap;, +import org.springframework.util.StringUtils;, +import org.springframework.web.util.UriComponentsBuilder;, +import org.springframework.web.util.UriUtils;, +	protected final String getCallbackParam(ServerHttpRequest request) {, +		String query = request.getURI().getQuery();, +		MultiValueMap<String, String> params = UriComponentsBuilder.newInstance().query(query).build().getQueryParams();, +		String value = params.getFirst("c");, +		try {, +			return StringUtils.isEmpty(value) ? null : UriUtils.decode(value, "UTF-8");, +		}, +		catch (UnsupportedEncodingException e) {, +			// should never happen, +			throw new SockJsException("Unable to decode callback query parameter", null, e);, +		}, +	}, +, +++ b/spring-web/src/main/java/org/springframework/http/server/ServerHttpRequest.java, +++ b/spring-web/src/main/java/org/springframework/http/server/ServletServerHttpRequest.java, +++ b/spring-web/src/test/java/org/springframework/http/server/ServletServerHttpRequestTests.java, +++ b/spring-websocket/src/main/java/org/springframework/web/socket/sockjs/transport/handler/AbstractHttpSendingTransportHandler.java, +import java.io.UnsupportedEncodingException;, +import org.springframework.util.MultiValueMap;, +import org.springframework.util.StringUtils;, +import org.springframework.web.util.UriComponentsBuilder;, +import org.springframework.web.util.UriUtils;, +	protected final String getCallbackParam(ServerHttpRequest request) {, +		String query = request.getURI().getQuery();, +		MultiValueMap<String, String> params = UriComponentsBuilder.newInstance().query(query).build().getQueryParams();, +		String value = params.getFirst("c");, +		try {, +			return StringUtils.isEmpty(value) ? null : UriUtils.decode(value, "UTF-8");, +		}, +		catch (UnsupportedEncodingException e) {, +			// should never happen, +			throw new SockJsException("Unable to decode callback query parameter", null, e);, +		}, +	}, +, +++ b/spring-websocket/src/main/java/org/springframework/web/socket/sockjs/transport/handler/HtmlFileTransportHandler.java, +		String callback = getCallbackParam(request);, +			String callback = getCallbackParam(getRequest());, +++ b/spring-web/src/main/java/org/springframework/http/server/ServerHttpRequest.java, +++ b/spring-web/src/main/java/org/springframework/http/server/ServletServerHttpRequest.java, +++ b/spring-web/src/test/java/org/springframework/http/server/ServletServerHttpRequestTests.java, +++ b/spring-websocket/src/main/java/org/springframework/web/socket/sockjs/transport/handler/AbstractHttpSendingTransportHandler.java, +import java.io.UnsupportedEncodingException;, +import org.springframework.util.MultiValueMap;, +import org.springframework.util.StringUtils;, +import org.springframework.web.util.UriComponentsBuilder;, +import org.springframework.web.util.UriUtils;, +	protected final String getCallbackParam(ServerHttpRequest request) {, +		String query = request.getURI().getQuery();, +		MultiValueMap<String, String> params = UriComponentsBuilder.newInstance().query(query).build().getQueryParams();, +		String value = params.getFirst("c");, +		try {, +			return StringUtils.isEmpty(value) ? null : UriUtils.decode(value, "UTF-8");, +		}, +		catch (UnsupportedEncodingException e) {, +			// should never happen, +			throw new SockJsException("Unable to decode callback query parameter", null, e);, +		}, +	}, +, +++ b/spring-websocket/src/main/java/org/springframework/web/socket/sockjs/transport/handler/HtmlFileTransportHandler.java, +		String callback = getCallbackParam(request);, +			String callback = getCallbackParam(getRequest());, +++ b/spring-websocket/src/main/java/org/springframework/web/socket/sockjs/transport/handler/JsonpPollingTransportHandler.java, +			String callback = getCallbackParam(request);, +		String callback = getCallbackParam(request);]