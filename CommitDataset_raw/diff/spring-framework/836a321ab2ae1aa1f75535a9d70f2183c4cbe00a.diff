[+++ b/spring-orm/src/main/java/org/springframework/orm/jpa/persistenceunit/ClassFileTransformerAdapter.java, + * Copyright 2002-2016 the original author or authors., + * interface based on a JPA {@code ClassTransformer} which a JPA PersistenceProvider, + * asks the {@code PersistenceUnitInfo} to install in the current runtime., + * @author Juergen Hoeller, +, +	private boolean currentlyTransforming = false;, +, +		synchronized (this) {, +			if (this.currentlyTransforming) {, +				// Defensively back out when called from within the transform delegate below:, +				// in particular, for the over-eager transformer implementation in Hibernate 5., +				return null;, +			}, +, +			this.currentlyTransforming = true;, +				if (logger.isErrorEnabled()) {, +					logger.error("Circularity error while weaving class [" + className + "] with " +, +				}, +				throw new IllegalStateException("Failed to weave class [" + className + "]", ex);, +					logger.warn("Error weaving class [" + className + "] with transformer of class [" +, +							this.classTransformer.getClass().getName() + "]", ex);, +			finally {, +				this.currentlyTransforming = false;, +			}, +		}]