[+++ /dev/null, +++ /dev/null, +++ b/spring-web-reactive/src/main/java/org/springframework/core/io/buffer/FlushingDataBuffer.java, +	public FlushingDataBuffer() {, +		this.buffer = new DefaultDataBufferFactory().allocateBuffer(0);, +	}, +, +		return this.buffer.write(source, offset, length);, +, +++ /dev/null, +++ b/spring-web-reactive/src/main/java/org/springframework/core/io/buffer/FlushingDataBuffer.java, +	public FlushingDataBuffer() {, +		this.buffer = new DefaultDataBufferFactory().allocateBuffer(0);, +	}, +, +		return this.buffer.write(source, offset, length);, +, +++ b/spring-web-reactive/src/main/java/org/springframework/http/codec/SseEventEncoder.java, +/*, + * Copyright 2002-2016 the original author or authors., + *, + * Licensed under the Apache License, Version 2.0 (the "License");, + * you may not use this file except in compliance with the License., + * You may obtain a copy of the License at, + *, + *      http://www.apache.org/licenses/LICENSE-2.0, + *, + * Unless required by applicable law or agreed to in writing, software, + * distributed under the License is distributed on an "AS IS" BASIS,, + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied., + * See the License for the specific language governing permissions and, + * limitations under the License., + */, +, +package org.springframework.http.codec;, +, +import java.nio.charset.StandardCharsets;, +import java.util.List;, +import java.util.Optional;, +, +import org.reactivestreams.Publisher;, +import reactor.core.publisher.Flux;, +import reactor.core.publisher.Mono;, +, +import org.springframework.core.ResolvableType;, +import org.springframework.core.codec.CodecException;, +import org.springframework.core.codec.Encoder;, +import org.springframework.core.codec.support.AbstractEncoder;, +import org.springframework.core.io.buffer.DataBuffer;, +import org.springframework.core.io.buffer.DataBufferFactory;, +import org.springframework.core.io.buffer.FlushingDataBuffer;, +import org.springframework.util.Assert;, +import org.springframework.util.MimeType;, +import org.springframework.web.reactive.sse.SseEvent;, +, +/**, + * An encoder for {@link SseEvent}s that also supports any other kind of {@link Object}, + * (in that case, the object will be the data of the {@link SseEvent})., + * @author Sebastien Deleuze, + */, +public class SseEventEncoder extends AbstractEncoder<Object> {, +, +	private final List<Encoder<?>> dataEncoders;, +, +, +	public SseEventEncoder(List<Encoder<?>> dataEncoders) {, +		super(new MimeType("text", "event-stream"));, +		Assert.notNull(dataEncoders, "'dataEncoders' must not be null");, +		this.dataEncoders = dataEncoders;, +	}, +, +	@Override, +	public Flux<DataBuffer> encode(Publisher<?> inputStream, DataBufferFactory bufferFactory,, +			ResolvableType type, MimeType sseMimeType, Object... hints) {, +, +		return Flux.from(inputStream).flatMap(input -> {, +			SseEvent event = (SseEvent.class.equals(type.getRawClass()) ?, +					(SseEvent)input : new SseEvent(input));, +, +			StringBuilder sb = new StringBuilder();, +, +			if (event.getId() != null) {, +				sb.append("id:");, +				sb.append(event.getId());, +				sb.append("\n");, +			}, +, +			if (event.getName() != null) {, +				sb.append("event:");, +				sb.append(event.getName());, +				sb.append("\n");, +			}, +, +			if (event.getReconnectTime() != null) {, +				sb.append("retry:");, +				sb.append(event.getReconnectTime().toString());, +				sb.append("\n");, +			}, +, +			if (event.getComment() != null) {]