[+++ b/org.springframework.web/src/main/java/org/springframework/web/context/ContextLoader.java, + * Copyright 2002-2010 the original author or authors., +	 * Map from (thread context) ClassLoader to corresponding 'current' WebApplicationContext., +	 * The 'current' WebApplicationContext, if the ContextLoader class is, +	 * deployed in the web app ClassLoader itself., +	 */, +	private static volatile WebApplicationContext currentContext;, +, +	/**, +, +			ClassLoader ccl = Thread.currentThread().getContextClassLoader();, +			if (ccl == ContextLoader.class.getClassLoader()) {, +				currentContext = this.context;, +			}, +			else if (ccl != null) {, +				currentContextPerThread.put(ccl, this.context);, +			}, +			ClassLoader ccl = Thread.currentThread().getContextClassLoader();, +			if (ccl == ContextLoader.class.getClassLoader()) {, +				currentContext = null;, +			}, +			else if (ccl != null) {, +				currentContextPerThread.remove(ccl);, +			}, +		ClassLoader ccl = Thread.currentThread().getContextClassLoader();, +		if (ccl != null) {, +			WebApplicationContext ccpt = currentContextPerThread.get(ccl);, +			if (ccpt != null) {, +				return ccpt;, +			}, +		}, +		return currentContext;]