[+++ b/spring-beans/src/main/java/org/springframework/beans/factory/support/DefaultListableBeanFactory.java, +	/** Map of singleton and non-singleton bean names keyed by dependency type */, +	private final Map<Class<?>, String[]> allBeanNamesByType = new ConcurrentHashMap<Class<?>, String[]>(64);, +	/** Map of singleton-only bean names keyed by dependency type */, +	private final Map<Class<?>, String[]> singletonBeanNamesByType = new ConcurrentHashMap<Class<?>, String[]>(64);, +		Map<Class<?>, String[]> cache =, +				(includeNonSingletons ? this.allBeanNamesByType : this.singletonBeanNamesByType);, +		// Remove any assumptions about by-type mappings., +		clearByTypeCache();, +	@Override, +	public void registerSingleton(String beanName, Object singletonObject) throws IllegalStateException {, +		super.registerSingleton(beanName, singletonObject);, +		clearByTypeCache();, +	}, +, +	@Override, +	public void destroySingleton(String beanName) {, +		super.destroySingleton(beanName);, +		clearByTypeCache();, +	}, +, +	/**, +	 * Remove any assumptions about by-type mappings., +	 */, +	private void clearByTypeCache() {, +		this.allBeanNamesByType.clear();, +		this.singletonBeanNamesByType.clear();, +	}, +]