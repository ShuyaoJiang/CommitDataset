[+++ b/spring-core/src/main/java/org/springframework/core/codec/CharSequenceEncoder.java, +	int calculateCapacity(CharSequence sequence, Charset charset) {, +++ b/spring-core/src/main/java/org/springframework/core/codec/CharSequenceEncoder.java, +	int calculateCapacity(CharSequence sequence, Charset charset) {, +++ b/spring-core/src/test/java/org/springframework/core/codec/CharSequenceEncoderTests.java, +import java.nio.charset.Charset;, +import java.util.stream.Stream;, +, +import org.junit.Test;, +import static java.nio.charset.StandardCharsets.ISO_8859_1;, +import static java.nio.charset.StandardCharsets.US_ASCII;, +import static java.nio.charset.StandardCharsets.UTF_16;, +import static java.nio.charset.StandardCharsets.UTF_8;, +	@Test, +	public void calculateCapacity() {, +		String sequence = "Hello World!";, +		Stream.of(UTF_8, UTF_16, ISO_8859_1, US_ASCII, Charset.forName("BIG5")), +				.forEach(charset -> {, +					int capacity = this.encoder.calculateCapacity(sequence, charset);, +					int length = sequence.length();, +					assertTrue(String.format("%s has capacity %d; length %d", charset, capacity, length),, +							capacity >= length);, +				});, +, +	}, +]