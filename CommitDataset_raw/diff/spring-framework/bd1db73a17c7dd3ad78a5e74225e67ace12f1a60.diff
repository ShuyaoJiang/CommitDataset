[+++ b/build.gradle, +configure(allprojects) { project ->, +	group = "org.springframework", +	version = qualifyVersionIfNecessary(version), +, +	test {, +		systemProperty("java.awt.headless", "true"), +		systemProperty("testGroups", properties.get("testGroups")), +	}, +		if (project.name in ["spring", "spring-jms", "spring-orm",, +				"spring-orm-hibernate4", "spring-oxm", "spring-struts",, +				"spring-test", "spring-test-mvc", "spring-tx", "spring-web",, +				"spring-webmvc", "spring-webmvc-portlet", "spring-webmvc-tiles3"]) {, +			testCompile("org.easymock:easymock:${easymockVersion}"), +			testCompile "org.easymock:easymockclassextension:${easymockVersion}", +		}, +		testCompile("javax.inject:javax.inject-tck:1"), +	test {, +		useJUnit(), +		useTestNG(), +	}, +, +/*, + * Support publication of artifacts versioned by topic branch., + * CI builds supply `-P BRANCH_NAME=<TOPIC>` to gradle at build time., + * If <TOPIC> starts with 'SPR-', change version, + *     from BUILD-SNAPSHOT => <TOPIC>-SNAPSHOT, + *     e.g. 3.2.1.BUILD-SNAPSHOT => 3.2.1.SPR-1234-SNAPSHOT, + */, +def qualifyVersionIfNecessary(version) {, +	if (rootProject.hasProperty("BRANCH_NAME")) {, +		def qualifier = rootProject.getProperty("BRANCH_NAME"), +		if (qualifier.startsWith("SPR-")) {, +			return version.replace('BUILD', qualifier), +		}, +	}, +	return version, +}, +++ b/build.gradle, +configure(allprojects) { project ->, +	group = "org.springframework", +	version = qualifyVersionIfNecessary(version), +, +	test {, +		systemProperty("java.awt.headless", "true"), +		systemProperty("testGroups", properties.get("testGroups")), +	}, +		if (project.name in ["spring", "spring-jms", "spring-orm",, +				"spring-orm-hibernate4", "spring-oxm", "spring-struts",, +				"spring-test", "spring-test-mvc", "spring-tx", "spring-web",, +				"spring-webmvc", "spring-webmvc-portlet", "spring-webmvc-tiles3"]) {, +			testCompile("org.easymock:easymock:${easymockVersion}"), +			testCompile "org.easymock:easymockclassextension:${easymockVersion}", +		}, +		testCompile("javax.inject:javax.inject-tck:1"), +	test {, +		useJUnit(), +		useTestNG(), +	}, +, +/*, + * Support publication of artifacts versioned by topic branch., + * CI builds supply `-P BRANCH_NAME=<TOPIC>` to gradle at build time., + * If <TOPIC> starts with 'SPR-', change version, + *     from BUILD-SNAPSHOT => <TOPIC>-SNAPSHOT, + *     e.g. 3.2.1.BUILD-SNAPSHOT => 3.2.1.SPR-1234-SNAPSHOT, + */, +def qualifyVersionIfNecessary(version) {, +	if (rootProject.hasProperty("BRANCH_NAME")) {, +		def qualifier = rootProject.getProperty("BRANCH_NAME"), +		if (qualifier.startsWith("SPR-")) {, +			return version.replace('BUILD', qualifier), +		}, +	}, +	return version, +}, +++ b/buildSrc/src/main/groovy/org/springframework/build/gradle/TestSourceSetDependenciesPlugin.groovy, +			Set<ProjectDependency> projectDependencies = new LinkedHashSet<ProjectDependency>(), +++ b/build.gradle, +configure(allprojects) { project ->, +	group = "org.springframework", +	version = qualifyVersionIfNecessary(version), +, +	test {, +		systemProperty("java.awt.headless", "true"), +		systemProperty("testGroups", properties.get("testGroups")), +	}, +		if (project.name in ["spring", "spring-jms", "spring-orm",, +				"spring-orm-hibernate4", "spring-oxm", "spring-struts",, +				"spring-test", "spring-test-mvc", "spring-tx", "spring-web",, +				"spring-webmvc", "spring-webmvc-portlet", "spring-webmvc-tiles3"]) {, +			testCompile("org.easymock:easymock:${easymockVersion}"), +			testCompile "org.easymock:easymockclassextension:${easymockVersion}", +		}, +		testCompile("javax.inject:javax.inject-tck:1"), +	test {, +		useJUnit(), +		useTestNG(), +	}, +]