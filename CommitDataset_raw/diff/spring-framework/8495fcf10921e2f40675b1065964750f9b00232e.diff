[+++ b/spring-web/src/main/java/org/springframework/web/context/request/ServletRequestAttributes.java, + * Copyright 2002-2016 the original author or authors., +			HttpSession session = this.request.getSession(allowCreate);, +			this.session = session;, +			return session;, +			HttpSession session = this.session;, +			if (session == null) {, +				if (allowCreate) {, +				else {, +					session = this.request.getSession(false);, +					this.session = session;, +				}, +			}, +			return session;, +		if (!this.sessionAttributesToUpdate.isEmpty()) {, +			HttpSession session = getSession(false);, +			if (session != null) {, +						Object oldValue = session.getAttribute(name);, +							session.setAttribute(name, newValue);, +	}, +++ b/spring-web/src/main/java/org/springframework/web/context/request/ServletRequestAttributes.java, + * Copyright 2002-2016 the original author or authors., +			HttpSession session = this.request.getSession(allowCreate);, +			this.session = session;, +			return session;, +			HttpSession session = this.session;, +			if (session == null) {, +				if (allowCreate) {, +				else {, +					session = this.request.getSession(false);, +					this.session = session;, +				}, +			}, +			return session;, +		if (!this.sessionAttributesToUpdate.isEmpty()) {, +			HttpSession session = getSession(false);, +			if (session != null) {, +						Object oldValue = session.getAttribute(name);, +							session.setAttribute(name, newValue);, +	}, +++ b/spring-web/src/test/java/org/springframework/web/context/request/ServletRequestAttributesTests.java, + * Copyright 2002-2016 the original author or authors., +		assertSame(VALUE, session.getAttribute(KEY));, +		assertSame(VALUE, attrs.getAttribute(KEY, RequestAttributes.SCOPE_SESSION));, +		assertSame(VALUE, session.getAttribute(KEY));, +		assertSame(VALUE, session.getAttribute(KEY));, +		assertSame(VALUE, attrs.getAttribute(KEY, RequestAttributes.SCOPE_GLOBAL_SESSION));, +		assertSame(VALUE, session.getAttribute(KEY));, +++ b/spring-web/src/main/java/org/springframework/web/context/request/ServletRequestAttributes.java, + * Copyright 2002-2016 the original author or authors., +			HttpSession session = this.request.getSession(allowCreate);, +			this.session = session;, +			return session;, +			HttpSession session = this.session;, +			if (session == null) {, +				if (allowCreate) {, +				else {, +					session = this.request.getSession(false);, +					this.session = session;, +				}, +			}, +			return session;, +		if (!this.sessionAttributesToUpdate.isEmpty()) {, +			HttpSession session = getSession(false);, +			if (session != null) {, +						Object oldValue = session.getAttribute(name);, +							session.setAttribute(name, newValue);, +	}, +++ b/spring-web/src/test/java/org/springframework/web/context/request/ServletRequestAttributesTests.java, + * Copyright 2002-2016 the original author or authors., +		assertSame(VALUE, session.getAttribute(KEY));, +		assertSame(VALUE, attrs.getAttribute(KEY, RequestAttributes.SCOPE_SESSION));, +		assertSame(VALUE, session.getAttribute(KEY));, +		assertSame(VALUE, session.getAttribute(KEY));, +		assertSame(VALUE, attrs.getAttribute(KEY, RequestAttributes.SCOPE_GLOBAL_SESSION));, +		assertSame(VALUE, session.getAttribute(KEY));, +++ b/spring-webmvc-portlet/src/main/java/org/springframework/web/portlet/context/PortletRequestAttributes.java, + * Copyright 2002-2016 the original author or authors., +			PortletSession session = this.request.getPortletSession(allowCreate);, +			this.session = session;, +			return session;, +			PortletSession session = this.session;, +			if (session == null) {, +				if (allowCreate) {, +				else {, +					session = this.request.getPortletSession(false);, +					this.session = session;, +				}, +			}, +			return session;, +		if (!this.sessionAttributesToUpdate.isEmpty() || !this.globalSessionAttributesToUpdate.isEmpty()) {, +			PortletSession session = getSession(false);, +			if (session != null) {, +						Object oldValue = session.getAttribute(name);, +							session.setAttribute(name, newValue);, +						Object oldValue = session.getAttribute(name, PortletSession.APPLICATION_SCOPE);, +							session.setAttribute(name, newValue, PortletSession.APPLICATION_SCOPE);, +	}, +++ b/spring-web/src/main/java/org/springframework/web/context/request/ServletRequestAttributes.java, + * Copyright 2002-2016 the original author or authors.]