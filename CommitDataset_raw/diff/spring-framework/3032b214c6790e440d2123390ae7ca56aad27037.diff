[+++ b/org.springframework.orm/src/main/java/org/springframework/orm/jpa/vendor/HibernateJpaDialect.java, +import org.springframework.util.ClassUtils;, +	private static final Method getEntityManagerFactoryMethod =, +			ClassUtils.getMethodIfAvailable(EntityManager.class, "getEntityManagerFactory");, +, +, +		if (getEntityManagerFactoryMethod != null) {, +			// We're on JPA 2.0, enabling our exposure of the underlying Session, +			// to the underlying SessionFactory as transaction resource reference., +			EntityManagerFactory emf =, +					(EntityManagerFactory) ReflectionUtils.invokeMethod(getEntityManagerFactoryMethod, entityManager);, +		}]