[+++ b/spring-orm-hibernate5/src/main/java/org/springframework/orm/hibernate5/SessionFactoryUtils.java, +import java.util.Map;, +import org.springframework.util.ClassUtils;, +		Method getProperties = ClassUtils.getMethodIfAvailable(sessionFactory.getClass(), "getProperties");, +		if (getProperties != null) {, +			Map<?, ?> props = (Map<?, ?>) ReflectionUtils.invokeMethod(getProperties, sessionFactory);, +			Object dataSourceValue = props.get(Environment.DATASOURCE);, +		}, +		if (sessionFactory instanceof SessionFactoryImplementor) {, +			SessionFactoryImplementor sfi = (SessionFactoryImplementor) sessionFactory;]