[+++ b/spring-web/src/main/java/org/springframework/web/util/ContentCachingResponseWrapper.java, +	private Integer contentLength;, +, +		copyBodyToResponse(false);, +		try {, +		}, +		catch (IllegalStateException ex) {, +			// Possibly on Tomcat when called too late: fall back to silent setStatus, +			super.setStatus(sc);, +		}, +	@SuppressWarnings("deprecation"), +		copyBodyToResponse(false);, +		try {, +		}, +		catch (IllegalStateException ex) {, +			// Possibly on Tomcat when called too late: fall back to silent setStatus, +			super.setStatus(sc, msg);, +		}, +		copyBodyToResponse(false);, +		this.contentLength = len;, +		int lenInt = (int) len;, +		this.content.resize(lenInt);, +		this.contentLength = lenInt;, +	/**, +	 * Return an {@link InputStream} to the cached content., +	 */, +	public InputStream getContentInputStream(){, +		return this.content.getInputStream();, +	}, +, +	/**, +	 * Return the current size of the cached content., +	 */, +	public int getContentSize(){, +		return this.content.size();, +	}, +, +	/**, +	 * Copy the complete cached body content to the response., +	 */, +		copyBodyToResponse(true);, +	}, +, +	/**, +	 * Copy the cached body content to the response., +	 * @param complete whether to set a corresponding content length, +	 * for the complete cached body content, +	 */, +	protected void copyBodyToResponse(boolean complete) throws IOException {, +			if ((complete || this.contentLength != null) && !rawResponse.isCommitted()){, +				rawResponse.setContentLength(complete ? this.content.size() : this.contentLength);, +				this.contentLength = null;, +++ b/spring-web/src/main/java/org/springframework/web/util/ContentCachingResponseWrapper.java, +	private Integer contentLength;, +, +		copyBodyToResponse(false);, +		try {, +		}, +		catch (IllegalStateException ex) {, +			// Possibly on Tomcat when called too late: fall back to silent setStatus, +			super.setStatus(sc);, +		}, +	@SuppressWarnings("deprecation"), +		copyBodyToResponse(false);, +		try {, +		}, +		catch (IllegalStateException ex) {, +			// Possibly on Tomcat when called too late: fall back to silent setStatus, +			super.setStatus(sc, msg);, +		}, +		copyBodyToResponse(false);, +		this.contentLength = len;, +		int lenInt = (int) len;, +		this.content.resize(lenInt);, +		this.contentLength = lenInt;, +	/**, +	 * Return an {@link InputStream} to the cached content., +	 */, +	public InputStream getContentInputStream(){, +		return this.content.getInputStream();, +	}, +, +	/**, +	 * Return the current size of the cached content., +	 */, +	public int getContentSize(){, +		return this.content.size();, +	}, +, +	/**, +	 * Copy the complete cached body content to the response., +	 */, +		copyBodyToResponse(true);, +	}, +, +	/**, +	 * Copy the cached body content to the response., +	 * @param complete whether to set a corresponding content length, +	 * for the complete cached body content, +	 */]