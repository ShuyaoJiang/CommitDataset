[+++ b/spring-core/src/main/java/org/springframework/core/io/support/SpringFactoriesLoader.java, + * Copyright 2002-2017 the original author or authors., +import java.util.Collections;, +import java.util.Map;, +import org.springframework.util.ConcurrentReferenceHashMap;, +import org.springframework.util.LinkedMultiValueMap;, +import org.springframework.util.MultiValueMap;, +	private static Map<ClassLoader, MultiValueMap<String, String>> cache = new ConcurrentReferenceHashMap<>();, +, +		return loadSpringFactories(classLoader).getOrDefault(factoryClassName,, +				Collections.emptyList());, +	}, +, +	private static Map<String, List<String>> loadSpringFactories(, +			ClassLoader classLoader) {, +		MultiValueMap<String, String> result = cache.get(classLoader);, +		if (result != null), +			return result;, +			Enumeration<URL> urls = (classLoader != null, +					? classLoader.getResources(FACTORIES_RESOURCE_LOCATION), +					: ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));, +			result = new LinkedMultiValueMap<>();, +				UrlResource resource = new UrlResource(url);, +				Properties properties = PropertiesLoaderUtils.loadProperties(resource);, +				for (Map.Entry<?, ?> entry : properties.entrySet()) {, +					List<String> factoryClassNames = Arrays.asList(, +							StringUtils.commaDelimitedListToStringArray((String) entry.getValue()));, +					result.addAll((String) entry.getKey(), factoryClassNames);, +			}, +			cache.put(classLoader, result);, +			throw new IllegalArgumentException("Unable to load factories from location [", +					+ FACTORIES_RESOURCE_LOCATION + "]", ex);]