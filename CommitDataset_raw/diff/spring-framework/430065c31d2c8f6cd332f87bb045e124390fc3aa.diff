[+++ b/spring-messaging/src/main/java/org/springframework/messaging/simp/config/AbstractMessageBrokerConfiguration.java, +import org.springframework.context.event.SmartApplicationListener;, +	@SuppressWarnings("deprecation"), +		SimpUserRegistry registry = createLocalUserRegistry();, +		if (registry == null) {, +			registry = createLocalUserRegistry(getBrokerRegistry().getUserRegistryOrder());, +		}, +		boolean broadcast = getBrokerRegistry().getUserRegistryBroadcast() != null;, +		return (broadcast ? new MultiServerUserRegistry(registry) : registry);, +	 * Create the user registry that provides access to local users., +	 * @deprecated as of 5.1 in favor of {@link #createLocalUserRegistry(Integer)}, +	@Deprecated, +	@Nullable, +	protected SimpUserRegistry createLocalUserRegistry() {, +		return null;, +	}, +, +	/**, +	 * Create the user registry that provides access to local users., +	 * @param order the order to use as a {@link SmartApplicationListener}., +	 * @since 5.1, +	 */, +	protected abstract SimpUserRegistry createLocalUserRegistry(@Nullable Integer order);, +++ b/spring-messaging/src/main/java/org/springframework/messaging/simp/config/AbstractMessageBrokerConfiguration.java, +import org.springframework.context.event.SmartApplicationListener;, +	@SuppressWarnings("deprecation"), +		SimpUserRegistry registry = createLocalUserRegistry();, +		if (registry == null) {, +			registry = createLocalUserRegistry(getBrokerRegistry().getUserRegistryOrder());, +		}, +		boolean broadcast = getBrokerRegistry().getUserRegistryBroadcast() != null;, +		return (broadcast ? new MultiServerUserRegistry(registry) : registry);, +	 * Create the user registry that provides access to local users., +	 * @deprecated as of 5.1 in favor of {@link #createLocalUserRegistry(Integer)}, +	@Deprecated, +	@Nullable, +	protected SimpUserRegistry createLocalUserRegistry() {, +		return null;, +	}, +, +	/**, +	 * Create the user registry that provides access to local users., +	 * @param order the order to use as a {@link SmartApplicationListener}., +	 * @since 5.1, +	 */, +	protected abstract SimpUserRegistry createLocalUserRegistry(@Nullable Integer order);, +++ b/spring-messaging/src/main/java/org/springframework/messaging/simp/config/MessageBrokerRegistry.java, +import org.springframework.context.event.SmartApplicationListener;, +	private Integer userRegistryOrder;, +, +	@Nullable, +	 * Set the order for the, +	 * {@link org.springframework.messaging.simp.user.SimpUserRegistry, +	 * SimpUserRegistry} to use as a {@link SmartApplicationListener}., +	 * @param order the order value, +	 * @since 5.0.8, +	 */, +	public void setUserRegistryOrder(int order) {, +		this.userRegistryOrder = order;, +	}, +, +	@Nullable, +	protected Integer getUserRegistryOrder() {, +		return this.userRegistryOrder;, +	}, +, +	/**, +++ b/spring-messaging/src/main/java/org/springframework/messaging/simp/config/AbstractMessageBrokerConfiguration.java, +import org.springframework.context.event.SmartApplicationListener;, +	@SuppressWarnings("deprecation"), +		SimpUserRegistry registry = createLocalUserRegistry();, +		if (registry == null) {, +			registry = createLocalUserRegistry(getBrokerRegistry().getUserRegistryOrder());, +		}, +		boolean broadcast = getBrokerRegistry().getUserRegistryBroadcast() != null;, +		return (broadcast ? new MultiServerUserRegistry(registry) : registry);, +	 * Create the user registry that provides access to local users., +	 * @deprecated as of 5.1 in favor of {@link #createLocalUserRegistry(Integer)}, +	@Deprecated, +	@Nullable, +	protected SimpUserRegistry createLocalUserRegistry() {, +		return null;, +	}, +, +	/**, +	 * Create the user registry that provides access to local users., +	 * @param order the order to use as a {@link SmartApplicationListener}., +	 * @since 5.1, +	 */, +	protected abstract SimpUserRegistry createLocalUserRegistry(@Nullable Integer order);, +++ b/spring-messaging/src/main/java/org/springframework/messaging/simp/config/MessageBrokerRegistry.java, +import org.springframework.context.event.SmartApplicationListener;, +	private Integer userRegistryOrder;, +, +	@Nullable, +	 * Set the order for the, +	 * {@link org.springframework.messaging.simp.user.SimpUserRegistry, +	 * SimpUserRegistry} to use as a {@link SmartApplicationListener}., +	 * @param order the order value, +	 * @since 5.0.8]