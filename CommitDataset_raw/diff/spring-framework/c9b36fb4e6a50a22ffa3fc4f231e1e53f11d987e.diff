[+++ b/org.springframework.transaction/src/main/java/org/springframework/transaction/support/TransactionSynchronizationManager.java, +			// Remove entire ThreadLocal if empty..., +			if (map.isEmpty()) {, +				resources.remove();, +			}, +		Object oldValue = map.put(actualKey, value);, +		// Transparently suppress a ResourceHolder that was marked as void..., +		if (oldValue instanceof ResourceHolder && ((ResourceHolder) oldValue).isVoid()) {, +			oldValue = null;, +		}, +		if (oldValue != null) {, +			throw new IllegalStateException("Already value [" + oldValue + "] for key [" +, +		// Transparently suppress a ResourceHolder that was marked as void..., +		if (value instanceof ResourceHolder && ((ResourceHolder) value).isVoid()) {, +			value = null;, +		}]