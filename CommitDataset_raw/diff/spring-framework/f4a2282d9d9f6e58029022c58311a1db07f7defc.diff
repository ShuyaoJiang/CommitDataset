[+++ b/org.springframework.core/src/main/java/org/springframework/util/StringUtils.java, + * Copyright 2002-2011 the original author or authors., +	 * Parse the given <code>localeString</code> value into a {@link Locale}., +		for (int i = 0; i < localeString.length(); i++) {, +			char ch = localeString.charAt(i);, +			if (ch != '_' && !Character.isLetterOrDigit(ch)) {, +				throw new IllegalArgumentException(, +						"Locale value \"" + localeString + "\" contains invalid characters");, +			}, +		}, +++ b/org.springframework.core/src/main/java/org/springframework/util/StringUtils.java, + * Copyright 2002-2011 the original author or authors., +	 * Parse the given <code>localeString</code> value into a {@link Locale}., +		for (int i = 0; i < localeString.length(); i++) {, +			char ch = localeString.charAt(i);, +			if (ch != '_' && !Character.isLetterOrDigit(ch)) {, +				throw new IllegalArgumentException(, +						"Locale value \"" + localeString + "\" contains invalid characters");, +			}, +		}, +++ b/org.springframework.core/src/test/java/org/springframework/util/StringUtilsTests.java, + * Copyright 2002-2011 the original author or authors., +	/**, +	 * <a href="http://opensource.atlassian.com/projects/spring/browse/SPR-7779">See SPR-7779</a>., +	 */, +	public void testParseLocaleWithInvalidCharacters() {, +		try {, +			StringUtils.parseLocaleString("%0D%0AContent-length:30%0D%0A%0D%0A%3Cscript%3Ealert%28123%29%3C/script%3E");, +			fail("Should have thrown IllegalArgumentException");, +		}, +		catch (IllegalArgumentException ex) {, +			// expected, +		}, +	}, +, +++ b/org.springframework.core/src/main/java/org/springframework/util/StringUtils.java, + * Copyright 2002-2011 the original author or authors., +	 * Parse the given <code>localeString</code> value into a {@link Locale}., +		for (int i = 0; i < localeString.length(); i++) {, +			char ch = localeString.charAt(i);, +			if (ch != '_' && !Character.isLetterOrDigit(ch)) {, +				throw new IllegalArgumentException(, +						"Locale value \"" + localeString + "\" contains invalid characters");, +			}, +		}, +++ b/org.springframework.core/src/test/java/org/springframework/util/StringUtilsTests.java, + * Copyright 2002-2011 the original author or authors., +	/**, +	 * <a href="http://opensource.atlassian.com/projects/spring/browse/SPR-7779">See SPR-7779</a>., +	 */, +	public void testParseLocaleWithInvalidCharacters() {, +		try {, +			StringUtils.parseLocaleString("%0D%0AContent-length:30%0D%0A%0D%0A%3Cscript%3Ealert%28123%29%3C/script%3E");, +			fail("Should have thrown IllegalArgumentException");, +		}, +		catch (IllegalArgumentException ex) {, +			// expected, +		}, +	}, +, +++ b/org.springframework.web.servlet/src/main/java/org/springframework/web/servlet/i18n/LocaleChangeInterceptor.java, + * Copyright 2002-2011 the original author or authors., +import org.springframework.util.StringUtils;, +			localeResolver.setLocale(request, response, StringUtils.parseLocaleString(newLocale));]