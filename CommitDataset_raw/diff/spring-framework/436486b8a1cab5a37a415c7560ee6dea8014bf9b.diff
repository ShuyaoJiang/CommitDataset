[+++ b/spring-webmvc/src/main/java/org/springframework/web/servlet/resource/ResourceHttpRequestHandler.java, +import org.springframework.beans.factory.SmartInitializingSingleton;, +		implements HttpRequestHandler, InitializingBean, SmartInitializingSingleton, CorsConfigurationSource {, +	private PathExtensionContentNegotiationStrategy pathExtensionStrategy;, +	@Override, +	public void afterSingletonsInstantiated() {, +		this.pathExtensionStrategy = initContentNegotiationStrategy();, +	}, +, +	protected PathExtensionContentNegotiationStrategy initContentNegotiationStrategy() {, +		return (getServletContext() != null) ?, +			new ServletPathExtensionContentNegotiationStrategy(getServletContext(), mediaTypes) :, +			new PathExtensionContentNegotiationStrategy(mediaTypes);, +++ b/spring-webmvc/src/main/java/org/springframework/web/servlet/resource/ResourceHttpRequestHandler.java, +import org.springframework.beans.factory.SmartInitializingSingleton;, +		implements HttpRequestHandler, InitializingBean, SmartInitializingSingleton, CorsConfigurationSource {, +	private PathExtensionContentNegotiationStrategy pathExtensionStrategy;, +	@Override, +	public void afterSingletonsInstantiated() {, +		this.pathExtensionStrategy = initContentNegotiationStrategy();, +	}, +, +	protected PathExtensionContentNegotiationStrategy initContentNegotiationStrategy() {, +		return (getServletContext() != null) ?, +			new ServletPathExtensionContentNegotiationStrategy(getServletContext(), mediaTypes) :, +			new PathExtensionContentNegotiationStrategy(mediaTypes);, +++ b/spring-webmvc/src/test/java/org/springframework/web/servlet/config/annotation/ResourceHandlerRegistryTests.java, +		handler.afterPropertiesSet();, +		handler.afterSingletonsInstantiated();, +++ b/spring-webmvc/src/main/java/org/springframework/web/servlet/resource/ResourceHttpRequestHandler.java, +import org.springframework.beans.factory.SmartInitializingSingleton;, +		implements HttpRequestHandler, InitializingBean, SmartInitializingSingleton, CorsConfigurationSource {, +	private PathExtensionContentNegotiationStrategy pathExtensionStrategy;, +	@Override, +	public void afterSingletonsInstantiated() {, +		this.pathExtensionStrategy = initContentNegotiationStrategy();, +	}, +, +	protected PathExtensionContentNegotiationStrategy initContentNegotiationStrategy() {, +		return (getServletContext() != null) ?, +			new ServletPathExtensionContentNegotiationStrategy(getServletContext(), mediaTypes) :, +			new PathExtensionContentNegotiationStrategy(mediaTypes);, +++ b/spring-webmvc/src/test/java/org/springframework/web/servlet/config/annotation/ResourceHandlerRegistryTests.java, +		handler.afterPropertiesSet();, +		handler.afterSingletonsInstantiated();, +++ b/spring-webmvc/src/test/java/org/springframework/web/servlet/resource/ResourceHttpRequestHandlerTests.java, +		this.handler.afterSingletonsInstantiated();, +		this.handler.afterSingletonsInstantiated();, +		handler.afterSingletonsInstantiated();, +		handler.afterSingletonsInstantiated();, +		handler.afterSingletonsInstantiated();, +		handler.afterSingletonsInstantiated();]