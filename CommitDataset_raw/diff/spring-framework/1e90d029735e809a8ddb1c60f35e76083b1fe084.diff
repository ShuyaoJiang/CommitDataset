[+++ b/spring-webmvc/src/main/java/org/springframework/web/servlet/support/ServletUriComponentsBuilder.java, +		String host = request.getServerName();, +		String xForwardedHostHeader = request.getHeader("X-Forwarded-Host");, +, +		if (StringUtils.hasText(xForwardedHostHeader)) {, +			if (StringUtils.countOccurrencesOf(xForwardedHostHeader, ":") == 1) {, +				String[] hostAndPort = StringUtils.split(xForwardedHostHeader, ":");, +				host  = hostAndPort[0];, +				port = Integer.parseInt(hostAndPort[1]);, +			}, +			else {, +				host = xForwardedHostHeader;, +			}, +		}, +++ b/spring-webmvc/src/main/java/org/springframework/web/servlet/support/ServletUriComponentsBuilder.java, +		String host = request.getServerName();, +		String xForwardedHostHeader = request.getHeader("X-Forwarded-Host");, +, +		if (StringUtils.hasText(xForwardedHostHeader)) {, +			if (StringUtils.countOccurrencesOf(xForwardedHostHeader, ":") == 1) {, +				String[] hostAndPort = StringUtils.split(xForwardedHostHeader, ":");, +				host  = hostAndPort[0];, +				port = Integer.parseInt(hostAndPort[1]);, +			}, +			else {, +				host = xForwardedHostHeader;, +			}, +		}, +++ b/spring-webmvc/src/test/java/org/springframework/web/servlet/support/ServletUriComponentsBuilderTests.java, +import org.springframework.web.util.UriComponents;, +, +import static org.junit.Assert.*;, +	// SPR-10701, +, +	@Test, +	public void fromRequestWithForwardedHostAndPortHeader() {, +		request.addHeader("X-Forwarded-Host", "webtest.foo.bar.com:443");, +		request.setRequestURI("/mvc-showcase/data/param");, +		request.setQueryString("foo=123");, +		UriComponents result = ServletUriComponentsBuilder.fromRequest(request).build();, +, +		assertEquals("webtest.foo.bar.com", result.getHost());, +		assertEquals(443, result.getPort());, +	}, +]