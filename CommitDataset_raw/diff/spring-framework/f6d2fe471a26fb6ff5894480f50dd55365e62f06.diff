[+++ b/spring-test/src/main/java/org/springframework/test/web/servlet/setup/DefaultMockMvcBuilder.java, + * Copyright 2002-2015 the original author or authors., +import org.springframework.context.ApplicationContext;, +import org.springframework.web.context.support.WebApplicationContextUtils;, + * A concrete implementation of {@link AbstractMockMvcBuilder} that provides, + * the {@link WebApplicationContext} supplied to it as a constructor argument., + *, + * <p>In addition, if the {@link ServletContext} in the supplied, + * {@code WebApplicationContext} does not contain an entry for the, + * {@link WebApplicationContext#ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE}, + * key, the root {@code WebApplicationContext} will be detected and stored, + * in the {@code ServletContext} under the, + * {@code ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE} key., + * @author Sam Brannen, +, +		ApplicationContext rootWac = WebApplicationContextUtils.getWebApplicationContext(servletContext);, +, +		if (rootWac == null) {, +			rootWac = this.webAppContext;, +			ApplicationContext parent = this.webAppContext.getParent();, +			while (parent != null) {, +				if (parent instanceof WebApplicationContext && !(parent.getParent() instanceof WebApplicationContext)) {, +					rootWac = parent;, +					break;, +				}, +				parent = parent.getParent();, +			}, +			servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, rootWac);, +		}, +, +++ b/spring-test/src/main/java/org/springframework/test/web/servlet/setup/DefaultMockMvcBuilder.java, + * Copyright 2002-2015 the original author or authors., +import org.springframework.context.ApplicationContext;, +import org.springframework.web.context.support.WebApplicationContextUtils;, + * A concrete implementation of {@link AbstractMockMvcBuilder} that provides, + * the {@link WebApplicationContext} supplied to it as a constructor argument., + *, + * <p>In addition, if the {@link ServletContext} in the supplied, + * {@code WebApplicationContext} does not contain an entry for the, + * {@link WebApplicationContext#ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE}, + * key, the root {@code WebApplicationContext} will be detected and stored, + * in the {@code ServletContext} under the, + * {@code ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE} key., + * @author Sam Brannen, +, +		ApplicationContext rootWac = WebApplicationContextUtils.getWebApplicationContext(servletContext);, +, +		if (rootWac == null) {, +			rootWac = this.webAppContext;, +			ApplicationContext parent = this.webAppContext.getParent();, +			while (parent != null) {, +				if (parent instanceof WebApplicationContext && !(parent.getParent() instanceof WebApplicationContext)) {, +					rootWac = parent;, +					break;, +				}, +				parent = parent.getParent();, +			}, +			servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, rootWac);, +		}, +, +++ b/spring-test/src/main/java/org/springframework/test/web/servlet/setup/StandaloneMockMvcBuilder.java, + * A {@code MockMvcBuilder} that accepts {@code @Controller} registrations, + * thus allowing full control over the instantiation and initialization of, + * controllers and their dependencies similar to plain unit tests, and also, + * making it possible to test one controller at a time., + * also provides methods for customization. The resulting configuration and, + * customization options are equivalent to using MVC Java config except, + * request performed (see {@link #setSingleView(View)}) or provide a list of, + * {@code ViewResolver}s (see {@link #setViewResolvers(ViewResolver...)})., +++ b/spring-test/src/main/java/org/springframework/test/web/servlet/setup/DefaultMockMvcBuilder.java, + * Copyright 2002-2015 the original author or authors., +import org.springframework.context.ApplicationContext;, +import org.springframework.web.context.support.WebApplicationContextUtils;, + * A concrete implementation of {@link AbstractMockMvcBuilder} that provides, + * the {@link WebApplicationContext} supplied to it as a constructor argument., + *, + * <p>In addition, if the {@link ServletContext} in the supplied, + * {@code WebApplicationContext} does not contain an entry for the, + * {@link WebApplicationContext#ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE}, + * key, the root {@code WebApplicationContext} will be detected and stored, + * in the {@code ServletContext} under the, + * {@code ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE} key., + * @author Sam Brannen, +, +		ApplicationContext rootWac = WebApplicationContextUtils.getWebApplicationContext(servletContext);, +, +		if (rootWac == null) {, +			rootWac = this.webAppContext;, +			ApplicationContext parent = this.webAppContext.getParent();, +			while (parent != null) {, +				if (parent instanceof WebApplicationContext && !(parent.getParent() instanceof WebApplicationContext)) {, +					rootWac = parent;, +					break;, +				}, +				parent = parent.getParent();, +			}, +			servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, rootWac);, +		}, +, +++ b/spring-test/src/main/java/org/springframework/test/web/servlet/setup/StandaloneMockMvcBuilder.java]