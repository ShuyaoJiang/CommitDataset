[+++ b/spring-orm/src/main/java/org/springframework/orm/jpa/JpaVendorAdapter.java, +	 * <p><b>NOTE:</b> This variant will only be invoked in case of Java EE style, +	 * container bootstrapping where a {@link PersistenceUnitInfo} is present, +	 * (i.e. {@link LocalContainerEntityManagerFactoryBean}. In case of simple, +	 * Java SE style bootstrapping via {@link javax.persistence.Persistence}, +	 * (i.e. {@link LocalEntityManagerFactoryBean}), the parameter-less, +	 * {@link #getJpaPropertyMap()} variant will be called directly., +++ b/spring-orm/src/main/java/org/springframework/orm/jpa/JpaVendorAdapter.java, +	 * <p><b>NOTE:</b> This variant will only be invoked in case of Java EE style, +	 * container bootstrapping where a {@link PersistenceUnitInfo} is present, +	 * (i.e. {@link LocalContainerEntityManagerFactoryBean}. In case of simple, +	 * Java SE style bootstrapping via {@link javax.persistence.Persistence}, +	 * (i.e. {@link LocalEntityManagerFactoryBean}), the parameter-less, +	 * {@link #getJpaPropertyMap()} variant will be called directly., +++ b/spring-orm/src/main/java/org/springframework/orm/jpa/vendor/HibernateJpaVendorAdapter.java, +		return buildJpaPropertyMap(this.jpaDialect.prepareConnection &&, +				pui.getTransactionType() != PersistenceUnitTransactionType.JTA);, +		return buildJpaPropertyMap(this.jpaDialect.prepareConnection);, +	}, +, +	private Map<String, Object> buildJpaPropertyMap(boolean connectionReleaseOnClose) {, +		if (connectionReleaseOnClose) {, +			// Hibernate 5.1/5.2: manually enforce connection release mode ON_CLOSE (the former default), +			try {, +				// Try Hibernate 5.2, +				AvailableSettings.class.getField("CONNECTION_HANDLING");, +				jpaProperties.put("hibernate.connection.handling_mode", "DELAYED_ACQUISITION_AND_HOLD");, +			}, +			catch (NoSuchFieldException ex) {, +				// Try Hibernate 5.1, +				try {, +					AvailableSettings.class.getField("ACQUIRE_CONNECTIONS");, +					jpaProperties.put("hibernate.connection.release_mode", "ON_CLOSE");, +				}, +				catch (NoSuchFieldException ex2) {, +					// on Hibernate 5.0.x or lower - no need to change the default there, +				}, +			}, +		}, +]