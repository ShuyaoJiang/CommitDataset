[+++ b/org.springframework.web.servlet/src/test/java/org/springframework/web/servlet/mvc/annotation/ServletAnnotationControllerTests.java, +import java.beans.PropertyEditorSupport;, +	 * See SPR-6021, +	 */, +	@Test, +	public void customMapEditor() throws Exception {, +		initServlet(CustomMapEditorController.class);, +, +		MockHttpServletRequest request = new MockHttpServletRequest("GET", "/handle");, +		request.addParameter("map", "bar");, +		MockHttpServletResponse response = new MockHttpServletResponse();, +, +		servlet.service(request, response);, +, +		assertEquals("test-{foo=bar}", response.getContentAsString());, +	}, +, +	/*, +	@Controller, +	public static class CustomMapEditorController {, +, +		@InitBinder, +		public void initBinder(WebDataBinder binder) {, +			binder.initBeanPropertyAccess();, +			binder.registerCustomEditor(Map.class, new CustomMapEditor());, +		}, +, +		@RequestMapping("/handle"), +		public void handle(@RequestParam("map") Map map, Writer writer) throws IOException {, +			writer.write("test-" + map);, +		}, +, +, +	}, +, +	public static class CustomMapEditor extends PropertyEditorSupport {, +, +		@Override, +		public void setAsText(String text) throws IllegalArgumentException {, +			if (StringUtils.hasText(text)) {, +				setValue(Collections.singletonMap("foo", text));, +			}, +			else {, +				setValue(null);, +			}, +		}, +, +	}, +, +++ b/org.springframework.web.servlet/src/test/java/org/springframework/web/servlet/mvc/annotation/ServletAnnotationControllerTests.java, +import java.beans.PropertyEditorSupport;, +	 * See SPR-6021, +	 */, +	@Test, +	public void customMapEditor() throws Exception {, +		initServlet(CustomMapEditorController.class);, +, +		MockHttpServletRequest request = new MockHttpServletRequest("GET", "/handle");, +		request.addParameter("map", "bar");, +		MockHttpServletResponse response = new MockHttpServletResponse();, +, +		servlet.service(request, response);, +, +		assertEquals("test-{foo=bar}", response.getContentAsString());, +	}, +, +	/*, +	@Controller, +	public static class CustomMapEditorController {, +, +		@InitBinder, +		public void initBinder(WebDataBinder binder) {, +			binder.initBeanPropertyAccess();, +			binder.registerCustomEditor(Map.class, new CustomMapEditor());, +		}, +, +		@RequestMapping("/handle"), +		public void handle(@RequestParam("map") Map map, Writer writer) throws IOException {, +			writer.write("test-" + map);, +		}, +, +, +	}, +, +	public static class CustomMapEditor extends PropertyEditorSupport {, +, +		@Override, +		public void setAsText(String text) throws IllegalArgumentException {, +			if (StringUtils.hasText(text)) {, +				setValue(Collections.singletonMap("foo", text));, +			}, +			else {, +				setValue(null);, +			}, +		}, +, +	}, +, +++ b/org.springframework.web/src/main/java/org/springframework/web/bind/annotation/support/HandlerMethodInvoker.java, +		if (Map.class.isAssignableFrom(paramType) && paramName.length() == 0) {]