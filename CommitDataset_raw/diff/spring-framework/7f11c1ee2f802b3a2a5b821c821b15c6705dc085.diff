[+++ b/spring-webmvc/src/main/java/org/springframework/web/servlet/support/ServletUriComponentsBuilder.java, + * A UriComponentsBuilder that extracts information from the HttpServletRequest., +		String path = request.getContextPath();, +		path = prependForwardedPrefix(request, path);, +		builder.replacePath(path);, +		String path = request.getRequestURI();, +		path = prependForwardedPrefix(request, path);, +	private static String prependForwardedPrefix(HttpServletRequest request, String path) {, +		String prefix = request.getHeader("X-Forwarded-Prefix");, +		if (StringUtils.hasText(prefix)) {, +			path = prefix + path;, +		}, +		return path;, +	}, +, +++ b/spring-webmvc/src/main/java/org/springframework/web/servlet/support/ServletUriComponentsBuilder.java, + * A UriComponentsBuilder that extracts information from the HttpServletRequest., +		String path = request.getContextPath();, +		path = prependForwardedPrefix(request, path);, +		builder.replacePath(path);, +		String path = request.getRequestURI();, +		path = prependForwardedPrefix(request, path);, +	private static String prependForwardedPrefix(HttpServletRequest request, String path) {, +		String prefix = request.getHeader("X-Forwarded-Prefix");, +		if (StringUtils.hasText(prefix)) {, +			path = prefix + path;, +		}, +		return path;, +	}, +, +++ b/spring-webmvc/src/test/java/org/springframework/web/servlet/support/ServletUriComponentsBuilderTests.java, +	public void fromContextPathWithForwardedPrefix() {, +		request.addHeader("X-Forwarded-Prefix", "/prefix");, +		request.setContextPath("/mvc-showcase");, +		request.setRequestURI("/mvc-showcase/simple");, +		String result = ServletUriComponentsBuilder.fromContextPath(request).build().toUriString();, +		assertEquals("http://localhost/prefix/mvc-showcase", result);, +	}, +, +	@Test, +	public void fromServletMappingWithForwardedPrefix() {, +		request.addHeader("X-Forwarded-Prefix", "/prefix");, +		request.setContextPath("/mvc-showcase");, +		request.setServletPath("/app");, +		request.setRequestURI("/mvc-showcase/app/simple");, +		String result = ServletUriComponentsBuilder.fromServletMapping(request).build().toUriString();, +		assertEquals("http://localhost/prefix/mvc-showcase/app", result);, +	}, +, +	@Test]