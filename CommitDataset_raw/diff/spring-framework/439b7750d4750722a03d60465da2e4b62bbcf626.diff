[+++ b/org.springframework.orm/src/main/java/org/springframework/orm/hibernate4/HibernateTransactionManager.java, +import java.lang.reflect.Method;, +import org.springframework.util.ClassUtils;, +import org.springframework.util.ReflectionUtils;, +	/**, +	 * A Method handle for the <code>SessionFactory.getCurrentSession()</code> method., +	 * The return value differs between Hibernate 3.x and 4.x; for cross-compilation purposes,, +	 * we have to use reflection here as long as we keep compiling against Hibernate 3.x jars., +	 */, +	private static final Method getCurrentSessionMethod =, +			ClassUtils.getMethod(SessionFactory.class, "getCurrentSession");, +, +, +				Session session = (Session) ReflectionUtils.invokeMethod(getCurrentSessionMethod, this.sessionFactory);]