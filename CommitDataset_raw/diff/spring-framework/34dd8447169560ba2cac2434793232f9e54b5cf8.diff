[+++ b/spring-messaging/src/main/java/org/springframework/messaging/simp/stomp/StompProtocolHandler.java, +	 * authenticated on the WebSocket session., +, +	protected void sendErrorMessage(WebSocketSession session, Throwable error) {, +, +		StompHeaderAccessor headers = StompHeaderAccessor.create(StompCommand.ERROR);, +		headers.setMessage(error.getMessage());, +		Message<byte[]> message = MessageBuilder.withPayloadAndHeaders(new byte[0], headers).build();, +		String payload = new String(this.stompEncoder.encode(message), Charset.forName("UTF-8"));, +		try {, +			session.sendMessage(new TextMessage(payload));, +		}, +		catch (Throwable t) {, +			// ignore, +		}, +	}, +, +	private void augmentConnectedHeaders(StompHeaderAccessor headers, WebSocketSession session) {, +		Principal principal = session.getPrincipal();, +		if (principal != null) {, +			headers.setNativeHeader(CONNECTED_USER_HEADER, principal.getName());, +			headers.setNativeHeader(QUEUE_SUFFIX_HEADER, session.getId());, +, +			if (this.queueSuffixResolver != null) {, +				String suffix = session.getId();, +				this.queueSuffixResolver.addQueueSuffix(principal.getName(), session.getId(), suffix);, +			}, +		}, +	}, +]