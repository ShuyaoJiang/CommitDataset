[+++ b/spring-social-security/src/main/java/org/springframework/social/security/SocialAuthenticationFilter.java, +			return null;, +++ b/spring-social-security/src/main/java/org/springframework/social/security/SocialAuthenticationFilter.java, +			return null;, +++ b/spring-social-security/src/main/java/org/springframework/social/security/provider/OAuth2AuthenticationService.java, +		StringBuffer sb = getProxyHeaderAwareRequestURL(request);, +	protected StringBuffer getProxyHeaderAwareRequestURL(HttpServletRequest request), +, +	{, +		String host = request.getHeader("Host");, +		if ( StringUtils.isEmpty(host) ), +		{, +			return request.getRequestURL();, +		}, +		StringBuffer sb = new StringBuffer();, +		String schemeHeader = request.getHeader("X-Forwarded-Proto");, +		String portHeader = request.getHeader("X-Forwarded-Port");, +		String scheme = StringUtils.isEmpty(schemeHeader) ? "http" : schemeHeader;, +		String port = StringUtils.isEmpty(portHeader) ? "80" : portHeader;, +		if ( scheme.equals("http") && port.equals("80") ), +		{, +			port = "";, +		}, +		if ( scheme.equals("https") && port.equals("443") ), +		{, +			port = "";, +		}, +		sb.append(scheme);, +		sb.append("://");, +		sb.append(host);, +		if ( StringUtils.hasLength(port) ), +		{, +			sb.append(":");, +			sb.append(port);, +		}, +		sb.append(request.getRequestURI());, +		return sb;, +	}]