[+++ b/spring-social-web/src/main/java/org/springframework/social/connect/signin/web/ProviderSignInAttempt.java, +	private final ConnectionFactoryLocator connectionFactoryLocator;, +	private final ConnectionRepository connectionRepository;, +	public ProviderSignInAttempt(Connection<?> connection, ConnectionFactoryLocator connectionFactoryLocator, ConnectionRepository connectionRepository) {, +		this.connectionFactoryLocator = connectionFactoryLocator;, +		this.connectionRepository = connectionRepository;		, +		return connectionFactoryLocator.getConnectionFactory(connectionData.getProviderId()).createConnection(connectionData);, +		connectionRepository.addConnection(getConnection());, +++ b/spring-social-web/src/main/java/org/springframework/social/connect/signin/web/ProviderSignInAttempt.java, +	private final ConnectionFactoryLocator connectionFactoryLocator;, +	private final ConnectionRepository connectionRepository;, +	public ProviderSignInAttempt(Connection<?> connection, ConnectionFactoryLocator connectionFactoryLocator, ConnectionRepository connectionRepository) {, +		this.connectionFactoryLocator = connectionFactoryLocator;, +		this.connectionRepository = connectionRepository;		, +		return connectionFactoryLocator.getConnectionFactory(connectionData.getProviderId()).createConnection(connectionData);, +		connectionRepository.addConnection(getConnection());, +++ b/spring-social-web/src/main/java/org/springframework/social/connect/signin/web/ProviderSignInController.java, +	private final ConnectionFactoryLocator connectionFactoryLocator;, +	private final ConnectionRepository connectionRepository;, +	 * @param connectionFactoryLocator the locator of {@link ConnectionFactory connection factories} that can be used for sign-in; should be a serializable proxy to a singleton bean., +	 * This is because {@link ProviderSignInAttempt} objects are session-scoped and thus require a Serializable reference., +	 * @param connectionRepository the current user's {@link ConnectionRepository} instance; must be a serializable proxy to a request-scoped bean., +	public ProviderSignInController(String applicationUrl, ConnectionFactoryLocator connectionFactoryLocator, UsersConnectionRepository usersConnectionRepository,, +			ConnectionRepository connectionRepository, SignInAdapter signInAdapter) {, +		this.connectionFactoryLocator = connectionFactoryLocator;, +		this.connectionRepository = connectionRepository;, +		ConnectionFactory<?> connectionFactory = connectionFactoryLocator.getConnectionFactory(providerId);, +		OAuth1ConnectionFactory<?> connectionFactory = (OAuth1ConnectionFactory<?>) connectionFactoryLocator.getConnectionFactory(providerId);, +		OAuth2ConnectionFactory<?> connectionFactory = (OAuth2ConnectionFactory<?>) connectionFactoryLocator.getConnectionFactory(providerId);, +			ProviderSignInAttempt signInAttempt = new ProviderSignInAttempt(connection, connectionFactoryLocator, connectionRepository);]