[+++ b/src/main/java/rx/internal/operators/OperatorMulticast.java, +                source.subscribe(subscription);, +++ b/src/main/java/rx/internal/operators/OperatorMulticast.java, +                source.subscribe(subscription);, +++ b/src/main/java/rx/subscriptions/CompositeSubscription.java, +++ b/src/main/java/rx/internal/operators/OperatorMulticast.java, +                source.subscribe(subscription);, +++ b/src/main/java/rx/subscriptions/CompositeSubscription.java, +++ b/src/test/java/rx/internal/operators/OperatorMulticastTest.java, +package rx.internal.operators;, +, +import static org.mockito.Mockito.*;, +, +import java.util.concurrent.TimeUnit;, +, +import org.junit.Test;, +, +import rx.Observable;, +import rx.Scheduler;, +import rx.Scheduler.Worker;, +import rx.Subscriber;, +import rx.Subscription;, +import rx.functions.Action0;, +import rx.functions.Action1;, +import rx.functions.Func1;, +import rx.observables.ConnectableObservable;, +, +public class OperatorMulticastTest {, +, +    /**, +     * test the basic expectation of OperatorMulticast via replay, +     */, +    @Test, +    public void testIssue2191_UnsubscribeSource() {, +        // setup mocks, +        Action1 sourceNext = mock(Action1.class);, +        Action0 sourceCompleted = mock(Action0.class);, +        Action0 sourceUnsubscribed = mock(Action0.class);, +        Subscriber spiedSubscriberBeforeConnect = subscriberSpy();, +        Subscriber spiedSubscriberAfterConnect = subscriberSpy();, +, +        // Observable under test, +        Observable<Integer> source = Observable.just(1,2);, +, +        ConnectableObservable<Integer> replay = source, +                .doOnNext(sourceNext), +                .doOnUnsubscribe(sourceUnsubscribed), +                .doOnCompleted(sourceCompleted), +                .replay();, +, +        replay.subscribe(spiedSubscriberBeforeConnect);, +        replay.subscribe(spiedSubscriberBeforeConnect);, +        replay.connect();, +        replay.subscribe(spiedSubscriberAfterConnect);, +        replay.subscribe(spiedSubscriberAfterConnect);, +, +, +        // verify interactions, +        verify(sourceNext, times(1)).call(1);, +        verify(sourceNext, times(1)).call(2);, +        verify(sourceCompleted, times(1)).call();, +        verifySubscriberSpy(spiedSubscriberBeforeConnect, 2, 4);, +        verifySubscriberSpy(spiedSubscriberAfterConnect, 2, 4);, +, +        verify(sourceUnsubscribed, times(1)).call();, +, +        verifyNoMoreInteractions(sourceNext);, +        verifyNoMoreInteractions(sourceCompleted);, +        verifyNoMoreInteractions(sourceUnsubscribed);, +        verifyNoMoreInteractions(spiedSubscriberBeforeConnect);, +        verifyNoMoreInteractions(spiedSubscriberAfterConnect);, +, +    }, +, +    /**, +     * Specifically test interaction with a Scheduler with subscribeOn, +     *, +     * @throws Exception, +     */, +    @Test, +    public void testIssue2191_SchedulerUnsubscribe() throws Exception {, +        // setup mocks, +        Action1 sourceNext = mock(Action1.class);, +        Action0 sourceCompleted = mock(Action0.class);, +        Action0 sourceUnsubscribed = mock(Action0.class);, +        final Scheduler mockScheduler = mock(Scheduler.class);, +        final Subscription mockSubscription = mock(Subscription.class);, +        Worker spiedWorker = workerSpy(mockSubscription);, +        Subscriber spiedSubscriberBeforeConnect = subscriberSpy();, +        Subscriber spiedSubscriberAfterConnect = subscriberSpy();, +, +        when(mockScheduler.createWorker()).thenReturn(spiedWorker);, +, +        // Observable under test, +        ConnectableObservable<Integer> replay = Observable.just(1, 2, 3), +                .doOnNext(sourceNext), +                .doOnUnsubscribe(sourceUnsubscribed), +                .doOnCompleted(sourceCompleted), +                .subscribeOn(mockScheduler).replay();, +]