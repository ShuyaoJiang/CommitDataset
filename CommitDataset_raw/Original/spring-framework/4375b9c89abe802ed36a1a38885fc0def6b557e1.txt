SPR-6333
SPR-6393
+ fixed the tests
