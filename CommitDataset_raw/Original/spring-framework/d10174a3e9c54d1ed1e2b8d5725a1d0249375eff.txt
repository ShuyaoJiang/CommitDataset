Optimize performance of produces condition checks
