More tests and some fixes.  Also created tests based on the documentation examples.
