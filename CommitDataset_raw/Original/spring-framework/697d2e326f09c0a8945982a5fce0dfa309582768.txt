Merge pull request #1785 from cakofony/iterator_allocation
