Optimize class detection by sharing the ClassLoader

Issue: SPR-17083
