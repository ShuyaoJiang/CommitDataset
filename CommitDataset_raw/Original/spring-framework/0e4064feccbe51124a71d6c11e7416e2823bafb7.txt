added null handling, fixed bug relating to conversion of non-generic collections
