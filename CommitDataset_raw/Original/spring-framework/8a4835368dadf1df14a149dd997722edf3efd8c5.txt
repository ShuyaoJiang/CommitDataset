Use doOnDiscard to free internally queued data buffers

Issue: SPR-17246
