Add EndpointRequestUpgradeStrategy

Now there is just one EndpointHandshakeRequestHandler that works on
different runtimes.
