Class identity comparisons wherever possible (and further polishing)

Issue: SPR-12926
