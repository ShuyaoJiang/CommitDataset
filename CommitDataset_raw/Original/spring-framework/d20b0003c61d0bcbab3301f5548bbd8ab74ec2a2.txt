Refactoring of Servlet 3.1 and Undertow support

- Introduce abstract base class for Servlet 3.1 and Undertow support
- Simplify Undertow support
