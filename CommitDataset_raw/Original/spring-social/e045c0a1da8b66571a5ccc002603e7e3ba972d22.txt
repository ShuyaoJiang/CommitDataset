Partial update of ConnectController to match new provider API. It hasn't been fully tested yet...but it does compile cleanly.
