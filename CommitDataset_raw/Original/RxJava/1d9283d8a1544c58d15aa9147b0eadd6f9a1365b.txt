2.x: add doFinally for handling post terminal or cancel cleanup (#4831)

