Use ArrayListSupplier in more places, add HashMapSupplier. (#4315)

