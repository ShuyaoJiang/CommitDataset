Fix the drainer to check if the queue is empty before quitting.