Using inner and fix unit tests
