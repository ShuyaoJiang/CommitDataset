Improve compose() generics (#4972)

Resolves #4950