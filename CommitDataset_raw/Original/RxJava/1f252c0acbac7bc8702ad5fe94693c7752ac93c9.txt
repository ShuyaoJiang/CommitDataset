Fixing a bug and a potential for other concurrency issues.
