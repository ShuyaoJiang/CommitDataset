Merge pull request #3377 from akarnokd/TakeReentrancyFix2x

2.x: fix take() reentrancy problem.