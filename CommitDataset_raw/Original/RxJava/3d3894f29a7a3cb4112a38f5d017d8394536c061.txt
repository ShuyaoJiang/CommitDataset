Merge pull request #851 from zsxwing/timeout

Reimplement the timeout operator and fix timeout bugs