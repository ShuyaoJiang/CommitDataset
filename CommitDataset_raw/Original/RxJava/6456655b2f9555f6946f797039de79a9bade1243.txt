2.x: cancel upstream first, dispose worker last (#5075)

