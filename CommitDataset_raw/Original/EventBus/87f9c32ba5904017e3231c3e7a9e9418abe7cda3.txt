fixed some time calculation issues