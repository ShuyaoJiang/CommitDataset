fixed race condition "delivery after event" with queued events