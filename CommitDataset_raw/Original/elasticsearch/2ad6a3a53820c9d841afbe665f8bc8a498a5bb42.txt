Cleanup the handling for bootstrap passwords (elastic/x-pack-elasticsearch#3470)

Minor refactoring on the reserved realm:
- Removed some duplicated code
- Added in some additional assertions
- Extended some testing
- Removed use of the obsolete "allow_default_passwords" from the test.

Original commit: elastic/x-pack-elasticsearch@584171d2bdb8e663c1a1174e554c39343761226e
