Refactors steps and adds some execution logic

This is far from complete but its necessary to push so the new step classes can be shared and used.
