Persistent Tasks: check the current state in waitForPersistentTaskStatus (#935)

Add a check for the current state waitForPersistentTaskStatus before waiting for the next one. This fixes sporadic failure in testPersistentActionStatusUpdate test.

Fixes #928
