Tests: Allow to run BWC in isolation

The current tests were only able to finish successfully, if the earlier
tests were run as well, you could not run the restart test in isolation.

This commit ensures an upgrade is executed if needed.

Original commit: elastic/x-pack-elasticsearch@616ebbd6eb3aa0fdc33e0a7ecb9acb38ff43c1d1
