Add failing test for core cache deadlock

The core cache implementation has a deadlock bug. This commit adds a
failing test case.
