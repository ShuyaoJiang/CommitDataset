Update test script engines to use generic compile method (elastic/x-pack-elasticsearch#1546)

This is the xpack side of https://github.com/elastic/elasticsearch/pull/24873

Original commit: elastic/x-pack-elasticsearch@1779afa6bc6ed9a20b3dfb62a984fe7c66c20dff
