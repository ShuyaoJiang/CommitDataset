Port some of CLI's demos to tests

Original commit: elastic/x-pack-elasticsearch@5827c08268f1542aa21ec635cd29cbeb9ea386af
