SNAPSHOT: Improve Resilience SnapshotShardService (#36113)

* Resolve the index in the snapshotting thread
* Added test for routing table - snapshot state mismatch

