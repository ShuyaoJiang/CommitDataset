Add to CSV infra plus some refactoring of the JDBC one

Original commit: elastic/x-pack-elasticsearch@3e002c91c2c5e77e10e1ec1b8aa85f3a9428e7f4
