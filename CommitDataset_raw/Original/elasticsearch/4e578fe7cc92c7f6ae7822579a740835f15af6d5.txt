Build: Replace provided configuration with compileOnly (elastic/x-pack-elasticsearch#3868)

This is the xpack side of elastic/elasticsearch#28564

Original commit: elastic/x-pack-elasticsearch@60033824a4220bd4be8790a8f508c2e1f7340ea6
