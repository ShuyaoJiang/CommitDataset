Add a test for sub-aggregations rewrite (#28491)

This commit adds a test to check that the rewrite of a sub-aggregation triggers a copy of the parent aggregation.

Relates #28430
Closes #27782