Ensure map keys cannot be self referencing (#34569)

This commit improves self reference checking to map keys, as well as
adds it to ingest script processing.