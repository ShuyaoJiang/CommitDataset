Ensure no snapshotted commit when close engine (#38663)

With this change, we can automatically detect an implementation 
that acquires an index commit but fails to release.