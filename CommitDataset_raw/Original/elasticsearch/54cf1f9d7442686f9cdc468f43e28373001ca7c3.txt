[ML] Refactor control message writer to allow reuse for other processes (#36070)

