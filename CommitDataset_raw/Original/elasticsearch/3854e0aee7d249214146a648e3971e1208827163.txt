Validate filename both before and after resolving the path (elastic/x-pack-elasticsearch#1775)

This change ensures we fail early with validation before we even attempt to resolve a path as the
path resolution can fail with invalid characters on some operating systems.

relates elastic/x-pack-elasticsearch#1757

Original commit: elastic/x-pack-elasticsearch@3a4243b6d644f84bfeefe17d6daab6e8b62e67d4
