merge from upstream and fixing conflicts
