Add proper unit tests for double-checked-locking pattern
