Moved more code and added API doc comments.