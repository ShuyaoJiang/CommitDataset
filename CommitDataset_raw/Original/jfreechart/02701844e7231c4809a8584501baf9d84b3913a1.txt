Synchronised with 1.0.x branch.