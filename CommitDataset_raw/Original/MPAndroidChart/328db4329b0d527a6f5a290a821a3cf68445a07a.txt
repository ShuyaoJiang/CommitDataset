Code cleanup and minor changes to custom & extra legend.
