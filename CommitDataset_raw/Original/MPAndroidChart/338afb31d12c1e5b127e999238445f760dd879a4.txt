Fix issue #521 & address issue #520.
