Merge pull request #3207 from scottkennedy/weakref-fixes

Fix some potential NPEs with WeakReference usage