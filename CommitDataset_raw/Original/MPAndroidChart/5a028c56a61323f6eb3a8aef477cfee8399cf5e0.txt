Merge pull request #987 from danielgindi/improvements-and-bugfixes

Improvements and bugfixes