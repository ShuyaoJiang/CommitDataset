Fixed issue concerning offset calculation and legend.
