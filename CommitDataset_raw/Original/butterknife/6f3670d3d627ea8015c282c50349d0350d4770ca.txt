Merge pull request #544 from JakeWharton/jw/only-final-when-needed

Only mark the target as final when actually needed.