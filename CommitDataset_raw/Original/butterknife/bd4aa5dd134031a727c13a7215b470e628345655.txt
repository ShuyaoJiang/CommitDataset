Implement crazy parameter matching in reflection

Also validate return types.
