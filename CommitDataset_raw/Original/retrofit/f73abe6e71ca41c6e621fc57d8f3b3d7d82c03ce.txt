Merge pull request #126 from square/jw/generalize

Simplify callback system to generalize usage.