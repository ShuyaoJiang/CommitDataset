Merge pull request #1343 from square/jw/new-mock

Introduce new mock pattern with a behavior delegate.