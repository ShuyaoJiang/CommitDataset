Move general checks out of HTTP-specific code

These should apply regardless of whether you are using HTTP, SSE, or web sockets.
