Merge pull request #2790 from square/jakew/refactorings/2018-06-12

Jakew/refactorings/2018 06 12