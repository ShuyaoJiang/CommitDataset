Reverted the previous optimization because it might perform very bad as the number of components in the composite buffer increases
