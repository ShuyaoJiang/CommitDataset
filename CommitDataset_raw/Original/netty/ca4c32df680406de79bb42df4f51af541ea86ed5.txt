* Merged Frederic's 'aggregate' branch
* Refactored Frederic's test cases
* Code clean up
