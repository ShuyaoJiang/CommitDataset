Fixed a bug where discardReadBytes is called in a wrong place