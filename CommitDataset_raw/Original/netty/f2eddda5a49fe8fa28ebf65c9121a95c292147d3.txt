Call discardReadBytes() on outbound byte buffers when possible

- Also fixed a test failure in codec-http