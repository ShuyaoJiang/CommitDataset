Refactor sctp to share code with nio