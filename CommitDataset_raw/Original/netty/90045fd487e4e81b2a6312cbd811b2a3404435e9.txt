Reverted my patch and applied Doug Lea's patch
