Made sure flushPendingEncryptedWrites are called only when necessary
