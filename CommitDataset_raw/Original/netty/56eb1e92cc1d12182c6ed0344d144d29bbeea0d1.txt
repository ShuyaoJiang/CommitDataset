Add tests to verify caches are cleared when the resolver is closed. (#8186)

Motivation:

55fec94592920d8696349fd2956039e87cc53bc7 fixed a bug where we did not correctly clear all caches when the resolver was closed but did not add a testcase.

Modifications:

Add testcase.

Result:

More tests.