Port enhancement to reduce memory copy if possible. See #412
