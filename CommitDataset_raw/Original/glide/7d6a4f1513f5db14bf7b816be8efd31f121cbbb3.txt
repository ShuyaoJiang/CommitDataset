Wait for any pending layout passes before using wrap_content fallback.

In some cases wrap_content may be used as a default layout parameter,
so we should at least wait for any pending layout passes before using
it.

Progress towards #2431.
