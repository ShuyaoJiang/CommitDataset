Fix various build issues.

The only significant change is moving CustomViewTargetTest into the
library project and out of the test project. This appears to be
necessary to work around issues with transitive resource dependencies
across libraries. Hopefully we can find a better fix in the future.
