Attempt to prevent BindExceptions in tests

Update tests that use `doWithBlockedPort` so that the port is obtained
and bound early to ensure that something else doesn't grab it.
