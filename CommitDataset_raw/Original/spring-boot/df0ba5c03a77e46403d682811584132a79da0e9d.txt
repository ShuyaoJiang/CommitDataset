Guard against metric failures in MetricsFilter

Update MetricsFilter so that failures to record metrics are logged and
ignored.

Fixes gh-2777
