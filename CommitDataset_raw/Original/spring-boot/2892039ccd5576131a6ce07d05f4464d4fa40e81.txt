Better tests for datasource initialization

See gh-9528
