More use entrySet() rather than using keySet() and get(key)

This commit replaces some more occurrances of keySet() and get(key)
with more efficient usage of the map's entry set.

See gh-4813
