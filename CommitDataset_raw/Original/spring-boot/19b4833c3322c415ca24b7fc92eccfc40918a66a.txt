Keep order when filtering artifacts

This commit makes sure that the order of dependencies is kept when they
are filtered.

Closes gh-8397
