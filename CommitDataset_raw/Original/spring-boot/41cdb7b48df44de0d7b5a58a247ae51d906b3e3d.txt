Add parent directory creation

Also tidied a few other things up (like not needing
SmartApplicationListener).

Fixes gh-550
