Extract ClientHttpRequestFactory detection to its own class

See gh-12707
