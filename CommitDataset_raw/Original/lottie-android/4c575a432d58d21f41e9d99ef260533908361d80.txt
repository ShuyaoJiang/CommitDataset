Optimized test coroutines (#1110)

Downloading, parsing, and snapshotting now all happen on individual coroutines on with the correct dispatchers which allows things to happen in parallel. This should also prevent the wrong bitmap from getting snapshotted which happened before.