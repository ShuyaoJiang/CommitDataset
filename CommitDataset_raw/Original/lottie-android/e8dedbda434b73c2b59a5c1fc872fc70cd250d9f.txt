Improve support for subtract masks

Fixes #421
