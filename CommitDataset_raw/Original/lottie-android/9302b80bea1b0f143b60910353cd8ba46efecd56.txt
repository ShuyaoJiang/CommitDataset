Refactored ShapeLayer which actually fixed some bugs
