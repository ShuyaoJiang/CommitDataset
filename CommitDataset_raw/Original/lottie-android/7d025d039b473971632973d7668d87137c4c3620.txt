Optimize invalidateSelf (#1047)

