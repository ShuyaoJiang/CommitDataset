Ported a ton of the animation code over from iOS
