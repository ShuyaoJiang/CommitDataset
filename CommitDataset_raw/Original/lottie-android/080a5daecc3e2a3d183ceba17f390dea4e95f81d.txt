Added support for inverted intersect masks (#1137)

Also cleaned up some stuff from the original masks PR.