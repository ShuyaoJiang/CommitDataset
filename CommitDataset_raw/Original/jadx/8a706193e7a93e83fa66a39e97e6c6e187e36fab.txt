core: fix indexed loop checks
