core: improve error reporting for inconsistent code
