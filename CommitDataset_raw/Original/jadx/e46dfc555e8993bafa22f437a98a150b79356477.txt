core: redone return blocks splitting for fix issue #4
