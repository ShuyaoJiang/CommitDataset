core: fix various processing issues
