refactor: use flags to mark registers with immutable type
