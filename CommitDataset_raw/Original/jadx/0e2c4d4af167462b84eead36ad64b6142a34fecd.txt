fix thread-safe bug

wrap WeakHashMap with Collections.synchronizedMap, because it can be used by many worker threads.