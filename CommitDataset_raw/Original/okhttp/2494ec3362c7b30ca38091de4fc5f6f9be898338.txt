Merge pull request #2763 from square/jwilson.0730.fix_sync_guard

Guard allocation changes by the connection pool lock.