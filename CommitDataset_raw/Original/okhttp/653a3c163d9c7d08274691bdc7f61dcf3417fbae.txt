Move Handshake to Kotlin (#4799)

* Convert Handshake to Kotlin

* Idiomatic kotlin

* Fix some PR comments
