Merge pull request #2835 from shaunkawano/sk/performance_sensitive_loop

Modify for-loop more performance sensitively