Merge pull request #3293 from square/jw/2017-04-18/once

Only make a single pass when removing protocols.