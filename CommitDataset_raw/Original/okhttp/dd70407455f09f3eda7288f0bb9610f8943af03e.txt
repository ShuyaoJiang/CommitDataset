Merge pull request #4624 from square/jwilson.0215.prepare_to_push

Push more StreamAllocation state into Connection and HttpCodec