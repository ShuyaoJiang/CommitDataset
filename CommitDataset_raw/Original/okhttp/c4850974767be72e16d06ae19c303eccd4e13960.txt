Remote DNS resolving for connections through a SOCKS proxy

This small patch ensures that a connection through a SOCKS proxy will have its hostname resolved through the proxy as well. It includes a test case for that behaviour.
