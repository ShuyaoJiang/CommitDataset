Merge pull request #1621 from square/jwilson_0510_decompose

Use lists to model paths and queries.