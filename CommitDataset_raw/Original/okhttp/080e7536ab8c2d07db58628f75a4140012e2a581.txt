Encode enough to make URI happy.

Plus a bunch of test cases around this unfortunate case.

Closes https://github.com/square/okhttp/issues/1872
