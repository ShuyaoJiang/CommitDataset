Use lists to model paths and queries.

This is actually a little trickier than strings, partly because
we now need code to go in both directions, and partly because
paths that end with '/' are an important but awkward special
case.

The goal is that this will make accessing query parameters much
easier.
