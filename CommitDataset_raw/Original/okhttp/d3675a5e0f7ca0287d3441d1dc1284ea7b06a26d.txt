Detect API use errors earlier.

Previously we would accept invalid input, but crash when that invalid input
was used.
