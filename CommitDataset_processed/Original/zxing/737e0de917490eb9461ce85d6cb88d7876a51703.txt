Move character encoding logic out to common, try again to improve its handling of UTF8 for Chinese market, per manufacturer request, added test cases
