Fixed a few crashes and added a FIXME for another which needs some refactoring.
