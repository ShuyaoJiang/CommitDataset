SImplified optimization a bit and made it more aggressive.
