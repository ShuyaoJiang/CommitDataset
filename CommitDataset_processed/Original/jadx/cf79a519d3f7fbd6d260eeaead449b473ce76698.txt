refactor: move code shrink visitor to separate package and extract inner classes
