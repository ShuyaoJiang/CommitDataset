fix: refactor, improve performance and fix some issues in resource processing
