Properly limit LRU cache size and make it configurable (#1100)
