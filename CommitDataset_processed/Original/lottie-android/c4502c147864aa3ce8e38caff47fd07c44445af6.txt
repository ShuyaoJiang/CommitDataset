Code copied from SDK refactored to comply with project licensing. (#732)
