Aligned with refinements in 3.2.x branch
