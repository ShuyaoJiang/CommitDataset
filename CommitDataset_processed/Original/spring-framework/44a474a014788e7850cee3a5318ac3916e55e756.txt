Various updates to support IDEA
