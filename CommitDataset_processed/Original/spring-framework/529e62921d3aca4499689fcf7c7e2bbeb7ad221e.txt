Refactor Servlet 3 async support
