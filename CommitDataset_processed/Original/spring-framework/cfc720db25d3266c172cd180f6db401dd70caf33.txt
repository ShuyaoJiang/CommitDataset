Latest patches from ASM trunk
