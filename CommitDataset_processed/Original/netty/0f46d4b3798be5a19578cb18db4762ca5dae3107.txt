Revert 25c7a783a788b04f148c56f12d6efe1e11d093cd and fix #1064 differently
