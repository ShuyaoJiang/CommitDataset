[#4533] Ensure replacement of decoder is delayed after finishHandshake() is called
