Also use realloc when shrink the buffer.
