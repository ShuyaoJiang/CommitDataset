[#2572] Correctly calculate length of output buffer before inflate to fix IndexOutOfBoundException
