Refactor LzfDecoder to use proper state machine
