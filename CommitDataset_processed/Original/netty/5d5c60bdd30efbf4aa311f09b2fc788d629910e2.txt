Fix a bug where fireInboundBufferUpdated() and flush() swallow the event too early
