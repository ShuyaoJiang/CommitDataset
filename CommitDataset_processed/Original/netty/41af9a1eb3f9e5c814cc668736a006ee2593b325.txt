Implement cancellation properly for Promise/Future
