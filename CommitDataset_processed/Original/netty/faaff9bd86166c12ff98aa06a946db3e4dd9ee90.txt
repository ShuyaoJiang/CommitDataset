Backport the tests in ReentrantChannelTest
