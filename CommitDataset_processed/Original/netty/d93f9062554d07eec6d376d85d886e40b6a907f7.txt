[#4198] Fix race-condition when allocate from multiple-thread.
