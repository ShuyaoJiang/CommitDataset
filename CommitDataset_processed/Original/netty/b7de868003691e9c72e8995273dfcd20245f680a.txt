[#677] Overhaul HTTP codec
