Rework logging to prevent double initialization
