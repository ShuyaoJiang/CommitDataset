Merge pull request #698 from square/jw/towards-the-new-api
