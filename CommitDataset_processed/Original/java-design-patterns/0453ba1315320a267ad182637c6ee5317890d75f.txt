#176 Test run, app shutdown, minor refactoring
