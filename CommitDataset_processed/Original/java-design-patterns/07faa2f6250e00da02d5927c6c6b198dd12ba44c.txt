#271 implements producer-consumer
