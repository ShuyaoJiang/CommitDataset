2.x: Make CompositeExcpetion thread-safe like 1.x and also fix some issues. (#4619)
