Refactorings in util.concurrent so more code can be shared.
