Optimize collapseFrom and trimAndCollapseFrom so that they
