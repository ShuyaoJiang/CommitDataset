Minor improvements and changes to the arcitecture.
