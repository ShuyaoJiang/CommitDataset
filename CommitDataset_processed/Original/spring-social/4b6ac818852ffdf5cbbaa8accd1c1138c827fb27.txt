Tidied up a few problem areas.
