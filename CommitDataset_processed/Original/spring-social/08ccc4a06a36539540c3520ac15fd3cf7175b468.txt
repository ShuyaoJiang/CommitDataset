duplicate connection handling and tests
