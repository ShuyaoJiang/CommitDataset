Comments, code cleanup, extra safety checks.
