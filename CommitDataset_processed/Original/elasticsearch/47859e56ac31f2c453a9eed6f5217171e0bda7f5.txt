Move file-based discovery to core (#33241)
