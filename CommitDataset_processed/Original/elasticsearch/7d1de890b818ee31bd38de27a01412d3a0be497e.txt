Decouple more classes from XContentBuilder and make builder strict (#29197)
