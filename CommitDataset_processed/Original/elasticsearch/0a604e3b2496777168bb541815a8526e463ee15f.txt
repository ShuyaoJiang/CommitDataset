Fix Two Races that Lead to Stuck Snapshots (#37686)
