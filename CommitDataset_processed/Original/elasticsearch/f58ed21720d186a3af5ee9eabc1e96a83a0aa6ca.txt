Refactor TransportShardBulkAction to better support retries (#31821)
