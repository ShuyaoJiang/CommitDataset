Extract common http logic to server (#31311)
