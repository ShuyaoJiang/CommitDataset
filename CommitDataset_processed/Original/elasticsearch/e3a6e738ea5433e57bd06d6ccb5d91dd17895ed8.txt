Fix InternalIndexLifecycleContext to update state in memory (#3505)
