Refactor Sniffer and make it testable (#29638)
