Generalize BWC logic (#28505)
